/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start(); // weak
int __cdecl sub_80481A9(int);
int __cdecl sub_804823D(int);
void __cdecl sub_80482BC(int, int);
int __cdecl sub_8048450(int, const char **);
int __cdecl sub_804876B(const char *);
// void *malloc(size_t size);
// int printf(const char *format, ...);
// void free(void *ptr);
// int atoi(const char *nptr);
// int fprintf(FILE *stream, const char *format, ...);

//-------------------------------------------------------------------------
// Data declarations

int dword_80480FC = 0; // weak
// extern struct _IO_FILE *stderr;


//----- (08048198) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn start()
{
  int v0; // eax
  int v1; // [esp-4h] [ebp-4h]
  const char *retaddr; // [esp+0h] [ebp+0h] BYREF

  v0 = sys_exit(sub_8048450(v1, &retaddr));
}
// 8048199: positive sp value 4 has been found
// 804819B: variable 'v1' is possibly undefined
// 8048198: using guessed type void __noreturn start();

//----- (080481A9) --------------------------------------------------------
int __cdecl sub_80481A9(int a1)
{
  int v2; // [esp-4h] [ebp-4h]

  if ( a1 <= 2 )
    return 1;
  v2 = sub_80481A9(a1 - 1);
  return v2 + sub_80481A9(a1 - 2);
}

//----- (0804823D) --------------------------------------------------------
int __cdecl sub_804823D(int a1)
{
  int v2; // [esp+0h] [ebp-8h]
  int i; // [esp+4h] [ebp-4h]

  v2 = 1;
  for ( i = 2; i <= a1; ++i )
    v2 *= i;
  return v2;
}

//----- (080482BC) --------------------------------------------------------
void __cdecl sub_80482BC(int a1, int a2)
{
  int v2; // [esp+0h] [ebp-Ch]
  char v3; // [esp+0h] [ebp-Ch]
  _BYTE *v4; // [esp+4h] [ebp-8h]
  _BYTE *ptr; // [esp+8h] [ebp-4h]

  ptr = malloc(0x100u);
  v4 = ptr;
  do
  {
    v2 = a1 % a2;
    if ( a1 % a2 < 10 )
      v3 = v2 + 48;
    else
      v3 = v2 + 87;
    *v4++ = v3;
    a1 /= a2;
  }
  while ( a1 );
  while ( v4 != ptr )
    printf("%c", (char)*--v4);
  free(ptr);
}

//----- (08048450) --------------------------------------------------------
int __cdecl sub_8048450(int a1, const char **a2)
{
  int v4; // eax
  int v5; // eax
  int v6; // eax
  int v7; // [esp+4h] [ebp-8h]

  if ( a1 != 2 && a1 != 3 )
  {
    sub_804876B(*a2);
    return 1;
  }
  else
  {
    v7 = atoi(a2[1]);
    dword_80480FC = 10;
    if ( a1 >= 3 && ((dword_80480FC = atoi(a2[2]), dword_80480FC < 2) || dword_80480FC > 36 ? (v4 = 1) : (v4 = 0), v4) )
    {
      fprintf(stderr, "Invalid base\n");
      return 1;
    }
    else
    {
      printf("fib(%d) = ", v7);
      v5 = sub_80481A9(v7);
      sub_80482BC(v5, dword_80480FC);
      printf("\n");
      printf("fact(%d) = ", v7);
      if ( v7 <= 12 )
      {
        v6 = sub_804823D(v7);
        sub_80482BC(v6, dword_80480FC);
      }
      else
      {
        printf("Overflow");
      }
      printf("\n");
      return 0;
    }
  }
}
// 80480FC: using guessed type int dword_80480FC;

//----- (0804876B) --------------------------------------------------------
int __cdecl sub_804876B(const char *a1)
{
  printf("usage: %s n [base]\n", a1);
  return printf("Compute fib(n) and fact(n) and output the result in base 'base'\n");
}

// nfuncs=11 queued=6 decompiled=6 lumina nreq=0 worse=0 better=0
// ALL OK, 6 function(s) have been successfully decompiled
