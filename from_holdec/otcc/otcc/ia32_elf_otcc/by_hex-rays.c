/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start(); // weak
int __cdecl sub_8048205(int);
int sub_8048227();
int sub_80482B5();
int sub_80482FE();
int sub_804835D();
_BOOL4 __cdecl sub_804898B(int);
_DWORD *__cdecl sub_8048A15(_DWORD *);
int __cdecl sub_8048A74(int, int);
int __cdecl sub_8048AD9(int);
int __cdecl sub_8048B0E(int);
int __cdecl sub_8048B48(int, int);
_BOOL4 __cdecl sub_8048BA9(int);
int __cdecl sub_8048C4F(int, int);
int __cdecl sub_8048CD0(unsigned __int8);
int __cdecl sub_80495A9(int);
int sub_80498E4();
int sub_804990C();
_DWORD *__cdecl sub_8049950(int *);
_BOOL4 __cdecl sub_8049E97(int);
int __cdecl sub_804A1A4(int, const char **);
// int fgetc(FILE *stream);
// int isalnum(int);
// int isspace(int);
// int isdigit(int);
// int strtol(const char *nptr, char **endptr, int base);
// char *strstr(const char *haystack, const char *needle);
// void *dlsym(void *handle, const char *name);
// FILE *fopen(const char *filename, const char *modes);
// char *strcpy(char *dest, const char *src);
// void *calloc(size_t nmemb, size_t size);

//-------------------------------------------------------------------------
// Data declarations

int dword_80480FC = 0; // idb
int dword_8048100 = 0; // weak
int dword_8048104 = 0; // weak
int dword_8048108 = 0; // idb
int dword_804810C = 0; // weak
int dword_8048110 = 0; // weak
int dword_8048114 = 0; // weak
int dword_8048118 = 0; // weak
int dword_804811C = 0; // weak
int dword_8048120 = 0; // weak
FILE *stream = NULL; // idb
char *haystack = NULL; // idb
int dword_804812C = 0; // weak
int dword_8048130 = 0; // weak
int dword_8048134 = 0; // weak
char *name = NULL; // idb
char aMAmR1cH3cH3cBD[126] = "++#m--%am*@R<^1c/@%[_[H3c%@%[_[H3c+@.B#d-@%:_^BKd<<Z/03e>>`/03e<=0f>=/f<@.f>@1f==&g!='g&&k||#l&@.BCh^@.BSi|@.B+j~@/%Yd!@&d*@b"; // weak
char modes[] = "r"; // idb
char src[] = " int if else while break return for define main "; // idb
// extern struct _IO_FILE *stdin;


//----- (080481F4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn start()
{
  int v0; // eax
  int v1; // [esp-4h] [ebp-4h]
  const char *retaddr; // [esp+0h] [ebp+0h] BYREF

  v0 = sys_exit(sub_804A1A4(v1, &retaddr));
}
// 80481F5: positive sp value 4 has been found
// 80481F7: variable 'v1' is possibly undefined
// 80481F4: using guessed type void __noreturn start();

//----- (08048205) --------------------------------------------------------
int __cdecl sub_8048205(int a1)
{
  int v1; // eax
  int result; // eax
  _BYTE *v3; // [esp-4h] [ebp-4h]

  v1 = dword_804812C++;
  v3 = (_BYTE *)v1;
  result = a1;
  *v3 = a1;
  return result;
}
// 804812C: using guessed type int dword_804812C;

//----- (08048227) --------------------------------------------------------
int sub_8048227()
{
  char *v0; // eax
  int result; // eax

  if ( dword_8048130 )
  {
    v0 = (char *)dword_8048130++;
    dword_8048108 = *v0;
    result = dword_8048108 == 2;
    if ( dword_8048108 == 2 )
    {
      dword_8048130 = 0;
      result = dword_8048134;
      dword_8048108 = dword_8048134;
    }
  }
  else
  {
    result = fgetc(stream);
    dword_8048108 = result;
  }
  return result;
}
// 8048130: using guessed type int dword_8048130;
// 8048134: using guessed type int dword_8048134;

//----- (080482B5) --------------------------------------------------------
int sub_80482B5()
{
  return isalnum(dword_8048108) | (dword_8048108 == 95);
}

//----- (080482FE) --------------------------------------------------------
int sub_80482FE()
{
  int result; // eax

  result = dword_8048108 == 92;
  if ( dword_8048108 == 92 )
  {
    sub_8048227();
    result = dword_8048108 == 110;
    if ( dword_8048108 == 110 )
    {
      result = 10;
      dword_8048108 = 10;
    }
  }
  return result;
}

//----- (0804835D) --------------------------------------------------------
int sub_804835D()
{
  int result; // eax
  char *v1; // eax
  char *v2; // eax
  char *v3; // eax
  int v4; // [esp+0h] [ebp-Ch]
  int v5; // [esp+4h] [ebp-8h]
  char *v6; // [esp+8h] [ebp-4h]
  char *v7; // [esp+8h] [ebp-4h]

  while ( isspace(dword_8048108) | (dword_8048108 == 35) )
  {
    if ( dword_8048108 == 35 )
    {
      sub_8048227();
      sub_804835D();
      if ( dword_80480FC == 536 )
      {
        sub_804835D();
        sub_8048205(32);
        *(_DWORD *)dword_80480FC = 1;
        *(_DWORD *)(dword_80480FC + 4) = dword_804812C;
      }
      while ( dword_8048108 != 10 )
      {
        sub_8048205(dword_8048108);
        sub_8048227();
      }
      sub_8048205(dword_8048108);
      sub_8048205(2);
    }
    sub_8048227();
  }
  dword_8048104 = 0;
  dword_80480FC = dword_8048108;
  if ( sub_80482B5() )
  {
    sub_8048205(32);
    name = (char *)dword_804812C;
    while ( sub_80482B5() )
    {
      sub_8048205(dword_8048108);
      sub_8048227();
    }
    if ( isdigit(dword_80480FC) )
    {
      dword_8048100 = strtol(name, 0, 0);
      result = 2;
      dword_80480FC = 2;
    }
    else
    {
      *(_BYTE *)dword_804812C = 32;
      dword_80480FC = strstr(haystack, name - 1) - haystack;
      *(_BYTE *)dword_804812C = 0;
      dword_80480FC = 8 * dword_80480FC + 256;
      result = dword_80480FC > 536;
      if ( dword_80480FC > 536 )
      {
        dword_80480FC += dword_804810C;
        result = *(_DWORD *)dword_80480FC == 1;
        if ( *(_DWORD *)dword_80480FC == 1 )
        {
          dword_8048130 = *(_DWORD *)(dword_80480FC + 4);
          dword_8048134 = dword_8048108;
          sub_8048227();
          return sub_804835D();
        }
      }
    }
  }
  else
  {
    sub_8048227();
    if ( dword_80480FC == 39 )
    {
      dword_80480FC = 2;
      sub_80482FE();
      dword_8048100 = dword_8048108;
      sub_8048227();
      return sub_8048227();
    }
    else if ( dword_80480FC == 47 && dword_8048108 == 42 )
    {
      sub_8048227();
      while ( dword_8048108 )
      {
        while ( dword_8048108 != 42 )
          sub_8048227();
        sub_8048227();
        if ( dword_8048108 == 47 )
          dword_8048108 = 0;
      }
      sub_8048227();
      return sub_804835D();
    }
    else
    {
      v6 = aMAmR1cH3cH3cBD;
      while ( 1 )
      {
        v1 = v6;
        v7 = v6 + 1;
        result = *v1;
        v5 = result;
        if ( !result )
          break;
        v2 = v7;
        v6 = v7 + 1;
        v4 = *v2;
        for ( dword_8048100 = 0; ; dword_8048100 = (dword_8048100 << 6) + dword_8048104 + 64 )
        {
          v3 = v6++;
          dword_8048104 = *v3 - 98;
          if ( dword_8048104 >= 0 )
            break;
        }
        if ( v5 == dword_80480FC && (v4 == dword_8048108 || v4 == 64) )
        {
          result = v4 == dword_8048108;
          if ( v4 == dword_8048108 )
          {
            sub_8048227();
            result = 1;
            dword_80480FC = 1;
          }
          return result;
        }
      }
    }
  }
  return result;
}
// 8048100: using guessed type int dword_8048100;
// 8048104: using guessed type int dword_8048104;
// 804810C: using guessed type int dword_804810C;
// 804812C: using guessed type int dword_804812C;
// 8048130: using guessed type int dword_8048130;
// 8048134: using guessed type int dword_8048134;

//----- (0804898B) --------------------------------------------------------
_BOOL4 __cdecl sub_804898B(int a1)
{
  _BOOL4 result; // eax
  _BYTE *v2; // eax

  while ( 1 )
  {
    result = a1 && a1 != -1;
    if ( !result )
      break;
    v2 = (_BYTE *)dword_8048118++;
    *v2 = a1;
    a1 >>= 8;
  }
  return result;
}
// 8048118: using guessed type int dword_8048118;

//----- (08048A15) --------------------------------------------------------
_DWORD *__cdecl sub_8048A15(_DWORD *a1)
{
  _DWORD *result; // eax
  _DWORD *v2; // [esp+0h] [ebp-4h]

  while ( 1 )
  {
    result = a1;
    if ( !a1 )
      break;
    v2 = (_DWORD *)*a1;
    *a1 = dword_8048118 - (_DWORD)a1 - 4;
    a1 = v2;
  }
  return result;
}
// 8048118: using guessed type int dword_8048118;

//----- (08048A74) --------------------------------------------------------
int __cdecl sub_8048A74(int a1, int a2)
{
  int v3; // [esp+Ch] [ebp+Ch]

  sub_804898B(a1);
  *(_DWORD *)dword_8048118 = a2;
  v3 = dword_8048118;
  dword_8048118 += 4;
  return v3;
}
// 8048118: using guessed type int dword_8048118;

//----- (08048AD9) --------------------------------------------------------
int __cdecl sub_8048AD9(int a1)
{
  return sub_8048A74(184, a1);
}

//----- (08048B0E) --------------------------------------------------------
int __cdecl sub_8048B0E(int a1)
{
  return sub_8048A74(233, a1);
}

//----- (08048B48) --------------------------------------------------------
int __cdecl sub_8048B48(int a1, int a2)
{
  sub_804898B(1032325);
  return sub_8048A74(a1 + 132, a2);
}

//----- (08048BA9) --------------------------------------------------------
_BOOL4 __cdecl sub_8048BA9(int a1)
{
  sub_804898B(49465);
  sub_8048AD9(0);
  sub_804898B(15);
  sub_804898B(a1 + 144);
  return sub_804898B(192);
}

//----- (08048C4F) --------------------------------------------------------
int __cdecl sub_8048C4F(int a1, int a2)
{
  sub_804898B(a1 + 131);
  return sub_8048A74(((a2 < 512) << 7) | 5, a2);
}

//----- (08048CD0) --------------------------------------------------------
int __cdecl sub_8048CD0(unsigned __int8 a1)
{
  _BYTE *v1; // eax
  int result; // eax
  int v3; // [esp+0h] [ebp-10h]
  int v4; // [esp+4h] [ebp-Ch]
  int *v5; // [esp+4h] [ebp-Ch]
  int *v6; // [esp+8h] [ebp-8h]
  int v7; // [esp+Ch] [ebp-4h]
  int v8; // [esp+18h] [ebp+8h]

  v7 = 1;
  if ( dword_80480FC == 34 )
  {
    sub_8048AD9(dword_8048120);
    while ( dword_8048108 != 34 )
    {
      sub_80482FE();
      v1 = (_BYTE *)dword_8048120++;
      *v1 = dword_8048108;
      sub_8048227();
    }
    *(_BYTE *)dword_8048120 = 0;
    dword_8048120 = (dword_8048120 + 4) & 0xFFFFFFFC;
    sub_8048227();
    sub_804835D();
  }
  else
  {
    v3 = dword_8048104;
    v4 = dword_8048100;
    v6 = (int *)dword_80480FC;
    sub_804835D();
    if ( v6 == (int *)2 )
    {
      sub_8048AD9(v4);
    }
    else if ( v3 == 2 )
    {
      sub_8048CD0(0);
      sub_8048A74(185, 0);
      if ( v6 == (int *)33 )
        sub_8048BA9(v4);
      else
        sub_804898B(v4);
    }
    else if ( v6 == (int *)40 )
    {
      sub_80498E4();
      sub_804835D();
    }
    else if ( v6 == (int *)42 )
    {
      sub_804835D();
      v6 = (int *)dword_80480FC;
      sub_804835D();
      sub_804835D();
      if ( dword_80480FC == 42 )
      {
        sub_804835D();
        sub_804835D();
        sub_804835D();
        sub_804835D();
        v6 = 0;
      }
      sub_804835D();
      sub_8048CD0(0);
      if ( dword_80480FC == 61 )
      {
        sub_804835D();
        sub_804898B(80);
        sub_80498E4();
        sub_804898B(89);
        sub_804898B((v6 == (int *)256) + 392);
      }
      else if ( v6 )
      {
        if ( v6 == (int *)256 )
          sub_804898B(139);
        else
          sub_804898B(48655);
        ++dword_8048118;
      }
    }
    else if ( v6 == (int *)38 )
    {
      sub_8048C4F(10, *(_DWORD *)dword_80480FC);
      sub_804835D();
    }
    else
    {
      v7 = *v6;
      if ( !*v6 )
        v7 = (int)dlsym(0, name);
      if ( ((dword_80480FC == 61) & a1) != 0 )
      {
        sub_804835D();
        sub_80498E4();
        sub_8048C4F(6, v7);
      }
      else if ( dword_80480FC != 40 )
      {
        sub_8048C4F(8, v7);
        if ( dword_8048104 == 11 )
        {
          sub_8048C4F(0, v7);
          sub_804898B(dword_8048100);
          sub_804835D();
        }
      }
    }
  }
  result = dword_80480FC == 40;
  if ( dword_80480FC == 40 )
  {
    if ( v7 == 1 )
      sub_804898B(80);
    v5 = (int *)sub_8048A74(60545, 0);
    sub_804835D();
    v8 = 0;
    while ( dword_80480FC != 41 )
    {
      sub_80498E4();
      sub_8048A74(2393225, v8);
      if ( dword_80480FC == 44 )
        sub_804835D();
      v8 += 4;
    }
    *v5 = v8;
    sub_804835D();
    if ( v7 )
    {
      if ( v7 == 1 )
      {
        sub_8048A74(2397439, v8);
        v8 += 4;
      }
      else
      {
        sub_8048A74(232, v7 - dword_8048118 - 5);
      }
    }
    else
    {
      v6[1] = sub_8048A74(232, v6[1]);
    }
    result = v8;
    if ( v8 )
      return sub_8048A74(50305, v8);
  }
  return result;
}
// 8049496: variable 'v6' is possibly undefined
// 8048100: using guessed type int dword_8048100;
// 8048104: using guessed type int dword_8048104;
// 8048118: using guessed type int dword_8048118;
// 8048120: using guessed type int dword_8048120;

//----- (080495A9) --------------------------------------------------------
int __cdecl sub_80495A9(int a1)
{
  int result; // eax
  int v3; // [esp+0h] [ebp-Ch]
  _DWORD *v4; // [esp+0h] [ebp-Ch]
  int v5; // [esp+4h] [ebp-8h]
  int v6; // [esp+8h] [ebp-4h]
  int v7; // [esp+14h] [ebp+8h]

  v7 = a1 - 1;
  if ( a1 == 1 )
    return sub_8048CD0(1u);
  sub_80495A9(v7);
  v3 = 0;
  while ( v7 == dword_8048104 )
  {
    v5 = dword_80480FC;
    v6 = dword_8048100;
    sub_804835D();
    if ( v7 <= 8 )
    {
      sub_804898B(80);
      sub_80495A9(v7);
      sub_804898B(89);
      if ( v7 == 4 || v7 == 5 )
      {
        sub_8048BA9(v6);
      }
      else
      {
        sub_804898B(v6);
        if ( v5 == 37 )
          sub_804898B(146);
      }
    }
    else
    {
      v3 = sub_8048B48(v6, v3);
      sub_80495A9(v7);
    }
  }
  result = v3 && v7 > 8;
  if ( result )
  {
    v4 = (_DWORD *)sub_8048B48(v6, v3);
    sub_8048AD9(v6 ^ 1);
    sub_8048B0E(5);
    sub_8048A15(v4);
    return sub_8048AD9(v6);
  }
  return result;
}
// 8049851: variable 'v6' is possibly undefined
// 8048100: using guessed type int dword_8048100;
// 8048104: using guessed type int dword_8048104;

//----- (080498E4) --------------------------------------------------------
int sub_80498E4()
{
  return sub_80495A9(11);
}

//----- (0804990C) --------------------------------------------------------
int sub_804990C()
{
  sub_80498E4();
  return sub_8048B48(0, 0);
}

//----- (08049950) --------------------------------------------------------
_DWORD *__cdecl sub_8049950(int *a1)
{
  int v2; // [esp+0h] [ebp-Ch]
  _DWORD *v3; // [esp+0h] [ebp-Ch]
  _DWORD *v4; // [esp+4h] [ebp-8h]
  int v5; // [esp+4h] [ebp-8h]
  _DWORD *v6; // [esp+8h] [ebp-4h] BYREF

  if ( dword_80480FC == 288 )
  {
    sub_804835D();
    sub_804835D();
    v6 = (_DWORD *)sub_804990C();
    sub_804835D();
    sub_8049950(a1);
    if ( dword_80480FC == 312 )
    {
      sub_804835D();
      v4 = (_DWORD *)sub_8048B0E(0);
      sub_8048A15(v6);
      sub_8049950(a1);
      return sub_8048A15(v4);
    }
    else
    {
      return sub_8048A15(v6);
    }
  }
  else if ( dword_80480FC == 352 || dword_80480FC == 504 )
  {
    v2 = dword_80480FC;
    sub_804835D();
    sub_804835D();
    if ( v2 == 352 )
    {
      v5 = dword_8048118;
      v6 = (_DWORD *)sub_804990C();
    }
    else
    {
      if ( dword_80480FC != 59 )
        sub_80498E4();
      sub_804835D();
      v5 = dword_8048118;
      v6 = 0;
      if ( dword_80480FC != 59 )
        v6 = (_DWORD *)sub_804990C();
      sub_804835D();
      if ( dword_80480FC != 41 )
      {
        v3 = (_DWORD *)sub_8048B0E(0);
        sub_80498E4();
        sub_8048B0E(v5 - dword_8048118 - 5);
        sub_8048A15(v3);
        v5 = (int)(v3 + 1);
      }
    }
    sub_804835D();
    sub_8049950((int *)&v6);
    sub_8048B0E(v5 - dword_8048118 - 5);
    return sub_8048A15(v6);
  }
  else
  {
    switch ( dword_80480FC )
    {
      case 123:
        sub_804835D();
        sub_8049E97(1);
        while ( dword_80480FC != 125 )
          sub_8049950(a1);
        break;
      case 448:
        sub_804835D();
        if ( dword_80480FC != 59 )
          sub_80498E4();
        dword_8048110 = sub_8048B0E(dword_8048110);
        break;
      case 400:
        sub_804835D();
        *a1 = sub_8048B0E(*a1);
        break;
      default:
        if ( dword_80480FC != 59 )
          sub_80498E4();
        break;
    }
    return (_DWORD *)sub_804835D();
  }
}
// 8048110: using guessed type int dword_8048110;
// 8048118: using guessed type int dword_8048118;

//----- (08049E97) --------------------------------------------------------
_BOOL4 __cdecl sub_8049E97(int a1)
{
  _BOOL4 result; // eax
  int v2; // [esp+0h] [ebp-4h]
  _DWORD *v3; // [esp+0h] [ebp-4h]

  while ( 1 )
  {
    result = dword_80480FC == 256 || dword_80480FC != -1 && a1 == 0;
    if ( !result )
      break;
    if ( dword_80480FC == 256 )
    {
      sub_804835D();
      while ( dword_80480FC != 59 )
      {
        if ( a1 )
        {
          dword_804811C += 4;
          *(_DWORD *)dword_80480FC = -dword_804811C;
        }
        else
        {
          *(_DWORD *)dword_80480FC = dword_8048120;
          dword_8048120 += 4;
        }
        sub_804835D();
        if ( dword_80480FC == 44 )
          sub_804835D();
      }
      sub_804835D();
    }
    else
    {
      sub_8048A15(*(_DWORD **)(dword_80480FC + 4));
      *(_DWORD *)dword_80480FC = dword_8048118;
      sub_804835D();
      sub_804835D();
      v2 = 8;
      while ( dword_80480FC != 41 )
      {
        *(_DWORD *)dword_80480FC = v2;
        v2 += 4;
        sub_804835D();
        if ( dword_80480FC == 44 )
          sub_804835D();
      }
      sub_804835D();
      dword_804811C = 0;
      dword_8048110 = 0;
      sub_804898B(15042901);
      v3 = (_DWORD *)sub_8048A74(60545, 0);
      sub_8049950(0);
      sub_8048A15((_DWORD *)dword_8048110);
      sub_804898B(50121);
      *v3 = dword_804811C;
    }
  }
  return result;
}
// 8048110: using guessed type int dword_8048110;
// 8048118: using guessed type int dword_8048118;
// 804811C: using guessed type int dword_804811C;
// 8048120: using guessed type int dword_8048120;

//----- (0804A1A4) --------------------------------------------------------
int __cdecl sub_804A1A4(int a1, const char **a2)
{
  int v4; // [esp+8h] [ebp+8h]

  stream = stdin;
  v4 = a1 - 1;
  if ( a1 > 1 )
    stream = fopen(*++a2, modes);
  haystack = (char *)calloc(1u, 0x1869Fu);
  dword_804812C = (int)(strcpy(haystack, src) + 48);
  dword_8048120 = (int)calloc(1u, 0x1869Fu);
  dword_8048114 = (int)calloc(1u, 0x1869Fu);
  dword_8048118 = dword_8048114;
  dword_804810C = (int)calloc(1u, 0x1869Fu);
  sub_8048227();
  sub_804835D();
  sub_8049E97(0);
  return (*(int (__cdecl **)(int, const char **, _DWORD))(dword_804810C + 592))(
           v4,
           a2,
           *(_DWORD *)(dword_804810C + 592));
}
// 804810C: using guessed type int dword_804810C;
// 8048114: using guessed type int dword_8048114;
// 8048118: using guessed type int dword_8048118;
// 8048120: using guessed type int dword_8048120;
// 804812C: using guessed type int dword_804812C;

// nfuncs=31 queued=21 decompiled=21 lumina nreq=0 worse=0 better=0
// ALL OK, 21 function(s) have been successfully decompiled
