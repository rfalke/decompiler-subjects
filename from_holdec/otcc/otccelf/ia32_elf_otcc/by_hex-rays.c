/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start(); // weak
int __cdecl sub_8048261(int a1);
int sub_8048283();
int sub_8048311();
int sub_804835A();
int sub_80483B9();
_BOOL4 __cdecl sub_80489E7(int a1);
int __cdecl sub_8048A71(int *a1, int a2);
int __cdecl sub_8048AF6(unsigned __int16 *a1);
unsigned __int16 *__cdecl sub_8048B93(unsigned __int16 *a1, int a2);
unsigned __int16 *__cdecl sub_8048D31(unsigned __int16 *a1);
int __cdecl sub_8048D67(int a1, int a2);
int __cdecl sub_8048DE7(int a1);
int __cdecl sub_8048E1C(int a1);
int __cdecl sub_8048E56(int a1, int a2);
_BOOL4 __cdecl sub_8048EB7(int a1);
int __cdecl sub_8048F5D(int a1, int *a2);
int __cdecl sub_804905B(unsigned __int8 a1);
int __cdecl sub_8049882(int a1);
int sub_8049BBD();
int sub_8049BE5();
unsigned __int16 *__cdecl sub_8049C29(int *a1);
_BOOL4 __cdecl sub_804A170(int a1);
char *__cdecl sub_804A46F(int a1);
char *__cdecl sub_804A4BA(int a1, int a2);
_BOOL4 __cdecl sub_804A570(int a1);
int __cdecl sub_804A9F0(char *filename); // idb
int __cdecl sub_804B4A3(int a1, int a2);
// int fgetc(FILE *stream);
// int isalnum(int);
// int isspace(int);
// int isdigit(int);
// int strtol(const char *nptr, char **endptr, int base);
// char *strstr(const char *haystack, const char *needle);
// void *memcpy(void *dest, const void *src, size_t n);
// char *strcpy(char *dest, const char *src);
// FILE *fopen(const char *filename, const char *modes);
// size_t fwrite(const void *ptr, size_t size, size_t n, FILE *s);
// int fclose(FILE *stream);
// int printf(const char *format, ...);
// void *calloc(size_t nmemb, size_t size);

//-------------------------------------------------------------------------
// Data declarations

int dword_8048000 = 1179403647; // weak
int dword_80480FC = 0; // idb
int dword_8048100 = 0; // weak
int dword_8048104 = 0; // weak
int dword_8048108 = 0; // idb
int dword_804810C = 0; // weak
int dword_8048110 = 0; // weak
void *dword_8048114 = NULL; // idb
int dword_8048118 = 0; // weak
int dword_804811C = 0; // weak
char *dest = NULL; // idb
FILE *stream = NULL; // idb
char *haystack = NULL; // idb
int dword_804812C = 0; // weak
int dword_8048130 = 0; // weak
int dword_8048134 = 0; // weak
char *nptr = NULL; // idb
void *ptr = NULL; // idb
void *dword_8048140 = NULL; // idb
int dword_8048144 = 0; // weak
char aMAmR1cH3cH3cBD[126] = "++#m--%am*@R<^1c/@%[_[H3c%@%[_[H3c+@.B#d-@%:_^BKd<<Z/03e>>`/03e<=0f>=/f<@.f>@1f==&g!='g&&k||#l&@.BCh^@.BSi|@.B+j~@/%Yd!@&d*@b"; // weak
char src[] = "libc.so.6"; // idb
char aLibdlSo2_0[] = "libdl.so.2"; // idb
char aLibLdLinuxSo2_0[] = "/lib/ld-linux.so.2"; // idb
char modes[] = "w"; // idb
char aIntIfElseWhile[] = " int if else while break return for define main "; // idb
char aR[] = "r"; // idb


//----- (08048250) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn start()
{
  int v0; // eax
  int v1; // [esp-4h] [ebp-4h]
  void *retaddr; // [esp+0h] [ebp+0h] BYREF

  v0 = sys_exit(sub_804B4A3(v1, (int)&retaddr));
}
// 8048251: positive sp value 4 has been found
// 8048253: variable 'v1' is possibly undefined
// 8048250: using guessed type void __noreturn start();

//----- (08048261) --------------------------------------------------------
int __cdecl sub_8048261(int a1)
{
  int v1; // eax
  int result; // eax
  _BYTE *v3; // [esp-4h] [ebp-4h]

  v1 = dword_804812C++;
  v3 = (_BYTE *)v1;
  result = a1;
  *v3 = a1;
  return result;
}
// 804812C: using guessed type int dword_804812C;

//----- (08048283) --------------------------------------------------------
int sub_8048283()
{
  char *v0; // eax
  int result; // eax

  if ( dword_8048130 )
  {
    v0 = (char *)dword_8048130++;
    dword_8048108 = *v0;
    result = dword_8048108 == 2;
    if ( dword_8048108 == 2 )
    {
      dword_8048130 = 0;
      result = dword_8048134;
      dword_8048108 = dword_8048134;
    }
  }
  else
  {
    result = fgetc(stream);
    dword_8048108 = result;
  }
  return result;
}
// 8048130: using guessed type int dword_8048130;
// 8048134: using guessed type int dword_8048134;

//----- (08048311) --------------------------------------------------------
int sub_8048311()
{
  return isalnum(dword_8048108) | (dword_8048108 == 95);
}

//----- (0804835A) --------------------------------------------------------
int sub_804835A()
{
  int result; // eax

  result = dword_8048108 == 92;
  if ( dword_8048108 == 92 )
  {
    sub_8048283();
    result = dword_8048108 == 110;
    if ( dword_8048108 == 110 )
    {
      result = 10;
      dword_8048108 = 10;
    }
  }
  return result;
}

//----- (080483B9) --------------------------------------------------------
int sub_80483B9()
{
  int result; // eax
  char *v1; // eax
  char *v2; // eax
  char *v3; // eax
  int v4; // [esp+0h] [ebp-Ch]
  int v5; // [esp+4h] [ebp-8h]
  char *v6; // [esp+8h] [ebp-4h]
  char *v7; // [esp+8h] [ebp-4h]

  while ( isspace(dword_8048108) | (dword_8048108 == 35) )
  {
    if ( dword_8048108 == 35 )
    {
      sub_8048283();
      sub_80483B9();
      if ( dword_80480FC == 536 )
      {
        sub_80483B9();
        sub_8048261(32);
        *(_DWORD *)dword_80480FC = 1;
        *(_DWORD *)(dword_80480FC + 4) = dword_804812C;
      }
      while ( dword_8048108 != 10 )
      {
        sub_8048261(dword_8048108);
        sub_8048283();
      }
      sub_8048261(dword_8048108);
      sub_8048261(2);
    }
    sub_8048283();
  }
  dword_8048104 = 0;
  dword_80480FC = dword_8048108;
  if ( sub_8048311() )
  {
    sub_8048261(32);
    nptr = (char *)dword_804812C;
    while ( sub_8048311() )
    {
      sub_8048261(dword_8048108);
      sub_8048283();
    }
    if ( isdigit(dword_80480FC) )
    {
      dword_8048100 = strtol(nptr, 0, 0);
      result = 2;
      dword_80480FC = 2;
    }
    else
    {
      *(_BYTE *)dword_804812C = 32;
      dword_80480FC = strstr(haystack, nptr - 1) - haystack;
      *(_BYTE *)dword_804812C = 0;
      dword_80480FC = 8 * dword_80480FC + 256;
      result = dword_80480FC > 536;
      if ( dword_80480FC > 536 )
      {
        dword_80480FC += dword_804810C;
        result = *(_DWORD *)dword_80480FC == 1;
        if ( *(_DWORD *)dword_80480FC == 1 )
        {
          dword_8048130 = *(_DWORD *)(dword_80480FC + 4);
          dword_8048134 = dword_8048108;
          sub_8048283();
          result = sub_80483B9();
        }
      }
    }
  }
  else
  {
    sub_8048283();
    if ( dword_80480FC == 39 )
    {
      dword_80480FC = 2;
      sub_804835A();
      dword_8048100 = dword_8048108;
      sub_8048283();
      result = sub_8048283();
    }
    else if ( dword_80480FC == 47 && dword_8048108 == 42 )
    {
      sub_8048283();
      while ( dword_8048108 )
      {
        while ( dword_8048108 != 42 )
          sub_8048283();
        sub_8048283();
        if ( dword_8048108 == 47 )
          dword_8048108 = 0;
      }
      sub_8048283();
      result = sub_80483B9();
    }
    else
    {
      v6 = aMAmR1cH3cH3cBD;
      while ( 1 )
      {
        v1 = v6;
        v7 = v6 + 1;
        result = *v1;
        v5 = result;
        if ( !result )
          break;
        v2 = v7;
        v6 = v7 + 1;
        v4 = *v2;
        for ( dword_8048100 = 0; ; dword_8048100 = (dword_8048100 << 6) + dword_8048104 + 64 )
        {
          v3 = v6++;
          dword_8048104 = *v3 - 98;
          if ( dword_8048104 >= 0 )
            break;
        }
        if ( v5 == dword_80480FC && (v4 == dword_8048108 || v4 == 64) )
        {
          result = v4 == dword_8048108;
          if ( v4 == dword_8048108 )
          {
            sub_8048283();
            result = 1;
            dword_80480FC = 1;
          }
          return result;
        }
      }
    }
  }
  return result;
}
// 8048100: using guessed type int dword_8048100;
// 8048104: using guessed type int dword_8048104;
// 804810C: using guessed type int dword_804810C;
// 804812C: using guessed type int dword_804812C;
// 8048130: using guessed type int dword_8048130;
// 8048134: using guessed type int dword_8048134;

//----- (080489E7) --------------------------------------------------------
_BOOL4 __cdecl sub_80489E7(int a1)
{
  _BOOL4 result; // eax
  _BYTE *v2; // eax

  while ( 1 )
  {
    result = a1 && a1 != -1;
    if ( !result )
      break;
    v2 = (_BYTE *)dword_8048118++;
    *v2 = a1;
    a1 >>= 8;
  }
  return result;
}
// 8048118: using guessed type int dword_8048118;

//----- (08048A71) --------------------------------------------------------
int __cdecl sub_8048A71(int *a1, int a2)
{
  *a1 = a2;
  return a2 >> 24;
}

//----- (08048AF6) --------------------------------------------------------
int __cdecl sub_8048AF6(unsigned __int16 *a1)
{
  return *a1 | (*((unsigned __int8 *)a1 + 2) << 16) | (*((unsigned __int8 *)a1 + 3) << 24);
}

//----- (08048B93) --------------------------------------------------------
unsigned __int16 *__cdecl sub_8048B93(unsigned __int16 *a1, int a2)
{
  unsigned __int16 *result; // eax
  unsigned __int16 *v4; // [esp+0h] [ebp-4h]

  while ( 1 )
  {
    result = a1;
    if ( !a1 )
      break;
    v4 = (unsigned __int16 *)sub_8048AF6(a1);
    if ( *((_BYTE *)a1 - 1) == 5 )
    {
      if ( a2 >= (int)ptr && a2 < (int)dest )
        sub_8048A71((int *)a1, a2 + dword_8048144);
      else
        sub_8048A71((int *)a1, (int)dword_8048140 + a2 - (_DWORD)dword_8048114 + dword_8048144);
    }
    else
    {
      sub_8048A71((int *)a1, a2 - (_DWORD)a1 - 4);
    }
    a1 = v4;
  }
  return result;
}
// 8048144: using guessed type int dword_8048144;

//----- (08048D31) --------------------------------------------------------
unsigned __int16 *__cdecl sub_8048D31(unsigned __int16 *a1)
{
  return sub_8048B93(a1, dword_8048118);
}
// 8048118: using guessed type int dword_8048118;

//----- (08048D67) --------------------------------------------------------
int __cdecl sub_8048D67(int a1, int a2)
{
  int v3; // [esp+Ch] [ebp+Ch]

  sub_80489E7(a1);
  sub_8048A71((int *)dword_8048118, a2);
  v3 = dword_8048118;
  dword_8048118 += 4;
  return v3;
}
// 8048118: using guessed type int dword_8048118;

//----- (08048DE7) --------------------------------------------------------
int __cdecl sub_8048DE7(int a1)
{
  return sub_8048D67(184, a1);
}

//----- (08048E1C) --------------------------------------------------------
int __cdecl sub_8048E1C(int a1)
{
  return sub_8048D67(233, a1);
}

//----- (08048E56) --------------------------------------------------------
int __cdecl sub_8048E56(int a1, int a2)
{
  sub_80489E7(1032325);
  return sub_8048D67(a1 + 132, a2);
}

//----- (08048EB7) --------------------------------------------------------
_BOOL4 __cdecl sub_8048EB7(int a1)
{
  sub_80489E7(49465);
  sub_8048DE7(0);
  sub_80489E7(15);
  sub_80489E7(a1 + 144);
  return sub_80489E7(192);
}

//----- (08048F5D) --------------------------------------------------------
int __cdecl sub_8048F5D(int a1, int *a2)
{
  int result; // eax
  int v4; // [esp+0h] [ebp-4h]

  sub_80489E7(a1 + 131);
  v4 = *a2;
  if ( *a2 && v4 < 512 )
    return sub_8048D67(133, v4);
  result = sub_8048D67(5, a2[1]);
  a2[1] = result;
  return result;
}

//----- (0804905B) --------------------------------------------------------
int __cdecl sub_804905B(unsigned __int8 a1)
{
  char *v1; // eax
  int result; // eax
  int v3; // [esp+0h] [ebp-10h]
  int v4; // [esp+4h] [ebp-Ch]
  int *v5; // [esp+4h] [ebp-Ch]
  int *v6; // [esp+8h] [ebp-8h]
  int v7; // [esp+Ch] [ebp-4h]
  int v8; // [esp+18h] [ebp+8h]

  v7 = 1;
  if ( dword_80480FC == 34 )
  {
    sub_8048DE7((int)&dest[dword_8048144]);
    while ( dword_8048108 != 34 )
    {
      sub_804835A();
      v1 = dest++;
      *v1 = dword_8048108;
      sub_8048283();
    }
    *dest = 0;
    dest = (char *)((unsigned int)(dest + 4) & 0xFFFFFFFC);
    sub_8048283();
    sub_80483B9();
  }
  else
  {
    v3 = dword_8048104;
    v4 = dword_8048100;
    v6 = (int *)dword_80480FC;
    sub_80483B9();
    if ( v6 == (int *)2 )
    {
      sub_8048DE7(v4);
    }
    else if ( v3 == 2 )
    {
      sub_804905B(0);
      sub_8048D67(185, 0);
      if ( v6 == (int *)33 )
        sub_8048EB7(v4);
      else
        sub_80489E7(v4);
    }
    else if ( v6 == (int *)40 )
    {
      sub_8049BBD();
      sub_80483B9();
    }
    else if ( v6 == (int *)42 )
    {
      sub_80483B9();
      v6 = (int *)dword_80480FC;
      sub_80483B9();
      sub_80483B9();
      if ( dword_80480FC == 42 )
      {
        sub_80483B9();
        sub_80483B9();
        sub_80483B9();
        sub_80483B9();
        v6 = 0;
      }
      sub_80483B9();
      sub_804905B(0);
      if ( dword_80480FC == 61 )
      {
        sub_80483B9();
        sub_80489E7(80);
        sub_8049BBD();
        sub_80489E7(89);
        sub_80489E7((v6 == (int *)256) + 392);
      }
      else if ( v6 )
      {
        if ( v6 == (int *)256 )
          sub_80489E7(139);
        else
          sub_80489E7(48655);
        ++dword_8048118;
      }
    }
    else if ( v6 == (int *)38 )
    {
      sub_8048F5D(10, (int *)dword_80480FC);
      sub_80483B9();
    }
    else
    {
      v7 = 0;
      if ( ((dword_80480FC == 61) & a1) != 0 )
      {
        sub_80483B9();
        sub_8049BBD();
        sub_8048F5D(6, v6);
      }
      else if ( dword_80480FC != 40 )
      {
        sub_8048F5D(8, v6);
        if ( dword_8048104 == 11 )
        {
          sub_8048F5D(0, v6);
          sub_80489E7(dword_8048100);
          sub_80483B9();
        }
      }
    }
  }
  result = dword_80480FC == 40;
  if ( dword_80480FC == 40 )
  {
    if ( v7 )
      sub_80489E7(80);
    v5 = (int *)sub_8048D67(60545, 0);
    sub_80483B9();
    v8 = 0;
    while ( dword_80480FC != 41 )
    {
      sub_8049BBD();
      sub_8048D67(2393225, v8);
      if ( dword_80480FC == 44 )
        sub_80483B9();
      v8 += 4;
    }
    sub_8048A71(v5, v8);
    sub_80483B9();
    if ( v7 )
    {
      sub_8048D67(2397439, v8);
      v8 += 4;
    }
    else
    {
      v6[1] = sub_8048D67(232, v6[1]);
    }
    result = v8;
    if ( v8 )
      result = sub_8048D67(50305, v8);
  }
  return result;
}
// 8049818: variable 'v6' is possibly undefined
// 8048100: using guessed type int dword_8048100;
// 8048104: using guessed type int dword_8048104;
// 8048118: using guessed type int dword_8048118;
// 8048144: using guessed type int dword_8048144;

//----- (08049882) --------------------------------------------------------
int __cdecl sub_8049882(int a1)
{
  int result; // eax
  int v3; // [esp+0h] [ebp-Ch]
  unsigned __int16 *v4; // [esp+0h] [ebp-Ch]
  int v5; // [esp+4h] [ebp-8h]
  int v6; // [esp+8h] [ebp-4h]
  int v7; // [esp+14h] [ebp+8h]

  v7 = a1 - 1;
  if ( a1 == 1 )
    return sub_804905B(1u);
  sub_8049882(v7);
  v3 = 0;
  while ( v7 == dword_8048104 )
  {
    v5 = dword_80480FC;
    v6 = dword_8048100;
    sub_80483B9();
    if ( v7 <= 8 )
    {
      sub_80489E7(80);
      sub_8049882(v7);
      sub_80489E7(89);
      if ( v7 == 4 || v7 == 5 )
      {
        sub_8048EB7(v6);
      }
      else
      {
        sub_80489E7(v6);
        if ( v5 == 37 )
          sub_80489E7(146);
      }
    }
    else
    {
      v3 = sub_8048E56(v6, v3);
      sub_8049882(v7);
    }
  }
  result = v3 && v7 > 8;
  if ( result )
  {
    v4 = (unsigned __int16 *)sub_8048E56(v6, v3);
    sub_8048DE7(v6 ^ 1);
    sub_8048E1C(5);
    sub_8048D31(v4);
    result = sub_8048DE7(v6);
  }
  return result;
}
// 8049B2A: variable 'v6' is possibly undefined
// 8048100: using guessed type int dword_8048100;
// 8048104: using guessed type int dword_8048104;

//----- (08049BBD) --------------------------------------------------------
int sub_8049BBD()
{
  return sub_8049882(11);
}

//----- (08049BE5) --------------------------------------------------------
int sub_8049BE5()
{
  sub_8049BBD();
  return sub_8048E56(0, 0);
}

//----- (08049C29) --------------------------------------------------------
unsigned __int16 *__cdecl sub_8049C29(int *a1)
{
  unsigned __int16 *result; // eax
  int v2; // [esp+0h] [ebp-Ch]
  unsigned __int16 *v3; // [esp+0h] [ebp-Ch]
  unsigned __int16 *v4; // [esp+4h] [ebp-8h]
  int v5; // [esp+4h] [ebp-8h]
  unsigned __int16 *v6; // [esp+8h] [ebp-4h] BYREF

  if ( dword_80480FC == 288 )
  {
    sub_80483B9();
    sub_80483B9();
    v6 = (unsigned __int16 *)sub_8049BE5();
    sub_80483B9();
    sub_8049C29(a1);
    if ( dword_80480FC == 312 )
    {
      sub_80483B9();
      v4 = (unsigned __int16 *)sub_8048E1C(0);
      sub_8048D31(v6);
      sub_8049C29(a1);
      result = sub_8048D31(v4);
    }
    else
    {
      result = sub_8048D31(v6);
    }
  }
  else if ( dword_80480FC == 352 || dword_80480FC == 504 )
  {
    v2 = dword_80480FC;
    sub_80483B9();
    sub_80483B9();
    if ( v2 == 352 )
    {
      v5 = dword_8048118;
      v6 = (unsigned __int16 *)sub_8049BE5();
    }
    else
    {
      if ( dword_80480FC != 59 )
        sub_8049BBD();
      sub_80483B9();
      v5 = dword_8048118;
      v6 = 0;
      if ( dword_80480FC != 59 )
        v6 = (unsigned __int16 *)sub_8049BE5();
      sub_80483B9();
      if ( dword_80480FC != 41 )
      {
        v3 = (unsigned __int16 *)sub_8048E1C(0);
        sub_8049BBD();
        sub_8048E1C(v5 - dword_8048118 - 5);
        sub_8048D31(v3);
        v5 = (int)(v3 + 2);
      }
    }
    sub_80483B9();
    sub_8049C29((int *)&v6);
    sub_8048E1C(v5 - dword_8048118 - 5);
    result = sub_8048D31(v6);
  }
  else
  {
    switch ( dword_80480FC )
    {
      case 123:
        sub_80483B9();
        sub_804A170(1);
        while ( dword_80480FC != 125 )
          sub_8049C29(a1);
        break;
      case 448:
        sub_80483B9();
        if ( dword_80480FC != 59 )
          sub_8049BBD();
        dword_8048110 = sub_8048E1C(dword_8048110);
        break;
      case 400:
        sub_80483B9();
        *a1 = sub_8048E1C(*a1);
        break;
      default:
        if ( dword_80480FC != 59 )
          sub_8049BBD();
        break;
    }
    result = (unsigned __int16 *)sub_80483B9();
  }
  return result;
}
// 8048110: using guessed type int dword_8048110;
// 8048118: using guessed type int dword_8048118;

//----- (0804A170) --------------------------------------------------------
_BOOL4 __cdecl sub_804A170(int a1)
{
  _BOOL4 result; // eax
  int v2; // [esp+0h] [ebp-4h]
  int *v3; // [esp+0h] [ebp-4h]

  while ( 1 )
  {
    result = dword_80480FC == 256 || dword_80480FC != -1 && a1 == 0;
    if ( !result )
      break;
    if ( dword_80480FC == 256 )
    {
      sub_80483B9();
      while ( dword_80480FC != 59 )
      {
        if ( a1 )
        {
          dword_804811C += 4;
          *(_DWORD *)dword_80480FC = -dword_804811C;
        }
        else
        {
          *(_DWORD *)dword_80480FC = dest;
          dest += 4;
        }
        sub_80483B9();
        if ( dword_80480FC == 44 )
          sub_80483B9();
      }
      sub_80483B9();
    }
    else
    {
      *(_DWORD *)dword_80480FC = dword_8048118;
      sub_80483B9();
      sub_80483B9();
      v2 = 8;
      while ( dword_80480FC != 41 )
      {
        *(_DWORD *)dword_80480FC = v2;
        v2 += 4;
        sub_80483B9();
        if ( dword_80480FC == 44 )
          sub_80483B9();
      }
      sub_80483B9();
      dword_804811C = 0;
      dword_8048110 = 0;
      sub_80489E7(15042901);
      v3 = (int *)sub_8048D67(60545, 0);
      sub_8049C29(0);
      sub_8048D31((unsigned __int16 *)dword_8048110);
      sub_80489E7(50121);
      sub_8048A71(v3, dword_804811C);
    }
  }
  return result;
}
// 8048110: using guessed type int dword_8048110;
// 8048118: using guessed type int dword_8048118;
// 804811C: using guessed type int dword_804811C;

//----- (0804A46F) --------------------------------------------------------
char *__cdecl sub_804A46F(int a1)
{
  char *result; // eax

  sub_8048A71((int *)dest, a1);
  result = dest + 4;
  dest += 4;
  return result;
}

//----- (0804A4BA) --------------------------------------------------------
char *__cdecl sub_804A4BA(int a1, int a2)
{
  char *v3; // [esp+8h] [ebp+8h]

  sub_804A46F(a1);
  v3 = (char *)&dword_8048000 + a1;
  sub_804A46F((int)v3);
  sub_804A46F((int)v3);
  sub_804A46F(a2);
  return sub_804A46F(a2);
}
// 8048000: using guessed type int dword_8048000;

//----- (0804A570) --------------------------------------------------------
_BOOL4 __cdecl sub_804A570(int a1)
{
  _BOOL4 result; // eax
  _BOOL4 v4; // [esp+0h] [ebp-18h]
  int v5; // [esp+4h] [ebp-14h]
  int v6; // [esp+8h] [ebp-10h]
  unsigned __int16 *v7; // [esp+Ch] [ebp-Ch]
  char *src; // [esp+10h] [ebp-8h]
  unsigned __int16 *srca; // [esp+10h] [ebp-8h]
  char *v10; // [esp+14h] [ebp-4h]

  v6 = 0;
  v10 = haystack;
  while ( 1 )
  {
    src = ++v10;
    while ( *v10 != 32 && (int)v10 < dword_804812C )
      ++v10;
    result = v10 == (char *)dword_804812C;
    if ( v10 == (char *)dword_804812C )
      break;
    dword_80480FC = dword_804810C + 8 * (src - haystack) + 248;
    v5 = *(_DWORD *)dword_80480FC;
    v7 = *(unsigned __int16 **)(dword_804810C + 8 * (src - haystack) + 252);
    if ( v7 && v5 != 1 )
    {
      if ( v5 )
      {
        if ( !a1 )
          sub_8048B93(v7, v5);
      }
      else if ( a1 )
      {
        if ( a1 == 1 )
        {
          sub_804A46F(v6 + 22);
          sub_804A46F(0);
          sub_804A46F(0);
          sub_804A46F(16);
          v6 = &v10[v6] - src + 1;
        }
        else
        {
          ++v6;
          while ( v7 )
          {
            srca = (unsigned __int16 *)sub_8048AF6(v7);
            v4 = *((char *)v7 - 1) != 5;
            sub_8048A71((int *)v7, -4 * v4);
            sub_804A46F((int)dword_8048140 + (char *)v7 - (_BYTE *)dword_8048114 + dword_8048144);
            sub_804A46F((v6 << 8) + v4 + 1);
            v7 = srca;
          }
        }
      }
      else
      {
        memcpy(dest, src, v10 - src);
        dest = (char *)(&v10[(_DWORD)dest] - src + 1);
      }
    }
  }
  return result;
}
// 804810C: using guessed type int dword_804810C;
// 804812C: using guessed type int dword_804812C;
// 8048144: using guessed type int dword_8048144;

//----- (0804A9F0) --------------------------------------------------------
int __cdecl sub_804A9F0(char *filename)
{
  char *v1; // eax
  int v2; // eax
  int n; // [esp+0h] [ebp-24h]
  int s; // [esp+4h] [ebp-20h]
  FILE *sa; // [esp+4h] [ebp-20h]
  int v7; // [esp+8h] [ebp-1Ch]
  char *v8; // [esp+Ch] [ebp-18h]
  char *v9; // [esp+10h] [ebp-14h]
  char *v10; // [esp+14h] [ebp-10h]
  char *v11; // [esp+18h] [ebp-Ch]
  char *v12; // [esp+1Ch] [ebp-8h]
  char *v13; // [esp+20h] [ebp-4h]

  dword_8048140 = dest;
  n = dword_8048118 - (_DWORD)dword_8048114;
  dword_8048118 = (int)dword_8048114;
  sub_80489E7(5264472);
  sub_8048D67(232, *(_DWORD *)(dword_804810C + 592) - dword_8048118 - 5);
  sub_80489E7(50057);
  sub_8048DE7(1);
  sub_80489E7(32973);
  dest += n;
  v12 = dest++;
  v1 = strcpy(dest, src);
  dest = strcpy(v1 + 10, aLibdlSo2_0) + 11;
  sub_804A570(0);
  v11 = (char *)(dest - v12);
  dest = (char *)((unsigned int)(dest + 3) & 0xFFFFFFFC);
  v10 = dest;
  sub_804A46F(0);
  sub_804A46F(0);
  sub_804A46F(0);
  sub_804A46F(0);
  sub_804A570(1);
  v9 = dest;
  v7 = (dest - v10) / 16;
  sub_804A46F(1);
  sub_804A46F(v7);
  sub_804A46F(1);
  sub_804A46F(0);
  for ( s = 2; s < v7; ++s )
  {
    v2 = s;
    sub_804A46F(v2);
  }
  sub_804A46F(0);
  v8 = dest;
  sub_804A570(2);
  memcpy(dword_8048140, dword_8048114, n);
  v13 = dest;
  dest = (char *)ptr;
  sub_804A46F(1179403647);
  sub_804A46F(65793);
  sub_804A46F(0);
  sub_804A46F(0);
  sub_804A46F(196610);
  sub_804A46F(1);
  sub_804A46F((int)dword_8048140 + dword_8048144);
  sub_804A46F(48);
  sub_804A46F(0);
  sub_804A46F(0);
  sub_804A46F(2097204);
  sub_804A46F(3);
  sub_804A46F(3);
  sub_804A4BA(144, 19);
  sub_804A46F(4);
  sub_804A46F(1);
  sub_804A46F(1);
  sub_804A4BA(0, v13 - (_BYTE *)ptr);
  sub_804A46F(7);
  sub_804A46F(4096);
  sub_804A46F(2);
  sub_804A4BA(164, 88);
  sub_804A46F(6);
  sub_804A46F(4);
  dest = strcpy(dest, aLibLdLinuxSo2_0) + 20;
  sub_804A46F(1);
  sub_804A46F(1);
  sub_804A46F(1);
  sub_804A46F(11);
  sub_804A46F(4);
  sub_804A46F((int)&v9[dword_8048144]);
  sub_804A46F(6);
  sub_804A46F((int)&v10[dword_8048144]);
  sub_804A46F(5);
  sub_804A46F((int)&v12[dword_8048144]);
  sub_804A46F(10);
  sub_804A46F((int)v11);
  sub_804A46F(11);
  sub_804A46F(16);
  sub_804A46F(17);
  sub_804A46F((int)&v8[dword_8048144]);
  sub_804A46F(18);
  sub_804A46F(v13 - v8);
  sub_804A46F(19);
  sub_804A46F(8);
  sub_804A46F(0);
  sub_804A46F(0);
  sa = fopen(filename, modes);
  fwrite(ptr, 1u, v13 - (_BYTE *)ptr, sa);
  return fclose(sa);
}
// 804810C: using guessed type int dword_804810C;
// 8048118: using guessed type int dword_8048118;
// 8048144: using guessed type int dword_8048144;

//----- (0804B4A3) --------------------------------------------------------
int __cdecl sub_804B4A3(int a1, int a2)
{
  int v3; // [esp+Ch] [ebp+Ch]

  if ( a1 >= 3 )
  {
    haystack = (char *)calloc(1u, 0x1869Fu);
    dword_804812C = (int)(strcpy(haystack, aIntIfElseWhile) + 48);
    ptr = calloc(1u, 0x1869Fu);
    dest = (char *)ptr;
    dword_8048114 = calloc(1u, 0x1869Fu);
    dword_8048118 = (int)dword_8048114;
    dword_804810C = (int)calloc(1u, 0x1869Fu);
    v3 = a2 + 4;
    stream = fopen(*(const char **)v3, aR);
    dword_8048144 = (char *)&dword_8048000 - (_BYTE *)ptr;
    dest += 252;
    dword_8048118 += 17;
    sub_8048283();
    sub_80483B9();
    sub_804A170(0);
    sub_804A9F0(*(char **)(v3 + 4));
  }
  else
  {
    printf("usage: otccelf file.c outfile\n");
  }
  return 0;
}
// 8048000: using guessed type int dword_8048000;
// 804810C: using guessed type int dword_804810C;
// 8048118: using guessed type int dword_8048118;
// 804812C: using guessed type int dword_804812C;
// 8048144: using guessed type int dword_8048144;

// nfuncs=41 queued=28 decompiled=28 lumina nreq=0 worse=0 better=0
// ALL OK, 28 function(s) have been successfully decompiled
