/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <math.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int sub_804831C();
// void __assert_fail(const char *assertion, const char *file, unsigned int line, const char *function);
// int printf(const char *format, ...);
void integer_sqrt_in_asm();
unsigned int __cdecl integer_sqrt_in_c(unsigned int n);
unsigned int __cdecl integer_sqrt_in_c_cleaned_up(unsigned int n);
int __cdecl main(int argc, const char **argv, const char **envp);

//-------------------------------------------------------------------------
// Data declarations

int (*dword_8049DFC)(void) = NULL; // weak


//----- (0804831C) --------------------------------------------------------
int sub_804831C()
{
  return dword_8049DFC();
}
// 8049DFC: using guessed type int (*dword_8049DFC)(void);

//----- (08048424) --------------------------------------------------------
void integer_sqrt_in_asm()
{
  ;
}

//----- (080487B0) --------------------------------------------------------
unsigned int __cdecl integer_sqrt_in_c(unsigned int n)
{
  unsigned int result; // eax
  unsigned int v2; // ebx
  unsigned int v3; // edx
  _BOOL2 v4; // si
  unsigned __int16 v5; // si
  unsigned int v6; // kr00_4
  __int16 v7; // si
  __int16 v8; // si
  unsigned __int16 v9; // si
  int v10; // kr08_4
  _BOOL2 v11; // si
  unsigned __int16 cf_0; // [esp+2h] [ebp-1Ah]
  unsigned __int16 bx_0a; // [esp+6h] [ebp-16h]
  unsigned __int16 bx_0; // [esp+6h] [ebp-16h]
  int i; // [esp+8h] [ebp-14h]
  int cx_0; // [esp+Ch] [ebp-10h]
  unsigned __int16 cx_0a; // [esp+Ch] [ebp-10h]
  __int16 v18; // [esp+Eh] [ebp-Eh]
  __int16 v19; // [esp+Eh] [ebp-Eh]

  LOWORD(result) = 0;
  i = 0;
  cx_0 = 0;
  v2 = n;
  v3 = HIWORD(n);
  while ( 1 )
  {
    v9 = result + ((unsigned __int16)v3 <= 0x3FFFu);
    cf_0 = (unsigned __int16)cx_0 < v9;
    v10 = cx_0 - v9;
    LOWORD(cx_0) = HIWORD(v10);
    bx_0 = v10;
    if ( cf_0 <= HIWORD(cx_0) )
    {
      LOWORD(v3) = v3 - 0x4000;
      v4 = 0;
    }
    else
    {
      bx_0 = v9 + v10;
      v11 = __CFADD__(v9, (_WORD)v10);
      cx_0a = v11 + HIWORD(v10);
      v4 = __CFADD__(v11, HIWORD(v10));
    }
    ++i;
    LOWORD(result) = 2 * result + 1 - v4;
    if ( i == 16 )
      break;
    v5 = 2 * v2;
    v18 = v3 + ((unsigned __int16)v2 > (unsigned __int16)(2 * v2)) + v3;
    v6 = __PAIR32__(bx_0, v3 + ((unsigned __int16)v2 > (unsigned __int16)(2 * v2))) + (unsigned __int16)v3;
    v2 *= 4;
    v7 = v18 + (v5 > (unsigned __int16)v2);
    bx_0a = HIWORD(v6) + bx_0;
    LOWORD(v3) = v7 + v18;
    v19 = bx_0a + __CFADD__(v7, v18);
    v8 = (bx_0a < HIWORD(v6)) + 2 * cx_0a;
    LOWORD(cx_0) = v19 + bx_0a;
    HIWORD(cx_0) = __CFADD__(v19, bx_0a) + 2 * v8;
  }
  return (unsigned __int16)result;
}

//----- (08048910) --------------------------------------------------------
unsigned int __cdecl integer_sqrt_in_c_cleaned_up(unsigned int n)
{
  unsigned int v1; // ecx
  unsigned int result; // eax
  int v3; // edi
  unsigned int v5; // esi
  unsigned __int64 v6; // kr08_8
  unsigned __int64 cmp; // [esp+10h] [ebp-18h]

  v1 = 0;
  result = 0;
  v3 = 0;
  while ( 1 )
  {
    v5 = (__PAIR64__((unsigned __int16)result, 0) + 0x40000000) >> 32;
    result *= 2;
    HIDWORD(cmp) = v5;
    HIWORD(v5) = HIWORD(n);
    LOWORD(v5) = 0;
    LODWORD(cmp) = 0x40000000;
    if ( __PAIR64__(HIDWORD(cmp), 0x40000000) <= __PAIR64__(v1, v5) )
    {
      ++result;
      v6 = __PAIR64__(v1, n) - cmp;
      v1 = (__PAIR64__(v1, n) - cmp) >> 32;
      n = v6;
    }
    if ( ++v3 == 16 )
      break;
    v1 = __PAIR64__(v1, n) >> 30;
    n *= 4;
  }
  return (unsigned __int16)result;
}

//----- (08048990) --------------------------------------------------------
int __cdecl main(int argc, const char **argv, const char **envp)
{
  int v3; // eax
  int v4; // ecx
  __int64 v5; // rax
  unsigned int v6; // ebx
  unsigned __int64 v7; // kr00_8
  int v8; // ebx
  int v9; // esi
  int v11; // [esp+2Ch] [ebp-44h]
  int v12; // [esp+30h] [ebp-40h]
  int v13; // [esp+34h] [ebp-3Ch]
  int v14; // [esp+38h] [ebp-38h]
  unsigned int v15; // [esp+3Ch] [ebp-34h]

  v12 = 1000;
  v15 = 0;
  do
  {
    integer_sqrt_in_asm();
    v13 = v3;
    v5 = integer_sqrt_in_c(v15);
    v4 = 0;
    v14 = v5;
    LODWORD(v5) = v15;
    v11 = 0;
    while ( 1 )
    {
      HIWORD(v6) = WORD1(v5);
      v7 = __PAIR64__((unsigned __int16)v4, 0) + 0x40000000;
      LOWORD(v6) = 0;
      v4 *= 2;
      if ( v7 <= __PAIR64__(HIDWORD(v5), v6) )
      {
        ++v4;
        v5 -= v7;
      }
      if ( ++v11 == 16 )
        break;
      v5 *= 4LL;
    }
    v8 = (unsigned __int16)v4;
    v9 = (int)sqrt((long double)v15);
    printf("f(%3u) = %d | c1=%d | c2=%d | using-float=%d\n", v15, v13, v14, (unsigned __int16)v4, v9);
    if ( v9 != v13 )
      __assert_fail("check == y", "source/main.c", 0x4Fu, "main");
    if ( v14 != v13 )
      __assert_fail("check == c1", "source/main.c", 0x50u, "main");
    if ( v14 != v8 )
      __assert_fail("check == c2", "source/main.c", 0x51u, "main");
    ++v15;
    --v12;
  }
  while ( v12 );
  return 0;
}
// 80489BD: variable 'v3' is possibly undefined

// nfuncs=22 queued=5 decompiled=5 lumina nreq=0 worse=0 better=0
// ALL OK, 5 function(s) have been successfully decompiled
