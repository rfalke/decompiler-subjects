// subject_bss.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

FILE * stdout = null; // 0000000000411058
byte g_b411060 = 0x00; // 0000000000411060
struct Eq_186 * g_a411068[] = // 0000000000411068
	{
	};
int32 g_dw411080 = 0; // 0000000000411080
// subject_fini.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0000000000400C5C: void _fini()
void _fini()
{
}

// subject_got.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word64 g_qw410FE0 = 0x00; // 0000000000410FE0
// subject_init.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0000000000400598: Register word64 _init(Register out ptr64 x30Out)
// Called from:
//      __libc_csu_init
word64 _init(ptr64 & x30Out)
{
	call_weak_fn();
	x30Out = qwArg00;
	return x30;
}

// subject_init_array.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * g_a410DE0[] = // 0000000000410DE0
	{
	};
// subject_jcr.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word64 g_qw410DF0 = 0x00; // 0000000000410DF0
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0000000000400660: void _start(Register (ptr64 Eq_9) x0, Stack word32 dwArg00)
void _start(void (* x0)(), word32 dwArg00)
{
	x0_14 = (uint64) __libc_start_main(g_ptr400690, (int32) qwArg00, (char *) fp + 8, g_ptr400698, g_ptr4006A0, x0, fp);
	abort();
}

int32 (* g_ptr400690)(int32 x0, char ** x1, char ** x2) = main; // 0000000000400690
void (* g_ptr400698)() = __libc_csu_init; // 0000000000400698
void (* g_ptr4006A0)() = __libc_csu_fini; // 00000000004006A0
// 00000000004006A8: void call_weak_fn()
// Called from:
//      _init
void call_weak_fn()
{
	if (g_qw410FE0 == 0x00)
		return;
	__gmon_start__();
}

// 00000000004006C0: void deregister_tm_clones()
// Called from:
//      __do_global_dtors_aux
void deregister_tm_clones()
{
	if (0x0041105F - 4264024 <= 0x0E)
		return;
	<anonymous> * x1_12 = g_ptr4006F8;
	if (x1_12 == null)
		return;
	x1_12();
}

<anonymous> * g_ptr4006F8 = null; // 00000000004006F8
// 0000000000400700: void register_tm_clones()
// Called from:
//      frame_dummy
void register_tm_clones()
{
	int64 x1_7 = 4264024 - 4264024;
	if ((x1_7 >> 3) + ((x1_7 >> 3) >>u 63) >> 1 == 0x00)
		return;
	<anonymous> * x2_12 = g_ptr400738;
	if (x2_12 == null)
		return;
	word64 x2_16;
	x2_12();
}

<anonymous> * g_ptr400738 = null; // 0000000000400738
// 0000000000400740: void __do_global_dtors_aux()
void __do_global_dtors_aux()
{
	if ((word32) g_b411060 == 0x00)
	{
		deregister_tm_clones();
		g_b411060 = 0x01;
	}
}

// 0000000000400770: void frame_dummy(Register word64 x29, Register word64 x30)
void frame_dummy(word64 x29, word64 x30)
{
	if (g_qw410DF0 != 0x00 && g_qw4007A8 != 0x00)
	{
		fn0000000000000000();
		register_tm_clones();
	}
	else
		register_tm_clones();
}

word64 g_qw4007A8 = 0x00; // 00000000004007A8
// 00000000004007B0: Register word64 new_tower(Register int32 w0)
// Called from:
//      main
word64 new_tower(int32 w0)
{
	ptr64 * x0_19 = calloc((size_t) 0x00, (size_t) ((word64) w0 << 2));
	*x0_19 = x0_19 + 2;
	return x30;
}

// 00000000004007FC: Register int32 text(Register word32 w0, Register int32 w1, Register ui32 w2, Register out ptr64 x29Out, Register out ptr64 x30Out)
// Called from:
//      add_disk
//      remove_disk
//      main
int32 text(word32 w0, int32 w1, ui32 w2, ptr64 & x29Out, ptr64 & x30Out)
{
	word32 w0_24 = g_dw411080 - w0;
	ui32 dwLoc14_66 = w2;
	char * x1_36 = SEQ(x1_32_32, w0_24 + 0x01);
	x0_39 = (uint64) printf("\x1B[%d;%dH", w0_24 + 0x01, (g_dw411080 + 0x01) * ((w1 << 1) + 0x01) - w2);
	word64 * sp_40 = fp - 0x30 + 8;
	while (true)
	{
		--dwLoc14_66;
		if (dwLoc14_66 == 0x00)
			break;
		x1_36 = *sp_40;
		sp_40 += -1;
		*sp_40 = (word64) printf("%s", x1_36);
	}
	x29Out = x30;
	x30Out = qwArg00;
	return (word32) x1_36;
}

// 0000000000400894: Register uint64 add_disk(Register word32 w0, Register int32 w1, Register out (ptr64 Eq_185) x29Out)
// Called from:
//      move
//      main
uint64 add_disk(word32 w0, int32 w1, struct Eq_185 & x29Out)
{
	struct Eq_186 * x9_25 = *((char *) g_a411068 + (word64) w0 * 0x00);
	word32 w1_26 = x9_25->dw0008;
	x9_25->dw0008 = w1_26 + 0x01;
	*((char *) **((char *) g_a411068 + (word64) w0 * 0x00) + (int64) w1_26 * 0x00) = (struct Eq_186 **) w1;
	word64 x29_56;
	word64 x30_57;
	struct Eq_215 * sp_61;
	struct Eq_185 ** x29_62;
	word64 x0_66;
	usleep();
	FILE * x8_75 = stdout;
	sp_61->dw0004 = (word32) x0_66;
	uint64 x0_79 = (uint64) fflush(x8_75);
	sp_61->dwFFFFFFF8 = (word32) x0_79;
	x29Out = (struct Eq_185 *) *x29_62;
	return x0_79;
}

// 0000000000400964: Register int32 remove_disk(Register int32 w0)
// Called from:
//      move
int32 remove_disk(int32 w0)
{
	struct Eq_241 * x9_22 = *((char *) g_a411068 + (word64) w0 * 0x00);
	word32 w0_23 = x9_22->dw0008;
	x9_22->dw0008 = w0_23 - 0x01;
	word64 x29_55;
	word64 x30_73;
	text((char *) *((char *) *((char *) g_a411068 + (word64) w0 * 0x00) + 8) + 1, w0, *((char *) **((char *) g_a411068 + (word64) w0 * 0x00) + (int64) (w0_23 - 0x01) * 0x00), out x29_55, out x30_73);
	struct Eq_286 * sp_50 = (struct Eq_286 *) <invalid>;
	return sp_50->dw0008;
}

// 0000000000400A10: Register word64 move(Register int32 w0)
// Called from:
//      move
//      main
word64 move(int32 w0)
{
	int32 w0 = (word32) x0;
	struct Eq_295 * x29_71 = fp + -8;
	if (w0 != 0x00)
	{
		struct Eq_295 * x29_26 = move(w0);
		struct Eq_286 * sp_25 = (struct Eq_286 *) <invalid>;
		int32 w8_34 = x29_26->dwFFFFFFF8;
		sp_25->dw000C = x29_26->dwFFFFFFF4;
		struct Eq_286 * sp_37 = (struct Eq_286 *) <invalid>;
		int32 w0_49 = remove_disk(w8_34);
		word32 w8_48 = sp_37->dw000C;
		sp_37->dw0008 = w0_49;
		word64 x29_135;
		add_disk(w8_48, sp_37->dw0008, out x29_135);
		x29_71 = move(w0);
	}
	return x29_71->qw0000;
}

// 0000000000400A9C: void main(Register int32 w0)
void main(int32 w0)
{
	struct Eq_342 * x29_105 = fp + -8;
	word32 x0_32_32_137 = SLICE((uint64) puts("\x1B[H\x1B[J"), word32, 32);
	if (w0 > 0x01)
	{
		uint64 x0_28 = (uint64) atoi(qwLoc20->ptr0008);
		int32 w0_32 = (word32) x0_28;
		g_dw411080 = w0_32;
		x0_32_32_137 = SLICE(x0_28, word32, 32);
		if (w0_32 > 0x00)
		{
l0000000000400B04:
			while (x29_105->dwFFFFFFF8 < 0x03)
			{
				int32 w0_115 = g_dw411080;
				x29_105 = new_tower(w0_115);
				*((char *) g_a411068 + (word64) x29_105->dwFFFFFFF8 * 0x00) = SEQ(x0_32_32_137, w0_115);
				++x29_105->dwFFFFFFF8;
			}
			x29_105->dwFFFFFFF8 = g_dw411080;
			while (x29_105->dwFFFFFFF8 != 0x00)
			{
				add_disk(0x00, x29_105->dwFFFFFFF8, out x29_105);
				--x29_105->dwFFFFFFF8;
			}
			move(g_dw411080);
			struct Eq_286 * sp_64 = (struct Eq_286 *) <invalid>;
			sp_64->dw0008 = 0x00;
			word64 x30_181;
			word64 x29_180;
			text(0x01, sp_64->dw0008, 0x01, out x29_180, out x30_181);
			return;
		}
	}
	g_dw411080 = 0x08;
	goto l0000000000400B04;
}

// 0000000000400BE0: void __libc_csu_init(Register word32 w0, Register word64 x1, Register word64 x2, Register word64 x24)
void __libc_csu_init(word32 w0, word64 x1, word64 x2, word64 x24)
{
	word32 x24_32_32_100 = SLICE(x24, word32, 32);
	int64 x20_26 = 4263400 - 0x00410DE0;
	<anonymous> * x21_24[] = g_a410DE0;
	word64 x22_34 = x2;
	word64 x23_38 = x1;
	word64 x30_42;
	word64 x29_41 = _init(out x30_42);
	int64 x20_43 = x20_26 >> 3;
	if (x20_26 >> 3 != 0x00)
	{
		int64 x19_44 = 0x00;
		word64 x24_145 = SEQ(x24_32_32_100, w0);
		do
		{
			word64 x3_74;
			x21_24[x19_44]();
			int64 x31_77 = x20_43 - x19_44;
		} while (x31_77 != 0x00);
	}
}

// 0000000000400C58: void __libc_csu_fini()
void __libc_csu_fini()
{
}

