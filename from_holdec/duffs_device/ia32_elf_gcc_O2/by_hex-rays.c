/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int init_proc();
int sub_80482C4();
// int __gmon_start__(void); weak
// int __cdecl __libc_start_main(int (__cdecl *main)(int, char **, char **), int argc, char **ubp_av, void (*init)(void), void (*fini)(void), void (*rtld_fini)(void), void *stack_end);
// void *malloc(size_t size);
// void __usercall __noreturn start(int a1@<eax>, void (*a2)(void)@<edx>);
void _do_global_dtors_aux();
int frame_dummy();
void __cdecl copy1_four_times(__int16 *to, __int16 *from, int count);
void __cdecl copy1_eight_times(__int16 *to, __int16 *from, int count);
void __cdecl copy2_four_times(__int16 *to, __int16 *from, int n);
void __cdecl copy2_eight_times(__int16 *to, __int16 *from, int n);
int __cdecl main(int argc, const char **argv, const char **envp);
void _libc_csu_fini(void); // idb
void _libc_csu_init(void); // idb
void (*_do_global_ctors_aux())(void);
void term_proc();

//-------------------------------------------------------------------------
// Data declarations

int _CTOR_LIST__ = -1; // weak
int _DTOR_LIST__[] = { -1 }; // weak
int _DTOR_END__ = 0; // weak
int _JCR_LIST__ = 0; // weak
int (*dword_804997C)(void) = NULL; // weak
char completed_5978; // weak
int dtor_idx_5980; // weak
// extern _UNKNOWN _gmon_start__; weak


//----- (08048294) --------------------------------------------------------
int init_proc()
{
  int v1; // [esp+0h] [ebp-8h]

  if ( &_gmon_start__ )
    __gmon_start__();
  frame_dummy();
  _do_global_ctors_aux();
  return v1;
}
// 80482C0: variable 'v1' is possibly undefined
// 80482D4: using guessed type int __gmon_start__(void);

//----- (080482C4) --------------------------------------------------------
int sub_80482C4()
{
  return dword_804997C();
}
// 804997C: using guessed type int (*dword_804997C)(void);

//----- (08048310) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn start(int a1@<eax>, void (*a2)(void)@<edx>)
{
  int v2; // esi
  int v3; // [esp-4h] [ebp-4h] BYREF
  char *retaddr; // [esp+0h] [ebp+0h] BYREF

  v2 = v3;
  v3 = a1;
  __libc_start_main((int (__cdecl *)(int, char **, char **))main, v2, &retaddr, _libc_csu_init, _libc_csu_fini, a2, &v3);
  __halt();
}
// 8048313: positive sp value 4 has been found

//----- (08048340) --------------------------------------------------------
void _do_global_dtors_aux()
{
  int v0; // eax
  unsigned int i; // ebx

  if ( !completed_5978 )
  {
    v0 = dtor_idx_5980;
    for ( i = &_DTOR_END__ - _DTOR_LIST__ - 1; dtor_idx_5980 < i; v0 = dtor_idx_5980 )
    {
      dtor_idx_5980 = v0 + 1;
      ((void (*)(void))_DTOR_LIST__[v0 + 1])();
    }
    completed_5978 = 1;
  }
}
// 804989C: using guessed type int _DTOR_LIST__[];
// 80498A0: using guessed type int _DTOR_END__;
// 8049990: using guessed type char completed_5978;
// 8049994: using guessed type int dtor_idx_5980;

//----- (080483A0) --------------------------------------------------------
int frame_dummy()
{
  int result; // eax

  result = _JCR_LIST__;
  if ( _JCR_LIST__ )
    result = 0;
  return result;
}
// 80498A4: using guessed type int _JCR_LIST__;

//----- (080483D0) --------------------------------------------------------
void __cdecl copy1_four_times(__int16 *to, __int16 *from, int count)
{
  __int16 *v3; // ecx
  __int16 *v4; // edx
  int v5; // ebx
  int v6; // eax
  int v7; // ebx
  __int16 v8; // ax
  __int16 v9; // ax
  __int16 *v10; // edx
  __int16 v11; // ax
  _WORD *v12; // ecx

  v3 = to;
  v4 = from;
  v5 = count + 3;
  if ( count + 3 < 0 )
    v5 = count + 6;
  v6 = count % 4;
  v7 = v5 >> 2;
  if ( count % 4 == 1 )
    goto LABEL_10;
  if ( v6 <= 1 )
  {
    if ( !v6 )
      goto LABEL_12;
  }
  else
  {
    if ( v6 != 2 )
    {
      if ( v6 != 3 )
        return;
      v4 = from + 1;
      *to = *from;
      v3 = to + 1;
    }
    while ( 1 )
    {
      v8 = *v4++;
      *v3++ = v8;
LABEL_10:
      --v7;
      *v3 = *v4;
      if ( v7 <= 0 )
        break;
      ++v3;
      ++v4;
LABEL_12:
      v9 = *v4;
      v10 = v4 + 1;
      *v3 = v9;
      v11 = *v10;
      v12 = v3 + 1;
      v4 = v10 + 1;
      *v12 = v11;
      v3 = v12 + 1;
    }
  }
}

//----- (08048470) --------------------------------------------------------
void __cdecl copy1_eight_times(__int16 *to, __int16 *from, int count)
{
  int v5; // ebx
  int v6; // ebx
  __int16 v7; // cx
  __int16 v8; // cx
  __int16 v9; // cx
  __int16 v10; // cx
  __int16 v11; // cx
  __int16 v12; // cx
  __int16 v13; // cx

  v5 = count + 7;
  if ( count + 7 < 0 )
    v5 = count + 14;
  v6 = v5 >> 3;
  switch ( count % 8 )
  {
    case 0:
      goto LABEL_14;
    case 1:
      goto LABEL_12;
    case 2:
      goto LABEL_11;
    case 3:
      goto LABEL_10;
    case 4:
      goto LABEL_9;
    case 5:
      goto LABEL_8;
    case 6:
      goto LABEL_7;
    case 7:
      while ( 1 )
      {
        v7 = *from++;
        *to++ = v7;
LABEL_7:
        v8 = *from++;
        *to++ = v8;
LABEL_8:
        v9 = *from++;
        *to++ = v9;
LABEL_9:
        v10 = *from++;
        *to++ = v10;
LABEL_10:
        v11 = *from++;
        *to++ = v11;
LABEL_11:
        v12 = *from++;
        *to++ = v12;
LABEL_12:
        --v6;
        *to = *from;
        if ( v6 <= 0 )
          break;
        ++to;
        ++from;
LABEL_14:
        v13 = *from++;
        *to++ = v13;
      }
      break;
    default:
      return;
  }
}

//----- (08048520) --------------------------------------------------------
void __cdecl copy2_four_times(__int16 *to, __int16 *from, int n)
{
  int v5; // ecx
  __int16 v6; // bx
  __int16 v7; // bx
  __int16 v8; // bx

  if ( n > 0 )
  {
    v5 = 4 - n;
    while ( 1 )
    {
      if ( v5 != 2 )
      {
        if ( v5 == 3 )
          goto DUFF_3;
        if ( v5 != 1 )
        {
          v6 = *from++;
          *to++ = v6;
        }
        v7 = *from++;
        *to++ = v7;
      }
      v8 = *from++;
      *to++ = v8;
DUFF_3:
      v5 += 4;
      *to = *from;
      if ( v5 == ((n - 4) & 0xFFFFFFFC) + 8 - n )
        return;
      ++to;
      ++from;
    }
  }
}

//----- (080485A0) --------------------------------------------------------
void __cdecl copy2_eight_times(__int16 *to, __int16 *from, int n)
{
  int v5; // ecx
  __int16 v6; // bx
  __int16 v7; // bx
  __int16 v8; // bx
  __int16 v9; // bx
  __int16 v10; // bx
  __int16 v11; // bx
  __int16 v12; // bx

  if ( n > 0 )
  {
    v5 = 8 - n;
    while ( 1 )
    {
      switch ( v5 )
      {
        case 1:
          goto DUFF_1;
        case 2:
          goto DUFF_2;
        case 3:
          goto DUFF_3;
        case 4:
          goto DUFF_4;
        case 5:
          goto DUFF_5;
        case 6:
          goto DUFF_6;
        case 7:
          goto DUFF_7;
        default:
          v6 = *from++;
          *to++ = v6;
DUFF_1:
          v7 = *from++;
          *to++ = v7;
DUFF_2:
          v8 = *from++;
          *to++ = v8;
DUFF_3:
          v9 = *from++;
          *to++ = v9;
DUFF_4:
          v10 = *from++;
          *to++ = v10;
DUFF_5:
          v11 = *from++;
          *to++ = v11;
DUFF_6:
          v12 = *from++;
          *to++ = v12;
DUFF_7:
          v5 += 8;
          *to = *from;
          if ( v5 == ((n - 8) & 0xFFFFFFF8) + 16 - n )
            return;
          ++to;
          ++from;
          break;
      }
    }
  }
}

//----- (08048650) --------------------------------------------------------
int __cdecl main(int argc, const char **argv, const char **envp)
{
  __int16 *v3; // esi
  __int16 *v4; // edi

  v3 = (__int16 *)malloc(0xC8u);
  v4 = (__int16 *)malloc(0xC8u);
  copy1_four_times(v4, v3, 100);
  copy1_eight_times(v4, v3, 100);
  copy2_four_times(v4, v3, 100);
  copy2_eight_times(v4, v3, 100);
  return memcmp(v3, v4, 0xC8u) != 0;
}

//----- (080486F0) --------------------------------------------------------
void _libc_csu_fini(void)
{
  ;
}

//----- (08048700) --------------------------------------------------------
void _libc_csu_init(void)
{
  init_proc();
}

//----- (08048760) --------------------------------------------------------
void (*_do_global_ctors_aux())(void)
{
  void (*result)(void); // eax
  void (**v1)(void); // ebx

  result = (void (*)(void))_CTOR_LIST__;
  if ( _CTOR_LIST__ != -1 )
  {
    v1 = (void (**)(void))&_CTOR_LIST__;
    do
    {
      --v1;
      result();
      result = *v1;
    }
    while ( *v1 != (void (*)(void))-1 );
  }
  return result;
}
// 8049894: using guessed type int _CTOR_LIST__;

//----- (0804878C) --------------------------------------------------------
void term_proc()
{
  _do_global_dtors_aux();
}

// nfuncs=21 queued=14 decompiled=14 lumina nreq=0 worse=0 better=0
// ALL OK, 14 function(s) have been successfully decompiled
