/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int init_proc();
int sub_80487A4();
// void glEnable(GLenum cap);
// void glEnableClientState(GLenum cap);
// void glMatrixMode(GLenum mode);
// int __gmon_start__(void); weak
// void glClear(GLbitfield mask);
// int __cdecl SDL_ShowCursor(_DWORD); weak
// int __cdecl SDL_PollEvent(_DWORD); weak
// int __cdecl __libc_start_main(int (__cdecl *main)(int, char **, char **), int argc, char **ubp_av, void (*init)(void), void (*fini)(void), void (*rtld_fini)(void), void *stack_end);
// int SDL_GL_SwapBuffers(void); weak
// void glLoadIdentity(void);
// void glClearColor(GLclampf red, GLclampf green, GLclampf blue, GLclampf alpha);
// int __cdecl SDL_SetVideoMode(_DWORD, _DWORD, _DWORD, _DWORD); weak
// void glNormalPointer(GLenum type, GLsizei stride, const GLvoid *ptr);
// int __stdcall SDL_Init(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); weak
// void *memcpy(void *dest, const void *src, size_t n);
// float cosf(float x);
// void glOrtho(GLdouble left, GLdouble right, GLdouble bottom, GLdouble top, GLdouble near_val, GLdouble far_val);
// void glDrawElements(GLenum mode, GLsizei count, GLenum type, const GLvoid *indices);
// void glColor4f(GLfloat red, GLfloat green, GLfloat blue, GLfloat alpha);
// void glRotatef(GLfloat angle, GLfloat x, GLfloat y, GLfloat z);
// void glLightfv(GLenum light, GLenum pname, const GLfloat *params);
// void glPushMatrix(void);
// float sinf(float x);
// int SDL_Quit(void); weak
// void glVertexPointer(GLint size, GLenum type, GLsizei stride, const GLvoid *ptr);
// void glPopMatrix(void);
// void __usercall __noreturn start(int a1@<eax>, void (*a2)(void)@<edx>);
void sub_8048990();
int frame_dummy();
void __cdecl sub_80489E4(float a1, float a2, float a3, float a4, float a5, float a6, int a7, int a8, int a9);
void sub_804908A();
int __cdecl main(int a1);
void fini(void); // idb
void init(void); // idb
void sub_804940A();
void (*sub_8049410())(void);
void term_proc();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN unk_8049460; // weak
int dword_804A000 = -1; // weak
int dword_804A010 = 0; // weak
int (*dword_804A110)(void) = NULL; // weak
int *off_804A184 = &dword_804A00C; // weak
char byte_804A188; // weak
int dword_804A18C; // weak
GLsizei count; // idb
int dword_804A194; // weak
int dword_804A198[]; // weak
int dword_804A19C[]; // weak
int dword_804A1A0[]; // weak
int dword_804A1A4[]; // weak
int dword_804A1A8[]; // weak
int dword_804A1AC[]; // weak
int dword_804A1B0[]; // weak
int dword_804A1B4[]; // weak
int dword_804A1B8[]; // weak
int dword_804A1BC[]; // weak
int dword_804A1C0[]; // weak
int dword_804A1C4[]; // weak
int dword_804A1C8[]; // weak
int dword_804A1CC[]; // weak
int dword_804A1D0[]; // weak
int dword_804A1D4[59985]; // idb
int dword_8084B18[]; // weak
int dword_8084B1C; // weak
int dword_8084B20; // weak
int dword_8084B24; // weak
int dword_8084B28; // weak
int dword_8084B2C; // weak
int dword_8084B30; // weak
int dword_8084B34; // weak
int dword_8084B38; // weak
int dword_8084B3C; // weak
int dword_8084B40; // weak
int dword_8084B44; // weak
_UNKNOWN unk_80D2D18; // weak
// extern _UNKNOWN _gmon_start__; weak


//----- (08048774) --------------------------------------------------------
int init_proc()
{
  int v1; // [esp+0h] [ebp-8h]

  if ( &_gmon_start__ )
    __gmon_start__();
  frame_dummy();
  sub_8049410();
  return v1;
}
// 80487A0: variable 'v1' is possibly undefined
// 80487E4: using guessed type int __gmon_start__(void);

//----- (080487A4) --------------------------------------------------------
int sub_80487A4()
{
  return dword_804A110();
}
// 804A110: using guessed type int (*dword_804A110)(void);

//----- (08048960) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn start(int a1@<eax>, void (*a2)(void)@<edx>)
{
  int v2; // esi
  int v3; // [esp-4h] [ebp-4h] BYREF
  char *retaddr; // [esp+0h] [ebp+0h] BYREF

  v2 = v3;
  v3 = a1;
  __libc_start_main((int (__cdecl *)(int, char **, char **))main, v2, &retaddr, init, fini, a2, &v3);
  __halt();
}
// 8048963: positive sp value 4 has been found

//----- (08048990) --------------------------------------------------------
void sub_8048990()
{
  void (*v0)(void); // edx

  if ( !byte_804A188 )
  {
    while ( 1 )
    {
      v0 = (void (*)(void))*off_804A184;
      if ( !*off_804A184 )
        break;
      ++off_804A184;
      v0();
    }
    byte_804A188 = 1;
  }
}
// 804A184: using guessed type int *off_804A184;
// 804A188: using guessed type char byte_804A188;

//----- (080489C0) --------------------------------------------------------
int frame_dummy()
{
  int result; // eax

  result = dword_804A010;
  if ( dword_804A010 )
    result = 0;
  return result;
}
// 804A010: using guessed type int dword_804A010;

//----- (080489E4) --------------------------------------------------------
void __cdecl sub_80489E4(float a1, float a2, float a3, float a4, float a5, float a6, int a7, int a8, int a9)
{
  long double v9; // fst7
  int v10; // eax
  int *v11; // esi
  float *v12; // ebx
  int v13; // edi
  long double v14; // fst7
  long double v15; // fst7
  long double v16; // fst7
  long double v17; // fst6
  long double v18; // fst5
  long double v19; // fst7
  long double v20; // fst7
  long double v21; // fst5
  int v22; // edx
  unsigned int v23; // ecx
  int *v24; // esi
  float *v25; // ebx
  int v26; // edi
  long double v27; // fst7
  long double v28; // fst7
  long double v29; // fst7
  long double v30; // fst6
  long double v31; // fst5
  long double v32; // fst7
  long double v33; // fst7
  long double v34; // fst5
  int v35; // eax
  GLsizei v36; // ecx
  GLsizei v37; // edx
  int v38; // ebx
  int i; // esi
  float v40; // [esp-24h] [ebp-16Ch]
  float v41; // [esp-20h] [ebp-168h]
  float v42; // [esp-20h] [ebp-168h]
  unsigned int v43; // [esp+4h] [ebp-144h]
  unsigned int v44; // [esp+1Ch] [ebp-12Ch]
  float v45; // [esp+3Ch] [ebp-10Ch]
  float v46; // [esp+40h] [ebp-108h]
  float v47; // [esp+44h] [ebp-104h]
  float v48; // [esp+48h] [ebp-100h]
  float v49; // [esp+4Ch] [ebp-FCh]
  float v50; // [esp+50h] [ebp-F8h]
  float v51; // [esp+54h] [ebp-F4h]
  float v52; // [esp+80h] [ebp-C8h]
  float v53; // [esp+84h] [ebp-C4h]
  float v54; // [esp+90h] [ebp-B8h]
  float v55; // [esp+94h] [ebp-B4h]
  float v56; // [esp+98h] [ebp-B0h]
  float v57; // [esp+9Ch] [ebp-ACh]
  float v58; // [esp+C8h] [ebp-80h]
  float v59; // [esp+CCh] [ebp-7Ch]
  float v60; // [esp+D0h] [ebp-78h]
  float v61; // [esp+D4h] [ebp-74h]
  float v62; // [esp+D8h] [ebp-70h]
  float v63; // [esp+DCh] [ebp-6Ch]
  int v64; // [esp+E0h] [ebp-68h]
  int v65; // [esp+E4h] [ebp-64h]
  float v66; // [esp+E8h] [ebp-60h]
  float v67; // [esp+ECh] [ebp-5Ch]
  float v68; // [esp+F0h] [ebp-58h]
  unsigned int v69; // [esp+F4h] [ebp-54h]
  int v70; // [esp+F8h] [ebp-50h]
  float v71; // [esp+FCh] [ebp-4Ch]
  float v72; // [esp+100h] [ebp-48h]
  float v73; // [esp+104h] [ebp-44h]
  float v74; // [esp+120h] [ebp-28h]
  float x; // [esp+124h] [ebp-24h]
  float v76; // [esp+128h] [ebp-20h]

  if ( a7 >= 0 )
  {
    v76 = 3.141592653589793 * a4 / 180.0;
    x = 3.141592653589793 * a5 / 180.0;
    v45 = sinf(x) * a6;
    v59 = cosf(v76) * v45 + a1;
    v60 = sinf(v76) * v45 + a2;
    v61 = cosf(x) * a6 + a3;
    v9 = a6 * 0.5 * 1.4142135;
    v74 = v9;
    v62 = v9 * 0.80000001;
    if ( a9 == 1 )
    {
      v70 = dword_804A194;
      v10 = dword_804A18C;
      v11 = &dword_8084B18[dword_804A18C];
      v12 = (float *)((char *)&unk_80D2D18 + 4 * dword_804A194);
      v63 = -1.5707964;
      v13 = 0;
      while ( 1 )
      {
        v22 = v13 + v70;
        v13 += 6;
        v65 = v10 + 6;
        v11 += 6;
        v12 += 6;
        if ( v13 == 18 )
          break;
        v46 = x + 0.7853981633974483;
        v14 = sinf(v46);
        v47 = v14;
        v48 = v14 * v74;
        v49 = v76 + v63;
        v50 = cosf(v49);
        *((float *)v11 - 6) = v48 * v50 + a1;
        v15 = sinf(v49);
        v51 = v15;
        *((float *)v11 - 5) = v15 * v48 + a2;
        v16 = cosf(v46);
        *((float *)v11 - 4) = v74 * v16 + a3;
        v17 = v74 + 1.0;
        v18 = v17 * v47;
        *(v12 - 6) = v50 * v18 + a1;
        *(v12 - 5) = v18 * v51 + a2;
        *(v12 - 4) = v16 * v17 + a3;
        v52 = x - 0.7853981633974483;
        v53 = sinf(v52);
        v19 = v74 * v53;
        *((float *)v11 - 3) = v50 * v19 + a1;
        *((float *)v11 - 2) = v19 * v51 + a2;
        v20 = cosf(v52);
        *((float *)v11 - 1) = v74 * v20 + a3;
        v21 = (double)v17 * v53;
        *(v12 - 3) = a1 + (double)(v50 * v21);
        *(v12 - 2) = v21 * v51 + a2;
        *(v12 - 1) = v20 * (double)v17 + a3;
        v63 = v63 + 3.141592653589793;
        v10 = v65;
      }
      dword_804A194 = v22;
      dword_804A18C = v10;
    }
    v64 = dword_804A194;
    v23 = dword_804A18C;
    v24 = &dword_8084B18[dword_804A18C];
    v25 = (float *)((char *)&unk_80D2D18 + 4 * dword_804A194);
    v67 = -1.5707964;
    v26 = 0;
    while ( 1 )
    {
      v35 = v26 + v64;
      v26 += 6;
      v69 = v23 + 6;
      v24 += 6;
      v25 += 6;
      if ( v26 == 18 )
        break;
      v73 = x + 0.7853981633974483;
      v27 = sinf(v73);
      v54 = v27;
      v55 = v27 * v62;
      v72 = v76 + v67;
      v56 = cosf(v72);
      *((float *)v24 - 6) = v55 * v56 + v59;
      v28 = sinf(v72);
      v57 = v28;
      *((float *)v24 - 5) = v28 * v55 + v60;
      v29 = cosf(v73);
      *((float *)v24 - 4) = v62 * v29 + v61;
      v30 = v62 + 1.0;
      v31 = v30 * v54;
      *(v25 - 6) = v56 * v31 + v59;
      *(v25 - 5) = v31 * v57 + v60;
      *(v25 - 4) = v29 * v30 + v61;
      v71 = x - 0.7853981633974483;
      v58 = sinf(v71);
      v32 = v62 * v58;
      *((float *)v24 - 3) = v56 * v32 + v59;
      *((float *)v24 - 2) = v32 * v57 + v60;
      v33 = cosf(v71);
      *((float *)v24 - 1) = v62 * v33 + v61;
      v34 = (double)v30 * v58;
      *(v25 - 3) = v59 + (double)(v56 * v34);
      *(v25 - 2) = v34 * v57 + v60;
      *(v25 - 1) = v33 * (double)v30 + v61;
      v67 = v67 + 3.141592653589793;
      v23 = v69;
    }
    dword_804A194 = v35;
    dword_804A18C = v23;
    v44 = v23 / 3;
    v43 = v23 / 3 - 8;
    v36 = count;
    dword_804A198[count] = v43;
    dword_804A19C[v36] = v44 - 7;
    dword_804A1A0[v36] = v44 - 3;
    dword_804A1A4[v36] = v44 - 4;
    dword_804A1A8[v36] = v44 - 6;
    dword_804A1AC[v36] = v44 - 5;
    dword_804A1B0[count] = v44 - 1;
    v37 = count;
    dword_804A1B4[count] = v44 - 2;
    dword_804A1B8[v37] = v44 - 7;
    dword_804A1BC[v37] = v44 - 3;
    dword_804A1C0[v37] = v44 - 1;
    dword_804A1C4[v37] = v44 - 5;
    dword_804A1C8[v37] = v43;
    dword_804A1CC[v37] = v44 - 4;
    dword_804A1D0[v37] = v44 - 2;
    dword_804A1D4[v37] = v44 - 6;
    count = v37 + 16;
    v66 = (v62 + v62) / 1.4142135;
    v38 = a7 - 1;
    v41 = a5 + 10.0;
    sub_80489E4(v59, v60, v61, a4, v41, v66, a7 - 1, a8, 0);
    if ( a8 )
    {
      v68 = -90.0;
      for ( i = 0; i != 2; ++i )
      {
        v40 = a4 + v68;
        sub_80489E4(v59, v60, v61, v40, a5, v66, v38, 0, 1);
        v42 = a5 + v68;
        sub_80489E4(v59, v60, v61, a4, v42, v66, v38, 0, 1);
        v68 = v68 + 180.0;
      }
    }
  }
}
// 804A18C: using guessed type int dword_804A18C;
// 804A194: using guessed type int dword_804A194;
// 804A198: using guessed type int dword_804A198[];
// 804A19C: using guessed type int dword_804A19C[];
// 804A1A0: using guessed type int dword_804A1A0[];
// 804A1A4: using guessed type int dword_804A1A4[];
// 804A1A8: using guessed type int dword_804A1A8[];
// 804A1AC: using guessed type int dword_804A1AC[];
// 804A1B0: using guessed type int dword_804A1B0[];
// 804A1B4: using guessed type int dword_804A1B4[];
// 804A1B8: using guessed type int dword_804A1B8[];
// 804A1BC: using guessed type int dword_804A1BC[];
// 804A1C0: using guessed type int dword_804A1C0[];
// 804A1C4: using guessed type int dword_804A1C4[];
// 804A1C8: using guessed type int dword_804A1C8[];
// 804A1CC: using guessed type int dword_804A1CC[];
// 804A1D0: using guessed type int dword_804A1D0[];
// 8084B18: using guessed type int dword_8084B18[];

//----- (0804908A) --------------------------------------------------------
void sub_804908A()
{
  int i; // ebx
  float v1; // [esp+Ch] [ebp-1Ch]

  count = 0;
  dword_804A18C = 0;
  dword_804A194 = 0;
  v1 = 0.0;
  for ( i = 0; i != 4; ++i )
  {
    sub_80489E4(0.0, 0.0, 0.0, 0.0, v1, 0.1, 14, 1, 1);
    v1 = v1 + 90.0;
  }
  sub_80489E4(0.0, 0.0, 0.0, 90.0, 90.0, 0.1, 14, 1, 1);
  sub_80489E4(0.0, 0.0, 0.0, 270.0, 90.0, 0.1, 14, 1, 1);
  glNormalPointer(0x1406u, 0, &unk_80D2D18);
  glColor4f(1.0, 1.0, 1.0, 1.0);
  glVertexPointer(3, 0x1406u, 0, dword_8084B18);
  glPushMatrix();
  glRotatef(70.199997, 1.0, 0.69999999, 0.0);
  glDrawElements(7u, count, 0x1405u, dword_804A198);
  glPopMatrix();
  dword_8084B18[0] = -1090519040;
  dword_8084B1C = -1090519040;
  dword_8084B20 = -1090519040;
  dword_804A198[0] = 0;
  dword_8084B24 = 1056964608;
  dword_8084B28 = -1090519040;
  dword_8084B2C = -1090519040;
  dword_804A19C[0] = 1;
  dword_8084B30 = 1056964608;
  dword_8084B34 = 1056964608;
  dword_8084B38 = -1090519040;
  dword_804A1A0[0] = 2;
  dword_8084B3C = -1090519040;
  dword_8084B40 = 1056964608;
  dword_8084B44 = -1090519040;
  dword_804A1A4[0] = 3;
  glDrawElements(7u, 4, 0x1405u, dword_804A198);
}
// 804A18C: using guessed type int dword_804A18C;
// 804A194: using guessed type int dword_804A194;
// 804A198: using guessed type int dword_804A198[];
// 804A19C: using guessed type int dword_804A19C[];
// 804A1A0: using guessed type int dword_804A1A0[];
// 804A1A4: using guessed type int dword_804A1A4[];
// 8084B18: using guessed type int dword_8084B18[];
// 8084B1C: using guessed type int dword_8084B1C;
// 8084B20: using guessed type int dword_8084B20;
// 8084B24: using guessed type int dword_8084B24;
// 8084B28: using guessed type int dword_8084B28;
// 8084B2C: using guessed type int dword_8084B2C;
// 8084B30: using guessed type int dword_8084B30;
// 8084B34: using guessed type int dword_8084B34;
// 8084B38: using guessed type int dword_8084B38;
// 8084B3C: using guessed type int dword_8084B3C;
// 8084B40: using guessed type int dword_8084B40;
// 8084B44: using guessed type int dword_8084B44;

//----- (0804922C) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
int __cdecl main(int a1)
{
  int v1; // ebx
  int v3; // [esp-18h] [ebp-44h]
  int v4; // [esp-14h] [ebp-40h]
  int v5; // [esp-10h] [ebp-3Ch]
  int v6; // [esp-Ch] [ebp-38h]
  int v7; // [esp-8h] [ebp-34h]
  int v8; // [esp-4h] [ebp-30h]
  _DWORD v9[2]; // [esp+0h] [ebp-2Ch] BYREF
  int v10; // [esp+8h] [ebp-24h]
  __int64 v11; // [esp+Ch] [ebp-20h]
  GLfloat dest[6]; // [esp+14h] [ebp-18h] BYREF

  LODWORD(dest[3]) = &a1;
  memcpy(dest, &unk_8049460, 0xCu);
  SDL_Init(32, v3, v4, v5, v6, v7, v8, v9[0], v9[1], v10, v11, HIDWORD(v11));
  SDL_SetVideoMode(1024, 768, 32, -1610612717);
  SDL_ShowCursor(0);
  glClearColor(0.0, 0.0, 0.0, 0.0);
  glMatrixMode(0x1701u);
  glLoadIdentity();
  glEnable(0xB71u);
  glEnable(0xB50u);
  glEnable(0x4000u);
  glEnable(0xBA1u);
  glEnableClientState(0x8074u);
  glEnableClientState(0x8075u);
  glOrtho(-0.5, 0.5, -0.5, 0.5, -1.0, 100.0);
  glLightfv(0x4000u, 0x1203u, dest);
  v1 = 0;
  do
  {
    while ( SDL_PollEvent(v9) )
    {
      if ( LOBYTE(v9[0]) == 2 && v10 == 27 )
        v1 = 1;
    }
    glClear(0x4100u);
    glColor4f(1.0, 1.0, 1.0, 1.0);
    sub_804908A();
    SDL_GL_SwapBuffers();
  }
  while ( !v1 );
  SDL_ShowCursor(1);
  SDL_Quit();
  return 0;
}
// 8049345: bad sp value at call
// 8049256: variable 'v3' is possibly undefined
// 8049256: variable 'v4' is possibly undefined
// 8049256: variable 'v5' is possibly undefined
// 8049256: variable 'v6' is possibly undefined
// 8049256: variable 'v7' is possibly undefined
// 8049256: variable 'v8' is possibly undefined
// 8048804: using guessed type int __cdecl SDL_ShowCursor(_DWORD);
// 8048814: using guessed type int __cdecl SDL_PollEvent(_DWORD);
// 8048834: using guessed type int SDL_GL_SwapBuffers(void);
// 8048864: using guessed type int __cdecl SDL_SetVideoMode(_DWORD, _DWORD, _DWORD, _DWORD);
// 8048884: using guessed type int __stdcall SDL_Init(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 8048924: using guessed type int SDL_Quit(void);

//----- (080493A0) --------------------------------------------------------
void fini(void)
{
  ;
}

//----- (080493B0) --------------------------------------------------------
void init(void)
{
  init_proc();
}

//----- (0804940A) --------------------------------------------------------
void sub_804940A()
{
  ;
}

//----- (08049410) --------------------------------------------------------
void (*sub_8049410())(void)
{
  void (*result)(void); // eax
  int v1; // ebx

  result = (void (*)(void))dword_804A000;
  if ( dword_804A000 != -1 )
  {
    v1 = 0;
    do
    {
      result();
      result = *(void (**)(void))(v1 + 134520828);
      v1 -= 4;
    }
    while ( result != (void (*)(void))-1 );
  }
  return result;
}
// 804A000: using guessed type int dword_804A000;

//----- (0804943C) --------------------------------------------------------
void term_proc()
{
  sub_8048990();
}

// nfuncs=65 queued=13 decompiled=13 lumina nreq=0 worse=0 better=0
// ALL OK, 13 function(s) have been successfully decompiled
