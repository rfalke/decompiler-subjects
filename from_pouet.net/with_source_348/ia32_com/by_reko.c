// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_3) es, Register (ptr16 Eq_4) ds)
void fn0C00_0100(struct Eq_3 * es, struct Eq_4 * ds)
{
	byte Eq_3::* di_383 = Eq_3::a4D78;
	word16 cx_10;
	for (cx_10 = 0x2D; cx_10 != 0x00; --cx_10)
	{
		es->*di_383 = 0x00;
		++di_383;
	}
	__wait();
	__fninit();
	struct Eq_15 Eq_4::* di_11 = &Eq_4::t0000;
	word16 cx_12 = 0x00;
	do
	{
		ds->t4D66.u0 = 0x00;
		do
		{
			real64 rLoc1_430 = (real64) ds->t049E * (real64) ds->r04A2;
			ds->r4DB8 = (real32) rLoc1_430;
			real64 rLoc1_432 = sin(rLoc1_430) * (real64) ds->w04C5;
			real64 rLoc3_435 = (real64) ds->t4D66 * (real64) ds->r04A2;
			ds->r4DBC = (real32) rLoc3_435;
			di_11[650] = (struct Eq_15) (int16) (rLoc1_432 * cos(rLoc3_435));
			di_11[0x0E42] = (struct Eq_15) (int16) (rLoc1_432 * sin((real64) ds->r4DBC));
			di_11[6650] = (struct Eq_15) (int16) (cos((real64) ds->r4DB8) * (real64) ds->w04C5);
			ds->t4D66 = (word16) ds->t4D66 + 0x0F;
			++di_11;
			++cx_12;
		} while (ds->t4D66 <= 0x0168);
		ds->t049E = (word16) ds->t049E + 0x0F;
	} while (ds->t049E <= 0xB4);
	ds->w4B64 = cx_12;
	int16 bx_66;
	word16 Eq_4::* di_71 = Eq_4::a4B66;
	for (bx_66 = 0x00; bx_66 != 0x0100; ++bx_66)
	{
		ds->w050A = bx_66;
		ds->w050A = (int16) (sin((real64) ds->w050A * (real64) ds->r04BC) * (real64) ds->r04C0);
		ds->*di_71 = -ds->w050A + 0x8C;
		Eq_184 Top_141 = 0;
		++di_71;
	}
	fn0C00_02D5(0x00, 0x9000);
	word32 ecx_118 = 0x00;
	do
	{
		word64 rRet1_139;
		real64 rRet0_140 = fn0C00_03FC(0x9000, ds, out rRet1_139);
		Top_141.u1->qwFFFFFFFF = rRet1_139;
		Top_141.u1->qwFFFFFFFE = rRet0_140;
		Top_141 -= 2;
		ecx_118 = ecx_540 + 0x01;
		ecx_540 = ecx_118;
	} while (ecx_540 != 199999);
	ds->w0506 = ~0x63;
	byte Eq_282::* di_158 = Eq_282::a0000;
	do
	{
		ds->w0504 = ~0x9F;
		do
		{
			Eq_230 Top_166 = Top_141 - 1;
			Top_166.u1->r0000 = (real64) ds->w0504;
			Top_166.u1->qwFFFFFFFF = (real64) ds->w0506;
			Top_166.u1->r0000 = __atan2(Top_166.u1->r0000, Top_166.u1->qwFFFFFFFF);
			Top_166.u1->r0000 *= (real64) ds->r04A8;
			ds->t0500.u0 = (int32) Top_166.u1->r0000;
			0x8000->*di_158 = (byte) ds->t0500;
			Top_166.u1->r0000 = (real64) ds->w0506;
			Top_166.u1->r0000 *= Top_166.u1->r0000;
			Top_166.u1->qwFFFFFFFF = (real64) ds->w0504;
			Top_166.u1->qwFFFFFFFF *= Top_166.u1->qwFFFFFFFF;
			Top_166.u1->r0000 += Top_166.u1->qwFFFFFFFF;
			Top_166.u1->r0000 = sqrt(Top_166.u1->r0000);
			Top_166.u1->r0000 = (real64) ds->w04A6 / (Top_166.u1)->r0000;
			ds->t0500.u0 = (int32) Top_166.u1->r0000;
			0x7000->*di_158 = (byte) ds->t0500;
			++ds->w0504;
			&Top_141.u1->r0000 = (word32) Top_166 + 2;
			++di_158;
		} while (ds->w0504 != 0xA0);
		++ds->w0506;
	} while (ds->w0506 != 100);
	bios_video_set_mode(0x13);
	uint32 ebx_209 = 0x00;
	do
	{
		word16 cx_213;
		for (cx_213 = 0x04; cx_213 != 0x00; --cx_213)
		{
			fn0C00_02B6(ebx_209);
			byte bl_223 = (byte) ebx_209;
			ebx_209 = SEQ(SLICE(ebx_209, word24, 8), bl_223 + 0x01);
		}
		ebx_209 += 0x01000100;
	} while (bl_223 != ~0x00);
	fn0C00_02B6(0x1A1A00FD);
	fn0C00_02B6(0x252500FE);
	fn0C00_02B6(0x393900FF);
	int16 si_261 = 0x00;
	while (true)
	{
		int16 si_266 = si_261 + 0x0102;
		fn0C00_02F5(si_266);
		fn0C00_0366(ds);
		fn0C00_02C7();
		fn0C00_02E0();
		ds->t04A0.u1 = (word16) ds->t04A0 + 1;
		while (true)
		{
l0C00_027B:
			if (ds->b04C4 != 0x00)
				break;
			if (ds->w04AC > 0x41)
			{
				--ds->w04AC;
				goto l0C00_02A9;
			}
			ds->b04C4 = 0x01;
		}
		if (ds->w04AC >= 0xFF)
			break;
		++ds->w04AC;
l0C00_02A9:
		si_261 = si_266;
		byte al_375;
		byte ah_376;
		if (!bios_kbd_check_keystroke(out al_375, out ah_376))
		{
			bios_video_set_mode(0x03);
			return;
		}
	}
	ds->b04C4 = 0x00;
	goto l0C00_027B;
}

// 0C00:02B6: void fn0C00_02B6(Register uint32 eax)
// Called from:
//      fn0C00_0100
void fn0C00_02B6(uint32 eax)
{
	byte al;
	byte ah = SLICE(eax, byte, 8);
	__out<byte>(0x03C8, al);
	__out<byte>(969, ah);
	__out<byte>(969, (byte) (eax >> 0x10));
	__out<byte>(969, SLICE(eax >> 0x10, byte, 8));
}

// 0C00:02C7: void fn0C00_02C7()
// Called from:
//      fn0C00_0100
void fn0C00_02C7()
{
	do
		;
	while ((__in<byte>(0x03DA) & 0x08) != 0x00);
	do
		;
	while ((__in<byte>(0x03DA) & 0x08) == 0x00);
}

// 0C00:02D5: void fn0C00_02D5(Register byte al, Register (ptr16 Eq_195) dx)
// Called from:
//      fn0C00_0100
void fn0C00_02D5(byte al, struct Eq_195 * dx)
{
	word16 cx_12;
	byte Eq_195::* di_15 = Eq_195::a0000;
	for (cx_12 = ~0x00; cx_12 != 0x00; --cx_12)
	{
		dx->*di_15 = al;
		++di_15;
	}
	dx->*di_15 = al;
}

// 0C00:02E0: void fn0C00_02E0()
// Called from:
//      fn0C00_0100
void fn0C00_02E0()
{
	memcpy(A000:0000, 6000:0000, 0xFA00);
}

// 0C00:02F5: void fn0C00_02F5(Register int16 si)
// Called from:
//      fn0C00_0100
void fn0C00_02F5(int16 si)
{
	byte Eq_282::* di_30 = Eq_282::a0000;
	word16 cx_28;
	for (cx_28 = 0xFA00; cx_28 != 0x00; --cx_28)
	{
		0x6000->*di_30 = (byte) (0x9000->*((char *) SEQ(0x8000->*di_30, 0x7000->*di_30) + si));
		++di_30;
	}
}

// 0C00:031B: void fn0C00_031B()
// Called from:
//      fn0C00_0366
void fn0C00_031B()
{
	seg0C00->t033D();
	seg0C00->t033D();
	0x033D();
}

// 0C00:0366: void fn0C00_0366(Register (ptr16 Eq_4) ds)
// Called from:
//      fn0C00_0100
void fn0C00_0366(struct Eq_4 * ds)
{
	ds->r4D98 = (real32) ((real64) ds->r4D98 + (real64) ds->r04B0);
	ds->r4D9C = (real32) ((real64) ds->r4D9C + (real64) ds->r04B8);
	ds->r4DA0 = (real32) ((real64) ds->r4DA0 + (real64) ds->r04B8);
	struct Eq_646 Eq_4::* si_108 = &Eq_4::t0000;
	word16 cx_111 = ds->w4B64;
	do
	{
		ds->w0504 = (int16) si_108[650];
		ds->w0506 = (int16) si_108[0x0E42];
		ds->w0508 = (word16) si_108[6650];
		fn0C00_031B();
		int16 di_52 = ds->w0508 + ds->w04AE;
		Eq_657 di_80 = ((int16) (ds->w0506 *s32 0x04E8 /16 di_52) + ((ds->a4B66))[0][ds->t04A0] - 0x01) *s 0x0140 + ((int16) ((ds->w0504 *s32 0x04E8) /16 di_52) + ds->w04AC) - 0x01;
		word16 Eq_4::* si_84 = Eq_4::a04C7;
		word16 cx_101;
		for (cx_101 = 0x03; cx_101 != 0x00; --cx_101)
		{
			0x6000->*di_80 = ds->*si_84;
			word16 Eq_4::* si_93 = si_84 + 1;
			struct Eq_665 Eq_282::* di_94 = (word16) di_80 + 2;
			(0x6000->*di_94).w0000 = ds->*si_93;
			si_84 = (word16 Eq_4::*) ((char *) si_93 + 1);
			di_80 = di_94 + 1;
		}
		++si_108;
		cx_111 = cx_138 - 0x01;
		cx_138 = cx_111;
	} while (cx_138 != 0x01);
}

// 0C00:03FC: FpuStack real64 fn0C00_03FC(Register (ptr16 Eq_205) es, Register (ptr16 Eq_4) ds, FpuStack out Eq_207 rLoc1Out)
// Called from:
//      fn0C00_0100
real64 fn0C00_03FC(struct Eq_205 * es, struct Eq_4 * ds, union Eq_207 & rLoc1Out)
{
	ds->a4D68 = 0x00;
	ds->a4D70 = 0x00;
	struct Eq_768 Eq_4::* si_7 = &Eq_4::t0000;
	struct Eq_770 Eq_4::* di_16 = &Eq_4::t0000;
	word16 cx_12 = 0x04;
	while (true)
	{
		Eq_207 rLoc1_110 = (real64) di_16[4958] + (real64) (ds->*di_16).r04D9;
		di_16[4958] = (struct Eq_770) (real32) rLoc1_110;
		real64 rLoc2_112 = (real64) di_16[4962] + (real64) (ds->*di_16).r04E9;
		di_16[4962] = (struct Eq_770) (real32) rLoc2_112;
		--cx_12;
		if (cx_12 == 0x00)
			break;
		real64 rLoc2_113 = rLoc2_112 * (real64) ds->r04A2;
		si_7[9909] = (struct Eq_768) (int16) (cos(rLoc2_113) * rLoc1_110 + (real64) si_7[9908]);
		si_7[9913] = (struct Eq_768) (int16) (rLoc1_110 * sin(rLoc2_113) + (real64) si_7[9912]);
		++di_16;
		++si_7;
	}
	__wait();
	__fninit();
	ci16 ax_29 = ds->w4D76;
	byte al_41 = (byte) ax_29 + 0x80;
	if (ax_29 > ~0xE3 && ax_29 <= 222)
	{
		ci16 bx_35 = ds->w4D6E;
		byte bl_45 = (byte) bx_35 + 0x80;
		if (bx_35 > ~0xE3 && bx_35 <= 222)
		{
			byte Eq_4::* si_108 = &Eq_4::b04D0;
			word16 dx_48;
			struct Eq_886 Eq_205::* bx_103 = SEQ(al_41 - 0x01, bl_45 - 0x01);
			for (dx_48 = 0x03; dx_48 != 0x00; --dx_48)
			{
				word16 cx_49;
				for (cx_49 = 0x03; cx_49 != 0x00; --cx_49)
				{
					cu8 al_56 = (es->*bx_103).b0000 + ds->*si_108;
					if (al_56 > ~0x05)
						al_56 = ~0x05;
					(es->*bx_103).b0000 = al_56;
					++si_108;
					bx_103 = &bx_103->b0000 + 1;
				}
				++bx_103;
			}
		}
	}
	rLoc1Out = rLoc1_110;
	return rLoc2_112;
}

<anonymous> g_t033D = <code>; // 0C00:043D
