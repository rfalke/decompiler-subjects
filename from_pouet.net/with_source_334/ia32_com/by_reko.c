// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_3) ds)
void fn0C00_0100(struct Eq_3 * ds)
{
	struct Eq_4 * cs;
	ds->ptr04F8 = (struct Eq_6 *) ((char *) cs + 0x00001000);
	bios_video_set_mode(0x13);
	__out<byte>(0x03C8, 0x00);
	bcu8 ah_20 = 0x00;
	do
	{
		uint8 al_22 = ah_20 >> 0x02;
		__out<byte>(969, al_22);
		__out<byte>(969, al_22);
		__out<byte>(969, -(al_22 >> 0x01) + al_22);
		++ah_20;
	} while (ah_20 != 0x00);
	__wait();
	__fninit();
	ds->r04EC = (real32) ((real64) ds->r0469 / (real64) ds->w0471);
	ds->r04F0 = (real32) ((real64) ds->r0469 / (real64) ds->w0473);
	ds->r04F4 = (real32) ((real64) ds->dw0475 / (3.141592653589793 + 3.141592653589793));
	fn0C00_0400((char *) cs + 0x00002000);
	Eq_94 Top_107 = 0x00;
	struct Eq_96 Eq_99::* di_64 = Eq_99::a0000;
	do
	{
		byte al_72 = (byte) di_64[1].b0000 + ((cs + 0x2000)->*di_64).bFFFFFFFF;
		byte al_76 = __rcr<byte,byte>(al_72, 0x01, SLICE(cond(al_72), bool, 1));
		byte bl_78 = (byte) di_64[0x0100].b0000 + ((cs + 0x2000)->*di_64).bFFFFFF00;
		byte al_83 = al_76 + __rcr<byte,byte>(bl_78, 0x01, SLICE(cond(bl_78), bool, 1));
		((cs + 0x2000)->*di_64).b0000 = __rcr<byte,byte>(al_83, 0x01, SLICE(cond(al_83), bool, 1));
		++di_64;
	} while (di_64 != Eq_99::a0000);
	do
	{
		word64 rRet1_105;
		real64 rRet0_106 = fn0C00_0233(ds, out rRet1_105);
		Top_107.u1->qwFFFFFFFF = rRet1_105;
		Top_107.u1->qwFFFFFFFE = rRet0_106;
		fn0C00_0312((char *) cs + 0x00001000, ds, (char *) cs + 0x00002000);
		memcpy(A000:0000, *ds->ptr04F8, 0xFA00);
		Eq_188 Top_110 = Top_107 - 2;
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) == 0x00);
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) != 0x00);
		word64 rRet1_170;
		real64 rRet0_171 = fn0C00_03CC(ds, out rRet1_170);
		Top_110.u1->qwFFFFFFFF = rRet1_170;
		Top_110.u1->qwFFFFFFFE = rRet0_171;
		ds->w047D += 0x0100;
		ds->w047F += 0x0300;
		Top_107 = Top_110 - 2;
		byte al_185;
		byte ah_186;
	} while (bios_kbd_check_keystroke(out al_185, out ah_186));
	byte al_192;
	bios_kbd_get_keystroke(out al_192);
	bios_video_set_mode(0x03);
	msdos_display_string(&ds->r04A5 + 1);
	msdos_terminate(0x00);
}

// 0C00:01D3: void fn0C00_01D3(Register (memptr (ptr16 Eq_3) Eq_268) bx, Register (memptr (ptr16 Eq_3) Eq_269) si, Register (memptr (ptr16 Eq_3) Eq_270) di, Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_0233
void fn0C00_01D3(struct Eq_268 Eq_3::* bx, struct Eq_269 Eq_3::* si, struct Eq_270 Eq_3::* di, struct Eq_3 * ds)
{
	(ds->*bx).r0000 = (real32) ((real64) (ds->*si).r0000 + (real64) (ds->*di).r0000);
	(ds->*bx).r0004 = (real32) ((real64) (ds->*si).r0004 + (real64) (ds->*di).r0004);
	(ds->*bx).r0008 = (real32) ((real64) (ds->*si).r0008 + (real64) (ds->*di).r0008);
}

// 0C00:01EC: void fn0C00_01EC(Register (memptr (ptr16 Eq_3) Eq_320) bx, Register (memptr (ptr16 Eq_3) Eq_321) si, Register (memptr (ptr16 Eq_3) Eq_322) di, Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_0233
void fn0C00_01EC(struct Eq_320 Eq_3::* bx, struct Eq_321 Eq_3::* si, struct Eq_322 Eq_3::* di, struct Eq_3 * ds)
{
	(ds->*bx).r0000 = (real32) ((real64) (ds->*si).r0000 - (real64) (ds->*di).r0000);
	(ds->*bx).r0004 = (real32) ((real64) (ds->*si).r0004 - (real64) (ds->*di).r0004);
	(ds->*bx).r0008 = (real32) ((real64) (ds->*si).r0008 - (real64) (ds->*di).r0008);
}

// 0C00:0205: void fn0C00_0205(Register (memptr (ptr16 Eq_3) Eq_372) si, Register (memptr (ptr16 Eq_3) Eq_373) di, Register (ptr16 Eq_3) ds, FpuStack Eq_158 rArg0)
// Called from:
//      fn0C00_0233
void fn0C00_0205(struct Eq_372 Eq_3::* si, struct Eq_373 Eq_3::* di, struct Eq_3 * ds, Eq_158 rArg0)
{
	(ds->*di).r0000 = (real32) ((real64) (ds->*si).r0000 * rArg0);
	(ds->*di).r0004 = (real32) ((real64) (ds->*si).r0004 * rArg0);
	(ds->*di).r0008 = (real32) ((real64) (ds->*si).r0008 * rArg0);
}

// 0C00:021C: void fn0C00_021C(Register (memptr (ptr16 Eq_3) Eq_409) si, Register (memptr (ptr16 Eq_3) Eq_410) di, Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_0233
void fn0C00_021C(struct Eq_409 Eq_3::* si, struct Eq_410 Eq_3::* di, struct Eq_3 * ds)
{
	word32 ebx_8 = (ds->*si).dw0004;
	word32 ecx_9 = (ds->*si).dw0008;
	(ds->*di).dw0000 = (ds->*si).dw0000;
	(ds->*di).dw0004 = ebx_8;
	(ds->*di).dw0008 = ecx_9;
}

// 0C00:0233: FpuStack Eq_158 fn0C00_0233(Register (ptr16 Eq_3) ds, FpuStack out Eq_158 rLoc1Out)
// Called from:
//      fn0C00_0100
Eq_158 fn0C00_0233(struct Eq_3 * ds, union Eq_158 & rLoc1Out)
{
	fn0C00_01EC(&Eq_3::t04BC, &Eq_3::t048D, &Eq_3::t0481, ds);
	Eq_158 rLoc1_123 = (real64) ds->r04EC;
	fn0C00_0205(&Eq_3::t04BC, &Eq_3::t04BC, ds, rLoc1_123);
	__ffree(rLoc1_123);
	fn0C00_01EC(&Eq_3::t04C8, &Eq_3::t0499, &Eq_3::t0481, ds);
	Eq_158 rLoc2_124 = (real64) ds->r04F0;
	fn0C00_0205(&Eq_3::t04C8, &Eq_3::t04C8, ds, rLoc2_124);
	__ffree(rLoc2_124);
	fn0C00_021C(&Eq_3::t0481, &Eq_3::t04D4, ds);
	struct Eq_480 Eq_3::* bp_100 = &Eq_3::t0500;
	word16 cx_117 = 0x1A;
	do
	{
		fn0C00_021C(&Eq_3::t04D4, &Eq_3::r04E0, ds);
		word16 cx_111 = 0x29;
		do
		{
			real64 rLoc3_127 = (real64) ds->r04E0;
			real64 rLoc4_129 = (real64) ds->r04E4;
			ds->t04FA.u0 = (int32) ((real64) ds->r04A5 / sqrt(rLoc3_127 * rLoc3_127 + rLoc4_129 * rLoc4_129) * (real64) ds->r04E8 * (real64) ds->r046D);
			Eq_485 eax_61 = ds->t04FA;
			(ds->*bp_100).w0000 = (word16) eax_61 + ds->w047F;
			Eq_485 ebx_62 = eax_61;
			if (eax_61 < 0x00)
				ebx_62 = -eax_61;
			word16 bx_77 = (word16) ebx_62;
			if (ebx_62 >= 0x00010000)
				bx_77 = 0xFF00;
			(ds->*bp_100).w0004 = bx_77;
			ds->t04FA.u0 = (int32) (__atan2((real64) ds->r04E0, (real64) ds->r04E4) * (real64) ds->r04F4);
			(ds->*bp_100).w0002 = (word16) ((word32) ds->t04FA + ds->w047D);
			fn0C00_01D3(&Eq_3::r04E0, &Eq_3::r04E0, &Eq_3::t04BC, ds);
			++bp_100;
			cx_111 = cx_170 - 0x01;
			cx_170 = cx_111;
		} while (cx_170 != 0x01);
		fn0C00_01D3(&Eq_3::t04D4, &Eq_3::t04D4, &Eq_3::t04C8, ds);
		cx_117 = cx_169 - 0x01;
		cx_169 = cx_117;
	} while (cx_169 != 0x01);
	rLoc1Out = rLoc1_123;
	return rLoc2_124;
}

// 0C00:0312: void fn0C00_0312(Register (ptr16 Eq_169) es, Register (ptr16 Eq_3) ds, Register (ptr16 Eq_171) gs)
// Called from:
//      fn0C00_0100
void fn0C00_0312(struct Eq_169 * es, struct Eq_3 * ds, struct Eq_171 * gs)
{
	struct Eq_607 Eq_3::* si_138 = &Eq_3::t0500;
	struct Eq_609 Eq_169::* di_108 = &Eq_169::t0000;
	word16 cx_12 = 0x19;
	do
	{
		word16 cx_143 = 0x28;
		do
		{
			struct Eq_691 Eq_3::* si_24 = (char *) &si_138->dw0002 + 2;
			word32 ebx_128 = (ds->*si_24).dw0002;
			word32 eax_127 = (ds->*si_138).dw0000;
			word32 edx_29 = (ds->*si_24).dw00F8 - ebx_128;
			word32 ebp_32 = __rol<word32,byte>((ds->*si_24).dw00F2 - eax_127, 0x10);
			word32 edx_34 = __rol<word32,byte>(edx_29, 0x10);
			word32 ebp_42 = __rol<word32,byte>(SEQ(SLICE(ebp_32, word16, 16), (word16) ebp_32 >> 0x03), 0x10);
			word32 edx_46 = __rol<word32,byte>(SEQ(SLICE(edx_34, word16, 16), (word16) edx_34 >> 0x03), 0x10);
			ds->dw1DFC = SEQ(SLICE(ebp_42, word16, 16), (word16) ebp_42 >> 0x03);
			ds->dw1E00 = SEQ(SLICE(edx_46, word16, 16), (word16) edx_46 >> 0x03);
			byte dh_58 = (ds->*si_24).b0001;
			byte ch_131;
			for (ch_131 = 0x08; ch_131 != 0x00; --ch_131)
			{
				word32 ebx_71 = __rol<word32,byte>(ebx_128 - eax_127, 0x10);
				word32 ebx_77 = __rol<word32,byte>(SEQ(SLICE(ebx_71, word16, 16), (word16) ebx_71 >> 0x03), 0x10);
				word32 ebx_82 = SEQ(SLICE(ebx_77, word16, 16), (word16) ebx_77 >> 0x03);
				byte cl_114;
				eax_112 = eax_127;
				for (cl_114 = 0x08; cl_114 != 0x00; --cl_114)
				{
					word32 eax_112;
					word32 eax_91 = __rol<word32,byte>(eax_112, 0x10);
					word32 eax_95 = __rol<word32,byte>(eax_91, 0x10);
					cu8 bl_101 = gs->*SEQ(SLICE(eax_91, byte, 8), SLICE(eax_112, byte, 8)) - dh_58;
					(es->*di_108).b0000 = bl_101 & (byte) (bl_101 < 0x00) - 1;
					di_108 = &di_108->b0000 + 1;
					eax_112 = eax_95 + ebx_82;
				}
				di_108 = &di_108->b0000 + 312;
				eax_127 += ds->dw1DFC;
				ebx_128 += ds->dw1E00;
			}
			si_138 = (struct Eq_607 Eq_3::*) &si_24->dw0002;
			di_108 -= 0x08C0;
			cx_143 = cx_199 - 0x01;
			cx_199 = cx_143;
		} while (cx_199 != 0x01);
		si_138 = (struct Eq_607 Eq_3::*) ((char *) &si_24->dw0002 + 6);
		cx_12 = cx_198 - 0x01;
		cx_198 = cx_12;
	} while (cx_198 != 0x01);
}

// 0C00:03CC: FpuStack Eq_158 fn0C00_03CC(Register (ptr16 Eq_3) ds, FpuStack out Eq_158 rLoc1Out)
// Called from:
//      fn0C00_0100
Eq_158 fn0C00_03CC(struct Eq_3 * ds, union Eq_158 & rLoc1Out)
{
	real64 rLoc1_47 = (real64) ds->r0479;
	Eq_158 rLoc1_48 = cos(rLoc1_47);
	struct Eq_787 Eq_3::* si_17 = &Eq_3::t0481;
	Eq_158 rLoc2_49 = sin(rLoc1_47);
	word16 cx_13;
	for (cx_13 = 0x03; cx_13 != 0x00; --cx_13)
	{
		real64 rLoc4_51 = (real64) (ds->*si_17).r0004;
		real64 rLoc3_50 = (real64) (ds->*si_17).r0008;
		(ds->*si_17).r0004 = (real32) (rLoc4_51 * rLoc2_49 - rLoc3_50 * rLoc1_48);
		(ds->*si_17).r0008 = (real32) (rLoc4_51 * rLoc1_48 + rLoc3_50 * rLoc2_49);
		++si_17;
	}
	__ffree(rLoc2_49);
	__ffree(rLoc1_48);
	rLoc1Out = rLoc1_48;
	return rLoc2_49;
}

// 0C00:0400: void fn0C00_0400(Register (ptr16 Eq_90) gs)
// Called from:
//      fn0C00_0100
void fn0C00_0400(struct Eq_90 * gs)
{
	gs->b0000 = 0x80;
	byte Eq_90::* bx_18 = &Eq_90::b0000;
	Eq_840 cx_14 = 0x80;
	do
	{
		do
		{
			do
			{
				bx_81 = SEQ(bh_70, bl_67);
				byte Eq_90::* bx_34 = fn0C00_0431(cx_89, cx_89 << 0x08, fn0C00_0431(SLICE(cx_89, byte, 8), cx_89, bx_18, gs), gs);
				fn0C00_0431(cx_89, -cx_89, SEQ(SLICE(bx_34, byte, 8), (byte) bx_34 + cx_89 *8 0x02), gs);
				byte bh_70 = SLICE(bx_34, byte, 8);
				cx_14 = cx_89;
				byte ch_78 = SLICE(cx_89, byte, 8);
				cu8 bl_67 = (byte) bx_34 + cx_89 *8 0x02;
				cx_89 = cx_14;
				bx_18 = bx_81;
			} while (bl_67 >= 0x00);
			cu8 bh_72 = bh_70 + cx_89 *8 0x02;
			bx_18 = SEQ(bh_72, bl_67);
			cx_90 = cx_14;
		} while (bh_72 >= 0x00);
		cx_14 = SEQ(ch_78, cx_89 >> 0x01);
		cx_91 = cx_14;
	} while (cx_89 >> 0x01 != 0x00);
}

// 0C00:0431: Register (memptr (ptr16 Eq_90) byte) fn0C00_0431(Register Eq_840 ch, Register Eq_840 cl, Register (memptr (ptr16 Eq_90) byte) bx, Register (ptr16 Eq_90) gs)
// Called from:
//      fn0C00_0400
byte Eq_90::* fn0C00_0431(Eq_840 ch, Eq_840 cl, byte Eq_90::* bx, struct Eq_90 * gs)
{
	byte bh_9 = SLICE(bx, byte, 8);
	byte bl_13 = (byte) bx;
	byte bh_12 = bh_9 + ch *8 0x02;
	byte bl_16 = bl_13 + cl *8 0x02;
	Eq_905 dx_24 = gs->*SEQ(bh_12, bl_16) + gs->*bx;
	int16 ax_28 = (int16) __in<byte>(0x40);
	Eq_921 dx_34 = (dx_24 >> 0x01) + (SEQ(SLICE(ax_28, byte, 8), (byte) ax_28 << cl) >> 0x03);
	byte dh_41 = SLICE(dx_34, byte, 8);
	byte dl_48 = (byte) dx_34;
	if (dx_34 < 0x00)
	{
		dh_41 = 0x00;
		dl_48 = 0x00;
	}
	if (dh_41 != 0x00)
		dl_48 = ~0x00;
	byte bh_53 = bh_12 - ch;
	byte bl_58 = bl_16 - cl;
	gs->*SEQ(bh_53, bl_58) = dl_48;
	return SEQ(bh_53 - ch, bl_58 - cl);
}

