// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register byte ch, Register word16 bp, Register (ptr16 Eq_5) ds)
void fn0C00_0100(byte ch, word16 bp, struct Eq_5 * ds)
{
	__syscall<byte>(0x10);
	struct Eq_11 Eq_5::* di_12 = &Eq_5::t0000;
	real64 rLoc2_435 = (real64) ds->w01FE;
	word16 cx_341 = SEQ(ch, 200);
	do
	{
		real64 rLoc3_436 = (real64) ds->w01FC;
		word16 dx_27;
		for (dx_27 = 0x0140; dx_27 != 0x00; --dx_27)
		{
			real64 rLoc4_446 = sqrt(rLoc2_435 * rLoc2_435 + rLoc3_436 * rLoc3_436) / (real64) ds->w01FC + (real64) ds->r01F8;
			(0x7000->*di_12).w0000 = (int16) (rLoc3_436 / rLoc4_446 + rLoc3_436);
			di_12[510] = (struct Eq_11) (int16) (rLoc2_435 / rLoc4_446 + rLoc2_435);
			rLoc3_436 += 1.0;
			++di_12;
		}
		--cx_341;
		rLoc2_435 = rLoc2_435 + 1.0 + 1.0;
		byte ch_355 = SLICE(cx_341, byte, 8);
	} while (cx_341 != 0x00);
	do
	{
		__out<byte>(0x03C8, 0x00);
		word16 ax_347 = 0x00;
		do
		{
			word16 cx_177 = SEQ(ch_355, 0x03);
			do
			{
				int16 ax_119 = (int16) (byte) ax_347;
				byte al_120 = (byte) ax_119;
				uint8 cl_127 = (byte) cx_583 - 0x01;
				byte ah_142 = SLICE(ax_119, byte, 8);
				byte al_121 = al_120 & 0x7F;
				if ((al_120 & 0x7F & 0x40) != 0x00)
				{
					al_121 = al_120 & 0x7F & 0x3F;
					cl_127 = cl_127 >> 0x01 ^ 0x01;
				}
				uint8 al_135 = al_121 << cl_127;
				uint8 al_136 = al_135 >> 0x01;
				if (al_135 >> 0x01 > 0x3F)
					al_136 = 0x3F;
				if (Test(EQ,SLICE(ah_142, bool, 2)))
					al_136 = al_136 + 191 >> 0x02;
				__out<byte>(969, al_136);
				byte al_178 = (byte) ax_347;
				byte ah_348 = SLICE(ax_347, byte, 8);
				cx_177 = cx_583 - 0x01;
				ch_355 = SLICE(cx_583 - 0x01, byte, 8);
				cx_583 = cx_177;
			} while (cx_583 != 0x01);
			ax_347 = SEQ(ah_348, al_178 + 0x01);
		} while (al_178 != ~0x00);
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) == 0x00);
		byte Eq_187::* di_190 = &Eq_187::b0000;
		struct Eq_157 Eq_5::* si_194 = &Eq_5::t0000;
		word16 cx_319 = SEQ(ch_355, 200);
		do
		{
			cup16 dx_196 = 0x0140;
			if (((byte) cx_319 & 0x01) != 0x00)
				si_194 -= 0x0140;
			do
			{
				word16 ax_214 = SEQ((ds->*si_194).b01FE, (0x7000->*si_194).b0000) + bp;
				byte ah_216 = SLICE(ax_214, byte, 8);
				bcu8 al_217 = (byte) ax_214 | ah_216;
				cu8 dl_226 = (byte) dx_196;
				uint8 al_218 = al_217 >> 0x01;
				0x8000->*di_190 = al_217 >> 0x01;
				if (dx_196 < 0x47 && dl_226 > 0x08)
				{
					if ((((byte) (cx_319 + bp) ^ dl_226) & 0x10) != 0x00)
						al_218 = al_217 >> 0x01 | 0x80;
				}
				cu8 cl_250 = (byte) cx_319;
				if ((cl_250 >= 0xC6 || cl_250 <= 0x03) && (dl_226 & 0x04) == 0x00)
				{
					al_218 = 0x00;
					ah_216 = 0x00;
				}
				0xA000->*di_190 = al_218;
				--dx_196;
				++di_190;
				si_194 = &si_194->b0000 + 1;
				byte dl_320 = (byte) dx_196;
			} while (dx_196 != 0x00);
			ds->b01A1 = ds->b01A1 ^ 0x28;
			--cx_319;
			ch_355 = SLICE(cx_319, byte, 8);
		} while (cx_319 != 0x00);
		ds->b01A8 = dl_320;
		bp += 0x0101;
	} while (SEQ(ah_216, __in<byte>(0x60)) != 0x01);
}

