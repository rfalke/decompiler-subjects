// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register word16 ax, Register byte cl, Register Eq_5 dx, Register (ptr16 Eq_6) bx, Register (ptr16 Eq_7) es)
void fn0C00_0100(word16 ax, byte cl, Eq_5 dx, struct Eq_6 * bx, struct Eq_7 * es)
{
	struct Eq_8 * cs;
	bool C;
	word16 Eq_7::* di_203 = Eq_7::a0200;
	word16 cx_206 = SEQ(0x10, cl);
	while (true)
	{
		byte ah_219 = SLICE(ax, byte, 8);
		byte ch_224 = SLICE(cx_206, byte, 8);
		if (cx_206 == 0x00)
			break;
		es->*di_203 = ax;
		++di_203;
		--cx_206;
	}
	__syscall<byte>(0x10);
	word16 si_13 = bx->w046C;
	word16 ax_220 = SEQ(ah_219, 0x03);
	word16 cx_276 = SEQ(ch_224, ~0x00);
	do
	{
		do
		{
			ax_222 = SEQ(ah_221, 0x01);
			byte cl_23 = (byte) cx_288;
			uint32 dx_ax_34 = (uint32) ((word16) dx + __rcl<word16,byte>(si_13 + 0x01, cl_23, C));
			dx.u0 = (uint16) (dx_ax_34 % 0x06D1);
			si_13 = ax_220;
			byte dh_230 = SLICE(dx, byte, 8);
			byte ah_221 = SLICE((uint16) (dx_ax_34 /u 0x06D1), byte, 8);
			C = SLICE(cond(cs->*((word16) dx.u0 + 593) - 0x01), bool, 1);
			cx_276 = cx_288;
			ax_220 = ax_222;
			cx_288 = cx_276;
		} while (cs->*((word16) dx.u0 + 593) == 0x01);
		es->*((word16) dx.u0 + 593) = 0x01;
		byte ch_225 = SLICE(cx_288 - 0x01, byte, 8);
		ax_220 = SEQ(ah_221, 0x01);
		cx_276 = SEQ(ch_225, cl_23 - 0x01);
		cx_289 = cx_276;
	} while (cx_288 != 0x01);
	word16 Eq_109::* di_197 = &Eq_109::w0000;
	ptr16 dx_229 = SEQ(dh_230, 0x19);
	do
	{
		word16 cx_200 = SEQ(ch_225, 0x50);
		while (true)
		{
			ch_225 = SLICE(cx_200, byte, 8);
			if (cx_200 == 0x00)
				break;
			0xB800->*di_197 = 0x072D;
			++di_197;
			--cx_200;
		}
		--dx_229;
	} while (dx_229 != 0x00);
	do
	{
		byte Eq_8::* si_138;
		byte Eq_109::* di_137;
		ptr16 dx_283;
		fn0C00_01E8(dx_229, out dx_283, out si_138, out di_137);
		bios_video_set_cursor_position(SLICE(bx, byte, 8), SLICE(dx_283, byte, 8), (byte) dx_283);
		int16 ax_84 = (int16) msdos_character_input_without_echo();
		byte al_85 = (byte) ax_84;
		word16 ax_93 = SEQ(SLICE(ax_84, byte, 8), al_85 - 0x31);
		if (al_85 == 0x31)
			dx_283 = SEQ(SLICE(dx_283 - 0x01, byte, 8), (byte) dx_283 - 0x01);
		byte dl_106 = (byte) dx_283;
		byte dh_97 = SLICE(dx_283, byte, 8);
		ptr16 dx_105 = dx_283;
		if (ax_93 == 0x01)
			dx_105 = SEQ(dh_97 + 0x01, dl_106);
		if (ax_93 == 0x02)
			++dx_105;
		uint16 ax_113 = ax_93 - 0x03;
		struct Eq_6 * bx_134 = bx;
		if (ax_93 == 0x03)
			ax_113 = fn0C00_0181(dx_105, (byte) bx, 0x06D1, 0xB800, cs, out dx_105, out bx_134, out si_138, out di_137);
		byte dl_233 = (byte) dx_105;
		byte dh_147 = SLICE(dx_105, byte, 8);
		word16 ax_144 = ax_113 - 0x01;
		dx_229 = dx_105;
		if (ax_144 == 0x00)
			dx_229 = SEQ(dh_147 - 0x01, dl_233);
		byte al_180 = (byte) ax_144 - 0x01;
		if (ax_144 == 0x01)
		{
			bci8 al_169 = cs->*si_138;
			struct Eq_228 Eq_8::* si_170 = si_138 + 1;
			bx = bx_134;
			if ((al_169 & 0x40) != 0x00)
				continue;
			(cs->*si_170).bFFFFFFFF = (cs->*si_170).bFFFFFFFF ^ 0x80;
			byte al_179 = al_169 >> 0x07 & 0x0A;
			0xB800->*di_137 = al_179 + 0x23;
			al_180 = al_179 + 0x23;
		}
		bx = bx_134;
	} while (al_180 != 229);
	msdos_terminate_program20();
}

// 0C00:0181: Register cui16 fn0C00_0181(Register ptr16 dx, Register byte bh, Register word16 bp, Register (ptr16 Eq_109) es, Register (ptr16 Eq_8) ds, Register out ptr16 dxOut, Register out (ptr16 Eq_202) bxOut, Register out Eq_203 siOut, Register out Eq_204 diOut)
// Called from:
//      fn0C00_0100
//      fn0C00_0181
cui16 fn0C00_0181(ptr16 dx, byte bh, word16 bp, struct Eq_109 * es, struct Eq_8 * ds, ptr16 & dxOut, struct Eq_202 & bxOut, union Eq_203 & siOut, union Eq_204 & diOut)
{
	struct Eq_202 * bx;
	cui16 ax;
	Eq_204 di;
	Eq_203 si;
	cu8 dl = (byte) dx;
	cu8 dh = SLICE(dx, byte, 8);
	byte bh = SLICE(bx, byte, 8);
	struct Eq_202 * bx_137 = bx;
	if (dl < 0x50)
	{
		bx_137 = bx;
		if (dh < 0x19)
		{
			word16 dx_16;
			struct Eq_275 Eq_8::* si_17;
			cui16 ax_26 = SEQ(SLICE((uint16) fn0C00_01E8(dx, out dx_16, out si_17, out di), byte, 8), (ds->*si_17).b0000);
			si = &si_17->b0001;
			uint16 ax_136 = ax_26 & 0xFF;
			bx_137 = bx;
			if ((ax_26 & 0xFF) == 0x00)
			{
				(ds->*si_17).b0000 |= 0x40;
				byte al_36 = (ds->*si_17).bFFFFFFFF + (ds->*si_17).b0001;
				bx_137 = SEQ(bh, 0x50);
				do
				{
					al_36 = al_36 + Mem33[ds:bx_137 + (si_17 + 1):byte] + Mem33[ds:(bx_137 - 1) + (si_17 + 1):byte] + Mem33[ds:(bx_137 - 2) + (si_17 + 1):byte];
					bx_137 = -bx_137;
				} while (bx_137 < 0x00);
				if ((al_36 & 0x0F) == 0x00)
				{
					es->*di = 0x20;
					word16 dx_238;
					word16 bx_239;
					word16 si_240;
					word16 di_241;
					fn0C00_0181(dx_16 - 0x01, bh, bp, es, ds, out dx_238, out bx_239, out si_240, out di_241);
					word16 dx_83;
					word16 bx_242;
					word16 si_243;
					word16 di_244;
					fn0C00_0181(dx, bh, bp, es, ds, out dx_83, out bx_242, out si_243, out di_244);
					word16 dx_91;
					word16 bx_245;
					word16 si_246;
					word16 di_247;
					fn0C00_0181(dx_83 + 0x01, bh, bp, es, ds, out dx_91, out bx_245, out si_246, out di_247);
					word16 dx_248;
					word16 bx_249;
					word16 si_250;
					word16 di_251;
					fn0C00_0181(dx_91 + 0x01, bh, bp, es, ds, out dx_248, out bx_249, out si_250, out di_251);
					word16 dx_252;
					word16 bx_253;
					word16 si_254;
					word16 di_255;
					fn0C00_0181(dx, bh, bp, es, ds, out dx_252, out bx_253, out si_254, out di_255);
					word16 dx_119;
					word16 bx_256;
					word16 si_257;
					word16 di_258;
					fn0C00_0181(dx, bh, bp, es, ds, out dx_119, out bx_256, out si_257, out di_258);
					word16 dx_127;
					word16 bx_259;
					word16 si_260;
					word16 di_261;
					fn0C00_0181(dx_119 - 0x01, bh, bp, es, ds, out dx_127, out bx_259, out si_260, out di_261);
					word16 dx_262;
					word16 si_263;
					word16 di_264;
					ax_136 = fn0C00_0181(dx_127 - 0x01, bh, bp, es, ds, out dx_262, out bx_137, out si_263, out di_264);
				}
				else
				{
					byte al_56 = (al_36 & 0x0F) + 0x30;
					es->*di = al_56;
					ax_136 = (uint16) al_56;
				}
				di = (word16) di + 1;
				if (bp == 0x01)
				{
l0C00_01E6:
					msdos_terminate_program20();
				}
			}
			ax = ax_136 - 0x01;
			if (ax == 0x00)
			{
				es->*di = 0x2A;
				goto l0C00_01E6;
			}
		}
	}
	dxOut = dx;
	bxOut = bx_137;
	siOut = si;
	diOut = di;
	return ax;
}

// 0C00:01E8: Register byte fn0C00_01E8(Register ptr16 dx, Register out ptr16 dxOut, Register out ptr16 siOut, Register out Eq_132 diOut)
// Called from:
//      fn0C00_0100
//      fn0C00_0181
byte fn0C00_01E8(ptr16 dx, ptr16 & dxOut, ptr16 & siOut, union Eq_132 & diOut)
{
	word16 si;
	byte dh = SLICE(dx, byte, 8);
	int16 ax_6 = (int16) dh;
	dxOut = dx;
	int16 ax_13 = ax_6 *s 0x50 + dx;
	siOut = SEQ(SLICE(ax_13, byte, 8) - dh, (byte) ax_13) + 0x0251;
	diOut = (ax_6 *s ~0xAF + dx) * 0x02;
	return SLICE(si, byte, 8);
}

