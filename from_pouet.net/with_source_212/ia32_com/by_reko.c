// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register byte ch, Register word16 bp, Register (ptr16 Eq_5) ds)
void fn0C00_0100(byte ch, word16 bp, struct Eq_5 * ds)
{
	__syscall<byte>(0x10);
	__out<byte>(0x03D4, 0x09);
	__out<byte>(0x03D5, 0x00);
	__out<byte>(0x03CE, 0x06);
	__out<byte>(0x03CF, 0x01);
	__out<byte>(0x03C8, 0x00);
	word16 ax_19 = 0x00;
	do
	{
		word16 cx_319 = SEQ(ch, 0x03);
		do
		{
			byte al_53 = (byte) ax_19;
			uint8 cl_59 = (byte) cx_488 - 0x01;
			if ((al_53 & 0x40) != 0x00)
			{
				al_53 &= 0x3F;
				cl_59 = cl_59 >> 0x01 ^ 0x01;
			}
			uint8 al_67 = al_53 << cl_59;
			uint8 al_68 = al_67 >> 0x01;
			if (al_67 >> 0x01 > 0x3F)
				al_68 = 0x3F;
			__out<byte>(969, al_68);
			word16 bp_286 = bp;
			ci8 al_97 = (byte) ax_19;
			byte ah_312 = SLICE(ax_19, byte, 8);
			cx_319 = cx_488 - 0x01;
			ch = SLICE(cx_488 - 0x01, byte, 8);
			cx_488 = cx_319;
		} while (cx_488 != 0x01);
		ax_19 = SEQ(ah_312, al_97 + 0x01);
	} while (al_97 >= ~0x00);
	struct Eq_84 Eq_5::* di_107 = &Eq_5::t0000;
	real64 rLoc2_398 = (real64) ds->w01F8;
	word16 cx_172 = SEQ(ch, 200);
	do
	{
		real64 rLoc3_399 = (real64) ds->w01F6;
		word16 dx_130;
		for (dx_130 = 0x0140; dx_130 != 0x00; --dx_130)
		{
			real64 rLoc4_409 = sqrt(rLoc2_398 * rLoc2_398 + rLoc3_399 * rLoc3_399) / (real64) ds->w01F6 + (real64) ds->r01F2;
			(0x7000->*di_107).w0000 = (int16) (rLoc3_399 / rLoc4_409 + rLoc3_399);
			di_107[504] = (struct Eq_84) (int16) (rLoc2_398 / rLoc4_409 + rLoc2_398);
			rLoc3_399 += 1.0;
			++di_107;
		}
		rLoc2_398 += 1.0;
		--cx_172;
	} while (cx_172 != 0x00);
	do
	{
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) == 0x00);
		struct Eq_157 * es_188 = 0xA000;
		struct Eq_159 Eq_5::* si_198 = &Eq_5::t0000;
		cu16 cx_482 = 400;
		uint8 * gs_di_485 = 8000:0000;
		do
		{
			byte cl_201 = (byte) cx_489;
			cui16 dx_280 = 0x0140;
			uint8 * gs_di_478 = gs_di_485;
			if ((cl_201 & 0x01) != 0x00)
			{
				si_198 -= 0x0140;
				dx_280 = 0x0140;
				gs_di_478 = gs_di_485;
			}
			do
			{
				word16 ax_218 = SEQ((ds->*si_198).b01F8, (0x7000->*si_198).b0000) + bp_286;
				byte ah_220 = SLICE(ax_218, byte, 8);
				uint8 Eq_157::* di_246 = (word16) gs_di_478;
				struct Eq_181 * gs_243 = SLICE(gs_di_478, selector, 16);
				byte dl_230 = (byte) dx_280;
				uint8 al_222 = ((byte) ax_218 | ah_220) >> 0x01;
				if ((cx_489 >= 0x018D || cx_489 <= 0x04) && (dl_230 & 0x04) == 0x00)
				{
					al_222 = 0x00;
					ah_220 = 0x00;
				}
				*gs_di_478 = al_222;
				es_188->*di_246 = al_222;
				if (di_246 == &Eq_157::bFFFF)
				{
					es_188 = 0xB000;
					gs_243 = 0x9000;
				}
				--dx_280;
				si_198 = &si_198->b0000 + 1;
				byte dl_293 = (byte) dx_280;
				gs_di_478 = &(gs_243->*(di_246 + 1));
			} while (dx_280 != 0x00);
			bp_286 = ~bp_286;
			cx_482 = SEQ(SLICE(cx_489 - 0x01, byte, 8), cl_201 - 0x01);
			gs_di_485 = &(gs_243->*(di_246 + 1));
			cx_489 = cx_482;
		} while (cx_489 != 0x01);
		ds->b01AE = dl_293;
		bp_286 += 0x0101;
	} while (SEQ(ah_220, __in<byte>(0x60)) != 0x01);
}

