// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register int16 cx, Register (memptr (ptr16 Eq_23) byte) di, Register (ptr16 Eq_5) ds)
void fn0C00_0100(int16 cx, byte Eq_23::* di, struct Eq_5 * ds)
{
	bios_video_set_mode(0x13);
	byte ah_271 = 0x00;
	do
	{
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) == 0x00);
		do
		{
			byte al_25 = 0x9000->*di;
			0x9000->*di = ah_271;
			0xA00A->*di = al_25;
			--cx;
			++di;
			byte ch_318 = SLICE(cx, byte, 8);
		} while (cx != 0x00);
		di = &Eq_23::b0000;
		do
		{
			cx = SEQ(ch_318, 0x30);
			do
			{
				int16 bp_248;
				for (bp_248 = 0x20; bp_248 != 0x00; --bp_248)
				{
					int16 cx_48 = (cx_468 - 0x18) *s bp_248;
					int16 bx_51 = bp_248 *s 0x18;
					int16 dx_54 = bp_248 *s ~0x0B;
					bcu8 al_59 = (byte) di;
					int16 cx_49 = cx_48 >> 0x05;
					int16 bx_52 = bx_51 >> 0x05;
					int16 dx_56 = (dx_54 >> 0x05) + 0x24;
					Eq_73 al_104 = al_59 >> 0x02;
					if (al_59 >> 0x02 >= 0x03)
					{
						cx_49 = -(cx_48 >> 0x05);
						bx_52 = -(bx_51 >> 0x05);
						dx_56 = -((dx_54 >> 0x05) + 0x24);
						al_104 = (al_59 >> 0x02) - 0x03;
					}
					if (!__bt<word16>(di, 0x01))
						bx_52 = -bx_52;
					ds->w03DA = cx_49;
					ds->w03DC = bx_52;
					ds->w03DE = dx_56;
					real64 rLoc1_364 = (real64) ds->w03DE;
					real64 rLoc2_365 = (real64) ds->w03DC;
					real64 rLoc3_366 = (real64) ds->w03DA;
					if (!__bt<word16>(di, 0x00))
					{
						rLoc3_366 = rLoc2_365;
						rLoc2_365 = rLoc3_366;
					}
					if (al_104 != 0x01)
					{
						rLoc3_366 = rLoc2_365;
						rLoc2_365 = rLoc3_366;
					}
					if (al_104 >= 0x01)
					{
						rLoc3_366 = rLoc1_364;
						rLoc1_364 = rLoc3_366;
					}
					if (al_104 == 0x02)
					{
						rLoc3_366 = rLoc2_365;
						rLoc2_365 = rLoc3_366;
					}
					byte al_128;
					for (al_128 = 0x03; al_128 != 0x00; --al_128)
					{
						real64 rLoc4_383 = (real64) ds->w03D8;
						real64 rLoc4_384 = cos(rLoc4_383);
						real64 rLoc5_385 = sin(rLoc4_383);
						real64 rLoc3_399 = rLoc5_385 * rLoc2_365 + rLoc4_384 * rLoc3_366;
						real64 rLoc6_392 = rLoc3_366 * rLoc5_385 - rLoc2_365 * rLoc4_384;
						rLoc1_364 = rLoc3_399;
						rLoc3_366 = rLoc6_392;
						rLoc2_365 = rLoc1_469;
						rLoc1_469 = rLoc1_364;
					}
					ds->w03DE = (int16) rLoc6_392;
					ds->w03DC = (int16) rLoc1_469;
					ds->w03DA = (int16) rLoc3_399;
					byte al_186 = (byte) di;
					Eq_153 bx_179 = ds->w03DC *s 0x0140 + ds->w03DA;
					byte al_187 = al_186 & 0x01;
					if (ds->w03DE <= SEQ(SLICE(di, byte, 8), al_186 & 0x01))
					{
						if ((al_186 & 0x01) >> 0x01 < 0x00)
							goto l0C00_01DF;
						al_187 = 0x02;
					}
					byte al_197 = al_187 + 0x40;
					word16 cx_199;
					for (cx_199 = 0x02; cx_199 != 0x00; --cx_199)
					{
						0x9000->*((word16) bx_179 + 32000) |= al_197;
						0x9000->*((word16) bx_179 + 32320) |= al_197;
						bx_179 = (word16) bx_179 + 1;
					}
l0C00_01DF:
				}
				cx = cx_468 - 0x01;
				ch_318 = SLICE(cx_468 - 0x01, byte, 8);
				cx_468 = cx;
			} while (cx_468 != 0x01);
			++di;
		} while (di != &Eq_23::b0018);
		ds->w03D8 += 220;
		byte al_270;
	} while (bios_kbd_check_keystroke(out al_270, out ah_271));
}

