// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register byte ch, Register (ptr16 Eq_4) ds)
void fn0C00_0100(byte ch, struct Eq_4 * ds)
{
	__syscall<byte>(0x10);
	byte Eq_4::* si_21 = &Eq_4::b01FF;
	Eq_12 bx_13 = 0x01FF;
	word16 cx_17 = SEQ(ch, 0x10);
	do
	{
		--si_21;
		ds->*bx_13 = ds->*si_21;
		--cx_17;
		bx_13 = (word16) bx_13 + 1;
		byte ch_280 = SLICE(cx_17, byte, 8);
	} while (cx_17 != 0x00);
	word16 cx_281 = SEQ(ch_280, 0x20);
	do
	{
		ds->*bx_13 = -(ds->*si_21);
		--cx_281;
		++si_21;
		bx_13 = (word16) bx_13 + 1;
		byte ch_295 = SLICE(cx_281, byte, 8);
	} while (cx_281 != 0x00);
	do
	{
		byte ah_49 = 0040:006C;
		do
			;
		while (ah_49 == 0040:006C);
		Eq_61 bx_58 = (word16) bx_13 + 1;
		byte bl_302 = (byte) bx_58 & 0x3F;
		byte Eq_85::* di_268 = &Eq_85::bAA00;
		word16 cx_275 = SEQ(ch_295, 0x80 - ds->*((word16) (bx_58 & 0x3F) + 495));
		while (true)
		{
			byte ch_299 = SLICE(cx_275, byte, 8);
			if (cx_275 == 0x00)
				break;
			0xA000->*di_268 = 0x1D;
			++di_268;
			--cx_275;
		}
		word16 cx_269 = SEQ(ch_299, 0x0F);
		while (true)
		{
			byte ch_303 = SLICE(cx_269, byte, 8);
			if (cx_269 == 0x00)
				break;
			0xA000->*di_268 = 22;
			++di_268;
			--cx_269;
		}
		byte al_75 = (bl_302 & 0x04) + 22;
		0xA000->*di_268 = al_75;
		byte Eq_85::* di_80 = di_268 + 1;
		0xA000->*di_80 = al_75;
		byte Eq_85::* di_257 = di_80 + 1;
		word16 cx_265;
		for (cx_265 = SEQ(ch_303, 0x0F); cx_265 != 0x00; --cx_265)
		{
			0xA000->*di_257 = 22;
			++di_257;
		}
		word16 cx_260 = 0xAB40 - di_257;
		while (true)
		{
			byte ch_318 = SLICE(cx_260, byte, 8);
			if (cx_260 == 0x00)
				break;
			0xA000->*di_257 = 0x1D;
			++di_257;
			--cx_260;
		}
		word16 di_102 = 0xF8C0;
		word16 cx_106 = SEQ(ch_318, 0x3F);
		do
		{
			struct Eq_216 Eq_85::* si_114 = di_102 - 0x0140;
			memcpy(di_102, si_114, 0x0140);
			0xA000->*((char *) si_114 + 320) = 0xA000->*((char *) si_114 + 320);
			struct Eq_174 Eq_85::* si_119 = (char *) si_114 + 320;
			if (0xA000->*((char *) si_114 + 320) != 0x00)
			{
				do
				{
					si_119 = si_380 + 1;
					si_380 = si_119;
				} while ((0xA000->*si_380).b0000 != 22);
				(0xA000->*si_119).bFFFFFFFD = 22;
				(0xA000->*si_119).bFFFFFFFE = 22;
				struct Eq_194 Eq_85::* si_138 = si_119 + 310;
				do
				{
					si_138 = si_381 - 0x01;
					si_381 = si_138;
				} while ((0xA000->*si_381).b0000 != 22);
				si_138[2] = (struct Eq_194) 22;
				si_138[3] = (struct Eq_194) 22;
			}
			di_102 -= 0x0140;
			cx_106 = cx_379 - 0x01;
			byte ch_331 = SLICE(cx_379 - 0x01, byte, 8);
			cx_379 = cx_106;
		} while (cx_379 != 0x01);
		byte Eq_85::* bx_177 = &Eq_85::b013F;
		do
		{
			byte ah_178 = 0x00;
			cu8 al_179 = __in<byte>(0x40);
			if (al_179 >= ~0x07)
				ah_178 = al_179 & 0x0F | 0x10;
			0xA000->*bx_177 = ah_178;
			--bx_177;
		} while (bx_177 != Eq_85::a0000);
		bx_13 = bx_58 & 0x3F;
		word16 di_216 = 0xA8C0;
		word16 cx_221 = SEQ(ch_331, 0x87);
		do
		{
			memcpy(di_216, di_216 - 0x0141 + (uint16) (__in<byte>(0x40) & 0x03), 0x0140);
			di_216 = (<unknown>*) (di_216 - 0x0140);
			cx_221 = cx_382 - 0x01;
			ch_295 = SLICE(cx_382 - 0x01, byte, 8);
			cx_382 = cx_221;
		} while (cx_382 != 0x01);
	} while (__in<byte>(0x60) != 0x01);
	byte al_248;
	bios_kbd_get_keystroke(out al_248);
	byte bl_252;
	byte ch_253;
	byte cl_254;
	bios_video_get_EGA_info(out bl_252, out ch_253, out cl_254);
}

