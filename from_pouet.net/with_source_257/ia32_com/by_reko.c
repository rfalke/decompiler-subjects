// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register byte ah, Register byte ch, Register word16 bx, Register (ptr16 Eq_6) ds)
void fn0C00_0100(byte ah, byte ch, word16 bx, struct Eq_6 * ds)
{
	struct Eq_7 * Top_119 = 0;
	__syscall<byte>(0x10);
	ds->w0200 = 63036;
	__out<byte>(0x03C8, (byte) ax_313);
	byte bh_241 = ah;
	do
	{
		byte al_28 = (byte) ax_315;
		__out<byte>(969, al_28);
		__out<byte>(969, al_28);
		__out<byte>(969, al_28);
		ax_313 = SEQ(SLICE(ax_315 + 0x01, byte, 8), al_28 + 0x01);
		ax_315 = ax_313;
	} while (ax_315 != ~0x00);
	word16 bp_129 = ax_315 + 0x01;
	do
	{
		struct Eq_7 * Top_41 = Top_119 - (struct Eq_389 *) 1;
		Top_41->r0000 = 0.0;
		int16 bx_121 = SEQ(bh_241, 0x32);
		do
		{
			Top_41->rFFFFFFFF = 0.0;
			word16 cx_117 = SEQ(ch, 200);
			do
			{
				ds->w020A = bx_121;
				Top_41->rFFFFFFFE = (real64) ds->w020A;
				Top_41->rFFFFFFFD = Top_41->r0000;
				Top_41->rFFFFFFFD *= Top_41->rFFFFFFFD;
				Top_41->rFFFFFFFD *= (real64) ds->w01F8;
				Top_41->rFFFFFFFC = Top_41->rFFFFFFFF;
				real64 v23_62 = Top_41->rFFFFFFFC;
				Top_41->rFFFFFFFC = cos(v23_62);
				Top_41->rFFFFFFFB = sin(v23_62);
				Top_41->rFFFFFFFA = Top_41->rFFFFFFFB;
				Top_41->rFFFFFFFA *= Top_41->rFFFFFFFA;
				Top_41->rFFFFFFFB *= Top_41->rFFFFFFFA;
				Top_41->rFFFFFFFB *= Top_41->rFFFFFFFD;
				real64 v25_73 = Top_41->rFFFFFFFB;
				Top_41->rFFFFFFFB = Top_41->rFFFFFFFC;
				Top_41->rFFFFFFFC = v25_73;
				Top_41->rFFFFFFFA = Top_41->rFFFFFFFB;
				Top_41->rFFFFFFFA *= Top_41->rFFFFFFFA;
				Top_41->rFFFFFFFB *= Top_41->rFFFFFFFA;
				Top_41->rFFFFFFFD *= Top_41->rFFFFFFFB;
				Top_41->rFFFFFFFB = Top_41->rFFFFFFFE;
				Top_41->rFFFFFFFA = Top_41->rFFFFFFFD;
				Top_41->rFFFFFFF9 = Top_41->rFFFFFFFC;
				ds->w0204 = ~0x4A;
				byte bl_96 = (byte) bx_121;
				fn0C00_01B9(&ds->w0200, bl_96, bp_129, 0x9000, Top_41->rFFFFFFF9, Top_41->rFFFFFFFA, Top_41->rFFFFFFFB);
				ds->w0204 = 65511;
				uint8 ah_172 = SLICE((uint16) fn0C00_01B9(&ds->w0200, bl_96, bp_129, 0x9000, Top_41->rFFFFFFFC, Top_41->rFFFFFFFD, Top_41->rFFFFFFFE), byte, 8);
				Top_41->rFFFFFFFF += (real64) ds->r01F0;
				--cx_117;
				ch = SLICE(cx_117, byte, 8);
			} while (cx_117 != 0x00);
			__ffree(Top_41->rFFFFFFFF);
			Top_41->r0000 += (real64) ds->r01F4;
			Top_119 = Top_41;
			--bx_121;
		} while (bx_121 != 0x00);
		++ds->w0200;
		if (ds->w0200 == 5050)
		{
			ds->w0200 = 63036;
			bp_129 = ~bp_129;
		}
		Eq_321 di_162 = 0x00;
		do
		{
			uint16 ah_al_281 = SEQ(ah_172, 0x9000->*di_162) + (uint16) (0x9000->*((word16) di_162 + 1)) + (uint16) (0x9000->*((word16) di_162 + 0x0141));
			<unknown> Eq_226::* bx_179 = &Eq_226::t00A0;
			if ((ds->b0201 & 0x02) == 0x00)
				bx_179 = &Eq_226::t0140;
			ui16 ah_al_277 = ah_al_281 + CONVERT(Mem168[0x9000:bx_179 + di_162:byte], byte, uint16);
			0xA000->*di_162 = (byte) (ah_al_277 >> 0x02);
			ah_172 = SLICE(ah_al_277 >> 0x02, byte, 8);
			0x9000->*di_162 = ah_172;
			di_162 = (word16) di_162 + 1;
		} while (di_162 != 0x00);
		bh_241 = SLICE(bx_121, byte, 8);
		ch = SLICE(cx_117, byte, 8);
	} while (__in<byte>(0x60) != 0x01);
}

// 0C00:01B9: Register byte fn0C00_01B9(Sequence (ptr32 Eq_223) ds_si, Register byte bl, Register word16 bp, Register (ptr16 Eq_226) fs, FpuStack real64 rArg0, FpuStack real64 rArg1, FpuStack real64 rArg2)
// Called from:
//      fn0C00_0100
byte fn0C00_01B9(struct Eq_223 * ds_si, byte bl, word16 bp, struct Eq_226 * fs, real64 rArg0, real64 rArg1, real64 rArg2)
{
	word16 di;
	real64 rArg0_66 = (rArg2 + (real64) ds_si->w0004 + (real64) ds_si->wFFFFFFFA) / (real64) ds_si->wFFFFFFFC;
	real64 rArg2_67 = (rArg1 + (real64) ds_si->w0000) * rArg0_66;
	ds_si->t0008.u0 = (int16) ((rArg0 + (real64) ds_si->w0000) * rArg0_66 + (real64) ds_si->wFFFFFFFA);
	real64 rArg2_70 = rArg2_67 + (real64) (ds_si->tFFFFFFFE).u0;
	if (bp != 0x00)
		rArg2_70 = -rArg2_70;
	ds_si->t0006.u0 = (int16) rArg2_70;
	ds_si->t0006.u0[ds_si->tFFFFFFFE.u0 * (ds_si->t0008).u0].b0000 = bl;
	return SLICE(di, byte, 8);
}

