// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register word16 cx, Register Eq_4 bx, Register (ptr16 Eq_5) ds)
void fn0C00_0100(word16 cx, Eq_4 bx, struct Eq_5 * ds)
{
	__syscall<byte>(0x10);
	struct Eq_11 * es_137 = ds->*((word32) bx + 2);
	do
	{
		byte al_16 = (byte) (~cx >> 0x02);
		__out<byte>(969, al_16);
		__out<byte>(969, al_16);
		__out<byte>(969, al_16);
		--cx;
	} while (cx != 0x00);
	do
	{
		cu16 cx_18 = 9000;
		do
		{
			ds->t01FF.u0 = 0x32;
			ds->t01FF -= cx_18 >> 0x03;
			real64 rLoc1_138 = (real64) ds->r01C6;
			ds->w0203 = (int16) (sin(rLoc1_138) * (real64) ds->t01FF);
			ds->t0205.u0 = (int16) (cos(rLoc1_138) * (real64) ds->t01FF);
			ds->r01C6 = (real32) (rLoc1_138 + (real64) ds->r01CA);
			ds->w0203 += 0xA0;
			ds->t0205 = (word16) ds->t0205 + 100;
			Eq_4 ax_54 = ds->t0205 * 0x0140 + ds->w0203;
			if (SLICE(ax_54, byte, 8) <= ~0x05)
			{
				ds->*((word16) ax_54 + 519) = ds->t01FF;
				bx = ax_54;
				ax_54 = bx;
			}
			--cx_18;
			byte ch_76 = SLICE(cx_18, byte, 8);
		} while (cx_18 != 0x00);
		ds->r01C6 = (real32) ((real64) ds->r01C6 - (real64) ds->r01CE);
		word16 cx_79;
		word16 cx_89;
		word16 cx_99;
		word16 bx_162;
		word16 bx_163;
		fn0C00_019B(fn0C00_019B(fn0C00_019B(ax_54, ch_76, ds, out cx_79, out bx_162), SLICE(cx_79, byte, 8), ds, out cx_89, out bx_163), SLICE(cx_89, byte, 8), ds, out cx_99, out bx);
		memcpy(*es_137, ds->a0207[0], SEQ(0x7D, (byte) cx_99) *32 0x02);
	} while (__in<byte>(0x60) != 0x01);
	bios_video_set_mode(0x03);
	msdos_display_string(&ds->r01CE + 1);
}

// 0C00:019B: Register uint16 fn0C00_019B(Register Eq_4 eax, Register byte ch, Register (ptr16 Eq_5) ds, Register out ptr16 cxOut, Register out Eq_156 bxOut)
// Called from:
//      fn0C00_0100
uint16 fn0C00_019B(Eq_4 eax, byte ch, struct Eq_5 * ds, ptr16 & cxOut, union Eq_156 & bxOut)
{
	uint16 ax;
	byte dh_42 = SLICE(ax *32 0x00, byte, 24);
	struct Eq_208 Eq_5::* si_10 = &Eq_5::tF780;
	do
	{
		Eq_156 bx_22 = (uint16) si_10[199];
		ptr16 cx_25 = SEQ(ch, si_10[520]);
		uint16 ax_32 = ((word16) bx_22.u0 + (uint16) si_10[839] + cx_25 + SEQ(dh_42, si_10[518]) >> 0x02) - 0x01;
		si_10[519] = (struct Eq_208) (byte) ax_32;
		--si_10;
	} while (si_10 != &Eq_5::t0000);
	cxOut = cx_25;
	bxOut = bx_22;
	return ax_32;
}

