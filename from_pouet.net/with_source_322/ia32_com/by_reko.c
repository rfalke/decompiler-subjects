// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register cu8 cl, Register (ptr16 Eq_4) ds)
void fn0C00_0100(cu8 cl, struct Eq_4 * ds)
{
	Eq_5 Top_137 = 0;
	bios_video_set_mode(0x13);
	byte ah_245 = 0x00;
	do
	{
		++ds->b02F6;
		++ds->b02F7;
		fn0C00_02E0(cl, ds, out cl);
	} while (ds->b02F6 < 0x3F);
	do
	{
		--ds->b02F7;
		--ds->b02F6;
		++ds->b02F8;
		fn0C00_02E0(cl, ds, out cl);
	} while (ds->b02F6 > 0x2D);
	do
	{
		++ds->b02F8;
		fn0C00_02E0(cl, ds, out cl);
	} while (ds->b02F8 < 0x3F);
	do
		cl_312 = cl;
	while (fn0C00_02E0(cl_312, ds, out cl));
	ui16 cx_67;
	for (cx_67 = 0x0800; cx_67 != 0x00; --cx_67)
	{
		word16 si_311;
		ah_245 = SLICE((uint16) fn0C00_0227(ah_245, cx_67, ds, out si_311), byte, 8);
	}
	while (true)
	{
		ui16 cx_178;
		for (cx_178 = 0x0800; cx_178 != 0x00; --cx_178)
		{
			ds->t6308.u0 = 0x00;
			Eq_107 ax_83 = cx_178 << 0x01;
			byte ah_106 = SLICE((uint16) fn0C00_0273(ax_83, 0xA000, ds), byte, 8);
			word16 v22_102 = ds->a22FE[0][cx_178] - 0x01;
			ds->a22FE[0][cx_178] = v22_102;
			Eq_107 si_110 = ax_83;
			if (v22_102 == 0x00)
				fn0C00_0227(ah_106, cx_178, ds, out si_110);
			if (ds->*((word16) si_110 + 0x000032FE) != ~0x00)
				ds->*((word16) si_110 + 0x000032FE) = (word16) (ds->*((word16) si_110 + 0x000032FE)) + 1;
			ds->t6308 = ds->*((word16) si_110 + 0x000032FE);
			__fninit();
			struct Eq_128 * Top_138 = Top_137 - 1;
			Top_138->r0000 = 3.141592653589793;
			Top_138->r0000 *= (real64) ds->t02FB;
			Top_138->r0000 /= (real64) ds->w02F9;
			real64 v26_142 = Top_138->r0000;
			Top_138->r0000 = cos(v26_142);
			Top_138->rFFFFFFFF = sin(v26_142);
			Top_138->rFFFFFFFE = Top_138->r0000;
			Top_138->rFFFFFFFE *= (real64) (ds->*((word16) si_110 + 4862));
			Top_138->rFFFFFFFD = Top_138->rFFFFFFFF;
			Top_138->rFFFFFFFD *= (real64) (ds->*((word16) si_110 + 766));
			Top_138->rFFFFFFFD -= Top_138->rFFFFFFFE;
			ds->*((word16) si_110 + 17150) = (int16) Top_138->rFFFFFFFD;
			real64 v29_156 = Top_138->rFFFFFFFD;
			Top_138->rFFFFFFFD = Top_138->rFFFFFFFF;
			Top_138->rFFFFFFFF = v29_156;
			Top_138->rFFFFFFFD *= (real64) (ds->*((word16) si_110 + 4862));
			Top_138->rFFFFFFFC = Top_138->r0000;
			Top_138->rFFFFFFFC *= (real64) (ds->*((word16) si_110 + 766));
			Top_138->rFFFFFFFC += Top_138->rFFFFFFFD;
			ds->*((word16) si_110 + 21246) = (int16) Top_138->rFFFFFFFC;
			fn0C00_0273(si_110, 0xA000, ds);
			Top_137 = Top_138 - (struct Eq_297 *) 4;
		}
		if (ds->b02FD >= 0x02 && ds->b02FD <= 0x03)
		{
			ds->t02FB = (word16) ds->t02FB + 1;
			if (ds->t02FB >= 0x0169)
				ds->t02FB.u0 = 0x01;
		}
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) != 0x00);
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) == 0x00);
		byte al_202;
		byte ah_203;
		if (!bios_kbd_check_keystroke(out al_202, out ah_203))
		{
			byte al_205;
			bios_kbd_get_keystroke(out al_205);
			if (al_205 == 0x1B)
			{
				bios_video_set_mode(0x03);
				return;
			}
			++ds->b02FD;
			if (ds->b02FD >= 0x02)
			{
				word16 cx_221;
				word16 Eq_293::* di_222 = Eq_293::a0000;
				for (cx_221 = 0x7D00; cx_221 != 0x00; --cx_221)
				{
					0xA000->*di_222 = 0x00;
					++di_222;
				}
				if (ds->b02FD >= 0x04)
					ds->b02FD = 0x00;
			}
		}
	}
}

// 0C00:0214: Register byte fn0C00_0214(Register byte ah, Register (ptr16 Eq_4) ds)
// Called from:
//      fn0C00_0227
byte fn0C00_0214(byte ah, struct Eq_4 * ds)
{
	byte ah_6 = ah + __in<byte>(0x40);
	byte al_7 = __in<byte>(0x40);
	int16 bx_11 = ds->w6309;
	Eq_454 dx_ax_13 = (uint32) SEQ(ah_6, al_7);
	ds->w6309 = (int16) (dx_ax_13 % bx_11);
	return SLICE((int16) (dx_ax_13 /16 bx_11), byte, 8);
}

// 0C00:0227: Register byte fn0C00_0227(Register byte ah, Register ui16 cx, Register (ptr16 Eq_4) ds, Register out Eq_96 siOut)
// Called from:
//      fn0C00_0100
byte fn0C00_0227(byte ah, ui16 cx, struct Eq_4 * ds, union Eq_96 & siOut)
{
	ds->a32FE[0].b0000[cx].b0000 = 0x00;
	ds->w6309 = 0xA0;
	byte ah_32 = SLICE((uint16) fn0C00_0214(ah, ds), byte, 8);
	ds->w6309 -= 0x50;
	ds->a02FE[0][cx] = ds->w6309;
	ds->w6309 = 100;
	byte ah_49 = SLICE((uint16) fn0C00_0214(ah_32, ds), byte, 8);
	ds->w6309 -= 0x32;
	ds->a12FE[0][cx] = ds->w6309;
	ds->w6309 = 100;
	uint16 ax_50 = (uint16) fn0C00_0214(ah_49, ds);
	ds->w6309 += 100;
	ds->a22FE[0][cx] = ds->w6309;
	siOut = cx << 0x01;
	return SLICE(ax_50, byte, 8);
}

// 0C00:0273: Register byte fn0C00_0273(Register Eq_107 si, Register (ptr16 Eq_293) es, Register (ptr16 Eq_4) ds)
// Called from:
//      fn0C00_0100
byte fn0C00_0273(Eq_107 si, struct Eq_293 * es, struct Eq_4 * ds)
{
	if (ds->*((word16) si + 8958) == 0x00)
		ds->*((word16) si + 8958) = (word16) (ds->*((word16) si + 8958)) + 1;
	ds->t6304 = (int16) (ds->*((word16) si + 17150) *s32 100 /16 ds->*((word16) si + 8958)) + 0xA0;
	ds->t6306 = (int16) (ds->*((word16) si + 21246) *s32 100 /16 ds->*((word16) si + 8958)) + 100;
	Eq_587 ax_39 = (word16) ds->t6304 + ds->t6306 *s 0x0140;
	byte ah_63 = SLICE(ax_39, byte, 8);
	if (ds->t6304 <= 0x013F && ds->t6306 <= 199)
	{
		Eq_111 al_45 = ds->t6308;
		es->*ax_39 = al_45;
		ax_39 = SEQ(ah_63, al_45);
		if (ds->b02FD != 0x00)
		{
			ax_39 = SEQ(ah_63, al_45);
			if (ds->b02FD != 0x03)
			{
				es->*((word16) ax_39 + 1) = al_45;
				es->*((word16) ax_39 + 320) = al_45;
				es->*((word16) ax_39 + 0x0141) = al_45;
				ax_39 = SEQ(ah_63, al_45);
			}
		}
	}
	return SLICE(ax_39, byte, 8);
}

// 0C00:02E0: FlagGroup bool fn0C00_02E0(Register cu8 cl, Register (ptr16 Eq_4) ds, Register out Eq_32 clOut)
// Called from:
//      fn0C00_0100
bool fn0C00_02E0(cu8 cl, struct Eq_4 * ds, union Eq_32 & clOut)
{
	__out<byte>(0x03C8, cl);
	__out<byte>(969, ds->b02F6);
	__out<byte>(969, ds->b02F7);
	__out<byte>(969, ds->b02F8);
	clOut = cl + 0x01;
	return SLICE(cond(cl + 0x01), bool, 2);
}

