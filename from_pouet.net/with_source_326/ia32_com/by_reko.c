// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register byte ch, Register (memptr (ptr16 Eq_5) Eq_4) bx, Register (ptr16 Eq_5) es, Register (ptr16 Eq_5) ds)
void fn0C00_0100(byte ch, struct Eq_4 Eq_5::* bx, struct Eq_5 * es, struct Eq_5 * ds)
{
	struct Eq_7 * ss;
	struct Eq_8 * cs;
	Eq_9 Top_215 = 0;
	__syscall<byte>(0x10);
	byte al_334 = 0x13;
	do
	{
		word16 ax_8 = __aam(al_334);
		bx[1667] = (struct Eq_4) (byte) ax_8;
		word16 ax_15 = __aad(bx + ax_8);
		++bx;
		al_334 = (byte) ax_15;
		cu8 bh_17 = SLICE(bx, byte, 8);
	} while (bh_17 != 151);
	word16 cx_207 = SEQ(ch, 0x06);
	do
	{
		struct Eq_45 Eq_5::* di_45 = Eq_5::a0683;
		int16 bx_350 = SEQ(0x01, (byte) bx);
		word16 cx_358 = SEQ(151, (byte) cx_473);
		do
		{
			cup16 ax_55 = (word16) di_45[bx_350].t0000 + ((ds->*di_45).t0000).u1 + (word16) (bh_17 < 151);
			(es->*di_45).t0000.u0 = (byte) ((byte) ax_55 + SLICE(ax_55, byte, 8) + (byte) (ax_55 < 0x00) >> 0x02);
			++di_45;
			--cx_358;
		} while (cx_358 != 0x00);
		byte bl_359 = (byte) bx;
		byte ah_106 = SLICE(ax_15, byte, 8);
		cx_207 = cx_473 - 0x01;
		cx_473 = cx_207;
	} while (cx_473 != 0x01);
	Eq_94 bx_127 = SEQ(0x2D, bl_359);
	do
	{
		Eq_49 al_92 = ds->*((word16) bx_127 + 1667);
		uint16 ax_97 = (al_92 & 0x03) *16 0x03;
		byte bl_109 = (byte) bx_127;
		cu16 ax_95 = SEQ(ah_106, al_92 & 0x03);
		byte al_104 = (byte) ax_97;
		ah_106 = SLICE(ax_97, byte, 8);
		if (SLICE(bx_127, byte, 8) > 0x10 && ax_95 >> 0x01 >= 0x00)
			ah_106 = al_104 + 0x41;
		if ((bl_109 & 0x01) == 0x00)
			al_104 = 0x01;
		ds->*((word16) bx_127 + 40323) = ah_106;
		ds->*((word16) bx_127 + 0x0000CA83) = al_104;
		--bx_127;
	} while (bx_127 >= 0x00);
	__out<byte>(0x0331, ~0x00);
	__out<byte>(0x0331, 0x3F);
	do
	{
		__out<byte>(0x0330, 0x90);
		__out<byte>(0x0330, ah_106);
		__out<byte>(0x0330, 0x7F);
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) != 0x00);
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) == 0x00);
		0040:004A = (byte *) 0x50;
		0040:0050 = (byte *) 0x0D;
		struct Eq_174 * ax_178 = SEQ(SLICE(cs, byte, 8) + 0x10, (byte) cs);
		byte Eq_174::* di_184 = Eq_174::a0000;
		do
		{
			byte v33_192 = ax_178->*di_184;
			ax_178->*di_184 = 0x10;
			0xA000->*di_184 = v33_192;
			--di_184;
		} while (di_184 != Eq_174::a0000);
		if (cx_207 != 0x00)
			msdos_display_string((char *) ds + 744);
		Eq_203 Top_216 = Top_215 - 1;
		Top_216.u1->r0000 = (real64) ss->w02FD;
		Top_216.u1->r0000 = fn0C00_0235((char *) ds + 758, &ss->b02FF, cx_207, Top_216.u1->r0000);
		ss->t0301.u0 = 100;
		Eq_234 di_232 = ~0x0600;
		do
		{
			Eq_242 Top_237 = Top_216 - 1;
			Top_237.u1->r0000 = Top_216.u1->r0000;
			Top_237.u1->r0000 /= (real64) ss->t0301;
			Top_237.u1->rFFFFFFFF = Top_237.u1->r0000;
			Top_237.u1->rFFFFFFFF *= (real64) ss->w02FB;
			ds->w0307 = (int16) Top_237.u1->rFFFFFFFF;
			Top_237.u1->r0000 *= (real64) ss->w02FA;
			Top_237.u1->r0000 = fn0C00_0235((char *) ds + 760, &ss->b02FF, cx_207, Top_237.u1->r0000);
			ds->t0305.u0 = (int16) Top_237.u1->r0000;
			Top_237.u1[1] = (struct Eq_675) Top_237.u1->r0001;
			Eq_312 ax_264 = ds->t0305;
			ds->w0303 = SEQ((byte) ax_264 - ds->b02FF, SLICE(ax_264, byte, 8));
			ds->w0581 = 0x0140;
			word16 dx_471;
			word16 cx_470;
			byte bl_472;
			ah_106 = SLICE((uint16) fn0C00_0244(&ss->b02FF, cx_207, 0x7FFF, 0x01, &Eq_5::t1283, di_232, ax_178, ds, out cx_470, out dx_471, out bl_472, out di_232), byte, 8);
			Eq_230 v39_288 = ss->t0301 - 0x01;
			ss->t0301 = v39_288;
			word16 bx_282 = <invalid>;
			byte cl_328 = (byte) cx_207;
			byte ch_398 = SLICE(cx_207, byte, 8);
			&Top_216.u1->r0000 = Top_237.u1 + 1;
			byte bl_414 = (byte) bx_282;
		} while (v39_288 != 0x00);
		Top_237.u1->r0003 = (real64) Top_237.u1[1];
		&Top_215.u1->r0000 = &Top_237.u1->r0003;
		if (__in<byte>(0x60) == 0x01)
			break;
		byte v40_298 = ss->b02FF + 0x01;
		ss->b02FF = v40_298;
		if (v40_298 != 0x00)
			continue;
		Eq_429 bx_304 = SEQ(0x20, bl_414);
		do
		{
			byte bh_307 = SLICE(bx_304, byte, 8);
			byte bl_313 = (byte) bx_304;
			byte al_306 = ds->*((word16) bx_304 + 4758);
			if ((bh_307 & ~0x07) == 0x00)
			{
				al_306 = 0x08;
				if (bl_313 != 0x03 && bh_307 != 0x03)
					al_306 = 0x00;
			}
			ds->*((word16) bx_304 + 55171) = al_306;
			--bx_304;
		} while (bx_304 >= 0x00);
		cx_207 = SEQ(ch_398, cl_328 + 0x80);
	} while (cl_328 != 0x80);
	bios_video_set_mode(0x03);
}

// 0C00:0235: FpuStack real64 fn0C00_0235(Sequence (ptr32 int16) ds_si, Sequence (ptr32 int16) ss_bp, Register word16 cx, FpuStack real64 rArg0)
// Called from:
//      fn0C00_0100
real64 fn0C00_0235(int16 * ds_si, int16 * ss_bp, word16 cx, real64 rArg0)
{
	if (cx == 0x00)
		return rArg0 + sin((real64) (*ss_bp) / (real64) (*ds_si)) * (real64) (*ds_si);
	return rArg0;
}

// 0C00:0244: Register byte fn0C00_0244(Sequence (ptr32 Eq_345) ss_bp, Register word16 cx, Register cui16 dx, Register Eq_348 bx, Register (memptr (ptr16 Eq_5) Eq_349) si, Register Eq_234 di, Register (ptr16 Eq_174) es, Register (ptr16 Eq_5) ds, Register out Eq_353 cxOut, Register out Eq_353 dxOut, Register out Eq_353 blOut, Register out Eq_234 diOut)
// Called from:
//      fn0C00_0100
//      fn0C00_0244
byte fn0C00_0244(struct Eq_345 * ss_bp, word16 cx, cui16 dx, Eq_348 bx, <unknown> Eq_5::* si, Eq_234 di, struct Eq_174 * es, struct Eq_5 * ds, union Eq_353 & cxOut, union Eq_353 & dxOut, union Eq_353 & blOut, union Eq_234 & diOut)
{
	do
	{
		byte ch_149 = SLICE(cx, byte, 8);
		cu16 ax_33 = ds->*((word16) bx + 771);
		if (es->*di == 0x10)
		{
			byte dl_39 = ds->*((char *) si + (ax_33 & dx));
			byte dl_40 = dl_39 + 0x10;
			ci8 bh_54 = SLICE(bx - 0x01, byte, 8);
			if (bx != 0x01)
			{
				byte al_55 = 0x0F;
				ci8 ah_63 = 0x0D;
				if (cx != 0x00)
				{
					if (fn0C00_02CA(ss_bp, 0x00, 0x06, bh_54, ds, out al_55))
						goto l0C00_027D;
					ah_63 = 0x10;
					if (dl_39 == 0x00)
						goto l0C00_027A;
					--bh_54;
				}
				byte al_307;
				if (!fn0C00_02CA(ss_bp, al_55, ah_63, bh_54, ds, out al_307))
					dl_40 = dl_39 + 0x12;
			}
l0C00_027A:
			es->*di = dl_40;
l0C00_027D:
		}
		if (bx == 0x01)
		{
			byte al_126 = (ds->*SEQ(SLICE(ax_33 >> 0x04, byte, 8), (byte) (ax_33 >> 0x04) & 0x0F)).bAA83;
			byte bl_131 = (byte) ax_33;
			byte bh_138 = SLICE(ax_33, byte, 8);
			if (al_126 != 0x00)
			{
				word16 ax_143;
				if (cx != 0x00)
					ax_143 = SEQ(bl_131, 0x09);
				else
					ax_143 = SEQ(bl_131 + bh_138, al_126);
				ds->w0443 = ax_143;
				ds->b0442 = ch_149;
				word16 cx_162;
				cui16 dx_163;
				word16 di_309;
				byte bl_308;
				fn0C00_0244(bp, cx_162, dx_163, 0x0140, Eq_5::aD783, di, es, ds, out cx_162, out dx_163, out bl_308, out di_309);
			}
		}
		int16 ax_188 = ds->w0307;
		ds->*((word16) bx + 770) -= ax_188;
		struct Eq_559 Eq_5::* bx_194 = -bx;
		ci16 v28_195 = (ds->*bx_194).w0582 - 0x01;
		(ds->*bx_194).w0582 = v28_195;
		di -= bx;
	} while (v28_195 > 0x00);
	cxOut.u1 = <invalid>;
	dxOut.u1 = <invalid>;
	blOut.u1 = <invalid>;
	diOut = di;
	return SLICE(ax_188, byte, 8);
}

// 0C00:02CA: FlagGroup bool fn0C00_02CA(Sequence (ptr32 Eq_345) ss_bp, Register byte al, Register ci8 ah, Register ci8 bh, Register (ptr16 Eq_5) ds, Register out Eq_533 alOut)
// Called from:
//      fn0C00_0244
bool fn0C00_02CA(struct Eq_345 * ss_bp, byte al, ci8 ah, ci8 bh, struct Eq_5 * ds, union Eq_533 & alOut)
{
	Eq_627 fp;
	int8 dh_15 = (int8) ((al + ss_bp->b0005 & 0x0F) > ah);
	int8 al_22 = (int8) ((ds->t0305 & 0x0F) > bh);
	if (fp - 2)
	{
		Eq_533 al_26 = al_22 | dh_15;
		alOut = al_26;
		return SLICE(cond(al_26), bool, 2);
	}
	else
	{
		Eq_533 al_30 = al_22 & dh_15;
		alOut = al_30;
		return SLICE(cond(al_30), bool, 2);
	}
}

