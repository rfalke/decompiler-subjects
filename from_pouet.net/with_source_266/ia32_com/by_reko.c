// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_3) es, Register (ptr16 Eq_4) ds)
void fn0C00_0100(struct Eq_3 * es, struct Eq_4 * ds)
{
	bios_video_set_mode(0x13);
	__out<byte>(0x03C8, 0x00);
	uint8 al_14 = 0x00;
	bcu8 cl_17 = 0x00;
	do
	{
		uint8 al_15 = al_14 >> 0x01;
		__out<byte>(969, al_15);
		__out<byte>(969, al_15);
		al_14 = cl_17 >> 0x02;
		__out<byte>(969, al_14);
		++cl_17;
	} while (cl_17 != 0x00);
	word16 cx_24;
	word16 di_25 = 0x0200;
	uint16 ax_234 = (uint16) __in<byte>(0x40);
	for (cx_24 = 0x1520; cx_24 != 0x00; --cx_24)
		di_25 = fn0C00_01D5(di_25, ax_234, cx_24);
	do
	{
		byte Eq_62::* di_49 = Eq_62::a0000;
		do
		{
			cu8 al_56 = 0xA000->*di_49;
			cu8 al_57 = al_56 - 0x19;
			if (al_56 < 0x19)
				al_57 = 0x00;
			0xA000->*di_49 = al_57;
			++di_49;
		} while (di_49 != Eq_62::a0000);
		Mem225 = Mem67;
		word16 cx_105;
		struct Eq_85 Eq_4::* si_143 = Eq_4::a0200;
		for (cx_105 = 0x0101; cx_105 != 0x00; --cx_105)
		{
			(ds->*si_143).w0000 = (ds->*si_143).w0000;
			struct Eq_93 Eq_4::* si_85 = &si_143->w0002;
			cu16 ax_86 = (ds->*si_143).w0000 + (ds->*si_85).w0004;
			byte ah_120 = SLICE(ax_86, byte, 8);
			if (ax_86 >= 0x1400)
			{
l0C00_01CD:
				word16 cx_106 = cx_105 - 0x01;
				if (cx_106 == 0x00)
					break;
				uint16 ax_124 = SEQ(ah_120, __in<byte>(0x40));
				fn0C00_01D5(&&(es->*(es->*si_143).w0000), ax_124, cx_106);
				return;
			}
			(ds->*si_85).w0004 = ax_86;
			++(ds->*si_85).w0000;
			wchar_t ax_94 = (ds->*si_85).w0000 + (ds->*si_85).w0006;
			ah_120 = SLICE(ax_94, byte, 8);
			if (ax_94 >= 0x0C80)
				goto l0C00_01CD;
			(ds->*si_85).w0006 = ax_94;
			word16 ax_98 = (ds->*si_85).w0002;
			Eq_131 v26_100 = (ds->*si_85).t0008.u1 + ax_98;
			(ds->*si_85).t0008.u1 = (cup16) v26_100;
			ah_120 = SLICE(ax_98, byte, 8);
			if (v26_100 >= 0x00)
				goto l0C00_01CD;
			wchar_t ax_136 = (ds->*si_85).w0006;
			Eq_149 di_141 = ((ds->*si_85).w0004 >> 0x04) + (ax_136 >> 0x04) *s 0x0140;
			Eq_131 al_148 = (ds->*si_85).t0008.u0;
			si_143 = (struct Eq_85 Eq_4::*) (si_85 + 1);
			if (ax_136 >= 0x00)
				0xA000->*di_141 = al_148;
		}
		byte al_155;
		msdos_direct_console_input(out al_155);
		if (al_155 == 0x77)
			--ds->b0167;
		if (al_155 == 115)
			++ds->b0167;
		if (al_155 == 0x61)
			--ds->b015A;
		if (al_155 == 100)
			++ds->b015A;
		if (al_155 == 0x2B)
			++ds->w0141;
		if (al_155 == 0x2D)
			--ds->w0141;
	} while (al_155 != 0x1B);
}

// 0C00:01D5: Register word16 fn0C00_01D5(Sequence (ptr32 Eq_52) es_di, Register uint16 ax, Register word16 cx)
// Called from:
//      fn0C00_0100
word16 fn0C00_01D5(struct Eq_52 * es_di, uint16 ax, word16 cx)
{
	word16 di = (word16) es_di;
	uint16 ax_9 = ax * 0x25 + cx;
	int16 ax_14 = (int16) (byte) ax_9;
	byte ah_17 = SLICE(ax_14, byte, 8);
	es_di->w0000 = SEQ(ah_17, (byte) ax_14 & 0x1F ^ ah_17);
	int16 ax_33 = (int16) ((SLICE(ax_9, byte, 8) | 0xF0) - 0x40);
	es_di->w0002 = ax_33;
	es_di->w0004 = SEQ(SLICE(ax_33, byte, 8), ~0x00);
	es_di->w0006 = 0x0A00;
	es_di->w0008 = 0x0C80;
	es_di->w000A = 0xFF;
	return di + 0x0C;
}

