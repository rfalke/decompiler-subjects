// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register byte ch, Register Eq_4 bx, Register (memptr (ptr16 Eq_6) Eq_5) bp, Register (ptr16 Eq_6) es, Register (ptr16 Eq_7) ds)
void fn0C00_0100(byte ch, Eq_4 bx, <unknown> Eq_6::* bp, struct Eq_6 * es, struct Eq_7 * ds)
{
	__syscall<byte>(33);
	ds->t0248 = bx;
	ds->ptr024A = es;
	__syscall<byte>(0x10);
	fn0C00_01B7(&ds->t01E6, 0x40);
	do
	{
		struct Eq_38 Eq_6::* di_118 = &Eq_6::t000E;
		cui16 bx_116 = 0x1010;
		do
		{
			Eq_81 bx_34 = bx_116 & 0x1F;
			int16 ax_54 = (int16) (ds->b0119 + (byte) di_118);
			int16 si_101 = SEQ(ch, ds->*((word16) bx_34 + 734)) << 0x03;
			struct Eq_6 * ds_67 = ds->ptr02DC;
			__syscall<byte>(0x10);
			ui8 al_57 = (byte) ax_54 ^ SLICE(ax_54, byte, 8);
			cu8 bh_69 = 0x03;
			word16 dx_104 = 0x32;
			do
			{
				ui8 al_223 = es->*((char *) bp + si_101);
				struct Eq_48 Eq_6::* cx_76 = &Eq_6::t0008;
				do
				{
					int16 ax_78 = (int16) al_223;
					byte ah_79 = SLICE(ax_78, byte, 8);
					(ds_67->*di_118).b0000 = ah_79 & 0x03;
					Eq_43 di_84 = &di_118->b0000 + 1;
					byte al_86 = (byte) ax_78;
					--cx_76;
					di_118 = (word16) di_84 + 1;
					al_223 = al_86 << 0x01;
					ch = SLICE(cx_76, byte, 8);
				} while (cx_76 != &Eq_6::t0000);
				bh_69 += al_57;
				--dx_104;
				di_118 = (word16) di_84 + 0x0091;
				si_101 = si_101 - ~0x00 - (word16) (bh_69 < 0x00);
				byte dh_231 = SLICE(dx_104, byte, 8);
			} while (dx_104 != 0x00);
			es = ds_67;
			bx_116 = (word16) bx_34 + 1;
			di_118 = di_84 - 0x1E9F;
		} while (di_84 < 7999);
		struct Eq_48 Eq_6::* di_121 = cx_76;
		byte al_249 = (byte) cx_76;
		word16 cx_125 = SEQ(ch, 0x0F);
		word16 dx_129 = SEQ(dh_231, 0x99);
		while (true)
		{
			ch = SLICE(cx_125, byte, 8);
			if (cx_125 == 0x00)
				break;
			(ds_67->*di_121).t0000.u0 = al_249;
			++di_121;
			--cx_125;
		}
		do
		{
			byte dl_247 = (byte) dx_129;
			word16 ax_128 = ds->w0118;
			word16 bx_130 = dx_129;
			struct Eq_6 * cx_154 = SEQ(ch, 0x40);
			do
			{
				word16 ax_134 = ax_128 + bx_130;
				(ds_67->*di_121).t0000.u0 = SLICE(ax_134, byte, 8) & 0x49 ^ 0x0E;
				--cx_154;
				byte dh_234 = SLICE(dx_129, byte, 8);
				bx_130 += dx_129;
				ax_128 = ax_134;
				di_121 += 2;
				byte ch_245 = SLICE(cx_154, byte, 8);
			} while (cx_154 != 0x00);
			word16 cx_158 = SEQ(ch_245, 0x10);
			while (true)
			{
				ch = SLICE(cx_158, byte, 8);
				if (cx_158 == 0x00)
					break;
				(ds_67->*di_121).t0000.u1 = cx_154;
				di_121 += 2;
				--cx_158;
			}
			dx_129 = SEQ(dh_234, dl_247 - 0x03);
		} while (dl_247 != 0x03);
		es = cx_154;
	} while ((cx_154->b0417 & 0x07) == 0x00);
	Eq_4 ds_dx_171 = ds->t0248;
	fn0C00_01B7(ds_dx_171, 0x00);
}

// 0C00:01B7: Register byte fn0C00_01B7(Sequence Eq_4 ds_dx, Register byte ah)
// Called from:
//      fn0C00_0100
byte fn0C00_01B7(Eq_4 ds_dx, byte ah)
{
	struct Eq_202 * ds = SLICE(ds_dx, selector, 16);
	__cli();
	__out<byte>(0x43, 0x36);
	__out<byte>(0x40, 0x00);
	__out<byte>(0x40, ah);
	msdos_set_interrupt_vector(0x08, ds_dx);
	word16 ax_16 = 244;
	do
	{
		fn0C00_0253(ax_16);
		--ax_16;
		byte al_36 = (byte) ax_16;
	} while (ax_16 != 0x00);
	byte Eq_202::* si_24 = Eq_202::a026E;
	do
	{
		++si_24;
		word16 ax_31 = SEQ(ds->*si_24, al_36);
		do
		{
			fn0C00_0253(ax_31);
			++ax_31;
			al_36 = (byte) ax_31;
		} while ((al_36 & 0x1F) != 0x00);
	} while (al_36 != 0x00);
	__sti();
	return SLICE(ax_31, byte, 8);
}

// 0C00:0253: void fn0C00_0253(Register word16 ax)
// Called from:
//      fn0C00_01B7
void fn0C00_0253(word16 ax)
{
	byte al_15 = (byte) ax;
	byte ah_22 = SLICE(ax, byte, 8);
	__out<byte>(0x0388, al_15);
	word16 cx_16 = 0x06;
	do
	{
		__in<byte>(0x0388);
		--cx_16;
		byte ch_44 = SLICE(cx_16, byte, 8);
	} while (cx_16 != 0x00);
	__out<byte>(0x0389, ah_22);
	word16 cx_30 = SEQ(ch_44, 0x23);
	do
	{
		__in<byte>(0x0388);
		--cx_30;
	} while (cx_30 != 0x00);
}

