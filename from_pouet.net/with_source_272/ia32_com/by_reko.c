// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register word16 cx, Register byte dh, Register byte dl, Register (memptr (ptr16 Eq_17) Eq_6) bx, Register (memptr (ptr16 Eq_253) byte) si, Register (ptr16 Eq_8) ds)
void fn0C00_0100(word16 cx, byte dh, byte dl, struct Eq_6 Eq_17::* bx, byte Eq_253::* si, struct Eq_8 * ds)
{
	__syscall<byte>(0x10);
	__fninit();
	struct Eq_17 * dx_14 = SEQ(dh + 0x10, dl);
	word16 cx_480 = cx;
	do
	{
		cu8 cl_17 = (byte) cx_484;
		__out<byte>(0x03C8, cl_17);
		__out<byte>(969, cl_17);
		cu8 al_20 = cl_17 - 0x80;
		if (cl_17 < 0x80)
			al_20 = cl_17 - 252;
		__out<byte>(969, al_20);
		cu8 al_27 = al_20 - 0x40;
		if (al_27 < 0x00)
			al_27 += 0x44;
		__out<byte>(969, al_27);
		cx_480 = SEQ(SLICE(cx_484 - 0x01, byte, 8), cl_17 - 0x01);
		cx_484 = cx_480;
	} while (cx_484 != 0x01);
	real64 rLoc1_366 = (real64) ds->r01FC;
	real64 rLoc2_368 = -rLoc1_366;
	real64 rLoc3_369 = rLoc2_368;
	do
	{
		real64 rLoc4_379 = sqrt(rLoc3_369 * rLoc3_369 + rLoc2_368 * rLoc2_368) / rLoc1_366;
		real64 rLoc4_381 = rLoc4_379 * 3.141592653589793;
		if (rLoc4_379 * 3.141592653589793 <= 3.141592653589793)
			rLoc4_381 = (cos(rLoc4_379 * 3.141592653589793) + 1.0) * (real64) ds->w019D;
		(dx_14->*bx).w0000 = (int16) rLoc4_381;
		if (rLoc3_369 == rLoc1_366)
		{
			rLoc2_368 += 1.0;
			rLoc3_369 = -rLoc3_369;
		}
		else
			rLoc3_369 += 1.0;
		struct Eq_96 Eq_17::* bx_108 = bx + 1;
		bx = (struct Eq_6 Eq_17::*) (bx_108 + 1);
	} while (bx_108 != &Eq_17::tFFFF);
	do
	{
		++ds->w01FE;
		real64 rLoc4_394 = 1.4426950408889634;
		struct Eq_125 Eq_8::* bx_121 = &Eq_8::w01FE;
		word16 cx_122 = 0x24;
		do
		{
			struct Eq_129 Eq_8::* bx_124 = &bx_121->w0001;
			rLoc4_394 += rLoc4_394;
			(ds->*bx_124).w0001 = (int16) (sin((rLoc4_394 + (real64) ds->w01FE) / rLoc1_366) * rLoc1_366);
			(ds->*bx_124).w0001 += 0x60;
			--cx_122;
			bx_121 = (struct Eq_125 Eq_8::*) &bx_124->w0001;
			byte ch_336 = SLICE(cx_122, byte, 8);
		} while (cx_122 != 0x00);
		ui16 bx_148 = 0x0140;
		word16 cx_267 = SEQ(ch_336, 0x08);
		do
		{
			Eq_169 di_150;
			word16 ax_151 = 0x00;
			for (di_150 = 0x44; di_150 >= 0x00; di_150 -= 0x04)
			{
				cui16 bx_162 = bx_148 - ds->*((word16) di_150 + 0x0200);
				ui8 bl_178 = (byte) bx_162 << 0x01;
				if (SLICE(bx_162 << 0x01, byte, 8) == 0x00)
					ax_151 += dx_14->*SEQ((byte) cx_267 - ds->*((word16) di_150 + 0x0202), bl_178);
			}
			cup16 ax_194 = ax_151 - 0x0600;
			if (ax_194 < 0x00)
				ax_194 = 0x00;
			word16 v35_211 = ds->a0248[0][bx_148];
			ds->a0248[0][bx_148] = ax_194;
			wchar_t ax_216 = ax_194 - ((ds->a0246))[0][bx_148];
			ci8 al_218 = (byte) (ax_216 >> 0x04);
			ci16 dx_215 = -v35_211 + ax_194;
			byte ah_279 = SLICE(ax_216 >> 0x04, byte, 8);
			cu8 al_219 = al_218 + 0x20;
			if (al_218 < 0xE0)
				al_219 = 0x00;
			if (al_219 >= 55)
				al_219 = 55;
			40940->*si = al_219 | ((byte) ((dx_215 >> 0x05) + bx_148) & 0x60) << 0x01;
			--bx_148;
			if (bx_148 == 0x01)
			{
				--cx_267;
				bx_148 = 0x0140;
			}
			++si;
		} while (si != &Eq_253::b0000);
	} while (SEQ(ah_279, __in<byte>(0x60)) != 0x01);
	__syscall<byte>(0x10);
}

