// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_3) es, Register (ptr16 Eq_3) ds)
void fn0C00_0100(struct Eq_3 * es, struct Eq_3 * ds)
{
	__syscall<byte>(0x10);
	word16 cx_16 = 0x0100;
	do
	{
		bcu8 al_10 = (byte) -cx_16;
		__out<byte>(969, al_10 >> 0x03);
		__out<byte>(969, al_10 >> 0x04);
		__out<byte>(969, al_10 >> 0x04 << 0x02);
		--cx_16;
		byte cl_203 = (byte) cx_16;
	} while (cx_16 != 0x00);
	real64 rLoc1_227 = 0.0;
	do
	{
		byte Eq_3::* di_21 = Eq_3::a0200;
		word16 cx_131 = SEQ(~0x05, cl_203);
		do
		{
			cu8 al_28;
			cu8 al_25 = ds->*di_21;
			if (al_25 > 0x08)
				al_28 = al_25 - 0x08;
			else
				al_28 = 0x00;
			es->*di_21 = al_28;
			++di_21;
			--cx_131;
		} while (cx_131 != 0x00);
		do
		{
			uint32 dx_ax_47 = (uint32) cx_131;
			uint32 dx_ax_57 = (uint32) (uint16) (dx_ax_47 /u 0x28);
			Eq_72 dx_59 = (uint16) (dx_ax_57 % 0x28);
			Eq_76 ax_60 = (uint16) (dx_ax_57 /u 0x28);
			Eq_80 dx_49 = (uint16) (dx_ax_47 % 0x28);
			Eq_84 ax_74 = (dx_49 - 0x14) *s (dx_49 - 0x14) + ((dx_59 - 0x14) *s (dx_59 - 0x14) + (ax_60 - 0x14) *s (ax_60 - 0x14));
			if (ax_74 < 133 || ax_74 >= 0x0280)
			{
				real64 rRet1_91;
				real64 rRet2_92;
				word64 rRet1_97;
				word64 rRet2_98;
				Eq_105 di_109 = ((int16) fn0C00_01D5(fn0C00_01D5((real64) (dx_59 - 0x14), (real64) (ax_60 - 0x14), (real64) (dx_49 - 0x14), rLoc1_227, out rRet1_91, out rRet2_92), rRet1_91, rRet2_92, rLoc1_227, out rRet1_97, out rRet2_98) + 100) *s 0x0140 + (int16) rRet1_97;
				cu8 al_118 = (byte) rRet2_98 + 0x80;
				if (al_118 > ds->*((word16) di_109 + 688))
					es->*((word16) di_109 + 688) = al_118;
			}
			--cx_131;
		} while (cx_131 != 0x00);
		struct Eq_152 Eq_3::* di_132 = Eq_3::a0340;
		word16 cx_133;
		for (cx_133 = 0xF8C0; cx_133 != 0x00; --cx_133)
		{
			(es->*di_132).b0000 = (byte) ((ds->*di_132).bFFFFFEC0 + (ds->*di_132).bFFFFFFFF + (uint16) di_132[1] + (uint16) di_132[320] >> 0x02);
			++di_132;
		}
		memcpy(A000:0000, ds->a0200[0], cx_133 - 0x01);
		rLoc1_227 += (real64) ds->w01D3;
		cl_203 = 0x00;
	} while (__in<word16>(0x60) != 0x01);
}

// 0C00:01D5: FpuStack real64 fn0C00_01D5(FpuStack real64 rArg0, FpuStack real64 rArg1, FpuStack real64 rArg2, FpuStack real64 rArg3, FpuStack out Eq_112 rArg1Out, FpuStack out Eq_113 rArg2Out)
// Called from:
//      fn0C00_0100
real64 fn0C00_01D5(real64 rArg0, real64 rArg1, real64 rArg2, real64 rArg3, union Eq_112 & rArg1Out, union Eq_113 & rArg2Out)
{
	real64 rLoc1_58 = sin(rArg3) * rArg0 + cos(rArg3) * rArg1;
	real64 rArg1_66 = rArg1 * sin(rArg3) - rArg0 * cos(rArg3);
	real64 rLoc1_72 = cos(sin(rArg3));
	real64 rLoc1_73 = rLoc1_72 + rLoc1_72;
	rArg1Out = rArg1_66 * rLoc1_73;
	rArg2Out = rLoc1_58 * rLoc1_73;
	return rArg2 * rLoc1_73;
}

