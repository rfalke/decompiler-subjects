// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register byte ch, Register (ptr16 Eq_4) ds)
void fn0C00_0100(byte ch, struct Eq_4 * ds)
{
	Eq_5 di_13;
	byte Eq_4::* si_10 = Eq_4::a045F;
	for (di_13 = 0x055E; di_13 >= ~0x04DE; --di_13)
	{
		ds->*di_13 = ds->*si_10;
		++si_10;
	}
	__syscall<byte>(0x10);
	fn0C00_038B();
	__out<word16>(0x03D4, 0x5013);
	struct Eq_38 * es_29 = ds->ptr0415;
	Eq_42 di_30 = 0x00;
	uint16 bx_32;
	for (bx_32 = 0x00; bx_32 <= 33; ++bx_32)
	{
		do
		{
			word16 cx_38 = SEQ(ch, 0x08);
			while (true)
			{
				ch = SLICE(cx_38, byte, 8);
				if (cx_38 == 0x00)
					break;
				es_29->*di_30 = 2011;
				di_30 = (word16) di_30 + 2;
				--cx_38;
			}
			uint32 dx_ax_43 = bx_32 *32 0x03C0;
			di_30 = (word16) di_30 + 16;
			word16 dx_47 = SLICE(dx_ax_43, word16, 16);
		} while (di_30 <= (word16) dx_ax_43);
		if (dx_47 == 0x00)
			di_30 = (word16) di_30 + 16;
	}
	word16 bx_131;
	struct Eq_38 * es_73 = ds->ptr0415;
	struct Eq_84 Eq_38::* di_107 = &Eq_38::t0518;
	Eq_86 si_116 = 0x0417;
	for (bx_131 = 0x00; bx_131 != 0x08; ++bx_131)
	{
		bool C_459 = SLICE(cond(si_116 - 0x0437), bool, 1);
		if (si_116 == 0x0437)
			di_107 = &Eq_38::t2458;
		byte dl_121 = 0x08;
		do
		{
			byte al_84 = ds->*si_116;
			byte dh_110 = 0x08;
			do
			{
				al_84 = __rcl<byte,byte>(al_84, 0x01, C_459);
				if (Test(ULT,(al_84 & 0x80) != 0x00))
				{
					(es_73->*di_107).w0000 = 0x0FDB;
					(es_73->*di_107).w0002 = 0x0FDB;
					(es_73->*di_107).w0004 = 0x0FDB;
					(es_73->*di_107).w0006 = 0x0FDB;
					(es_73->*di_107).w0140 = 0x0FDB;
					(es_73->*di_107).w0142 = 0x0FDB;
					(es_73->*di_107).w0144 = 0x0FDB;
					(es_73->*di_107).w0146 = 0x0FDB;
					(es_73->*di_107).w0280 = 0x0FDB;
					(es_73->*di_107).w0282 = 0x0FDB;
					(es_73->*di_107).w0284 = 0x0FDB;
					(es_73->*di_107).w0286 = 0x0FDB;
				}
				di_107 = &di_107->w0006 + 1;
				--dh_110;
				C_459 = SLICE(cond(di_107), bool, 1);
				word16 dx_122 = SEQ(dh_110, dl_121);
			} while (dh_110 != 0x00);
			si_116 = (word16) si_116 + 1;
			++di_107;
			C_459 = SLICE(cond(di_107 + 1), bool, 1);
			--dl_121;
		} while (dx_122 != 0x01);
		di_107 -= 0x1A30;
	}
	fn0C00_02FB(ds);
	byte cl_538;
	fn0C00_0365(ds, out cl_538);
	struct Eq_209 Eq_4::* bx_157 = &Eq_4::t0000;
	cui16 dx_532 = 0x0100;
	while (true)
	{
		cu8 dl_170 = (byte) dx_532;
		byte bl_187 = (byte) bx_157;
		byte bh_193 = SLICE(bx_157, byte, 8);
		uint16 ax_169 = (uint16) (ds->*bx_157).b045F + 0x60;
		if (dl_170 > 0x05)
			ax_169 = 0x60;
		struct Eq_209 Eq_4::* bx_192;
		ds->w0410 = ax_169;
		bx_192 = bx_157;
		if (dl_170 > 0x01)
			bx_192 = SEQ(bh_193, bl_187 << 0x01);
		uint16 ax_209 = (uint16) (ds->*bx_192).b045F;
		if (dl_170 != 0x01 && (dl_170 <= 0x03 || dl_170 > 0x05) && dl_170 != 0x07)
			ds->w040E = ax_209 + 0x01A0;
		else
			ds->w040E = 0x01A0 - ax_209;
		byte dh_254 = SLICE(dx_532, byte, 8);
		byte bl_255 = (byte) bx_157 + dh_254;
		cui16 dx_225 = dx_532;
		byte al_268 = fn0C00_02FB(ds);
		cu8 dl_259 = (byte) dx_532;
		bx_157 = SEQ(SLICE(bx_157, byte, 8), bl_255);
		if (bl_255 == ~0x00)
		{
			byte dh_500 = SLICE(SEQ(-dh_254, dl_259) + 0x01, byte, 8);
			dx_225 = SEQ(dh_500, dl_259 + 0x01);
			if (dl_259 > 0x06)
				dx_225 = SEQ(dh_500, 0x00);
		}
		msdos_get_stdin_status();
		if (al_268 != 0x00)
			break;
		dx_532 = dx_225;
	}
	byte cl_539;
	msdos_flush_buffer_and_read_stdin(fn0C00_0365(ds, out cl_539));
	bios_video_set_mode(0x03);
	bios_video_load_ROM_8x8_dbl_dot_patterns(0x00);
	fn0C00_038B();
	word16 bx_302 = 0x00;
	struct Eq_38 * es_307 = ds->ptr0415;
	struct Eq_315 Eq_38::* di_308 = &Eq_38::t066C;
	Eq_317 si_309 = 0x0417;
	do
	{
		bool C_322 = SLICE(cond(si_309 - 0x0437), bool, 1);
		if (si_309 == 0x0437)
			di_308 = &Eq_38::t0C02;
		byte dl_314 = 0x08;
		do
		{
			byte al_318 = ds->*si_309;
			byte dh_319 = 0x08;
			do
			{
				al_318 = __rcl<byte,byte>(al_318, 0x01, C_322);
				if (Test(ULT,(al_318 & 0x80) != 0x00))
					(es_307->*di_308).w0000 = 0x0FDB;
				di_308 = &di_308->w0000 + 1;
				--dh_319;
				C_322 = SLICE(cond(di_308), bool, 1);
				word16 dx_345 = SEQ(dh_319, dl_314);
			} while (dh_319 != 0x00);
			si_309 = (word16) si_309 + 1;
			++di_308;
			C_322 = SLICE(cond(di_308 + 1), bool, 1);
			--dl_314;
		} while (dx_345 != 0x01);
		++bx_302;
		di_308 -= 1118;
		byte bh_372 = SLICE(bx_302, byte, 8);
	} while (bx_302 != 0x09);
	struct Eq_38 * es_363 = ds->ptr0415;
	memcpy((&es_363->t0C02.w0000)[729], *((char *) &ds->t0000 + 926), 0x36);
	bios_video_set_cursor_position(bh_372, 0x32, 0x00);
	byte cl_540;
	fn0C00_0365(ds, out cl_540);
	byte al_390;
	bios_kbd_get_keystroke(out al_390);
	byte cl_541;
	fn0C00_0365(ds, out cl_541);
	__syscall<byte>(0x10);
	word16 cx_396 = <invalid>;
	word16 Eq_38::* di_369 = Eq_38::a11EA;
	word16 cx_409 = SEQ(22, (byte) cx_396);
	while (true)
	{
		uint8 ch_418 = SLICE(cx_409, byte, 8);
		if (cx_409 == 0x00)
			break;
		es_363->*di_369 = 0x00;
		++di_369;
		--cx_409;
	}
	memcpy(*((char *) ds->ptr0415 + 0x0066), *((char *) &ds->t0000 + 980), SEQ(ch_418, 0x1D) *32 0x02);
	msdos_terminate(0x00);
}

// 0C00:02CE: Register byte fn0C00_02CE(Register byte cl, Register (ptr16 Eq_4) ds)
// Called from:
//      fn0C00_0365
byte fn0C00_02CE(byte cl, struct Eq_4 * ds)
{
	__out<byte>(0x03C7, cl);
	byte al_8 = __in<byte>(969);
	byte al_10 = __in<byte>(969);
	byte al_12 = __in<byte>(969);
	byte ah_16 = al_8 + ds->b0414;
	byte bl_17 = al_10 + ds->b0414;
	byte bh_18 = al_12 + ds->b0414;
	__out<byte>(0x03C8, cl);
	__out<byte>(969, ah_16);
	__out<byte>(969, bl_17);
	__out<byte>(969, bh_18);
	return bh_18;
}

// 0C00:02FB: Register byte fn0C00_02FB(Register (ptr16 Eq_4) ds)
// Called from:
//      fn0C00_0100
byte fn0C00_02FB(struct Eq_4 * ds)
{
	uint32 dx_ax_10 = (ds->w0410 >> 0x04) *32 0xA0;
	ds->t0412 = (word16) dx_ax_10 + (uint16) (SEQ(SLICE(dx_ax_10, word16, 16), ds->w040E) /u 0x09);
	do
		;
	while ((__in<byte>(0x03DA) & 0x08) != 0x00);
	__out<word16>(0x03D4, SEQ(ds->b0413, 0x0C));
	__out<word16>(0x03D4, SEQ(ds->t0412, 0x0D));
	do
		;
	while ((__in<byte>(0x03DA) & 0x08) == 0x00);
	__out<word16>(0x03D4, SEQ((byte) ((uint32) ds->w0410 % 0x10), 0x08));
	uint16 dx_67 = (uint16) ((uint32) (ds->w040E - 0x01) % 0x09);
	__out<byte>(0x03C0, 0x33);
	byte al_71 = (byte) dx_67;
	__out<byte>(0x03C0, al_71 | 0x20);
	return al_71 | 0x20;
}

// 0C00:0365: Register byte fn0C00_0365(Register (ptr16 Eq_4) ds, Register out Eq_206 clOut)
// Called from:
//      fn0C00_0100
byte fn0C00_0365(struct Eq_4 * ds, union Eq_206 & clOut)
{
	word16 cx_24 = 0x1F;
	do
	{
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) != 0x00);
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) == 0x00);
		fn0C00_02CE(0x07, ds);
		fn0C00_02CE(0x3F, ds);
		byte al_53 = fn0C00_02CE(0x3F, ds);
		cx_24 = cx_80 - 0x01;
		cx_80 = cx_24;
	} while (cx_80 != 0x01);
	ds->b0414 = -ds->b0414;
	clOut.u1 = <invalid>;
	return al_53;
}

// 0C00:038B: void fn0C00_038B()
// Called from:
//      fn0C00_0100
void fn0C00_038B()
{
	byte bh_11;
	for (bh_11 = ~0x00; bh_11 != 0x00; --bh_11)
	{
		__out<byte>(0x03C8, bh_11);
		__out<byte>(969, 0x00);
		__out<byte>(969, 0x00);
		__out<byte>(969, 0x00);
	}
}

