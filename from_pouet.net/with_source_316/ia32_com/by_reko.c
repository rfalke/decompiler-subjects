// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register word16 eax_16_16, Register byte ch, Register word16 ecx_16_16, Register word16 ebx_16_16, Register word16 esp_16_16, Register (ptr16 Eq_8) ds)
void fn0C00_0100(word16 eax_16_16, byte ch, word16 ecx_16_16, word16 ebx_16_16, word16 esp_16_16, struct Eq_8 * ds)
{
	struct Eq_9 Eq_10::* fp;
	struct Eq_10 * ss;
	struct Eq_9 Eq_10::* sp_100 = fp;
	__syscall<byte>(0x10);
	__out<byte>(0x03C8, 0x00);
	word16 cx_176 = SEQ(ch, ~0x00);
	do
	{
		byte cl_9 = (byte) cx_179;
		byte al_11 = ~cl_9;
		__out<byte>(969, al_11);
		__out<byte>(969, al_11);
		__out<byte>(969, 0x00);
		cx_176 = SEQ(SLICE(cx_179 - 0x01, byte, 8), cl_9 - 0x01);
		cx_179 = cx_176;
	} while (cx_179 != 0x01);
	struct Eq_50 * es_126 = (char *) ds + 100;
	do
	{
		ds->w02E9 = 0x00;
		ds->w02E5 = 0x00;
		ds->w02E7 = 0x00;
		word16 Eq_50::* di_133 = Eq_50::a0000;
		word16 cx_136;
		for (cx_136 = 0x7B0C; cx_136 != 0x00; --cx_136)
		{
			es_126->*di_133 = 0x00;
			++di_133;
		}
		ds->w02CF = 0x09;
		ds->w02D7 += 0x04;
		ds->w02D9 += 0x06;
		ds->w02DB += 0x03;
		do
		{
			ds->w02E7 += 0xB3;
			ds->w02E9 += 0x7D;
			word16 bp_101;
			for (bp_101 = 1100; bp_101 != 0x00; --bp_101)
			{
				ds->w02E5 += 0x03;
				struct Eq_98 Eq_10::* sp_58 = sp_100 - 2;
				(ss->*sp_58).w0000 = ds->w02E7;
				(ss->*sp_58).wFFFFFFFE = ds->w02E5;
				word32 esp_73 = <invalid>;
				word32 ebx_71;
				word32 ecx_72;
				word16 eax_16_16_87 = SLICE(fn0C00_01E1(eax_16_16, ecx_16_16, ebx_16_16, esp_16_16, es_126, ds, out ecx_72, out ebx_71), word16, 16);
				struct Eq_134 Eq_10::* sp_78 = (word16) esp_73;
				(ss->*sp_78).w0002 = ds->w02E5;
				(ss->*sp_78).w0000 = ds->w02E9;
				word32 esp_94 = <invalid>;
				struct Eq_151 Eq_10::* sp_99 = (word16) esp_94;
				esp_16_16 = SLICE(esp_94, word16, 16);
				word32 ebx_92;
				word32 ecx_93;
				eax_16_16 = SLICE(fn0C00_01E1(eax_16_16_87, SLICE(ecx_72, word16, 16), SLICE(ebx_71, word16, 16), SLICE(esp_73, word16, 16), es_126, ds, out ecx_93, out ebx_92), word16, 16);
				ebx_16_16 = SLICE(ebx_92, word16, 16);
				ecx_16_16 = SLICE(ecx_93, word16, 16);
				sp_100 = (struct Eq_9 Eq_10::*) ((char *) &sp_99->ptr0002 + 2);
			}
			word16 v31_105 = ds->w02CF - 0x01;
			ds->w02CF = v31_105;
		} while (v31_105 != 0x00);
		(ss->*sp_99).ptr0002 = es_126;
		(ss->*sp_99).ptr0000 = ds;
		memcpy(A000:0000, es_126->a0000[0], 63000);
		ds = (ss->*sp_99).ptr0000;
		es_126 = (ss->*sp_99).ptr0002;
		sp_100 = (struct Eq_9 Eq_10::*) ((char *) &sp_99->ptr0002 + 2);
	} while (__in<byte>(0x60) != 0x81);
	msdos_terminate_program20();
}

// 0C00:019C: Register (memptr (ptr16 Eq_8) int16) fn0C00_019C(Register word16 eax_16_16, Register word16 ecx_16_16, Register word16 ebx_16_16, Register word16 esp_16_16, Register (ptr16 Eq_8) ds, Register out Eq_256 ecxOut, Register out Eq_257 ebxOut)
// Called from:
//      fn0C00_01E1
int16 Eq_8::* fn0C00_019C(word16 eax_16_16, word16 ecx_16_16, word16 ebx_16_16, word16 esp_16_16, struct Eq_8 * ds, union Eq_256 & ecxOut, union Eq_257 & ebxOut)
{
	mp16 fp;
	struct Eq_259 * ss;
	struct Eq_260 Eq_259::* esp_6 = SEQ(esp_16_16, fp);
	int16 Eq_8::* eax_14 = SEQ(eax_16_16, (ss->*esp_6).w0004);
	Eq_257 ebx_19 = SEQ(ebx_16_16, (ss->*esp_6).w0006);
	real64 rLoc1_50 = (real64) (ds->*eax_14);
	real64 rLoc2_52 = (real64) (ds->*ebx_19);
	word16 cx_10 = (ss->*esp_6).w0002;
	ds->r02EB = (real32) sqrt(rLoc1_50 * rLoc1_50 + rLoc2_52 * rLoc2_52);
	Eq_256 ecx_35 = SEQ(ecx_16_16, cx_10);
	real64 rLoc1_61 = __atan2((real64) (ds->*eax_14), (real64) (ds->*ebx_19)) + (real64) (ds->*ecx_35) / (real64) ds->w02CD;
	real64 rLoc1_62 = cos(rLoc1_61);
	ds->*ebx_19 = (int16) (sin(rLoc1_61) * (real64) ds->r02EB);
	ds->*eax_14 = (int16) (rLoc1_62 * (real64) ds->r02EB);
	ecxOut = ecx_35;
	ebxOut = ebx_19;
	return eax_14;
}

// 0C00:01E1: Register word32 fn0C00_01E1(Register word16 eax_16_16, Register word16 ecx_16_16, Register word16 ebx_16_16, Register word16 esp_16_16, Register (ptr16 Eq_50) es, Register (ptr16 Eq_8) ds, Register out Eq_128 ecxOut, Register out Eq_129 ebxOut)
// Called from:
//      fn0C00_0100
word32 fn0C00_01E1(word16 eax_16_16, word16 ecx_16_16, word16 ebx_16_16, word16 esp_16_16, struct Eq_50 * es, struct Eq_8 * ds, union Eq_128 & ecxOut, union Eq_129 & ebxOut)
{
	mp16 fp;
	struct Eq_362 * ss;
	struct Eq_363 Eq_362::* esp_7 = SEQ(esp_16_16, fp);
	real64 rLoc1_150 = (real64) (ss->*esp_7).w0002 / (real64) ds->w02D5;
	real64 rLoc1_151 = cos(rLoc1_150);
	ds->w02DF = (int16) (sin(rLoc1_150) * (real64) ds->w02CD);
	ds->w02E3 = (int16) (rLoc1_151 * (real64) ds->w02CD);
	real64 rLoc1_156 = (real64) (ss->*esp_7).w0004 / (real64) ds->w02D5;
	real64 rLoc1_157 = cos(rLoc1_156);
	ds->w02E1 = (int16) (sin(rLoc1_156) * (real64) ds->w02E3);
	ds->w02E3 = (int16) (rLoc1_157 * (real64) ds->w02E3);
	word32 esp_47 = <invalid>;
	struct Eq_442 Eq_362::* sp_48 = (word16) esp_47;
	word32 ebx_45;
	word32 ecx_46;
	word16 eax_16_16_57 = SLICE(fn0C00_019C(eax_16_16, ecx_16_16, ebx_16_16, esp_16_16, ds, out ecx_46, out ebx_45), word16, 16);
	(ss->*sp_48).w0004 = 0x02DF;
	(ss->*sp_48).w0002 = 0x02E3;
	(ss->*sp_48).w0000 = 0x02D9;
	word32 esp_63 = <invalid>;
	struct Eq_469 Eq_362::* sp_64 = (word16) esp_63;
	word32 ebx_61;
	word32 ecx_62;
	word16 eax_16_16_73 = SLICE(fn0C00_019C(eax_16_16_57, SLICE(ecx_46, word16, 16), SLICE(ebx_45, word16, 16), SLICE(esp_47, word16, 16), ds, out ecx_62, out ebx_61), word16, 16);
	(ss->*sp_64).w0004 = 737;
	(ss->*sp_64).w0002 = 0x02E3;
	(ss->*sp_64).w0000 = 0x02DB;
	word32 ebx_77;
	Eq_128 ecx_78;
	word16 eax_16_16_197 = SLICE(fn0C00_019C(eax_16_16_73, SLICE(ecx_62, word16, 16), SLICE(ebx_61, word16, 16), SLICE(esp_63, word16, 16), ds, out ecx_78, out ebx_77), word16, 16);
	real64 rLoc2_166 = (real64) ds->w02DF - (real64) ds->w02C1;
	real64 rLoc3_169 = (real64) ds->w02E1 - (real64) ds->w02C3;
	real64 rLoc4_172 = (real64) ds->w02E3 - (real64) ds->w02C5;
	ds->w02DD = (int16) ((real64) ds->w02C7 / ((rLoc2_166 * rLoc2_166 + (rLoc3_169 * rLoc3_169 + rLoc4_172 * rLoc4_172)) / (real64) ds->w02C9 + (real64) ds->w02CB));
	real64 rLoc3_185 = (real64) ds->w02E3 / (real64) ds->w02D5 + 1.0 + 1.0;
	real64 rLoc1_187 = (real64) ds->w02DF / rLoc3_185;
	ds->w02E1 = (int16) -((real64) ds->w02E1 / rLoc3_185);
	ds->w02DF = (int16) (rLoc1_187 * (real64) ds->r02D1);
	int16 ax_135 = ds->w02DD;
	byte ah_136 = SLICE(ax_135, byte, 8);
	word16 ebx_16_16_203 = SLICE(ebx_77, word16, 16);
	Eq_609 bx_134 = (ds->w02E1 + 0x62) * 0x0140 + 0xA0 + ds->w02DF;
	cu8 al_139 = (byte) ax_135;
	word24 eax_24_8_198 = SEQ(eax_16_16_197, ah_136);
	if (ah_136 != 0x00)
		al_139 = ~0x05;
	word32 eax_195 = SEQ(eax_24_8_198, al_139);
	Eq_129 ebx_201 = SEQ(ebx_16_16_203, bx_134);
	if (es->*bx_134 <= al_139)
	{
		es->*bx_134 = al_139;
		eax_195 = SEQ(eax_24_8_198, al_139);
		ebx_201 = SEQ(ebx_16_16_203, bx_134);
	}
	ecxOut = ecx_78;
	ebxOut = ebx_201;
	return eax_195;
}

