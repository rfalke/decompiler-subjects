// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_3) es, Register (ptr16 Eq_4) ds)
void fn0C00_0100(struct Eq_3 * es, struct Eq_4 * ds)
{
	word16 bx_8;
	msdos_resize_memory_block(es, 0x01B5, out bx_8);
	bios_video_set_mode(0x13);
	msdos_allocate_memory_block(4020);
	struct Eq_24 * gs_21 = 18451;
	struct Eq_24 * fs_26 = 18451;
	if (msdos_allocate_memory_block(4020))
		fn0C00_0226(ds);
	else
	{
		msdos_display_string((char *) ds + 564);
		word16 cx_31 = 0x7D00;
		word16 Eq_24::* di_32 = Eq_24::a0000;
		while (true)
		{
			byte ch_436 = SLICE(cx_31, byte, 8);
			if (cx_31 == 0x00)
				break;
			gs_21->*di_32 = 0x00;
			++di_32;
			--cx_31;
		}
		byte Eq_24::* di_113 = Eq_24::a0000;
		int16 si_112 = 0x00;
		word16 cx_115 = SEQ(ch_436, 0x08);
		do
		{
			word16 cx_105 = SEQ(SLICE(cx_522, byte, 8), 0x35);
			di_101 = di_113;
			si_448 = si_112;
			do
			{
				int16 si_448;
				byte Eq_24::* di_101;
				byte al_74 = 0xA000->*di_101;
				word16 cx_442 = SEQ(SLICE(cx_523, byte, 8), 0x06);
				do
				{
					<unknown> Eq_24::* bx_82 = Eq_24::a2BD4;
					word16 cx_451 = SEQ(SLICE(cx_524, byte, 8), 0x12);
					do
					{
						gs_21->*((char *) bx_82 + si_448) = (<unknown> Eq_24::*) al_74;
						bx_82 = (<unknown> Eq_24::*) ((char *) bx_82 + 320);
						byte bh_454 = SLICE(bx_82, byte, 8);
						--cx_451;
					} while (cx_451 != 0x00);
					++si_448;
					cx_442 = cx_524 - 0x01;
					cx_524 = cx_442;
				} while (cx_524 != 0x01);
				++di_101;
				cx_105 = cx_523 - 0x01;
				cx_523 = cx_105;
			} while (cx_523 != 0x01);
			si_112 += 0x1680;
			di_113 += 320;
			cx_115 = cx_522 - 0x01;
			cx_522 = cx_115;
		} while (cx_522 != 0x01);
		fn0C00_02B8(gs_21, fs_26);
		uint16 ax_132 = (uint16) (byte) gs_21;
		do
		{
			byte cl_135 = <invalid>;
			ci8 bl_133;
			fn0C00_0298(SEQ(SLICE(ax_132, byte, 8), bh_454), cl_135, fn0C00_02AB((byte) ax_132, out bl_133), bl_133, out ax_132);
			bool O_147 = <invalid>;
			bool Z_146 = <invalid>;
			bool S_145 = <invalid>;
			byte ah_149 = SLICE(ax_132, byte, 8);
			byte al_455 = (byte) ax_132;
		} while (O_147 | Z_146 | S_145);
		word16 ax_153 = SEQ(ah_149 - 0x01, al_455);
		do
		{
			byte cl_156 = <invalid>;
			ci8 bl_154;
			fn0C00_0298(SEQ(SLICE(ax_153, byte, 8), bh_454), -cl_156 - 0x01, -fn0C00_02AB((byte) ax_153, out bl_154), bl_154, out ax_153);
			bool Z_172 = <invalid>;
		} while (Z_172);
		fn0C00_0251(SEQ(SLICE((uint16) fn0C00_0251(SEQ(SLICE((uint16) fn0C00_0251(SEQ(SLICE((uint16) fn0C00_0251(SEQ(SLICE((uint16) fn0C00_0251(SEQ(SLICE((uint16) fn0C00_0251(200, 0x01, 0xA000, ds, gs_21), byte, 8), 0x78), ~0x14, 0xA000, ds, gs_21), byte, 8), 0x78), 0x28, 0xA000, ds, gs_21), byte, 8), 0x28), 0x78, 0xA000, ds, gs_21), byte, 8), 0x32), 0x80, 0xA000, ds, gs_21), byte, 8), ~0x00), 0x01, 0xA000, ds, gs_21);
		word16 bx_269 = 0x01;
		word16 cx_270 = 0x0104;
		do
		{
			fn0C00_0271(0x09, 0xA000, ds, fs_26, gs_21);
			word16 cx_297 = bx_269;
			byte Eq_24::* di_298 = Eq_24::a0000;
			do
			{
				fn0C00_02EE(cx_297, di_298, 0xA000, fs_26);
				di_298 += 320;
				--cx_297;
			} while (cx_297 != 0x00);
			word16 cx_323 = bx_269;
			word16 di_324 = 0xFA00;
			do
			{
				di_324 = fn0C00_02EE(cx_323, di_324 - cx_323, 0xA000, fs_26) - 0x0140;
				--cx_323;
			} while (cx_323 != 0x00);
			++bx_269;
			cx_270 = cx_525 - 0x01;
			byte ch_467 = SLICE(cx_525 - 0x01, byte, 8);
			cx_525 = cx_270;
		} while (cx_525 != 0x01);
		word16 cx_367 = SEQ(ch_467, 0x32);
		do
		{
			fn0C00_0271(0x08, 0xA000, ds, fs_26, gs_21);
			--cx_367;
			byte ch_487 = SLICE(cx_367, byte, 8);
		} while (cx_367 != 0x00);
		ci8 bh_386 = 0x00;
		word16 cx_390 = SEQ(ch_487, ~0x00);
		do
		{
			fn0C00_0271(0x08, 0xA000, ds, fs_26, gs_21);
			++bh_386;
			__out<byte>(0x03C8, bh_386);
			word16 cx_397 = 0x0300;
			do
			{
				__in<byte>(969);
				--cx_397;
				byte ch_490 = SLICE(cx_397, byte, 8);
			} while (cx_397 != 0x00);
			word16 cx_413 = SEQ(ch_490, 0x03);
			do
			{
				ci8 al_404 = __in<byte>(969);
				ci8 al_405 = al_404 - 0x01;
				if (al_404 < 0x01)
					al_405 = al_404;
				__out<byte>(969, al_405);
				--cx_413;
			} while (cx_413 != 0x00);
			cx_390 = cx_526 - 0x01;
			cx_526 = cx_390;
		} while (cx_526 != 0x01);
		fn0C00_0226(ds);
	}
}

// 0C00:0226: void fn0C00_0226(Register (ptr16 Eq_4) ds)
// Called from:
//      fn0C00_0100
//      fn0C00_0251
//      fn0C00_0271
void fn0C00_0226(struct Eq_4 * ds)
{
	bios_video_set_mode(0x03);
	msdos_display_string((char *) ds + 571);
	msdos_terminate_program20();
}

// 0C00:0251: Register byte fn0C00_0251(Register word16 cx, Register byte bl, Register (ptr16 Eq_24) es, Register (ptr16 Eq_4) ds, Register (ptr16 Eq_24) gs)
// Called from:
//      fn0C00_0100
byte fn0C00_0251(word16 cx, byte bl, struct Eq_24 * es, struct Eq_4 * ds, struct Eq_24 * gs)
{
	do
	{
		byte Eq_24::* di_15 = Eq_24::a0000;
		word16 cx_13;
		for (cx_13 = 0xFA00; cx_13 != 0x00; --cx_13)
		{
			es->*di_15 = fn0C00_02CA(&(gs->*di_15), bl);
			++di_15;
		}
		fn0C00_02B8(es, gs);
		byte al_41;
		byte ah_42;
		if (bios_kbd_check_keystroke(out al_41, out ah_42))
			fn0C00_0226(ds);
		cx = cx_65 - 0x01;
		cx_65 = cx;
	} while (cx_65 != 0x01);
	return SLICE(cx, byte, 8);
}

// 0C00:0271: void fn0C00_0271(Register byte bl, Register (ptr16 Eq_24) es, Register (ptr16 Eq_4) ds, Register (ptr16 Eq_24) fs, Register (ptr16 Eq_24) gs)
// Called from:
//      fn0C00_0100
void fn0C00_0271(byte bl, struct Eq_24 * es, struct Eq_4 * ds, struct Eq_24 * fs, struct Eq_24 * gs)
{
	byte Eq_24::* di_11 = Eq_24::a2BD4;
	word16 cx_34;
	for (cx_34 = 0xA280; cx_34 != 0x00; --cx_34)
	{
		byte dl_27 = fn0C00_02CA(&(gs->*di_11), bl);
		if (fs->*di_11 != 0x00)
			es->*di_11 = dl_27;
		++di_11;
	}
	fn0C00_02B8(es, gs);
	byte al_48;
	byte ah_49;
	if (!bios_kbd_check_keystroke(out al_48, out ah_49))
		return;
	fn0C00_0226(ds);
}

// 0C00:0298: FlagGroup byte fn0C00_0298(Sequence word16 ah_bh, Register byte cl, Register ci8 ch, Register ci8 bl, Register out Eq_136 axOut)
// Called from:
//      fn0C00_0100
byte fn0C00_0298(word16 ah_bh, byte cl, ci8 ch, ci8 bl, union Eq_136 & axOut)
{
	byte ah = SLICE(ah_bh, byte, 16);
	__out<byte>(0x03C8, bl);
	__out<word16>(969, ah_bh);
	__out<word16>(969, SEQ(ah, cl));
	__out<byte>(969, ch);
	axOut = SEQ(ah + 0x01, ch);
	return <invalid>;
}

// 0C00:02AB: Register byte fn0C00_02AB(Register Eq_141 ah, Register out Eq_141 blOut)
// Called from:
//      fn0C00_0100
byte fn0C00_02AB(Eq_141 ah, union Eq_141 & blOut)
{
	word16 ax;
	Eq_141 ah = SLICE(ax, byte, 8);
	byte ch_15 = __align(ah, 2);
	blOut = ah;
	return ch_15;
}

// 0C00:02B8: void fn0C00_02B8(Register (ptr16 Eq_24) ax, Register (ptr16 Eq_24) bp)
// Called from:
//      fn0C00_0100
//      fn0C00_0251
//      fn0C00_0271
void fn0C00_02B8(struct Eq_24 * ax, struct Eq_24 * bp)
{
	memcpy(bp->a0000[0], ax->a0000[0], 0xFA00);
}

// 0C00:02CA: Register byte fn0C00_02CA(Sequence (ptr32 Eq_365) gs_di, Register byte bl)
// Called from:
//      fn0C00_0251
//      fn0C00_0271
byte fn0C00_02CA(struct Eq_365 * gs_di, byte bl)
{
	Eq_478 dx_20 = gs_di->b0002 + gs_di->bFFFFFFFF + (uint16) gs_di->b0140 + (uint16) gs_di->bFFFFFEC0;
	return (byte) (dx_20 >> 0x02) - bl;
}

// 0C00:02EE: Register (memptr (ptr16 Eq_24) byte) fn0C00_02EE(Register word16 cx, Register (memptr (ptr16 Eq_24) byte) di, Register (ptr16 Eq_24) es, Register (ptr16 Eq_24) fs)
// Called from:
//      fn0C00_0100
byte Eq_24::* fn0C00_02EE(word16 cx, byte Eq_24::* di, struct Eq_24 * es, struct Eq_24 * fs)
{
	do
	{
		if (fs->*di == 0x00)
			es->*di = ~0x00;
		++di;
		--cx;
	} while (cx != 0x00);
	return di;
}

