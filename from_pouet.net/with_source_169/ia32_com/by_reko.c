// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register byte ah, Register byte cl, Register (ptr16 Eq_5) es, Register (ptr16 Eq_6) ds)
void fn0C00_0100(byte ah, byte cl, struct Eq_5 * es, struct Eq_6 * ds)
{
	mp16 fp;
	__syscall<byte>(0x10);
	real64 rLoc1_161 = 0.0;
	word16 ax_185 = SEQ(ah, 0x13);
	while (true)
	{
		byte al_155 = (byte) ax_185;
		byte Eq_5::* di_131 = Eq_5::a0400;
		word16 cx_134 = SEQ(~0x05, cl);
		while (true)
		{
			byte cl_121 = (byte) cx_134;
			word16 ax_151 = ax_185;
			if (cx_134 == 0x00)
				break;
			es->*di_131 = al_155;
			++di_131;
			--cx_134;
		}
		cup16 di_105 = 0x0400;
		do
		{
			ax_152 = SEQ(ah_150, al_102);
			real64 rLoc2_167 = rLoc1_161 / 32.0;
			real64 rLoc2_168 = cos(rLoc2_167);
			word16 ax_49 = ax_151 + 0x01;
			byte al_55 = fn0C00_0171(fp - 6, (byte) ax_49, 0xFE00, di_188, es, sin(rLoc2_167));
			fn0C00_015E(fp - 6, al_55 + 0x01, 0xFE00, di_188 + 0x96, es);
			fn0C00_0171(fp - 6, 0x04, 0xFE00, di_188, es, rLoc2_168);
			byte ah_150 = SLICE(SEQ(SLICE(ax_49, byte, 8), al_55) + 0x01, byte, 8);
			rLoc1_161 += 1.0;
			byte al_102 = __in<byte>(0x60);
			if (al_102 == 0x01)
				msdos_terminate_program20();
			di_105 = di_188 + 0x0140;
			di_188 = di_105;
			ax_151 = ax_152;
		} while (di_188 < 0xFCC0);
		memcpy(A000:0000, *((char *) ds + 0x0400), SEQ(~0x05, cl_121));
		cl = 0x00;
		ax_185 = SEQ(ah_150, al_102);
	}
}

// 0C00:015E: Register ui8 fn0C00_015E(Sequence (ptr32 Eq_62) ds_bx, Register ui8 al, Register Eq_64 bp, Register cup16 di, Register (ptr16 Eq_5) es)
// Called from:
//      fn0C00_0100
//      fn0C00_0171
ui8 fn0C00_015E(struct Eq_62 * ds_bx, ui8 al, Eq_64 bp, cup16 di, struct Eq_5 * es)
{
	struct Eq_130 Eq_5::* di_12 = di + ds_bx->w0000;
	do
	{
		(es->*di_12).b0000 = al;
		Eq_139 di_14 = di_12 + 1;
		es->*di_14 = al;
		ui8 al_17 = al ^ 0x08;
		es->*((word16) di_14 + 1) = al_17;
		es->*((word16) di_14 + 2) = al_17;
		al = al_17 ^ 0x08;
		di_12 = (word16) di_14 + 319;
	} while ((word16) di_14 + 319 < bp);
	return al_17 ^ 0x08;
}

// 0C00:0171: Register ui8 fn0C00_0171(Sequence (ptr32 Eq_62) ds_bx, Register ui8 al, Register Eq_64 bp, Register cup16 di, Register (ptr16 Eq_5) es, FpuStack real64 rArg0)
// Called from:
//      fn0C00_0100
ui8 fn0C00_0171(struct Eq_62 * ds_bx, ui8 al, Eq_64 bp, cup16 di, struct Eq_5 * es, real64 rArg0)
{
	ds_bx->w0000 = (int16) (rArg0 * (real64) ds_bx->w0004);
	return fn0C00_015E(ds_bx, al, bp, di + 0xAA, es);
}

