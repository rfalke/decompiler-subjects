// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_3) ds)
void fn0C00_0100(struct Eq_3 * ds)
{
	struct Eq_4 * cs;
	ds->ptr04F6 = (struct Eq_6 *) ((char *) cs + 0x00001000);
	bios_video_set_mode(0x13);
	__out<byte>(0x03C8, 0x00);
	bcu8 ah_130 = 0x00;
	do
	{
		uint8 al_22 = ah_130 >> 0x02;
		__out<byte>(969, al_22);
		__out<byte>(969, al_22);
		__out<byte>(969, al_22);
		++ah_130;
	} while (ah_130 != 0x00);
	__wait();
	__fninit();
	ds->r04EA = (real32) ((real64) ds->r0467 / (real64) ds->w046F);
	ds->r04EE = (real32) ((real64) ds->r0467 / (real64) ds->w0471);
	ds->r04F2 = (real32) ((real64) ds->dw0473 / (3.141592653589793 + 3.141592653589793));
	fn0C00_03C8((char *) cs + 0x00002000);
	Eq_90 Top_49 = 0x00;
	do
	{
		fn0C00_0186((char *) cs + 0x00001000);
		word64 rRet3_81;
		word64 rRet2_82;
		word64 rRet1_83;
		word64 rRet0_84 = fn0C00_01CF((char *) cs + 0x00001000, ds, (char *) cs + 0x00002000, out rRet1_83, out rRet2_82, out rRet3_81);
		Top_49.u1->qwFFFFFFFF = rRet3_81;
		Top_49.u1->qwFFFFFFFE = rRet2_82;
		Top_49.u1->qwFFFFFFFD = rRet1_83;
		Top_49.u1->qwFFFFFFFC = rRet0_84;
		fn0C00_0192(ds);
		fn0C00_01AA();
		ds->w047B += 0x0100;
		ds->w047D += 0x0100;
		Top_49 -= 4;
		byte al_114;
		byte ah_115;
	} while (bios_kbd_check_keystroke(out al_114, out ah_115));
	byte al_121;
	bios_kbd_get_keystroke(out al_121);
	bios_video_set_mode(0x03);
	msdos_display_string(&ds->r04A3 + 1);
	msdos_terminate(0x00);
}

// 0C00:0186: void fn0C00_0186(Register (ptr16 Eq_94) es)
// Called from:
//      fn0C00_0100
void fn0C00_0186(struct Eq_94 * es)
{
	word16 cx_10;
	word32 Eq_94::* di_13 = Eq_94::a0000;
	for (cx_10 = 16000; cx_10 != 0x00; --cx_10)
	{
		es->*di_13 = 0x00;
		++di_13;
	}
}

// 0C00:0192: void fn0C00_0192(Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_0100
void fn0C00_0192(struct Eq_3 * ds)
{
	memcpy(A000:0000, *ds->ptr04F6, 0xFA00);
}

// 0C00:01AA: void fn0C00_01AA()
// Called from:
//      fn0C00_0100
void fn0C00_01AA()
{
	do
		;
	while ((__in<byte>(0x03DA) & 0x08) == 0x00);
	do
		;
	while ((__in<byte>(0x03DA) & 0x08) != 0x00);
}

// 0C00:01CF: FpuStack real64 fn0C00_01CF(Register (ptr16 Eq_103) es, Register (ptr16 Eq_3) ds, Register (ptr16 Eq_105) gs, FpuStack out Eq_106 rLoc3Out, FpuStack out Eq_107 rLoc2Out, FpuStack out Eq_108 rLoc1Out)
// Called from:
//      fn0C00_0100
real64 fn0C00_01CF(struct Eq_103 * es, struct Eq_3 * ds, struct Eq_105 * gs, union Eq_106 & rLoc3Out, union Eq_107 & rLoc2Out, union Eq_108 & rLoc1Out)
{
	Eq_108 rRet1_11;
	Eq_107 rLoc2_43 = fn0C00_0433(ds, out rRet1_11);
	Eq_106 rRet1_25;
	real64 rLoc4_45 = fn0C00_01D9(ds, out rRet1_25);
	fn0C00_0300(es, ds, gs);
	rLoc3Out = rRet1_25;
	rLoc2Out = rLoc2_43;
	rLoc1Out = rRet1_11;
	return rLoc4_45;
}

// 0C00:01D9: FpuStack Eq_231 fn0C00_01D9(Register (ptr16 Eq_3) ds, FpuStack out Eq_231 rLoc1Out)
// Called from:
//      fn0C00_01CF
Eq_231 fn0C00_01D9(struct Eq_3 * ds, union Eq_231 & rLoc1Out)
{
	fn0C00_0268(&Eq_3::t04BA, &Eq_3::t048B, &Eq_3::t047F, ds);
	Eq_231 rLoc1_64 = (real64) ds->r04EA;
	fn0C00_0281(&Eq_3::t04BA, &Eq_3::t04BA, ds, rLoc1_64);
	__ffree(rLoc1_64);
	fn0C00_0268(&Eq_3::t04C6, &Eq_3::t0497, &Eq_3::t047F, ds);
	Eq_231 rLoc2_65 = (real64) ds->r04EE;
	fn0C00_0281(&Eq_3::t04C6, &Eq_3::t04C6, ds, rLoc2_65);
	__ffree(rLoc2_65);
	fn0C00_0298(&Eq_3::t047F, &Eq_3::t04D2, ds);
	ds->ptr04FC = &Eq_3::t04FE;
	word16 cx_26 = 0x33;
	do
	{
		fn0C00_0298(&Eq_3::t04D2, &Eq_3::r04DE, ds);
		word16 cx_38 = 0x51;
		do
		{
			fn0C00_02AF(ds);
			fn0C00_024F(&Eq_3::r04DE, &Eq_3::r04DE, &Eq_3::t04BA, ds);
			cx_38 = cx_82 - 0x01;
			cx_82 = cx_38;
		} while (cx_82 != 0x01);
		fn0C00_024F(&Eq_3::t04D2, &Eq_3::t04D2, &Eq_3::t04C6, ds);
		cx_26 = cx_81 - 0x01;
		cx_81 = cx_26;
	} while (cx_81 != 0x01);
	rLoc1Out = rLoc1_64;
	return rLoc2_65;
}

// 0C00:024F: void fn0C00_024F(Register (memptr (ptr16 Eq_3) Eq_313) bx, Register (memptr (ptr16 Eq_3) Eq_314) si, Register (memptr (ptr16 Eq_3) Eq_315) di, Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_01D9
void fn0C00_024F(struct Eq_313 Eq_3::* bx, struct Eq_314 Eq_3::* si, struct Eq_315 Eq_3::* di, struct Eq_3 * ds)
{
	(ds->*bx).r0000 = (real32) ((real64) (ds->*si).r0000 + (real64) (ds->*di).r0000);
	(ds->*bx).r0004 = (real32) ((real64) (ds->*si).r0004 + (real64) (ds->*di).r0004);
	(ds->*bx).r0008 = (real32) ((real64) (ds->*si).r0008 + (real64) (ds->*di).r0008);
}

// 0C00:0268: void fn0C00_0268(Register (memptr (ptr16 Eq_3) Eq_251) bx, Register (memptr (ptr16 Eq_3) Eq_252) si, Register (memptr (ptr16 Eq_3) Eq_253) di, Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_01D9
void fn0C00_0268(struct Eq_251 Eq_3::* bx, struct Eq_252 Eq_3::* si, struct Eq_253 Eq_3::* di, struct Eq_3 * ds)
{
	(ds->*bx).r0000 = (real32) ((real64) (ds->*si).r0000 - (real64) (ds->*di).r0000);
	(ds->*bx).r0004 = (real32) ((real64) (ds->*si).r0004 - (real64) (ds->*di).r0004);
	(ds->*bx).r0008 = (real32) ((real64) (ds->*si).r0008 - (real64) (ds->*di).r0008);
}

// 0C00:0281: void fn0C00_0281(Register (memptr (ptr16 Eq_3) Eq_266) si, Register (memptr (ptr16 Eq_3) Eq_267) di, Register (ptr16 Eq_3) ds, FpuStack Eq_231 rArg0)
// Called from:
//      fn0C00_01D9
void fn0C00_0281(struct Eq_266 Eq_3::* si, struct Eq_267 Eq_3::* di, struct Eq_3 * ds, Eq_231 rArg0)
{
	(ds->*di).r0000 = (real32) ((real64) (ds->*si).r0000 * rArg0);
	(ds->*di).r0004 = (real32) ((real64) (ds->*si).r0004 * rArg0);
	(ds->*di).r0008 = (real32) ((real64) (ds->*si).r0008 * rArg0);
}

// 0C00:0298: void fn0C00_0298(Register (memptr (ptr16 Eq_3) Eq_295) si, Register (memptr (ptr16 Eq_3) Eq_296) di, Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_01D9
void fn0C00_0298(struct Eq_295 Eq_3::* si, struct Eq_296 Eq_3::* di, struct Eq_3 * ds)
{
	word32 ebx_8 = (ds->*si).dw0004;
	word32 ecx_9 = (ds->*si).dw0008;
	(ds->*di).dw0000 = (ds->*si).dw0000;
	(ds->*di).dw0004 = ebx_8;
	(ds->*di).dw0008 = ecx_9;
}

// 0C00:02AF: void fn0C00_02AF(Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_01D9
void fn0C00_02AF(struct Eq_3 * ds)
{
	real64 rLoc1_41 = (real64) ds->r04DE;
	real64 rLoc2_43 = (real64) ds->r04E2;
	ds->t04F8.u0 = (int32) ((real64) ds->r04A3 / sqrt(rLoc1_41 * rLoc1_41 + rLoc2_43 * rLoc2_43) * (real64) ds->r04E6 * (real64) ds->r046B);
	struct Eq_301 Eq_3::* di_20 = ds->ptr04FC;
	(ds->*di_20).w0000 = (word16) ((word32) ds->t04F8 + ds->w047D);
	ds->t04F8.u0 = (int32) (__atan2((real64) ds->r04DE, (real64) ds->r04E2) * (real64) ds->r04F2);
	(ds->*di_20).w0002 = (word16) ((word32) ds->t04F8 + ds->w047B);
	ds->ptr04FC = &ds->ptr04FC->w0002 + 1;
}

// 0C00:0300: void fn0C00_0300(Register (ptr16 Eq_103) es, Register (ptr16 Eq_3) ds, Register (ptr16 Eq_105) gs)
// Called from:
//      fn0C00_01CF
void fn0C00_0300(struct Eq_103 * es, struct Eq_3 * ds, struct Eq_105 * gs)
{
	struct Eq_588 Eq_3::* si_129 = &Eq_3::t04FE;
	struct Eq_590 Eq_103::* di_101 = &Eq_103::t0000;
	word16 cx_12 = 0x32;
	do
	{
		word16 cx_133 = 0x50;
		do
		{
			word32 ebx_119 = si_129[1];
			word32 eax_118 = (ds->*si_129).dw0000;
			word32 edx_28 = si_129[82] - ebx_119;
			word32 ebp_31 = __rol<word32,byte>(si_129[81] - eax_118, 0x10);
			word32 edx_33 = __rol<word32,byte>(edx_28, 0x10);
			word32 ebp_41 = __rol<word32,byte>(SEQ(SLICE(ebp_31, word16, 16), (word16) ebp_31 >> 0x02), 0x10);
			word32 edx_45 = __rol<word32,byte>(SEQ(SLICE(edx_33, word16, 16), (word16) edx_33 >> 0x02), 0x10);
			ds->dw0500 = SEQ(SLICE(ebp_41, word16, 16), (word16) ebp_41 >> 0x02);
			ds->dw0504 = SEQ(SLICE(edx_45, word16, 16), (word16) edx_45 >> 0x02);
			byte ch_122;
			for (ch_122 = 0x04; ch_122 != 0x00; --ch_122)
			{
				word32 ebx_69 = __rol<word32,byte>(ebx_119 - eax_118, 0x10);
				word32 ebx_75 = __rol<word32,byte>(SEQ(SLICE(ebx_69, word16, 16), (word16) ebx_69 >> 0x02), 0x10);
				word32 ebx_80 = SEQ(SLICE(ebx_75, word16, 16), (word16) ebx_75 >> 0x02);
				byte cl_105;
				eax_103 = eax_118;
				for (cl_105 = 0x04; cl_105 != 0x00; --cl_105)
				{
					word32 eax_103;
					word32 eax_89 = __rol<word32,byte>(eax_103, 0x10);
					word32 eax_93 = __rol<word32,byte>(eax_89, 0x10);
					(es->*di_101).b0000 = gs->*SEQ(SLICE(eax_89, byte, 8), SLICE(eax_103, byte, 8));
					di_101 = &di_101->b0000 + 1;
					eax_103 = eax_93 + ebx_80;
				}
				di_101 = &di_101->b0000 + 316;
				eax_118 += ds->dw0500;
				ebx_119 += ds->dw0504;
			}
			di_101 -= 0x03C0;
			++si_129;
			cx_133 = cx_187 - 0x01;
			cx_187 = cx_133;
		} while (cx_187 != 0x01);
		++si_129;
		cx_12 = cx_186 - 0x01;
		cx_186 = cx_12;
	} while (cx_186 != 0x01);
}

// 0C00:03B1: Register byte fn0C00_03B1(Register Eq_742 cl, Register Eq_743 dx)
// Called from:
//      fn0C00_040E
byte fn0C00_03B1(Eq_742 cl, Eq_743 dx)
{
	int16 ax_6 = (int16) __in<byte>(0x40);
	ci16 dx_14 = (word16) dx.u1 + (SEQ(SLICE(ax_6, byte, 8), (byte) ax_6 << cl) >> 0x03);
	if (dx_14 < 0x00)
		dx_14 = 0x00;
	byte dh_21 = SLICE(dx_14, byte, 8);
	ci16 dx_32 = dx_14;
	if (dh_21 != 0x00)
		dx_32 = SEQ(dh_21, ~0x00);
	return (byte) dx_32;
}

// 0C00:03C8: void fn0C00_03C8(Register (ptr16 Eq_86) gs)
// Called from:
//      fn0C00_0100
void fn0C00_03C8(struct Eq_86 * gs)
{
	gs->b0000 = 0x80;
	gs->b0080 = 0x80;
	gs->b8000 = 0x80;
	gs->b8080 = 0x80;
	bcu8 Eq_86::* bx_20 = &Eq_86::b0000;
	Eq_742 cx_13 = 0x80;
	do
	{
		do
		{
			do
			{
				bx_83 = SEQ(bh_72, bl_69);
				bcu8 Eq_86::* bx_36 = fn0C00_040E(cx_91, cx_91 << 0x08, fn0C00_040E(SLICE(cx_91, byte, 8), cx_91, bx_20, gs), gs);
				fn0C00_040E(cx_91, -cx_91, SEQ(SLICE(bx_36, byte, 8), (byte) bx_36 + cx_91 *8 0x02), gs);
				byte bh_72 = SLICE(bx_36, byte, 8);
				cx_13 = cx_91;
				byte ch_80 = SLICE(cx_91, byte, 8);
				cu8 bl_69 = (byte) bx_36 + cx_91 *8 0x02;
				cx_91 = cx_13;
				bx_20 = bx_83;
			} while (bl_69 >= 0x00);
			cu8 bh_74 = bh_72 + cx_91 *8 0x02;
			bx_20 = SEQ(bh_74, bl_69);
			cx_92 = cx_13;
		} while (bh_74 >= 0x00);
		cx_13 = SEQ(ch_80, cx_91 >> 0x01);
		cx_93 = cx_13;
	} while (cx_91 >> 0x01 != 0x00);
}

// 0C00:040E: Register (memptr (ptr16 Eq_86) bcu8) fn0C00_040E(Register Eq_742 ch, Register Eq_742 cl, Register (memptr (ptr16 Eq_86) bcu8) bx, Register (ptr16 Eq_86) gs)
// Called from:
//      fn0C00_03C8
bcu8 Eq_86::* fn0C00_040E(Eq_742 ch, Eq_742 cl, bcu8 Eq_86::* bx, struct Eq_86 * gs)
{
	byte bh_9 = SLICE(bx, byte, 8);
	byte bl_13 = (byte) bx;
	byte bh_12 = bh_9 + ch *8 0x02;
	byte bl_16 = bl_13 + cl *8 0x02;
	byte bh_34 = bh_12 - ch;
	byte bl_35 = bl_16 - cl;
	gs->*SEQ(bh_34, bl_35) = fn0C00_03B1(cl, gs->*SEQ(bh_12, bl_16) + gs->*bx >> 0x01);
	return SEQ(bh_34 - ch, bl_35 - cl);
}

// 0C00:0433: FpuStack Eq_231 fn0C00_0433(Register (ptr16 Eq_3) ds, FpuStack out Eq_231 rLoc1Out)
// Called from:
//      fn0C00_01CF
Eq_231 fn0C00_0433(struct Eq_3 * ds, union Eq_231 & rLoc1Out)
{
	real64 rLoc1_47 = (real64) ds->r0477;
	Eq_231 rLoc1_48 = cos(rLoc1_47);
	struct Eq_889 Eq_3::* si_17 = &Eq_3::t047F;
	Eq_231 rLoc2_49 = sin(rLoc1_47);
	word16 cx_13;
	for (cx_13 = 0x03; cx_13 != 0x00; --cx_13)
	{
		real64 rLoc4_51 = (real64) (ds->*si_17).r0004;
		real64 rLoc3_50 = (real64) (ds->*si_17).r0008;
		(ds->*si_17).r0004 = (real32) (rLoc4_51 * rLoc2_49 - rLoc3_50 * rLoc1_48);
		(ds->*si_17).r0008 = (real32) (rLoc4_51 * rLoc1_48 + rLoc3_50 * rLoc2_49);
		++si_17;
	}
	__ffree(rLoc2_49);
	__ffree(rLoc1_48);
	rLoc1Out = rLoc1_48;
	return rLoc2_49;
}

