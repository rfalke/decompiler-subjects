// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register (memptr (ptr16 Eq_25) real32) bx, Register (ptr16 Eq_4) ds)
void fn0C00_0100(real32 Eq_25::* bx, struct Eq_4 * ds)
{
	struct Eq_5 * cs;
	__syscall<byte>(0x10);
	byte ah_7 = SLICE(cs, byte, 8);
	byte al_9 = (byte) cs;
	__wait();
	__fninit();
	struct Eq_5 * ax_10 = SEQ(ah_7 + 0x10, al_9);
	struct Eq_25 * ax_14 = SEQ(ah_7 + 0x20, al_9);
	struct Eq_5 * ax_18 = SEQ(ah_7 + 0x30, al_9);
	real64 rLoc1_329 = 0.0;
	do
	{
		ax_14->*bx = (real32) sin(rLoc1_329);
		rLoc1_329 += (real64) ds->r02EE;
		++bx;
	} while (bx != &Eq_25::r0000);
	__out<byte>(0x03C8, 0x00);
	byte al_40 = 0x00;
	ui8 dl_282 = 0xC9;
	ui8 dh_284 = 0x03;
	word16 cx_105;
	for (cx_105 = 0x40; cx_105 != 0x00; --cx_105)
	{
		__out<byte>(969, al_40);
		__out<byte>(969, al_40);
		__out<byte>(969, al_40);
		++al_40;
	}
	fn0C00_02C9(969);
	ds->b02CF = 0xC3;
	ds->b02E0 = 0xC0;
	uint8 bl_100 = fn0C00_02C9(969);
	struct Eq_100 Eq_5::* di_104 = &Eq_5::tFA00;
	do
	{
		bcu8 bl_81 = bl_100 + (0xA000->*di_104).bFFFFFEC0 + (0xA000->*di_104).bFFFFFEC1 + (0xA000->*di_104).bFFFFFEC2;
		word16 dx_88 = __ror<word16,byte>(SEQ(dh_284, dl_282 - dh_284), 0x03);
		uint8 al_93 = (((byte) dx_88 ^ 0x36) >> 0x06) + (bl_81 >> 0x02);
		(0xA000->*di_104).b0000 = al_93 - 0x01;
		(ax_10->*di_104).b0000 = al_93 - 0x01;
		ui16 dx_109 = dx_88 ^ 0x3636;
		dl_282 = (byte) dx_88 ^ 0x36;
		dh_284 = SLICE(dx_88, byte, 8) ^ 0x36;
		bl_100 = al_93 - 0x01;
		++di_104;
		--cx_105;
	} while (cx_105 != 0x00);
	do
	{
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) == 0x00);
		memcpy(&&(ax_18->*(ax_18->*di_104).b0000), &&(ax_10->*(ax_10->*di_104).b0000), cx_105 - 0x01);
		byte v33_149 = cs->b02FF - 0x01;
		cs->b02FF = v33_149;
		cx_105 = 0x00;
		struct Eq_5 * ds_147 = cs;
		if (v33_149 == 0x00)
		{
			__out<byte>(0x0330, 0xC9);
			__out<byte>(0x0330, 0x01);
			__out<byte>(0x0330, 0x99);
			byte al_158 = cs->b02F2;
			if (al_158 == 0x00)
				al_158 = cs->b02F2;
			cs->w01A3 = 755;
			__out<byte>(0x0330, al_158);
			__out<byte>(0x0330, 0x7F);
			cs->b02FF = 0x03;
		}
		word16 ax_181 = 0x00;
		do
		{
			do
			{
				ax_311 = SEQ(ah_223 + 0x01, al_310);
				ds_147->t0370.u1 = 0x00;
				ds_147->w0374 = 0x3C;
				fn0C00_02A9(ax_181, &Eq_5::t0370, &Eq_5::w0374, ds_147);
				word16 di_388;
				fn0C00_0299(cx_105, dx_109, &Eq_5::t0370, &Eq_5::w0372, ds_147, out di_388);
				ds_147->w0376 = 0x80;
				ds_147->dw0378 = 0x00;
				byte dh_230 = SLICE(dx_109, byte, 8);
				byte dl_291 = (byte) dx_109;
				byte ah_223 = SLICE(ax_181, byte, 8);
				byte al_310 = (byte) ax_181;
				struct Eq_285 Eq_5::* di_212;
				ds_147 = fn0C00_0235((byte) ax_181, (byte) cx_105, fn0C00_0299(cx_105, dx_109, &Eq_5::w0376, &Eq_5::dw0378, ds_147, out di_212), di_212, ds_147, ax_18);
				ax_181 = ax_311;
			} while (ah_223 != ~0x00);
			cx_105 += 0x80;
			ax_181 = ax_311;
		} while (cx_105 != 0x00);
		di_104 = &Eq_5::t0000;
		dx_109 = SEQ(dh_230 - 0x02, dl_291);
		do
		{
			if ((ds_147->*di_104).b0000 != 0x7F && di_104[0x0A10] == 0x7F)
				di_104[0x0A10] = (struct Eq_100) ((ax_10->*di_104).b0000 - 0x08);
			(ds_147->*di_104).b0000 = 0x7F;
			(0xA000->*di_104).b0000 = (ax_18->*di_104).b0000;
			++di_104;
			--cx_105;
		} while (cx_105 != 0x00);
	} while (__in<byte>(0x60) != 0x01);
	bios_video_set_mode(0x03);
}

// 0C00:0235: Register (ptr16 Eq_5) fn0C00_0235(Register byte ah, Register byte ch, Register (memptr (ptr16 Eq_5) ci16) si, Register (memptr (ptr16 Eq_5) Eq_285) di, Register (ptr16 Eq_5) ds, Register (ptr16 Eq_5) fs)
// Called from:
//      fn0C00_0100
struct Eq_5 * fn0C00_0235(byte ah, byte ch, ci16 Eq_5::* si, struct Eq_285 Eq_5::* di, struct Eq_5 * ds, struct Eq_5 * fs)
{
	word16 ax;
	word16 cx;
	byte ah_30 = SLICE(ax, byte, 8);
	byte ch_29 = SLICE(cx, byte, 8);
	Eq_239 ax_47 = ds->t0370;
	int16 ax_51 = ds->w0372;
	struct Eq_5 * cx_66 = SEQ(SLICE(fs, byte, 8) + 0x10, (byte) fs);
	ci8 bl_69 = (byte) ((ds->*di).wFFFFFFFA + (ds->*di).w0000 >> 0x01);
	byte al_59 = (byte) (~(ax_51 *s ax_51 + ax_47 *s16 ax_47) >> 0x06) + 0x80 + ((ch_29 ^ ah_30) & 0x20) * 0x02;
	fn0C00_028E(fn0C00_028E(fn0C00_028E(fn0C00_028E((ds->w0372 + ds->*si >> 0x01) *s 0x0140 + (((word32) ds->t0370 + ds->w0376 >> 0x01) + 0x7DA0), al_59, bl_69, fs), al_59, bl_69, fs) + 0x013E, al_59, bl_69, fs), al_59, bl_69, fs);
	return cx_66;
}

// 0C00:028E: Register (memptr (ptr16 Eq_5) byte) fn0C00_028E(Sequence (ptr32 ci8) ds_di, Register byte al, Register ci8 bl, Register (ptr16 Eq_5) fs)
// Called from:
//      fn0C00_0235
byte Eq_5::* fn0C00_028E(ci8 * ds_di, byte al, ci8 bl, struct Eq_5 * fs)
{
	byte Eq_5::* di = (word16) ds_di;
	if (*ds_di >= bl)
	{
		*ds_di = bl;
		fs->*di = al;
	}
	return di + 1;
}

// 0C00:0299: Register (memptr (ptr16 Eq_5) int16) fn0C00_0299(Sequence (ptr32 Eq_249) gs_cx, Register ui16 dx, Register (memptr (ptr16 Eq_5) int16) si, Register (memptr (ptr16 Eq_5) int16) di, Register (ptr16 Eq_5) ds, Register out ptr16 diOut)
// Called from:
//      fn0C00_0100
int16 Eq_5::* fn0C00_0299(struct Eq_249 * gs_cx, ui16 dx, int16 Eq_5::* si, int16 Eq_5::* di, struct Eq_5 * ds, ptr16 & diOut)
{
	struct Eq_471 * gs = SLICE(gs_cx, selector, 16);
	fn0C00_02A9(gs_cx, si, di, ds);
	fn0C00_02A9(dx, si, di + 1, ds);
	fn0C00_02A9(dx, si + 1, di + 1, ds);
	diOut = di + 1;
	return si + 1;
}

// 0C00:02A9: void fn0C00_02A9(Sequence (ptr32 Eq_249) gs_bx, Register (memptr (ptr16 Eq_5) int16) si, Register (memptr (ptr16 Eq_5) int16) di, Register (ptr16 Eq_5) ds)
// Called from:
//      fn0C00_0100
//      fn0C00_0299
void fn0C00_02A9(struct Eq_249 * gs_bx, int16 Eq_5::* si, int16 Eq_5::* di, struct Eq_5 * ds)
{
	real64 rLoc2_35 = (real64) (ds->*si);
	real64 rLoc1_34 = (real64) gs_bx->r4000;
	ds->*si = (int16) (rLoc2_35 * (real64) gs_bx->r0000 - (real64) (ds->*di) * rLoc1_34);
	ds->*di = (int16) (rLoc1_34 * rLoc2_35 + (real64) (ds->*di) * (real64) gs_bx->r0000);
}

// 0C00:02C9: Register byte fn0C00_02C9(Register uint16 dx)
// Called from:
//      fn0C00_0100
byte fn0C00_02C9(uint16 dx)
{
	byte bl_14;
	byte bh_19 = 0x00;
	for (bl_14 = 0x00; bl_14 != 0x40; bl_14 += 0x02)
	{
		__out<byte>(dx, bl_14);
		__out<byte>(dx, 0x00);
		__out<byte>(dx, 0x00);
	}
	do
	{
		__out<byte>(dx, 0x3F);
		__out<byte>(dx, bh_19);
		__out<byte>(dx, bh_19);
		bh_19 += 0x02;
	} while (bh_19 != 0x40);
	return bl_14;
}

