/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <math.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void sub_8048814();
// int XDrawString(Display *, Drawable, GC, int, int, const char *, int);
// int XMapWindow(Display *, Window);
// int MikMod_RegisterAllLoaders(void); weak
// int fprintf(FILE *stream, const char *format, ...);
// Window XCreateSimpleWindow(Display *, Window, int, int, unsigned int, unsigned int, unsigned int, unsigned int, unsigned int);
// int XSetForeground(Display *, GC, unsigned int);
// int __cdecl MikMod_strerror(_DWORD); weak
// size_t strlen(const char *s);
// int XParseColor(Display *, Colormap, const char *, XColor *);
// XFontStruct *XLoadQueryFont(Display *, const char *);
// int printf(const char *format, ...);
// int MikMod_RegisterAllDrivers(void); weak
// int __cdecl MikMod_Init(_DWORD); weak
// int XAllocColor(Display *, Colormap, XColor *);
// int XSetFont(Display *, GC, Font);
// void exit(int status);
// int MikMod_Update(void); weak
// int __cdecl Player_Start(_DWORD); weak
// int XClearWindow(Display *, Window);
// int __cdecl Player_Load(_DWORD, _DWORD, _DWORD); weak
// double sin(double x);
// GC XCreateGC(Display *, Drawable, unsigned int, XGCValues *);
// Display *XOpenDisplay(const char *);
int __cdecl FontInit(const char *);
int __cdecl XPrint(int, int, int, int, char *s); // idb
int __cdecl init(unsigned int, unsigned int);
int MikmodInit();
int __cdecl main(int argc, const char **argv, const char **envp);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN unk_8048E10; // weak
char dude[4920] = "Hello everyone, this is a long boring scroller brought to you by **** l33t kru, we have no idea what to write in here, so lets have a technical description of the production. We spent 2 hours making this masterpiece, it is so advanced and all that, bla bla. Let's get to the fun part of this scroller <insert random german stuff here>. Fr09 is here to make you happy, and the product and all that, i like the speakers! And they have girls? What. Okey, seriously, this is a stupid production, we don't know why we made it, but we did, so there, hah! If you enjoy stuff like this you are our friend, at least not our enemy.                                             Seriously: this production sucks, it depends xlib, we had no idea how to make the window doublebuffer and we didn't bother googling for the answer, so we made some stupid stuff which would not make it flimmer that much, by not clearing the screen every frame, hah. Okey. This should not take a fast machine to run, but since we don't have a timing routine of some sort it will not run independent of the framerate, which means if you have a fast computer this scroller will almost be unreadable, haha, which also means you are clearly owned by this scroller. There is so much interresting information here that I think you would like to read, but then again, no. Why am I writing this stuff? Probably because I am bored, and i think there is a lot of spiellieng missteiks as well so if you feel like whining send all your whine requests to a random SCO email. This production was made possible thanks to the following people: ... oh wait. We choose to stay anonymous. We greet everyone, because we are so nice and all that. We are SUPER. Okey, not really. THE END.                                            Hah, tricked you which scrollers always do. Do you feel like continue reading? Okey, well, we do have a few more things to say. Blizzard recently shut down the freecraft project, damn Blizzard for this, you can read more about this in a slashdot article, or something like that. Do you feel ENJOY? We do. To change the subject, we should have some effect running on the side of this scroller, but what? If you have some cool stuff you would like in our next release send your suggestions to a random SCO email as always, it does help, or you could send it to a blizzard email, it's all up to you! We are looking forward to this summer, assembly coming up and scene event as well, we just can't wait! Will we contribute with a demo? Maybe! Are you contributing? You should. I need to do something productive for a change, but it has been a lot of fun writing this scroller, hope you had fun reading it as well, i REALLY hope so, because .. umm.            No, we are not done yet. You are now 30% in our scroller, still a lot more information we need to put here. Lot's of important stuff. We enjoy iste and coke, and some other liquid. If you have some of that, please bring it to us, this summer heat is killing us, not litterally though. 32%... Did you enjoy The Gathering 2003? We did. It was a lot of fun, hope it will be as good next year as it was this year, we didn't acually contribute with a good demo, the timing got all screwed and one of our coders got sick and went to sleep, but the most important thing is of course that he is okey. Alive'n'kickin'! We are ready to contribute with something better to one of the parties we mentioned earlier, at least we hope so, but it's often like this, we have huge plans then it don't turn our that way after all. I've seen it happen man! The binary is 68467 right now, probably more now, that is unstipped though. 5560byte with sstrip and upx, woho. This is no 4k, damn. Would be cool if it was, can see if i'll stip something more down and make it a 4k, would be cool, but then again no. I still need music. How should I make that one? I have no idea. Soundtracker, i suck at tracking. ... Okey, I just made something, did you like it? I personaly think it suck, which it does. There, now this intro or demo or whatever you want to call it is complete. Did you like the 300x100 resolution window? I thin you did! This has been a long scroller, when I said we were 30% earlier it was just a joke, hah, hope you didn't believe it and quit this thing. It's such a fine small scroller. I need to find a good color for the text as wel, so I'll guess the current color will do! This demo is done now, thanks for watching, you can continue to watch if you want to hear the rest of the cool repeting tune, but i don't think you want to do that. I made it 101 patterns, so it should play for some time, but the text ends here, good bye.                                                                                                                                                                             haha. You located the secret part, or are you viewing the source code now? Congratulations."; // idb
char color[] = "#6eff00"; // idb
FILE *stderr; // idb
int MikMod_errno; // weak
GC green_gc; // idb
Colormap colormap; // idb
XColor green_col; // idb
Drawable win; // idb
Display *dis; // idb
float tim; // weak
float rut; // weak


//----- (08048814) --------------------------------------------------------
void sub_8048814()
{
  JUMPOUT(0);
}
// 804881A: control flows out of bounds to 0

//----- (08048A54) --------------------------------------------------------
int __cdecl FontInit(const char *a1)
{
  XFontStruct *Font; // [esp+4h] [ebp-4h]

  Font = XLoadQueryFont(dis, a1);
  return XSetFont(dis, green_gc, Font->fid);
}

//----- (08048A98) --------------------------------------------------------
int __cdecl XPrint(int a1, int a2, int a3, int a4, char *s)
{
  int v6; // [esp-8h] [ebp-20h]

  v6 = strlen(s);
  return XDrawString(
           dis,
           win,
           green_gc,
           (int)COERCE_DOUBLE(__PAIR64__(a2, a1)),
           (int)COERCE_DOUBLE(__PAIR64__(a4, a3)),
           s,
           v6);
}

//----- (08048B14) --------------------------------------------------------
int __cdecl init(unsigned int a1, unsigned int a2)
{
  dis = XOpenDisplay(0);
  win = XCreateSimpleWindow(dis, dis->screens->root, 0, 0, a1, a2, 0, 0, dis->screens->black_pixel);
  XMapWindow(dis, win);
  colormap = dis->screens->cmap;
  green_gc = XCreateGC(dis, win, 0, 0);
  XParseColor(dis, colormap, color, &green_col);
  XAllocColor(dis, colormap, &green_col);
  return XSetForeground(dis, green_gc, green_col.pixel);
}

//----- (08048C0C) --------------------------------------------------------
int MikmodInit()
{
  const char *v0; // eax
  const char *v1; // eax
  int v3; // [esp+4h] [ebp-4h]

  MikMod_RegisterAllDrivers();
  MikMod_RegisterAllLoaders();
  if ( MikMod_Init(&unk_8048E10) )
  {
    v0 = (const char *)MikMod_strerror(MikMod_errno);
    fprintf(stderr, "MikMod: %s\n", v0);
    exit(1);
  }
  v3 = Player_Load("ting.mod", 128, 0);
  if ( !v3 )
  {
    v1 = (const char *)MikMod_strerror(MikMod_errno);
    printf("MikMod Error: %s\n", v1);
    exit(1);
  }
  return Player_Start(v3);
}
// 8048844: using guessed type int MikMod_RegisterAllLoaders(void);
// 8048884: using guessed type int __cdecl MikMod_strerror(_DWORD);
// 80488E4: using guessed type int MikMod_RegisterAllDrivers(void);
// 80488F4: using guessed type int __cdecl MikMod_Init(_DWORD);
// 8048944: using guessed type int __cdecl Player_Start(_DWORD);
// 8048964: using guessed type int __cdecl Player_Load(_DWORD, _DWORD, _DWORD);
// 804A4E4: using guessed type int MikMod_errno;

//----- (08048CBE) --------------------------------------------------------
int __cdecl __noreturn main(int argc, const char **argv, const char **envp)
{
  void *v3; // esp
  long double v4; // fst7

  v3 = alloca(0);
  init(0x12Cu, 0x64u);
  FontInit("12x24");
  MikmodInit();
  while ( 1 )
  {
    v4 = sin(rut / 300.0);
    XPrint(
      COERCE_UNSIGNED_INT64(400.0 - rut / 2.0),
      HIDWORD(COERCE_UNSIGNED_INT64(400.0 - rut / 2.0)),
      COERCE_UNSIGNED_INT64(v4 * 20.0 + 60.0),
      HIDWORD(COERCE_UNSIGNED_INT64(v4 * 20.0 + 60.0)),
      dude);
    rut = rut + 0.1;
    tim = tim + 1.0;
    if ( tim > 50.0 )
    {
      XClearWindow(dis, win);
      tim = 0.0;
    }
    MikMod_Update();
  }
}
// 8048934: using guessed type int MikMod_Update(void);
// 804A584: using guessed type float tim;
// 804A588: using guessed type float rut;

// nfuncs=61 queued=6 decompiled=6 lumina nreq=0 worse=0 better=0
// ALL OK, 6 function(s) have been successfully decompiled
