// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_3) ds)
void fn0C00_0100(struct Eq_3 * ds)
{
	bios_video_set_mode(0x03);
	__syscall<byte>(0x10);
	__syscall<byte>(0x10);
	byte ah_8;
	byte bh_9;
	if (bios_video_get_current_video_mode(out ah_8, out bh_9) != 0x07)
		ds->w013A = 0xB800;
	Eq_28 bx_372 = msdos_get_interrupt_vector(0x08);
	ds->t0501 = bx_372;
	byte Eq_3::* si_115 = fn0C00_033E(&ds->t04A6);
	uint16 bp_32 = 0x00;
	word16 cx_33;
	struct Eq_48 Eq_61::* di_116 = Eq_61::a0000;
	ui8 dl_117 = 0x00;
	for (cx_33 = 6000; cx_33 != 0x00; --cx_33)
	{
		(0xB000->*di_116).w0000 = 0x00;
		++di_116;
	}
	while (true)
	{
		byte bl_67 = (byte) bx_372;
		if (bp_32 == 0x20)
		{
			si_115 = &Eq_3::b05AD;
			di_116 = (struct Eq_48 Eq_61::*) Eq_61::a0000;
			dl_117 |= 0x08;
		}
		if (bp_32 == 0x60)
			dl_117 |= 0x04;
		Eq_28 bx_79 = bx_372;
		if (bp_32 == 0x80)
		{
			bx_79.u0 = (uint16) fn0C00_0362(bl_67 & ~0x01, 0xB000, ds);
			si_115 = &Eq_3::b05DC;
			di_116 = (struct Eq_48 Eq_61::*) Eq_61::a0FA0;
			dl_117 = dl_117 ^ 0x04 | 0x88;
		}
		byte bl_97 = (byte) bx_79;
		Eq_28 bx_106 = bx_79;
		if (bp_32 == 0x0100)
		{
			bx_106.u0 = (uint16) fn0C00_0362(bl_97 | 0x01, 0xB000, ds);
			si_115 = &Eq_3::b0625;
			di_116 = (struct Eq_48 Eq_61::*) Eq_61::a0FA0;
			dl_117 |= 0x08;
		}
		if (bp_32 == 0x011E)
			si_115 = &Eq_3::b0644;
		if (bp_32 == 0x0140)
			dl_117 = dl_117 ^ 0x84;
		Eq_28 bx_156 = bx_106;
		if (bp_32 == 0x0160)
		{
			ui8 dl_139 = dl_117 ^ 0x04;
			word16 Eq_61::* di_140 = Eq_61::a0FA0;
			word16 cx_141;
			for (cx_141 = 2000; cx_141 != 0x00; --cx_141)
			{
				0xB000->*di_140 = 0x00;
				++di_140;
			}
			bx_156.u0 = (uint16) fn0C00_0949(0x01AD, 0x0BB2, 0x1180, 0xB000, ds, out si_115, out di_116);
			dl_117 = dl_139 | 0x20;
		}
		byte bl_172 = (byte) bx_156;
		Eq_28 bx_191 = bx_156;
		if (bp_32 == 0x0180)
		{
			bx_191.u0 = (uint16) fn0C00_0362(bl_172 & ~0x01, 0xB000, ds);
			si_115 = &Eq_3::b065C;
			di_116 = (struct Eq_48 Eq_61::*) Eq_61::a0FA0;
			dl_117 = dl_117 ^ 0x30 | 0x08;
		}
		byte bl_214 = (byte) bx_191;
		if (bp_32 == 464)
			si_115 = &Eq_3::b06DE;
		Eq_28 bx_225 = bx_191;
		if (bp_32 == 0x0200)
		{
			bx_225.u0 = (uint16) fn0C00_0362(bl_214 | 0x01, 0xB000, ds);
			si_115 = &Eq_3::b0625;
			di_116 = (struct Eq_48 Eq_61::*) Eq_61::a0FA0;
			dl_117 |= 0x08;
		}
		if (bp_32 == 0x021E)
			si_115 = &Eq_3::b06AC;
		Eq_28 bx_277 = bx_225;
		if (bp_32 == 0x0280)
		{
			word16 Eq_61::* di_250 = Eq_61::a0000;
			word16 cx_254;
			for (cx_254 = 6000; cx_254 != 0x00; --cx_254)
			{
				0xB000->*di_250 = 0x20;
				++di_250;
			}
			word16 si_890;
			word16 di_891;
			fn0C00_0949(0xEB, 0x0AC7, 0x1CC0, 0xB000, ds, out si_890, out di_891);
			bx_277.u0 = (uint16) fn0C00_0949(161, 3665, 4000, 0xB000, ds, out si_115, out di_116);
			dl_117 = 0x40;
		}
		byte bl_287 = (byte) bx_277;
		Eq_28 bx_303 = bx_277;
		if (bp_32 == 0x02C0)
		{
			bx_303.u0 = (uint16) fn0C00_0362(bl_287 & ~0x01, 0xB000, ds);
			si_115 = &Eq_3::b070C;
			di_116 = (struct Eq_48 Eq_61::*) Eq_61::a0FA0;
			dl_117 |= 0x08;
		}
		byte bl_324 = (byte) bx_303;
		Eq_28 bx_333 = bx_303;
		if (bp_32 == 0x0300)
		{
			bx_333.u0 = (uint16) fn0C00_0362(bl_324 | 0x01, 0xB000, ds);
			si_115 = &Eq_3::b0625;
			di_116 = (struct Eq_48 Eq_61::*) Eq_61::a0FA0;
			dl_117 |= 0x08;
		}
		if (bp_32 == 0x031E)
			si_115 = &Eq_3::b0739;
		bx_372 = bx_333;
		if (bp_32 == 0x0340)
		{
			word16 Eq_61::* di_356 = Eq_61::a0FA0;
			word16 cx_357;
			for (cx_357 = 2000; cx_357 != 0x00; --cx_357)
			{
				0xB000->*di_356 = 0x00;
				++di_356;
			}
			bx_372.u0 = (uint16) fn0C00_0949(242, 3423, 0x1180, 0xB000, ds, out si_115, out di_116);
			dl_117 = 0x20;
		}
		if (bp_32 == 0x0360)
			dl_117 = 0x11;
		if (bp_32 == 0x0380)
		{
			di_116 = &Eq_61::t08C0;
			si_115 = &Eq_3::b0758;
			dl_117 |= 0x0A;
		}
		if (bp_32 == 0x0440)
		{
			di_116 = &Eq_61::t0DC0;
			si_115 = &Eq_3::b0905;
			dl_117 |= 0x08;
		}
		if (bp_32 == 0x0480)
			dl_117 = ~0x00;
		if (dl_117 == ~0x00)
			break;
		if ((dl_117 & 0x08) != 0x00)
		{
			word16 cx_421 = 0x01;
			if ((dl_117 & 0x02) != 0x00)
			{
				cx_421 = 0x03;
				if ((bp_32 & 0x03) == 0x00)
					cx_421 = 0x02;
			}
			do
			{
				byte al_437 = ds->*si_115;
				++si_115;
				if (al_437 == 0x00)
					dl_117 = dl_117 ^ 0x08;
				(0xB000->*di_116).w0000 = SEQ(0x0E, al_437);
				++di_116;
				--cx_421;
			} while (cx_421 != 0x00);
			(0xB000->*di_116).bFFFFFFFD = 0x0F;
			(0xB000->*di_116).bFFFFFFFB = 0x07;
			(0xB000->*di_116).bFFFFFFF7 = 0x0E;
			(0xB000->*di_116).bFFFFFFF5 = 0x0C;
			(0xB000->*di_116).bFFFFFFF1 = 0x0E;
		}
		if ((dl_117 & 0x20) != 0x00)
		{
			int16 ax_614 = (int16) ((byte) bp_32 << 0x03);
			cu16 ax_625 = (uint16) ((byte) ax_614 ^ SLICE(ax_614, byte, 8)) * 0x0C & ~0x3F;
			ui16 ax_629 = ax_625 + (ax_625 >> 0x02);
			memcpy(B000:0000, 4000 - ax_629 * 0x02, 4000);
			bx_372 = ax_625 >> 0x02;
		}
		while (bp_32 >= ds->w04AB)
		{
			if ((0000:0417 & 0x07) != 0x00)
				goto l0C00_033A;
			bx_372.u0 = <invalid>;
			byte bl_892;
			dl_117 = fn0C00_038D(dl_117, bp_32, 0xB000, out bl_892, out di_116);
		}
		++bp_32;
	}
l0C00_033A:
	Eq_28 ds_dx_700 = ds->t0501;
	fn0C00_033E(ds_dx_700);
}

// 0C00:033E: Register (memptr (ptr16 Eq_2) byte) fn0C00_033E(Sequence Eq_28 ds_dx)
// Called from:
//      fn0C00_0100
byte seg0C00_t::* fn0C00_033E(Eq_28 ds_dx)
{
	__cli();
	msdos_set_interrupt_vector(0x08, ds_dx);
	word16 ax_10 = 244;
	do
	{
		fn0C00_0505(ax_10);
		--ax_10;
		byte al_28 = (byte) ax_10;
	} while (ax_10 != 0x00);
	byte seg0C00_t::* si_17 = seg0C00_t::a08FD;
	do
	{
		++si_17;
		word16 ax_23 = SEQ(0x0C00->*si_17, al_28);
		do
		{
			fn0C00_0505(ax_23);
			++ax_23;
			al_28 = (byte) ax_23;
		} while ((al_28 & 0x1F) != 0x00);
	} while (al_28 != 0x00);
	__sti();
	return si_17;
}

// 0C00:0362: Register byte fn0C00_0362(Register byte bl, Register (ptr16 Eq_61) es, Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_0100
byte fn0C00_0362(byte bl, struct Eq_61 * es, struct Eq_3 * ds)
{
	word16 Eq_61::* di_11 = Eq_61::a0FA0;
	word16 cx_10;
	for (cx_10 = 0xA0; cx_10 != 0x00; --cx_10)
	{
		es->*di_11 = 0x00;
		++di_11;
	}
	word16 cx_19;
	Eq_137 si_18;
	Eq_138 di_12 = di_11 + 730;
	if ((bl & 0x01) == 0x00)
	{
		&si_18.u0->b0000 = 0x099B;
		cx_19 = 0x5F;
	}
	else
	{
		&si_18.u0->b0000 = 2554;
		cx_19 = 0xCD;
		di_12 = (word16) di_12 + 70;
	}
	word16 di_55;
	word16 si_54;
	return fn0C00_0949(cx_19, si_18, di_12, es, ds, out si_54, out di_55);
}

// 0C00:038D: Register ui8 fn0C00_038D(Register ui8 dl, Register uint16 bp, Register (ptr16 Eq_61) es, Register out Eq_432 blOut, Register out Eq_433 diOut)
// Called from:
//      fn0C00_0100
ui8 fn0C00_038D(ui8 dl, uint16 bp, struct Eq_61 * es, union Eq_432 & blOut, union Eq_433 & diOut)
{
	Eq_433 di;
	byte dh;
	if ((dl & 0x04) != 0x00)
	{
		di.u0 = 0x00;
		word16 cx_10 = 2000;
		cui16 ax_11 = 177;
		if ((bp & 0x01) == 0x00)
			ax_11 = ~0x4E;
		for (; cx_10 != 0x00; --cx_10)
		{
			es->*di.u0 = ax_11;
			++di.u0;
		}
	}
	if ((dl & 0x40) != 0x00)
	{
		word16 Eq_61::* di_373 = Eq_61::a0000;
		Eq_547 si_366 = 4000;
		uint16 bx_66 = (uint16) (uint8) (bp % 0x50);
		for (dh = 0x19; dh != 0x00; --dh)
		{
			uint16 cx_100;
			for (cx_100 = 0x50; cx_100 != 0x00; --cx_100)
			{
				word16 ax_75 = es->*si_366;
				byte ah_80 = SLICE(ax_75, byte, 8);
				si_366 = (word16) si_366 + 2;
				if ((byte) ax_75 == 0x20 && (ah_80 & 0xF0) == 0x00)
				{
					if (cx_100 >= bx_66)
						ax_75 = (word16) (es->*((word16) si_366 + ((word16) (bx_66 * 0x02) + 3998)));
					else
						ax_75 = (word16) (es->*((word16) si_366 + ((word16) (bx_66 * 0x02) + 0x0EFE)));
				}
				es->*di_373 = ax_75;
				++di_373;
			}
		}
	}
	if ((dl & 0x80) != 0x00)
	{
		word16 Eq_61::* si_145 = Eq_61::a0FA0;
		Eq_594 di_146 = 0x00;
		byte bh_159 = 0x00;
		for (dh = 0x19; dh != 0x00; --dh)
		{
			int16 ax_166 = (int16) (((byte) bp * 0x04 + dh + bh_159) * 0x04);
			uint8 al_169 = (byte) ax_166 ^ SLICE(ax_166, byte, 8);
			uint16 ax_174 = (uint16) (al_169 - (al_169 >> 0x01));
			uint16 ax_175 = ax_174 + 0x08;
			if (ax_174 >= 0x48)
				ax_175 = 0x50;
			word16 bx_217 = SEQ(bh_159, ~(bh_159 + dh + (byte) bp) & 0x19);
			ui16 dx_227 = SEQ(dh, dl);
			Eq_594 di_198;
			si_145 = fn0C00_0EF2(0x50 - ax_175, ~(bh_159 + dh + (byte) bp) & 0x19, fn0C00_0EF2(ax_175, bh_159 + dh + (byte) bp & 0x19, si_145, di_146, es, es, out di_198), di_198, es, es, out di_146);
			bh_159 = SLICE(bx_217 + dx_227 * 0x02, byte, 8);
		}
	}
	word16 dx_465 = SEQ(dh, dl);
	if ((dl & 0x10) != 0x00)
	{
		word16 Eq_61::* di_267 = Eq_61::a0000;
		word16 Eq_61::* si_268 = Eq_61::a0FA0;
		cui16 cx_269 = 2000;
		byte ch_384 = 0x07;
		word16 dx_280 = SEQ(dh, dl);
		if ((dl & 0x01) == 0x00)
		{
			do
			{
				word16 ax_326 = es->*si_268;
				++si_268;
				es->*di_267 = SEQ(SLICE(ax_326, byte, 8) | (byte) ((si_268 + bp | cx_269) + bp) * 0x02 & 0x1B, (byte) ax_326);
				++di_267;
				--cx_269;
			} while (cx_269 != 0x00);
		}
		else
		{
			struct Eq_662 Eq_61::* di_282 = &Eq_61::t0001;
			word16 dx_283 = 0x4E;
			do
			{
				ui16 ax_286 = bp * 0x02;
				word16 bx_289 = dx_283;
				word16 cx_315 = SEQ(ch_384, 0x50);
				do
				{
					ui16 ax_295 = ax_286 + bx_289 + bp;
					(es->*di_282).b0000 = SLICE(ax_295, byte, 8) & 0x19 ^ 0x0F;
					--cx_315;
					byte dl_317 = (byte) dx_283;
					byte dh_378 = SLICE(dx_283, byte, 8);
					bx_289 += dx_283;
					ax_286 = ax_295;
					++di_282;
					ch_384 = SLICE(cx_315, byte, 8);
				} while (cx_315 != 0x00);
				dx_283 = SEQ(dh_378, dl_317 - 0x03);
			} while (dl_317 != 0x03);
		}
		dx_465 = dx_280;
	}
	blOut.u1 = <invalid>;
	diOut = di;
	return (byte) dx_465;
}

// 0C00:0505: void fn0C00_0505(Register word16 ax)
// Called from:
//      fn0C00_033E
void fn0C00_0505(word16 ax)
{
	byte al_15 = (byte) ax;
	byte ah_22 = SLICE(ax, byte, 8);
	__out<byte>(0x0388, al_15);
	word16 cx_16 = 0x06;
	do
	{
		__in<byte>(0x0388);
		--cx_16;
		byte ch_44 = SLICE(cx_16, byte, 8);
	} while (cx_16 != 0x00);
	__out<byte>(0x0389, ah_22);
	word16 cx_30 = SEQ(ch_44, 0x23);
	do
	{
		__in<byte>(0x0388);
		--cx_30;
	} while (cx_30 != 0x00);
}

// 0C00:0949: Register byte fn0C00_0949(Register word16 cx, Register Eq_137 si, Register Eq_138 di, Register (ptr16 Eq_61) es, Register (ptr16 Eq_3) ds, Register out Eq_137 siOut, Register out Eq_138 diOut)
// Called from:
//      fn0C00_0100
//      fn0C00_0362
byte fn0C00_0949(word16 cx, Eq_137 si, Eq_138 di, struct Eq_61 * es, struct Eq_3 * ds, union Eq_137 & siOut, union Eq_138 & diOut)
{
	word16 bx;
	Eq_138 dx_108 = di;
	byte ah_118 = 0x00;
	do
	{
		word16 ax_167;
		uint8 al_17 = ds->*si;
		si = (word16) si + 1;
		word16 ax_77 = SEQ(ah_118, al_17);
		if (al_17 >= 0x20)
		{
			es->*di = ax_77;
			di = (word16) di + 2;
			ax_167 = SEQ(ah_118, al_17);
		}
		else if (al_17 < 0x10)
			ax_167 = SEQ(ah_118 & 0xF0 | al_17, al_17);
		else if (al_17 != 0x18)
		{
			if (al_17 >= 0x18)
			{
				bx = cx;
				byte al_33 = ds->*si;
				si = (word16) si + 1;
				word16 ax_113 = SEQ(ah_118, 0x20);
				if (al_17 != 0x19)
				{
					si = (word16) si + 2;
					bx = cx - 0x01;
					ax_113 = SEQ(ah_118, ds->*((word16) si + 1));
				}
				ah_118 = SLICE(ax_113, byte, 8);
				uint16 cx_46;
				for (cx_46 = (uint16) al_33 + 0x01; cx_46 != 0x00; --cx_46)
				{
					es->*di = ax_113;
					di = (word16) di + 2;
				}
				word16 cx_51 = bx - 0x01;
				cx = cx_51 - 0x01;
				if (cx_51 == 0x00 || cx_51 == 0x01)
					break;
				continue;
			}
			ui8 al_64 = (al_17 - 0x10) * 0x02;
			ax_167 = SEQ(ah_118 & ~0x70 | al_64 * 0x08, al_64 * 0x08);
		}
		else
		{
			dx_108 = (word16) dx_108 + 0x00A0;
			di = dx_108;
			ax_167 = SEQ(ah_118, al_17);
		}
		ah_118 = SLICE(ax_167, byte, 8);
		--cx;
	} while (cx != 0x00);
	siOut = si;
	diOut = di;
	return (byte) bx;
}

byte g_a08FD[] = // 0C00:09FD
	{
	};
// 0C00:0EF2: Register (memptr (ptr16 Eq_61) word16) fn0C00_0EF2(Register uint16 cx, Register byte bl, Register (memptr (ptr16 Eq_61) word16) si, Register Eq_594 di, Register (ptr16 Eq_61) es, Register (ptr16 Eq_61) ds, Register out Eq_594 diOut)
// Called from:
//      fn0C00_038D
word16 Eq_61::* fn0C00_0EF2(uint16 cx, byte bl, word16 Eq_61::* si, Eq_594 di, struct Eq_61 * es, struct Eq_61 * ds, union Eq_594 & diOut)
{
	word16 bx;
	byte bl_39 = (byte) bx;
	for (; cx != 0x00; --cx)
	{
		word16 ax_15 = ds->*si;
		es->*di = SEQ(SLICE(ax_15, byte, 8) | bl_39, (byte) ax_15);
		++si;
		di = (word16) di + 2;
	}
	diOut = di;
	return si;
}

