// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register cui16 si, Register (ptr16 Eq_4) ds)
void fn0C00_0100(cui16 si, struct Eq_4 * ds)
{
	__syscall<byte>(0x10);
	__out<word16>(0x03D4, 8211);
	struct Eq_17 Eq_4::* bx_11 = &Eq_4::t0000;
	do
	{
		bx_233 = SEQ(bh_232, bl_21 + 0x01);
		int8 al_15 = (byte) bx_11 >> 0x03 << 0x05;
		(ds->*bx_11).b0400 = SLICE(al_15 *s16 al_15, byte, 8);
		byte bl_21 = (byte) bx_11;
		byte bh_232 = SLICE(bx_11, byte, 8);
		bx_11 = bx_233;
	} while (bl_21 != ~0x00);
	struct Eq_41 Eq_143::* bx_302 = SEQ(bh_232, bl_21 + 0x01);
	do
	{
		int16 ax_37 = fn0C00_01EA((byte) si);
		int16 ax_49 = fn0C00_01EA((byte) si + 0x40);
		struct Eq_41 Eq_143::* bx_299 = bx_302;
		do
		{
			byte bl_58 = (byte) bx_305;
			int16 ax_60 = (int16) bl_58;
			ds->w01A2 = (ax_49 *s ax_60 >> 0x07) + ax_37 << 0x01;
			int16 ax_85 = (int16) (SLICE(bx_305, byte, 8) - 100);
			int16 ax_80 = -(ax_37 *s ax_60 >> 0x07) + ax_49;
			ds->w019E = (ax_37 *s ax_80 >> 0x07) + (ax_49 *s ax_85 >> 0x07) << 0x01;
			Eq_45 dx_294 = ax_49 *s32 ax_80;
			ds->w01A6 = ((word16) dx_294 >> 0x07) + -(ax_37 *s ax_85 >> 0x07) << 0x01;
			cu16 bp_129 = 0x00;
			cu16 di_133;
			word16 cx_296 = SEQ(SLICE(si << 0x09, byte, 8), (byte) si << 0x09);
			for (di_133 = 0x0200; di_133 != 0x00; --di_133)
			{
				byte cl_156 = (byte) cx_296;
				byte dl_153 = (byte) dx_294;
				Eq_45 dx_288 = dx_294;
				word16 cx_291 = cx_296;
				if (ds->*SEQ(0x04, (byte) (bp_129 >> 0x08)) + ds->*SEQ(0x04, SLICE(cx_296, byte, 8)) + ds->*SEQ(0x04, SLICE(dx_294, byte, 8)) > 101)
					break;
				byte dh_166 = SLICE((word16) dx_294 + 0x0000FFFF, byte, 8);
				byte ch_177 = SLICE(cx_296 + ~0x00, byte, 8);
				bp_129 += ~0x00;
				dx_288 = SEQ(dh_166, dl_153 + ~0x00);
				cx_291 = SEQ(ch_177, cl_156 + ~0x00);
				dx_294 = SEQ(dh_166, dl_153 + ~0x00);
				cx_296 = SEQ(ch_177, cl_156 + ~0x00);
			}
			byte dh_165 = SLICE(dx_288, byte, 8);
			byte ch_176 = SLICE(cx_291, byte, 8);
			Eq_50 ax_181 = (ch_176 << 0x03) *s16 (ch_176 << 0x03) + (dh_165 << 0x03) *s16 (dh_165 << 0x03);
			ci16 ax_190 = SEQ(SLICE(ax_181 >> 0x07, byte, 8), ~(byte) (ax_181 >> 0x07)) - 0xFF + (di_133 >> 0x01);
			bcu8 al_197 = (byte) ax_190;
			if (ax_190 < 0x00)
				al_197 = 0x00;
			uint8 al_200 = al_197 >> 0x04;
			(0xA000->*bx_305).wFFFFFFA0 = SEQ(al_200 + 0x10, al_200 + 0x10);
			byte bh_247 = SLICE(&bx_305->wFFFFFFA0 + 49, byte, 8);
			bx_299 = SEQ(bh_247, bl_58 + 0x02);
			bx_305 = bx_299;
		} while (bx_305 != &Eq_143::tFFFE);
		++si;
		bx_302 = SEQ(bh_247, bl_58 + 0x02);
	} while (__in<byte>(0x60) != 0x01);
}

// 0C00:01EA: Register int16 fn0C00_01EA(Register byte sil)
// Called from:
//      fn0C00_0100
int16 fn0C00_01EA(byte sil)
{
	word16 si;
	int8 al_12 = (byte) si << 0x01;
	int16 ax_13 = al_12 *s16 al_12;
	return (SEQ(SLICE(ax_13, byte, 8) - 0x40, (byte) ax_13) ^ SLICE((int32) ((int16) ((byte) si + 0x40)), word16, 16)) >> 0x07;
}

