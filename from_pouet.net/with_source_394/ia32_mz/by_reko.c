// subject_0800.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

struct seg0800_t * g_ptr8000 = &g_t0F0F; // 00008000
Eq_390 g_t005E = // 0800:005E
	{
		0x2F,
	};
Eq_399 g_t00FE = // 0800:00FE
	{
		0x41,
	};
Eq_29 g_t08C0 = // 0800:08C0;
word16 g_wDB60 = 0x00; // 0800:DB60
word16 g_wDB6A = 0x00; // 0800:DB6A
// subject_1676.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 1676:0061: void fn1676_0061()
// Called from:
//      fn1676_0340
void fn1676_0061()
{
	bios_video_set_mode(0x13);
}

// 1676:0068: void fn1676_0068()
// Called from:
//      fn1676_0442
void fn1676_0068()
{
	bios_video_set_mode(0x03);
}

// 1676:006F: void fn1676_006F()
// Called from:
//      fn1676_0340
void fn1676_006F()
{
	bios_video_set_block_of_DAC_registers(0x00, 0xFF, seg0800, 0xD5C0);
}

// 1676:0084: Register (ptr16 Eq_3) fn1676_0084()
// Called from:
//      fn1676_0340
struct seg0800_t * fn1676_0084()
{
	memcpy(A000:3200, &seg0800->t08C0, 0x9100);
	return seg0800;
}

// 1676:009B: Register (ptr16 Eq_3) fn1676_009B()
// Called from:
//      fn1676_0442
struct seg0800_t * fn1676_009B()
{
	word16 bx_14 = seg0800->wFFFFDB62 + 0x08C0 + (seg0800->wFFFFDB64 - 0x28) * 0x0140;
	byte Eq_68::* bx_23 = seg0800->wFFFFDB62 + seg0800->wFFFFDB64 * 0x0140;
	seg0800->wFFFFDB6C = bx_14;
	seg0800->ptrFFFFDB6E = bx_23;
	seg0800->wFFFFDB5E = 0x00;
	word16 si_15 = bx_14;
	byte Eq_68::* di_25 = bx_23;
	do
	{
		memcpy(&(0xA000->*di_25), si_15, 0x39);
		++seg0800->wFFFFDB5E;
		uint16 ax_39 = seg0800->wFFFFDB5E;
		si_15 = (<unknown>*) (seg0800->wFFFFDB6C + ax_39 * 0x0140);
		di_25 = seg0800->ptrFFFFDB6E + ax_39 * 0x0140;
	} while (seg0800->wFFFFDB5E != 0x06);
	seg0800->wFFFFDB5E = 0x00;
	return seg0800;
}

// 1676:0104: void fn1676_0104()
// Called from:
//      fn1676_0442
void fn1676_0104()
{
	byte Eq_68::* bx_15 = seg0800->wFFFFDB62 + seg0800->wFFFFDB64 * 0x0140;
	seg0800->wFFFFDB6C = 0x00;
	seg0800->ptrFFFFDB6E = bx_15;
	seg0800->wFFFFDB5E = 0x00;
	byte seg0800_t::* si_23 = &seg0800_t::b0000;
	byte Eq_68::* di_17 = bx_15;
	do
	{
		word16 cx_21;
		for (cx_21 = 0x39; cx_21 != 0x00; --cx_21)
		{
			byte al_25 = 0x0800->*si_23;
			if (al_25 != 0x00)
				0xA000->*di_17 = al_25;
			++si_23;
			++di_17;
		}
		++seg0800->wFFFFDB5E;
		uint16 ax_43 = seg0800->wFFFFDB5E;
		si_23 = seg0800->wFFFFDB6C + ax_43 * 0x0140;
		di_17 = seg0800->ptrFFFFDB6E + ax_43 * 0x0140;
	} while (seg0800->wFFFFDB5E != 0x06);
	seg0800->wFFFFDB5E = 0x00;
}

// 1676:0165: Register (ptr16 Eq_144) fn1676_0165()
// Called from:
//      fn1676_0442
struct Eq_144 * fn1676_0165()
{
	word16 di_18 = 0xD840;
	word16 si_20 = 55362;
	byte ah_14;
	for (ah_14 = 0x08; ah_14 != 0x00; --ah_14)
	{
		memcpy(di_18, si_20, 0x013E);
		di_18 = (<unknown>*) ((char *) di_18 + 320);
		si_20 = (<unknown>*) ((char *) si_20 + 320);
	}
	return fn1676_0186();
}

// 1676:0186: Register (ptr16 Eq_171) fn1676_0186()
// Called from:
//      fn1676_0165
//      fn1676_0198
struct Eq_171 * fn1676_0186()
{
	struct Eq_171 * ds;
	word16 ax_9 = (0x0800->*seg0800->ptrFFFFDB6A).wE055;
	byte al_10 = (byte) ax_9;
	if (al_10 != 0x00)
	{
		uint16 bx_52;
		if (al_10 == 0x20)
			bx_52 = 0x0A00;
		else if (al_10 == 0x30)
			bx_52 = 0xD0;
		else if (al_10 == 0x31)
			bx_52 = 0xD8;
		else if (al_10 == 0x32)
			bx_52 = 0xE0;
		else if (al_10 == 0x33)
			bx_52 = 232;
		else if (al_10 == 0x34)
			bx_52 = 0xF0;
		else if (al_10 == 0x35)
			bx_52 = 0xF8;
		else if (al_10 == 0x36)
			bx_52 = 0x0100;
		else if (al_10 == 55)
			bx_52 = 0x0108;
		else if (al_10 == 0x38)
			bx_52 = 0x0110;
		else if (al_10 == 0x39)
			bx_52 = 0x0118;
		else if (al_10 == 0x3F)
			bx_52 = 288;
		else if (al_10 == 33)
			bx_52 = 0x0128;
		else if (al_10 == 0x2E)
			bx_52 = 0x0130;
		else if (al_10 == 44)
			bx_52 = 0x0138;
		else
			bx_52 = (uint16) ((byte) ax_9 - 0x41) * 0x08;
		struct Eq_187 seg0800_t::* si_74 = seg0800->wFFFFDB60 + 0x99C0 + bx_52;
		struct Eq_193 Eq_68::* di_106 = &Eq_68::tD97E;
		byte al_108 = 0x00;
		si_116 = si_74;
		while (true)
		{
			struct Eq_187 seg0800_t::* si_116;
			byte ah_82;
			for (ah_82 = 0x08; ah_82 != 0x00; --ah_82)
			{
				(0xA000->*di_106).b0000 = (0x0800->*si_116).b0000;
				++si_116;
				++di_106;
			}
			di_106 = &Eq_68::tD97F;
			if (al_108 == 0x01)
				break;
			fn1676_0287(seg0800);
			si_116 = &si_74->b0000 + 1;
			++al_108;
		}
		fn1676_0287(seg0800);
		return;
	}
	else
	{
		fn1676_0198(ds);
		return;
	}
}

// 1676:0198: void fn1676_0198(Register (ptr16 Eq_171) ds)
// Called from:
//      fn1676_0186
//      fn1676_0340
void fn1676_0198(struct Eq_171 * ds)
{
	ds->wDB60 = 0x00;
	ds->wDB6A = 0x00;
	fn1676_0186();
}

// 1676:0287: void fn1676_0287(Register (ptr16 Eq_3) ds)
// Called from:
//      fn1676_0198
void fn1676_0287(struct seg0800_t * ds)
{
	if (ds->wDB60 == 0x07)
	{
		ds->wDB60 = 0x00;
		++ds->wDB6A;
	}
	else
		++ds->wDB60;
}

// 1676:029E: void fn1676_029E(Register (ptr16 Eq_314) ds)
// Called from:
//      fn1676_0442
void fn1676_029E(struct Eq_314 * ds)
{
	while (true)
	{
		while (ds->bDB5D != 0x01)
		{
			__out<byte>(0x03C8, ~0x01);
			byte al_21 = ds->bDB5C;
			__out<byte>(969, al_21);
			__out<byte>(969, al_21);
			__out<byte>(969, al_21);
			if (ds->bDB5C != 0x3F)
			{
				++ds->bDB5C;
				return;
			}
			ds->bDB5D = 0x01;
		}
		__out<byte>(0x03C8, ~0x01);
		byte al_11 = ds->bDB5C;
		__out<byte>(969, al_11);
		__out<byte>(969, al_11);
		__out<byte>(969, al_11);
		if (ds->bDB5C != 0x0F)
			break;
		ds->bDB5D = 0x00;
	}
	--ds->bDB5C;
}

// 1676:02E7: void fn1676_02E7()
// Called from:
//      fn1676_0442
void fn1676_02E7()
{
	seg0800->wFFFFDB64 = (0x0800->*seg0800->ptrFFFFDB68).wD8C0 + 100;
	seg0800->wFFFFDB62 = (0x0800->*seg0800->ptrFFFFDB66).wD920 + 0x44;
	if (seg0800->ptrFFFFDB68 == &seg0800_t::t005E)
		seg0800->ptrFFFFDB68 = &seg0800_t::b0000;
	else
	{
		seg0800->ptrFFFFDB68 = (struct Eq_390 seg0800_t::*) ((char *) seg0800->ptrFFFFDB68 + 1);
		seg0800->ptrFFFFDB68 = (struct Eq_390 seg0800_t::*) ((char *) seg0800->ptrFFFFDB68 + 1);
	}
	if (seg0800->ptrFFFFDB66 != &seg0800_t::t00FE)
	{
		seg0800->ptrFFFFDB66 = (struct Eq_399 seg0800_t::*) ((char *) seg0800->ptrFFFFDB66 + 1);
		seg0800->ptrFFFFDB66 = (struct Eq_399 seg0800_t::*) ((char *) seg0800->ptrFFFFDB66 + 1);
		seg0800->wFFFFDB72 = 0x00;
	}
	else
		seg0800->ptrFFFFDB66 = &seg0800_t::b0000;
}

// 1676:0340: void fn1676_0340()
// Called from:
//      fn1676_0442
void fn1676_0340()
{
	fn1676_0061();
	fn1676_006F();
	struct Eq_171 * ds_14 = fn1676_0084();
	fn1676_0198(ds_14);
	ds_14->wDB66 = 0x00;
	ds_14->wDB68 = 0x00;
	__out<byte>(0x03C8, ~0x01);
	__out<byte>(969, 0x00);
	__out<byte>(969, 0x00);
	__out<byte>(969, 0x00);
}

// 1676:0365: void fn1676_0365()
// Called from:
//      fn1676_0442
void fn1676_0365()
{
	do
		;
	while ((__in<byte>(0x03DA) & 0x08) == 0x00);
}

// 1676:036E: void fn1676_036E(Register (ptr16 Eq_481) ds)
// Called from:
//      fn1676_037C
void fn1676_036E(struct Eq_481 * ds)
{
	__out<byte>(0x03C8, ~0x02);
	byte al_10 = ds->bDB7C;
	__out<byte>(969, al_10);
	__out<byte>(969, al_10);
	__out<byte>(969, al_10);
}

// 1676:037C: Register (ptr16 Eq_481) fn1676_037C(Register (ptr16 Eq_481) ds)
// Called from:
//      fn1676_0442
struct Eq_481 * fn1676_037C(struct Eq_481 * ds)
{
	if (ds->bDB77 == 0x01)
	{
		if (ds->bDB7C == 0x00)
			return fn1676_03BF();
		fn1676_036E(ds);
		--ds->bDB7C;
		return ds;
	}
	else if (ds->bDB7C == 0x3F)
	{
		if (ds->bDB76 == ~0x00)
		{
			ds->bDB77 = 0x01;
			ds->bDB76 = 0x00;
			return ds;
		}
		else
		{
			++ds->bDB76;
			return ds;
		}
	}
	else
	{
		++ds->bDB7C;
		fn1676_036E(ds);
		return ds;
	}
}

// 1676:03BF: Register (ptr16 Eq_557) fn1676_03BF()
// Called from:
//      fn1676_037C
struct Eq_557 * fn1676_03BF()
{
	uint16 bx_22;
	word16 ax_9 = 0x0800->*((word16) seg0800->tFFFFDB78 + 0x0000DB7D);
	if ((byte) ax_9 == 0x20)
		bx_22 = 0x1400;
	else
		bx_22 = (uint16) (((byte) ax_9 - 0x01) * 0x08);
	uint16 si_28 = bx_22 + 44480;
	uint16 di_39 = (uint16) seg0800->bFFFFDB7B * 0x08 + 0x0F00;
	word16 dx_41;
	for (dx_41 = 0x10; dx_41 != 0x00; --dx_41)
	{
		memcpy(di_39, si_28, 0x08);
		si_28 = (<unknown>*) ((char *) si_28 + 320);
		di_39 = (<unknown>*) ((char *) di_39 + 320);
	}
	if (seg0800->bFFFFDB7B == 0x27)
	{
		seg0800->bFFFFDB7B = 0x00;
		seg0800->bFFFFDB77 = 0x00;
		if (seg0800->tFFFFDB78 > 0x04B0)
		{
			seg0800->tFFFFDB78.u0 = 0x00;
			return;
		}
		else
		{
			seg0800->tFFFFDB78 = (word16) seg0800->tFFFFDB78 + 1;
			return;
		}
	}
	else
	{
		++seg0800->bFFFFDB7B;
		seg0800->tFFFFDB78 = (word16) seg0800->tFFFFDB78 + 1;
		return;
	}
}

// 1676:0442: void fn1676_0442(Register (ptr16 Eq_631) es)
void fn1676_0442(struct Eq_631 * es)
{
	word16 bx_7;
	msdos_resize_memory_block(es, 0x186A, out bx_7);
	fn1676_0068();
	word16 cx_13;
	for (cx_13 = 100; cx_13 != 0x00; --cx_13)
		fn1676_0365();
	fn1676_0068();
	fn1676_0340();
	__out<byte>(33, 0x5E);
	do
	{
		fn1676_02E7();
		fn1676_0104();
		fn1676_0365();
		fn1676_029E(fn1676_037C(fn1676_0165()));
		struct Eq_679 * ds_112 = fn1676_009B();
	} while (__in<byte>(0x60) != 0x01);
	__out<byte>(33, 0x00);
	fn1676_0068();
	msdos_display_string((char *) ds_112 - 6476);
	msdos_terminate(0x00);
}

