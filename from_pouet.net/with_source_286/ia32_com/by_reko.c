// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register byte ah, Register byte ch, Register byte bh, Register (ptr16 Eq_6) es, Register (ptr16 Eq_7) ds)
void fn0C00_0100(byte ah, byte ch, byte bh, struct Eq_6 * es, struct Eq_7 * ds)
{
	__syscall<byte>(0x10);
	__out<byte>(0x03C8, 0x00);
	word16 cx_380 = SEQ(ch, 0x40);
	do
	{
		bcu8 cl_10 = (byte) cx_390;
		__out<byte>(969, 0x40 - cl_10 >> 0x01);
		__out<byte>(969, 0x00);
		__out<byte>(969, 0x00);
		byte ch_299 = SLICE(cx_390 - 0x01, byte, 8);
		cx_380 = SEQ(ch_299, cl_10 - 0x01);
		cx_390 = cx_380;
	} while (cx_390 != 0x01);
	word16 cx_383 = SEQ(ch_299, 0x40);
	do
	{
		byte cl_23 = (byte) cx_391;
		bcu8 al_24 = 0x40 - cl_23;
		__out<byte>(969, (al_24 >> 0x01) + 0x1F);
		__out<byte>(969, al_24 >> 0x01);
		__out<byte>(969, 0x00);
		byte ch_307 = SLICE(cx_391 - 0x01, byte, 8);
		cx_383 = SEQ(ch_307, cl_23 - 0x01);
		cx_391 = cx_383;
	} while (cx_391 != 0x01);
	word16 cx_386 = SEQ(ch_307, 0x40);
	do
	{
		__out<byte>(969, 0x3F);
		bcu8 cl_47 = (byte) cx_389;
		__out<byte>(969, (0x3F - cl_47 >> 0x01) + 0x1F);
		__out<byte>(969, 0x00);
		word16 ax_351 = SEQ(ah, 0x00);
		cx_386 = SEQ(SLICE(cx_389 - 0x01, byte, 8), cl_47 - 0x01);
		cx_389 = cx_386;
	} while (cx_389 != 0x01);
	word16 Eq_6::* di_293 = Eq_6::a0200;
	word16 cx_296;
	for (cx_296 = 16160; cx_296 != 0x00; --cx_296)
	{
		es->*di_293 = ax_351;
		++di_293;
	}
	byte ch_62;
	byte dh_63;
	byte dl_64;
	msdos_get_system_time(out ch_62, out dh_63, out dl_64);
	ds->w8040 = SEQ(dh_63, dl_64);
	while (true)
	{
		byte Eq_7::* si_119 = Eq_7::a0200;
		word16 cx_103;
		word16 Eq_164::* di_79 = Eq_164::a0000;
		word16 bx_101 = SEQ(bh, 0xA0);
		for (cx_103 = 0x7D00; cx_103 != 0x00; --cx_103)
		{
			byte al_87 = ds->*si_119;
			0xA000->*di_79 = SEQ(al_87, al_87);
			++si_119;
			++di_79;
			--bx_101;
			if (bx_101 == 0x00)
			{
				si_119 -= 0xA0;
				bx_101 = 0x0140;
			}
			bh = SLICE(bx_101, byte, 8);
		}
		byte Eq_7::* di_114 = Eq_7::a0200;
		struct Eq_180 Eq_7::* si_121 = si_119 + 0x00A0;
		word16 cx_122;
		byte ah_135 = 0x00;
		for (cx_122 = 16000; cx_122 != 0x00; --cx_122)
		{
			++si_121;
			cu16 ax_145 = SEQ(ah_135, (ds->*si_121).b0000) + SEQ(bh, (ds->*si_121).b0000) + SEQ(bh, (ds->*si_121).bFFFFFFFE) + SEQ(bh, si_121[0x009F]);
			byte al_157 = (byte) (ax_145 >> 0x02);
			ah_135 = SLICE(ax_145 >> 0x02, byte, 8);
			if (ax_145 >> 0x02 != 0x00)
			{
				al_157 = (byte) (ax_145 >> 0x02) - 0x01;
				ah_135 = SLICE((ax_145 >> 0x02) - 0x01, byte, 8);
				if (ax_145 >> 0x02 != 0x01)
				{
					al_157 = (byte) (ax_145 >> 0x02) - 0x02;
					ah_135 = SLICE((ax_145 >> 0x02) - 0x02, byte, 8);
				}
			}
			ds->*di_114 = al_157;
			++di_114;
		}
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) == 0x00);
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) != 0x00);
		memcpy(&(ds->*si_119), ds->a0200[0], 16000);
		byte Eq_7::* di_206 = si_119 + 16000;
		memcpy(&(ds->*di_206), ds->a0200[0x00007DA0], 0xA0);
		union Eq_289 Eq_7::* di_215 = di_206 + 0x00A0;
		cui16 cx_216 = 0x50;
		byte al_219;
		byte ah_220;
		if (!bios_kbd_check_keystroke(out al_219, out ah_220))
		{
			do
			{
				word16 ax_245 = ds->w8040;
				byte al_249 = (byte) ax_245;
				word16 ax_263 = SEQ(__rcr<byte,byte>(al_249, 0x01, (SLICE(ax_245, byte, 8) & 0x02) != 0x00), __rcr<byte,byte>(0x00, 0x01, (al_249 & 0x02) != 0x00)) + ax_245;
				uint8 ah_264 = SLICE(ax_263, byte, 8);
				word16 ax_270 = SEQ(ah_264 + 99, SLICE(SEQ((byte) ax_263, ah_264) + 0x3663, byte, 8));
				ds->w8040 = ax_270;
				uint32 dx_ax_274 = (uint32) ax_270;
				uint16 bx_277 = SEQ(bh, 0xA0);
				uint16 ax_279 = (uint16) (dx_ax_274 /u bx_277);
				Eq_354 dx_278 = (uint16) (dx_ax_274 % bx_277);
				byte ah_282 = SLICE(ax_279, byte, 8);
				ds->*((word16) dx_278 + 32672) = (byte) (SEQ(ah_282, (byte) ax_279 | ah_282) >> 0x01);
				bh = SLICE(dx_278, byte, 8);
				--cx_216;
			} while (cx_216 != 0x00);
		}
		else
		{
			while (true)
			{
				byte ch_233 = SLICE(cx_216, byte, 8);
				if (cx_216 == 0x00)
					break;
				(ds->*di_215).u0.t0000.u1 = 0x00;
				di_215 = (union Eq_289 Eq_7::*) ((char *) di_215 + 2);
				--cx_216;
			}
			byte cl_229 = ds->b01FF;
			--ds->b01FF;
			if (SEQ(ch_233, cl_229) == 0x01)
			{
				bios_video_set_mode(0x03);
				msdos_terminate_program20();
			}
		}
	}
}

