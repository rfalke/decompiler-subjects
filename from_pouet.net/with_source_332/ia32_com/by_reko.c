// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_3) ds)
void fn0C00_0100(struct Eq_3 * ds)
{
	bios_video_set_mode(0x13);
	struct Eq_9 * es_12;
	byte al_18 = fn0C00_014E(ds, out es_12);
	do
	{
		fn0C00_01A7(al_18, ds);
		fn0C00_01C2(es_12, ds);
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) != 0x00);
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) == 0x00);
		fn0C00_02A7(es_12, ds);
		byte ah_60;
	} while (bios_kbd_check_keystroke(out al_18, out ah_60));
	msdos_terminate_program20();
}

// 0C00:0140: Register uint16 fn0C00_0140(Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_0167
//      fn0C00_01C2
uint16 fn0C00_0140(struct Eq_3 * ds)
{
	uint16 ax_8 = ds->w013E * 0x41A7;
	ds->w013E = ax_8 + 0xE80B;
	return ax_8 + 0xE80B;
}

// 0C00:014E: Register byte fn0C00_014E(Register (ptr16 Eq_3) ds, Register out (ptr16 Eq_9) esOut)
// Called from:
//      fn0C00_0100
byte fn0C00_014E(struct Eq_3 * ds, struct Eq_9 & esOut)
{
	byte Eq_9::* di_26 = &Eq_9::b0000;
	word16 cx_10;
	for (cx_10 = 0x0140; cx_10 != 0x00; --cx_10)
	{
		0xA000->*di_26 = 0x00;
		++di_26;
	}
	word16 cx_13;
	for (cx_13 = 63800; cx_13 != 0x00; --cx_13)
	{
		0xA000->*di_26 = 0x12;
		++di_26;
	}
	uint16 ax_18 = (uint16) fn0C00_0167(0xA000, ds);
	esOut = 0xA000;
	return (byte) ax_18;
}

// 0C00:0167: Register byte fn0C00_0167(Register (ptr16 Eq_9) es, Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_014E
//      fn0C00_01C2
byte fn0C00_0167(struct Eq_9 * es, struct Eq_3 * ds)
{
	ds->t012E = (fn0C00_0140(ds) & 0x7F) + 0x24;
	ds->t012C.u0 = 0xA0;
	ds->w0138 = 0x1E;
	Eq_130 bx_17 = ds->t013A;
	if (bx_17 >= 0xA0)
	{
		ds->t013A.u0 = 0xA0;
		bx_17.u0 = 0x00;
	}
	es->*bx_17 = 0x0F;
	Eq_141 bx_27 = ds->t013C;
	if (bx_27 <= 0xA0)
	{
		ds->t013C.u0 = 0xA0;
		bx_27.u0 = 0x013F;
	}
	es->*bx_27 = 0x0F;
	return 0xA0;
}

// 0C00:01A7: void fn0C00_01A7(Register byte al, Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_0100
void fn0C00_01A7(byte al, struct Eq_3 * ds)
{
	ds->w012A = 0x00;
	__syscall<byte>(22);
	if ((al & 0x04) != 0x00)
		++ds->w012A;
	if ((al & 0x08) != 0x00)
		--ds->w012A;
}

// 0C00:01C2: void fn0C00_01C2(Register (ptr16 Eq_9) es, Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_0100
void fn0C00_01C2(struct Eq_9 * es, struct Eq_3 * ds)
{
	Eq_118 bx_13 = ds->t0128;
	if (ds->t012C >= 0xE6)
	{
		Eq_118 ax_10 = ds->t012E;
		bx_13 = ds->t0128;
		if (ax_10 >= (word16) bx_13 + 5)
		{
			if (ax_10 > (word16) bx_13 + 5)
			{
				bx_13 = (word16) bx_13 + 1;
				if (bx_13 >= 188)
					bx_13.u0 = 0xBD;
			}
		}
		else
		{
			--bx_13;
			if (bx_13 <= 0x03)
				bx_13.u0 = 0x02;
		}
	}
	ds->t0128 = bx_13;
	word16 bx_27 = ds->w012A;
	if (bx_27 == 0x00)
		fn0C00_0140(ds);
	Eq_118 bx_39 = (word16) ds->t0126 + bx_27;
	if (bx_39 < 0x02)
		bx_39.u0 = 0x02;
	if (bx_39 > 0xBD)
		bx_39.u0 = 0xBD;
	ds->t0126 = bx_39;
	if (ds->w0138 == 0x00)
	{
		Eq_118 ax_54 = (word16) ds->t012E + ds->w0132;
		ds->t012E = ax_54;
		if (ax_54 == 0x02)
			ds->w0132 = 0x01;
		if (ax_54 == 0xC6)
			ds->w0132 = ~0x00;
		Eq_122 cx_68 = (word16) ds->t012C + ds->w0130;
		ds->t012C = cx_68;
		if (cx_68 == 0x02 && (ax_54 >= bx_39 && ax_54 < (word16) bx_39.u0 + 0x0A))
			ds->w0130 = 0x01;
		Eq_118 bx_83 = ds->t0128;
		if (cx_68 == 0x013D && (ax_54 >= bx_83 && ax_54 < (word16) bx_83 + 0x0A))
			ds->w0130 = ~0x00;
		if (cx_68 != 0x00)
		{
			if (cx_68 == 0x013F)
			{
				ds->t013A = (word16) ds->t013A + 2;
				fn0C00_0167(es, ds);
			}
		}
		else
		{
			ds->t013C = (word16) ds->t013C + 0x0000FFFE;
			fn0C00_0167(es, ds);
		}
	}
	else
		--ds->w0138;
}

// 0C00:02A7: void fn0C00_02A7(Register (ptr16 Eq_9) es, Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_0100
void fn0C00_02A7(struct Eq_9 * es, struct Eq_3 * ds)
{
	ds->t0134[ds->t0136].b0000 = 0x12;
	Eq_118 ax_14 = ds->t012E;
	ds->t0136 = ax_14;
	ds->t012C[ax_14].b0000 = 0x0E;
	ds->t0134 = ds->t012C;
	uint16 ax_28 = (ds->t0126 - 0x01) * 0x0140;
	es->a0001[0].b0000[ds->t0126 - 0x01].b0000 = 0x12;
	Eq_390 bx_31 = Eq_9::a0001 + ax_28 /16 320;
	word16 cx_33;
	for (cx_33 = 0x0A; cx_33 != 0x00; --cx_33)
	{
		bx_31 = (word16) bx_31 + 320;
		es->*bx_31 = 0x0A;
	}
	es->*((word16) bx_31 + 320) = 0x12;
	uint16 ax_48 = (ds->t0128 - 0x01) * 0x0140;
	es->a0001[0].b013D[ds->t0128 - 0x01] = (Eq_452) 0x12;
	Eq_426 bx_51 = &Eq_9::t013E + ax_48 /16 320;
	word16 cx_53;
	for (cx_53 = 0x0A; cx_53 != 0x00; --cx_53)
	{
		bx_51 = (word16) bx_51 + 320;
		es->*bx_51 = 0x0C;
	}
	es->*((word16) bx_51 + 320) = 0x12;
}

