// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register word16 cx, Register Eq_4 si, Register (ptr16 Eq_5) ds)
void fn0C00_0100(word16 cx, Eq_4 si, struct Eq_5 * ds)
{
	struct Eq_6 * Top_180 = 0;
	__syscall<byte>(0x10);
	struct Eq_13 * ax_11 = SEQ(SLICE(ds, byte, 8) + 0x01, (byte) ds);
	word16 cx_226 = cx;
	do
	{
		uint8 cl_14 = (byte) cx_232;
		__out<byte>(0x03C8, cl_14);
		__out<byte>(969, cl_14);
		__out<byte>(969, cl_14 >> 0x02);
		__out<byte>(969, cl_14 >> 0x02);
		byte ch_190 = SLICE(cx_232 - 0x01, byte, 8);
		uint8 al_101 = cl_14 >> 0x02;
		cx_226 = SEQ(ch_190, cl_14 - 0x01);
		cx_232 = cx_226;
	} while (cx_232 != 0x01);
	do
	{
		byte Eq_13::* di_114 = &Eq_13::b0000;
		int16 bx_126;
		for (bx_126 = ~0x63; bx_126 < 100; ++bx_126)
		{
			int16 dx_120;
			for (dx_120 = ~0x9F; dx_120 < 0xA0; ++dx_120)
			{
				__fninit();
				struct Eq_82 * Top_29 = Top_180 - (struct Eq_167 *) 1;
				Top_29->t0000.u0 = 0.0;
				ds->*((word16) si + 4) = dx_120;
				Top_29->tFFFFFFFF.u0 = (real64) (ds->*((word16) si + 4));
				Top_29->tFFFFFFFE.u0 = (real64) ds->r010D;
				Top_29->tFFFFFFFE.u0 = (real64) sqrt(Top_29->tFFFFFFFE.u0);
				Top_29->tFFFFFFFE.u0 = (real64) sin(Top_29->tFFFFFFFE.u0);
				Top_29->tFFFFFFFE.u0 = (real64) (Top_29->tFFFFFFFE.u0 * (real64) ds->w017E);
				Top_29->tFFFFFFFF.u0 = (real64) (Top_29->tFFFFFFFF.u0 + (Top_29->tFFFFFFFE).u0);
				Top_29->tFFFFFFFE.u0 = Top_29->tFFFFFFFF.u0;
				Top_29->tFFFFFFFE.u0 = (real64) (Top_29->tFFFFFFFE.u0 * (Top_29->tFFFFFFFE).u0);
				ds->*((word16) si + 2) = bx_126;
				Top_29->tFFFFFFFD.u0 = (real64) (ds->*((word16) si + 2));
				Top_29->tFFFFFFFD.u0 = (real64) (Top_29->tFFFFFFFD.u0 * (Top_29->tFFFFFFFD).u0);
				Top_29->tFFFFFFFE.u0 = (real64) (Top_29->tFFFFFFFE.u0 + (Top_29->tFFFFFFFD).u0);
				Top_29->tFFFFFFFE.u0 = (real64) (Top_29->tFFFFFFFE.u0 + (Top_29->tFFFFFFFE).u0);
				Eq_76 v22_56 = Top_29->tFFFFFFFE.u0;
				Top_29->tFFFFFFFE.u0 = Top_29->tFFFFFFFF.u0;
				Top_29->tFFFFFFFF.u0 = (real64) v22_56;
				Top_29->tFFFFFFFE.u0 = (real64) (Top_29->tFFFFFFFE.u0 + (Top_29->tFFFFFFFE).u0);
				Top_29->tFFFFFFFE.u0 = (real64) -Top_29->tFFFFFFFE.u0;
				Top_29->tFFFFFFFD.u0 = Top_29->tFFFFFFFF.u0;
				Top_29->tFFFFFFFD.u0 = (real64) (Top_29->tFFFFFFFD.u0 + (Top_29->tFFFFFFFD).u0);
				Top_29->tFFFFFFFC.u0 = Top_29->tFFFFFFFE.u0;
				Top_29->tFFFFFFFC.u0 = (real64) (Top_29->tFFFFFFFC.u0 * (Top_29->tFFFFFFFC).u0);
				Top_29->tFFFFFFFD.u0 = (real64) (Top_29->tFFFFFFFC.u0 - (Top_29->tFFFFFFFD).u0);
				Eq_56 cx_100 = SEQ(ch_190, 0x04);
				do
				{
					byte cl_161;
					Eq_56 cx_92;
					Top_29->tFFFFFFFC.u0 = 1.4426950408889634;
					Top_29->tFFFFFFFC.u0 = (real64) (Top_29->tFFFFFFFC.u0 * (Top_29->tFFFFFFFF).u0);
					Top_29->tFFFFFFFD.u0 = (real64) (Top_29->tFFFFFFFD.u0 + (Top_29->tFFFFFFFC).u0);
					Top_180 = Top_29 - (struct Eq_155 *) 3;
					if (Top_29->tFFFFFFFD.u0 >= (Top_29->t0000).u0)
					{
						word16 ax_86 = <invalid>;
						al_101 = (byte) ax_86;
						cl_161 = (byte) cx_85;
						ch_190 = SLICE(cx_85, byte, 8);
						Eq_56 cx_85;
						byte al_230;
						if (fn0C00_01AF(cx_100, si, ds, Top_29->tFFFFFFFD.u0, Top_29->tFFFFFFFE.u0, Top_29->tFFFFFFFF.u0, Top_29->t0000.u0, out al_230, out cx_85))
							break;
						word16 ax_93 = <invalid>;
						al_101 = (byte) ax_93;
						cl_161 = (byte) cx_92;
						ch_190 = SLICE(cx_92, byte, 8);
						cx_100 = cx_92;
						byte al_231;
						if (fn0C00_01AF(cx_85, si, ds, Top_29->tFFFFFFFD.u0, Top_29->tFFFFFFFE.u0, Top_29->tFFFFFFFF.u0, Top_29->t0000.u0, out al_231, out cx_92))
							break;
					}
					--cx_100;
					cl_161 = (byte) cx_100;
					ch_190 = SLICE(cx_100, byte, 8);
				} while (cx_100 != 0x00);
				ax_11->*di_114 = al_101;
				++di_114;
			}
		}
		uint16 cx_165 = SEQ(0x7D, cl_161);
		memcpy(A000:0000, ax_11->b0000, cx_165 *32 0x02);
		Top_29->tFFFFFFFC.u0 = 0.3010299956639812;
		Top_29->tFFFFFFFC.u0 = (real64) (Top_29->tFFFFFFFC.u0 + (real64) ds->r010D);
		ds->r010D = (real32) Top_29->tFFFFFFFC.u0;
		ch_190 = 0x00;
		si = cx_165 * 0x02;
		Top_180 = Top_29 - (struct Eq_408 *) 3;
		byte ah_183;
	} while (bios_kbd_check_keystroke(out al_101, out ah_183));
	bios_video_set_mode(0x03);
	msdos_terminate_program20();
}

// 0C00:01AF: FlagGroup bool fn0C00_01AF(Register Eq_56 cx, Register Eq_4 si, Register (ptr16 Eq_5) ds, FpuStack Eq_76 rArg0, FpuStack Eq_76 rArg1, FpuStack Eq_76 rArg2, FpuStack Eq_76 rArg3, Register out Eq_80 alOut, Register out Eq_56 cxOut)
// Called from:
//      fn0C00_0100
bool fn0C00_01AF(Eq_56 cx, Eq_4 si, struct Eq_5 * ds, Eq_76 rArg0, Eq_76 rArg1, Eq_76 rArg2, Eq_76 rArg3, union Eq_80 & alOut, union Eq_56 & cxOut)
{
	bool C;
	real64 rLoc1_79 = sqrt(rArg0);
	if (!C)
		rLoc1_79 = -rLoc1_79;
	Eq_76 rLoc1_88 = (rLoc1_79 + rArg1) / rArg2;
	bool C_114 = SLICE(cond(rLoc1_88 - rArg3), bool, 1);
	if (rLoc1_88 >= rArg3)
	{
		real64 rLoc2_97 = __atan2((real64) (ds->*((word16) si + 2)) * rLoc1_88, (real64) (ds->*((word16) si + 4)) * rLoc1_88 + 1.0);
		real64 rLoc3_100 = (real64) ds->w0175 * rLoc1_88 + (real64) ds->r010D;
		ds->*si = cx;
		real64 rLoc3_101 = rLoc3_100 - (real64) (ds->*si);
		ds->*si = (int16) (fabs(sin(rLoc3_101)) * (real64) ds->w017E);
		C_114 = SLICE(cond(sin(rLoc2_97 + rLoc3_101) - rArg3), bool, 1);
	}
	alOut.u1 = <invalid>;
	cxOut = cx;
	return C_114;
}

