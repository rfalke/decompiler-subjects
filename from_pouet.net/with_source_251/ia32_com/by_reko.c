// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject_code.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_2) es, Register (ptr16 Eq_2) ds)
void fn0C00_0100(struct Eq_2 * es, struct Eq_2 * ds)
{
	__fninit();
	__syscall(0x10);
	__outb(0x03C8, 0x13);
	word16 ax_11 = SEQ(ah, 0x13);
	do
	{
		ax_213 = SEQ(ah_212, al_22 + 0x01);
		__outb(969, (byte) ax_11 >> 0x02);
		__outb(969, 0x00);
		__outb(969, 0x00);
		byte al_22 = (byte) ax_11;
		byte ah_212 = SLICE(ax_11, byte, 8);
		ax_11 = ax_213;
	} while (al_22 != 0x01);
	do
	{
		ds->w0202 = 7200;
		do
		{
			real64 rLoc2_259 = rRet1_61;
			real64 rRet1_51;
			real64 rRet1_61;
			real64 rArg3_324;
			real64 rArg3_323;
			real64 rLoc3_262 = fn0C00_01DD((real64) ds->w0202 / (real64) ds->w01FA, fn0C00_01DD((real64) ds->w0202 * 3.14159265358979 / (real64) ds->w01F8, 0.0, (sin((real64) ds->w0202) / (real64) ds->w01FA + 1.0) * (real64) ds->w01F6, out rRet1_51, out rArg3_323), rRet1_51, out rRet1_61, out rArg3_324) * 1.44269504088896;
			word16 cx_71;
			for (cx_71 = 0x03; cx_71 != 0x00; --cx_71)
			{
				real64 rRet1_92;
				real64 rRet2_93;
				real64 rRet0_91 = fn0C00_01DD((real64) ds->w0202 / (real64) ds->w01F8 * cos((real64) ds->w0200 / (real64) ds->w01FA) + ((real64) ds->w0200 * (real64) ds->w01FA) / (real64) ds->w01FE, rLoc3_262, rLoc2_259, out rRet1_92, out rRet2_93);
				rLoc3_262 = rRet0_91;
				rLoc2_259 = rRet1_92;
			}
			ds->t0204.u0 = (int16) rRet0_91;
			cu8 al_102 = 0x80 - ds->t0204;
			real64 rLoc1_281 = rRet2_93 * (((real64) ds->w01FC / (rRet0_91 + (real64) ds->w01FE)) * rRet1_92);
			ds->t0204.u0 = (int16) rRet1_92;
			Eq_101 di_110 = ds->t0204;
			ds->t0204.u0 = (int16) rLoc1_281;
			Eq_129 di_117 = ((word16) di_110 + 100) *s 0x0140 + ((word16) ds->t0204 + 780);
			byte cl_119 = 0x07;
			do
			{
				byte ch_120 = 0x07;
				do
				{
					if (al_102 > ds->*di_117)
						es->*di_117 = al_102;
					--ch_120;
					di_117 = (word16) di_117 + 1;
					word16 cx_144 = SEQ(ch_120, cl_119);
				} while (ch_120 != 0x00);
				di_117 = (word16) di_117 + 313;
				cl_119 = (byte) (cx_144 - 0x01);
			} while (cx_144 != 0x01);
			int16 v21_151 = ds->w0202 - 0x01;
			ds->w0202 = v21_151;
		} while (v21_151 != 0x00);
		byte Eq_2::* di_171 = Eq_2::a0280;
		cui16 cx_320 = 0xF500;
		do
		{
			uint8 al_179 = ((byte) di_171 + SLICE(cx_325, byte, 8) & 0x20) >> 0x05;
			uint8 v22_186 = ds->*di_171;
			ds->*di_171 = al_179 + 0x01 + (al_179 < 0x00);
			0xA000->*di_171 = v22_186;
			++di_171;
			cx_320 = cx_325 - 0x01;
			cx_325 = cx_320;
		} while (cx_325 != 0x01);
		++ds->w0200;
		es = ds;
	} while ((int16) __inb(0x60) != 0x01);
	__syscall(0x10);
}

// 0C00:01DD: FpuStack real64 fn0C00_01DD(FpuStack real64 rArg0, FpuStack real64 rArg1, FpuStack real64 rArg2, FpuStack out Eq_58 rArg2Out, FpuStack out Eq_59 rArg3Out)
// Called from:
//      fn0C00_0100
real64 fn0C00_01DD(real64 rArg0, real64 rArg1, real64 rArg2, union Eq_58 & rArg2Out, union Eq_59 & rArg3Out)
{
	real64 rArg0_33 = cos(rArg0);
	real64 rLoc1_34 = sin(rArg0);
	rArg2Out = rArg0_33 * rLoc1_34 - rArg1 * rArg0_33;
	rArg3Out = rLoc1_34 * rArg2 + rArg0_33 * rArg1;
	return rArg3;
}

