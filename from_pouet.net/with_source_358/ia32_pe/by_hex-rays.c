/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __stdcall __noreturn start(int, int, int, int);
// int __stdcall MessageBoxA(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType);
// BOOL __stdcall CloseHandle(HANDLE hObject);
// HANDLE __stdcall CreateFileA(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// void __stdcall __noreturn ExitProcess(UINT uExitCode);
// BOOL __stdcall FreeLibrary(HMODULE hLibModule);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// DWORD __stdcall SetFilePointer(HANDLE hFile, LONG lDistanceToMove, PLONG lpDistanceToMoveHigh, DWORD dwMoveMethod);
// BOOL __stdcall WriteFile(HANDLE hFile, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite, LPDWORD lpNumberOfBytesWritten, LPOVERLAPPED lpOverlapped);

//-------------------------------------------------------------------------
// Data declarations

CHAR LibFileName[] = "kernel32"; // idb
CHAR aUser32[] = "user32"; // idb
CHAR aGdi32[] = "gdi32"; // idb
HMODULE hLibModule = NULL; // idb
HMODULE dword_40301A = NULL; // idb
HMODULE dword_40301E = NULL; // idb
CHAR ProcName[] = "LoadLibraryA"; // idb
CHAR aGetdc[] = "GetDC"; // idb
CHAR aSetpixel[] = "SetPixel"; // idb
CHAR aReleasedc[] = "ReleaseDC"; // idb
HMODULE (__stdcall *LoadLibraryA_0)(LPCSTR lpLibFileName) = NULL;
HDC (__stdcall *GetDC)(HWND hWnd) = NULL;
COLORREF (__stdcall *SetPixel)(HDC hdc, int x, int y, COLORREF color) = NULL;
int (__stdcall *ReleaseDC)(HWND hWnd, HDC hDC) = NULL;
CHAR Caption[] = "ROXOR-2A SETUP"; // idb
CHAR aDone[] = "DONE! (^_^)"; // idb
CHAR Text[] = "ERROR! (>_<)"; // idb
CHAR FileName[] = "ROXOR-2A.exe"; // idb
HANDLE hObject = NULL; // idb
DWORD NumberOfBytesWritten = 0u; // idb


//----- (00401000) --------------------------------------------------------
void __stdcall __noreturn start(int a1, int a2, int a3, int a4)
{
  hLibModule = LoadLibraryA(LibFileName);
  if ( hLibModule
    && (dword_40301A = LoadLibraryA(aUser32)) != 0
    && (dword_40301E = LoadLibraryA(aGdi32)) != 0
    && (LoadLibraryA_0 = (HMODULE (__stdcall *)(LPCSTR))GetProcAddress(hLibModule, ProcName)) != 0
    && (GetDC = (HDC (__stdcall *)(HWND))GetProcAddress(dword_40301A, aGetdc)) != 0
    && (SetPixel = (COLORREF (__stdcall *)(HDC, int, int, COLORREF))GetProcAddress(dword_40301E, aSetpixel)) != 0
    && (ReleaseDC = (int (__stdcall *)(HWND, HDC))GetProcAddress(dword_40301A, aReleasedc)) != 0
    && (hObject = CreateFileA(FileName, 0x40000000u, 0, 0, 3u, 0x80u, 0), hObject != (HANDLE)-1) )
  {
    SetFilePointer(hObject, 186, 0, 0);
    WriteFile(hObject, &LoadLibraryA_0, 4u, &NumberOfBytesWritten, 0);
    SetFilePointer(hObject, 196, 0, 0);
    WriteFile(hObject, &GetDC, 4u, &NumberOfBytesWritten, 0);
    SetFilePointer(hObject, 221, 0, 0);
    WriteFile(hObject, &SetPixel, 4u, &NumberOfBytesWritten, 0);
    SetFilePointer(hObject, 247, 0, 0);
    WriteFile(hObject, &ReleaseDC, 4u, &NumberOfBytesWritten, 0);
    CloseHandle(hObject);
    MessageBoxA(0, aDone, Caption, 0);
  }
  else
  {
    MessageBoxA(0, Text, Caption, 0);
  }
  FreeLibrary(hLibModule);
  FreeLibrary(dword_40301A);
  FreeLibrary(dword_40301E);
  ExitProcess(0);
}

// nfuncs=10 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
