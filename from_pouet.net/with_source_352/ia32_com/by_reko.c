// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_3) ds)
void fn0C00_0100(struct Eq_3 * ds)
{
	__syscall<byte>(0x10);
	fn0C00_0289(0x00, 0x38);
	fn0C00_0289(0x0F, 0x00);
	fn0C00_029C(0x03, 0x0F);
	fn0C00_02A7(&ds->b02C2 + 579);
	fn0C00_029C(0x07, 11);
	fn0C00_02A7(&ds->b02C2 + 604);
	fn0C00_029C(0x09, 0x08);
	fn0C00_02A7(&ds->b02C2 + 621);
	fn0C00_029C(0x0E, 0x0D);
	fn0C00_02A7(&ds->b02C2 + 645);
	fn0C00_02AE(0x30, 0x40);
	fn0C00_029C(0x05, 0x0D);
	fn0C00_02A7(&ds->b02C2 + 589);
	fn0C00_02AE(0x50, 0x40);
	word16 cx_353 = 0x7D00;
	word16 Eq_87::* di_350 = Eq_87::a0000;
	while (true)
	{
		byte ch_81 = SLICE(cx_353, byte, 8);
		if (cx_353 == 0x00)
			break;
		0xA000->*di_350 = 0x00;
		++di_350;
		--cx_353;
	}
	byte ch_117 = SLICE(fn0C00_02AE(SEQ(SLICE((uint16) fn0C00_0268(SEQ(ch_81, 0x00), 0x00, &Eq_3::b02C2, &Eq_87::b4BE4, 0xA000, ds), byte, 8), 0x28), 0x40), byte, 8);
	fn0C00_029C(0x05, 0x0A);
	fn0C00_02A7(&ds->b02C2 + 669);
	fn0C00_029C(0x06, 0x0A);
	fn0C00_02A7(&ds->b02C2 + 684);
	byte ch_137 = SLICE(fn0C00_02AE(SEQ(ch_117, 0x38), 0x40), byte, 8);
	fn0C00_029C(0x05, 0x0A);
	fn0C00_02A7(&ds->b02C2 + 699);
	fn0C00_029C(0x06, 0x0A);
	fn0C00_02A7(&ds->b02C2 + 717);
	byte Eq_87::* di_146 = Eq_87::a3200;
	word16 cx_152 = SEQ(0x14, (byte) fn0C00_02AE(SEQ(ch_137, 0x38), 0x40));
	while (true)
	{
		byte ch_155 = SLICE(cx_152, byte, 8);
		if (cx_152 == 0x00)
			break;
		0xA000->*di_146 = 0x00;
		++di_146;
		--cx_152;
	}
	byte ch_169 = SLICE(fn0C00_02AE(SEQ(ch_155, 0x18), 0x40), byte, 8);
	ds->b02BF = 77;
	ds->w02C0 = 0xF3;
	byte ch_194 = SLICE(fn0C00_02AE(SEQ(SLICE((uint16) fn0C00_0268(SEQ(ch_169, 0x00), 0x00, &Eq_3::b059E, &Eq_87::b5C16, 0xA000, ds), byte, 8), 0x12), 0x40), byte, 8);
	A000:5F91 = (byte *) 0x00;
	byte ch_207 = SLICE(fn0C00_02AE(SEQ(ch_194, 0x14), 0x40), byte, 8);
	ds->b02BF = 0xA9;
	ds->w02C0 = 151;
	struct Eq_210 Eq_87::* di_227 = &Eq_87::t7D99;
	word16 cx_231 = SEQ(SLICE(fn0C00_02AE(SEQ(SLICE((uint16) fn0C00_0268(SEQ(ch_207, 0x00), 0x00, &Eq_3::b02C2, &Eq_87::b4BE4, 0xA000, ds), byte, 8), 0x40), 0x40), byte, 8), 0x09);
	do
	{
		do
		{
			word16 cx_239;
			(0xA000->*di_227).w0000 = 0x0F0F;
			di_227 -= 0x0140;
			--cx_239;
		} while (cx_239 != 0x00);
		fn0C00_02AE(cx_239 + 0x02, 0x40);
		cx_231 = cx_239 - 0x01;
		byte ch_366 = SLICE(cx_239 - 0x01, byte, 8);
		cx_239 = cx_231;
	} while (cx_239 != 0x01);
	struct Eq_264 Eq_87::* di_258 = Eq_87::a5097;
	word16 cx_262 = SEQ(ch_366, 0x02);
	do
	{
		(0xA000->*di_258).dw0000 = 0x28042804;
		word16 cx_269 = -cx_382;
		fn0C00_02AE(SEQ(SLICE(cx_269 + 0x06, byte, 8), (byte) cx_269 + 0x06 << 0x01), 0x40);
		++di_258;
		cx_262 = cx_382 - 0x01;
		byte ch_369 = SLICE(cx_382 - 0x01, byte, 8);
		cx_382 = cx_262;
	} while (cx_382 != 0x01);
	word16 cx_377 = SEQ(ch_369, 55);
	do
	{
		byte cl_289 = (byte) cx_381;
		fn0C00_0289(0x00, (uint16) cl_289);
		fn0C00_02AE(SEQ(SLICE(cx_381, byte, 8), (cl_289 & 0x01) + 0x01), 0x40);
		cx_377 = SEQ(SLICE(cx_381 - 0x01, byte, 8), cl_289 - 0x01);
		cx_381 = cx_377;
	} while (cx_381 != 0x01);
	fn0C00_029C(0x07, 0x0C);
	fn0C00_02A7(&ds->b02C2 + 661);
	fn0C00_02AE(0x1E, 0x40);
	byte al_342;
	bios_kbd_get_keystroke(out al_342);
	msdos_terminate(al_342);
}

// 0C00:0268: Register byte fn0C00_0268(Sequence word16 ch_al, Register ui8 ah, Register (memptr (ptr16 Eq_3) byte) si, Register (memptr (ptr16 Eq_87) byte) di, Register (ptr16 Eq_87) es, Register (ptr16 Eq_3) ds)
// Called from:
//      fn0C00_0100
byte fn0C00_0268(word16 ch_al, ui8 ah, byte Eq_3::* si, byte Eq_87::* di, struct Eq_87 * es, struct Eq_3 * ds)
{
	word16 ch_al_75 = ch_al;
l0C00_0268:
	cu8 bh_23 = 0x00;
	di += ds->w02C0;
	word16 ch_al_72 = ch_al_75;
	while (true)
	{
		byte ch_55 = SLICE(ch_al_72, byte, 16);
		byte al_15 = ds->*si;
		++si;
		if (al_15 == 0x00)
			break;
		bh_23 += al_15;
		word16 cx_28 = SEQ(ch_55, al_15);
		while (true)
		{
			byte ch_58 = SLICE(cx_28, byte, 8);
			if (cx_28 == 0x00)
				break;
			es->*di = ah;
			++di;
			--cx_28;
		}
		ch_al_75 = SEQ(ch_58, ah);
		if (bh_23 >= ds->b02BF)
			goto l0C00_0268;
		ah = ah ^ 0x0F;
		ch_al_72 = SEQ(ch_58, ah);
	}
	return SLICE(ch_al_72, byte, 8);
}

// 0C00:0289: void fn0C00_0289(Register byte al, Register uint16 bx)
// Called from:
//      fn0C00_0100
void fn0C00_0289(byte al, uint16 bx)
{
	byte bl_14 = (byte) bx;
	byte bh_16 = SLICE(bx, byte, 8);
	__out<byte>(0x03C8, al);
	__out<byte>(969, bl_14 + bh_16);
	__out<byte>(969, bl_14);
	__out<byte>(969, bl_14);
}

// 0C00:029C: void fn0C00_029C(Register byte dh, Register byte dl)
// Called from:
//      fn0C00_0100
void fn0C00_029C(byte dh, byte dl)
{
	bios_video_set_cursor_position(0x00, dh, dl);
}

// 0C00:02A7: void fn0C00_02A7(Sequence word32 ds_dx)
// Called from:
//      fn0C00_0100
void fn0C00_02A7(word32 ds_dx)
{
	msdos_display_string(ds_dx);
}

// 0C00:02AE: Register word16 fn0C00_02AE(Register word16 cx, Register (ptr16 Eq_60) fs)
// Called from:
//      fn0C00_0100
word16 fn0C00_02AE(word16 cx, struct Eq_60 * fs)
{
	do
	{
		byte dh_6 = fs->b006C;
		do
			;
		while (fs->b006C == dh_6);
		--cx;
	} while (cx != 0x00);
	return cx;
}

