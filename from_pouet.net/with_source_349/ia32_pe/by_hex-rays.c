/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// unsigned __int64 __usercall start@<edx:eax>(unsigned __int64 result@<edx:eax>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN unk_400188; // weak
signed __int32 dword_4001AA[16277] =
{
  738197725,
  -1436234663,
  1595562275,
  -850766581,
  -940937689,
  -891577145,
  -522474804,
  -1064573029,
  1469989830,
  191673781,
  -2035920614,
  -426508215,
  -210111938,
  1736145839,
  493058923,
  108826141,
  -1183012090,
  -580828307,
  -1326918289,
  -1294131790,
  1451849276,
  -1010958084,
  -1878360691,
  -1019314675,
  1216843358,
  -1505148362,
  -1286666280,
  1689959515,
  -1869065831,
  928333450,
  -732271342,
  1580139590,
  2062457861,
  -330260818,
  1896030360,
  -669799700,
  247907292,
  -1588101380,
  -515273602,
  88526556,
  -566149364,
  491099995,
  393029659,
  -1588668894,
  1992984419,
  1113400254,
  -2015590103,
  1456309986,
  1360186572,
  -1602454848,
  1013355752,
  -1668252296,
  646964810,
  -455240354,
  298800080,
  -207926190,
  -948335500,
  -1872602382,
  -1712646764,
  953367264,
  -719098254,
  1260389992,
  1437356288,
  854423736,
  133431682,
  -119064372,
  1831542,
  353026909,
  -901131432,
  -469853511,
  -891086562,
  1558217253,
  -1117045766,
  -1073914277,
  -1975896631,
  -83568527,
  -788106754,
  -500985666,
  1975770502,
  -230872218,
  1731086658,
  -778093502,
  1795382742,
  1456503621,
  1577971586,
  1445518646,
  -1095813045,
  -422591730,
  -2081717462,
  1705847769,
  -1391701169,
  1087547734,
  1676352419,
  -633828547,
  35161877,
  1309203520,
  -146806106,
  1947276843,
  1541043299,
  527846365,
  324214757,
  240090782,
  -46888626,
  -1873534036,
  78701937,
  1704692202,
  1585329803,
  1275087969,
  -2050330193,
  -1792181172,
  462992021,
  1328873337,
  1204283505,
  780825422,
  1169780197,
  -693419630,
  -1841829350,
  696731179,
  -1502903278,
  242461463,
  1213539214,
  529639133,
  -1255210913,
  226052036,
  -1670350300,
  732617260,
  2061228947,
  1541664298,
  -951749837,
  -475924056,
  -1016913194,
  1711358701,
  614307200,
  420067687,
  -308873517,
  82372048,
  443824213,
  2106501700,
  1720049308,
  -961651618,
  -2081038926,
  -872104964,
  1818229573,
  -74881835,
  476339139,
  918997869,
  -615525472,
  -221827628,
  -1790391182,
  
}; // weak
int dword_420000[309]; // weak
__int16 word_4204D6[]; // weak


//----- (00400002) --------------------------------------------------------
unsigned __int64 __usercall start@<edx:eax>(unsigned __int64 result@<edx:eax>)
{
  unsigned int v1; // edi
  unsigned int v3; // ebp
  _DWORD *v4; // esi
  unsigned int v5; // ecx
  bool v6; // sf
  char v7; // cc
  int v8; // ecx
  _WORD *v9; // edi
  bool v10; // pf
  unsigned int v11; // eax
  _DWORD *v12; // esi
  bool v13; // cf
  int v14; // ecx
  _BYTE *v15; // edi
  _BYTE *v16; // esi
  unsigned int v17; // ebp
  bool v18; // zf
  int v19; // eax
  bool v20; // zf
  char v21; // cl
  int v22; // edi
  int v23; // eax
  int v24; // eax
  unsigned __int64 v26; // [esp-34h] [ebp-44h]
  int v27; // [esp-2Ch] [ebp-3Ch]
  int v28; // [esp-28h] [ebp-38h]
  unsigned int v29; // [esp-20h] [ebp-30h]
  _BYTE *v30; // [esp-1Ch] [ebp-2Ch]
  _BYTE *v31; // [esp-18h] [ebp-28h]
  unsigned __int64 v32; // [esp-14h] [ebp-24h]
  unsigned int v33; // [esp-Ch] [ebp-1Ch]
  int v34; // [esp-8h] [ebp-18h]
  unsigned int v35; // [esp+0h] [ebp-10h]
  unsigned int v36; // [esp+4h] [ebp-Ch]
  _DWORD *v37; // [esp+8h] [ebp-8h]
  signed __int32 *v38; // [esp+Ch] [ebp-4h]

  v38 = dword_420000;
  LODWORD(result) = 1;
  v1 = 0;
  _EBX = 2;
  v3 = 0;
  v4 = (_DWORD *)&unk_400188;
  v5 = 0;
  do
  {
LABEL_14:
    v37 = v4;
    v36 = v1;
    v35 = v3;
    v34 = _EBX;
    v33 = v5;
    v32 = result;
    v11 = *v4;
    v12 = v4 + 1;
    v13 = v11 < v1;
    LODWORD(result) = v11 - v1;
    if ( (_DWORD)result )
    {
      v14 = v1 & 7;
      v15 = (char *)v38 + (v1 >> 3);
      v35 = 10;
      LODWORD(result) = *v12;
      v16 = v12 + 1;
      v17 = 0;
      goto LABEL_16;
    }
    while ( 1 )
    {
      v9 = word_4204D6;
      v8 = 78641351;
      if ( !v13 )
        break;
      v21 = v3;
      v22 = 2 * (result % 0x4AFF8C7) + 4326615;
      if ( !LOBYTE(word_4204D6[result % 0x4AFF8C7]) || !(HIBYTE(word_4204D6[result % 0x4AFF8C7]) | BYTE1(v3)) )
        v21 = v3 + 2;
      v23 = -1;
      do
      {
        *(&v35 + v23) += *(unsigned __int8 *)(v22 + v23) << v21;
        v7 = (v23 + 1 < 0) ^ __OFADD__(1, v23) | (v23 == -1);
        ++v23;
      }
      while ( v7 );
      v24 = v23 - _EBX;
      if ( v24 >= 0 )
      {
        _EDI = v22 - 1;
        ++*(_BYTE *)(_EDI + v24);
        v18 = *(_BYTE *)(_EDI + _EBX) >> 1 == 0;
        *(_BYTE *)(_EDI + _EBX) >>= 1;
        if ( v18 )
          __asm { rcl     byte ptr [edi+ebx], 1 }
      }
      result = v26;
      v14 = v27;
      _EBX = v28;
      v17 = v29;
      v15 = v30;
      v16 = v31 + 1;
LABEL_16:
      v3 = v17 - 1;
      do
      {
        ++v3;
        v13 = __CFADD__((_DWORD)result, (_DWORD)result);
        v18 = 2 * (_DWORD)result == 0;
        LODWORD(result) = 2 * result;
      }
      while ( v13 );
      if ( v18 )
      {
        v6 = _EBX - 1 < 0;
        v7 = _EBX <= 1;
        LODWORD(result) = v32;
        v5 = v33;
        _EBX = v34;
        v3 = v35;
        v1 = v36;
        v4 = v37;
        if ( v7 )
        {
          HIDWORD(result) = v38;
          if ( !v6 )
          {
            v37 = (_DWORD *)v36;
            _bittestandset(v38, v36 ^ 7);
            v1 = (unsigned int)v37;
          }
          ++v1;
        }
        else
        {
          while ( (result & 0x80000000) == 0i64 )
          {
            v5 += _bittest(dword_4001AA, v3++) + v5;
            LODWORD(result) = 2 * result;
          }
          v37 = (_DWORD *)result;
          LODWORD(result) = HIDWORD(v32) * (unsigned __int64)(unsigned int)result / (unsigned int)(HIDWORD(v32) + v34);
          _EBX = 0;
          HIDWORD(result) = v37;
          if ( v5 >= (unsigned int)result )
          {
            v5 -= result;
            HIDWORD(result) = result;
            LODWORD(result) = (char *)v37 - result;
            _EBX = 1;
          }
        }
        goto LABEL_14;
      }
      v31 = v16;
      v30 = v15;
      v29 = v3;
      v28 = _EBX;
      v27 = v14;
      v26 = result;
      LOBYTE(result) = *v16;
      v12 = v16 + 1;
      HIDWORD(result) = (unsigned __int8)result;
LABEL_20:
      LOBYTE(result) = *v15 ^ result;
      v19 = __ROL4__(result, 9);
      LOBYTE(v19) = *v15 + v19;
      LODWORD(result) = v19 - 1;
      do
      {
        --v15;
        v13 = __CFADD__(BYTE4(result), BYTE4(result));
        v20 = 2 * BYTE4(result) == 0;
        BYTE4(result) *= 2;
        if ( v13 )
          goto LABEL_20;
      }
      while ( !v20 );
      LODWORD(result) = __ROR4__(result, v14);
      LOBYTE(result) = v14 + result;
      v13 = 1;
    }
    while ( v8 )
    {
      *v9++ = result;
      --v8;
    }
    v10 = __SETP__(*(_BYTE *)v12 | result, 0);
    result = v26;
    v5 = v27;
    _EBX = v28;
    v3 = v29;
    v1 = (unsigned int)v30;
    v4 = v31 + 17;
  }
  while ( !v10 );
  return result;
}
// 400002: could not find valid save-restore pair for ebx
// 400002: could not find valid save-restore pair for ebp
// 400002: could not find valid save-restore pair for edi
// 4000DC: variable 'v26' is possibly undefined
// 4000DC: variable 'v27' is possibly undefined
// 4000DC: variable 'v28' is possibly undefined
// 4000DC: variable 'v29' is possibly undefined
// 4000DC: variable 'v30' is possibly undefined
// 4000DD: variable 'v31' is possibly undefined
// 4001AA: using guessed type signed __int32 dword_4001AA[16277];
// 420000: using guessed type int dword_420000[309];
// 4204D6: using guessed type __int16 word_4204D6[];

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
