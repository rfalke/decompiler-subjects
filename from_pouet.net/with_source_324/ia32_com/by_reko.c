// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register (memptr (ptr16 Eq_31) real32) bx, Register (ptr16 Eq_4) es, Register (ptr16 Eq_5) ds, Stack word16 wArg0A)
void fn0C00_0100(real32 Eq_31::* bx, struct Eq_4 * es, struct Eq_5 * ds, word16 wArg0A)
{
	mp16 fp;
	struct Eq_8 * cs;
	struct Eq_9 * ss;
	__syscall<byte>(0x10);
	byte ch_7 = SLICE(cs, byte, 8);
	byte cl_9 = (byte) cs;
	ds->ptr040C = SEQ(ch_7 + 0x20, cl_9);
	__wait();
	__fninit();
	struct Eq_31 * cx_10 = SEQ(ch_7 + 0x10, cl_9);
	struct Eq_21 * cx_18 = SEQ(ch_7 + 0x30, cl_9);
	real64 rLoc1_504 = 0.0;
	do
	{
		cx_10->*bx = (real32) sin(rLoc1_504);
		rLoc1_504 += (real64) ds->r02E8;
		++bx;
	} while (bx != &Eq_31::r0000);
	struct Eq_59 Eq_5::* si_39 = Eq_5::a02EC;
	word16 Eq_4::* di_40 = &Eq_4::w040E;
	word16 bx_41 = 0x00;
	word16 dx_45;
	for (dx_45 = 0x07; dx_45 != 0x00; --dx_45)
	{
		uint16 cx_64 = (uint16) (si_39[1] - (ds->*si_39).b0000);
		do
		{
			fn0C00_029A(fp, ds);
			es->*di_40 = bx_41 - 0x57;
			word16 Eq_4::* di_78 = di_40 + 1;
			es->*di_78 = wArg0A;
			++bx_41;
			di_40 = di_78 + 1;
			uint8 bl_133 = (byte) bx_41;
			--cx_64;
		} while (cx_64 != 0x00);
		++si_39;
	}
	__out<byte>(0x03C8, 0x00);
	byte al_103;
	ui8 dl_141 = 0xC9;
	ui8 dh_142 = 0x03;
	for (al_103 = 0x00; al_103 != 0x40; ++al_103)
	{
		__out<byte>(969, al_103);
		__out<byte>(969, al_103);
		__out<byte>(969, al_103);
	}
	do
	{
		--al_103;
		__out<byte>(969, al_103);
		__out<byte>(969, al_103);
		__out<byte>(969, al_103);
	} while (al_103 != 0x00);
	struct Eq_21 * ax_116 = ds->ptr040C;
	struct Eq_156 Eq_21::* di_128 = &Eq_21::tFA00;
	word16 cx_129 = 0x00;
	do
	{
		bcu8 bl_139 = bl_133 + (0xA000->*di_128).bFFFFFEC2 + (0xA000->*di_128).bFFFFFEC1 + (0xA000->*di_128).bFFFFFD81;
		word16 dx_146 = __ror<word16,byte>(SEQ(dh_142, dl_141 - dh_142), 0x03);
		uint8 al_151 = (((byte) dx_146 ^ 0x36) >> 0x06) + (bl_139 >> 0x02);
		(0xA000->*di_128).b0000 = al_151 - 0x01;
		(ax_116->*di_128).b0000 = al_151 - 0x01;
		dl_141 = (byte) dx_146 ^ 0x36;
		dh_142 = SLICE(dx_146, byte, 8) ^ 0x3A;
		bl_133 = al_151 - 0x01;
		++di_128;
		--cx_129;
	} while (cx_129 != 0x00);
	do
	{
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) == 0x00);
		do
			;
		while ((__in<byte>(0x03DA) & 0x08) != 0x00);
		Eq_235 cx_188 = cx_129 - 0x01;
		memcpy(&&(cx_18->*(cx_18->*di_128).b0000), &&(cs->ptr040C->*(cs->ptr040C->*di_128).b0000), cx_188);
		word16 di_212 = di_128 + cx_188;
		word16 cx_219 = 0xAF;
		word16 Eq_8::* si_220 = Eq_8::a040E;
		do
		{
			cs->w0406 = cs->*si_220;
			word16 Eq_8::* si_225 = si_220 + 1;
			cs->w0408 = cs->*si_225;
			word16 bx_254 = 0x00;
			do
			{
				cs->w0400 = cs->w0406;
				cs->w0402 = cs->w0408;
				cs->t0404.u1 = 0x00;
				fn0C00_02C0(bx_549, &Eq_8::w0402, &Eq_8::t0404, cs);
				word16 bx_298 = cs->w02E0;
				fn0C00_02C0(bx_298, &Eq_8::w0402, &Eq_8::t0404, cs);
				fn0C00_02C0(bx_298, &Eq_8::w0400, &Eq_8::t0404, cs);
				fn0C00_02C0(cs->w02E2, &Eq_8::w0400, &Eq_8::w0402, cs);
				word16 cx_326 = SEQ(ch_7 + 0x40, cl_9);
				Eq_267 dl_329 = cs->t0404;
				fn0C00_028B(SEQ(cx_326, fn0C00_028B(SEQ(cx_326, fn0C00_028B(SEQ(cx_326, fn0C00_028B(SEQ(cx_326, fn0C00_028B(SEQ(cx_326, fn0C00_028B(SEQ(cx_326, (cs->w0402 + ~0x6B) *s 0x0140 + (cs->w0400 + 65446)), dl_329, cx_18)), dl_329, cx_18)), dl_329, cx_18) + 0x013D), dl_329, cx_18)), dl_329, cx_18)), dl_329, cx_18);
				bx_254 = bx_549 + 0x80;
				bx_549 = bx_254;
			} while (bx_549 != ~0x7F);
			di_128 = di_212;
			si_220 = si_225 + 1;
			cx_219 = cx_548 - 0x01;
			cx_548 = cx_219;
		} while (cx_548 != 0x01);
		cs->w02E0 += 0x0200;
		cs->w02E2 += 0x0160;
		cx_129 = cx_548 - 0x02;
		struct Eq_21 * ax_419 = SEQ(ch_7 + 0x40, cl_9);
		do
		{
			(ax_419->*di_128).b0000 = 0x7F;
			(0xA000->*di_128).b0000 = (cx_18->*di_128).b0000;
			++di_128;
			--cx_129;
		} while (cx_129 != 0x00);
	} while (__in<byte>(0x60) != 0x01);
	bios_video_set_mode(0x03);
	msdos_terminate(0x00);
}

// 0C00:028B: Register (memptr (ptr16 Eq_21) byte) fn0C00_028B(Sequence (ptr32 Eq_267) ds_di, Register Eq_267 dl, Register (ptr16 Eq_21) fs)
// Called from:
//      fn0C00_0100
byte Eq_21::* fn0C00_028B(union Eq_267 * ds_di, Eq_267 dl, struct Eq_21 * fs)
{
	byte Eq_21::* di = (word16) ds_di;
	if (ds_di->u0 >= dl)
	{
		ds_di->u0 = (ci8) dl;
		fs->*di = dl & 0x7F;
	}
	return di + 1;
}

// 0C00:029A: void fn0C00_029A(Sequence (ptr32 Eq_69) ss_bp, Register (ptr16 Eq_5) ds)
// Called from:
//      fn0C00_0100
void fn0C00_029A(struct Eq_69 * ss_bp, struct Eq_5 * ds)
{
	real64 rLoc1_33 = (real64) ss_bp->w0004;
	real64 rLoc3_42 = (1.0 - cos(((real64) ss_bp->w0006 / (real64) ss_bp->w0008) * 3.141592653589793)) * (real64) ds->r02E4;
	ss_bp->w000A = (int16) (rLoc1_33 * rLoc3_42 + (1.0 - rLoc3_42) * (real64) ss_bp->w0002);
}

// 0C00:02C0: void fn0C00_02C0(Sequence (ptr32 Eq_273) gs_bx, Register (memptr (ptr16 Eq_8) int16) si, Register (memptr (ptr16 Eq_8) int16) di, Register (ptr16 Eq_8) ds)
// Called from:
//      fn0C00_0100
void fn0C00_02C0(struct Eq_273 * gs_bx, int16 Eq_8::* si, int16 Eq_8::* di, struct Eq_8 * ds)
{
	real64 rLoc2_35 = (real64) (ds->*si);
	real64 rLoc1_34 = (real64) gs_bx->r4000;
	ds->*si = (int16) (rLoc2_35 * (real64) gs_bx->r0000 - (real64) (ds->*di) * rLoc1_34);
	ds->*di = (int16) (rLoc1_34 * rLoc2_35 + (real64) (ds->*di) * (real64) gs_bx->r0000);
}

