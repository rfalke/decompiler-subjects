// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register byte ah, Register byte ch, Register byte bh, Register cu16 bp, Register (memptr (ptr16 Eq_41) byte) di, Register (ptr16 Eq_8) ds)
void fn0C00_0100(byte ah, byte ch, byte bh, cu16 bp, byte Eq_41::* di, struct Eq_8 * ds)
{
	Eq_9 Top_3 = 0;
	__syscall<byte>(0x10);
	__out<byte>(0x03C8, 0x00);
	word16 ax_223 = SEQ(ah, 0x00);
	do
	{
		byte al_20 = (byte) ax_230;
		__out<byte>(969, al_20);
		__out<byte>(969, al_20);
		__out<byte>(969, al_20);
		++di;
		0x9000->*di = 0x00;
		ui8 ah_118 = SLICE(ax_230 + 0x01, byte, 8);
		ax_223 = SEQ(ah_118, al_20 + 0x01);
		ax_230 = ax_223;
	} while (ax_230 != ~0x00);
	byte dh_122 = 0x00;
	do
	{
		__wait();
		__fninit();
		struct Eq_85 * Top_38 = Top_3 - 1;
		Top_38->r0000 = (real64) ds->r01F6;
		Top_38->r0000 += (real64) ds->r01FA;
		ds->r01F6 = (real32) Top_38->r0000;
		real64 v20_45 = Top_38->r0000;
		Top_38->r0000 = cos(v20_45);
		Top_38->rFFFFFFFF = sin(v20_45);
		++bp;
		Top_3 = Top_38 - (struct Eq_248 *) 1;
		if ((bp & 0x0400) != 0x00)
		{
			word16 bx_62 = <invalid>;
			word16 dx_63 = <invalid>;
			bh = SLICE(bx_62, byte, 8);
			dh_122 = SLICE(dx_63, byte, 8);
			byte dh_226;
			byte bh_227;
			ah_118 = SLICE((uint16) fn0C00_0180(ah_118, ch, dh_122, bh, bp, &Eq_8::t01FE, &Eq_8::t01FF, ds, 0x9000, Top_38->rFFFFFFFF, Top_38->r0000, out dh_226, out bh_227), byte, 8);
		}
		struct Eq_57 Eq_41::* di_101 = Eq_41::a0000;
		word16 cx_104 = 0x00;
		do
		{
			uint16 ah_al_199 = SEQ(ah_118, (0x9000->*di_101).b0000) + (uint16) di_101[1] + (uint16) di_101[0x0141] + (uint16) di_101[320];
			Eq_97 al_94 = (byte) (ah_al_199 >> 0x02);
			ah_118 = SLICE(ah_al_199 >> 0x02, byte, 8);
			if (ah_al_199 >> 0x02 != 0x00)
				--al_94;
			(0x9000->*di_101).b0000 = (uint8) al_94;
			--cx_104;
			++di_101;
			byte ch_119 = SLICE(cx_104, byte, 8);
			byte cl_192 = (byte) cx_104;
		} while (cx_104 != 0x00);
		byte bh_229;
		byte dh_228;
		fn0C00_0180(ah_118, ch_119, dh_122, bh, bp, &Eq_8::t01FE, &Eq_8::t01FE, ds, 0x9000, Top_38->rFFFFFFFF, Top_38->r0000, out dh_228, out bh_229);
		word16 bx_134 = <invalid>;
		word16 dx_135 = <invalid>;
		bh = SLICE(bx_134, byte, 8);
		dh_122 = SLICE(dx_135, byte, 8);
		struct Eq_164 Eq_41::* di_141 = Eq_41::a0000;
		word16 cx_153 = SEQ(~0x00, cl_192);
		do
		{
			Eq_97 ax_148 = (0x9000->*di_141).t0000.u1;
			(0xA000->*di_141).t0000.u0 = (byte) (byte) ax_148;
			--cx_153;
			ah_118 = SLICE(ax_148, byte, 8);
			++di_141;
			ch = SLICE(cx_153, byte, 8);
		} while (cx_153 != 0x00);
	} while (__in<byte>(0x60) != 0x01);
}

// 0C00:0180: Register ui8 fn0C00_0180(Register ui8 ah, Register byte ch, Register byte dh, Register byte bh, Register cu16 bp, Register (memptr (ptr16 Eq_8) Eq_75) si, Register (memptr (ptr16 Eq_8) Eq_75) di, Register (ptr16 Eq_8) ds, Register (ptr16 Eq_41) fs, FpuStack real64 rArg0, FpuStack real64 rArg1, Register out Eq_81 dhOut, Register out Eq_81 bhOut)
// Called from:
//      fn0C00_0100
ui8 fn0C00_0180(ui8 ah, byte ch, byte dh, byte bh, cu16 bp, struct Eq_75 Eq_8::* si, struct Eq_75 Eq_8::* di, struct Eq_8 * ds, struct Eq_41 * fs, real64 rArg0, real64 rArg1, union Eq_81 & dhOut, union Eq_81 & bhOut)
{
	word16 ax_162 = SEQ(ah, 0x5F);
	do
	{
		int16 bx_150 = SEQ(bh, 0x5F);
		do
		{
			(ds->*si).w0000 = bx_150;
			(ds->*di).w0000 -= 0x2F;
			ds->w0200 = ax_162;
			(ds->*si).w0002 -= 0x2F;
			real64 rLoc1_195 = (real64) (ds->*si).w0000;
			real64 rLoc2_196 = (real64) (ds->*si).w0002;
			(ds->*si).w0000 = (int16) (rLoc1_195 * rArg0 - rLoc2_196 * rArg1);
			(ds->*si).w0002 = (int16) (rLoc2_196 * rArg0 + rLoc1_195 * rArg1);
			byte al_172 = (byte) ax_162;
			ui8 ah_175 = SLICE(ax_162, byte, 8);
			byte bl_171 = (byte) bx_150;
			byte bh_187 = SLICE(bx_150, byte, 8);
			byte dl_138 = 0x3F;
			do
			{
				ui16 cx_82 = SEQ(ch, dl_262 ^ bl_171 ^ al_172) ^ bp >> 0x01;
				byte cl_83 = (byte) cx_82;
				cu16 dx_64 = SEQ(dh, dl_262);
				if ((cl_83 & 0x3F) >= 0x20)
				{
					Eq_263 ax_99 = (ds->w0200 + 0x70 - (dx_64 >> 0x01)) * 0x0140 + (((ds->*si).w0000 + (dx_64 >> 0x01)) + 0x93);
					uint8 cl_105 = (cl_83 & 0x3F) - (byte) (dx_64 >> 0x01);
					if (di != si)
						cl_105 >>= 0x01;
					fs->*ax_99 = cl_105;
				}
				bh = bh_187;
				dl_138 = dl_262 - 0x01;
				dl_262 = dl_138;
			} while (dl_262 != 0x01);
			bx_150 = SEQ(bh_187, bl_171 - 0x01);
		} while (bl_171 != 0x01);
		ax_162 = SEQ(ah_175, al_172 - 0x01);
	} while (al_172 != 0x01);
	dhOut.u1 = <invalid>;
	bhOut.u1 = <invalid>;
	return ah_175;
}

