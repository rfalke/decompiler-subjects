// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register (ptr16 Eq_3) es, Register (ptr16 Eq_4) ds)
void fn0C00_0100(struct Eq_3 * es, struct Eq_4 * ds)
{
	struct Eq_5 * fs_8 = fn0C00_012B(es);
	fn0C00_0344(es, ds);
	struct Eq_15 * es_29 = fn0C00_0138(ds);
	fn0C00_01CE();
	do
	{
		fn0C00_01AF(es_29, ds);
		fn0C00_01FE(ds);
		fn0C00_0251(es_29, ds);
		es_29 = fn0C00_02D9(ds, fs_8);
		fn0C00_02A6(es_29, ds);
		fn0C00_01A4(ds);
	} while (__in<byte>(0x60) != 0x01);
	bios_video_set_mode(0x03);
	msdos_terminate_program20();
}

// 0C00:012B: Register (ptr16 Eq_66) fn0C00_012B(Register (ptr16 Eq_3) es)
// Called from:
//      fn0C00_0100
struct Eq_66 * fn0C00_012B(struct Eq_3 * es)
{
	byte Eq_3::* di_15 = Eq_3::a04E8;
	word16 cx_10;
	for (cx_10 = 12233; cx_10 != 0x00; --cx_10)
	{
		es->*di_15 = 0x00;
		++di_15;
	}
	return 0x00;
}

// 0C00:0138: Register (ptr16 Eq_83) fn0C00_0138(Register (ptr16 Eq_4) ds)
// Called from:
//      fn0C00_0100
struct Eq_83 * fn0C00_0138(struct Eq_4 * ds)
{
	__syscall<byte>(0x10);
	__out<byte>(0x03C8, 0x00);
	word16 cx_10;
	for (cx_10 = 0x0300; cx_10 != 0x00; --cx_10)
		__out<byte>(969, 0x00);
	__out<word16>(0x03C4, 0x0604);
	__out<word16>(0x03D4, 0x14);
	__out<word16>(0x03D4, 58135);
	__out<word16>(0x03D4, 0x4013);
	__out<word16>(0x03C4, 0x0F02);
	word32 Eq_83::* di_34 = Eq_83::a0000;
	word16 cx_35;
	for (cx_35 = 0x4000; cx_35 != 0x00; --cx_35)
	{
		0xA000->*di_34 = 0x00;
		++di_34;
	}
	fn0C00_017F(0x00, ds);
	ds->t04E8.u0 = 0x8000;
	return 0xA000;
}

// 0C00:017F: Register Eq_134 fn0C00_017F(Register Eq_134 ax, Register (ptr16 Eq_4) ds)
// Called from:
//      fn0C00_0138
//      fn0C00_01A4
Eq_134 fn0C00_017F(Eq_134 ax, struct Eq_4 * ds)
{
	byte ah_26 = SLICE(ax, byte, 8);
	ds->t04EA = ax;
	do
		;
	while ((__in<byte>(0x03DA) & 0x08) == 0x00);
	do
		;
	while ((__in<byte>(0x03DA) & 0x08) != 0x00);
	__cli();
	__out<word16>(0x03D4, SEQ(ah_26, 0x0C));
	Eq_134 ah_34 = ds->t04EA;
	__out<word16>(0x03D4, SEQ(ah_34, 0x0D));
	__sti();
	do
	{
		byte al_39 = __in<byte>(0x03DA);
		Eq_134 ax_46 = SEQ(ah_34, al_39);
	} while ((al_39 & 0x08) == 0x00);
	return ax_46;
}

// 0C00:01A4: void fn0C00_01A4(Register (ptr16 Eq_4) ds)
// Called from:
//      fn0C00_0100
void fn0C00_01A4(struct Eq_4 * ds)
{
	Eq_134 v6_7 = ds->t04E8;
	ds->t04E8 = ds->t04EA;
	fn0C00_017F(v6_7, ds);
}

// 0C00:01AF: void fn0C00_01AF(Register (ptr16 Eq_15) es, Register (ptr16 Eq_4) ds)
// Called from:
//      fn0C00_0100
void fn0C00_01AF(struct Eq_15 * es, struct Eq_4 * ds)
{
	__out<word16>(0x03C4, 0x0F02);
	byte ch_32 = 0x00;
	Eq_134 di_12 = ds->t04E8;
	byte dl_13;
	for (dl_13 = 200; dl_13 != 0x00; --dl_13)
	{
		word16 cx_19 = SEQ(ch_32, 0x14);
		while (true)
		{
			ch_32 = SLICE(cx_19, byte, 8);
			if (cx_19 == 0x00)
				break;
			es->*di_12 = 0x00;
			di_12 = (word16) di_12 + 4;
			--cx_19;
		}
		di_12 = (word16) di_12 + 48;
	}
}

// 0C00:01CE: void fn0C00_01CE()
// Called from:
//      fn0C00_0100
void fn0C00_01CE()
{
	__out<byte>(0x03C8, 0x00);
	byte ah_12 = 0x00;
	word16 cx_11;
	cui16 bx_56 = 0x00;
	for (cx_11 = 0x40; cx_11 != 0x00; --cx_11)
	{
		byte bl_15 = (byte) bx_56;
		fn0C00_01F4(ah_12, 969, SLICE(bx_56, byte, 8), bl_15);
		++ah_12;
		bx_56 = SEQ(SLICE(bx_56 + 0x0101, byte, 8), bl_15 + 0x01);
	}
	byte bl_33 = 0x00;
	word16 cx_29;
	for (cx_29 = 0x40; cx_29 != 0x00; --cx_29)
	{
		fn0C00_01F4(0x00, 969, 0x00, bl_33);
		++bl_33;
	}
}

// 0C00:01F4: Register byte fn0C00_01F4(Register byte ah, Register uint16 dx, Register byte bh, Register byte bl)
// Called from:
//      fn0C00_01CE
byte fn0C00_01F4(byte ah, uint16 dx, byte bh, byte bl)
{
	__out<byte>(dx, ah);
	__out<byte>(dx, bh);
	__out<byte>(dx, bl);
	return bl;
}

// 0C00:01FE: void fn0C00_01FE(Register (ptr16 Eq_4) ds)
// Called from:
//      fn0C00_0100
void fn0C00_01FE(struct Eq_4 * ds)
{
	ds->t04EC = (word16) ds->t04EC + 6;
	ds->t04EC &= 0x7F;
	Eq_304 bx_13 = ds->t04EC;
	word16 Eq_4::* di_14 = Eq_4::a04F0;
	word16 cx_15 = 0x80;
	do
	{
		ds->*di_14 = (int16) (byte) ((int16) (ds->*((word16) bx_13 + 1121)) *s 0x08 >> 0x07) << 0x07;
		--cx_15;
		++di_14;
		bx_13 = (word16) bx_13 + 1 & 0x7F;
		byte ch_62 = SLICE(cx_15, byte, 8);
	} while (cx_15 != 0x00);
	Eq_353 bx_37 = (word16) ds->t04EC + 32 & 0x7F;
	byte Eq_4::* di_41 = Eq_4::a05F0;
	word16 cx_60 = SEQ(ch_62, 0x80);
	do
	{
		ds->*di_41 = (byte) ((int16) (ds->*((word16) bx_37 + 1121)) *s 22 >> 0x07);
		++di_41;
		bx_37 = (word16) bx_37 + 1 & 0x7F;
		--cx_60;
	} while (cx_60 != 0x00);
}

// 0C00:0251: void fn0C00_0251(Register (ptr16 Eq_15) es, Register (ptr16 Eq_4) ds)
// Called from:
//      fn0C00_0100
void fn0C00_0251(struct Eq_15 * es, struct Eq_4 * ds)
{
	Eq_134 di_6 = ds->t04E8;
	ui8 ah_26 = 0x01;
	word16 bp_10;
	Eq_398 bx_12 = 0x00;
	for (bp_10 = 0x04; bp_10 != 0x00; --bp_10)
	{
		__out<word16>(0x03C4, SEQ(ah_26, 0x02));
		word16 di_22 = (word16) di_6 + 0x0A18;
		byte Eq_4::* si_19 = &Eq_4::b0670;
		word16 cx_28 = 0x20;
		bx_41 = bx_12;
		do
		{
			Eq_398 bx_41;
			struct Eq_407 Eq_15::* di_44 = (word16) (ds->*((word16) bx_41 + 0x04F0)) + di_22;
			byte dl_46 = ds->*((word16) (bx_41 >> 0x01) + 0x05F0);
			word16 cx_49;
			si_51 = si_19;
			for (cx_49 = 0x48; cx_49 != 0x00; --cx_49)
			{
				byte Eq_4::* si_51;
				(es->*di_44).b0000 = ds->*si_51 + dl_46;
				++si_51;
				++di_44;
			}
			si_19 += 288;
			bx_41 = (word16) bx_41 + 8;
			++di_22;
			cx_28 = cx_131 - 0x01;
			cx_131 = cx_28;
		} while (cx_131 != 0x01);
		bx_12 = (word16) bx_12 + 2;
		ah_26 <<= 0x01;
	}
}

// 0C00:02A6: void fn0C00_02A6(Register (ptr16 Eq_15) es, Register (ptr16 Eq_4) ds)
// Called from:
//      fn0C00_0100
void fn0C00_02A6(struct Eq_15 * es, struct Eq_4 * ds)
{
	__out<word16>(0x03C4, 0x0102);
	struct Eq_469 Eq_4::* si_19 = &Eq_4::t2A70;
	ui8 ah_54 = 0x01;
	struct Eq_473 Eq_15::* di_10 = (word16) ds->t04E8 + 0x00005500;
	word16 bp_12;
	for (bp_12 = 0x04; bp_12 != 0x00; --bp_12)
	{
		struct Eq_473 Eq_15::* di_15 = di_10;
		word16 cx_21 = 0x08;
		si_29 = si_19;
		do
		{
			struct Eq_469 Eq_4::* si_29;
			word16 cx_27;
			for (cx_27 = 0x52; cx_27 != 0x00; --cx_27)
			{
				(es->*di_15).b0000 = (ds->*si_29).b0000;
				di_15 = &di_15->b0000 + 1;
				++si_29;
			}
			++di_15;
			cx_21 = cx_95 - 0x01;
			cx_95 = cx_21;
		} while (cx_95 != 0x01);
		ah_54 <<= 0x01;
		__out<word16>(0x03C4, SEQ(ah_54, 0x02));
		si_19 = &si_19->b0000 + 1;
	}
}

// 0C00:02D9: Register (ptr16 Eq_523) fn0C00_02D9(Register (ptr16 Eq_4) ds, Register (ptr16 Eq_5) fs)
// Called from:
//      fn0C00_0100
struct Eq_523 * fn0C00_02D9(struct Eq_4 * ds, struct Eq_5 * fs)
{
	struct Eq_524 * cs;
	memcpy(*((char *) cs + 0x00002A70), (&ds->t2A70.b0000)[2], 0x0A40);
	word16 v12_18 = ds->w045F - 0x01;
	ds->w045F = v12_18;
	if (v12_18 != 0x00)
		return;
	ds->w045F = 0x04;
	Eq_550 gs_ax_27 = fs->t010C;
	struct Eq_554 * gs_78 = SLICE(gs_ax_27, selector, 16);
	Eq_556 bx_29 = ((word16) (ds->*((word16) ds->t04EE + 955)) << 0x03) + (word16) gs_ax_27;
	struct Eq_569 Eq_524::* di_31 = &Eq_524::t2BB0;
	word16 cx_32;
	for (cx_32 = 0x08; cx_32 != 0x00; --cx_32)
	{
		ci16 dx_33;
		for (dx_33 = 0x07; dx_33 >= 0x00; --dx_33)
		{
			(cs->*di_31).b0000 = (int8) __bt<word16>(gs_78->*bx_29, dx_33) << 0x05;
			di_31 = &di_31->b0000 + 1;
		}
		++di_31;
		bx_29 = (word16) bx_29 + 1;
	}
	ds->t04EE = (word16) ds->t04EE + 1;
	if (ds->t04EE > 0xA3)
		ds->t04EE.u0 = 0x00;
	return;
}

// 0C00:0344: void fn0C00_0344(Register (ptr16 Eq_3) es, Register (ptr16 Eq_4) ds)
// Called from:
//      fn0C00_0100
void fn0C00_0344(struct Eq_3 * es, struct Eq_4 * ds)
{
	byte Eq_3::* di_36 = &Eq_3::b0670;
	cu16 bp_42;
	for (bp_42 = 0x80; bp_42 != 0x00; --bp_42)
	{
		cu16 cx_41 = 0x48;
		do
		{
			es->*di_36 = (((int8) ((ds->a0387[0][0x08 - (cx_61 - 0x01 >> 0x03)] & 0x80000000 >> 0x1F - (byte) (bp_42 - 0x01 >> 0x02)) == 0x00) ^ 0x01) << 0x06) + 0x29;
			++di_36;
			cx_41 = cx_61 - 0x01;
			cx_61 = cx_41;
		} while (cx_61 != 0x01);
	}
}

