// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0C00:0100: void fn0C00_0100(Register byte ch, Register word16 bx, Register word16 di, Register (ptr16 Eq_6) ds)
void fn0C00_0100(byte ch, word16 bx, word16 di, struct Eq_6 * ds)
{
	__syscall<byte>(0x10);
	union Eq_15 Eq_18::* di_11 = di - 0x01;
	do
	{
		word16 cx_163 = SEQ(ch, 0x3F);
		cui16 ax_190 = 0x00;
		do
		{
			Eq_15 al_18 = (byte) ax_193;
			(0xA000->*di_11).u0 = (byte) al_18;
			Eq_23 di_22 = (char *) di_11 + 1;
			--cx_163;
			di_11 = (word16) di_22 + 2;
			byte ch_164 = SLICE(cx_163, byte, 8);
			ax_190 = SEQ(SLICE(ax_193 + 0x01, byte, 8), (byte) al_18.u0 + 1);
			ax_193 = ax_190;
		} while (cx_163 != 0x00);
		word16 cx_165 = SEQ(ch_164, 0xC0);
		do
		{
			(0xA000->*di_11).u1 = (word16) (ax_193 + 0x01);
			--cx_165;
			di_11 = (union Eq_15 Eq_18::*) ((char *) di_11 + 3);
			ch = SLICE(cx_165, byte, 8);
		} while (cx_165 != 0x00);
		di_11 = (word16) di_22 + 3;
	} while (di_22 >= ~0x02);
	word16 cx_140 = SEQ(ch, ~0x00);
	bios_video_set_block_of_DAC_registers(bx, cx_140, 0xA000, 0x00);
	do
	{
		word16 cx_77 = cx_140 + 0x01;
		struct Eq_95 Eq_6::* di_103 = &Eq_6::t017C;
		do
		{
			word16 ax_80 = __in<word16>(0x40);
			ds->w0100 = __xadd<word16>(ds->w0100, ax_80);
			uint8 al_101 = (byte) ax_80;
			word16 ax_87 = SEQ(al_101, al_101);
			(ds->*di_103).t0000.u1 = ax_87;
			struct Eq_100 Eq_6::* di_91 = di_103 + 2;
			(ds->*di_91).w0000 = ax_87;
			di_103 = (struct Eq_95 Eq_6::*) (di_91 + 2);
			--cx_77;
		} while (cx_77 != 0x00);
		word16 cx_100 = 0xFA00;
		do
		{
			al_101 = ((word16) di_103[1].t0000 + (al_101 + ((ds->*di_103).t0000).u0) + (ds->*di_103).bFFFFFEC0 >> 0x02) - 0x01;
			if (al_101 <= 0x10)
				al_101 = (uint8) ((word16) di_103[319].t0000 + (((word16) (di_103)[320].t0000 + (al_101 + (ds->*di_103).bFFFFFEC0)) + (ds->*di_103).bFFFFFEC1));
			(ds->*di_103).t0000.u0 = al_101;
			--cx_100;
			++di_103;
			uint8 cl_135 = (byte) cx_100;
		} while (cx_100 != 0x00);
		memcpy(A000:0000, (&ds->t017C)[320], SEQ(0x3C, cl_135) *32 0x04);
		cx_140 = 0x00;
		byte al_144;
		byte ah_145;
	} while (bios_kbd_check_keystroke(out al_144, out ah_145));
	bios_video_set_mode(0x03);
}

