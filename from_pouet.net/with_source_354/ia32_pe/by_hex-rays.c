/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start(); // weak
// int __stdcall MessageBoxA(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType);
// BOOL __stdcall CloseHandle(HANDLE hObject);
// HANDLE __stdcall CreateFileA(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// void __stdcall __noreturn ExitProcess(UINT uExitCode);
// BOOL __stdcall FreeLibrary(HMODULE hLibModule);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// DWORD __stdcall SetFilePointer(HANDLE hFile, LONG lDistanceToMove, PLONG lpDistanceToMoveHigh, DWORD dwMoveMethod);
// BOOL __stdcall WriteFile(HANDLE hFile, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite, LPDWORD lpNumberOfBytesWritten, LPOVERLAPPED lpOverlapped);
UINT __stdcall WinExec(LPCSTR lpCmdLine, UINT uCmdShow);

//-------------------------------------------------------------------------
// Data declarations

CHAR LibFileName[] = "kernel32"; // idb
HMODULE hModule = NULL; // idb
CHAR ProcName[] = "WinExec"; // idb
CHAR Caption[] = "XOROX-KO SETUP"; // idb
CHAR aDone[] = "DONE! (^_^)"; // idb
CHAR Text[] = "ERROR! (>_<)"; // idb
CHAR FileName[] = "XOROX-KO.exe"; // idb
HANDLE hFile = NULL; // idb
DWORD NumberOfBytesWritten = 0u; // idb


//----- (00401000) --------------------------------------------------------
void __noreturn start()
{
  hModule = LoadLibraryA(LibFileName);
  if ( hModule
    && (*(_DWORD *)WinExec = GetProcAddress(hModule, ProcName)) != 0
    && (hFile = CreateFileA(FileName, 0x40000000u, 0, 0, 3u, 0x80u, 0), hFile != (HANDLE)-1) )
  {
    SetFilePointer(hFile, 49, 0, 0);
    WriteFile(hFile, WinExec, 4u, &NumberOfBytesWritten, 0);
    CloseHandle(hFile);
    MessageBoxA(0, aDone, Caption, 0);
  }
  else
  {
    MessageBoxA(0, Text, Caption, 0);
  }
  FreeLibrary(hModule);
  ExitProcess(0);
}
// 401000: using guessed type void __noreturn start();

// nfuncs=10 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
