/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

__int64 __fastcall swap_buffers(__int64, __int64, size_t);
__int64 __fastcall inc_tens_digit();
signed __int64 __fastcall write_stderr(__int64, const char *, size_t);
void __fastcall inefficiently_write_as_hex(__int64 a1, __int64 a2, __int64 a3, int a4);
__int64 __fastcall exit_on_error(__int64);

//-------------------------------------------------------------------------
// Data declarations

_BYTE hexdigits[16] = { 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 65, 66, 67, 68, 69, 70 }; // weak
char error_message_part_1[23] =
{
  'E',
  'n',
  'c',
  'o',
  'u',
  'n',
  't',
  'e',
  'r',
  'e',
  'd',
  ' ',
  'O',
  'S',
  ' ',
  'e',
  'r',
  'r',
  'o',
  'r',
  ' ',
  '0',
  'x'
}; // weak
char error_message_part_2[10] = { ' ', 'a', 't', ' ', 'R', 'I', 'P', ' ', '0', 'x' }; // weak
char error_message_part_3[19] =
{
  ',',
  ' ',
  'e',
  'x',
  'i',
  't',
  'i',
  'n',
  'g',
  ' ',
  'p',
  'r',
  'o',
  'g',
  'r',
  'a',
  'm',
  '.',
  '\n'
}; // weak
struct iovec iovec_base; // idb
char error_write_buffer; // weak


//----- (0000000000401297) ----------------------------------------------------
__int64 __fastcall swap_buffers(__int64 a1, __int64 a2, size_t a3)
{
  __int64 v3; // rbx
  unsigned __int64 v4; // rdx
  unsigned int v5; // er10
  signed __int64 v6; // rax
  __int64 result; // rax
  bool v8; // zf

  iovec_base.iov_base = (void *)(v3 & 0xFFFFFFFFFFE00000LL);
  iovec_base.iov_len = a3;
  v4 = 1LL;
  v5 = 0;
  do
  {
    v6 = sys_vmsplice(1, &iovec_base, v4, v5);
    result = exit_on_error(1LL);
    iovec_base.iov_base = (char *)iovec_base.iov_base + result;
    v8 = iovec_base.iov_len == result;
    iovec_base.iov_len -= result;
  }
  while ( !v8 );
  return result;
}
// 40129E: variable 'v3' is possibly undefined
// 4012C5: variable 'v4' is possibly undefined
// 4012C5: variable 'v5' is possibly undefined

//----- (000000000040139E) ----------------------------------------------------
__int64 __fastcall inc_tens_digit()
{
  int v0; // eax
  __int64 result; // rax

  if ( (_BYTE)v0 != 0xC7 )
    return (unsigned int)(v0 - 1);
  result = 208LL;
  __asm { vpermq  ymm2, ymm2, 4Eh ; 'N' }
  return result;
}
// 4013A0: variable 'v0' is possibly undefined

//----- (0000000000401950) ----------------------------------------------------
signed __int64 __fastcall write_stderr(__int64 a1, const char *a2, size_t a3)
{
  return sys_write(2u, a2, a3);
}

//----- (000000000040195D) ----------------------------------------------------
void __fastcall inefficiently_write_as_hex(__int64 a1, __int64 a2, __int64 a3, int a4)
{
  unsigned __int64 v4; // rax
  int v5; // [rsp-10h] [rbp-10h]
  unsigned __int64 v6; // [rsp-8h] [rbp-8h]

  do
  {
    v6 = v4;
    v5 = a4;
    error_write_buffer = hexdigits[(v4 >> a4) & 0xF];
    write_stderr(a1, &error_write_buffer, 1uLL);
    v4 = v6;
    a4 = v5 - 4;
  }
  while ( v5 - 4 >= 0 );
}
// 40195D: variable 'v4' is possibly undefined
// 402240: using guessed type _BYTE hexdigits[16];
// C00010: using guessed type char error_write_buffer;

//----- (0000000000401991) ----------------------------------------------------
// positive sp value has been detected, the output may be wrong!
__int64 __fastcall exit_on_error(__int64 a1)
{
  __int64 result; // rax
  __int64 v2; // rdx
  __int64 v3; // rdx
  signed __int64 v4; // rax

  if ( result < 0 )
  {
    write_stderr(a1, error_message_part_1, 0x17uLL);
    inefficiently_write_as_hex(a1, (__int64)error_message_part_1, v2, 8);
    write_stderr(a1, error_message_part_2, 0xAuLL);
    inefficiently_write_as_hex(a1, (__int64)error_message_part_2, v3, 60);
    write_stderr(a1, error_message_part_3, 0x13uLL);
    v4 = sys_exit_group(74);
    BUG();
  }
  return result;
}
// 4019CB: positive sp value 8 has been found
// 401994: variable 'result' is possibly undefined
// 4019B4: variable 'v2' is possibly undefined
// 4019D6: variable 'v3' is possibly undefined

// nfuncs=6 queued=5 decompiled=5 lumina nreq=0 worse=0 better=0
// ALL OK, 5 function(s) have been successfully decompiled
