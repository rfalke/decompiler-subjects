/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

__int64 __fastcall sub_401020(); // weak
// ssize_t write(int fd, const void *buf, size_t n);
// __int64 omp_get_thread_num(void); weak
// __int64 omp_get_num_threads(void); weak
// int sprintf(char *s, const char *format, ...);
// __int64 __fastcall GOMP_parallel(_QWORD, _QWORD, _QWORD, _QWORD); weak
int __cdecl main(int argc, const char **argv, const char **envp);
__int64 __fastcall main__omp_fn_0(volatile signed __int32 **);

//-------------------------------------------------------------------------
// Data declarations

__int64 (*qword_404010)(void) = NULL; // weak
__int64 nl[]; // weak
__int64 qword_404088[5999]; // weak
__int64 qword_40FC00; // weak
char format[150000]; // idb


//----- (0000000000401020) ----------------------------------------------------
__int64 sub_401020()
{
  return qword_404010();
}
// 401020: using guessed type __int64 __fastcall sub_401020();
// 404010: using guessed type __int64 (*qword_404010)(void);

//----- (0000000000401080) ----------------------------------------------------
int __cdecl __noreturn main(int argc, const char **argv, const char **envp)
{
  int i; // er13
  __int64 v4; // rbx
  char *v5; // rbp
  __int64 v6; // rdx
  char *v7; // rax
  __int64 *v8; // rdi
  char *v9; // rdx
  char *v10; // rsi
  char v11; // cl
  char *v12; // rsi
  __int32 v13; // [rsp+4h] [rbp-34h] BYREF
  __int32 *v14; // [rsp+8h] [rbp-30h] BYREF

  for ( i = 1; i != 12003; i += 6001 )
  {
    nl[0] = (__int64)format;
    v4 = 0LL;
    v5 = format;
    do
    {
      v6 = (unsigned int)(i + v4);
      if ( (unsigned int)(-286331153 * v6) > 0x11111111 )
      {
        if ( (unsigned int)(-858993459 * v6) <= 0x33333333 )
        {
          strcpy(v5, "Buzz\n");
          v5 += 5;
        }
        else if ( (unsigned int)(-1431655765 * v6) > 0x55555555 )
        {
          v5 += sprintf(v5, "%d\n", v6);
        }
        else
        {
          strcpy(v5, "Fizz\n");
          v5 += 5;
        }
      }
      else
      {
        strcpy(v5, "FizzBuzz\n");
        v5 += 9;
      }
      nl[v4++] = (__int64)v5;
    }
    while ( v4 != 6001 );
    write(1, format, qword_40FC00 - (_QWORD)format);
  }
  v13 = 0;
  while ( 1 )
  {
    v14 = &v13;
    GOMP_parallel(main__omp_fn_0, &v14, 0LL, 0LL);
    if ( v13 )
    {
      v7 = (char *)qword_40FC00;
      v8 = &qword_40FC00;
      v9 = (char *)(qword_40FC00 + v13);
      if ( qword_40FC00 < (unsigned __int64)v9 )
      {
        do
        {
          while ( 1 )
          {
            v11 = *v7;
            if ( *v7 != 10 )
              break;
            v12 = v9;
            --v7;
            --v8;
            v8[1] = (__int64)(v9-- + 1);
            *v12 = v7[1];
            if ( v7 >= v9 )
              goto LABEL_22;
          }
          v10 = v9;
          if ( v11 == 11 )
          {
            *v7 = 10;
            *v9 = 49;
            v10 = v9 - 1;
            --v8;
            v8[1] = (__int64)v9;
            v11 = *v7;
          }
          --v7;
          v9 = v10 - 1;
          *v10 = v11;
        }
        while ( v7 < v10 - 1 );
      }
LABEL_22:
      _InterlockedExchange(&v13, 0);
    }
    write(1, format, qword_40FC00 - (_QWORD)format);
  }
}
// 401070: using guessed type __int64 __fastcall GOMP_parallel(_QWORD, _QWORD, _QWORD, _QWORD);
// 404080: using guessed type __int64 nl[];
// 40FC00: using guessed type __int64 qword_40FC00;

//----- (0000000000401350) ----------------------------------------------------
__int64 __fastcall main__omp_fn_0(volatile signed __int32 **a1)
{
  int num_threads; // ebp
  int thread_num; // esi
  int v4; // eax
  int v5; // edx
  __int64 v6; // rsi
  __int64 result; // rax
  __int64 v8; // rdi
  _BYTE *v9; // rcx
  char v10; // dl
  char v11; // di

  num_threads = omp_get_num_threads();
  thread_num = omp_get_thread_num();
  v5 = 6000 % num_threads;
  v4 = 6000 / num_threads;
  if ( thread_num < 6000 % num_threads )
  {
    ++v4;
    v5 = 0;
  }
  LODWORD(v6) = v5 + v4 * thread_num;
  result = (unsigned int)(v6 + v4);
  if ( (int)v6 < (int)result )
  {
    v6 = (int)v6;
    do
    {
      v8 = qword_404088[v6];
      if ( *(_BYTE *)(v8 - 2) != 122 )
      {
        v9 = (_BYTE *)(v8 - 5);
        v10 = *(_BYTE *)(v8 - 5) + 6;
        *(_BYTE *)(v8 - 5) = v10;
        if ( v10 > 57 )
        {
          do
          {
            v11 = *--v9;
            v9[1] = v10 - 10;
            v10 = v11 + 1;
            *v9 = v11 + 1;
          }
          while ( (char)(v11 + 1) > 57 );
        }
        if ( nl[v6] > (unsigned __int64)v9 )
          _InterlockedIncrement(*a1);
      }
      ++v6;
    }
    while ( (int)result > (int)v6 );
  }
  return result;
}
// 401040: using guessed type __int64 omp_get_thread_num(void);
// 401050: using guessed type __int64 omp_get_num_threads(void);
// 404080: using guessed type __int64 nl[];
// 404088: using guessed type __int64 qword_404088[5999];

// nfuncs=25 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
