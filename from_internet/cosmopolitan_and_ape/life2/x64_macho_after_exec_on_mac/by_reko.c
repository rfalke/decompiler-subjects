// subject_DATA_bss.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

Eq_305 g_t436000 = // 0000000000436000
	{
		0x1000007FEEDFACF
	};
word32 g_dw436004 = 0x01000007; // 0000000000436004
cu8 g_b436008 = 0x03; // 0000000000436008
byte g_b43603D = 0x00; // 000000000043603D
byte g_b4362B8 = 0x31; // 00000000004362B8
<anonymous> * g_ptr4362D0 = &g_t5C305C32; // 00000000004362D0
uint64 g_a4362E8[30] = // 00000000004362E8
	{
		0x30305C3030315C32,
		0x30305C3030305C30,
		0x30305C3030305C30,
		0x31305C3031325C30,
		0x30305C3030305C32,
		0x30305C3030305C30,
		0x30305C3030305C30,
		0x30305C3030305C30,
		0x30305C3030305C30,
		0x30305C3030305C30,
		0x30305C3030305C30,
		0x5C305C305C305C30,
		0x5C305C3030315C30,
		0x30305C305C303730,
		0x5C305C3030305C34,
		0x30305C3030305C30,
		0x30305C3030305C30,
		0x650A37263E202730,
		0x2D263C3720636578,
		0x636578650A69660A,
		0x2422202230242220,
		0xA3F243D520A2240,
		0x5224205B2066690A,
		0x3632312071652D20,
		0x205B202626205D20,
		7308604897332044834,
		0x3D212022296D2D20,
		2320539490562111520,
		751649687116725085,
		0x2824223D51206669,
	};
word64 g_qw4363D8 = 2334111871611531107; // 00000000004363D8
word32 g_dw436750 = 0xCF8780E5; // 0000000000436750
ui64 g_qw4367A0 = 0xECE800C7E8097200; // 00000000004367A0
word64 g_qw4367A8 = 0xE844AAB80227E800; // 00000000004367A8
uint64 g_qw4367B0 = 0x25589CE58955FE0C; // 00000000004367B0
word64 g_qw4367B8 = 0x58669C664D757000; // 00000000004367B8
word64 g_qw4367C0 = 0x200000BB66C18966; // 00000000004367C0
word32 g_dw4367C8 = 0xD8316600; // 00000000004367C8
struct Eq_240 * g_ptr4367E0 = &g_tBF66; // 00000000004367E0
word32 g_dw437DE0 = 0x415641E5; // 0000000000437DE0
word32 g_dw437DE8 = 3677423478; // 0000000000437DE8
word64 g_qw437DF0 = 0xFC894928478B4800; // 0000000000437DF0
word32 g_dw437E08 = ~0x24CEF888; // 0000000000437E08
word32 g_dw437E20 = 225638457; // 0000000000437E20
word32 g_dw437E38 = 76276085; // 0000000000437E38
up32 g_dw437FA8 = 0x48104F8B; // 0000000000437FA8
ui32 g_dw437FB4 = 0x478B4844; // 0000000000437FB4
// subject_DATA_data_0000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * g_ptr405008 = null; // 0000000000405008
uint64 g_a405010[] = // 0000000000405010
	{
	};
<anonymous> * g_ptr405030 = &g_t4B20; // 0000000000405030
<anonymous> * g_ptr405078 = &g_t4BE4; // 0000000000405078
<anonymous> * g_ptr405080 = &g_t4BF4; // 0000000000405080
// subject_TEXT_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0000000000401000: void fn0000000000401000(Register (ptr64 Eq_2) rbp)
// Called from:
//      fn0000000000403CBB
void fn0000000000401000(struct Eq_2 * rbp)
{
}

// 0000000000401158: Register word64 fn0000000000401158(Register (ptr64 ui64) rcx, Register ui64 rdx, Register word32 esi, Register uint64 rdi)
// Called from:
//      fn0000000000401000
word64 fn0000000000401158(ui64 * rcx, ui64 rdx, word32 esi, uint64 rdi)
{
	Eq_153 ecx_69 = 0x27;
	while (true)
	{
		esi = (word32) (uint64) (esi - 0x01);
		uint64 rax_17 = (uint64) ((word32) (rdi >> (byte) ecx_69) & 0x01FF);
		if (esi == ~0x00)
			break;
		ui64 * rdx_22 = rdx + rax_17 * 0x08;
		if (*rdx_22 == 0x00)
		{
			ui64 rax_27 = *rcx;
			*rcx = rax_27 - 0x1000;
			*rdx_22 = rax_27 - 0x1000 | 0x03;
		}
		ecx_69.u0 = (uint64) (ecx_69 - 0x09);
		rdx = *rdx_22 & 0x3FFFFFFFFF000;
	}
	return rdx + rax_17 * 0x08;
}

// 000000000040129E: void fn000000000040129E(Stack word32 dwArg00)
void fn000000000040129E(word32 dwArg00)
{
	g_b4362B8 = 0x08;
	word64 * rdi_10 = g_a405010;
	uint64 rcx_123;
	for (rcx_123 = 0x14; rcx_123 != 0x00; --rcx_123)
	{
		*rdi_10 = 4199021;
		++rdi_10;
	}
	uint64 rcx_24 = 0xFFFFFFFF;
	word64 * rdi_135 = fp + 0x18;
	while (rcx_24 != 0x00)
	{
		++rdi_135;
		--rcx_24;
		if (*rdi_135 != 0x00)
			break;
	}
	__align(fp);
	struct Eq_240 * r13_100 = fn00000000004012F0(0x00400000, fp + 0x08, rdi_135);
	g_dw437FB4 |= 0x01;
	ptr64 rsp_116 = <invalid>;
	<anonymous> ** rax_117 = &g_ptr405008;
	<anonymous> ** rcx_113 = &g_ptr405008;
	while (rcx_113 != rax_117)
	{
		struct Eq_274 * rsp_94 = rsp_116 - 8;
		rsp_94->ptr0000 = rax_117;
		rsp_94->ptrFFFFFFF8 = rcx_113;
		struct Eq_283 * rsp_98;
		(*rax_117)();
		rcx_113 = rsp_98->ptr0000;
		rsp_116 = &rsp_98->qw0008 + 1;
		rax_117 = rsp_98->qw0008 + 0x08;
	}
	fn000000000040153D((word32) (uint64) (word32) (uint64) fn0000000000401460(), r13_100);
}

// 00000000004012F0: Register (ptr64 word64) fn00000000004012F0(Register Eq_243 ebx, Register (ptr64 word64) r13, Register (ptr64 word64) r15)
// Called from:
//      fn000000000040129E
word64 * fn00000000004012F0(Eq_243 ebx, word64 * r13, word64 * r15)
{
	Eq_298 ebx_331 = (word32) rbx;
	word64 edx_eax_11 = __rdtsc();
	Eq_305 eax_12 = (word32) edx_eax_11;
	g_t436000 = eax_12;
	g_dw436004 = SLICE(edx_eax_11, word32, 32);
	Eq_305 edx_17 = eax_12;
	struct Eq_313 * rdi_20 = &g_b436008;
	struct Eq_315 * rsp_334 = fp - 44;
	Eq_298 eax_41 = 0x00;
l000000000040131D:
	__cpuid(eax_41, 0x00, &eax_41, &ebx_331, &0x00, &edx_17);
	rdi_20->qw0000 = (word64) eax_41;
	struct Eq_439 * rdi_54 = (char *) &rdi_20->qw0000 + 4;
	rdi_54->t0000 = ebx_331;
	rdi_54->dw0004 = 0x00;
	rdi_54->t0008 = edx_17;
	ebx_331 = eax_41;
	edx_17.u1 = 0x00;
	rdi_20 = (struct Eq_313 *) ((char *) &rdi_54->t0008 + 4);
	while (true)
	{
		word64 rax_72 = rsp_334->t0000;
		eax_41 = (word32) rax_72;
		cu8 al_325 = (byte) rax_72;
		++rsp_334;
		if (eax_41 == 0x00)
			break;
		if (al_325 <= g_b436008)
			goto l000000000040131D;
		++rdi_20;
	}
	byte * rsi_162;
	word64 rbx_78 = rsp_334->t0000;
	rdi_20->qw0000 = r15;
	struct Eq_329 * rdi_91;
	union Eq_330 * rsi_92;
	Eq_331 rbx_89 = fn00000000004014BA(rbx_78, fp - 8, 0x00404D28, &rdi_20->qw0000 + 1, out rsi_92, out rdi_91);
	rdi_91->qw0000 = ~0x00;
	rdi_91->qw0008 = ~0x00;
	rdi_91->qw0010 = 4212270;
	rsp_334->dw0004 = 0x20;
	word64 * rdi_118;
	union Eq_330 * rsi_119 = fn000000000040150F(rsp_334->dw0004, 0x00404434, rsi_92, &rdi_91->qw0010 + 1, out rdi_118);
	rsp_334[1] = (struct Eq_315) 0x20;
	struct Eq_385 * rdi_136;
	union Eq_330 * rsi_137 = fn000000000040150F(rsp_334[1], 4212092, rsi_119, rdi_118, out rdi_136);
	rdi_136->qw0000 = *r13;
	rdi_136->qw0008 = 0x00404690;
	rsp_334[1] = (struct Eq_315) rbx_89;
	rsp_334->t0000 = rsi_137;
	if ((rdi_136->t0010 & 0x08) == 0x00)
	{
		if ((rdi_136->t0010 & 0x20) == 0x00)
		{
			if ((rdi_136->t0010 & 0x04) == 0x00)
			{
				if (*r15 != 0x00)
				{
					rsp_334->dwFFFFFFFC = 0x00;
					rsp_334->dwFFFFFFF8 = 0x01;
					rsi_162 = &g_b404DA2;
				}
				else
				{
					rsp_334->dwFFFFFFFC = 0x2A;
					rsp_334->dwFFFFFFF8 = 0x10;
					rsi_162 = &g_b404DC9;
				}
			}
			else
			{
				rsp_334->dwFFFFFFFC = 0x22;
				rsp_334->dwFFFFFFF8 = 0x04;
				rsi_162 = &g_b404DF1;
			}
		}
		else
		{
			rsp_334->dwFFFFFFFC = 0x30;
			rsp_334->dwFFFFFFF8 = 0x20;
			rsi_162 = &g_b404D79;
		}
	}
	else
	{
		rsp_334->dwFFFFFFFC = 0x45;
		rsp_334->dwFFFFFFF8 = 0x08;
		rsi_162 = &g_b404E30;
	}
	rdi_136->t0010 = rsp_334->t0000;
	word32 * rsp_200 = rsp_334 + 1;
	word64 rax_204 = *rsp_200;
	rdi_136->qw0018 = rax_204 + 0x00404310;
	*rsp_200 = (word32) (&rdi_136->qw0018 + 1);
	word56 rax_56_8_353 = SLICE(rax_204 + 0x00404310, word56, 8);
	word64 * rdi_212;
	for (rdi_212 = g_a4362E8; rdi_212 < &g_qw4363D8; ++rdi_212)
	{
		uint64 rdx_277 = 0x00;
		Eq_578 ecx_371 = 0x00;
		do
		{
			ecx_371.u0 = (uint64) ((word64) ecx_371 + 7);
			ci8 al_283 = *rsi_162;
			++rsi_162;
			byte cl_308 = (byte) ecx_371;
			rdx_277 |= (uint64) ((word32) SEQ(rax_56_8_353, al_283) & 0x7F) << (byte) ecx_371;
		} while (al_283 < 0x00);
		if ((al_283 & 0x40) != 0x00)
			rdx_277 |= ~0x00 << cl_308;
		uint64 rax_314 = rdx_277;
		if (*rdi_212 != 0x00)
			rax_314 = *rdi_212;
		*rdi_212 = rax_314;
		rax_56_8_353 = SLICE(rax_314, word56, 8);
	}
	struct Eq_556 * rdi_239;
	word64 r15_246;
	word64 * r13_247;
	g_ptr405080();
	rdi_239->qw0000 = 0x00403817;
	fn0000000000401466();
	rdi_239->qw0008 = 0x00403312;
	rdi_239->qw0010 = 0x00403C02;
	return r13_247;
}

// 0000000000401460: Register word32 fn0000000000401460()
// Called from:
//      fn000000000040129E
word32 fn0000000000401460()
{
	return 0x2A;
}

// 0000000000401466: Register word64 fn0000000000401466()
// Called from:
//      fn00000000004012F0
word64 fn0000000000401466()
{
	return fn0000000000403CBB();
}

// 00000000004014BA: Register word64 fn00000000004014BA(Register word64 rbx, Register Eq_335 ebp, Register uint64 rsi, Register ptr64 rdi, Register out ptr64 rsiOut, Register out ptr64 rdiOut)
// Called from:
//      fn000000000040129E
//      fn00000000004012F0
word64 fn00000000004014BA(word64 rbx, Eq_335 ebp, uint64 rsi, ptr64 rdi, ptr64 & rsiOut, ptr64 & rdiOut)
{
	<anonymous> * rbp_24 = g_ptr405078;
	g_dw437DE0 = 0x03;
	g_qw437DF0 = 4423160;
	g_dw437DE8 = 0x10;
	g_dw437E08 = 0x01;
	g_dw437E20 = 0x01;
	g_dw437E38 = 0x01;
	word64 qwLoc48_98 = SEQ(dwLoc44, 0x01);
	struct Eq_656 * rsp_42;
	<anonymous> * rbp_43;
	word64 rdi_45;
	word64 rsi_46;
	struct Eq_660 * rbx_47;
	word64 rax_48;
	rbp_24();
	rsp_42->tFFFFFFFC.u1 = ~0x0A;
	Eq_662 rcx_52 = rsp_42->tFFFFFFFC;
	rbx_47->qw0018 = rax_48;
	struct Eq_673 * rsp_55;
	<anonymous> * rbp_56;
	word64 rdi_58;
	word64 rsi_59;
	struct Eq_677 * rbx_60;
	word64 rax_61;
	rbp_43();
	rsp_55->tFFFFFFFC.u1 = ~0x0B;
	Eq_679 rcx_65 = rsp_55->tFFFFFFFC;
	rbx_60->qw0030 = rax_61;
	struct Eq_690 * rbx_73;
	word64 rax_74;
	rbp_56();
	rbx_73->qw0048 = rax_74;
	rsiOut = SEQ((word32) rsi, SLICE(rbx, word32, 32));
	rdiOut = SEQ((word32) rdi, SLICE(rsi, word32, 32));
	return SEQ((word32) rbx, dwLoc20);
}

// 000000000040150F: Register (ptr64 Eq_330) fn000000000040150F(Register word32 ecx, Register uint64 rdx, Register (ptr64 Eq_330) rsi, Register (ptr64 word64) rdi, Register out ptr64 rdiOut)
// Called from:
//      fn00000000004012F0
union Eq_330 * fn000000000040150F(word32 ecx, uint64 rdx, union Eq_330 * rsi, word64 * rdi, ptr64 & rdiOut)
{
	int8 r8b_4 = (int8) Z;
	do
	{
		*rdi = (uint64) *rsi + rdx;
		rsi = (union Eq_330 *) ((char *) rsi + 1);
		++rdi;
		ecx = (word32) (uint64) (ecx - 0x01);
	} while (ecx != 0x00);
	*rdi = (uint64) *((char *) rsi + (uint64) ((int8) ((g_b43603D & 0x02) != 0x00) | r8b_4 << 0x01)) + rdx;
	rdiOut = rdi + 1;
	return (char *) rsi + 8;
}

// 000000000040153D: void fn000000000040153D(Register word32 edi, Register (ptr64 Eq_240) r13)
// Called from:
//      fn000000000040129E
void fn000000000040153D(word32 edi, struct Eq_240 * r13)
{
	fn00000000004041E6(0x00, r13);
	fn00000000004046C1((byte) (uint64) (word32) (uint64) edi);
}

// 0000000000401ACC: void fn0000000000401ACC()
// Called from:
//      fn00000000004041E6
void fn0000000000401ACC()
{
	g_ptr4362D0();
}

// 0000000000403CBB: Register ptr64 fn0000000000403CBB()
// Called from:
//      fn0000000000401466
ptr64 fn0000000000403CBB()
{
	if (g_qw4367A0 == 0x00)
	{
		up32 eax_10 = 0x00010000;
		if (g_dw437FA8 >= 0x00010000)
			eax_10 = g_dw437FA8;
		uint64 rax_14 = (uint64) eax_10;
		if ((rax_14 - 0x01 & rax_14) != 0x00)
		{
			fn0000000000401000(fp - 8);
			rbp = fp - 8;
		}
		g_qw4367B0 = rax_14;
		Eq_305 rax_27 = g_t436000;
		g_qw4367A8 = 0x1000;
		g_qw4367B8 = 0x00040000;
		g_qw4367C0 = 0x00A00000;
		g_dw4367C8 = 0x05;
		g_dw436750 = 0x05;
		g_qw4367A0 = rax_27 & ~0x07 | 0x08;
	}
	return rbp;
}

// 00000000004041E6: void fn00000000004041E6(Register uint64 rdi, Register (ptr64 Eq_240) r13)
// Called from:
//      fn000000000040153D
void fn00000000004041E6(uint64 rdi, struct Eq_240 * r13)
{
	ptr64 rbp_110 = fp - 8;
	uint64 r12_127 = rdi;
	word64 rbx_129 = 0x01;
	while (true)
	{
		struct Eq_240 * rdi_24 = g_ptr4367E0;
		if (rdi_24 == null)
			break;
l0000000000404204:
		uint64 rax_31 = (uint64) rdi_24->dw0000;
		do
		{
			word32 ebx_73 = (word32) rbx_129;
			word32 eax_71 = (word32) rax_31;
			if (rax_31 == 0x00)
			{
				r13 = rdi_24->ptr0008;
				if (r12_127 != 0x00)
				{
					if (r13 == null)
						return;
					rdi_24 = r13;
					goto l0000000000404204;
				}
				else
					fn0000000000401ACC();
			}
			word32 ecx_72 = __bsf(eax_71);
			uint64 rdx_84 = (uint64) ~(word32) (uint64) ((word32) (uint64) ebx_73 << (byte) ecx_72);
			Eq_848 rcx_81 = (uint64) ecx_72;
			ui32 edx_97 = (word32) rdx_84;
			rax_31 &= rdx_84;
			if (r12_127 != 0x00 && ((rdi_24->a0020))[rcx_81].qw0000 != r12_127)
				continue;
			rdi_24->dw0000 &= edx_97;
			struct Eq_862 * rcx_101 = rdi_24 + (rcx_81 *s 0x18) /64 32;
			<anonymous> * rdx_102 = rcx_101->ptr0010;
		} while (rdx_102 == null);
		word64 rcx_132;
		word64 rsi_133;
		rdx_102();
	}
}

// 00000000004046C1: void fn00000000004046C1(Register byte dil)
// Called from:
//      fn0000000000401000
//      fn000000000040153D
void fn00000000004046C1(byte dil)
{
	g_dw437FB4 |= 0x04;
	if ((g_b4362B8 & 0x04) == 0x00)
	{
		__syscall();
		__cli();
		__lidt(g_n4046F2);
		__hlt();
	}
	else
	{
		while (true)
			g_ptr405030();
	}
}

word48 g_n4046F2 = ;
byte g_b404D79 = 0x9C; // 0000000000404D79
byte g_b404DA2 = 0x9C; // 0000000000404DA2
byte g_b404DC9 = 0x9C; // 0000000000404DC9
byte g_b404DF1 = 0x9C; // 0000000000404DF1
byte g_b404E30 = 0x7E; // 0000000000404E30
