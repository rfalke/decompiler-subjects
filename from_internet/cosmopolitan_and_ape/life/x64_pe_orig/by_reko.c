// subject_data.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * g_a402008[] = // 0000000000402008
	{
	};
<anonymous> * __imp__ExitProcess = &g_t1DE8; // 0000000000402010
<anonymous> * __imp__FreeEnvironmentStringsW = &g_t1DF6; // 0000000000402018
<anonymous> * __imp__GetCommandLineW = &g_t1E10; // 0000000000402020
<anonymous> * __imp__GetEnvironmentStringsW = &g_t1E22; // 0000000000402028
<anonymous> * __imp__GetStdHandle = &g_t1E3C; // 0000000000402030
<anonymous> * __imp__SetDefaultDllDirectories = &g_t1E4C; // 0000000000402038
<anonymous> * __imp__WriteFile = &g_t1E68; // 0000000000402040
Eq_4 g_t403000 = // 0000000000403000
	{
		0x00
	};
word64 g_qw403008 = 0x00; // 0000000000403008
uint64 g_a403018[3] = // 0000000000403018
	{
		0x00,
		0x00,
		0x00,
	};
word64 g_qw403030 = 0x00; // 0000000000403030
struct Eq_602 * g_ptr403040 = null; // 0000000000403040
ui32 g_dw40335C = 0x00; // 000000000040335C
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0000000000401297: void fn0000000000401297(Register Eq_2 r15)
// Called from:
//      Win32CrtStartup
void fn0000000000401297(Eq_2 r15)
{
	byte * rsi_105;
	Eq_4 qwLoc20_184;
	if ((g_t403000 & 0x08) == 0x00)
	{
		if ((g_t403000 & 0x20) == 0x00)
		{
			if ((g_t403000 & 0x04) == 0x00)
			{
				if (*r15 != 0x00)
				{
					rsi_105 = &g_b401EED;
					qwLoc20_184.u1 = 0x01;
				}
				else
				{
					rsi_105 = &g_b401EF1;
					qwLoc20_184.u1 = 0x2A00000010;
				}
			}
			else
			{
				rsi_105 = &g_b401EF5;
				qwLoc20_184.u1 = 0x2200000004;
			}
		}
		else
		{
			rsi_105 = &g_b401EE9;
			qwLoc20_184.u1 = 0x3000000020;
		}
	}
	else
	{
		rsi_105 = &g_b401EF8;
		qwLoc20_184.u1 = 0x4500000008;
	}
	g_t403000 = qwLoc20_184;
	g_qw403008 = 0x00803885;
	word64 * rdi_148 = g_a403018;
	uint64 rax_138 = 0x00803885;
	while (true)
	{
		word56 rax_56_8_163 = SLICE(rax_138, word56, 8);
		if (rdi_148 >= &g_qw403030)
			break;
		uint64 rdx_101 = 0x00;
		Eq_49 ecx_225 = 0x00;
		do
		{
			ecx_225.u0 = (uint64) ((word64) ecx_225 + 7);
			ci8 al_107 = *rsi_105;
			++rsi_105;
			byte cl_132 = (byte) ecx_225;
			rdx_101 |= (uint64) ((word32) SEQ(rax_56_8_163, al_107) & 0x7F) << (byte) ecx_225;
		} while (al_107 < 0x00);
		if ((al_107 & 0x40) != 0x00)
			rdx_101 |= ~0x00 << cl_132;
		rax_138 = rdx_101;
		if (*rdi_148 != 0x00)
			rax_138 = *rdi_148;
		*rdi_148 = rax_138;
		++rdi_148;
	}
}

// 000000000040134D: Register word32 fn000000000040134D()
// Called from:
//      Win32CrtStartup
word32 fn000000000040134D()
{
	return 0x2A;
}

// 000000000040139B: void fn000000000040139B(Register Eq_98 rdx, Register word32 edi)
// Called from:
//      Win32CrtStartup
void fn000000000040139B(Eq_98 rdx, word32 edi)
{
	fn0000000000401907(rdx, 0x00);
	fn0000000000401AA1((byte) edi);
}

// 00000000004013C5: Register Eq_111 Win32CrtStartup()
Eq_111 Win32CrtStartup()
{
	word64 rax_31;
	KernelBase.dll!SetDefaultDllDirectories();
	if ((word32) rax_31 != 0x00)
	{
		g_t403000.u2 = 0x04;
		GetCommandLineW();
		Eq_124 rax_64 = SEQ(dwLocE078, GetEnvironmentStringsW());
		fn000000000040165C((word64) fp - 53304, 0x3FFF, (word64) fp - 0x0000C037, 0x0200);
		uint64 rax_356 = 0x00;
		while (true)
		{
			byte * rcx_90 = qwLocD038 + rax_356;
			byte dl_91 = *rcx_90;
			if (dl_91 == 0x00)
				break;
			if (dl_91 == 0x5C)
				*rcx_90 = 0x2F;
			++rax_356;
		}
		word32 eax_112;
		uint64 rax_97 = (uint64) *rax_64;
		up32 eax_108 = (word32) rax_97;
		if ((word16) rax_97 <= 55295)
		{
			dwLocE04C = eax_108;
			eax_112 = 0x01;
		}
		else
			eax_112 = fn00000000004019FA((word64) fp - 0x0000E04C, rax_64);
		word64 rcx_118 = fp + ~0x8037;
		uint64 r8_123 = 0x00;
		Eq_124 rdx_125 = (word64) rax_64 + (uint64) eax_112 * 0x02;
		while (dwLocE04C != 0x00)
		{
			++r8_123;
			if (r8_123 <= 0x01FF)
			{
				Eq_132 rax_254 = 0x00;
				if (rcx_118 < fp - (struct Eq_854 *) 0x3A)
					rax_254 = rcx_118;
				*((word64) fp + (r8_123 * 0x08 - 0x0000E040)) = rax_254;
			}
			do
			{
				Eq_225 rax_267 = (int64) dwLocE04C_513;
				if (dwLocE04C_513 > 0x7F)
					rax_267 = fn0000000000401A09(rcx_118, dwLocE04C_513);
				do
				{
					byte al_284 = (byte) rax_512;
					if (rcx_118 >= fp - (struct Eq_854 *) 0x3A)
						break;
					++rcx_118;
					*((word64) rcx_118 - 1) = al_284;
					rax_267 = rax_512 >> 0x08;
					rax_512 = rax_267;
				} while (rax_512 >> 0x08 != 0x00);
				word32 eax_316;
				uint64 rax_297 = (uint64) *rdx_125;
				up32 eax_310 = (word32) rax_297;
				if ((word16) rax_297 <= 55295)
				{
					dwLocE04C = eax_310;
					eax_316 = 0x01;
				}
				else
					eax_316 = fn00000000004019FA(fp + ~0xE04B, rdx_125);
				rdx_125 = (word64) rdx_125 + (uint64) eax_316 * 0x02;
				dwLocE04C_513 = dwLocE04C;
			} while (dwLocE04C_513 != 0x00);
			word64 rax_338 = rcx_118 - (fp + ~0x8037);
			if (rax_338 > 0x7FFD)
				&rax_338.u0->t0000 = 0x7FFD;
			Mem351[fp + ~0x8037 + rax_338:byte] = 0x00;
		}
		if (rcx_118 < fp - 0x3A)
		{
			*rcx_118 = 0x00;
			++rcx_118;
		}
		word64 rcx_148 = rcx_118 - (fp + ~0x8037);
		if (rcx_148 > (struct Eq_239 *) 0x7FFE)
			rcx_148 = (struct Eq_239 *) 0x7FFE;
		if (r8_123 > 0x01FF)
			r8_123 = 0x01FF;
		Mem169[fp + ~0x8037 + rcx_148:byte] = 0x00;
		*((word64) fp + (r8_123 * 0x08 - 57400)) = 0x00;
		FreeEnvironmentStringsW(rax_64);
		__align(fp - 0xE074);
		fn0000000000401297(fp + ~0xE047);
		g_dw40335C |= 0x01;
		<anonymous> ** rax_209 = g_a402008;
		while (rax_209 != g_a402008)
		{
			(*rax_209)();
			rax_209 = (<anonymous> **) ((char *) rax_209 + 8);
		}
		fn000000000040139B(fp + ~0xE037, fn000000000040134D());
	}
	else
	{
		WriteFile(GetStdHandle(~0x0B), &g_v401AE1, 0x06, (word64) fp - 0x00008038, SEQ(dwLocE060, 0x00));
		ExitProcess(0x01);
	}
}

// 0000000000401601: void fn0000000000401601(Register (ptr64 Eq_358) rdi)
// Called from:
//      fn000000000040165C
void fn0000000000401601(struct Eq_358 * rdi)
{
	word32 eax_22;
	Eq_124 rdi_6 = rdi->t0000;
	uint64 rax_8 = (uint64) *rdi_6;
	word32 eax_18 = (word32) rax_8;
	if ((word16) rax_8 <= 55295)
	{
		rdi->dw0018 = eax_18;
		eax_22 = 0x01;
	}
	else
		eax_22 = fn00000000004019FA(&rdi->dw0018, rdi_6);
	rdi->t0000 = (word64) rdi->t0000 + (uint64) eax_22 * 0x02;
}

// 000000000040162C: Register Eq_132 fn000000000040162C(Register Eq_132 rcx, Register up32 esi, Register (ptr64 Eq_394) rdi)
// Called from:
//      fn000000000040165C
Eq_132 fn000000000040162C(Eq_132 rcx, up32 esi, struct Eq_394 * rdi)
{
	up32 esi = (word32) rsi;
	Eq_132 r8_10 = rdi->t0010;
	Eq_225 rax_11 = (int64) esi;
	if (esi > 0x7F)
		rax_11 = fn0000000000401A09(rcx, esi);
	do
	{
		byte al_29 = (byte) rax_69;
		Eq_132 rcx_23 = rdi->t0008;
		if (r8_10 <= rcx_23)
			return rcx_23;
		rdi->t0008 = (word64) rcx_23 + 1;
		*rcx_23 = al_29;
		rax_11 = rax_69 >> 0x08;
		rax_69 = rax_11;
	} while (rax_69 >> 0x08 != 0x00);
	return rcx_23;
}

// 000000000040165C: void fn000000000040165C(Register Eq_132 rcx, Register uint64 rdx, Register Eq_134 rsi, Register uint64 r8)
// Called from:
//      Win32CrtStartup
void fn000000000040165C(Eq_132 rcx, uint64 rdx, Eq_134 rsi, uint64 r8)
{
	fn0000000000401601(fp - 88);
	Eq_134 rax_8 = (word64) rsi.u1 + rdx;
	uint64 rbx_115 = 0x00;
	rcx_234 = rcx;
l00000000004016A3:
	Eq_132 rcx_234;
	if (dwLoc40 != 0x00)
	{
		while (true)
		{
			uint64 rax_57 = (uint64) dwLoc40;
			up32 eax_58 = (word32) rax_57;
			if (eax_58 == 0x00)
				break;
			if (eax_58 > 0x20 || __bt(0x100002600, rax_57))
			{
				++rbx_115;
				if (rbx_115 < r8)
				{
					Eq_134 rax_160 = rsi;
					if (rsi >= rax_8)
						rax_160.u0 = 0x00;
					(rcx - 0x08)[rbx_115] = rax_160;
				}
				Eq_478 r14b_187 = 0x00;
				while (true)
				{
					uint64 rsi_182 = (uint64) dwLoc40;
					up32 esi_183 = (word32) rsi_182;
					if (esi_183 == 0x00)
						break;
					if (r14b_187 == 0x00 && esi_183 <= 0x20)
					{
						if (!__bt(0x100002600, rsi_182))
							break;
					}
					else if (esi_183 == 0x22 || esi_183 == 0x5C)
					{
						uint64 r12_199 = 0x00;
						while (true)
						{
							byte r12b_495 = (byte) r12_199;
							if (dwLoc40 != 0x5C)
								break;
							fn0000000000401601(fp - 88);
							++r12_199;
						}
						uint64 r10_208 = 0x00;
						while (dwLoc40 == 0x22)
						{
							fn0000000000401601(fp - 88);
							++r10_208;
						}
						uint64 rax_220 = r12_199;
						if (r10_208 != 0x00)
						{
							for (; rax_220 > 0x01; rax_220 -= 0x02)
								rcx_234 = fn000000000040162C(rcx_234, 0x5C, fp - 88);
							if ((r12b_495 & 0x01) != 0x00)
							{
								rcx_234 = fn000000000040162C(rcx_234, 0x22, fp - 88);
								--r10_208;
								if (r10_208 == 0x00)
									continue;
							}
							uint64 r14_253;
							uint64 r10_256 = r10_208 - (word64) (r14b_187 < 0x01);
							for (r14_253 = 0x03; r10_256 + 0x01 >= r14_253; r14_253 += 0x03)
								rcx_234 = fn000000000040162C(rcx_234, 0x22, fp - 88);
							&rcx_234.u0->t0000 = 0x03;
							r14b_187.u0 = (int8) ((uint64) ((uint128) r10_256 % 0x03) == 0x00);
							continue;
						}
						else
						{
							while (true)
							{
								--r12_199;
								if (r12_199 == ~0x00)
									break;
								rcx_234 = fn000000000040162C(rcx_234, 0x5C, fp - 88);
							}
							continue;
						}
					}
					rcx_234 = fn000000000040162C(rcx_234, (word32) rsi_182, fp - 88);
					fn0000000000401601(fp - 88);
				}
				rcx_234 = fn000000000040162C(rcx_234, 0x00, fp - 88);
				goto l00000000004016A3;
			}
			fn0000000000401601(fp - 88);
		}
	}
	fn000000000040162C(rcx_234, 0x00, fp - 88);
	if (rdx != 0x00)
	{
		Eq_469 rax_100 = 0x00;
		if (rdx < 0x01)
			rax_100 = rdx - 0x01;
		Mem103[rsi + rax_100:byte] = 0x00;
	}
	if (r8 != 0x00)
	{
		uint64 r8_111 = r8 - 0x01;
		if (r8 - 0x01 > rbx_115)
			r8_111 = rbx_115;
		*((word64) rcx + r8_111 * 0x08) = 0x00;
	}
}

// 0000000000401907: void fn0000000000401907(Register Eq_98 rdx, Register uint64 rdi)
// Called from:
//      fn000000000040139B
void fn0000000000401907(Eq_98 rdx, uint64 rdi)
{
	while (true)
	{
l000000000040191B:
		struct Eq_602 * rdi_24 = g_ptr403040;
		if (rdi_24 == null)
			break;
l0000000000401928:
		uint64 rax_33 = (uint64) rdi_24->dw0000;
		do
		{
			word32 eax_81 = (word32) rax_33;
			if (rax_33 == 0x00)
			{
				struct Eq_602 * r13_43 = rdi_24->ptr0008;
				if (rdi != 0x00)
				{
					if (r13_43 == null)
						return;
					rdi_24 = r13_43;
					goto l0000000000401928;
				}
				else
				{
					if (r13_43 != null && 0x00 != 0x00)
					{
						word64 rcx_75;
						word64 r8_76;
						fn0000000000000000();
					}
					g_ptr403040 = r13_43;
					goto l000000000040191B;
				}
			}
			word32 ecx_82 = __bsf(eax_81);
			rdx = (uint64) ~(0x01 << (byte) ecx_82);
			Eq_620 rcx_91 = (uint64) ecx_82;
			ui32 edx_107 = (word32) rdx;
			rax_33 &= rdx;
			if (rdi != 0x00 && ((rdi_24->a0020))[rcx_91].qw0000 != rdi)
				continue;
			rdi_24->dw0000 &= edx_107;
			rdx = *((char *) &(rdi_24 + (rcx_91 *s 0x18) /64 32)->ptr0008 + 8);
		} while (rdx == 0x00);
		word64 rcx_127;
		word64 r8_128;
		rdx();
	}
}

// 00000000004019FA: Register word32 fn00000000004019FA(Register Eq_194 rsi, Register Eq_124 rdi)
// Called from:
//      Win32CrtStartup
//      fn0000000000401601
word32 fn00000000004019FA(Eq_194 rsi, Eq_124 rdi)
{
	__align(fp - 8);
	return fn0000000000401A3C(rsi, rdi);
}

// 0000000000401A09: Register ui64 fn0000000000401A09(Register Eq_132 rcx, Register up32 edi)
// Called from:
//      Win32CrtStartup
//      fn000000000040162C
ui64 fn0000000000401A09(Eq_132 rcx, up32 edi)
{
	ui32 rcx_32_32_21 = SLICE(rcx, word32, 32);
	uint64 rdi_11 = (uint64) edi;
	uint32 edi_14 = (word32) rdi_11;
	uint64 rax_13 = 0x00;
	ui8 al_32 = 0x00;
	Eq_697 rax_56_8_35 = 0x00;
	if (edi_14 > 0x7F)
	{
		uint64 rcx_24 = (uint64) g_a401AE9[SEQ(rcx_32_32_21, __bsr(edi_14))];
		byte ch_45 = SLICE(rcx_24, byte, 8);
		byte cl_39 = (byte) rcx_24;
		do
		{
			byte al_34 = al_32 | 0x80 | (byte) edi_14 & 0x3F;
			rdi_11 = (uint64) (edi_14 >> 0x06);
			Eq_697 rax_36 = SEQ(rax_56_8_35, al_34);
			edi_14 = (word32) rdi_11;
			al_32 = al_34 << 0x08;
			rax_56_8_35 = rax_36;
			--cl_39;
		} while (cl_39 != 0x00);
		rax_13 = SEQ(rax_36, al_34 << 0x08 | ch_45);
	}
	return rax_13 | rdi_11;
}

// 0000000000401A3C: Register word32 fn0000000000401A3C(Register Eq_194 rsi, Register Eq_124 rdi)
// Called from:
//      fn00000000004019FA
word32 fn0000000000401A3C(Eq_194 rsi, Eq_124 rdi)
{
	word32 eax_27 = 0x00;
	do
	{
		uint64 rax_115 = (uint64) (eax_27 + 0x01);
		ui32 edx_38 = (word32) *((word64) rdi + (uint64) eax_27 * 0x02);
		uint64 rbx_31 = (uint64) eax_27;
		eax_27 = (word32) rax_115;
		cui16 cx_41 = (word16) edx_38;
	} while ((cx_41 & 0xFC00) == 0xDC00);
	if ((cx_41 & 0xFC00) != 0xD800)
		*rsi = edx_38;
	else
	{
		uint64 rax_48 = (uint64) *((word64) rdi + rax_115 * 0x02);
		if (((word16) (word32) rax_48 & 0xFC00) != 0xDC00)
		{
			*rsi = 0xFFFD;
			rax_115 = 0xFFFFFFFF;
		}
		else
		{
			*rsi = (edx_38 << 0x0A) + 0xFCA02400 + (word32) rax_48;
			rax_115 = (uint64) ((word32) rbx_31 + 0x02);
		}
	}
	return (word32) rax_115;
}

// 0000000000401AA1: void fn0000000000401AA1(Register byte dil)
// Called from:
//      fn000000000040139B
void fn0000000000401AA1(byte dil)
{
	g_dw40335C |= 0x04;
	if ((g_t403000 & 0x04) == 0x00)
	{
		__syscall();
		__cli();
		__lidt(g_n401AD2);
		__hlt();
	}
	else
		ExitProcess((UINT) dil);
}

word48 g_n401AD2 = ;
void g_v401AE1 = ??void??; // 0000000000401AE1
Eq_843 g_a401AE9[] = // 0000000000401AE9
	{
	};
word64 g_qw401EA0 = 7656; // 0000000000401EA0
word64 g_qw401EA8 = 7670; // 0000000000401EA8
word64 g_qw401EB0 = 0x1E10; // 0000000000401EB0
word64 g_qw401EB8 = 0x1E22; // 0000000000401EB8
word64 g_qw401EC0 = 7740; // 0000000000401EC0
word64 g_qw401EC8 = 7756; // 0000000000401EC8
word64 g_qw401ED0 = 7784; // 0000000000401ED0
byte g_b401EE9 = 0x0C; // 0000000000401EE9
byte g_b401EED = 0x0C; // 0000000000401EED
byte g_b401EF1 = 0x0C; // 0000000000401EF1
byte g_b401EF5 = 0x0E; // 0000000000401EF5
byte g_b401EF8 = 0x0C; // 0000000000401EF8
