/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

__int64 __fastcall sub_4010FB(__int64 *, __int64);
__int64 __fastcall sub_4011A5(__int64, __int64 *, __int64, __int64);
__int64 sub_401214();
void sub_401297();
__int64 sub_40141F();
__int64 __fastcall sub_401433(__int64);
__int64 sub_40156C();
__int64 sub_401609();
HANDLE sub_401636();
void __fastcall sub_40168D();
__int64 __fastcall sub_4017BE(int, __int64);
char __fastcall sub_4017EC();
void __fastcall __noreturn sub_4017FD(__int64, __int64);
__int64 sub_401816();
__int64 sub_401826();
__int64 sub_401836();
__int64 sub_401846();
__int64 sub_401856();
void __noreturn start();
__int64 __fastcall sub_401AA3();
unsigned __int64 __fastcall sub_401ACE();
__int64 __fastcall sub_401AFE(__int64, __int64);
__int64 __fastcall sub_401D0B(__int64, __int64);
__int64 __fastcall sub_401DAD();
DWORD __fastcall sub_401DD2();
DWORD sub_401DEB();
__int64 sub_401E0A();
__int64 __fastcall sub_401E45();
__int64 __fastcall sub_401EAA();
__int64 sub_401F6E();
__int64 __fastcall sub_401F76();
_BOOL8 __fastcall sub_401F97();
__int64 __fastcall sub_401FA1();
__int64 __fastcall sub_401FAF(__int64);
__int64 __fastcall sub_402083();
__int64 sub_402150();
__int64 __fastcall sub_40215B(__int64, __int64);
__int64 __fastcall sub_4021F0(__int64, __int64);
__int64 __fastcall sub_402286(__int64, unsigned __int64);
_BOOL8 __fastcall sub_4023CE(__int64);
__int64 __fastcall sub_40243F(__int64, int);
bool __fastcall sub_40245F();
__int64 __fastcall sub_40247A();
__int64 sub_4025B0();
__int64 sub_4025C0();
__int64 __fastcall sub_4025D0(); // weak
__int64 sub_40262D();
__int64 __fastcall sub_40263C();
__int64 __fastcall sub_40266F();
void __fastcall sub_402750(__int64, unsigned __int64);
void __fastcall sub_402764(__int64, unsigned __int64 _RDX);
void __fastcall sub_402870(__int64, unsigned __int64);
void __fastcall sub_40288A(__int64 a1, unsigned __int64 _RDX, __int64 a3, double _XMM3_8);
void __fastcall __noreturn sub_402941();
__int64 sub_40297A();

//-------------------------------------------------------------------------
// Data declarations

char byte_402972[6] = { '\0', '\0', '\0', '\0', '\0', '\0' }; // weak
char byte_4029C3[5] = { '\x01', 'À', '\x01', 'À', '\x01' }; // weak
__int64 (__fastcall *off_403008)() = &sub_401433; // weak
_UNKNOWN unk_403010; // weak
// extern void (__stdcall __noreturn *ExitProcess)(UINT uExitCode);
// extern BOOL (__stdcall *FlushFileBuffers)(HANDLE hFile);
// extern BOOL (__stdcall *FreeEnvironmentStringsW)(LPWCH penv);
// extern LPWSTR (__stdcall *GetCommandLineW)();
// extern LPWCH (__stdcall *GetEnvironmentStringsW)();
// extern DWORD (__stdcall *GetFileType)(HANDLE hFile);
// extern DWORD (__stdcall *GetLastError)();
// extern HANDLE (__stdcall *GetStdHandle)(DWORD nStdHandle);
// extern BOOL (__stdcall *SetDefaultDllDirectories)(DWORD DirectoryFlags);
// extern BOOL (__stdcall *WriteFile)(HANDLE hFile, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite, LPDWORD lpNumberOfBytesWritten, LPOVERLAPPED lpOverlapped);
_BYTE byte_404000[27]; // weak
char byte_404035; // weak
int dword_404630; // weak
__int64 (*qword_404638)(void); // weak
int dword_404648; // weak
__int64 qword_404650; // weak
int dword_404658; // weak
int dword_404660; // weak
int dword_404668; // weak
int dword_404670; // weak
__int64 qword_404678; // weak
__int64 qword_404688; // weak
__int64 qword_406038; // weak
__int64 qword_406040; // weak
__int64 qword_406048; // weak
__int64 qword_406050; // weak
_UNKNOWN unk_406058; // weak
__int64 qword_4060A0; // weak
_UNKNOWN unk_4060A8; // weak
__int64 qword_4063C0[]; // weak
_UNKNOWN unk_4076A0; // weak
__int64 qword_4076B0; // weak
int dword_407838; // weak
int dword_40783C; // weak


//----- (00000000004010FB) ----------------------------------------------------
__int64 __fastcall sub_4010FB(__int64 *a1, __int64 a2)
{
  unsigned __int64 v2; // rdi
  int v3; // esi
  char i; // cl
  __int64 v6; // rax
  __int64 *v8; // rdx
  __int64 v9; // rax

  for ( i = 39; ; i -= 9 )
  {
    --v3;
    v6 = (v2 >> i) & 0x1FF;
    if ( v3 == -1 )
      break;
    v8 = (__int64 *)(a2 + 8 * v6);
    if ( !*v8 )
    {
      v9 = *a1 - 4096;
      *a1 = v9;
      *v8 = v9 | 3;
    }
    a2 = *v8 & 0x3FFFFFFFFF000i64;
  }
  return a2 + 8 * v6;
}
// 401110: variable 'v3' is possibly undefined
// 401112: variable 'v2' is possibly undefined

//----- (00000000004011A5) ----------------------------------------------------
__int64 __fastcall sub_4011A5(__int64 a1, __int64 *a2, __int64 a3, __int64 a4)
{
  unsigned int v4; // er10
  unsigned int v5; // er11
  __int64 v6; // rbx
  __int64 v7; // r13
  __int64 *v8; // r8
  int v9; // er12
  int v10; // er14
  __int64 v11; // rax
  unsigned int v12; // ecx
  __int64 *v13; // rsi
  __int64 *v14; // rdi
  __int64 i; // rcx
  __int64 result; // rax

  do
  {
    v6 = *a2;
    v7 = a2[1];
    v8 = a2;
    v9 = *((_DWORD *)a2 + 4);
    v10 = *((_DWORD *)a2 + 5);
    LODWORD(v11) = v5;
    while ( 1 )
    {
      v12 = v11;
      v11 = (unsigned int)(v11 - 1);
      if ( v6 == *(v8 - 3) )
        break;
      v13 = v8 - 3;
      v14 = v8;
      v8 -= 3;
      for ( i = 6i64; i; --i )
      {
        *(_DWORD *)v14 = *(_DWORD *)v13;
        v13 = (__int64 *)((char *)v13 + 4);
        v14 = (__int64 *)((char *)v14 + 4);
      }
      if ( !(_DWORD)v11 )
        goto LABEL_9;
    }
    v11 = v12;
LABEL_9:
    ++v5;
    a2 += 3;
    result = a4 + 24 * v11;
    *(_QWORD *)result = v6;
    *(_QWORD *)(result + 8) = v7;
    *(_DWORD *)(result + 16) = v9;
    *(_DWORD *)(result + 20) = v10;
  }
  while ( v5 < v4 );
  return result;
}
// 4011C2: variable 'v5' is possibly undefined
// 401209: variable 'v4' is possibly undefined

//----- (0000000000401214) ----------------------------------------------------
__int64 sub_401214()
{
  return 0i64;
}

//----- (0000000000401297) ----------------------------------------------------
void sub_401297()
{
  _DWORD *i; // rdi
  _DWORD *v6; // rdi

  i = byte_404000;
  _RAX = 0i64;
  while ( 1 )
  {
    __asm { cpuid }
    *i = _RAX;
    v6 = i + 1;
    *v6++ = _RBX;
    *v6++ = _RCX;
    *v6 = _RDX;
    for ( i = v6 + 1; ; i += 4 )
    {
      _RAX = 1i64;
      if ( byte_404000[0] )
        break;
    }
  }
}
// 401297: could not find valid save-restore pair for rdi
// 401297: could not find valid save-restore pair for rsi
// 4012CD: conditional instruction was optimized away because %0x10.4==1
// 404000: using guessed type _BYTE byte_404000[27];
// 404630: using guessed type int dword_404630;
// 404688: using guessed type __int64 qword_404688;
// 406038: using guessed type __int64 qword_406038;

//----- (000000000040141F) ----------------------------------------------------
__int64 sub_40141F()
{
  sub_401E0A();
  return 0i64;
}

//----- (0000000000401433) ----------------------------------------------------
__int64 __fastcall sub_401433(__int64 a1)
{
  _BYTE *v1; // r12
  _BYTE *v2; // r13
  __int64 v3; // r12
  __int64 v4; // rbx
  _QWORD *v5; // rdx
  _QWORD *savedregs; // [rsp+8h] [rbp+0h] BYREF

  v1 = (_BYTE *)qword_406038;
  if ( (dword_404630 & 4) != 0 || (unsigned int)sub_40156C() )
    *v1 = 1;
  savedregs = &savedregs;
  v2 = v1;
  if ( !qword_406050 )
  {
    qword_406050 = (__int64)&unk_406058;
    qword_406048 = 8i64;
    sub_40215B(a1, 0i64);
  }
  v3 = qword_406040;
  v4 = qword_406040 - 1;
  while ( v4 != -1 )
  {
    v5 = (_QWORD *)(qword_406050 + 8 * v4--);
    if ( !*(_QWORD *)(qword_406050 + 8 * v4 + 8) )
    {
      *v5 = v2;
      return 0i64;
    }
  }
  if ( qword_406040 + 1 < (unsigned __int64)qword_406048 || (unsigned __int8)sub_402286(1i64, 8ui64) )
  {
    LODWORD(v4) = v3;
    *(_QWORD *)(qword_406050 + 8 * v3) = v2;
    qword_406040 = v3 + 1;
  }
  return (unsigned int)v4;
}
// 4014A2: variable 'a1' is possibly undefined
// 404630: using guessed type int dword_404630;
// 406038: using guessed type __int64 qword_406038;
// 406040: using guessed type __int64 qword_406040;
// 406048: using guessed type __int64 qword_406048;
// 406050: using guessed type __int64 qword_406050;

//----- (000000000040156C) ----------------------------------------------------
__int64 sub_40156C()
{
  unsigned int v0; // er13
  int v1; // ebx
  __int16 v4; // [rsp+28h] [rbp-E8h]

  v0 = dword_404630 & 4;
  if ( (dword_404630 & 4) != 0 )
  {
    v0 = 0;
    if ( sub_40245F() )
      return sub_401DD2() == 2;
  }
  else
  {
    v1 = dword_407838;
    if ( (unsigned int)sub_401609() != -1 )
      return (v4 & 0xF000) == 0x2000;
    dword_407838 = v1;
  }
  return v0;
}
// 4015BE: ignored the value written to the shadow area of the succeeding call
// 4015A5: variable 'v4' is possibly undefined
// 404630: using guessed type int dword_404630;
// 4076B0: using guessed type __int64 qword_4076B0;
// 407838: using guessed type int dword_407838;

//----- (0000000000401609) ----------------------------------------------------
__int64 sub_401609()
{
  __int64 result; // rax
  unsigned int v1; // [rsp+Ch] [rbp-14h]

  result = sub_4025B0();
  if ( (_DWORD)result != -1 )
  {
    sub_40168D();
    return v1;
  }
  return result;
}
// 401623: ignored the value written to the shadow area of the succeeding call
// 40162B: variable 'v1' is possibly undefined

//----- (0000000000401636) ----------------------------------------------------
HANDLE sub_401636()
{
  HANDLE result; // rax

  unk_4076A0 = 3i64;
  *((_QWORD *)&unk_4076A0 + 2) = (char *)&unk_4076A0 + 24;
  *((_QWORD *)&unk_4076A0 + 1) = 16i64;
  *((_DWORD *)&unk_4076A0 + 10) = 1;
  *((_DWORD *)&unk_4076A0 + 16) = 1;
  *((_DWORD *)&unk_4076A0 + 22) = 1;
  *((_QWORD *)&unk_4076A0 + 3) = GetStdHandle(0xFFFFFFF6);
  *((_QWORD *)&unk_4076A0 + 6) = GetStdHandle(0xFFFFFFF5);
  result = GetStdHandle(0xFFFFFFF4);
  *((_QWORD *)&unk_4076A0 + 9) = result;
  return result;
}

//----- (000000000040168D) ----------------------------------------------------
void __fastcall sub_40168D()
{
  int *v0; // rdi
  __int64 v1; // r14
  int v2; // er13
  __int64 v3; // r10
  __int64 v4; // r15
  __int64 v5; // r12
  __int64 v6; // r11
  __int64 v7; // r8
  __int64 v8; // rbx
  __int64 v9; // r9
  __int64 v10; // rsi
  __int64 v11; // rcx
  __int64 v12; // rdx
  __int64 v13; // rax
  __int64 v14; // r11
  __int64 v15; // rbx
  __int64 v16; // r10
  __int64 v17; // r12
  int v18; // er14
  __int64 v19; // r13
  __int64 v20; // r15

  if ( v0 )
  {
    if ( (dword_404630 & 8) != 0 )
    {
      v1 = *((unsigned __int16 *)v0 + 3);
      v2 = *((unsigned __int16 *)v0 + 2);
      v3 = v0[28];
      v4 = *v0;
      v5 = *((_QWORD *)v0 + 2);
      v6 = *((_QWORD *)v0 + 12);
      v7 = *((_QWORD *)v0 + 5);
      *((_QWORD *)v0 + 5) = v0[6];
      v8 = *((_QWORD *)v0 + 13);
      v9 = *((_QWORD *)v0 + 4);
      v10 = *((_QWORD *)v0 + 6);
      v11 = *((_QWORD *)v0 + 7);
      v12 = *((_QWORD *)v0 + 8);
      v13 = *((_QWORD *)v0 + 9);
      *(_QWORD *)v0 = v4;
      *((_QWORD *)v0 + 2) = v1;
      v0[6] = v2;
      *(_QWORD *)(v0 + 7) = v5;
      *((_QWORD *)v0 + 6) = v6;
      *((_QWORD *)v0 + 7) = v3;
      *((_QWORD *)v0 + 8) = v8;
    }
    else
    {
      if ( (dword_404630 & 0x20) != 0 )
      {
        v14 = v0[32];
        v15 = *((_QWORD *)v0 + 14);
        v16 = *((_QWORD *)v0 + 15);
        v9 = *((_QWORD *)v0 + 6);
        v7 = *((_QWORD *)v0 + 7);
        v10 = *((_QWORD *)v0 + 8);
        v11 = *((_QWORD *)v0 + 9);
        v12 = *((_QWORD *)v0 + 10);
        v13 = *((_QWORD *)v0 + 11);
        v0[6] = *((unsigned __int16 *)v0 + 12);
      }
      else
      {
        if ( (dword_404630 & 0x10) == 0 )
          return;
        v17 = v0[7];
        v18 = *v0;
        v19 = *(_QWORD *)(v0 + 5);
        v14 = v0[24];
        v15 = *((_QWORD *)v0 + 10);
        v16 = *((_QWORD *)v0 + 11);
        v10 = *((_QWORD *)v0 + 6);
        *(_QWORD *)v0 = v0[1];
        v20 = (unsigned int)v0[4];
        v11 = *((_QWORD *)v0 + 7);
        v12 = *((_QWORD *)v0 + 8);
        v13 = *((_QWORD *)v0 + 9);
        v9 = *((_QWORD *)v0 + 4);
        v7 = *((_QWORD *)v0 + 5);
        v0[6] = v18;
        *((_QWORD *)v0 + 2) = v20;
        *(_QWORD *)(v0 + 7) = v19;
        *((_QWORD *)v0 + 5) = v17;
      }
      *((_QWORD *)v0 + 6) = v15;
      *((_QWORD *)v0 + 7) = v14;
      *((_QWORD *)v0 + 8) = v16;
    }
    *((_QWORD *)v0 + 9) = v9;
    *((_QWORD *)v0 + 10) = v7;
    *((_QWORD *)v0 + 11) = v10;
    *((_QWORD *)v0 + 12) = v11;
    *((_QWORD *)v0 + 13) = v12;
    *((_QWORD *)v0 + 14) = v13;
  }
}
// 401690: variable 'v0' is possibly undefined
// 404630: using guessed type int dword_404630;

//----- (00000000004017BE) ----------------------------------------------------
__int64 __fastcall sub_4017BE(int a1, __int64 a2)
{
  char v2; // zf
  _QWORD *v3; // rdi
  unsigned __int8 *v4; // rsi
  __int64 v5; // rax

  do
  {
    v5 = *v4++;
    *v3++ = a2 + v5;
    --a1;
  }
  while ( a1 );
  *v3 = a2 + v4[(unsigned __int8)((2 * !v2) | ((byte_404035 & 2) != 0))];
  return *(_QWORD *)v4;
}
// 4017C7: variable 'v4' is possibly undefined
// 4017CB: variable 'v3' is possibly undefined
// 4017BE: variable 'v2' is possibly undefined
// 404035: using guessed type char byte_404035;

//----- (00000000004017EC) ----------------------------------------------------
char __fastcall sub_4017EC()
{
  _BYTE *v0; // rdi
  char *v1; // rsi
  __int64 v2; // rcx
  char v3; // al
  char *v4; // rsi
  char result; // al

  v2 = 0i64;
  while ( 1 )
  {
    v3 = *v1;
    v4 = v1 + 1;
    LOBYTE(v2) = v3;
    result = *v4;
    v1 = v4 + 1;
    if ( !v2 )
      break;
    do
    {
      *v0++ = result;
      v2 = (unsigned int)(v2 - 1);
    }
    while ( (_DWORD)v2 );
  }
  return result;
}
// 4017EE: variable 'v1' is possibly undefined
// 4017F4: variable 'v0' is possibly undefined

//----- (00000000004017FD) ----------------------------------------------------
void __fastcall __noreturn sub_4017FD(__int64 a1, __int64 a2)
{
  sub_4021F0(a1, a2);
  sub_402941();
}
// 401808: ignored the value written to the shadow area of the succeeding call

//----- (0000000000401816) ----------------------------------------------------
__int64 sub_401816()
{
  dword_407838 = dword_404648;
  return -1i64;
}
// 404648: using guessed type int dword_404648;
// 407838: using guessed type int dword_407838;

//----- (0000000000401826) ----------------------------------------------------
__int64 sub_401826()
{
  dword_407838 = dword_404658;
  return -1i64;
}
// 404658: using guessed type int dword_404658;
// 407838: using guessed type int dword_407838;

//----- (0000000000401836) ----------------------------------------------------
__int64 sub_401836()
{
  dword_407838 = dword_404660;
  return -1i64;
}
// 404660: using guessed type int dword_404660;
// 407838: using guessed type int dword_407838;

//----- (0000000000401846) ----------------------------------------------------
__int64 sub_401846()
{
  dword_407838 = dword_404668;
  return -1i64;
}
// 404668: using guessed type int dword_404668;
// 407838: using guessed type int dword_407838;

//----- (0000000000401856) ----------------------------------------------------
__int64 sub_401856()
{
  dword_407838 = dword_404670;
  return -1i64;
}
// 404670: using guessed type int dword_404670;
// 407838: using guessed type int dword_407838;

//----- (0000000000401867) ----------------------------------------------------
void __noreturn start()
{
  void (**v0)(void); // rax
  void (**v1)(void); // rcx
  __int64 v2; // rdx
  __int64 v3; // rcx
  HANDLE StdHandle; // rax
  LPWCH EnvironmentStringsW; // r13
  __int64 i; // rax
  unsigned int v7; // eax
  DWORD *v8; // rcx
  char *v9; // r10
  unsigned __int64 v10; // r8
  WCHAR *v11; // rdx
  DWORD *v12; // r11
  __int64 v13; // rax
  unsigned int v14; // er9
  unsigned __int64 v15; // rax
  unsigned int v16; // eax
  __int64 v17; // rax
  unsigned __int64 v18; // rcx
  void (**v19)(void); // [rsp-10h] [rbp-E080h]
  __int64 v20; // [rsp-8h] [rbp-E078h]
  unsigned int v21; // [rsp+2Ch] [rbp-E044h]
  __int64 v22[513]; // [rsp+38h] [rbp-E038h]
  __int64 v23[512]; // [rsp+1040h] [rbp-D030h] BYREF
  DWORD NumberOfBytesWritten[8191]; // [rsp+6040h] [rbp-8030h] BYREF
  char v25; // [rsp+E03Eh] [rbp-32h] BYREF

  v22[0] = 0i64;
  if ( !SetDefaultDllDirectories(0x800u) )
  {
    StdHandle = GetStdHandle(0xFFFFFFF4);
    WriteFile(StdHandle, "nodll\n", 6u, NumberOfBytesWritten, 0i64);
    ExitProcess(1u);
  }
  dword_404630 = 4;
  GetCommandLineW();
  EnvironmentStringsW = GetEnvironmentStringsW();
  sub_401AFE((__int64)v23, 0x3FFFi64);
  for ( i = 0i64; *(_BYTE *)(i + v23[0]); ++i )
  {
    if ( *(_BYTE *)(i + v23[0]) == 92 )
      *(_BYTE *)(i + v23[0]) = 47;
  }
  if ( *EnvironmentStringsW > 0xD7FFu )
  {
    v7 = sub_40262D();
  }
  else
  {
    v21 = *EnvironmentStringsW;
    v7 = 1;
  }
  v8 = NumberOfBytesWritten;
  v9 = &v25;
  v10 = 0i64;
  v11 = &EnvironmentStringsW[v7];
  v12 = NumberOfBytesWritten;
  while ( v21 )
  {
    if ( ++v10 <= 0x1FF )
    {
      v13 = 0i64;
      if ( v8 < (DWORD *)v9 )
        v13 = (__int64)v8;
      v22[v10] = v13;
    }
    do
    {
      v14 = v21;
      v15 = (int)v21;
      if ( v21 > 0x7F )
        v15 = sub_40263C();
      do
      {
        if ( v8 >= (DWORD *)v9 )
          break;
        v8 = (DWORD *)((char *)v8 + 1);
        *((_BYTE *)v8 - 1) = v15;
        v15 >>= 8;
      }
      while ( v15 );
      if ( *v11 > 0xD7FFu )
      {
        v16 = sub_40262D();
      }
      else
      {
        v21 = *v11;
        v16 = 1;
      }
      v11 += v16;
    }
    while ( v14 );
    v17 = (char *)v8 - (char *)v12;
    if ( (unsigned __int64)((char *)v8 - (char *)v12) > 0x7FFD )
      v17 = 32765i64;
    *((_BYTE *)NumberOfBytesWritten + v17) = 0;
  }
  if ( v8 < (DWORD *)v9 )
  {
    *(_BYTE *)v8 = 0;
    v8 = (DWORD *)((char *)v8 + 1);
  }
  v18 = (char *)v8 - (char *)v12;
  if ( v18 > 0x7FFE )
    v18 = 32766i64;
  if ( v10 > 0x1FF )
    v10 = 511i64;
  *((_BYTE *)NumberOfBytesWritten + v18) = 0;
  v22[v10 + 1] = 0i64;
  FreeEnvironmentStringsW(EnvironmentStringsW);
  sub_401297();
  dword_40783C |= 1u;
  v0 = (void (**)(void))&off_403008;
  v1 = (void (**)(void))&unk_403010;
  while ( v1 != v0 )
  {
    (*v0)();
    v1 = v19;
    v0 = (void (**)(void))(v20 + 8);
  }
  sub_40141F();
  sub_4017FD(v3, v2);
}
// 40154B: ignored the value written to the shadow area of the succeeding call
// 40154A: ignored the value written to the shadow area of the succeeding call
// 4019A5: variable 'v21' is possibly undefined
// 4019AB: variable 'v10' is possibly undefined
// 4019BD: variable 'v8' is possibly undefined
// 4019BD: variable 'v9' is possibly undefined
// 4019F2: variable 'v11' is possibly undefined
// 401A1B: variable 'v14' is possibly undefined
// 401A20: variable 'v12' is possibly undefined
// 40154E: variable 'v19' is possibly undefined
// 401550: variable 'v20' is possibly undefined
// 401567: variable 'v3' is possibly undefined
// 401567: variable 'v2' is possibly undefined
// 403008: using guessed type __int64 (__fastcall *off_403008)();
// 404630: using guessed type int dword_404630;
// 40783C: using guessed type int dword_40783C;
// 401867: using guessed type __int64 var_D030[512];

//----- (0000000000401AA3) ----------------------------------------------------
__int64 __fastcall sub_401AA3()
{
  unsigned __int16 **v0; // rdi
  _QWORD *v1; // rdx
  int v2; // eax
  unsigned int v3; // eax
  __int64 result; // rax

  v1 = v0;
  v2 = **v0;
  if ( (unsigned __int16)v2 > 0xD7FFu )
  {
    v3 = sub_40262D();
  }
  else
  {
    *((_DWORD *)v0 + 6) = v2;
    v3 = 1;
  }
  result = 2i64 * v3;
  *v1 += result;
  return result;
}
// 401AA3: variable 'v0' is possibly undefined
// 401ACA: variable 'v1' is possibly undefined

//----- (0000000000401ACE) ----------------------------------------------------
unsigned __int64 __fastcall sub_401ACE()
{
  __int64 v0; // rdi
  unsigned int v1; // esi
  __int64 v2; // rdx
  unsigned __int64 v3; // r8
  unsigned __int64 result; // rax
  _BYTE *v5; // rcx

  v2 = v0;
  v3 = *(_QWORD *)(v0 + 16);
  result = (int)v1;
  if ( v1 > 0x7F )
    result = sub_40263C();
  do
  {
    v5 = *(_BYTE **)(v2 + 8);
    if ( v3 <= (unsigned __int64)v5 )
      break;
    *(_QWORD *)(v2 + 8) = v5 + 1;
    *v5 = result;
    result >>= 8;
  }
  while ( result );
  return result;
}
// 401ACE: variable 'v0' is possibly undefined
// 401ADA: variable 'v1' is possibly undefined
// 401AE4: variable 'v2' is possibly undefined
// 401AEB: variable 'v3' is possibly undefined

//----- (0000000000401AFE) ----------------------------------------------------
__int64 __fastcall sub_401AFE(__int64 a1, __int64 a2)
{
  _BYTE *v2; // rsi
  __int64 v3; // r15
  unsigned __int64 v4; // rbx
  __int64 v5; // r11
  unsigned __int64 v6; // r8
  _BYTE *v7; // rax
  __int64 v8; // r12
  __int64 v10; // [rsp+10h] [rbp-60h]
  __int64 v11; // [rsp+10h] [rbp-60h]
  unsigned __int64 v12; // [rsp+18h] [rbp-58h]
  __int64 v13; // [rsp+18h] [rbp-58h]
  _BYTE *v14; // [rsp+30h] [rbp-40h]
  unsigned int v15; // [rsp+38h] [rbp-38h]

  v3 = 0x100002600i64;
  v4 = 0i64;
  v14 = &v2[a2];
  sub_401AA3();
LABEL_2:
  if ( v15 )
  {
    while ( v15 <= 0x20 && _bittest64(&v3, v15) )
      sub_401AA3();
    if ( ++v4 < v12 )
    {
      v7 = v2;
      if ( v2 >= v14 )
        v7 = 0i64;
      *(_QWORD *)(v10 + 8 * v4 - 8) = v7;
    }
    while ( 1 )
    {
      if ( v15 > 0x20 )
      {
        if ( v15 == 34 || v15 == 92 )
        {
          v8 = 0i64;
          while ( v15 == 92 )
          {
            ++v8;
            sub_401AA3();
          }
          while ( 1 )
            sub_401AA3();
        }
      }
      else if ( _bittest64(&v3, v15) )
      {
        sub_401ACE();
        goto LABEL_2;
      }
      sub_401ACE();
      sub_401AA3();
    }
  }
  sub_401ACE();
  if ( v5 )
    *v2 = 0;
  if ( v13 )
  {
    v6 = v13 - 1;
    if ( v13 - 1 > v4 )
      v6 = v4;
    *(_QWORD *)(v11 + 8 * v6) = 0i64;
  }
  return (unsigned int)v4;
}
// 401B34: ignored the value written to the shadow area of the succeeding call
// 401B30: ignored the value written to the shadow area of the succeeding call
// 401C64: ignored the value written to the shadow area of the succeeding call
// 401B50: conditional instruction was optimized away because %var_38.4!=0
// 401BDD: conditional instruction was optimized away because %var_38.4!=0
// 401BE6: conditional instruction was optimized away because r14.1==0
// 401C27: conditional instruction was optimized away because %var_38.4==22
// 401B3C: variable 'v2' is possibly undefined
// 401B49: variable 'v15' is possibly undefined
// 401B74: variable 'v5' is possibly undefined
// 401B92: variable 'v13' is possibly undefined
// 401BAA: variable 'v11' is possibly undefined
// 401BBE: variable 'v12' is possibly undefined
// 401BD0: variable 'v10' is possibly undefined

//----- (0000000000401D0B) ----------------------------------------------------
__int64 __fastcall sub_401D0B(__int64 a1, __int64 a2)
{
  HANDLE *v2; // rdi
  __int64 v3; // rsi
  __int64 i; // r12
  struct _OVERLAPPED *v6; // rax
  DWORD v7; // er8
  const void *v8; // rdx
  __int64 j; // rax
  DWORD NumberOfBytesWritten; // [rsp+Ch] [rbp-44h] BYREF

  for ( i = v3; a2 && !*(_QWORD *)(i + 8); i += 16i64 )
    --a2;
  v6 = (struct _OVERLAPPED *)sub_401DAD();
  if ( a2 )
  {
    v7 = *(_DWORD *)(i + 8);
    v8 = *(const void **)i;
  }
  else
  {
    v7 = 0;
    v8 = 0i64;
  }
  if ( !WriteFile(*v2, v8, v7, &NumberOfBytesWritten, v6) )
    return sub_40297A();
  if ( !NumberOfBytesWritten )
  {
    for ( j = 0i64; a2 != j; ++j )
      ;
  }
  FlushFileBuffers(*v2);
  return NumberOfBytesWritten;
}
// 401D19: variable 'v3' is possibly undefined
// 401D5D: variable 'v2' is possibly undefined

//----- (0000000000401DAD) ----------------------------------------------------
__int64 __fastcall sub_401DAD()
{
  __int64 v0; // rdi
  __int64 v1; // rsi
  __int64 v2; // rdx
  __int64 v3; // r8
  __int64 v4; // rcx
  _DWORD *v5; // rdi

  v2 = v0;
  v3 = v1;
  if ( v0 == -1 )
    return 0i64;
  v4 = 8i64;
  v5 = (_DWORD *)v1;
  while ( v4 )
  {
    *v5++ = 0;
    --v4;
  }
  *(_QWORD *)(v1 + 16) = v2;
  return v3;
}
// 401DB1: variable 'v0' is possibly undefined
// 401DB4: variable 'v1' is possibly undefined

//----- (0000000000401DD2) ----------------------------------------------------
DWORD __fastcall sub_401DD2()
{
  void *v0; // rdi

  return GetFileType(v0);
}
// 401DE3: variable 'v0' is possibly undefined

//----- (0000000000401DEB) ----------------------------------------------------
DWORD sub_401DEB()
{
  return GetLastError();
}

//----- (0000000000401E0A) ----------------------------------------------------
__int64 sub_401E0A()
{
  int v0; // eax
  int v2; // ebx

  v0 = sub_401EAA();
  if ( v0 == -1 )
    return 0xFFFFFFFFi64;
  v2 = v0;
  if ( (unsigned int)sub_401E45() == -1 )
    return 0xFFFFFFFFi64;
  else
    return (unsigned int)(v2 + 1);
}
// 406038: using guessed type __int64 qword_406038;

//----- (0000000000401E45) ----------------------------------------------------
__int64 __fastcall sub_401E45()
{
  int v0; // edi
  __int64 v1; // rsi
  int v2; // eax
  int v3; // edx
  __int64 (*v4)(void); // rcx

  if ( v0 == -1 )
    return sub_401F6E();
  *(_BYTE *)(*(_QWORD *)(v1 + 24) + *(unsigned int *)(v1 + 20)) = v0;
  v2 = (*(_DWORD *)(v1 + 32) - 1) & (*(_DWORD *)(v1 + 20) + 1);
  v3 = *(_DWORD *)(v1 + 16);
  *(_DWORD *)(v1 + 20) = v2;
  if ( v2 != v3 && *(_BYTE *)v1 != 2 && (*(_BYTE *)v1 != 1 || (_BYTE)v0 != 10) )
    return (unsigned __int8)v0;
  v4 = *(__int64 (**)(void))(v1 + 48);
  if ( v4 )
    return v4();
  if ( v2 == v3 )
    return sub_401F6E();
  else
    return (unsigned __int8)v0;
}
// 401E4F: variable 'v0' is possibly undefined
// 401E54: variable 'v1' is possibly undefined

//----- (0000000000401EAA) ----------------------------------------------------
__int64 __fastcall sub_401EAA()
{
  char *v0; // rdi
  __int64 v1; // rsi
  int v2; // er14
  char *v3; // r13
  char v4; // dl
  int v5; // eax
  int v6; // ecx
  __int64 (*v7)(void); // rdx
  unsigned int v8; // eax
  unsigned int v9; // er12
  int v10; // eax

  v2 = 0;
  v3 = v0;
  do
  {
    while ( 1 )
    {
      v4 = *v3;
      if ( !*v3 )
        return (unsigned int)(v2 + 1);
      ++v3;
      *(_BYTE *)(*(_QWORD *)(v1 + 24) + *(unsigned int *)(v1 + 20)) = v4;
      v5 = (*(_DWORD *)(v1 + 32) - 1) & (*(_DWORD *)(v1 + 20) + 1);
      v6 = *(_DWORD *)(v1 + 16);
      *(_DWORD *)(v1 + 20) = v5;
      if ( v5 == v6 || *(_BYTE *)v1 == 2 || *(_BYTE *)v1 == 1 && v4 == 10 )
      {
        v7 = *(__int64 (**)(void))(v1 + 48);
        if ( v7 )
        {
          v8 = v7();
        }
        else
        {
          if ( v5 != v6 )
            goto LABEL_15;
          v8 = sub_401F6E();
        }
        v9 = v8;
        if ( v8 == -1 )
          break;
      }
LABEL_15:
      ++v2;
    }
  }
  while ( (int)sub_401FA1() == qword_404650 );
  if ( sub_401F97() )
  {
    v10 = qword_404678;
    *(_DWORD *)(v1 + 8) = qword_404678;
    dword_407838 = v10;
  }
  return v9;
}
// 401EB5: variable 'v0' is possibly undefined
// 401ECD: variable 'v1' is possibly undefined
// 404650: using guessed type __int64 qword_404650;
// 404678: using guessed type __int64 qword_404678;
// 407838: using guessed type int dword_407838;

//----- (0000000000401F6E) ----------------------------------------------------
__int64 sub_401F6E()
{
  return sub_401F76();
}

//----- (0000000000401F76) ----------------------------------------------------
__int64 __fastcall sub_401F76()
{
  __int64 v0; // rdi
  int v1; // esi
  int v2; // eax

  if ( !v1 )
    v1 = -1;
  v2 = *(_DWORD *)(v0 + 8);
  if ( v2 <= 0 )
    v2 = v1;
  *(_DWORD *)(v0 + 8) = v2;
  if ( v1 > 0 )
    dword_407838 = v1;
  return -1i64;
}
// 401F78: variable 'v1' is possibly undefined
// 401F7D: variable 'v0' is possibly undefined
// 407838: using guessed type int dword_407838;

//----- (0000000000401F97) ----------------------------------------------------
_BOOL8 __fastcall sub_401F97()
{
  __int64 v0; // rdi

  return *(_DWORD *)(v0 + 8) == -1;
}
// 401F99: variable 'v0' is possibly undefined

//----- (0000000000401FA1) ----------------------------------------------------
__int64 __fastcall sub_401FA1()
{
  __int64 v0; // rdi
  __int64 result; // rax

  result = 0i64;
  if ( *(int *)(v0 + 8) >= 0 )
    return *(unsigned int *)(v0 + 8);
  return result;
}
// 401FA1: variable 'v0' is possibly undefined

//----- (0000000000401FAF) ----------------------------------------------------
__int64 __fastcall sub_401FAF(__int64 a1)
{
  _DWORD *v1; // rdi
  unsigned int v2; // er12
  __int64 i; // r13
  int v4; // eax
  int v5; // eax
  _DWORD *v7; // [rsp+8h] [rbp-18h]

  if ( v1 )
  {
    v2 = 0;
    if ( v1[3] != -1 && (v1[1] & (unsigned int)qword_404688) != 0 )
    {
      v2 = v1[2];
      if ( v2 )
      {
        if ( v2 == -1 )
          return 0;
        else
          return (unsigned int)sub_401F76();
      }
      else
      {
        while ( v1[4] != v1[5] )
        {
          v5 = sub_402083();
          if ( v5 == -1 )
            return (unsigned int)-1;
          v1 = v7;
          v2 += v5;
        }
      }
    }
  }
  else
  {
    v2 = 0;
    for ( i = qword_406040 - 1; i != -1; --i )
    {
      if ( *(_QWORD *)(qword_406050 + 8 * i) )
      {
        v4 = sub_401FAF(a1);
        if ( v4 == -1 )
          return (unsigned int)-1;
        v2 += v4;
      }
    }
  }
  return v2;
}
// 402022: ignored the value written to the shadow area of the succeeding call
// 401FBE: variable 'v1' is possibly undefined
// 401FE4: variable 'a1' is possibly undefined
// 402030: variable 'v7' is possibly undefined
// 404688: using guessed type __int64 qword_404688;
// 406040: using guessed type __int64 qword_406040;
// 406050: using guessed type __int64 qword_406050;

//----- (0000000000402083) ----------------------------------------------------
__int64 __fastcall sub_402083()
{
  _DWORD *v0; // rdi
  unsigned int v1; // esi
  unsigned int v2; // ebx
  unsigned int v3; // ebx
  __int64 v4; // rax

  v1 = v0[4];
  v2 = v0[5];
  if ( v1 >= v2 )
    v2 = v0[8];
  v3 = v2 - v1;
  v4 = sub_40247A();
  if ( v4 == -1 )
    return sub_402150();
  v0[4] = (v0[8] - 1) & (v0[4] + v4);
  return v3;
}
// 40208D: variable 'v0' is possibly undefined

//----- (0000000000402150) ----------------------------------------------------
__int64 sub_402150()
{
  return sub_401F76();
}
// 407838: using guessed type int dword_407838;

//----- (000000000040215B) ----------------------------------------------------
__int64 __fastcall sub_40215B(__int64 a1, __int64 a2)
{
  __int64 v2; // rdi
  __int64 v3; // rsi
  _DWORD *v4; // rbx
  __int64 result; // rax
  unsigned int v6; // eax
  _QWORD *v7; // rbx

  v4 = (_DWORD *)qword_4060A0;
  if ( !qword_4060A0 )
  {
    v4 = &unk_4060A8;
    qword_4060A0 = (__int64)&unk_4060A8;
  }
  if ( *v4 == -1 )
    return sub_401836();
  _BitScanReverse(&v6, ~*v4);
  *v4 |= 1 << v6;
  v7 = &v4[6 * v6];
  result = 0i64;
  v7[2] = v2;
  v7[3] = v3;
  v7[4] = a2;
  return result;
}
// 4021DB: variable 'v2' is possibly undefined
// 4021DF: variable 'v3' is possibly undefined
// 4060A0: using guessed type __int64 qword_4060A0;

//----- (00000000004021F0) ----------------------------------------------------
__int64 __fastcall sub_4021F0(__int64 a1, __int64 a2)
{
  __int64 v2; // rdi
  __int64 v3; // r12
  unsigned int *v4; // rdi
  __int64 v5; // rax
  int v6; // ecx
  __int64 v7; // rdx
  void (*v8)(void); // rdx
  __int64 v10; // [rsp-8h] [rbp-20h]

  v3 = v2;
  v10 = a2;
LABEL_2:
  while ( 1 )
  {
    v4 = (unsigned int *)qword_4060A0;
    if ( !qword_4060A0 )
      return v10;
    while ( 1 )
    {
      v5 = *v4;
      while ( v5 )
      {
        _BitScanForward((unsigned int *)&v6, v5);
        v7 = (unsigned int)~(1 << v6);
        v5 &= v7;
        if ( !v3 || *(_QWORD *)&v4[6 * v6 + 8] == v3 )
        {
          *v4 &= v7;
          v8 = *(void (**)(void))&v4[6 * v6 + 4];
          if ( v8 )
          {
            v8();
            goto LABEL_2;
          }
        }
      }
      if ( !v3 )
        break;
      if ( !*((_QWORD *)v4 + 1) )
        return v10;
      v4 = (unsigned int *)*((_QWORD *)v4 + 1);
    }
    qword_4060A0 = *((_QWORD *)v4 + 1);
  }
}
// 4021F8: variable 'v2' is possibly undefined
// 40227E: variable 'v10' is possibly undefined
// 4060A0: using guessed type __int64 qword_4060A0;

//----- (0000000000402286) ----------------------------------------------------
__int64 __fastcall sub_402286(__int64 a1, unsigned __int64 a2)
{
  _QWORD *v2; // rdi
  unsigned __int64 *v3; // rsi
  _QWORD *v5; // r13
  __int64 v7; // rcx
  unsigned __int64 v8; // rdi
  unsigned __int64 v9; // rsi
  unsigned __int64 v10; // rcx

  v5 = v2;
  sub_4023CE(a1);
  sub_4023CE(v7);
  v8 = *v3;
  if ( *v5 )
  {
    v9 = v8 + (v8 >> 1);
  }
  else
  {
    v9 = 4i64;
    if ( 0x1F / a2 >= 4 )
      v9 = 0x1F / a2;
  }
  if ( v8 && ((v8 | a2) & 0xFFFFFFFFFFFF0000ui64) != 0 && a2 != v8 * a2 / v8
    || (v10 = v9 + a1 + 1, v9 + a1 != -1i64) && ((v10 | a2) & 0xFFFFFFFFFFFF0000ui64) != 0 && a2 != v10 * a2 / v10 )
  {
    sub_401856();
  }
  else
  {
    sub_401836();
  }
  return 0i64;
}
// 402296: variable 'v2' is possibly undefined
// 4022B2: variable 'v7' is possibly undefined
// 4022C4: variable 'v3' is possibly undefined

//----- (00000000004023CE) ----------------------------------------------------
_BOOL8 __fastcall sub_4023CE(__int64 a1)
{
  __int64 v1; // rdi
  __int64 v2; // rbx
  __int64 v3; // rdx
  _BOOL8 result; // rax
  bool v5; // al

  if ( (unsigned __int64)(v1 - 0x600000000000i64) <= 0xFFFFFFFFFFFi64 )
    return 0i64;
  v2 = v1 >> 16;
  v3 = sub_40243F(a1, qword_4063C0[0]);
  result = 0i64;
  if ( v3 )
  {
    v5 = 1;
    if ( LODWORD(qword_4063C0[v3]) != (_DWORD)v2 )
      return HIDWORD(qword_4063C0[v3]) == (_DWORD)v2;
    return v5;
  }
  return result;
}
// 4023FD: ignored the value written to the shadow area of the succeeding call
// 4023F4: ignored the value written to the shadow area of the succeeding call
// 4023E9: ignored the value written to the shadow area of the succeeding call
// 4023CE: could not find valid save-restore pair for rbx
// 4023CE: could not find valid save-restore pair for rbp
// 4023CE: could not find valid save-restore pair for r12
// 4023E1: variable 'v1' is possibly undefined
// 4063C0: using guessed type __int64 qword_4063C0[];

//----- (000000000040243F) ----------------------------------------------------
__int64 __fastcall sub_40243F(__int64 a1, int a2)
{
  int v2; // edi
  __int64 v3; // rsi
  __int64 result; // rax
  int v5; // ecx

  LODWORD(result) = 0;
  while ( a2 > (int)result )
  {
    v5 = (a2 + (int)result) >> 1;
    if ( *(_DWORD *)(v3 + 8i64 * v5) > v2 )
      a2 = (a2 + (int)result) >> 1;
    else
      LODWORD(result) = v5 + 1;
  }
  return (int)result;
}
// 40244D: variable 'v3' is possibly undefined
// 402451: variable 'v2' is possibly undefined

//----- (000000000040245F) ----------------------------------------------------
bool __fastcall sub_40245F()
{
  int v0; // edi
  int v1; // esi
  bool result; // al

  result = 0;
  if ( v0 )
    return *(_DWORD *)(qword_4076B0 + 24i64 * v0 + 16) == v1;
  return result;
}
// 402463: variable 'v0' is possibly undefined
// 402476: variable 'v1' is possibly undefined
// 4076B0: using guessed type __int64 qword_4076B0;

//----- (000000000040247A) ----------------------------------------------------
__int64 __fastcall sub_40247A()
{
  int v0; // edi

  if ( v0 == -1 )
    return (int)sub_401826();
  if ( sub_40245F() )
    return MEMORY[0](-1i64, 1i64);
  if ( (dword_404630 & 4) == 0 )
    return sub_4025C0();
  if ( sub_40245F() )
    return MEMORY[0](0i64, 1i64, 0i64, 0i64);
  if ( sub_40245F() || sub_40245F() )
    return sub_401D0B(-1i64, 1i64);
  return sub_401816();
}
// 402586: ignored the value written to the shadow area of the succeeding call
// 40257B: ignored the value written to the shadow area of the succeeding call
// 402522: ignored the value written to the shadow area of the succeeding call
// 40251A: ignored the value written to the shadow area of the succeeding call
// 40248F: variable 'v0' is possibly undefined
// 404630: using guessed type int dword_404630;
// 4076B0: using guessed type __int64 qword_4076B0;

//----- (00000000004025B0) ----------------------------------------------------
__int64 sub_4025B0()
{
  return qword_404638();
}
// 404638: using guessed type __int64 (*qword_404638)(void);

//----- (00000000004025C0) ----------------------------------------------------
__int64 sub_4025C0()
{
  return qword_404638();
}
// 404638: using guessed type __int64 (*qword_404638)(void);

//----- (00000000004025D0) ----------------------------------------------------
__int64 __fastcall sub_4025D0()
{
  __int16 v0; // ax
  __int64 result; // rax

  result = (unsigned int)v0;
  if ( (int)result < 0 )
  {
    dword_407838 = dword_404668;
    return -1i64;
  }
  else
  {
    __asm { syscall; Low latency system call }
  }
  return result;
}
// 4025E2: conditional instruction was optimized away because rax.8<80000000u
// 4025D0: variable 'v0' is possibly undefined
// 4025D0: using guessed type __int64 __fastcall sub_4025D0();
// 404668: using guessed type int dword_404668;
// 407838: using guessed type int dword_407838;

//----- (000000000040262D) ----------------------------------------------------
__int64 sub_40262D()
{
  return sub_40266F();
}

//----- (000000000040263C) ----------------------------------------------------
__int64 __fastcall sub_40263C()
{
  __int64 v0; // rdi
  __int64 v1; // rax
  __int64 v2; // rcx
  int v3; // ecx
  char v4; // dl

  v0 = (unsigned int)v0;
  v1 = 0i64;
  if ( (unsigned int)v0 > 0x7F )
  {
    _BitScanReverse((unsigned int *)&v2, v0);
    v3 = *(_DWORD *)&byte_4029C3[2 * v2 - 14];
    do
    {
      v4 = v0;
      v0 = (unsigned int)v0 >> 6;
      LOBYTE(v1) = v4 & 0x3F | v1 | 0x80;
      v1 <<= 8;
      LOBYTE(v3) = v3 - 1;
    }
    while ( (_BYTE)v3 );
    LOBYTE(v1) = BYTE1(v3) | v1;
  }
  return v0 | v1;
}
// 40263E: variable 'v0' is possibly undefined
// 40264F: variable 'v2' is possibly undefined

//----- (000000000040266F) ----------------------------------------------------
__int64 __fastcall sub_40266F()
{
  __int64 v0; // rdi
  _DWORD *v1; // rsi
  __int64 result; // rax
  __int64 v3; // rdx
  int v4; // ebx
  int v5; // edx
  int v6; // eax

  LODWORD(result) = 0;
  do
  {
    v3 = (unsigned int)result;
    v4 = result;
    result = (unsigned int)(result + 1);
    v5 = *(unsigned __int16 *)(v0 + 2 * v3);
  }
  while ( (v5 & 0xFC00) == 0xDC00 );
  if ( (v5 & 0xFC00) == 0xD800 )
  {
    v6 = *(unsigned __int16 *)(v0 + 2 * result);
    if ( (v6 & 0xFC00) == 0xDC00 )
    {
      *v1 = (v5 << 10) + v6 - 56613888;
      return (unsigned int)(v4 + 2);
    }
    else
    {
      *v1 = 65533;
      return 0xFFFFFFFFi64;
    }
  }
  else
  {
    *v1 = v5;
  }
  return result;
}
// 402680: variable 'v0' is possibly undefined
// 402699: variable 'v1' is possibly undefined

//----- (0000000000402750) ----------------------------------------------------
void __fastcall sub_402750(__int64 a1, unsigned __int64 a2)
{
  __int64 v2; // rcx

  v2 = 32i64;
  if ( a2 < 0x20 )
    v2 = a2;
  __asm { jmp     qword_404420[rcx*8] }
}
// 40275D: unbalanced stack, ignored a potential tail call

//----- (0000000000402764) ----------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_402764(__int64 a1, unsigned __int64 _RDX)
{
  unsigned __int64 v8; // rcx
  unsigned __int64 v9; // rdi
  __int8 *v10; // rsi
  unsigned __int64 v11; // rdx
  unsigned __int64 v12; // rcx

  if ( _RDX >= 0x400 )
  {
    if ( _RDX > 0x400000 )
    {
      *_RDI = _mm_loadu_si128(_RSI);
      v8 = ((unsigned __int64)&_RDI[1] & 0xFFFFFFFFFFFFFFF0ui64) - (_QWORD)_RDI;
      v9 = (unsigned __int64)&_RDI[1] & 0xFFFFFFFFFFFFFFF0ui64;
      v10 = &_RSI->m128i_i8[v8];
      v11 = _RDX - v8;
      v12 = 16i64;
      do
      {
        v12 += 16i64;
        _mm_stream_si128((__m128i *)(v9 + v12 - 32), _mm_loadu_si128((const __m128i *)&v10[v12 - 32]));
      }
      while ( v11 > v12 );
      _mm_sfence();
      *(__m128i *)(v9 + v11 - 16) = _mm_loadu_si128((const __m128i *)&v10[v11 - 16]);
    }
    else
    {
      qmemcpy(_RDI, _RSI, _RDX);
    }
  }
  else
  {
    _RCX = 32i64;
    do
    {
      _RCX += 32i64;
      __asm
      {
        vmovdqu ymm3, ymmword ptr [rsi+rcx-40h]
        vmovdqu ymmword ptr [rdi+rcx-40h], ymm3
      }
    }
    while ( _RDX > _RCX );
    __asm
    {
      vmovdqu ymm3, ymmword ptr [rsi+rdx-20h]
      vmovdqu ymmword ptr [rdi+rdx-20h], ymm3
      vxorps  ymm3, ymm3, ymm3
    }
  }
}
// 4027E8: positive sp value 8 has been found
// 402818: variable '_RDI' is possibly undefined
// 402818: variable '_RSI' is possibly undefined

//----- (0000000000402870) ----------------------------------------------------
void __fastcall sub_402870(__int64 a1, unsigned __int64 a2)
{
  __int64 v2; // rcx

  v2 = 32i64;
  if ( a2 < 0x20 )
    v2 = a2;
  __asm { jmp     qword ptr [rbx+rcx*8] }
}
// 402887: unbalanced stack, ignored a potential tail call

//----- (000000000040288A) ----------------------------------------------------
// local variable allocation has failed, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_40288A(__int64 a1, unsigned __int64 _RDX, __int64 a3, double _XMM3_8)
{
  char v5; // si

  if ( _RDX >= 0x400 )
  {
    memset(_RDI, v5, _RDX);
  }
  else
  {
    __asm { vpbroadcastb ymm3, xmm3 }
    _RCX = 32i64;
    do
    {
      _RCX += 32i64;
      __asm { vmovdqu ymmword ptr [rdi+rcx-40h], ymm3 }
    }
    while ( _RDX > _RCX );
    __asm
    {
      vmovdqu ymmword ptr [rdi+rdx-20h], ymm3
      vxorps  ymm3, ymm3, ymm3
    }
  }
}
// 4028F1: positive sp value 10 has been found
// 40288A: could not find valid save-restore pair for rbx
// 40288A: inconsistent variable size for 'xmm3_8.8(_XMM3_8)'

//----- (0000000000402941) ----------------------------------------------------
void __fastcall __noreturn sub_402941()
{
  unsigned __int8 v0; // di

  dword_40783C |= 4u;
  if ( (dword_404630 & 4) != 0 )
    ExitProcess(v0);
  __asm { syscall; Low latency system call }
  _disable();
  __lidt(byte_402972);
  __halt();
}
// 402951: variable 'v0' is possibly undefined
// 404630: using guessed type int dword_404630;
// 40783C: using guessed type int dword_40783C;

//----- (000000000040297A) ----------------------------------------------------
__int64 sub_40297A()
{
  if ( (dword_404630 & 4) == 0 )
    return sub_401846();
  dword_407838 = sub_401DEB();
  return -1i64;
}
// 402983: ignored the value written to the shadow area of the succeeding call
// 404630: using guessed type int dword_404630;
// 407838: using guessed type int dword_407838;

// nfuncs=55 queued=55 decompiled=55 lumina nreq=0 worse=0 better=0
// ALL OK, 55 function(s) have been successfully decompiled
