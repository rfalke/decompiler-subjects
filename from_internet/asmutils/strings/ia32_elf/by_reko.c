// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register (ptr32 byte) esi, Stack word32 dwArg00)
void fn0804804C(byte * esi, word32 dwArg00)
{
	word32 * esp_10;
	struct Eq_5 * esp_157 = fp + 4;
	if (dwArg00 != 0x01)
	{
		esp_10 = fp + 8;
		while (true)
		{
l08048051:
			word16 * ebx_13 = *esp_10;
			struct Eq_5 * esp_14 = esp_10 + 1;
			if (ebx_13 == null)
				break;
			if (*ebx_13 != 28205)
			{
				esp_14->dwFFFFFFFC = 0x05;
				int32 eax_26 = esp_14->dwFFFFFFFC;
				__syscall(0x80);
				esp_157 = esp_14;
				if (eax_26 >= 0x00)
					goto l0804807D;
				goto l080480FA;
			}
			g_dw804811B = fn08048106(esp_14->ptr0000, out esi);
			esp_10 = (word32 *) ((char *) &esp_14->ptr0000 + 4);
		}
	}
	else
	{
l0804807D:
		while (true)
		{
			int32 * esp_38 = esp_157 - 4;
			*esp_38 = 0x03;
			int32 eax_40 = *esp_38;
			__syscall(0x80);
			esp_10 = esp_38 + 1;
			if (eax_40 < 0x00)
				break;
			if (eax_40 == 0x00)
				goto l08048051;
			esi = &g_b8048123;
			int32 ecx_120 = eax_40;
			int32 edx_123 = 0x00;
			byte ah_134 = 0x00;
			do
			{
				ci8 al_75 = *esi;
				++esi;
				if (al_75 < 0x20 || al_75 > 0x7E)
				{
					if (ah_134 != 0x00)
					{
						if (edx_123 >= g_dw804811B)
						{
							struct Eq_114 * esp_93 = esp_157 - 4;
							esp_93->dw0000 = ecx_120;
							esp_93->dwFFFFFFFC = 0x01;
							esp_93->dwFFFFFFFC = 0x04;
							__syscall(0x80);
							esp_93->dwFFFFFFFC = 0x01;
							esp_93->dwFFFFFFFC = 0x01;
							esp_93->dwFFFFFFFC = 0x04;
							__syscall(0x80);
							ecx_120 = esp_93->dw0000;
						}
						ah_134 = 0x00;
						edx_123 = 0x00;
					}
					--ecx_120;
					if (ecx_120 == 0x00)
						break;
					continue;
				}
				if (ah_134 == 0x00)
				{
					g_ptr804811F = esi;
					++ah_134;
				}
				++edx_123;
				--ecx_120;
			} while (ecx_120 != 0x00);
		}
l080480FA:
	}
	__syscall(0x80);
	word32 esi_190;
	fn08048106(esi, out esi_190);
}

// 08048106: Register Eq_156 fn08048106(Register (ptr32 byte) esi, Register out (ptr32 byte) esiOut)
// Called from:
//      fn0804804C
Eq_156 fn08048106(byte * esi, byte & esiOut)
{
	Eq_156 ebx_14 = 0x00;
	while (true)
	{
		byte al_9 = *esi;
		++esi;
		if (al_9 == 0x00)
			break;
		ebx_14 = ebx_14 *s 0x0A + (uint32) (al_9 - 0x30);
	}
	esiOut = esi;
	return ebx_14;
}

int32 g_dw804811B = 4; // 0804811B
byte * g_ptr804811F = null; // 0804811F
byte g_b8048123 = 0x00; // 08048123
