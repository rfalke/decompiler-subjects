/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __fastcall __noreturn start(int, mode_t);
// int __usercall sub_8048106@<eax>(_BYTE *@<esi>);

//-------------------------------------------------------------------------
// Data declarations

char byte_804811A = '\n'; // weak
int dword_804811B = 4; // weak
int dword_804811F; // weak
char byte_8048123; // weak


//----- (0804804C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall __noreturn start(int a1, mode_t a2)
{
  int v2; // eax
  int v3; // ebp
  int v4; // eax
  char *v5; // ecx
  char *v6; // esi
  char *v7; // ecx
  signed int v8; // edx
  char v9; // ah
  char v10; // al
  int v11; // eax
  int v12; // eax
  int v13; // ebx
  int v14; // eax
  int v15; // [esp-10h] [ebp-10h]
  char *v16; // [esp-8h] [ebp-8h]
  _BYTE *v17; // [esp-4h] [ebp-4h]

  v2 = v15 - 1;
  if ( v15 == 1 )
    goto LABEL_6;
LABEL_2:
  while ( v16 )
  {
    if ( *(_WORD *)v16 != 28205 )
    {
      v2 = sys_open(v16, 0, a2);
      if ( v2 >= 0 )
      {
LABEL_6:
        v3 = v2;
LABEL_7:
        while ( 1 )
        {
          v4 = sys_read(v3, &byte_8048123, 0x1000u);
          if ( v4 < 0 )
            break;
          if ( !v4 )
            goto LABEL_2;
          v6 = v5;
          v7 = (char *)v4;
          v8 = 0;
          v9 = 0;
          do
          {
            while ( 1 )
            {
              v10 = *v6++;
              if ( v10 < 32 || v10 == 127 )
                break;
              if ( !v9 )
              {
                v9 = 1;
                dword_804811F = (int)v6;
              }
              ++v8;
              if ( !--v7 )
                goto LABEL_7;
            }
            if ( v9 )
            {
              if ( v8 >= dword_804811B )
              {
                v16 = v7;
                v11 = sys_write(1, (const void *)(dword_804811F - 1), v8);
                v12 = sys_write(1, &byte_804811A, 1u);
                v7 = v16;
              }
              v9 = 0;
              v8 = 0;
            }
            --v7;
          }
          while ( v7 );
        }
      }
      v13 = -1;
LABEL_24:
      v14 = sys_exit(v13);
    }
    dword_804811B = sub_8048106(v17);
  }
  v13 = 0;
  goto LABEL_24;
}
// 8048062: positive sp value 10 has been found
// 804804D: variable 'v15' is possibly undefined
// 8048054: variable 'v16' is possibly undefined
// 8048062: variable 'v17' is possibly undefined
// 8048073: variable 'a2' is possibly undefined
// 804809A: variable 'v5' is possibly undefined
// 804811A: using guessed type char byte_804811A;
// 804811B: using guessed type int dword_804811B;
// 804811F: using guessed type int dword_804811F;
// 8048123: using guessed type char byte_8048123;

//----- (08048106) --------------------------------------------------------
int __usercall sub_8048106@<eax>(_BYTE *a1@<esi>)
{
  int v1; // eax
  int i; // ebx

  v1 = 0;
  for ( i = 0; ; i = v1 + 10 * i )
  {
    LOBYTE(v1) = *a1++;
    if ( !(_BYTE)v1 )
      break;
    LOBYTE(v1) = v1 - 48;
  }
  return i;
}

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
