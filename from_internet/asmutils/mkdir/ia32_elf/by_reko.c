// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register word24 edx_24_8, Stack word32 dwArg00, Stack (ptr32 Eq_4) dwArg04)
void fn0804804C(word24 edx_24_8, word32 dwArg00, struct Eq_4 * dwArg04)
{
	ptr32 fp;
	struct Eq_6 * esp_11 = fp + 4;
	Eq_9 eax_118 = dwArg00 - 0x01;
	word24 eax_24_8_178 = SLICE(dwArg00 - 0x01, word24, 8);
	if (dwArg00 != 0x01)
	{
		struct Eq_4 * esi_10 = dwArg04;
		esp_11 = fp + 8;
		do
		{
			byte al_14 = esi_10->t0000.u0;
			++esi_10;
			eax_118 = SEQ(eax_24_8_178, al_14);
		} while (al_14 != 0x00);
		struct Eq_4 * edi_103 = esi_10;
		Eq_9 ecx_158 = 0x01ED;
		word32 ebp_170 = 0x00;
		while (true)
		{
			while (true)
			{
				struct Eq_6 * esp_30 = esp_11 + 1;
				struct Eq_4 * esi_105 = esp_11->dw0000;
				esp_30->dwFFFFFFFC = esi_105;
				struct Eq_6 * esp_113 = esp_30 - 4;
				if (esi_105->t0000.u1 != 0x702D)
					break;
				++ebp_170;
				esp_11 = esp_30;
			}
			if (esi_105->t0000.u1 != 0x6D2D)
				break;
			Eq_76 esi_121 = esp_30->dw0000;
			esp_11 = esp_30 + 1;
			Eq_76 esi_123 = esi_121;
			if (esi_121 == 0x00)
				goto l08048050;
			esp_30->dw0000 = (word32) 0x08;
			eax_118 = 0x00;
			Eq_76 bl_212 = esp_30->dw0000;
			esp_11 = esp_30 + 1;
			while (true)
			{
				bu8 al_160 = (byte) eax_118;
				word16 eax_16_16_162 = SLICE(eax_118, word16, 16);
				edx_24_8 = SLICE(esi_121, word24, 8);
				cu8 cl_140 = *esi_123.u1;
				if (cl_140 < 0x30)
					break;
				uint32 ecx_165 = (uint32) (cl_140 - 0x30);
				if (cl_140 > 55 || cl_140 < 0x30)
					break;
				eax_118 = SEQ(eax_16_16_162, bl_212 *16 al_160) + ecx_165;
				esi_123.u1 = (word32) esi_123 + 1;
			}
			if (esi_121 == esi_123 || eax_118 == 0x00)
				goto l08048050;
			ecx_158 = eax_118;
		}
		while (true)
		{
			word24 eax_24_8_200 = SLICE(eax_118, word24, 8);
			struct Eq_4 * ebx_39 = esp_113->dw0000;
			esp_11 = esp_113 + 1;
			if (ebx_39 == null)
				break;
			if (edi_103->wFFFFFFFA != 28018)
			{
				struct Eq_4 * esi_107;
				esp_11->dwFFFFFFFC = edi_103;
				word32 * esp_109 = esp_11 - 4;
				word32 edx_59 = SEQ(edx_24_8, 0x01);
				if (ebp_170 == 0x00)
				{
					while (true)
					{
						word32 * esp_82 = esp_109 - 4;
						*esp_82 = 0x27;
						eax_118 = sys_mkdir(ebx_39, ecx_158);
						esp_109 = esp_82 + 1;
						eax_24_8_200 = SLICE(eax_118, word24, 8);
						edx_24_8 = SLICE(edx_59, word24, 8);
						if (edx_59 != 0x00)
							break;
						edi_103->t0000.u0 = 0x2F;
						esi_107 = esi_105 + 1;
l080480D9:
						eax_118 = SEQ(eax_24_8_200, 0x2F);
						edx_59 = 0x00;
						if (!fn080480EE(0x2F, esi_107, out esi_105))
						{
							edx_59 = 0x01;
							edx_24_8 = 0x00;
							if (esi_105 == esi_107)
								break;
						}
						esi_105->t0000.u0 = 0x00;
						edi_103 = esi_105;
					}
					edi_103 = *esp_109;
					esp_113 = (struct Eq_6 *) (esp_109 + 1);
					continue;
				}
				else
				{
					esi_107 = ebx_39;
					goto l080480D9;
				}
			}
			esp_11->dwFFFFFFFC = 0x28;
			esp_113 = esp_11;
			eax_118 = sys_rmdir(ebx_39);
		}
	}
l08048050:
	esp_11->dwFFFFFFFC = 0x01;
	sys_exit(eax_118);
}

// 080480EE: FlagGroup bool fn080480EE(Register byte al, Register (ptr32 Eq_4) esi, Register out (ptr32 Eq_170) esiOut)
// Called from:
//      fn0804804C
bool fn080480EE(byte al, struct Eq_4 * esi, struct Eq_170 & esiOut)
{
	word32 eax;
	byte al_7 = (byte) eax;
	do
	{
		byte al_12 = esi->t0000.u0;
		++esi;
		bool C_17 = false;
		if (al_12 == 0x00)
			goto l080480FC;
	} while (al_12 != al_7);
	C_17 = true;
l080480FC:
	esiOut = esi - 0x01;
	return C_17;
}

