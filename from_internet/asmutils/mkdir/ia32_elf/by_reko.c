// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register word24 edx_24_8, Stack word32 dwArg00)
void fn0804804C(word24 edx_24_8, word32 dwArg00)
{
	struct Eq_4 * esp_11 = fp + 4;
	if (dwArg00 == 0x01)
	{
l08048050:
		word32 * esp_12 = esp_11 - 4;
		*esp_12 = 0x01;
		__syscall(0x80);
		esp_11 = (struct Eq_4 *) (esp_12 + 1);
	}
	struct Eq_10 * esi_18 = esp_11->dw0000;
	++esp_11;
	do
	{
		byte al_22 = esi_18->t0000;
		++esi_18;
	} while (al_22 != 0x00);
	struct Eq_10 * edi_106 = esi_18;
	word32 ebp_160 = 0x00;
	do
	{
		while (true)
		{
			struct Eq_4 * esp_36 = esp_11 + 1;
			struct Eq_10 * esi_100 = esp_11->dw0000;
			esp_36->dwFFFFFFFC = esi_100;
			struct Eq_4 * esp_107 = esp_36 - 4;
			if (esi_100->t0000 != 0x702D)
				break;
			++ebp_160;
			esp_11 = esp_36;
		}
		if (esi_100->t0000 != 0x6D2D)
		{
			while (true)
			{
				struct Eq_10 * ebx_45 = esp_107->dw0000;
				esp_11 = esp_107 + 1;
				if (ebx_45 == null)
					break;
				if (edi_106->wFFFFFFFA != 28018)
				{
					struct Eq_10 * esi_101;
					esp_11->dwFFFFFFFC = edi_106;
					word32 * esp_103 = esp_11 - 4;
					word32 edx_63 = SEQ(edx_24_8, 0x01);
					if (ebp_160 == 0x00)
					{
						while (true)
						{
							word32 * esp_85 = esp_103 - 4;
							*esp_85 = 0x27;
							__syscall(0x80);
							esp_103 = esp_85 + 1;
							edx_24_8 = SLICE(edx_63, word24, 8);
							if (edx_63 != 0x00)
								break;
							edi_106->t0000.u0 = 0x2F;
							esi_101 = esi_100 + 1;
l080480D9:
							edx_63 = 0x00;
							if (!fn080480EE(0x2F, esi_101, out esi_100))
							{
								edx_63 = 0x01;
								edx_24_8 = 0x00;
								if (esi_100 == esi_101)
									break;
							}
							esi_100->t0000.u0 = 0x00;
							edi_106 = esi_100;
						}
						edi_106 = *esp_103;
						esp_107 = (struct Eq_4 *) (esp_103 + 1);
						continue;
					}
					else
					{
						esi_101 = ebx_45;
						goto l080480D9;
					}
				}
				esp_11->dwFFFFFFFC = 0x28;
				__syscall(0x80);
				esp_107 = esp_11;
			}
			break;
		}
		Eq_74 esi_114 = esp_36->dw0000;
		esp_11 = esp_36 + 1;
		Eq_74 esi_116 = esi_114;
		if (esi_114 == 0x00)
			break;
		esp_36->dw0000 = (word32) 0x08;
		word32 eax_122 = 0x00;
		Eq_74 bl_196 = esp_36->dw0000;
		esp_11 = esp_36 + 1;
		while (true)
		{
			bu8 al_150 = (byte) eax_122;
			word16 eax_16_16_152 = SLICE(eax_122, word16, 16);
			edx_24_8 = SLICE(esi_114, word24, 8);
			cu8 cl_131 = *esi_116;
			if (cl_131 < 0x30)
				break;
			uint32 ecx_155 = (uint32) (cl_131 - 0x30);
			if (cl_131 > 55)
				break;
			eax_122 = SEQ(eax_16_16_152, bl_196 *16 al_150) + ecx_155;
			esi_116 = (word32) esi_116 + 1;
		}
	} while (esi_114 != esi_116 && eax_122 != 0x00);
	goto l08048050;
}

// 080480EE: FlagGroup bool fn080480EE(Register byte al, Register (ptr32 Eq_10) esi, Register out (ptr32 Eq_161) esiOut)
// Called from:
//      fn0804804C
bool fn080480EE(byte al, struct Eq_10 * esi, struct Eq_161 & esiOut)
{
	byte al_6 = (byte) eax;
	do
	{
		byte al_11 = esi->t0000;
		++esi;
		bool C_15 = false;
		if (al_11 == 0x00)
			goto l080480FC;
	} while (al_11 != al_6);
	C_15 = true;
l080480FC:
	esiOut = esi - 0x01;
	return C_15;
}

