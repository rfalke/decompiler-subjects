// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register byte ah, Stack word32 dwArg00)
void fn0804804C(byte ah, word32 dwArg00)
{
	struct Eq_4 * esp_112 = fp + 8;
	if (dwArg00 != 0x01)
	{
l08048059:
		struct Eq_14 * ebx_16 = esp_112->dw0000;
		++esp_112;
		if (ebx_16 != null)
		{
			byte * esi_28 = &ebx_16->b0001;
			if (ebx_16->b0000 == 0x2D && ebx_16->b0001 != 0x00)
			{
				do
				{
					byte al_41 = *esi_28;
					++esi_28;
					if (al_41 == 0x00)
						goto l08048059;
					if (al_41 == 0x41)
						ah |= 0x07;
					if (al_41 == 0x62)
						ah |= 0x30;
					if (al_41 == 101)
						ah |= 0x06;
					if (al_41 == 0x45)
						ah |= 0x02;
					if (al_41 == 110)
						ah |= 0x10;
					if (al_41 == 115)
						ah |= 0x08;
					if (al_41 == 116)
						ah |= 0x05;
					if (al_41 == 0x54)
						ah |= 0x01;
					if (al_41 == 118)
						ah |= 0x04;
				} while (al_41 != 0x2D);
				g_b804C2B8 = ah;
			}
			else
			{
				esp_112->dwFFFFFFFC = ebx_16;
				g_b804C2B8 = ah;
				esp_112 -= 4;
			}
l080480CA:
			while (true)
			{
l080480CA:
				word16 * ebx_114 = esp_112->dw0000;
				++esp_112;
				if (ebx_114 == null)
					break;
				if (*ebx_114 == 0x2D)
					goto l080480E6;
				esp_112->dwFFFFFFFC = 0x05;
				int32 eax_148 = esp_112->dwFFFFFFFC;
				__syscall(0x80);
				if (eax_148 >= 0x00)
					goto l080480E6;
l080480E3:
			}
			if (g_ptr804C2B0 != null)
			{
				esp_112->dwFFFFFFFC = 0x01;
				esp_112->dwFFFFFFFC = 0x04;
				__syscall(0x80);
			}
			esp_112->dwFFFFFFFC = 0x01;
			__syscall(0x80);
l0804812F:
			byte * esi_160 = &g_b80482AC;
			while (true)
			{
				cu8 al_173 = (byte) eax_162;
				word16 eax_16_16_240 = SLICE(eax_162, word16, 16);
				word32 eax_162;
				if (fn080481E2(esi_160, out eax_162, out esi_160))
					break;
				byte ah_172 = g_b804C2B8;
				if (al_173 != 0x0A)
				{
					word32 eax_274;
					if (al_173 == 0x09)
					{
						eax_274 = SEQ(eax_16_16_240, ah_172, al_173);
						if ((ah_172 & 0x01) != 0x00)
						{
l08048178:
							word32 * esp_273 = esp_112 - 4;
							*esp_273 = eax_274;
							byte bl_422;
							word32 edi_423;
							fn08048202(SLICE(eax_274, byte, 8), 0x5E, out bl_422, out edi_423);
							word32 eax_291 = *esp_273;
							ah_172 = SLICE(eax_291, byte, 8);
							al_173 = (byte) eax_291 + 0x40;
						}
l0804816C:
						byte bl_416;
						word32 edi_417;
						fn08048202(ah_172, al_173, out bl_416, out edi_417);
						continue;
					}
					else
					{
						word32 eax_241 = SEQ(eax_16_16_240, ah_172, al_173);
						if ((ah_172 & 0x04) == 0x00)
							goto l0804816C;
						word32 eax_413 = SEQ(eax_16_16_240, ah_172, al_173);
						if (al_173 >= 0x80)
						{
							word32 * esp_239 = esp_112 - 4;
							*esp_239 = eax_241;
							byte bl_418;
							word32 edi_419;
							byte bl_420;
							word32 edi_421;
							fn08048202(SLICE(fn08048202(ah_172, 77, out bl_418, out edi_419), byte, 8), 0x2D, out bl_420, out edi_421);
							word32 eax_262 = *esp_239;
							eax_413 = SEQ(SLICE(eax_262, word24, 8), (byte) eax_262 & 0x7F);
						}
						ah_172 = (byte) SLICE(eax_413, word24, 8);
						al_173 = (byte) eax_413;
						eax_274 = eax_413;
						if (al_173 >= 0x20)
							goto l0804816C;
						goto l08048178;
					}
				}
				if ((ah_172 & 0x08) == 0x00 || (g_b804C2BA != 0x0A || g_b804C2BB != 0x0A))
				{
					if ((ah_172 & 0x02) != 0x00)
					{
						word32 ebx_191 = <invalid>;
						word32 edi_425;
						byte bl_424;
						ah_172 = SLICE(fn08048202(ah_172, 0x24, out bl_424, out edi_425), byte, 8);
						g_b804C2BA = (byte) ebx_191;
						al_173 = 0x0A;
					}
					if ((ah_172 & 0x20) != 0x00 && g_b804C2BA == al_173)
						++g_b804C2B9;
					byte bl_426;
					word32 edi_427;
					fn08048202(ah_172, al_173, out bl_426, out edi_427);
					--g_b804C2B9;
				}
			}
			goto l080480CA;
		}
		esp_112->dwFFFFFFFC = ebx_16;
		g_b804C2B8 = ah;
		esp_112 -= 4;
	}
l080480E6:
	while (g_b804C2B8 == 0x00)
	{
		int32 * esp_314 = esp_112 - 4;
		*esp_314 = 0x03;
		int32 eax_316 = *esp_314;
		__syscall(0x80);
		esp_112 = (struct Eq_4 *) (esp_314 + 1);
		if (eax_316 < 0x00)
			goto l080480E3;
		if (eax_316 == 0x00)
			goto l080480CA;
		*esp_314 = 0x01;
		*esp_314 = 0x04;
		__syscall(0x80);
		esp_112 = (struct Eq_4 *) (esp_314 + 1);
	}
	goto l0804812F;
}

// 080481DB: FlagGroup byte fn080481DB(Register int32 eax, Register out ptr32 eaxOut, Register out ptr32 esiOut)
// Called from:
//      fn080481E2
byte fn080481DB(int32 eax, ptr32 & eaxOut, ptr32 & esiOut)
{
	g_dw804C2AC = eax;
	ptr32 esi_8;
	ptr32 eax_10;
	fn080481E2(esi, out eax_10, out esi_8);
	eaxOut = eax_10;
	esiOut = esi_8;
	return <invalid>;
}

// 080481E2: FlagGroup bool fn080481E2(Register (ptr32 byte) esi, Register out ptr32 eaxOut, Register out (ptr32 byte) esiOut)
// Called from:
//      fn0804804C
//      fn080481DB
bool fn080481E2(byte * esi, ptr32 & eaxOut, byte & esiOut)
{
	int32 v3_4 = g_dw804C2AC - 0x01;
	g_dw804C2AC = v3_4;
	bool S_7 = (bool) cond(v3_4);
	if (v3_4 < 0x00)
	{
		__syscall(0x80);
		eaxOut = 0x02;
		esiOut = esi;
		return (bool) cond(0x02);
	}
	else
	{
		eaxOut = SEQ(eax_24_8, *esi);
		esiOut = esi + 1;
		return S_7;
	}
}

// 08048202: Register word32 fn08048202(Register byte ah, Register cu8 al, Register out Eq_160 blOut, Register out Eq_160 ediOut)
// Called from:
//      fn0804804C
//      fn08048202
word32 fn08048202(byte ah, cu8 al, union Eq_160 & blOut, union Eq_160 & ediOut)
{
	word24 eax_24_8_161 = SEQ(eax_16_16, ah);
	if ((ah & 0x10) != 0x00)
	{
		eax_24_8_161 = SEQ(eax_16_16, ah);
		if (g_b804C2B9 == 0x00)
		{
			++g_b804C2B9;
			word32 eax_21 = g_dw804C2B4;
			g_dw804C2B4 = eax_21 + 0x01;
			uint32 eax_22 = eax_21 + 0x01;
			struct Eq_432 * esp_27 = fp - 8;
			word32 edi_28 = 0x00;
			do
			{
				uint64 edx_eax_33 = (uint64) eax_22;
				uint32 edx_36 = (uint32) (edx_eax_33 % 0x0A);
				esp_27 -= 4;
				esp_27->dw0000 = SEQ(SLICE(edx_36, word24, 8), (byte) edx_36 + 0x30);
				uint32 eax_37 = (uint32) (edx_eax_33 /u 0x0A);
				++edi_28;
				eax_22 = eax_37;
				word16 eax_16_16_154 = SLICE(eax_37, word16, 16);
			} while (eax_37 != 0x00);
			esp_27->dwFFFFFFFC = 0x06;
			struct Eq_432 * esp_54 = esp_27;
			up32 ebx_55 = esp_27->dwFFFFFFFC - edi_28;
			if (ebx_55 > 0x00)
			{
				do
				{
					esp_27->dwFFFFFFFC = ebx_55;
					word32 edi_202;
					byte bl_201;
					eax_16_16_154 = SLICE(fn08048202(SLICE(eax_16_16_154, byte, 8), 0x20, out bl_201, out edi_202), word16, 16);
					word32 ebx_73 = esp_27->dwFFFFFFFC;
					esp_54 = esp_27;
					ebx_55 = ebx_73 - 0x01;
				} while (ebx_73 != 0x01);
			}
			do
			{
				struct Eq_432 * esp_81 = esp_54 + 1;
				word32 eax_80 = esp_54->dw0000;
				esp_54 = esp_81;
				word32 edi_84;
				byte bl_200;
				word16 eax_16_16_95 = SLICE(fn08048202(SLICE(eax_80, byte, 8), (byte) eax_80, out bl_200, out edi_84), word16, 16);
			} while (edi_84 != 0x01);
			byte bl_203;
			word32 edi_204;
			byte bl_205;
			word32 edi_206;
			fn08048202(SLICE(SLICE(fn08048202(SLICE(eax_16_16_95, byte, 8), 0x20, out bl_203, out edi_204), word16, 16), byte, 8), 0x20, out bl_205, out edi_206);
			word32 eax_113 = esp_81->dw0000;
			g_b804C2BA = SLICE(eax_113, byte, 8);
			al = (byte) eax_113;
			eax_24_8_161 = SLICE(eax_113, word24, 8);
		}
	}
	struct Eq_108 * edi_118 = g_ptr804C2B0;
	edi_118->b804A2AC = al;
	g_ptr804C2B0 = (struct Eq_108 *) ((char *) g_ptr804C2B0 + 1);
	cu8 v19_126 = g_b804C2BA;
	g_b804C2BA = al;
	g_b804C2BB = v19_126;
	word32 eax_144 = SEQ(eax_24_8_161, v19_126);
	if (edi_118 >= (struct Eq_108 *) 0x1FFF)
	{
		__syscall(0x80);
		g_ptr804C2B0 = null;
		eax_144 = 0x00;
	}
	blOut.u1 = <invalid>;
	ediOut.u1 = <invalid>;
	return eax_144;
}

byte g_b80482AC = 0x00; // 080482AC
int32 g_dw804C2AC = 0; // 0804C2AC
struct Eq_108 * g_ptr804C2B0 = null; // 0804C2B0
word32 g_dw804C2B4 = 0x00; // 0804C2B4
byte g_b804C2B8 = 0x00; // 0804C2B8
byte g_b804C2B9 = 0x00; // 0804C2B9
cu8 g_b804C2BA = 0x00; // 0804C2BA
cu8 g_b804C2BB = 0x00; // 0804C2BB
