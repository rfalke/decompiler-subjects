/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall sub_8048054@<eax>(int@<eax>);
void __cdecl __noreturn start();

//-------------------------------------------------------------------------
// Data declarations

char filename[9] = "nohup.out"; // idb
int fd; // idb


//----- (08048054) --------------------------------------------------------
int __usercall sub_8048054@<eax>(int a1@<eax>)
{
  int result; // eax
  int v2; // eax

  result = sys_ioctl(a1, 21505);
  if ( result >= 0 )
  {
    v2 = sys_close(a1);
    return sys_dup(fd);
  }
  return result;
}

//----- (0804807C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __cdecl __noreturn start()
{
  int v0; // eax
  const char **v1; // ebp
  int v2; // eax
  int v3; // ecx
  const char *v4; // esi
  int v5; // eax
  _BYTE *v6; // esi
  char v7; // al
  const char *v8; // esi
  int v9; // eax
  int v10; // eax
  int i; // ecx
  const char *v12; // esi
  int v13; // eax
  _BYTE *v14; // esi
  char v15; // al
  const char *v16; // esi
  unsigned int j; // ecx
  _BYTE *v18; // edi
  char v19; // al
  const char *v20; // esi
  _BYTE *v21; // edi
  char v22; // al
  unsigned int v23; // edi
  int v24; // eax
  int v25; // [esp-8h] [ebp-8h]
  const char *v26; // [esp-4h] [ebp-4h]
  const char *retaddr; // [esp+0h] [ebp+0h] BYREF

  v1 = &(&retaddr)[v25];
  if ( v25 != 1 )
  {
    __asm { int     80h; LINUX - sys_signal }
    v2 = sys_open(filename, 1090, 0x180u);
    if ( v2 >= 0 )
      goto LABEL_7;
    v3 = 0;
    do
    {
      do
      {
        v4 = v1[v3++];
        v5 = *(_DWORD *)v4;
        v6 = v4 + 4;
      }
      while ( v5 != 1162694472 );
      v7 = *v6;
      v8 = v6 + 1;
    }
    while ( v7 != 61 );
    v9 = sys_chdir(v8);
    v2 = sys_open(filename, 1090, 0x180u);
    if ( v2 >= 0 )
    {
LABEL_7:
      fd = v2;
      sub_8048054(1);
      sub_8048054(2);
      v10 = sys_close(fd);
      for ( i = 0; ; ++i )
      {
        v12 = v1[i];
        if ( !v12 )
          break;
        v13 = *(_DWORD *)v12;
        v14 = v12 + 4;
        if ( v13 == 1213481296 )
        {
          v15 = *v14;
          v16 = v14 + 1;
          if ( v15 == 61 )
          {
            for ( j = ~(strlen(v16) + 1) + ~(strlen(retaddr) + 1); ; j = v23 )
            {
              v18 = (char *)&retaddr + j;
              do
              {
                v19 = *v16++;
                if ( v19 == 58 )
                  break;
                *v18++ = v19;
              }
              while ( v19 );
              v26 = v16;
              v20 = retaddr;
              *v18 = 47;
              v21 = v18 + 1;
              do
              {
                v22 = *v20++;
                *v21++ = v22;
              }
              while ( v22 );
              v23 = j;
              v16 = v26;
              v24 = sys_execve((const char *)&retaddr + j, &retaddr, v1);
            }
          }
        }
      }
    }
  }
  v0 = sys_exit(1);
}
// 804804C: positive sp value 8 has been found
// 804807D: variable 'v25' is possibly undefined

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
