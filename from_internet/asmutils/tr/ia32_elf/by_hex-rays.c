/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(__int64@<edx:eax>, int@<edi>);
// int __usercall sub_8048172@<eax>(__int64@<edx:eax>, _BYTE *@<ebp>, char *@<esi>);
int sub_804823A(void); // weak
// __int64 __usercall sub_804823D@<edx:eax>(__int64 result@<edx:eax>);

//-------------------------------------------------------------------------
// Data declarations

char byte_804824D; // weak
char byte_804824E; // weak
char byte_804824F; // weak
char byte_8048250; // weak
char byte_8048251[]; // weak
char byte_8048351[3]; // weak
char byte_8048451[3]; // weak
char byte_8048550; // weak
char byte_8048551[3]; // weak


//----- (0804804C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn start(__int64 a1@<edx:eax>, int a2@<edi>)
{
  int v2; // ebx
  int v3; // eax
  char *v4; // esi
  int v5; // ebx
  bool i; // zf
  char v7; // bl
  __int64 v8; // rax
  _BYTE *v9; // ebp
  int v10; // eax
  char *v11; // esi
  char *v12; // edi
  int v13; // ebx
  char v14; // cl
  int v15; // ebx
  char v16; // al
  int v17; // eax
  int v18; // eax
  _BYTE *v19; // [esp-8h] [ebp-8h]
  _BYTE *v20; // [esp-4h] [ebp-4h]
  int v21; // [esp-4h] [ebp-4h]

  LODWORD(a1) = 0;
  while ( 1 )
  {
    while ( 1 )
    {
      --a2;
      if ( !v19 )
        goto LABEL_12;
      if ( *(_WORD *)v19 != 29485 )
        break;
      ++BYTE1(a1);
    }
    if ( *(_WORD *)v19 != 25645 )
      break;
    LOBYTE(a1) = a1 + 1;
  }
  v2 = 0;
  byte_804824D = BYTE1(a1);
  byte_804824E = a1;
  if ( (_BYTE)a1 )
  {
    do
    {
      byte_8048251[v2] = a1;
      LOBYTE(v2) = v2 + 1;
    }
    while ( (_BYTE)v2 );
    v3 = sub_8048172(a1, v19, byte_8048351);
    v4 = byte_8048351;
    v5 = 0;
    for ( i = v3 == 0; !i; i = v3 == 0 )
    {
      LOBYTE(v5) = *v4;
      byte_8048251[v5] = 0;
      ++v4;
      --v3;
    }
    goto LABEL_19;
  }
  do
  {
    byte_8048251[v2] = v2;
    LOBYTE(v2) = v2 + 1;
  }
  while ( (_BYTE)v2 );
  LODWORD(v8) = sub_8048172(a1, v19, byte_8048351);
  v9 = v20;
  v21 = v8;
  if ( !v9 || (v10 = sub_8048172(v8, v9, byte_8048451), v21 != v10) )
  {
LABEL_12:
    v7 = 1;
    goto LABEL_28;
  }
  if ( v10 )
  {
    v11 = byte_8048351;
    v12 = byte_8048451;
    v13 = 0;
    do
    {
      LOBYTE(v13) = *v11++;
      v14 = *v12++;
      byte_8048251[v13] = v14;
      --v10;
    }
    while ( v10 );
  }
  while ( 1 )
  {
LABEL_19:
    if ( !sys_read(0, &byte_8048250, 1u) )
    {
      v7 = 0;
LABEL_28:
      v18 = sys_exit(v7);
    }
    v15 = 0;
    if ( !byte_804824E )
      break;
    LOBYTE(v15) = byte_8048250;
    if ( byte_8048251[v15] )
    {
      v16 = byte_8048250;
LABEL_24:
      if ( !byte_804824D || v16 != byte_804824F )
      {
        byte_804824F = v16;
        v17 = sys_write(1, &byte_804824F, 1u);
      }
    }
  }
  LOBYTE(v15) = byte_8048250;
  v16 = byte_8048251[v15];
  goto LABEL_24;
}
// 80480CE: positive sp value 10 has been found
// 804805B: conditional instruction was optimized away because %0x8.4!=0
// 8048054: variable 'v19' is possibly undefined
// 80480CD: variable 'v20' is possibly undefined
// 80480D8: variable 'v8' is possibly undefined
// 804824D: using guessed type char byte_804824D;
// 804824E: using guessed type char byte_804824E;
// 804824F: using guessed type char byte_804824F;
// 8048250: using guessed type char byte_8048250;

//----- (08048172) --------------------------------------------------------
int __usercall sub_8048172@<eax>(__int64 a1@<edx:eax>, _BYTE *a2@<ebp>, char *a3@<esi>)
{
  int v3; // ecx
  char *v4; // edi
  char v5; // cf
  char *v6; // edi
  int v7; // ecx
  int v8; // edx
  int v9; // eax
  char v10; // bl
  char v11; // bh
  char v12; // t1

  LODWORD(a1) = 0;
  v3 = 257;
  v4 = &byte_8048550;
  while ( 1 )
  {
    BYTE4(a1) = *a2;
    ++v4;
    ++a2;
    LODWORD(a1) = a1 + 1;
    if ( !--v3 || !BYTE4(a1) )
      break;
    if ( BYTE4(a1) == 92 )
    {
      ++a2;
      a1 = sub_804823D(a1);
      if ( v5 )
      {
        BYTE5(a1) = BYTE4(a1);
      }
      else
      {
        LODWORD(a1) = sub_804823A();
        if ( !v5 )
        {
          ++a2;
          LODWORD(a1) = sub_804823A();
          if ( !v5 )
          {
            ++a2;
            BYTE5(a1) = BYTE4(a1) | (8 * BYTE5(a1));
          }
        }
      }
      *v4 = BYTE5(a1);
    }
    else
    {
      *v4 = BYTE4(a1);
    }
  }
  v6 = byte_8048551;
  v7 = a1;
  v8 = 256;
  v9 = 0;
  while ( 1 )
  {
    LOBYTE(v8) = *v6++;
    if ( (_BYTE)v8 == 91 && v6[1] == 45 && v6[3] == 93 )
      break;
    *a3 = v8--;
    if ( v8 )
    {
      ++v9;
      ++a3;
LABEL_23:
      if ( --v7 )
        continue;
    }
    return v9 - 1;
  }
  v10 = *v6;
  v11 = v6[2];
  v6 += 4;
  if ( v10 > v11 )
  {
    v12 = v10;
    v10 = v11;
    v11 = v12;
  }
  while ( 1 )
  {
    *a3 = v10;
    ++v9;
    ++a3;
    if ( !--v8 )
      return v9 - 1;
    if ( ++v10 > v11 )
      goto LABEL_23;
  }
}
// 804819D: conditional instruction was optimized away because dl.1==5C
// 80481A2: conditional instruction was optimized away because dl.1==5C
// 80481A7: conditional instruction was optimized away because dl.1==5C
// 80481AC: conditional instruction was optimized away because dl.1==5C
// 80481B1: conditional instruction was optimized away because dl.1==5C
// 8048185: variable 'v3' is possibly undefined
// 80481B3: variable 'a1' is possibly undefined
// 80481B8: variable 'v5' is possibly undefined
// 804823A: using guessed type int sub_804823A(void);
// 8048550: using guessed type char byte_8048550;

//----- (0804823D) --------------------------------------------------------
__int64 __usercall sub_804823D@<edx:eax>(__int64 result@<edx:eax>)
{
  if ( SBYTE4(result) >= 48 && SBYTE4(result) <= 55 )
    BYTE4(result) -= 48;
  return result;
}

// nfuncs=4 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
