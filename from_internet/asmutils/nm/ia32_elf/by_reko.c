// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

Eq_23 g_t804804C = // 0804804C
	{
		0x00,
		'a',
	};
char g_b8048052 = 'E'; // 08048052
char g_b8048065 = ' '; // 08048065
// 08048097: void fn08048097(Register Eq_2 edx, Stack word32 dwArg00, Stack (ptr32 Eq_4) dwArg04)
void fn08048097(Eq_2 edx, word32 dwArg00, struct Eq_4 * dwArg04)
{
	ptr32 fp;
	struct Eq_4 * esi_100 = dwArg04;
	do
	{
		esi_100 = esi_156 + 1;
		esi_156 = esi_100;
	} while (esi_156->b0000 != 0x00);
	g_ptr80483BF = &g_t8048165;
	if (esi_100->wFFFFFFFD != 0x6D6E)
	{
		g_ptr80483BF = &g_t8048274;
		sys_write(0x01, &g_b8048065, 0x32);
		edx = 0x32;
	}
	struct Eq_23 * ebx_131;
	g_dw80483AF = dwArg00 - 0x01;
	struct Eq_28 * esp_124 = fp + 8;
	if (dwArg00 == 0x01)
	{
		ebx_131 = &g_t804804C;
l080480E0:
		g_ptr80483B3 = ebx_131;
		struct Eq_4 ** esp_49 = esp_124 - 4;
		*esp_49 = (struct Eq_4 **) (struct Eq_4 *) 0x05;
		Eq_88 eax_54 = sys_open(ebx_131, 0x00, edx);
		if (eax_54 >= 0x00)
		{
			g_t80483B7.u0 = (int32) eax_54;
			*esp_49 = (struct Eq_4 **) (struct Eq_4 *) 0x02;
			struct Eq_4 * edx_85 = *esp_49;
			*esp_49 = (struct Eq_4 **) (struct Eq_4 *) 0x13;
			int32 eax_95 = sys_lseek(eax_54, (uint64) edx_85, esi_100);
			*esp_49 = (struct Eq_4 **) (struct Eq_4 *) 0x02;
			esi_100 = (struct Eq_4 *) *esp_49;
			*esp_49 = (struct Eq_4 **) (struct Eq_4 *) 0x01;
			struct Eq_4 * edx_104 = *esp_49;
			int32 eax_113 = sys_mmap2();
			g_dw80483BB = eax_113;
			g_ptr80483BF();
			Eq_88 ebx_120 = g_t80483B7.u0;
			*esp_49 = (struct Eq_4 **) (struct Eq_4 *) 0x06;
			sys_close(ebx_120);
			esp_124 = (struct Eq_28 *) ((char *) esp_49 + 4);
		}
		else
		{
			*esp_49 = (struct Eq_4 **) (struct Eq_4 *) 0x01;
			struct Eq_4 * ebx_64 = *esp_49;
			*esp_49 = (struct Eq_4 **) (struct Eq_4 *) 0x04;
			sys_write(ebx_64, &g_b8048052, 0x13);
			fn0804822F(0x00);
			++g_dw80483C3;
			esp_124 = (struct Eq_28 *) ((char *) esp_49 + 4);
			edx = 0x00;
		}
	}
	struct Eq_23 * ebx_129 = esp_124->dw0000;
	++esp_124;
	ebx_131 = ebx_129;
	if (ebx_129 == null)
	{
		int32 ebx_136 = g_dw80483C3;
		esp_124->dwFFFFFFFC = 0x01;
		sys_exit(ebx_136);
	}
	goto l080480E0;
}

<anonymous> g_t8048165 = <code>; // 08048165
// 0804822F: void fn0804822F(Register byte dl)
// Called from:
//      fn08048097
void fn0804822F(byte dl)
{
	word32 edx;
	byte dl_47 = (byte) edx;
	struct Eq_23 * esi_28 = g_ptr80483B3;
	struct Eq_23 * edi_136 = esi_28;
	word32 ecx_33 = ~0x00;
	while (ecx_33 != 0x00)
	{
		++edi_136;
		--ecx_33;
		if (edi_136->b0000 != 0x00)
			break;
	}
	Eq_39 ecx_44 = ~ecx_33;
	if (dl_47 != 0x00)
		edi_136->bFFFFFFFF = dl_47;
	sys_write(0x01, esi_28, ecx_44);
	edi_136->bFFFFFFFF = 0x00;
	fn08048260();
}

// 08048260: void fn08048260()
// Called from:
//      fn0804822F
void fn08048260()
{
	sys_write(0x01, &g_b8048273, 0x01);
}

char g_b8048273 = '\n'; // 08048273
<anonymous> g_t8048274 = <code>; // 08048274
word32 g_dw80483AF = 0x00; // 080483AF
struct Eq_23 * g_ptr80483B3 = null; // 080483B3
Eq_88 g_t80483B7 = // 080483B7
	{
		0
	};
int32 g_dw80483BB = 0; // 080483BB
<anonymous> * g_ptr80483BF = null; // 080483BF
int32 g_dw80483C3 = 0; // 080483C3
