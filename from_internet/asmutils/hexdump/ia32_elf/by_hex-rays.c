/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __fastcall __noreturn start(int, mode_t);
// char __usercall sub_80480D8@<al>(int@<eax>, _BYTE *@<edi>);

//-------------------------------------------------------------------------
// Data declarations

int dword_80480F0[17]; // weak


//----- (0804804C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall __noreturn start(int a1, mode_t a2)
{
  int v2; // ebx
  int v3; // ebx
  int v4; // eax
  int v5; // ebp
  char *v6; // esi
  int v7; // eax
  int v8; // ebp
  int v9; // et2
  int v10; // ecx
  int v11; // edx
  void (*v12)(void); // ecx
  char *v13; // edi
  char v14; // al
  int v15; // eax
  int v16; // eax
  int v17; // [esp-20h] [ebp-20h]
  int v18; // [esp-Ch] [ebp-Ch]
  int v19; // [esp-Ch] [ebp-Ch]
  char *v20; // [esp-4h] [ebp-4h]

  v2 = 0;
  if ( v18 == 1 )
    goto LABEL_5;
  while ( 1 )
  {
    v3 = (int)v20;
    if ( !v20 )
      goto LABEL_16;
    v4 = sys_open(v20, 0, a2);
    if ( v4 < 0 )
      break;
    v2 = v4;
LABEL_5:
    v5 = 0;
    do
    {
      memset(dword_80480F0, 32, 0x33u);
      v4 = sys_read(v2, (char *)&dword_80480F0[12] + 3, 0x10u);
      if ( v4 < 0 )
        goto LABEL_15;
      if ( !v4 )
        break;
      v19 = v5;
      v17 = v4;
      v6 = (char *)&dword_80480F0[12] + 3;
      v9 = v4;
      v7 = v5;
      v8 = v9;
      sub_80480D8(v7, dword_80480F0);
      ((void (*)(void))(v10 + 2))();
      LOBYTE(dword_80480F0[0]) = 58;
      v13 = (char *)dword_80480F0 + 1;
      do
      {
        v13 += v11 ^ 1;
        v14 = *v6++;
        if ( v14 == 127 || v14 < 32 )
          *(v6 - 1) = 46;
        v12();
        --v8;
      }
      while ( v8 );
      *v6 = 10;
      v5 = v17 + v19;
      v20 = (char *)v2;
    }
    while ( sys_write(1, dword_80480F0, v17 + 52) > 0 );
    v15 = sys_close(v2);
  }
LABEL_15:
  v3 = -v4;
LABEL_16:
  v16 = sys_exit(v3);
}
// 8048054: positive sp value C has been found
// 8048051: variable 'v18' is possibly undefined
// 8048053: variable 'v20' is possibly undefined
// 804805D: variable 'a2' is possibly undefined
// 8048093: variable 'v10' is possibly undefined
// 8048099: variable 'v11' is possibly undefined
// 80480AB: variable 'v12' is possibly undefined
// 80480F0: using guessed type int dword_80480F0[17];

//----- (080480D8) --------------------------------------------------------
char __usercall sub_80480D8@<al>(int a1@<eax>, _BYTE *a2@<edi>)
{
  char result; // al

  _EAX = __ROL4__(a1, 8);
  __asm { aam     10h }
  LOBYTE(_EAX) = BYTE1(_EAX);
  if ( BYTE1(_EAX) > 9u )
    LOBYTE(_EAX) = BYTE1(_EAX) + 7;
  result = _EAX + 48;
  *a2 = result;
  return result;
}

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
