// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register Eq_2 ebx, Stack word32 dwArg00, Stack (ptr32 byte) dwArg08)
void fn0804804C(Eq_2 ebx, word32 dwArg00, byte * dwArg08)
{
	ptr32 fp;
	Eq_2 ebp_38 = 0x1E;
	struct Eq_8 * esp_16 = fp + 4;
	if (dwArg00 != 0x01)
	{
		byte * esi_15 = dwArg08;
		esp_16 = fp + 0x0C;
		Eq_2 ebx_18 = 0x00;
		while (true)
		{
			cu8 al_24 = *esi_15;
			++esi_15;
			if (al_24 < 0x30)
				break;
			uint32 eax_80 = (uint32) (al_24 - 0x30);
			if (al_24 > 0x39 || al_24 < 0x30)
				break;
			ebx_18 = ebx_18 *s 0x0A + eax_80;
		}
		ebx = ebx_18;
		if (ebx_18 != 0x00)
			ebp_38 = ebx_18;
	}
	g_t804809B.u0 = (int32) ebp_38;
	word32 * esp_46 = esp_16 - 4;
	*esp_46 = 0x02;
	if (sys_fork() == 0x00)
	{
		while (true)
		{
			esp_16->dwFFFFFFFC = 0x01;
			sys_bdflush();
			sys_nanosleep(&g_t804809B, null);
		}
	}
	else
	{
		*esp_46 = 0x01;
		sys_exit(ebx);
	}
}

Eq_2 g_t804809B = // 0804809B
	{
		0
	};
