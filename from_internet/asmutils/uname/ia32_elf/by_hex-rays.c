/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __fastcall __noreturn start(int, unsigned int);

//-------------------------------------------------------------------------
// Data declarations

int dword_804804C = 1987210867; // weak
char byte_8048052 = '\n'; // weak
char byte_804810E; // weak
struct utsname utsbuf; // idb


//----- (08048053) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall __noreturn start(int a1, unsigned int a2)
{
  int v2; // ebx
  unsigned __int8 *v3; // esi
  unsigned __int8 v4; // al
  bool v5; // zf
  int v6; // ecx
  int *v7; // edi
  unsigned int v8; // edi
  int v9; // eax
  int v10; // ecx
  struct utsname *v11; // ebp
  char v12; // cf
  char *v13; // ecx
  int v14; // eax
  struct utsname *v15; // esi
  int v16; // edx
  char v17; // al
  int v18; // eax
  int v19; // eax
  int v20; // eax
  int v21; // [esp-Ch] [ebp-Ch]
  const char *v22; // [esp-8h] [ebp-8h]
  int v23; // [esp-8h] [ebp-8h]
  _BYTE *v24; // [esp-4h] [ebp-4h]

  v2 = v21 - 1;
  if ( v21 == 1 )
  {
    LOBYTE(a2) = 1;
    if ( *(_DWORD *)&v22[strlen(v22) - 4] == 1751347809 )
      LOBYTE(a2) = 16;
LABEL_15:
    v8 = a2;
    v2 = (int)&utsbuf;
    v9 = sys_newuname(&utsbuf);
    v11 = &utsbuf;
    do
    {
      v12 = v8 & 1;
      v8 >>= 1;
      if ( v12 )
      {
        v23 = v10;
        v13 = &byte_804810E;
        if ( byte_804810E )
          v14 = sys_write(1, &byte_804810E, 1u);
        *v13 = 32;
        v15 = v11;
        v16 = 0;
        do
        {
          v17 = v15->sysname[0];
          v15 = (struct utsname *)((char *)v15 + 1);
          ++v16;
        }
        while ( v17 );
        v2 = 1;
        v18 = sys_write(1, (char *)v15 - v16, v16 - 1);
        v10 = v23;
      }
      v11 = (struct utsname *)((char *)v11 + 65);
      --v10;
    }
    while ( v10 );
  }
  else
  {
    while ( 1 )
    {
      v3 = v24 + 1;
      if ( *v24 != 45 )
        break;
      while ( 1 )
      {
        v4 = *v3++;
        v5 = v4 == 0;
        if ( !v4 )
          break;
        v6 = 5;
        v7 = &dword_804804C;
        do
        {
          if ( !v6 )
            break;
          v5 = *(_BYTE *)v7 == v4;
          v7 = (int *)((char *)v7 + 1);
          --v6;
        }
        while ( !v5 );
        if ( v5 )
        {
          _bittestandset((int *)&a2, (char *)v7 - 1 - (char *)&dword_804804C);
        }
        else
        {
          if ( v4 != 97 )
            goto LABEL_23;
          LOBYTE(a2) = 63;
        }
      }
      if ( !(_BYTE)a2 )
        break;
      if ( !--v2 )
        goto LABEL_15;
    }
  }
LABEL_23:
  v19 = sys_write(v2, &byte_8048052, 1u);
  v20 = sys_exit(0);
}
// 804806D: positive sp value C has been found
// 8048055: variable 'v21' is possibly undefined
// 804805D: variable 'v22' is possibly undefined
// 804806D: variable 'v24' is possibly undefined
// 80480BF: variable 'v10' is possibly undefined
// 80480DA: variable 'v13' is possibly undefined
// 804804C: using guessed type int dword_804804C;
// 8048052: using guessed type char byte_8048052;
// 804810E: using guessed type char byte_804810E;

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
