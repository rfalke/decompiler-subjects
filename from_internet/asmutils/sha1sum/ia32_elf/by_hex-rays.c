/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(int@<edi>);
// int __usercall sub_8048109@<eax>(unsigned int@<eax>);
// int __usercall sub_804810F@<eax>(unsigned int@<eax>, unsigned int@<ecx>, int@<ebx>);
int __fastcall sub_804812A(int, int);
void sub_8048141();
int sub_804814B();
int sub_8048157();
int sub_8048161();
int sub_8048172();
void sub_804819A();
int sub_8048283();
void sub_8048290();
// int __usercall sub_804829F@<eax>(int@<edi>, unsigned int *@<esi>);
// void __usercall sub_80482B3(int@<eax>, int@<edi>);

//-------------------------------------------------------------------------
// Data declarations

int dword_80482F3; // weak
char byte_80482F7; // weak
int dword_804830F; // weak
char byte_8048313; // weak
char byte_8048327[]; // weak
int dword_8048363; // weak
char byte_8048367[]; // weak


//----- (0804804C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn start(int a1@<edi>)
{
  mode_t v1; // edx
  int v2; // eax
  int v3; // ebp
  int v4; // eax
  int v5; // eax
  unsigned int v6; // ecx
  int v7; // edx
  unsigned __int64 v8; // rt0
  unsigned int *v9; // esi
  int v10; // ecx
  unsigned int v11; // eax
  int v12; // ecx
  int v13; // eax
  int v14; // ecx
  char *v15; // [esp-4h] [ebp-4h]
  int v16; // [esp-4h] [ebp-4h]

  sub_8048172();
  while ( 1 )
  {
    do
    {
LABEL_2:
      if ( !v15 )
        v2 = sys_exit(0);
      dword_80482F3 = (int)v15;
      v3 = sys_open(v15, 0, v1);
    }
    while ( v3 < 0 );
    while ( 1 )
    {
      sub_8048283();
      v4 = sys_read(v3, byte_8048367, 0x40u);
      if ( v4 < 0 )
        goto LABEL_2;
      sub_80482B3(v4, a1);
      if ( v6 < 0x40 )
        break;
      sub_80482B3(v5, a1);
    }
    v7 = *(_DWORD *)&byte_8048327[-24];
    HIDWORD(v8) = *(_DWORD *)&byte_8048327[-28];
    LODWORD(v8) = v7;
    *(_DWORD *)&byte_8048327[56] = v8 >> 29;
    *(_DWORD *)&byte_8048327[60] = 8 * v7;
    sub_804819A();
    v9 = (unsigned int *)&byte_80482F7;
    v10 = 5;
    do
    {
      v11 = *v9++;
      v16 = v10;
      sub_8048109(v11);
      v10 = v16 - 1;
    }
    while ( v16 != 1 );
    sub_804812A(v10, 32);
    sub_804812A(v12, 32);
    sub_8048172();
    v15 = (char *)dword_80482F3;
    a1 = dword_80482F3;
    v13 = sys_write(1, (const void *)dword_80482F3, strlen((const char *)dword_80482F3));
    sub_804812A(v14, 10);
  }
}
// 8048055: positive sp value C has been found
// 8048057: variable 'v15' is possibly undefined
// 8048069: variable 'v1' is possibly undefined
// 8048093: variable 'v6' is possibly undefined
// 8048095: variable 'v5' is possibly undefined
// 80480D6: variable 'v12' is possibly undefined
// 80480FF: variable 'v14' is possibly undefined
// 80482F3: using guessed type int dword_80482F3;
// 80482F7: using guessed type char byte_80482F7;

//----- (08048109) --------------------------------------------------------
int __usercall sub_8048109@<eax>(unsigned int a1@<eax>)
{
  return sub_804810F(a1, 0x10u, 8);
}

//----- (0804810F) --------------------------------------------------------
int __usercall sub_804810F@<eax>(unsigned int a1@<eax>, unsigned int a2@<ecx>, int a3@<ebx>)
{
  unsigned int v3; // eax
  unsigned int v4; // et2
  int v5; // ebx
  unsigned int v7; // [esp-4h] [ebp-4h]

  v4 = a1 % a2;
  v3 = a1 / a2;
  v7 = v4;
  v5 = a3 - 1;
  if ( v5 )
    sub_804810F(v3, a2, v5);
  if ( v7 + 48 <= 0x39 )
    return sub_804812A(a2, v7 + 48);
  else
    return sub_804812A(a2, v7 + 87);
}
// 8048128: variable 'a2' is possibly undefined

//----- (0804812A) --------------------------------------------------------
int __fastcall sub_804812A(int a1, int a2)
{
  dword_8048363 = a2;
  return sys_write(1, &dword_8048363, 1u);
}
// 8048363: using guessed type int dword_8048363;

//----- (08048141) --------------------------------------------------------
void sub_8048141()
{
  ;
}

//----- (0804814B) --------------------------------------------------------
int sub_804814B()
{
  int result; // eax

  sub_8048141();
  return result;
}

//----- (08048157) --------------------------------------------------------
int sub_8048157()
{
  int result; // eax

  sub_8048141();
  return result;
}

//----- (08048161) --------------------------------------------------------
int sub_8048161()
{
  int result; // eax

  sub_8048141();
  return result;
}

//----- (08048172) --------------------------------------------------------
int sub_8048172()
{
  int result; // eax

  *(_DWORD *)&byte_80482F7 = 1732584193;
  *((_DWORD *)&byte_80482F7 + 1) = -271733879;
  *((_DWORD *)&byte_80482F7 + 2) = -1732584194;
  *((_DWORD *)&byte_80482F7 + 3) = 271733878;
  *((_DWORD *)&byte_80482F7 + 4) = -1009589776;
  result = 0;
  *((_DWORD *)&byte_80482F7 + 5) = 0;
  *((_DWORD *)&byte_80482F7 + 6) = 0;
  return result;
}
// 80482F7: using guessed type char byte_80482F7;

//----- (0804819A) --------------------------------------------------------
void sub_804819A()
{
  unsigned int v0; // ebx
  int v1; // esi
  int v2; // eax
  int v3; // edx
  unsigned int v4; // [esp-24h] [ebp-24h]

  qmemcpy(&byte_8048313, &byte_80482F7, 0x14u);
  v0 = 0;
  do
  {
    if ( v0 >= 0x10 )
    {
      v1 = v0 & 0xF;
      *(_DWORD *)&byte_8048327[4 * v1] = __ROL4__(
                                           *(_DWORD *)&byte_8048327[4 * v1] ^ *(_DWORD *)&byte_8048327[4 * (((_BYTE)v1 + 2) & 0xF)] ^ *(_DWORD *)&byte_8048327[4 * (((_BYTE)v1 + 8) & 0xF)] ^ *(_DWORD *)&byte_8048327[4 * (((v0 & 0xF) + 13) & 0xF)],
                                           1);
    }
    if ( v0 < 0x3C )
    {
      if ( v0 < 0x28 )
      {
        v4 = v0;
        if ( v0 < 0x14 )
          v2 = sub_804814B();
        else
          v2 = sub_8048157();
      }
      else
      {
        v4 = v0;
        v2 = sub_8048161();
      }
    }
    else
    {
      v4 = v0;
      v2 = sub_8048157();
    }
    *(_DWORD *)&byte_8048327[-4] = *(_DWORD *)&byte_8048327[-8];
    *(_DWORD *)&byte_8048327[-8] = *(_DWORD *)&byte_8048327[-12];
    *(_DWORD *)&byte_8048327[-12] = __ROL4__(*(_DWORD *)&byte_8048327[-16], 30);
    *(_DWORD *)&byte_8048327[-16] = *(_DWORD *)&byte_8048327[-20];
    *(_DWORD *)&byte_8048327[-20] = v3 + v2;
    v0 = v4 + 1;
  }
  while ( v4 + 1 < 0x50 );
  *(_DWORD *)&byte_8048327[-48] += *(_DWORD *)&byte_8048327[-20];
  *(_DWORD *)&byte_8048327[-44] += *(_DWORD *)&byte_8048327[-16];
  *(_DWORD *)&byte_8048327[-40] += *(_DWORD *)&byte_8048327[-12];
  *(_DWORD *)&byte_8048327[-36] += *(_DWORD *)&byte_8048327[-8];
  *(_DWORD *)&byte_8048327[-32] += *(_DWORD *)&byte_8048327[-4];
}
// 8048254: variable 'v3' is possibly undefined
// 80482F7: using guessed type char byte_80482F7;
// 8048313: using guessed type char byte_8048313;

//----- (08048283) --------------------------------------------------------
int sub_8048283()
{
  int result; // eax

  result = 0;
  memset(byte_8048367, 0, 0x40u);
  return result;
}

//----- (08048290) --------------------------------------------------------
void sub_8048290()
{
  memset(byte_8048327, 0, 0x40u);
}

//----- (0804829F) --------------------------------------------------------
int __usercall sub_804829F@<eax>(int a1@<edi>, unsigned int *a2@<esi>)
{
  _DWORD *v2; // edi
  int v3; // eax
  int v4; // ecx
  unsigned int v5; // eax
  int v7; // [esp-4h] [ebp-4h]

  sub_8048290();
  v2 = (_DWORD *)(a1 - 64);
  v4 = 16;
  v7 = v3;
  do
  {
    v5 = *a2++;
    *v2++ = _byteswap_ulong(v5);
    --v4;
  }
  while ( v4 );
  return v7;
}
// 80482AA: variable 'v3' is possibly undefined

//----- (080482B3) --------------------------------------------------------
void __usercall sub_80482B3(int a1@<eax>, int a2@<edi>)
{
  unsigned int v2; // eax
  int v3; // eax

  dword_804830F += a1;
  byte_8048367[a1] = 0x80;
  while ( 1 )
  {
    v2 = sub_804829F(a2, (unsigned int *)byte_8048367);
    if ( v2 < 0x40 )
      break;
    sub_804819A();
    if ( v3 == 64 )
      goto LABEL_7;
  }
  if ( v2 < 0x38 )
    return;
  sub_804819A();
LABEL_7:
  sub_8048283();
  sub_8048290();
}
// 80482D9: variable 'v3' is possibly undefined
// 804830F: using guessed type int dword_804830F;

// nfuncs=14 queued=14 decompiled=14 lumina nreq=0 worse=0 better=0
// ALL OK, 14 function(s) have been successfully decompiled
