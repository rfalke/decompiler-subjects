// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Stack word32 dwArg00)
void fn0804804C(word32 dwArg00)
{
	ptr32 fp;
	word32 ebp_10 = dwArg00;
	struct Eq_5 * esp_175 = fp + 8;
	struct Eq_8 * edi_14 = &g_t80481DA;
	while (true)
	{
		--ebp_10;
		if (ebp_10 == 0x00)
			break;
		byte * ebx_44 = esp_175->dw0000;
		++esp_175;
		if (*ebx_44 < 0x30 || *ebx_44 > 0x39)
		{
			uint32 ecx_51 = fn08048166(edi_14, out edi_14);
			if (*ebx_44 == 0x70)
			{
				edi_14 = fn08048174(ecx_51, edi_14);
				fn08048117(ecx_51);
				++esp_175;
				continue;
			}
			uint32 eax_103;
			if (*ebx_44 != 33 && (*ebx_44 != 0x7E && *ebx_44 != 110))
			{
				if (*ebx_44 == 100)
					continue;
				uint32 ecx_92 = fn08048166(edi_14, out edi_14);
				if (*ebx_44 != 0x2B)
				{
					if (*ebx_44 != 0x2D)
					{
						if (*ebx_44 != 0x2A && *ebx_44 != 0x78)
						{
							if (*ebx_44 != 0x2F)
							{
								if (*ebx_44 != 0x25)
								{
									if (*ebx_44 != 0x61)
									{
										if (*ebx_44 != 111)
										{
											if (*ebx_44 != 0x78 && *ebx_44 != 101)
												fn080481A4(&g_b80481D3, 0x07);
											eax_103 = ecx_92 ^ ecx_51;
										}
										else
											eax_103 = ecx_92 | ecx_51;
									}
									else
										eax_103 = ecx_92 & ecx_51;
								}
								else
									eax_103 = (uint32) ((uint64) ecx_92 % ecx_51);
							}
							else
								eax_103 = (uint32) ((uint64) ecx_92 /u ecx_51);
						}
						else
							eax_103 = ecx_51 * ecx_92;
					}
					else
						eax_103 = ecx_92 - ecx_51;
				}
				else
					eax_103 = ecx_92 + ecx_51;
			}
			else
				eax_103 = -ecx_51;
			edi_14 = fn08048174(eax_103, edi_14);
			++esp_175;
			continue;
		}
		edi_14 = fn08048147(ebx_44, edi_14);
	}
	word32 edi_196;
	fn08048117(fn08048166(edi_14, out edi_196));
	esp_175->dwFFFFFFFC = 0x01;
	sys_exit(0x00);
}

// 08048117: void fn08048117(Register uint32 eax)
// Called from:
//      fn0804804C
void fn08048117(uint32 eax)
{
	ptr32 fp;
	word32 ecx_26 = 0x00;
	word32 * esp_14 = fp - 4;
	byte * edi_15 = g_a80483DA;
	do
	{
		uint64 edx_eax_18 = (uint64) eax;
		esp_14 -= 4;
		*esp_14 = (uint32) (edx_eax_18 % 0x0A);
		uint32 eax_22 = (uint32) (edx_eax_18 /u 0x0A);
		++ecx_26;
		eax = eax_22;
	} while (eax_22 != 0x00);
	ecx_46 = ecx_26;
	do
	{
		word32 ecx_46;
		*edi_15 = 0x3A;
		++edi_15;
		--ecx_46;
	} while (ecx_46 != 0x00);
	*edi_15 = 0x0A;
	sys_write(0x01, g_a80483DA, ecx_26 + 0x01);
}

// 08048147: Register (ptr32 Eq_8) fn08048147(Register (ptr32 byte) ebx, Register (ptr32 Eq_8) edi)
// Called from:
//      fn0804804C
struct Eq_8 * fn08048147(byte * ebx, struct Eq_8 * edi)
{
	uint32 eax_20 = 0x00;
	while (true)
	{
		ci8 cl_11 = *ebx;
		if (cl_11 < 0x30)
			break;
		uint32 ecx_34 = (uint32) (cl_11 - 0x30);
		if (cl_11 > 0x39)
			return fn08048174(eax_20, edi);
		eax_20 = eax_20 * 0x0A + ecx_34;
		++ebx;
	}
	return fn08048174(eax_20, edi);
}

// 08048166: Register word32 fn08048166(Register (ptr32 Eq_8) edi, Register out ptr32 ediOut)
// Called from:
//      fn0804804C
word32 fn08048166(struct Eq_8 * edi, ptr32 & ediOut)
{
	if (edi <= &g_t80481DA)
		fn080481A4(&g_b80481C3, 0x10);
	else
	{
		word32 ecx_12 = edi->dwFFFFFFFC;
		ediOut = edi - 0x04;
		return ecx_12;
	}
}

// 08048174: Register (ptr32 Eq_8) fn08048174(Register uint32 eax, Register (ptr32 Eq_8) edi)
// Called from:
//      fn0804804C
//      fn08048147
struct Eq_8 * fn08048174(uint32 eax, struct Eq_8 * edi)
{
	if (edi >= &g_t804825A)
		fn080481A4(&g_b80481B4, 0x0F);
	else
	{
		edi->dw0000 = eax;
		return &edi->dw0000 + 1;
	}
}

// 080481A4: void fn080481A4(Register (ptr32 char) ecx, Register Eq_168 edx)
// Called from:
//      fn0804804C
//      fn08048147
//      fn08048166
void fn080481A4(char * ecx, Eq_168 edx)
{
	sys_write(0x02, ecx, edx);
	sys_exit(0x01);
}

char g_b80481B4 = 'S'; // 080481B4
char g_b80481C3 = 'S'; // 080481C3
char g_b80481D3 = 'B'; // 080481D3
Eq_8 g_t80481DA = // 080481DA
	{
		0x0A706F20,
		0x00,
	};
Eq_8 g_t804825A = // 0804825A
	{
		0x00,
		0x00,
	};
byte g_a80483DA[] = // 080483DA
	{
	};
