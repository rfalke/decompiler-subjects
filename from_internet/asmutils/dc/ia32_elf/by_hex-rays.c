/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void start();
// int __usercall sub_8048117@<eax>(unsigned int@<eax>);
// int __usercall sub_8048147@<eax>(_BYTE *@<ebx>, _DWORD *@<edi>);
// void __usercall sub_8048166(int@<edi>);
// int __usercall sub_8048174@<eax>(int result@<eax>, _DWORD *@<edi>);

//-------------------------------------------------------------------------
// Data declarations

int dword_80481B4[3] = { 1667331155, 1986994283, 1818653285 }; // weak
__int16 word_80481DA; // weak
__int16 word_804825A; // weak
__int16 word_80483DA; // weak


//----- (0804804C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void start()
{
  int v0; // ebp
  unsigned int v1; // ecx
  int v2; // eax
  int v3; // eax
  int v4; // eax
  int v5; // ecx
  unsigned int v6; // eax
  unsigned int v7; // ecx
  unsigned int v8; // eax
  unsigned int v9; // ecx
  unsigned int v10; // et2
  int v11; // [esp-Ch] [ebp-Ch]
  char *v12; // [esp-4h] [ebp-4h]

  v0 = v11;
  while ( 1 )
  {
    while ( 1 )
    {
      while ( 1 )
      {
        if ( !--v0 )
        {
          sub_8048166((int)&word_80481DA);
          sub_8048117(v1);
          v2 = sys_exit(0);
        }
        if ( *v12 < 48 || *v12 > 57 )
          break;
        sub_8048147(v12, &word_80481DA);
      }
      sub_8048166((int)&word_80481DA);
      if ( *v12 != 112 )
        break;
      v3 = sub_8048174(v5, &word_80481DA);
      sub_8048117(v3);
    }
    if ( *v12 == 33 || *v12 == 126 || *v12 == 110 )
      break;
    if ( *v12 != 100 )
    {
      sub_8048166((int)&word_80481DA);
      v10 = v6;
      v8 = v7;
      v9 = v10;
      switch ( *v12 )
      {
        case '+':
          v4 = v9 + v8;
          break;
        case '-':
          v4 = v8 - v9;
          break;
        case '*':
        case 'x':
          v4 = v9 * v8;
          break;
        default:
          switch ( *v12 )
          {
            case '/':
              v4 = v8 / v9;
              break;
            case '%':
              v4 = v8 % v9;
              break;
            case 'a':
              v4 = v9 & v8;
              break;
            case 'o':
              v4 = v9 | v8;
              break;
            case 'x':
            case 'e':
              v4 = v9 ^ v8;
              break;
            default:
              JUMPOUT(0x804819A);
          }
          break;
      }
LABEL_25:
      sub_8048174(v4, &word_80481DA);
    }
  }
  v4 = -v5;
  goto LABEL_25;
}
// 8048057: positive sp value C has been found
// 80480E1: control flows out of bounds to 804819A
// 804804C: variable 'v11' is possibly undefined
// 8048057: variable 'v12' is possibly undefined
// 804806E: variable 'v1' is possibly undefined
// 804807A: variable 'v5' is possibly undefined
// 80480AE: variable 'v6' is possibly undefined
// 80480AE: variable 'v7' is possibly undefined
// 80481DA: using guessed type __int16 word_80481DA;

//----- (08048117) --------------------------------------------------------
int __usercall sub_8048117@<eax>(unsigned int a1@<eax>)
{
  int v1; // ecx
  __int16 *v2; // edi
  unsigned int v3; // et2
  size_t v4; // edx
  char v6; // [esp-4h] [ebp-8h]

  v1 = 0;
  v2 = &word_80483DA;
  do
  {
    v3 = a1 % 0xA;
    a1 /= 0xAu;
    v6 = v3;
    ++v1;
  }
  while ( a1 );
  v4 = v1 + 1;
  do
  {
    *(_BYTE *)v2 = v6 + 48;
    v2 = (__int16 *)((char *)v2 + 1);
    --v1;
  }
  while ( v1 );
  *(_BYTE *)v2 = 10;
  return sys_write(1, &word_80483DA, v4);
}
// 80483DA: using guessed type __int16 word_80483DA;

//----- (08048147) --------------------------------------------------------
int __usercall sub_8048147@<eax>(_BYTE *a1@<ebx>, _DWORD *a2@<edi>)
{
  int v2; // eax
  int v3; // ecx

  v2 = 0;
  v3 = 0;
  while ( 1 )
  {
    LOBYTE(v3) = *a1 - 48;
    if ( (v3 & 0x80u) != 0 || (char)v3 > 9 )
      break;
    v2 = v3 + 10 * v2;
    ++a1;
  }
  return sub_8048174(v2, a2);
}

//----- (08048166) --------------------------------------------------------
void __usercall sub_8048166(int a1@<edi>)
{
  if ( a1 <= (int)&word_80481DA )
    JUMPOUT(0x804818E);
}
// 804816C: control flows out of bounds to 804818E
// 80481DA: using guessed type __int16 word_80481DA;

//----- (08048174) --------------------------------------------------------
int __usercall sub_8048174@<eax>(int result@<eax>, _DWORD *a2@<edi>)
{
  int v2; // eax
  int v3; // eax

  if ( (int)a2 >= (int)&word_804825A )
  {
    v2 = sys_write(2, dword_80481B4, 0xFu);
    v3 = sys_exit(1);
  }
  *a2 = result;
  return result;
}
// 80481B4: using guessed type int dword_80481B4[3];
// 804825A: using guessed type __int16 word_804825A;

// nfuncs=5 queued=5 decompiled=5 lumina nreq=0 worse=0 better=0
// ALL OK, 5 function(s) have been successfully decompiled
