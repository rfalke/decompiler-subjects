// subject_seg08048000_0000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register Eq_2 edx, Stack word32 dwArg00)
void fn0804804C(Eq_2 edx, word32 dwArg00)
{
	ptr32 fp;
	struct Eq_5 * esp_336;
	if (dwArg00 == 0x03)
	{
		word32 * edi_358 = g_a804864C;
		word32 ecx_10;
		for (ecx_10 = 0x3FFF; ecx_10 != 0x00; --ecx_10)
		{
			*edi_358 = 0x90909090;
			++edi_358;
		}
		int32 eax_18 = sys_getpid();
		byte al_23 = (byte) eax_18;
		ui32 eax_27 = __rcr<word32,byte>(eax_18 * 0x00010001, al_23, SLICE(cond(eax_18 * 0x00010001), bool, 1));
		ui32 edi_34 = __rcl<word32,byte>(eax_27 ^ ~0x21524110, al_23, false);
		Eq_16 edi_354 = (__rcr<word32,byte>(eax_27 ^ ~0x41102152, al_23, ((eax_27 ^ ~0x21524110) & 0x01 << 0x20 - al_23) != 0x00) & 0xFFFF) + 0x0804864C;
		Eq_16 esi_355 = (edi_34 & 0xFFFF) + 0x0804864C;
		struct Eq_5 * esp_351 = fp + 8;
		while (true)
		{
			char * ebx_51 = esp_351->dw0000;
			struct Eq_5 * esp_52 = esp_351 + 1;
			if (ebx_51 == null)
				break;
			esp_52->tFFFFFFFC = 0x05;
			Eq_107 eax_322 = sys_open(ebx_51, 0x00, edx);
			if (eax_322 < 0x00)
			{
				esp_52->tFFFFFFFC = 0x01;
				Eq_16 ebx_331 = esp_52->tFFFFFFFC;
				esp_52->tFFFFFFFC = 0x04;
				sys_write(ebx_331, &g_b8048342, 0x3D);
				esp_336 = esp_52;
				goto l08048064;
			}
			esp_52->tFFFFFFFC = 0x03;
			g_t80483A0 = sys_read(eax_322, edi_354, 0x1000);
			esp_52->tFFFFFFFC = 0x06;
			sys_close(eax_322);
			edx = 0x1000;
			esp_351 = esp_52;
			edi_354 = esi_355;
			esi_355 = edi_354;
		}
		esp_52->tFFFFFFFC = edi_354;
		esp_52->tFFFFFFF8 = esi_355;
		esp_52->tFFFFFFF4.u0 = 0x02;
		Eq_16 eax_68 = sys_fork();
		if (eax_68 != 0x00)
		{
			g_t8048394 = eax_68;
			esp_52->tFFFFFFF4.u0 = 0x02;
			Eq_93 edx_78 = esp_52->tFFFFFFF4.u0;
			esp_52->tFFFFFFF4.u0 = 114;
			sys_wait4(~0x00, null, edx_78, null);
			g_ptr8048430 = &g_t80483EC;
			Eq_16 ecx_90 = g_t8048394;
			esp_52->tFFFFFFF4.u0 = 0x0C;
			Eq_93 ebx_93 = esp_52->tFFFFFFF4.u0;
			esp_52->tFFFFFFF4.u0 = 0x1A;
			sys_ptrace(ebx_93, ecx_90, edx_78, 0x080483A8);
			g_t80483D8 = esp_52->tFFFFFFF8;
			g_dw80483E4 = 0x08048534;
			g_dw80483A8 = 0x080483A0;
			g_dw80483C0 = 0x0804864C;
			struct Eq_191 * v26_105 = g_ptr8048430;
			g_ptr8048430 = (struct Eq_191 *) &g_dw80483A8;
			Eq_16 ecx_109 = g_t8048394;
			esp_52->tFFFFFFF8 = 0x0C;
			Eq_16 ebx_112 = esp_52->tFFFFFFF8;
			esp_52->tFFFFFFF8 = 0x1A;
			sys_ptrace(ebx_112, ecx_109, edx_78, v26_105);
			v26_105->t0030 = esp_52->tFFFFFFFC;
			v26_105->dw003C = 0x08048634;
			v26_105->dw0000 = 0x080483A4;
			v26_105->dw0018 = 0x0804864C;
			struct Eq_191 * v27_124 = g_ptr8048430;
			g_ptr8048430 = v26_105;
			g_dw8048398 = 0x00;
			g_dw804839C = 0x00;
			struct Eq_191 * ebp_126 = v27_124;
			Eq_16 ecx_127 = 0x28;
			while (true)
			{
				do
				{
					esp_52->tFFFFFFFC = ecx_127;
					Eq_16 ecx_141 = g_t8048394;
					esp_52->tFFFFFFF8 = 0x0D;
					Eq_16 ebx_144 = esp_52->tFFFFFFF8;
					esp_52->tFFFFFFF8 = 0x1A;
					sys_ptrace(ebx_144, ecx_141, 0x00, ebp_126);
					Eq_16 ecx_153 = g_t8048394;
					esp_52->tFFFFFFF8 = 0x09;
					Eq_16 ebx_156 = esp_52->tFFFFFFF8;
					esp_52->tFFFFFFF8 = 0x1A;
					sys_ptrace(ebx_156, ecx_153, 0x00, 0x00);
					esp_52->tFFFFFFF8 = 0x02;
					Eq_16 edx_166 = esp_52->tFFFFFFF8;
					esp_52->tFFFFFFF8 = 114;
					sys_wait4(~0x00, null, edx_166, null);
					Eq_16 ecx_180 = g_t8048394;
					esp_52->tFFFFFFF8 = 0x0C;
					Eq_16 ebx_183 = esp_52->tFFFFFFF8;
					esp_52->tFFFFFFF8 = 0x1A;
					sys_ptrace(ebx_183, ecx_180, 0x00, ebp_126);
					struct Eq_191 * v28_190 = g_ptr8048430;
					g_ptr8048430 = ebp_126;
					Eq_16 ecx_193 = esp_52->tFFFFFFFC;
					ebp_126 = v28_190;
					ecx_127 = ecx_193 - 0x01;
				} while (ecx_193 != 0x01);
				esp_52->tFFFFFFFC = 0x01;
				Eq_16 edx_198 = esp_52->tFFFFFFFC;
				esp_52->tFFFFFFFC = 0x01;
				Eq_16 ebx_203 = esp_52->tFFFFFFFC;
				esp_52->tFFFFFFFC = 0x04;
				sys_write(ebx_203, &g_b8048393, edx_198);
				Eq_16 ecx_212 = g_t8048394;
				esp_52->tFFFFFFFC = 0x02;
				Eq_16 ebx_215 = esp_52->tFFFFFFFC;
				esp_52->tFFFFFFFC = 0x1A;
				sys_ptrace(ebx_215, ecx_212, 0x080483A0, 0x08048648);
				up32 eax_222 = g_dw8048648;
				byte bl_223 = 0x32;
				if (eax_222 <= g_dw8048398)
					break;
				g_dw8048398 = eax_222;
				ecx_127 = g_t8048394;
				esp_52->tFFFFFFFC = 0x02;
				Eq_16 ebx_232 = esp_52->tFFFFFFFC;
				esp_52->tFFFFFFFC = 0x1A;
				sys_ptrace(ebx_232, ecx_127, 0x080483A4, 0x08048648);
				up32 eax_239 = g_dw8048648;
				bl_223 = 0x31;
				if (eax_239 <= g_dw804839C)
					break;
				g_dw804839C = eax_239;
			}
			g_b8048387 = bl_223;
			Eq_16 ecx_247 = g_t8048394;
			esp_52->tFFFFFFFC = 0x08;
			Eq_16 ebx_251 = esp_52->tFFFFFFFC;
			esp_52->tFFFFFFFC = 0x1A;
			sys_ptrace(ebx_251, ecx_247, 0x00, 0x00);
			esp_52->tFFFFFFFC = 0x02;
			Eq_16 edx_261 = esp_52->tFFFFFFFC;
			esp_52->tFFFFFFFC = 114;
			sys_wait4(~0x00, null, edx_261, null);
			esp_52->tFFFFFFFC = 0x01;
			Eq_16 ebx_274 = esp_52->tFFFFFFFC;
			esp_52->tFFFFFFFC = 0x04;
			sys_write(ebx_274, &g_b804837F, 0x14);
			esp_52->tFFFFFFFC = 0x01;
			sys_exit(0x00);
		}
		else
		{
			g_t80483A0 = eax_68;
			g_t80483A4 = eax_68;
			esp_52->tFFFFFFF4.u0 = 0x1A;
			sys_ptrace(0x00, 0x00, 0x00, 0x00);
			Eq_183 eax_305 = sys_getpid();
			esp_52->tFFFFFFF4.u0 = 0x13;
			Eq_93 ecx_308 = esp_52->tFFFFFFF4.u0;
			esp_52->tFFFFFFF4.u0 = 0x25;
			sys_kill(eax_305, ecx_308);
			while (true)
				;
		}
	}
	else
	{
		sys_write(0x01, &g_b80482CE, 116);
		esp_336 = fp + 4;
l08048064:
		esp_336->tFFFFFFFC = 0x01;
		sys_exit(0xFF);
	}
}

char g_b80482CE = 'U'; // 080482CE
char g_b8048342 = 'U'; // 08048342
char g_b804837F = '\n'; // 0804837F
byte g_b8048387 = 0x00; // 08048387
char g_b8048393 = '.'; // 08048393
Eq_16 g_t8048394 = 0x00; // 08048394
up32 g_dw8048398 = 0x00; // 08048398
up32 g_dw804839C = 0x00; // 0804839C
Eq_16 g_t80483A0 = 0x00; // 080483A0
Eq_16 g_t80483A4 = 0x00; // 080483A4
word32 g_dw80483A8 = 0x00; // 080483A8
word32 g_dw80483C0 = 0x00; // 080483C0
Eq_16 g_t80483D8 = 0x00; // 080483D8
word32 g_dw80483E4 = 0x00; // 080483E4
Eq_191 g_t80483EC = // 080483EC
	{
		0x00,
		0x00,
		0x00,
		0x00,
	};
struct Eq_191 * g_ptr8048430 = null; // 08048430
up32 g_dw8048648 = 0x00; // 08048648
word32 g_a804864C[] = // 0804864C
	{
	};
