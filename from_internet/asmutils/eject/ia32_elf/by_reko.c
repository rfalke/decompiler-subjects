// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Stack word32 dwArg00, Stack (ptr32 char) dwArg04, Stack (ptr32 char) dwArg08, Stack (ptr32 char) dwArg0C)
void fn0804804C(word32 dwArg00, char * dwArg04, char * dwArg08, char * dwArg0C)
{
	ptr32 fp;
	g_b804812F = (int8) ((dwArg04 + ((word32) strlen(dwArg04) + 1))[-4] != 0x00646363);
	struct Eq_22 * esp_28 = fp + 8;
	char * ebx_27 = &g_b804810D;
	byte * edi_17 = &g_b804812F;
	Eq_29 ecx_22 = &g_b8048111;
	Eq_29 edx_148 = &g_b804811C;
	word32 eax_24 = dwArg00 - 0x01;
	if (dwArg00 != 0x01)
	{
		ebx_27 = dwArg08;
		esp_28 = fp + 0x0C;
		if (*dwArg08 == 0x6463632D || g_b804812F != 0x00)
		{
			g_b804812F = 0x00;
			eax_24 = dwArg00 - 0x02;
			ebx_27 = &g_b804810D;
			if (dwArg00 == 0x02)
				goto l0804809D;
			ebx_27 = dwArg0C;
			esp_28 = fp + 16;
		}
		word32 eax_47 = eax_24 - 0x01;
		if (eax_47 != 0x00)
		{
			ecx_22 = esp_28->t0000;
			esp_28 = (struct Eq_22 *) &esp_28->ptr0004;
			if (eax_47 != 0x01)
			{
				edx_148 = esp_28->t0000;
				esp_28 = (struct Eq_22 *) &esp_28->ptr0004;
				if (eax_47 != 0x02)
				{
					edi_17 = esp_28->ptr0004;
					esp_28 = (struct Eq_22 *) ((char *) &esp_28->ptr0004 + 4);
				}
			}
		}
	}
l0804809D:
	struct Eq_37 * esp_65 = esp_28 - 4;
	esp_65->t0000 = ecx_22;
	esp_65->ptrFFFFFFFC = ebx_27;
	if (*edi_17 == 0x00)
	{
		esp_65->dwFFFFFFF8 = 22;
		sys_umount(ebx_27, ecx_22);
	}
	struct Eq_76 * esp_112;
	char * eax_113;
	struct Eq_78 * esp_87 = esp_28 - 8;
	esp_87->tFFFFFFFC.u0 = 0x05;
	Eq_81 eax_100 = sys_open(ebx_27, 0x0800, edx_148);
	esp_87->tFFFFFFFC.u0 = (int32) eax_100;
	if (eax_100 >= 0x00)
	{
		esp_87->tFFFFFFF8.u0 = 0x36;
		esp_112 = esp_87 - 4;
		eax_113 = sys_ioctl(eax_100, 0x5309, edx_148);
		if (*edi_17 != 0x00)
		{
l08048100:
			if (eax_113 >= null)
				eax_113 = null;
			esp_112->dwFFFFFFFC = 0x01;
			sys_exit(eax_113);
		}
		esp_87->tFFFFFFF8.u0 = (int32) eax_100;
		esp_87->tFFFFFFF4 = edx_148;
		esp_87->dwFFFFFFF0 = 0x01;
		uint32 ebx_128 = esp_87->dwFFFFFFF0;
		esp_87->dwFFFFFFF0 = 0x04;
		sys_write(ebx_128, &g_b8048124, 11);
		esp_87->dwFFFFFFF0 = 0x03;
		sys_read(0x00, &g_b8048124, 0x01);
		edx_148 = esp_87->tFFFFFFF4;
		Eq_81 ebx_150 = esp_87->tFFFFFFF8.u0;
		esp_87->tFFFFFFF8.u0 = 0x36;
		sys_ioctl(ebx_150, 21273, edx_148);
	}
	struct Eq_107 * esp_158 = esp_28 - 0x0C;
	char * ebx_162 = esp_158->ptr0004;
	char * v21_164 = esp_158->ptr0008;
	esp_158->ptr0008 = esp_158->ptr0000;
	esp_158->ptr0004 = (char *) 0x15;
	sys_mount(ebx_162, v21_164, edx_148, 0xC0ED0001, edi_17);
	eax_113 = esp_158->ptr0008;
	esp_112 = (struct Eq_76 *) ((char *) &esp_158->ptr0008 + 4);
	goto l08048100;
}

char g_b804810D = '/'; // 0804810D
char g_b8048111 = '/'; // 08048111
char g_b804811C = 'i'; // 0804811C
char g_b8048124 = '<'; // 08048124
int8 g_b804812F = 0; // 0804812F
