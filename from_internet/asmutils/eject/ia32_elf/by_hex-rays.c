/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __cdecl __noreturn start(int, int, int, int, int, int);

//-------------------------------------------------------------------------
// Data declarations

char aDevCdrom[11] = "/dev/cdrom"; // weak
char aEnter[11] = "<enter> .."; // weak
char byte_804812F; // weak


//----- (0804804C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __cdecl __noreturn start(int a1, int a2, int a3, int a4, int a5, int a6)
{
  char *v6; // ebx
  char *v7; // edi
  char *v8; // ecx
  char *v9; // edx
  int v10; // eax
  int v11; // eax
  int v12; // eax
  int v13; // eax
  int v14; // eax
  const char *v15; // edx
  int v16; // ebx
  int v17; // eax
  int v18; // eax
  size_t v19; // edx
  void *v20; // ecx
  int v21; // eax
  int v22; // eax
  int v23; // eax
  int v24; // eax
  int v25; // [esp-1Ch] [ebp-1Ch]
  const char *v26; // [esp-18h] [ebp-18h]
  char *v27; // [esp-14h] [ebp-14h]
  char *v28; // [esp-10h] [ebp-10h]
  char *v29; // [esp-Ch] [ebp-Ch]
  __int32 v30; // [esp-Ch] [ebp-Ch]
  char *v31; // [esp-8h] [ebp-8h]
  const char *v32; // [esp-8h] [ebp-8h]
  char *v33; // [esp-4h] [ebp-4h] BYREF

  v6 = aDevCdrom;
  v7 = &byte_804812F;
  byte_804812F = *(_DWORD *)&v26[strlen(v26) - 3] != 6579043;
  v8 = &aDevCdrom[4];
  v9 = &aDevCdrom[15];
  v10 = v25 - 1;
  if ( v25 != 1 )
  {
    v6 = v27;
    if ( *(_DWORD *)v27 == 1684235053 || byte_804812F )
    {
      byte_804812F = 0;
      v10 = v25 - 2;
      v6 = aDevCdrom;
      if ( v25 == 2 )
        goto LABEL_10;
      v6 = v28;
    }
    v11 = v10 - 1;
    if ( v11 )
    {
      v8 = v29;
      v12 = v11 - 1;
      if ( v12 )
      {
        v9 = v31;
        if ( v12 != 1 )
          v7 = v33;
      }
    }
  }
LABEL_10:
  v33 = v8;
  v32 = v6;
  if ( !*v7 )
    v13 = sys_oldumount(v6);
  v14 = sys_open(v6, 2048, (mode_t)v9);
  v30 = v14;
  if ( v14 >= 0 )
  {
    v16 = v14;
    v17 = sys_ioctl(v14, 21257);
    if ( *v7 )
      goto LABEL_16;
    v18 = sys_write(1, aEnter, 0xBu);
    LOBYTE(v19) = 1;
    v21 = sys_read(0, v20, v19);
    v22 = sys_ioctl(v16, 21273);
  }
  v23 = sys_mount(v32, (const char *)_InterlockedExchange((volatile __int32 *)&v33, v30), v15, 0xC0ED0001, v7);
  v17 = (int)v33;
LABEL_16:
  if ( v17 >= 0 )
    v17 = 0;
  v24 = sys_exit(v17);
}
// 804809D: positive sp value 1C has been found
// 804805A: variable 'v26' is possibly undefined
// 8048077: variable 'v25' is possibly undefined
// 804807A: variable 'v27' is possibly undefined
// 8048090: variable 'v28' is possibly undefined
// 8048094: variable 'v29' is possibly undefined
// 8048098: variable 'v31' is possibly undefined
// 80480B0: variable 'v9' is possibly undefined
// 80480E2: variable 'v20' is possibly undefined
// 80480E2: variable 'v19' is possibly undefined
// 80480FD: variable 'v15' is possibly undefined
// 804812F: using guessed type char byte_804812F;

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
