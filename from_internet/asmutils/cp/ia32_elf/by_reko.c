// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 08048067: void fn08048067(Stack uint32 dwArg00)
void fn08048067(uint32 dwArg00)
{
	struct Eq_3 * esp_20;
	uint32 ecx_12 = dwArg00;
	ptr32 esp_27 = fp + 4 + 4;
	if (dwArg00 < 0x03)
	{
		__syscall(0x80);
		ecx_12 = 0x0804804C;
		esp_20 = fp + 4;
l0804807D:
		word32 * esp_24 = esp_20 - 4;
		*esp_24 = 0x01;
		__syscall(0x80);
		esp_27 = esp_24 + 1;
	}
	struct Eq_3 * esp_31 = esp_27 + 0;
	word32 ecx_34 = ecx_12 - 0x01;
	word16 * ebx_35 = esp_31->a0000[0];
	esp_20 = esp_31 + 1;
	if (*ebx_35 == 29229)
	{
		++g_b80482EA;
		--ecx_34;
	}
	else
	{
		esp_31->a0000[0] = ebx_35;
		esp_20 = esp_31;
	}
	ecx_12 = ecx_34 - 0x01;
	struct Eq_51 * v12_52 = esp_20[ecx_12];
	esp_20[ecx_12] = (struct Eq_3) 0x00;
	g_ptr80482E6 = v12_52;
	while (true)
	{
		Eq_76 edi_58 = esp_20->a0000[0];
		++esp_20;
		if (edi_58 == 0x00)
			break;
		if (!fn0804828E())
		{
			if (g_b80482EA == 0x01)
			{
				esp_20->dwFFFFFFFC = g_ptr80482E6;
				esp_20->dwFFFFFFF8 = (word32) edi_58;
				ecx_12 = fn0804816B();
			}
		}
		else
		{
			esp_20->dwFFFFFFFC = (word32) edi_58;
			fn080480D7(esp_20->dwFFFFFFFC, g_ptr80482E6);
		}
	}
	goto l0804807D;
}

// 080480D7: void fn080480D7(Register (ptr32 Eq_51) esi, Register (ptr32 Eq_51) edi)
// Called from:
//      fn08048067
//      fn0804816B
void fn080480D7(struct Eq_51 * esi, struct Eq_51 * edi)
{
	__syscall(0x80);
	if (!fn0804828E())
		fn0804825F(esi, edi, &g_t80482EB);
	__syscall(0x80);
	__syscall(0x80);
}

// 0804816B: Register word32 fn0804816B()
// Called from:
//      fn08048067
//      fn0804816B
word32 fn0804816B()
{
	if (!fn0804828E())
		__syscall(0x80);
	__syscall(0x80);
	while (true)
	{
		__syscall(0x80);
		struct Eq_141 * edi_185 = fp - 0x0112;
		uip32 ecx_125;
		for (ecx_125 = 141; ecx_125 != 0x00; ecx_125 -= eax_184)
		{
			struct Eq_51 * edx_69 = &edi_185->w0008 + 1;
			if (edx_69->a0000[0] != 0x2E || edx_69[1] != 0x00 && edx_69[1] != 0x2E)
			{
				fn0804825F(edx_69, fp->ptr0008, (char *) fp - 0x00001112);
				fn0804825F(edx_69, fp->ptr0004, (char *) fp - 2322);
				if (!fn0804828E())
					fn0804816B();
				else
					fn080480D7((char *) fp - 2322, (char *) fp - 0x00001112);
			}
			Eq_169 eax_184 = (uint32) edi_185->w0008;
			edi_185 += eax_184;
		}
	}
}

// 0804825F: void fn0804825F(Register (ptr32 Eq_51) edx, Register (ptr32 Eq_51) esi, Register (ptr32 Eq_51) edi)
// Called from:
//      fn080480D7
//      fn0804816B
void fn0804825F(struct Eq_51 * edx, struct Eq_51 * esi, struct Eq_51 * edi)
{
	fn080482C1(esi, edi);
	fn08048273(edi);
	fn080482CE(edx, edi);
}

// 08048273: void fn08048273(Register (ptr32 Eq_51) edi)
// Called from:
//      fn0804825F
void fn08048273(struct Eq_51 * edi)
{
	int32 edx_11 = fn080482B5(edi);
	if (edi[edx_11 - 0x01] != 0x2F)
		edi[edx_11] = (struct Eq_51) 0x2F;
}

// 0804828E: FlagGroup bool fn0804828E()
// Called from:
//      fn08048067
//      fn080480D7
//      fn0804816B
bool fn0804828E()
{
	__syscall(0x80);
	bool Z_82 = SLICE(cond(((word32) g_w80492F3 & 0x4000) - 0x4000), bool, 2);
	return Z_82;
}

// 080482B5: Register ptr32 fn080482B5(Register (ptr32 Eq_51) esi)
// Called from:
//      fn08048273
//      fn080482C1
//      fn080482CE
ptr32 fn080482B5(struct Eq_51 * esi)
{
	byte * edx_5 = esi - 0x01;
	do
		++edx_5;
	while (*edx_5 != 0x00);
	return edx_5 - esi;
}

// 080482C1: void fn080482C1(Register (ptr32 Eq_51) esi, Register (ptr32 Eq_51) edi)
// Called from:
//      fn0804825F
void fn080482C1(struct Eq_51 * esi, struct Eq_51 * edi)
{
	word32 ecx_34;
	for (ecx_34 = fn080482B5(esi) + 0x01; ecx_34 != 0x00; --ecx_34)
	{
		edi->a0000[0] = esi->a0000[0];
		++esi;
		++edi;
	}
}

// 080482CE: void fn080482CE(Register (ptr32 Eq_51) esi, Register (ptr32 Eq_51) edi)
// Called from:
//      fn0804825F
void fn080482CE(struct Eq_51 * esi, struct Eq_51 * edi)
{
	byte * edi_38 = edi + fn080482B5(edi);
	struct Eq_51 * esi_37 = esi;
	word32 ecx_47;
	for (ecx_47 = fn080482B5(esi) + 0x01; ecx_47 != 0x00; --ecx_47)
	{
		*edi_38 = esi_37->a0000[0];
		++esi_37;
		++edi_38;
	}
}

struct Eq_51 * g_ptr80482E6 = null; // 080482E6
byte g_b80482EA = 0x00; // 080482EA
Eq_51 g_t80482EB = // 080482EB
	{
		
		{
		},
		
		{
			0x00
		},
	};
word16 g_w80492F3 = 0x00; // 080492F3
