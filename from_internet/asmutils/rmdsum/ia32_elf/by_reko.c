// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register Eq_2 edx, Register word32 esi, Stack word32 dwArg00)
void fn0804804C(Eq_2 edx, word32 esi, word32 dwArg00)
{
	ptr32 fp;
	fn080483E9();
	word32 edi_210 = 0x00;
	Eq_11 ebp_10 = 0x00;
	struct Eq_13 * esp_18 = fp + 8;
	if (dwArg00 != 0x01)
	{
l0804805A:
		char * ebx_22 = esp_18->dw0000;
		struct Eq_13 * esp_23 = &esp_18->dw0000 + 1;
		if (ebx_22 == null)
		{
			esp_23->dwFFFFFFFC = 0x01;
			sys_exit(ebx_22);
		}
		g_ptr8050BC0 = ebx_22;
		esp_23->dwFFFFFFFC = 0x05;
		Eq_11 eax_41 = sys_open(ebx_22, 0x00, edx);
		esp_18 = esp_23;
		ebp_10 = eax_41;
		if (eax_41 < 0x00)
		{
l08048076:
			++edi_210;
			goto l0804805A;
		}
	}
	while (true)
	{
		struct Eq_18 * esp_52 = esp_18 - 4;
		esp_52->t0000.u0 = 0x03;
		edx = 0x2000;
		esp_18 = (struct Eq_13 *) ((char *) &esp_52->t0000 + 4);
		Eq_21 eax_56 = sys_read(ebp_10, &g_b8048B80, 0x2000);
		if (eax_56 < 0x00)
			break;
		if (eax_56 == 0x00)
		{
			esp_52->t0000.u0 = (int32) eax_56;
			esp_52->dwFFFFFFFC = 0x08048B80;
			esp_52->dwFFFFFFF8 = 0x2000;
			esp_52->tFFFFFFF4.u0 = (int32) ebp_10;
			esp_52->ptrFFFFFFF0 = (char *) &esp_52->t0000 + 4;
			esp_52->tFFFFFFEC.u0 = (int32) ebp_10;
			esp_52->dwFFFFFFE8 = esi;
			esp_52->dwFFFFFFE4 = edi_210;
			fn0804846A(g_a8050B80);
			esp_52->dwFFFFFFE0 = 0x14;
			word32 ecx_126 = esp_52->dwFFFFFFE0;
			byte * esi_91 = g_a8050B80;
			byte * edi_116 = &g_b8050B94;
			do
			{
				struct Eq_156 * esp_98 = esp_18 - 32;
				byte al_96 = *esi_91;
				esp_98->tFFFFFFFC = 0x02;
				++esi_91;
				Eq_33 edx_101 = esp_98->tFFFFFFFC;
				byte ah_103 = al_96;
				do
				{
					ah_103 = __rol<byte,byte>(ah_103, 0x04);
					ci8 al_109 = (ah_103 & 0x0F) + 0x30;
					if (al_109 > 0x39)
						al_109 = (ah_103 & 0x0F) + 0x57;
					*edi_116 = al_109;
					++edi_116;
					--edx_101;
				} while (edx_101 != 0x00);
				--ecx_126;
			} while (ecx_126 != 0x00);
			*edi_116 = (byte) 0x0A2D2020;
			esp_98->tFFFFFFFC = 0x2A;
			Eq_33 edx_133 = esp_98->tFFFFFFFC;
			esp_98->tFFFFFFFC = 0x01;
			Eq_33 ebx_138 = esp_98->tFFFFFFFC;
			esp_98->tFFFFFFFC = 0x04;
			sys_write(ebx_138, &g_b8050B94, edx_133);
			fn080483E9();
			char * esi_150 = g_ptr8050BC0;
			esp_98->tFFFFFFFC = 0x02;
			char * ecx_151 = &g_b8050BBE;
			Eq_33 edx_154 = esp_98->tFFFFFFFC;
			char * esi_156 = esi_150;
			if (esi_150 != null)
			{
				esp_98->tFFFFFFFC = 0x08050BBE;
				esp_98->ptrFFFFFFF8 = esi_150;
				do
				{
					esi_156 = esi_248 + 1;
					esi_248 = esi_156;
				} while (*esi_248 != 0x00);
				char * edi_174 = esp_98->ptrFFFFFFF8;
				esp_98->ptrFFFFFFF8 = (char *) 0x01;
				char * ebx_183 = esp_98->ptrFFFFFFF8;
				esp_98->ptrFFFFFFF8 = (char *) 0x04;
				sys_write(ebx_183, edi_174, esi_156 - edi_174 - 0x01);
				ecx_151 = (word32) esp_98->tFFFFFFFC + 1;
				esp_98->tFFFFFFFC = 0x01;
				edx_154 = esp_98->tFFFFFFFC;
			}
			esp_98->tFFFFFFFC = 0x01;
			Eq_33 ebx_201 = esp_98->tFFFFFFFC;
			esp_98->tFFFFFFFC = 0x04;
			sys_write(ebx_201, ecx_151, edx_154);
			edi_210 = esp_98->dw0000;
			esi = esp_98->dw0004;
			edx = esp_98->t0014;
			esp_18 = (struct Eq_13 *) (&esp_98->t0014 + 3);
			goto l0804805A;
		}
		fn08048440(eax_56);
		esi = 0x08048B80;
	}
	goto l08048076;
}

Eq_525 g_t8048126 = // 08048126
	{
		33462,
		0x00,
	};
// 080482F3: void fn080482F3()
// Called from:
//      fn08048440
//      fn0804846A
void fn080482F3()
{
	ptr32 fp;
	word32 dwLoc48;
	memcpy(&dwLoc48, &g_dw80484E4, 0x14);
	memcpy(&dwLoc48 + 5, &g_dw80484E4, 0x14);
	struct Eq_323 * ebp_150 = fp - 32;
	word32 ecx_152 = 0x02;
	do
	{
		word32 ecx_147 = 0x10;
		do
		{
			word32 eax_79;
			g_ptr8048540();
			ebp_150->dwFFFFFFD8 = eax_79 + ebp_150->dwFFFFFFE8;
			ebp_150->dwFFFFFFE0 = __rol<word32,byte>(ebp_150->dwFFFFFFE0, 0x0A);
			word32 eax_93;
			g_ptr8048540();
			ebp_150->dwFFFFFFE8 = eax_93 + ebp_150->dwFFFFFFE4;
			ebp_150->dwFFFFFFDC = __rol<word32,byte>(ebp_150->dwFFFFFFDC, 0x0A);
			word32 eax_107;
			g_ptr8048540();
			ebp_150->dwFFFFFFE4 = eax_107 + ebp_150->dwFFFFFFE0;
			ebp_150->dwFFFFFFD8 = __rol<word32,byte>(ebp_150->dwFFFFFFD8, 0x0A);
			word32 eax_121;
			g_ptr8048540();
			ebp_150->dwFFFFFFE0 = eax_121 + ebp_150->dwFFFFFFDC;
			ebp_150->dwFFFFFFE8 = __rol<word32,byte>(ebp_150->dwFFFFFFE8, 0x0A);
			word32 eax_135;
			g_ptr8048540();
			ebp_150->dwFFFFFFDC = eax_135 + ebp_150->dwFFFFFFD8;
			ebp_150->dwFFFFFFE4 = __rol<word32,byte>(ebp_150->dwFFFFFFE4, 0x0A);
			ecx_147 = ecx_243 - 0x01;
			ecx_243 = ecx_147;
		} while (ecx_243 != 0x01);
		++ebp_150;
		ecx_152 = ecx_242 - 0x01;
		ecx_242 = ecx_152;
	} while (ecx_242 != 0x01);
	word32 eax_159 = ebp_150->dwFFFFFFD0 + ebp_150->dwFFFFFFB8 + g_dw80484E8;
	g_dw80484E8 = ebp_150->dwFFFFFFD4 + ebp_150->dwFFFFFFBC + g_dw80484EC;
	g_dw80484EC = ebp_150->dwFFFFFFC4 + ebp_150->dwFFFFFFC0 + g_dw80484F0;
	g_dw80484F0 = ebp_150->dwFFFFFFC8 + ebp_150->dwFFFFFFB0 + g_dw80484F4;
	g_dw80484F4 = ebp_150->dwFFFFFFCC + ebp_150->dwFFFFFFB4 + g_dw80484E4;
	g_dw80484E4 = eax_159;
}

// 080483E9: void fn080483E9()
// Called from:
//      fn0804804C
void fn080483E9()
{
	g_dw80484E4 = 0x67452301;
	g_dw80484E8 = 4023233417;
	g_dw80484EC = 2562383102;
	g_dw80484F0 = 271733878;
	g_dw80484F4 = 3285377520;
	g_t80484F8.u0 = 0x00;
	g_dw80484FC = 0x00;
	struct Eq_521 * edi_111 = g_a8048500;
	word32 ecx_114;
	for (ecx_114 = 0x10; ecx_114 != 0x00; --ecx_114)
	{
		edi_111->dw0000 = 0x00;
		edi_111 += 2;
	}
	struct Eq_525 * esi_58 = &g_t8048126;
	word32 ecx_62 = 0x0A;
	do
	{
		Eq_543 ebx_69 = esi_58->w0000;
		word32 edx_70 = esi_58->dw0004;
		++esi_58;
		word32 ecx_75;
		for (ecx_75 = 0x10; ecx_75 != 0x00; --ecx_75)
		{
			word16 ax_79 = esi_58->w0000;
			edi_111->dw0000 = (word32) ebx_69;
			edi_111[2] = (struct Eq_521) edx_70;
			edi_111[4] = (struct Eq_521) ax_79;
			esi_58 = &esi_58->w0000 + 1;
			edi_111 += 5;
		}
		ecx_62 = ecx_160 - 0x01;
		ecx_160 = ecx_62;
	} while (ecx_160 != 0x01);
}

// 08048440: void fn08048440(Register Eq_21 ecx)
// Called from:
//      fn0804804C
void fn08048440(Eq_21 ecx)
{
	uint32 ecx_30 = ecx >> 0x06;
	if (ecx >> 0x06 != 0x00)
	{
		do
		{
			fn080482F3();
			--ecx_30;
		} while (ecx_30 != 0x00);
	}
	Eq_515 eax_46 = g_t80484F8.u0;
	word32 eax_50 = eax_46 + ecx;
	if (eax_50 < eax_46)
		++g_dw80484FC;
	g_t80484F8.u0 = (int32) eax_50;
}

// 0804846A: void fn0804846A(Register (ptr32 Eq_105) edi)
// Called from:
//      fn0804804C
void fn0804846A(<unknown>* edi)
{
	Eq_515 eax_31 = g_t80484F8.u0;
	memcpy(g_a8048500, (eax_31 & 8128) + 0x08048B80, eax_31 & 0x3F);
	ui32 edx_47 = eax_31 >> 0x02 & 0x0F;
	g_a8048500[edx_47 * 0x04] = g_a8048500[edx_47 * 0x04] ^ 0x01 << ((byte) eax_31 & 0x03) * 0x08 + 0x07;
	word32 * edi_122 = g_a8048500;
	if ((eax_31 & 0x3F) > 55)
	{
		fn080482F3();
		word32 ecx_125;
		for (ecx_125 = 0x10; ecx_125 != 0x00; --ecx_125)
		{
			*edi_122 = 0x00;
			++edi_122;
		}
	}
	g_dw8048538 = eax_31 << 0x03;
	g_dw804853C = g_dw80484FC >> 0x1D;
	fn080482F3();
	memcpy(edi, &g_dw80484E4, 0x14);
}

word32 g_dw80484E4 = 0x00; // 080484E4
word32 g_dw80484E8 = 0x00; // 080484E8
word32 g_dw80484EC = 0x00; // 080484EC
word32 g_dw80484F0 = 0x00; // 080484F0
word32 g_dw80484F4 = 0x00; // 080484F4
Eq_515 g_t80484F8 = // 080484F8
	{
		0
	};
uint32 g_dw80484FC = 0x00; // 080484FC
word32 g_a8048500[] = // 08048500
	{
	};
ui32 g_dw8048538 = 0x00; // 08048538
uint32 g_dw804853C = 0x00; // 0804853C
<anonymous> * g_ptr8048540 = null; // 08048540
char g_b8048B80 = '\0'; // 08048B80
byte g_a8050B80[] = // 08050B80
	{
	};
byte g_b8050B94 = 0x00; // 08050B94
char g_b8050BBE = '\0'; // 08050BBE
char * g_ptr8050BC0 = null; // 08050BC0
