// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register Eq_2 edx)
// Called from:
//      fn080480B0
void fn0804804C(Eq_2 edx)
{
	g_t804865E.u0 = (int32) sys_open(&g_b80485A5, 0x00, edx);
	sys_chdir(&g_b80485FA);
	Eq_18 eax_25 = sys_open(&g_b80485B3, 0x00, edx);
	g_t8048662.u0 = (int32) eax_25;
	sys_fstat(eax_25, &g_t804866A);
	g_ptr8048666 = sys_mmap2();
	sys_time(&g_dw804865A);
}

// 080480B0: void fn080480B0(Register Eq_2 edx, Stack word32 dwArg00, Stack (ptr32 Eq_47) dwArg04)
void fn080480B0(Eq_2 edx, word32 dwArg00, struct Eq_47 * dwArg04)
{
	ptr32 fp;
	char bLoc0100;
	uint32 dwLoc0C;
	uint32 dwLoc08;
	uint32 dwLoc04;
	fn0804804C(edx);
	uint32 * esp_18 = fp + 4;
	if (dwArg00 == 0x01)
	{
		struct Eq_47 * edi_22 = dwArg04;
		word32 ecx_26 = dwArg00 - 0x02;
		while (ecx_26 != 0x00)
		{
			++edi_22;
			--ecx_26;
			if (edi_22->b0000 != 0x00)
				break;
		}
		if (edi_22->bFFFFFFFE != 100)
		{
			sys_write(0x01, &g_b80485BF, 0x3B);
			while (sys_read(g_t804865E.u0, &g_dw80486AA, 0x0180) != 0x00)
			{
				if (g_dw80486AA == 0x07)
				{
					byte * edi_599 = &g_b804882A;
					word32 ecx_601 = 11;
					byte al_602 = g_b80486D6;
					byte * esi_603 = g_a80486D7;
					do
					{
						*edi_599 = al_602;
						byte al_611 = *esi_603;
						++edi_599;
						--ecx_601;
						++esi_603;
						al_602 = al_611;
					} while (al_611 != 0x00);
					ecx_622 = ecx_601;
					while (true)
					{
						word32 ecx_622;
						if (ecx_622 == 0x00)
							break;
						*edi_599 = 0x20;
						++edi_599;
						--ecx_622;
					}
					struct Eq_227 * edi_633;
					word32 ecx_642;
					for (ecx_642 = 22 - fn0804851A(-ecx_601 + 11, edi_599, out edi_633); ecx_642 != 0x00; --ecx_642)
					{
						edi_633->b0000 = 0x20;
						++edi_633;
					}
					word32 ecx_647 = 0x08;
					byte al_649 = g_b80486B2;
					byte * esi_650 = g_a80486B3;
					do
					{
						edi_633->b0000 = al_649;
						byte al_658 = *esi_650;
						++edi_633;
						--ecx_647;
						++esi_650;
						al_649 = al_658;
					} while (al_658 != 0x00);
					for (; ecx_647 != 0x00; --ecx_647)
					{
						edi_633->b0000 = 0x20;
						++edi_633;
					}
					if (sys_stat(&g_b80486B2, &g_t804866A) >= 0x00)
					{
						union Eq_534 * edi_689;
						int32 eax_681 = g_dw804865A - g_dw804868A;
						if (eax_681 > 0x3C)
						{
							int64 edx_eax_879;
							Eq_562 edx_eax_693 = (uint64) eax_681;
							Eq_564 edx_695 = (int32) (edx_eax_693 % 0x00015180);
							int32 eax_696 = (int32) (edx_eax_693 /32 0x00015180);
							if (eax_696 != 0x00)
								edx_eax_879 = fn080484FE(eax_696, edi_633);
							else
							{
								edi_633->b0000 = (byte) 0x20202020;
								edx_eax_879 = SEQ(eax_696, edx_695);
							}
							int64 edx_eax_882;
							struct Eq_227 * edi_714 = edi_633 + 3;
							Eq_588 edx_720 = (int32) (edx_eax_879 % 0x0E10);
							int32 eax_721 = (int32) (edx_eax_879 /32 0x0E10);
							if (eax_721 != 0x00)
								edx_eax_882 = fn080484FE(eax_721, edi_714);
							else
							{
								edi_714->b0000 = (byte) 0x20202020;
								edx_eax_882 = SEQ(eax_721, edx_720);
							}
							fn080484FE((int32) (edx_eax_882 /32 0x3C), edi_714 + 3);
							edi_689 = (union Eq_534 *) (edi_714 + 5);
						}
						else
						{
							edi_633->b0000 = (byte) 0x20202020;
							edi_633[4] = (struct Eq_227) 0x20202020;
							edi_633[6] = (struct Eq_227) 0x2020;
							edi_633[7] = (struct Eq_227) 0x2D;
							edi_689 = (union Eq_534 *) (edi_633 + 8);
						}
						byte al_761 = g_b80486F6;
						byte * esi_762 = g_a80486F7;
						byte al_763 = al_761;
						if (al_761 != 0x00)
						{
							edi_689->u0 = 0x20202020;
							(&edi_689->u1)[4] = (struct Eq_1268) 0x20202020;
							edi_689 = &edi_689->u1 + 4;
							do
							{
								edi_689->u1.b0000 = al_763;
								byte al_778 = *esi_762;
								edi_689 = &edi_689->u1 + 1;
								++esi_762;
								al_763 = al_778;
							} while (al_778 != 0x00);
						}
						edi_689->u1.b0000 = 0x0A;
						(&edi_689->u1)[1] = (struct Eq_1268) 0x00;
					}
					byte * edi_788 = &g_b804882A;
					word32 ecx_793 = 0x50;
					while (ecx_793 != 0x00)
					{
						edi_788 = edi_893 + 1;
						--ecx_793;
						edi_893 = edi_788;
						if (*edi_893 != 0x00)
							break;
					}
					sys_write(0x01, &g_b804882A, 0x50 - ecx_793 - 1);
				}
			}
			fn08048584();
		}
		sys_signal(0x11, &g_t804822F);
		dwLoc04 = 0x02;
		dwLoc08 = 0x01;
		int32 ebx_61 = dwLoc08;
		dwLoc08 = 0x66;
		g_dw8048656 = sys_socketcall(ebx_61, &dwLoc04);
		dwLoc04 = 0x10;
		dwLoc08 = (uint32) fp;
		dwLoc0C = (uint32) g_dw8048656;
		if (sys_socketcall(0x02, &dwLoc0C) < 0x00)
		{
			dwLoc04 = 0x01;
			uint32 ebx_104 = dwLoc04;
			dwLoc04 = 0x04;
			sys_write(ebx_104, &g_b8048346, 0x1E);
			dwLoc04 = 0x01;
			sys_exit(0x00);
		}
		dwLoc04 = 0x05;
		dwLoc08 = (uint32) g_dw8048656;
		dwLoc0C = 0x04;
		int32 ebx_128 = dwLoc0C;
		dwLoc0C = 0x66;
		sys_socketcall(ebx_128, &dwLoc08);
		dwLoc04 = 0x01;
		uint32 ebx_139 = dwLoc04;
		dwLoc04 = 0x06;
		sys_close(ebx_139);
		dwLoc04 = 0x00;
		do
		{
			do
			{
				dwLoc04 = 0x00;
				dwLoc08 = 0x00;
				dwLoc0C = (uint32) g_dw8048656;
				int32 eax_168 = sys_socketcall(0x05, &dwLoc0C);
				dwLoc04 = (uint32) eax_168;
			} while (eax_168 < 0x00);
			dwLoc08 = 0x02;
		} while (sys_fork() != 0x00);
		uint32 eax_187 = dwLoc04;
		dwLoc04 = 0x01;
		uint32 ecx_191 = dwLoc04;
		dwLoc04 = 0x3F;
		sys_dup2(eax_187, ecx_191);
		int32 eax_217 = sys_read(0x01, &bLoc0100, 0x0100);
		(&bLoc0100)[eax_217].u0 = 0x00;
		struct Eq_1037 * esi_219 = &bLoc0100 + eax_217;
		do
		{
			esi_219 = esi_889 - 1;
			esi_889 = esi_219;
		} while (esi_889->b0000 <= 0x20);
		esi_219[2] = (struct Eq_1037) 0x00;
		dwLoc04 = &bLoc0100;
		dwLoc08 = 0x00;
		Eq_10 ebx_241 = g_t804865E.u0;
		dwLoc0C = 0x13;
		sys_lseek(ebx_241, 0x00, &bLoc0100);
		esp_18 = &dwLoc08;
	}
	struct Eq_61 * esp_251 = esp_18 + 1;
	byte * esi_252 = g_ptr8048666;
	char * edi_253 = esp_251->ptr0000;
	esp_251->ptr0000 = edi_253;
	uint32 ecx_263 = strlen(edi_253) - ~0x00;
	char * edi_266 = esp_251->ptr0000;
	esp_251->ptr0000 = edi_266;
	byte * esi_272;
	fn08048538(ecx_263 - 0x01, esi_252, edi_266, out esi_272);
	if (esi_272 == null)
	{
		esp_251->ptrFFFFFFFC = (byte *) 0x01;
		byte * ebx_288 = esp_251->ptrFFFFFFFC;
		esp_251->ptrFFFFFFFC = (byte *) 0x04;
		sys_write(ebx_288, &g_b804863F, 0x17);
		if (g_dw8048656 != 0x00)
		{
			esp_251->ptrFFFFFFFC = (byte *) 0x02;
			esp_251->tFFFFFFF8.u0 = 0x01;
			esp_251->dwFFFFFFF4 = 0x0D;
			int32 ebx_304 = esp_251->dwFFFFFFF4;
			esp_251->dwFFFFFFF4 = 0x66;
			sys_socketcall(ebx_304, esp_251 - 8);
		}
		esp_251->ptrFFFFFFFC = (byte *) 0x01;
		byte * ebx_316 = esp_251->ptrFFFFFFFC;
		esp_251->ptrFFFFFFFC = (byte *) 0x01;
		sys_exit(ebx_316);
	}
	else
	{
		struct Eq_274 * edi_323 = &g_b804882A;
		word32 ecx_324;
		byte * esi_325 = g_a80485FF;
		for (ecx_324 = 0x07; ecx_324 != 0x00; --ecx_324)
		{
			edi_323->b0000 = *esi_325;
			++esi_325;
			++edi_323;
		}
		char * esi_330 = esp_251->ptr0000;
		esp_251->ptr0000 = esi_330;
		word32 ecx_327 = 33;
		byte al_335 = *esi_330;
		byte * esi_336 = esi_330 + 1;
		do
		{
			edi_323->b0000 = al_335;
			byte al_344 = *esi_336;
			--ecx_327;
			++edi_323;
			++esi_336;
			al_335 = al_344;
		} while (al_344 != 0x00);
		for (; ecx_327 != 0x00; --ecx_327)
		{
			edi_323->b0000 = 0x20;
			++edi_323;
		}
		word32 ecx_353;
		byte * esi_354 = g_a8048606;
		for (ecx_353 = 0x06; ecx_353 != 0x00; --ecx_353)
		{
			edi_323->b0000 = *esi_354;
			++esi_354;
			++edi_323;
		}
		word32 ecx_356;
		byte * esi_358 = esi_272;
		for (ecx_356 = 0x04; ecx_356 != 0x00; --ecx_356)
		{
			do
			{
				esi_358 = esi_890 + 1;
				esi_890 = esi_358;
			} while (*esi_890 != 0x3A);
		}
		esp_251->ptrFFFFFFFC = esi_358;
		fn08048364(esi_358, edi_323);
		edi_323[1] = (struct Eq_274) 0x0A;
		esp_251->tFFFFFFF8.u0 = 0x50;
		Eq_182 edx_383 = esp_251->tFFFFFFF8.u0;
		esp_251->tFFFFFFF8.u0 = 0x01;
		Eq_182 ebx_388 = esp_251->tFFFFFFF8.u0;
		esp_251->tFFFFFFF8.u0 = 0x04;
		sys_write(ebx_388, &g_b804882A, edx_383);
		struct Eq_274 * edi_395 = &g_b804882A;
		word32 ecx_396;
		byte * esi_397 = g_a804860C;
		for (ecx_396 = 11; ecx_396 != 0x00; --ecx_396)
		{
			edi_395->b0000 = *esi_397;
			++esi_397;
			++edi_395;
		}
		word32 ecx_399 = 0x1D;
		byte * esi_402 = esp_251->ptrFFFFFFFC;
		do
		{
			esi_402 = esi_891 + 1;
			esi_891 = esi_402;
		} while (*esi_891 != 0x3A);
		esp_251->ptrFFFFFFFC = esi_402;
		fn08048364(esi_402, edi_395);
		for (; ecx_399 != 0x00; --ecx_399)
		{
			edi_395->b0000 = 0x20;
			++edi_395;
		}
		word32 ecx_422;
		byte * esi_423 = g_a8048617;
		for (ecx_422 = 0x07; ecx_422 != 0x00; --ecx_422)
		{
			edi_395->b0000 = *esi_423;
			++esi_423;
			++edi_395;
		}
		byte * esi_428 = esp_251->ptrFFFFFFFC;
		do
		{
			esi_428 = esi_892 + 1;
			esi_892 = esi_428;
		} while (*esi_892 != 0x3A);
		fn08048364(esi_428, edi_395);
		edi_395->b0000 = 0x0A;
		esp_251->ptrFFFFFFFC = (byte *) 0x01;
		byte * ebx_451 = esp_251->ptrFFFFFFFC;
		esp_251->ptrFFFFFFFC = (byte *) 0x04;
		sys_write(ebx_451, &g_b804882A, edi_395 - 0x08048829);
		while (true)
		{
			Eq_10 ebx_461 = g_t804865E.u0;
			esp_251->ptrFFFFFFFC = (byte *) 0x03;
			if (sys_read(ebx_461, &g_dw80486AA, 0x0180) == 0x00)
				break;
			if (g_dw80486AA == 0x07)
			{
				char * edi_476 = esp_251->ptr0000;
				esp_251->ptr0000 = edi_476;
				memcmp(&g_b80486D6, edi_476, 0x080486AA);
				if (__find_first_difference__(&g_b80486D6, edi_476)->b80486D6 == 0x00)
				{
					byte * edi_487 = &g_b804882A;
					word32 ecx_488;
					byte * esi_489 = g_a8048632;
					for (ecx_488 = 0x0D; ecx_488 != 0x00; --ecx_488)
					{
						*edi_487 = *esi_489;
						++esi_489;
						++edi_487;
					}
					word32 ecx_491 = 0x43;
					byte al_494 = g_b80486B2;
					byte * esi_495 = g_a80486B3;
					do
					{
						*edi_487 = al_494;
						byte al_503 = *esi_495;
						--ecx_491;
						++edi_487;
						++esi_495;
						al_494 = al_503;
					} while (al_503 != 0x00);
					*edi_487 = 0x0A;
					esp_251->ptrFFFFFFFC = (byte *) 0x01;
					byte * ebx_521 = esp_251->ptrFFFFFFFC;
					esp_251->ptrFFFFFFFC = (byte *) 0x04;
					sys_write(ebx_521, &g_b804882A, 0x51 - ecx_491);
				}
			}
		}
		fn08048584();
	}
}

int32 g_t804822F() = ??/* Unexpected function type (fn int32 ()) */ ; // 0804822F
char g_b8048346 = 'C'; // 08048346
// 08048364: void fn08048364(Register (ptr32 byte) esi, Register (ptr32 Eq_274) edi)
// Called from:
//      fn080480B0
void fn08048364(byte * esi, struct Eq_274 * edi)
{
	while (true)
	{
		byte al_6 = *esi;
		++esi;
		if (al_6 == 0x3A || (al_6 == 44 || (al_6 == 0x0A || al_6 == 0x00)))
			break;
		edi->b0000 = al_6;
		++edi;
	}
}

// 080484FE: Sequence uint64 fn080484FE(Register int32 eax, Register (ptr32 Eq_227) edi)
// Called from:
//      fn080480B0
uint64 fn080484FE(int32 eax, struct Eq_227 * edi)
{
	word32 edx;
	Eq_1099 edx_eax_10 = (uint64) eax;
	edi->b0000 = (byte) (edx_eax_10 /32 0x0A) + 0x30;
	edi[1] = (struct Eq_227) ((byte) (edx_eax_10 % 0x0A) + 0x30);
	edi[2] = (struct Eq_227) 0x3A;
	return (uint64) edx;
}

// 0804851A: Register uint32 fn0804851A(Register uint32 ecx, Register (ptr32 byte) edi, Register out ptr32 ediOut)
// Called from:
//      fn080480B0
uint32 fn0804851A(uint32 ecx, byte * edi, ptr32 & ediOut)
{
	ptr32 edi_29 = 0x080486D6;
	byte * esi_16;
	uint32 ecx_17 = fn08048538(ecx, g_ptr8048666, &g_b80486D6, out esi_16);
	if (esi_16 != null)
		ecx_17 = fn08048560(esi_16, edi, out edi_29);
	ediOut = edi_29;
	return ecx_17;
}

// 08048538: Register uint32 fn08048538(Register uint32 ecx, Register (ptr32 byte) esi, Register (ptr32 char) edi, Register out (ptr32 byte) esiOut)
// Called from:
//      fn080480B0
//      fn0804851A
uint32 fn08048538(uint32 ecx, byte * esi, char * edi, byte & esiOut)
{
l08048538:
	++esi;
	if (*esi == *edi)
	{
		memcmp(esi - 0x01, edi, ecx);
		Eq_1157 firstDifference_18 = __find_first_difference__(esi - 0x01, edi);
		uint32 ecx_19 = ecx - firstDifference_18;
		esi = (word32) firstDifference_18 + (esi - 0x01);
		if (ecx_19 == 0x00 && *esi == 0x3A)
		{
			esiOut = esi;
			return ecx_19;
		}
	}
	do
	{
		byte al_34 = *esi;
		++esi;
		if (al_34 == 0x0A)
			goto l08048538;
	} while (al_34 != 0x00);
	esiOut = null;
	return 0x00;
}

// 08048560: Register word32 fn08048560(Register (ptr32 byte) esi, Stack (ptr32 byte) dwArg04, Register out (ptr32 byte) ediOut)
// Called from:
//      fn0804851A
word32 fn08048560(byte * esi, byte * dwArg04, byte & ediOut)
{
	word32 ecx_16;
	for (ecx_16 = 0x04; ecx_16 != 0x00; --ecx_16)
	{
		byte al_7 = *esi;
		++esi;
		if (al_7 == 0x00)
			fn08048584();
		if (al_7 != 0x3A)
			continue;
	}
	word32 ecx_20 = ecx_16 - 0x01;
	byte * edi_23 = dwArg04;
	while (true)
	{
		++ecx_20;
		byte al_28 = *esi;
		++esi;
		if (al_28 == 0x3A || al_28 == 44)
			break;
		*edi_23 = al_28;
		++edi_23;
	}
	ediOut = edi_23;
	return ecx_20;
}

// 08048584: void fn08048584()
// Called from:
//      fn080480B0
//      fn08048560
void fn08048584()
{
	uint32 dwLoc08;
	if (g_dw8048656 != 0x00)
	{
		dwLoc08 = 0x01;
		sys_socketcall(0x0D, &dwLoc08);
	}
	sys_exit(0x00);
}

char g_b80485A5 = '/'; // 080485A5
char g_b80485B3 = '/'; // 080485B3
char g_b80485BF = 'L'; // 080485BF
char g_b80485FA = '/'; // 080485FA
byte g_a80485FF[] = // 080485FF
	{
	};
byte g_a8048606[] = // 08048606
	{
	};
byte g_a804860C[] = // 0804860C
	{
	};
byte g_a8048617[] = // 08048617
	{
	};
byte g_a8048632[] = // 08048632
	{
	};
char g_b804863F = 'T'; // 0804863F
int32 g_dw8048656 = 0; // 08048656
word32 g_dw804865A = 0x00; // 0804865A
Eq_10 g_t804865E = // 0804865E
	{
		0
	};
Eq_18 g_t8048662 = // 08048662
	{
		0
	};
byte * g_ptr8048666 = null; // 08048666
Eq_32 g_t804866A = // 0804866A
	{
	};
word32 g_dw804868A = 0x00; // 0804868A
word32 g_dw80486AA = 0x00; // 080486AA
byte g_b80486B2 = 0x00; // 080486B2
byte g_a80486B3[] = // 080486B3
	{
	};
byte g_b80486D6 = 0x00; // 080486D6
byte g_a80486D7[] = // 080486D7
	{
	};
byte g_b80486F6 = 0x00; // 080486F6
byte g_a80486F7[] = // 080486F7
	{
	};
byte g_b804882A = 0x00; // 0804882A
