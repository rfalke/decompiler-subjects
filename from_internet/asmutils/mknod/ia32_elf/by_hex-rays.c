/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start(); // weak
// char __usercall sub_804814F@<al>(char *@<ebx>);
// int __usercall sub_8048167@<eax>(char *@<ebp>);

//-------------------------------------------------------------------------
// Data declarations

__int16 word_8048122 = 29525; // weak


//----- (0804804C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn start()
{
  int v0; // esi
  _BYTE *v1; // ebx
  const char *v2; // ebx
  char *v3; // ebx
  char *v4; // ebx
  int v5; // ebx
  int v6; // eax
  int v7; // edx
  int v8; // ecx
  int v9; // edx
  int v10; // eax
  _BYTE *v11; // [esp-1Ch] [ebp-1Ch]
  int v12; // [esp-18h] [ebp-18h]
  char *v13; // [esp-14h] [ebp-14h]
  const char *v14; // [esp-10h] [ebp-10h]
  _BYTE *v15; // [esp-Ch] [ebp-Ch]
  char *v16; // [esp-8h] [ebp-8h]
  char *v17; // [esp-4h] [ebp-4h]

  v0 = sys_umask(0) ^ 0x1B6;
  v1 = v11;
  do
    ++v1;
  while ( *v1 );
  if ( *(v1 - 1) == 111 )
  {
    v2 = (const char *)v12;
    if ( !v12 )
      goto LABEL_20;
    if ( *(_WORD *)v12 == 27949 )
    {
      v4 = (char *)(v12 + 2);
      if ( !*(_BYTE *)(v12 + 2) )
      {
        v4 = v13;
        if ( !v13 )
          goto LABEL_20;
      }
      sub_804814F(v4);
      v2 = v14;
      if ( !v14 )
        goto LABEL_20;
    }
  }
  else
  {
    v2 = (const char *)v12;
    if ( !v12 )
      goto LABEL_20;
    if ( *(_WORD *)v12 == 27949 )
    {
      v3 = (char *)(v12 + 2);
      if ( !*(_BYTE *)(v12 + 2) )
      {
        v3 = v13;
        if ( !v13 )
          goto LABEL_20;
      }
      sub_804814F(v3);
      v2 = v14;
      if ( !v14 )
        goto LABEL_20;
    }
    if ( !v15 )
      goto LABEL_20;
    if ( *v15 == 98 || *v15 == 99 || *v15 == 117 )
    {
      if ( !v16 )
        goto LABEL_20;
      v9 = sub_8048167(v16) << 8;
      if ( !v17 )
        goto LABEL_20;
      v7 = sub_8048167(v17) + v9;
LABEL_27:
      v5 = sys_mknod(v2, v8, v7);
LABEL_28:
      v10 = sys_exit(v5);
    }
    if ( *v15 != 112 )
    {
LABEL_20:
      v5 = 1;
      v6 = sys_write(2, &word_8048122, 0x2Du);
      goto LABEL_28;
    }
  }
  v7 = 0;
  v8 = v0 | 0x1000;
  goto LABEL_27;
}
// 804810A: positive sp value 20 has been found
// 804805B: variable 'v11' is possibly undefined
// 8048068: variable 'v12' is possibly undefined
// 804807B: variable 'v13' is possibly undefined
// 8048085: variable 'v14' is possibly undefined
// 804808D: variable 'v15' is possibly undefined
// 80480FE: variable 'v16' is possibly undefined
// 804810C: variable 'v17' is possibly undefined
// 804811A: variable 'v8' is possibly undefined
// 804804C: using guessed type void __noreturn start();
// 8048122: using guessed type __int16 word_8048122;

//----- (0804814F) --------------------------------------------------------
char __usercall sub_804814F@<al>(char *a1@<ebx>)
{
  int v1; // eax
  int i; // esi
  char v3; // al

  v1 = 0;
  for ( i = 0; ; i = v1 | (8 * i) )
  {
    v3 = *a1++;
    LOBYTE(v1) = v3 - 48;
    if ( (v1 & 0x80u) != 0 || (char)v1 >= 8 )
      break;
  }
  return v1;
}

//----- (08048167) --------------------------------------------------------
int __usercall sub_8048167@<eax>(char *a1@<ebp>)
{
  int result; // eax
  int i; // ebx
  char v3; // bl

  result = 0;
  for ( i = 0; ; result = i + 10 * result )
  {
    v3 = *a1++;
    LOBYTE(i) = v3 - 48;
    if ( (i & 0x80u) != 0 || (char)i > 9 )
      break;
  }
  return result;
}

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
