// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register Eq_2 edx, Stack word32 dwArg00, Stack word32 dwArg04)
void fn0804804C(Eq_2 edx, word32 dwArg00, word32 dwArg04)
{
	ptr32 fp;
	word32 ebp_19 = dwArg00;
	struct Eq_7 * esp_105 = fp + 8;
	struct Eq_10 * ebx_11 = dwArg04 - 0x01;
	do
		++ebx_11;
	while (ebx_11->b0000 != 0x00);
	if (ebx_11->bFFFFFFFE == 0x78)
		g_b804881C = 0x02;
	while (true)
	{
		--ebp_19;
		if (ebp_19 == 0x00)
			break;
		char * ebx_90 = esp_105->dw0000;
		++esp_105;
		if (*ebx_90 != 0x6F2D)
		{
			if (*ebx_90 == 0x632D)
			{
				g_b804881C = 0x01;
				continue;
			}
			if (*ebx_90 == 0x782D)
			{
				g_b804881C = 0x02;
				continue;
			}
			esp_105->dwFFFFFFFC = 0x05;
			Eq_66 eax_107 = sys_open(ebx_90, 0x00, edx);
			if (eax_107 < 0x00)
				fn080480DE();
			else
			{
				g_t80483BB.u0 = (int32) eax_107;
				continue;
			}
		}
		g_b804881C = 0x00;
	}
	switch (g_b804881C)
	{
	case 0x01:
		while (true)
		{
			fn080480F8();
			fn0804817C();
		}
		break;
	case 0x00:
		while (true)
		{
			fn080480F8();
			fn08048281();
		}
		break;
	default:
		while (true)
		{
			fn080480F8();
			fn080482F0();
		}
		break;
	}
}

// 080480DE: void fn080480DE()
// Called from:
//      fn0804804C
//      fn080480F8
//      fn0804810F
void fn080480DE()
{
	sys_write(0x02, &g_b80483A9, (struct <anonymous> *) 0x12);
	sys_exit(0x01);
}

// 080480F8: void fn080480F8()
// Called from:
//      fn0804804C
void fn080480F8()
{
	sys_read(g_t80483BB.u0, &g_b80483CB, (struct <anonymous> *) 0x0400);
	byte cl_20;
	fn0804810F(out cl_20);
}

// 0804810F: Register (ptr32 Eq_129) fn0804810F(Register out Eq_126 clOut)
// Called from:
//      fn080480F8
//      fn08048138
struct Eq_129 * fn0804810F(union Eq_126 & clOut)
{
	bool S;
	struct Eq_129 * eax;
	if (S)
		fn080480DE();
	else
	{
		fn08048111(eax);
		clOut.u1 = <invalid>;
		return (struct Eq_129 *) <invalid>;
	}
}

// 08048111: void fn08048111(Register (ptr32 Eq_129) eax)
// Called from:
//      fn080480F8
//      fn0804810F
void fn08048111(struct Eq_129 * eax)
{
	bool Z;
	if (Z)
	{
		if (g_b804881C == 0x02)
		{
			uint32 eax_14 = fn0804835D(eax_14, 0x20);
		}
		else
		{
			uint32 eax_10 = fn08048264(eax_10, 0x15);
		}
		byte cl_35;
		fn08048138((byte) eax_31, out cl_35);
		int32 eax_31 = sys_exit(0x00);
	}
	else
		g_ptr80483C7 = eax;
}

// 08048138: Register word32 fn08048138(Register uint8 al, Register out Eq_126 clOut)
// Called from:
//      fn08048111
//      fn0804817C
//      fn08048264
//      fn08048281
//      fn080482F0
//      fn0804835D
word32 fn08048138(uint8 al, union Eq_126 & clOut)
{
	word32 eax;
	uint8 al = (byte) eax;
	Eq_104 ebx_5 = g_t80483C3;
	ebx_5->b80487CC = al;
	g_t80483C3 = (Eq_104) ((char *) ebx_5 + 1);
	if (al == 0x0A)
	{
		if (sys_write(0x01, &g_b80487CC, g_t80483C3) < 0x00)
		{
			byte cl_69;
			word32 eax_28 = fn0804810F(out cl_69);
			clOut.u1 = <invalid>;
			return eax_28;
		}
		else
		{
			g_t80483C3 = null;
			clOut.u1 = <invalid>;
			return 0x00;
		}
	}
	else
	{
		clOut.u1 = <invalid>;
		return eax;
	}
}

// 0804817C: void fn0804817C()
// Called from:
//      fn0804804C
void fn0804817C()
{
	struct Eq_205 * fp;
	struct Eq_205 * esp_12 = fp;
	struct Eq_129 * edi_10 = null;
	do
	{
		word32 eax_11 = edi_10 + g_dw80483BF;
		struct Eq_210 * esp_13 = esp_12 - 4;
		esp_13->dw0000 = eax_11;
		if (((byte) eax_11 & 0x0F) == 0x00)
		{
			struct Eq_129 * esp_27 = (struct Eq_129 *) <invalid>;
			esp_27->dwFFFFFFFC = fn08048264(esp_13->dw0000, 0x15);
			esp_13 = esp_27 - 4;
		}
		word24 eax_24_8_216 = esp_13->n0001;
		struct Eq_205 * esp_38 = esp_13 + 1;
		do
		{
			uint32 eax_89;
			ci8 al_41 = edi_10[134513611];
			if (al_41 >= 0x20)
			{
				eax_89 = SEQ(eax_24_8_216, al_41);
				if (al_41 > 0x7E)
					goto l08048208;
				esp_38->dwFFFFFFFC = eax_89;
				byte cl_273;
				fn08048138(0x20, out cl_273);
				byte cl_276;
				fn08048138(0x20, out cl_276);
				goto l080481BE;
			}
			byte * esi_246 = &g_b8048391;
			switch (al_41)
			{
			case 0x0A:
				esi_246 = &g_b804839D;
				break;
			case 0x09:
				esi_246 = &g_b80483A5;
				break;
			case 0x0A:
				esi_246 = &g_b80483A1;
				break;
			default:
				if (al_41 == 0x00)
					goto l08048251;
				if (al_41 != 0x0C)
				{
					eax_89 = SEQ(eax_24_8_216, al_41);
					if (al_41 != 0x08)
					{
l08048208:
						esp_38->dwFFFFFFFC = eax_89 & 0xFF;
						uint32 esi_99 = esp_38->dwFFFFFFFC;
						byte cl_270;
						fn08048138((byte) (esi_99 >> 0x06) + 0x30, out cl_270);
						byte cl_271;
						fn08048138((((byte) esi_99 & 0x3F) >> 0x03) + 0x30, out cl_271);
						ui32 esi_119 = esi_99 & 0x3F & 0x07;
						byte cl_272;
						fn08048138((byte) esi_119 + 0x30, out cl_272);
						goto l080481BE;
					}
					esi_246 = &g_b8048395;
				}
				else
					esi_246 = &g_b8048399;
				break;
			}
l08048251:
			do
			{
				byte cl_278;
				uint32 eax_73 = fn08048138(*esi_246, out cl_278);
				byte ah_83 = SLICE(eax_73, byte, 8);
				++esi_246;
			} while (ah_83 != 0x01);
l080481BE:
			esp_12 = esp_38;
			++edi_10;
			if (edi_10 == g_ptr80483C7)
				break;
			eax_24_8_216 = SLICE(edi_10, word24, 8);
		} while (((byte) edi_10 & 0x0F) != 0x00);
		byte cl_277;
		fn08048138(0x0A, out cl_277);
	} while (edi_10 != g_ptr80483C7);
	g_dw80483BF = edi_10 + g_dw80483BF;
}

// 08048264: Register uint32 fn08048264(Register uint32 eax, Register byte cl)
// Called from:
//      fn08048111
//      fn0804817C
//      fn08048281
uint32 fn08048264(uint32 eax, byte cl)
{
	while (true)
	{
		cu8 cl_7 = cl - 0x03;
		if (cl_7 < 0x00)
			break;
		uint32 eax_20 = eax >> cl_7;
		fn08048138(((byte) eax_20 & 0x07) + 0x30, out cl);
	}
	byte cl_37;
	return fn08048138(0x20, out cl_37);
}

// 08048281: void fn08048281()
// Called from:
//      fn0804804C
void fn08048281()
{
	g_ptr80483C7[134513611] = (struct Eq_129) 0x00;
	struct Eq_386 * edi_13 = null;
	while (true)
	{
		uint32 eax_14 = edi_13 + g_dw80483BF;
		if (((byte) eax_14 & 0x0F) == 0x00)
		{
			struct Eq_129 * esp_30 = (struct Eq_129 *) <invalid>;
			esp_30->dwFFFFFFFC = fn08048264(eax_14, 0x15);
		}
		do
		{
			fn08048264((uint32) edi_13[134513611], 0x12);
			struct Eq_386 * edi_61 = edi_13 + 1;
			edi_13 = edi_61 + 0x01;
			if (edi_61 + 0x01 >= Mem39[0x080483C7<p32>:word32])
			{
				if ((g_ptr80483C7 & 0x01) != 0x00)
					edi_13 = edi_61;
				g_dw80483BF = edi_13 + g_dw80483BF;
				byte cl_116;
				fn08048138(0x0A, out cl_116);
				return;
			}
		} while ((edi_61 + 0x01 + Mem39[0x080483BF<p32>:word32] & 0x0F) != 0x00);
		byte cl_115;
		fn08048138(0x0A, out cl_115);
	}
}

// 080482F0: void fn080482F0()
// Called from:
//      fn0804804C
void fn080482F0()
{
	g_ptr80483C7[134513611] = (struct Eq_129) 0x00;
	struct Eq_448 * edi_13 = null;
	while (true)
	{
		uint32 eax_14 = edi_13 + g_dw80483BF;
		uint32 dwLoc04_108 = eax_14;
		if (((byte) eax_14 & 0x0F) == 0x00)
			dwLoc04_108 = fn0804835D(eax_14, 0x20);
		word16 eax_16_16_106 = SLICE(dwLoc04_108, word16, 16);
		do
		{
			fn0804835D(SEQ(eax_16_16_106, edi_13[134513611]), 0x10);
			struct Eq_448 * edi_55 = edi_13 + 1;
			edi_13 = edi_55 + 0x01;
			if (edi_55 + 0x01 >= Mem38[0x080483C7<p32>:word32])
			{
				if ((g_ptr80483C7 & 0x01) != 0x00)
					edi_13 = edi_55;
				g_dw80483BF = edi_13 + g_dw80483BF;
				byte cl_118;
				fn08048138(0x0A, out cl_118);
				return;
			}
			eax_16_16_106 = 0x00;
		} while ((edi_55 + 0x01 + Mem38[0x080483BF<p32>:word32] & 0x0F) != 0x00);
		byte cl_117;
		fn08048138(0x0A, out cl_117);
	}
}

// 0804835D: Register uint32 fn0804835D(Register uint32 eax, Register byte cl)
// Called from:
//      fn08048111
//      fn080482F0
uint32 fn0804835D(uint32 eax, byte cl)
{
	do
	{
		byte cl_22;
		fn08048138((eax >> cl - 0x04 & 0x0F)->b8048381, out cl_22);
		cl = cl_22;
	} while (cl_22 != 0x00);
	byte cl_42;
	return fn08048138(0x20, out cl_42);
}

byte g_b8048391 = 0x5C; // 08048391
byte g_b8048395 = 0x5C; // 08048395
byte g_b8048399 = 0x5C; // 08048399
byte g_b804839D = 0x5C; // 0804839D
byte g_b80483A1 = 0x5C; // 080483A1
byte g_b80483A5 = 0x5C; // 080483A5
char g_b80483A9 = 'F'; // 080483A9
Eq_66 g_t80483BB = // 080483BB
	{
		0
	};
word32 g_dw80483BF = 0x00; // 080483BF
Eq_104 g_t80483C3 = null; // 080483C3
struct Eq_129 * g_ptr80483C7 = null; // 080483C7
char g_b80483CB = '\0'; // 080483CB
char g_b80487CC = '\0'; // 080487CC
byte g_b804881C = 0x00; // 0804881C
