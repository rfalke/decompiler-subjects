// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

char g_b804804C = 'U'; // 0804804C
char g_b804807B = 'C'; // 0804807B
// 0804809F: void fn0804809F(Register Eq_2 edx, Register Eq_3 ebp, Stack up32 dwArg00, Stack (ptr32 byte) dwArg08, Stack (ptr32 byte) dwArg0C, Stack (ptr32 byte) dwArg10)
void fn0804809F(Eq_2 edx, Eq_3 ebp, up32 dwArg00, byte * dwArg08, byte * dwArg0C, byte * dwArg10)
{
	ptr32 fp;
	Eq_3 eax_117;
	struct Eq_10 * esp_101 = fp + 4;
	up32 ebx_43 = dwArg00 - 0x01;
	if (dwArg00 == 0x01)
	{
l080480A3:
		size_t * esp_357 = esp_101 - 4;
		*esp_357 = (uint32) 0x2F;
		Eq_31 edx_359 = *esp_357;
		*esp_357 = (uint32) 0x01;
		Eq_31 ebx_364 = *esp_357;
		*esp_357 = (uint32) 0x04;
		sys_write(ebx_364, &g_b804804C, edx_359);
		esp_101 = (struct Eq_10 *) (esp_357 + 1);
		eax_117.u0 = 0x00;
		goto l080480B5;
	}
	g_t80483D4.u0 = 60000;
	byte * eax_13 = dwArg08;
	esp_101 = fp + 0x0C;
	if (*dwArg08 == 0x2D)
	{
		if (dwArg00 <= 0x03)
			goto l080480A3;
		byte * esi_20 = dwArg0C;
		Eq_17 ebx_24 = 0x00;
		while (true)
		{
			cu8 al_31 = *esi_20;
			++esi_20;
			if (al_31 < 0x30)
				break;
			uint32 eax_353 = (uint32) (al_31 - 0x30);
			if (al_31 > 0x39 || al_31 < 0x30)
				break;
			ebx_24 = ebx_24 *s 0x0A + eax_353;
		}
		g_t80483D4.u0 = (int32) ebx_24;
		ebx_43 = dwArg00 - 0x03;
		eax_13 = dwArg10;
		esp_101 = fp + 20;
	}
	g_ptr80483CC = eax_13;
	if (ebx_43 != 0x01)
	{
		g_ptr80483D0 = esp_101->ptr0000;
		esp_101 = &esp_101->ptr0000 + 1;
	}
	ptr32 esi_57 = g_ptr80483D0;
	ptr32 esi_58 = esi_57;
	if (esi_57 == 0x00)
	{
		ptr32 esi_71;
		eax_117 = fn0804835A(edx, out esi_71);
		esi_58 = esi_71;
		if (esi_71 == 0x00)
			goto l080480B5;
	}
	fn080482AB();
	fn08048289(esi_58, 0x0804860C);
	g_dw804860C = 0x02;
	g_b804860F = 0x35;
	struct Eq_171 * esp_102 = esp_101 - 4;
	esp_102->dw0000 = 0x00;
	esp_102->dwFFFFFFFC = 0x02;
	esp_102->dwFFFFFFF8 = 0x02;
	esp_102->dwFFFFFFF4 = 0x01;
	int32 ebx_111 = esp_102->dwFFFFFFF4;
	esp_102->dwFFFFFFF4 = 0x66;
	eax_117 = sys_socketcall(ebx_111, esp_102 - 8);
	bool v51_444 = eax_117 < 0x00;
	do
	{
		if (v51_444)
			goto l080480B5;
		struct Eq_219 * esp_126 = esp_101 - 4;
		esp_126->t0000.u0 = 0x10;
		esp_126->dwFFFFFFFC = 0x04;
		esp_126->ptrFFFFFFF8 = esp_126;
		esp_126->dwFFFFFFF4 = 0x01;
		esp_126->dwFFFFFFF0 = 0x00;
		esp_126->tFFFFFFEC.u0 = (int32) eax_459;
		esp_126->dwFFFFFFE8 = 0x0E;
		int32 ebx_142 = esp_126->dwFFFFFFE8;
		esp_126->dwFFFFFFE8 = 0x66;
		int32 eax_148 = sys_socketcall(ebx_142, esp_126 - 20);
		ebp = eax_459;
		v51_444 = eax_148 < 0x00;
		eax_117.u0 = esp_126->t0000.u0;
		eax_459 = eax_117;
		if (eax_148 < 0x00)
			continue;
		esp_101->tFFFFFFFC.u0 = 0x10;
		esp_101->dwFFFFFFF8 = 0x0804860C;
		esp_101->tFFFFFFF4.u0 = (int32) eax_459;
		esp_101->dwFFFFFFF0 = 0x03;
		int32 ebx_165 = esp_101->dwFFFFFFF0;
		esp_101->dwFFFFFFF0 = 0x66;
		eax_117 = sys_socketcall(ebx_165, esp_101 - 0x0C);
		v51_444 = eax_117 < 0x00;
		eax_460 = eax_117;
		if (eax_117 < 0x00)
			continue;
		esp_101->tFFFFFFFC.u0 = 0x01;
		esp_101->dwFFFFFFF8 = 0x04;
		esp_101->tFFFFFFF4.u0 = (int32) (esp_101 - 4);
		esp_101->dwFFFFFFF0 = 0x0A;
		esp_101->dwFFFFFFEC = 0x01;
		esp_101->tFFFFFFE8.u0 = (int32) eax_459;
		esp_101->dwFFFFFFE4 = 0x0E;
		int32 ebx_193 = esp_101->dwFFFFFFE4;
		esp_101->dwFFFFFFE4 = 0x66;
		int32 eax_199 = sys_socketcall(ebx_193, esp_101 - 24);
		v51_444 = eax_199 < 0x00;
		eax_117.u0 = esp_101->tFFFFFFFC.u0;
		eax_461 = eax_117;
	} while (eax_199 < 0x00);
	esp_101->tFFFFFFFC.u0 = 0x01;
	esp_101->dwFFFFFFF8 = 0x36;
	int32 eax_216 = sys_ioctl(eax_459, 0x5421, esp_101 - 4);
	eax_117.u0 = esp_101->tFFFFFFFC.u0;
	if (eax_216 >= 0x00)
	{
		word16 dx_224 = g_w80483F6;
		esp_101->tFFFFFFFC.u0 = 0x04;
		sys_write(eax_459, &g_w80483F8, SEQ(0x00, (byte) dx_224, SLICE(dx_224, byte, 8)));
		g_t8048604.u0 = (int32) eax_459;
		g_w8048608 = 0x03;
		Eq_17 edx_242 = g_t80483D4.u0;
		esp_101->tFFFFFFFC.u0 = 0x01;
		eax_117 = sys_poll(&g_t8048604, esp_101->tFFFFFFFC.u0, edx_242);
		if ((g_w804860A & 0x03) != 0x00)
		{
			esp_101->tFFFFFFFC.u0 = 0x03;
			Eq_3 eax_267 = sys_read(eax_459, &g_w80483F6, 0x0200);
			struct Eq_438 * esi_255 = &g_w80483F6;
			eax_117 = eax_267;
			word16 eax_16_16_379 = SLICE(eax_267, word16, 16);
			if (eax_267 != 0x00)
			{
				word16 ax_273 = g_w80483FC;
				byte al_274 = (byte) ax_273;
				uint24 eax_24_8_378 = SEQ(eax_16_16_379, al_274);
				if (SEQ(al_274, SLICE(ax_273, byte, 8)) != 0x00)
				{
					byte * esi_285 = &g_b8048404;
					do
					{
						esi_285 = esi_462 + 1;
						esi_462 = esi_285;
					} while (*esi_462 != 0x00);
					esi_255 = (struct Eq_438 *) (esi_285 + 4);
				}
				while (true)
				{
					do
					{
						esi_255 = esi_463 + 1;
						esi_463 = esi_255;
					} while (esi_463->b0000 != 0x00);
					do
					{
						byte al_308 = esi_255->b0000;
						++esi_255;
					} while (al_308 == 0x00);
					if (al_308 == 0x01)
						break;
					eax_117 = SEQ(eax_24_8_378, al_308);
					if (al_308 != 0x05)
						goto l08048284;
					word16 ax_338 = esi_255[6];
					uint8 al_339 = (byte) ax_338;
					esi_255 = esi_255 + 6 + SEQ(0x00, al_339, SLICE(ax_338, byte, 8)) + 2;
					eax_24_8_378 = (uint24) al_339;
				}
				byte al_318 = esi_255[7];
				eax_117 = SEQ(eax_24_8_378, al_318);
				if (al_318 == 0x04)
					eax_117 = fn0804830A(esi_255[8]);
			}
l08048284:
		}
	}
l080480B5:
	if (eax_117 != 0x00 && eax_117 == ~0x6E)
	{
		size_t * esp_398 = esp_101 - 4;
		*esp_398 = (uint32) 0x24;
		Eq_31 edx_400 = *esp_398;
		*esp_398 = (uint32) 0x01;
		Eq_31 ebx_405 = *esp_398;
		*esp_398 = (uint32) 0x04;
		sys_write(ebx_405, &g_b804807B, edx_400);
	}
	word32 * esp_428 = esp_101 - 4;
	*esp_428 = 0x06;
	sys_close(ebp);
	*esp_428 = 0x01;
	sys_exit(0x00);
}

// 08048289: void fn08048289(Register ptr32 esi, Register ptr32 edi)
// Called from:
//      fn0804809F
void fn08048289(ptr32 esi, ptr32 edi)
{
	int32 edx_15 = 0x00;
	int32 ecx_26;
	for (ecx_26 = 0x00; ecx_26 != 0x04; ++ecx_26)
	{
		int32 ebx_34 = 0x00;
		while (true)
		{
			cu8 al_17 = *((word32) esi + edx_15);
			byte bl_22 = (byte) ebx_34;
			++edx_15;
			uint32 eax_33 = (uint32) (al_17 - 0x30);
			if (al_17 < 0x30)
				break;
			ebx_34 = ebx_34 *s 0x0A + eax_33;
		}
		*((word32) (edi + 4) + ecx_26) = (ptr32) bl_22;
	}
}

// 080482AB: void fn080482AB()
// Called from:
//      fn0804809F
void fn080482AB()
{
	byte * esi_111 = g_ptr80483CC;
	byte * dwLoc24_127 = &g_b8048404;
	byte * edi_103 = &g_b8048405;
l080482B9:
	uip32 ecx_151 = 0x00;
	while (true)
	{
		byte cl_66 = (byte) ecx_151;
		byte al_40 = *esi_111;
		++esi_111;
		if (al_40 == 0x00)
			break;
		if (al_40 == 0x2E)
		{
			*dwLoc24_127 = cl_66;
			dwLoc24_127 = edi_103;
			++edi_103;
			goto l080482B9;
		}
		*edi_103 = al_40;
		++edi_103;
		ecx_151 = SEQ(SLICE(ecx_151 + 0x01, word24, 8), cl_66 + 0x01);
	}
	*edi_103 = 0x00;
	struct Eq_555 * edi_51 = edi_103 + 1;
	edi_51->w0000 = 0x0100;
	edi_51->w0002 = 0x0100;
	*dwLoc24_127 = cl_66;
	g_w80483F6 = SEQ((byte) edi_51 - 244, SLICE(edi_51 - 0x080483F4, byte, 8));
	g_w80483F8 = 19794;
	g_w80483FC = 0x0100;
	g_w80483FA = 0x01;
}

// 0804830A: Register int32 fn0804830A(Register int32 eax)
// Called from:
//      fn0804809F
int32 fn0804830A(int32 eax)
{
	word32 eax_14 = __ror<word32,byte>(eax, 0x10);
	fn0804832D(SEQ(SLICE(eax_14, word16, 16), (byte) eax_14, SLICE(eax_14, byte, 8)), &g_b80483EC);
	return sys_write(0x01, &g_b80483ED, 0x00);
}

// 0804832D: void fn0804832D(Register uint32 eax, Register (ptr32 byte) edi)
// Called from:
//      fn0804830A
void fn0804832D(uint32 eax, byte * edi)
{
	*edi = 0x0A;
	byte * edi_12 = edi - 0x01;
	do
	{
		byte * edi_15 = fn08048348((byte) eax, edi_12);
		*edi_15 = 0x2E;
		uint32 eax_29 = SEQ(SLICE(eax, word24, 8), 0x2E);
		edi_12 = edi_15 - 1;
		eax = eax_29 >> 0x08;
	} while (eax_29 >> 0x08 != 0x00);
	*edi_15 = 0x20;
}

// 08048348: Register (ptr32 byte) fn08048348(Register uint8 al, Register (ptr32 byte) edi)
// Called from:
//      fn0804832D
byte * fn08048348(uint8 al, byte * edi)
{
	do
	{
		uint16 ax_7 = (uint16) al;
		*edi = (uint8) (ax_7 % 0x0A) + 0x30;
		uint8 al_11 = (uint8) (ax_7 /u 0x0A);
		++edi;
		al = al_11;
	} while (al_11 != 0x00);
	return edi;
}

// 0804835A: Register Eq_692 fn0804835A(Register Eq_2 edx, Register out ptr32 esiOut)
// Called from:
//      fn0804809F
Eq_692 fn0804835A(Eq_2 edx, ptr32 & esiOut)
{
	Eq_692 eax_11 = sys_open(&g_b80483BB, 0x00, edx);
	if (eax_11 < 0x00)
	{
l080483B8:
		esiOut = 0x00;
		return eax_11;
	}
	else
	{
		sys_read(eax_11, &g_b804861C, 0x0200);
		word24 eax_24_8_94 = SLICE(sys_close(eax_11), word24, 8);
		struct Eq_719 * esi_36 = &g_b804861C;
		do
		{
			byte al_39 = esi_36->b0000;
			esi_36 = &esi_36->b0000 + 1;
			eax_11 = SEQ(eax_24_8_94, al_39);
			if (al_39 == 0x00)
				goto l080483B8;
			if (al_39 != 110 || esi_36->b0000 != 0x73656D61)
				continue;
			esi_36 = (struct Eq_719 *) &esi_36->dw0004;
			if (esi_36->dw0004 != 0x65767265)
				continue;
			++esi_36;
		} while (esi_36[1] != 114);
		cu8 * esi_60 = &esi_36->b0008 + 1;
		do
		{
			esi_60 = esi_136 + 1;
			esi_136 = esi_60;
		} while (*esi_136 <= 0x20);
		struct Eq_760 * esi_68 = esi_60 - 0x01;
		do
		{
			cu8 al_76 = esi_68->b0000;
			++esi_68;
			Eq_692 eax_95 = SEQ(eax_24_8_94, al_76);
		} while (al_76 >= 0x2E);
		esi_68->bFFFFFFFF = 0x00;
		esiOut = esi_60 - 0x01;
		return eax_95;
	}
}

char g_b80483BB = '/'; // 080483BB
byte * g_ptr80483CC = null; // 080483CC
ptr32 g_ptr80483D0 = 0x00; // 080483D0
Eq_17 g_t80483D4 = // 080483D4
	{
		0
	};
byte g_b80483EC = 0x00; // 080483EC
char g_b80483ED = '\0'; // 080483ED
word16 g_w80483F6 = 0x00; // 080483F6
word16 g_w80483F8 = 0x00; // 080483F8
word16 g_w80483FA = 0x00; // 080483FA
word16 g_w80483FC = 0x00; // 080483FC
byte g_b8048404 = 0x00; // 08048404
byte g_b8048405 = 0x00; // 08048405
Eq_3 g_t8048604 = // 08048604
	{
		0
	};
word16 g_w8048608 = 0x00; // 08048608
cui16 g_w804860A = 0x00; // 0804860A
word32 g_dw804860C = 0x00; // 0804860C
byte g_b804860F = 0x00; // 0804860F
char g_b804861C = '\0'; // 0804861C
