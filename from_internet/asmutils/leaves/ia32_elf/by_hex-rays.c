/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// char __usercall sub_804804C@<al>(char result@<al>, int@<ebx>, int@<esi>, int);
// int __usercall sub_804805C@<eax>(float *@<ebp>, _DWORD *@<edi>, int@<esi>, float, float, char);
// void __usercall __noreturn start(mode_t@<edx>, int@<edi>, int@<esi>);

//-------------------------------------------------------------------------
// Data declarations

__int16 word_8048156 = 13107; // weak
__int16 word_8048182 = 25647; // weak


//----- (0804804C) --------------------------------------------------------
char __usercall sub_804804C@<al>(char result@<al>, int a2@<ebx>, int a3@<esi>, int a4)
{
  *(_BYTE *)(a4 + 640 * a2 + a3) = result;
  return result;
}

//----- (0804805C) --------------------------------------------------------
int __usercall sub_804805C@<eax>(float *a1@<ebp>, _DWORD *a2@<edi>, int a3@<esi>, float a4, float a5, char a6)
{
  long double v6; // fst7
  int v7; // ebx
  char v8; // al
  int v9; // edx
  int v10; // edx
  char v11; // cl
  _DWORD *v12; // edi
  long double v13; // fst7
  long double v14; // fst6
  long double v15; // fst6
  char v16; // cl
  float v18; // [esp+0h] [ebp-24h]
  float v19; // [esp+4h] [ebp-20h]
  float v20; // [esp+Ch] [ebp-18h]
  float v21; // [esp+10h] [ebp-14h]
  int v22; // [esp+18h] [ebp-Ch]

  if ( !a6 )
    JUMPOUT(0x804805B);
  v6 = a1[4];
  v7 = (int)(v6 * a4 + a1[6]);
  v8 = sub_804804C(*a2, v7, a3, (int)(a1[5] - v6 * a5));
  *(_DWORD *)v9 = (int)(v6 * *(float *)(v9 + 20) + a1[7]);
  sub_804804C(v8, v7, a3, v22);
  v12 = (_DWORD *)((char *)a2 + 1);
  if ( (int)v12 >= (int)&word_8048182 )
    v12 -= 2;
  v13 = a1[1];
  v14 = *a1;
  *(float *)(v10 - 8) = v13 * *(float *)(v10 + 16) - v14 * *(float *)(v10 + 20);
  v20 = v14 * *(float *)(v10 + 16) + v13 * *(float *)(v10 + 20);
  sub_804805C(a1, v12, a3, v20, v21, v11 - 1);
  v15 = a4 - a1[8];
  v19 = a1[3] * v15 + a1[2] * a5;
  v18 = a1[8] + v15 * a1[2] - a1[3] * a5;
  return sub_804805C(a1, v12, a3, v18, v19, v16);
}
// 8048062: control flows out of bounds to 804805B
// 804808E: variable 'v9' is possibly undefined
// 8048096: variable 'v22' is possibly undefined
// 80480B3: variable 'v10' is possibly undefined
// 80480D2: variable 'v21' is possibly undefined
// 80480CB: variable 'v11' is possibly undefined
// 804810D: variable 'v16' is possibly undefined
// 8048182: using guessed type __int16 word_8048182;

//----- (08048117) --------------------------------------------------------
void __usercall __noreturn start(mode_t a1@<edx>, int a2@<edi>, int a3@<esi>)
{
  int v3; // edx
  void *v4; // edi
  unsigned int v5; // ecx
  int v6; // eax
  _DWORD v7[6]; // [esp-18h] [ebp-18h] BYREF

  v7[5] = 0;
  v7[4] = sys_open((char *)&word_8048156 + 44, 2, a1);
  v7[3] = 1;
  v7[2] = 3;
  v7[1] = 307200;
  v7[0] = 0;
  v4 = (void *)old_mmap(v7, 0x4B000u, v3, a3, a2, (off_t)&word_8048156);
  memset(v4, 0, v5);
  sub_804805C((float *)&word_8048156, (_DWORD *)&word_8048156 + 9, (int)v4, 0.0, 0.0, 28);
  v6 = sys_exit((int)v7);
}
// 804813B: variable 'v3' is possibly undefined
// 8048143: variable 'v5' is possibly undefined
// 8048156: using guessed type __int16 word_8048156;

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
