// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register Eq_2 edx, Stack word32 dwArg00, Stack (ptr32 byte) dwArg08)
void fn0804804C(Eq_2 edx, word32 dwArg00, byte * dwArg08)
{
	ptr32 fp;
	Eq_6 ebp_48 = 0x0A;
	struct Eq_8 * esp_16 = fp + 4;
	if (dwArg00 != 0x01)
	{
		byte * esi_15 = dwArg08;
		esp_16 = fp + 0x0C;
		Eq_6 ebx_116 = 0x00;
		while (true)
		{
			cu8 al_24 = *esi_15;
			++esi_15;
			if (al_24 < 0x30)
				break;
			uint32 eax_115 = (uint32) (al_24 - 0x30);
			if (al_24 > 0x39 || al_24 < 0x30)
				break;
			ebx_116 = ebx_116 *s 0x0A + eax_115;
		}
		Eq_6 ebx_33 = ebx_116;
		if (ebx_116 != 0x00)
		{
			esp_16 = fp + 0x0C;
			if (ebx_116 >= 0x3C)
				ebx_33.u0 = 0x3C;
			ebp_48 = ebx_33;
		}
	}
	g_t80480CB.u0 = (int32) ebp_48;
	int32 * esp_55 = esp_16 - 4;
	*esp_55 = 0x01;
	int32 ecx_57 = *esp_55;
	*esp_55 = 0x05;
	Eq_30 eax_69 = sys_open(&g_b80480BD, ecx_57, edx);
	if (eax_69 >= 0x00)
	{
		*esp_55 = 0x02;
		if (sys_fork() == 0x00)
		{
			while (true)
			{
				size_t * esp_86 = esp_16 - 4;
				*esp_86 = (uint32) 0x01;
				Eq_87 edx_88 = *esp_86;
				*esp_86 = (uint32) 0x04;
				sys_write(eax_69, &g_b80480BD, edx_88);
				sys_nanosleep(&g_t80480CB, null);
			}
		}
	}
	esp_16->dwFFFFFFFC = 0x01;
	sys_exit(0x080480BD);
}

char g_b80480BD = '/'; // 080480BD
Eq_6 g_t80480CB = // 080480CB
	{
		0
	};
