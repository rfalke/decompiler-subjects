/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __fastcall __noreturn start(int, mode_t);
// void __usercall sub_8048376(unsigned int a1@<eax>, _BYTE *a2@<ecx>);

//-------------------------------------------------------------------------
// Data declarations

int dword_8048398[2] = { -1869574134, -1869574000 }; // weak
__int64 qword_80483A0 = 4557430888798830399LL; // weak
__int64 qword_80483A8 = 1099511693569LL; // weak
char aDevFb0[9] = "/dev/fb0"; // weak
int dword_80483BC[65554]; // weak
char byte_8088405[3]; // weak
int dword_80933EA; // weak
int dword_80933EE; // weak
int dword_80933FC; // weak
int dword_8093400; // weak
int dword_8093404; // weak
int dword_8093408; // weak
int dword_8093414; // weak
int dword_809349C; // weak
int dword_80934A0; // weak
int dword_80934A4; // weak
int dword_80934A8; // weak
int dword_80934AC; // weak
int dword_80934B0; // weak
int dword_80934B4[128]; // weak
int dword_80936B4[128]; // weak
int dword_80938B4[128]; // weak
struct timeval tv; // idb
struct timeval stru_8093ABC; // idb
int d; // idb
int dword_8093AC8; // weak
int dword_8093ACC; // weak
int dword_8093ADC[2]; // weak


//----- (08048050) --------------------------------------------------------
void __fastcall __noreturn start(int a1, mode_t a2)
{
  int v2; // eax
  int *v3; // esi
  int *v4; // edi
  int *v5; // ebx
  int i; // ecx
  int v7; // eax
  int v8; // ecx
  int *v9; // esi
  int v10; // ecx
  int *v11; // esi
  __m64 *v12; // edi
  int v13; // ecx
  __m64 v14; // mm7
  __m64 v15; // mm6
  __m64 v16; // mm0
  int v17; // eax
  int v18; // eax
  int v19; // eax
  int v20; // eax
  int v21; // [esp-4h] [ebp-4h]

  v2 = sys_open(aDevFb0, 2, a2);
  if ( v2 >= 0 )
  {
    d = v2;
    v2 = sys_ioctl(v2, 17922);
    if ( v2 >= 0 )
    {
      v2 = sys_ioctl(d, 17920);
      if ( v2 >= 0 )
      {
        __asm { int     80h; LINUX - sys_mmap2 }
        dword_80933EA = 192;
        dword_80933EE = d;
        dword_80933FC = 640;
        dword_8093400 = 480;
        dword_8093404 = 640;
        dword_8093408 = 480;
        dword_8093414 = 8;
        v2 = sys_ioctl(d, 17921);
        if ( v2 >= 0 )
        {
          dword_809349C = 0;
          dword_80934A0 = 256;
          dword_80934A4 = (int)dword_80934B4;
          dword_80934A8 = (int)dword_80936B4;
          dword_80934AC = (int)dword_80938B4;
          dword_80934B0 = 0;
          v2 = sys_ioctl(d, 17924);
          if ( v2 >= 0 )
          {
            dword_80934A4 = (int)dword_80934B4;
            dword_80934A8 = (int)dword_80936B4;
            dword_80934AC = (int)dword_80938B4;
            v3 = dword_80934B4;
            v4 = dword_80936B4;
            v5 = dword_80938B4;
            for ( i = 0; i != 64; ++i )
            {
              *(_WORD *)v3 = (_WORD)i << 8;
              *(_WORD *)v4 = 0;
              *(_WORD *)v5 = 0;
              *((_WORD *)v3 + 64) = 16128;
              *((_WORD *)v4 + 64) = (_WORD)i << 8;
              *((_WORD *)v5 + 64) = 0;
              *((_WORD *)v3 + 128) = 16128;
              *((_WORD *)v4 + 128) = 16128;
              *((_WORD *)v5 + 128) = (_WORD)i << 9;
              *((_WORD *)v3 + 192) = 16128;
              *((_WORD *)v4 + 192) = 16128;
              *((_WORD *)v5 + 192) = 16128;
              v3 = (int *)((char *)v3 + 2);
              v4 = (int *)((char *)v4 + 2);
              v5 = (int *)((char *)v5 + 2);
            }
            v2 = sys_ioctl(d, 17925);
            if ( v2 >= 0 )
            {
              dword_8093AC8 = (int)byte_8088405;
              dword_8093ACC = 19088743;
              v7 = sys_gettimeofday(&tv, 0);
              v8 = 1000;
              while ( 1 )
              {
                v21 = v8;
                v9 = &dword_80483BC[76640];
                v10 = 160;
                do
                {
                  dword_8093ACC = dword_8093AC8 * dword_8093ACC + 1;
                  *v9++ = dword_8093ACC;
                  --v10;
                }
                while ( v10 );
                v11 = dword_80483BC;
                v12 = (__m64 *)dword_80933EA;
                v13 = 38320;
                v14.m64_u64 = qword_80483A0;
                v15.m64_u64 = qword_80483A8;
                do
                {
                  v16 = _m_paddusb(
                          _m_paddusb(
                            _m_paddusb(*((__m64 *)v11 + 80), *(__m64 *)((char *)v11 + 1279)),
                            *((__m64 *)v11 + 160)),
                          *(__m64 *)((char *)v11 + 1281));
                  v12->m64_u64 = (unsigned __int64)v16;
                  if ( (v13 & 3) == 0 )
                    v16 = _m_psubusb(v16, v15);
                  *(__m64 *)v11 = _m_pand(_m_psrlqi(v16, 2u), v14);
                  v11 += 2;
                  ++v12;
                  --v13;
                }
                while ( v13 );
                v8 = v21 - 1;
                if ( v21 == 1 )
                {
                  v17 = sys_gettimeofday(&stru_8093ABC, 0);
                  sub_8048376(
                    0xF4240u / (1000 * (stru_8093ABC.tv_sec - tv.tv_sec) + (stru_8093ABC.tv_usec - tv.tv_usec) / 1000),
                    dword_8093ADC);
                  v18 = sys_write(1, dword_8048398, 1u);
                  _m_empty();
                  v19 = sys_exit(0);
                }
              }
            }
          }
        }
      }
    }
  }
  v20 = sys_exit(v2);
}
// 8048398: using guessed type int dword_8048398[2];
// 80483A0: using guessed type __int64 qword_80483A0;
// 80483A8: using guessed type __int64 qword_80483A8;
// 80483BC: using guessed type int dword_80483BC[65554];
// 80933EA: using guessed type int dword_80933EA;
// 80933EE: using guessed type int dword_80933EE;
// 80933FC: using guessed type int dword_80933FC;
// 8093400: using guessed type int dword_8093400;
// 8093404: using guessed type int dword_8093404;
// 8093408: using guessed type int dword_8093408;
// 8093414: using guessed type int dword_8093414;
// 809349C: using guessed type int dword_809349C;
// 80934A0: using guessed type int dword_80934A0;
// 80934A4: using guessed type int dword_80934A4;
// 80934A8: using guessed type int dword_80934A8;
// 80934AC: using guessed type int dword_80934AC;
// 80934B0: using guessed type int dword_80934B0;
// 80934B4: using guessed type int dword_80934B4[128];
// 80936B4: using guessed type int dword_80936B4[128];
// 80938B4: using guessed type int dword_80938B4[128];
// 8093AC8: using guessed type int dword_8093AC8;
// 8093ACC: using guessed type int dword_8093ACC;
// 8093ADC: using guessed type int dword_8093ADC[2];

//----- (08048376) --------------------------------------------------------
void __usercall sub_8048376(unsigned int a1@<eax>, _BYTE *a2@<ecx>)
{
  unsigned int v2; // et2
  int v3; // eax
  size_t v4; // [esp+0h] [ebp-24h]

  v4 = 0;
  do
  {
    --a2;
    ++v4;
    v2 = a1 % 0xA;
    a1 /= 0xAu;
    *a2 = v2 | 0x30;
  }
  while ( a1 );
  v3 = sys_write(1, a2, v4);
}

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
