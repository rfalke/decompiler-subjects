/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(char *@<edi>);
void __fastcall sub_8048172(char *a1);
// char __usercall sub_8048184@<al>(char *@<esi>);
// void __usercall sub_8048194(unsigned int a1@<eax>, _WORD *a2@<edi>);

//-------------------------------------------------------------------------
// Data declarations

int dword_80481B4 = 1999465517; // weak
char byte_80481BA = '\0'; // weak
char byte_80481BB = '\n'; // weak
char byte_80481BD[3]; // weak
char byte_80481C5[3]; // weak
char byte_80481C9; // weak
char byte_80481CA; // weak
char byte_80481CB; // weak
char byte_80481DB; // weak


//----- (0804804C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn start(char *a1@<edi>)
{
  int v1; // eax
  int *v2; // esi
  int v3; // ecx
  unsigned __int8 v4; // dl
  __int16 v5; // ax
  int v6; // ebp
  int v7; // eax
  char *v8; // ecx
  char *v9; // esi
  int v10; // ecx
  char v11; // ah
  char v12; // al
  int v13; // ecx
  char v14; // bl
  unsigned __int8 v15; // dl
  unsigned int *v16; // esi
  unsigned int v17; // eax
  char *v18; // ecx
  int v19; // ebx
  int v20; // eax
  int v21; // [esp-Ch] [ebp-Ch]
  int v22; // [esp-Ch] [ebp-Ch]
  char *v23; // [esp-8h] [ebp-8h]
  char *v24; // [esp-4h] [ebp-4h]

  v1 = v21 - 1;
  if ( v21 == 1 )
    goto LABEL_10;
  while ( 1 )
  {
    if ( v24 )
    {
      v2 = &dword_80481B4;
      a1 = byte_80481BD;
      v3 = 3;
      v4 = 4;
      while ( 1 )
      {
        v5 = *(_WORD *)v2;
        v2 = (int *)((char *)v2 + 2);
        if ( *(_WORD *)v24 == v5 )
          break;
        v4 >>= 1;
        *(_DWORD *)a1 = 0;
        a1 += 4;
        if ( !--v3 )
        {
          v1 = 0;
          if ( *v24 != 45 )
          {
            a1 = v24;
            byte_80481CA = 1;
            v1 = sys_open(v24, 0, v4);
            if ( v1 >= 0 )
              goto LABEL_11;
LABEL_36:
            v19 = -1;
LABEL_37:
            v20 = sys_exit(v19);
          }
          goto LABEL_10;
        }
      }
      byte_80481BA |= v4;
    }
    else
    {
      if ( byte_80481CA )
      {
        v19 = 0;
        goto LABEL_37;
      }
      byte_80481CA = 1;
      v1 = 0;
LABEL_10:
      byte_80481C9 = 1;
LABEL_11:
      v6 = v1;
      while ( 1 )
      {
        v7 = sys_read(v6, &byte_80481DB, 0x1000u);
        if ( v7 < 0 )
          goto LABEL_36;
        if ( !v7 )
          break;
        v9 = v8;
        v10 = v7;
        v11 = 0;
        do
        {
          v12 = *v9++;
          ++*(_DWORD *)byte_80481C5;
          if ( v12 == 32 || v12 == 9 || v12 == 10 )
          {
            if ( v11 )
            {
              ++*(_DWORD *)&byte_80481C5[-4];
              v11 = 0;
            }
          }
          else
          {
            v11 = 1;
          }
          if ( v12 == 10 )
            ++*(_DWORD *)&byte_80481C5[-8];
          --v10;
        }
        while ( v10 );
      }
      v23 = a1;
      v13 = 3;
      v14 = byte_80481BA;
      v15 = 4;
      v16 = (unsigned int *)byte_80481BD;
      do
      {
        v22 = v13;
        v17 = *v16++;
        if ( !v14 || (v15 & (unsigned __int8)v14) != 0 )
        {
          a1 = &byte_80481CB;
          sub_8048194(v17, &byte_80481CB);
          sub_8048172(v18);
        }
        v15 >>= 1;
        v13 = v22 - 1;
      }
      while ( v22 != 1 );
      if ( byte_80481C9 != 1 )
        sub_8048172(v23);
      sub_8048172(&byte_80481BB);
    }
  }
}
// 8048055: positive sp value C has been found
// 804804D: variable 'v21' is possibly undefined
// 8048057: variable 'v24' is possibly undefined
// 80480C8: variable 'v8' is possibly undefined
// 8048127: variable 'v18' is possibly undefined
// 804812C: variable 'v15' is possibly undefined
// 80481B4: using guessed type int dword_80481B4;
// 80481BA: using guessed type char byte_80481BA;
// 80481BB: using guessed type char byte_80481BB;
// 80481C9: using guessed type char byte_80481C9;
// 80481CA: using guessed type char byte_80481CA;
// 80481CB: using guessed type char byte_80481CB;
// 80481DB: using guessed type char byte_80481DB;

//----- (08048172) --------------------------------------------------------
void __fastcall sub_8048172(char *a1)
{
  size_t v1; // edx
  const void *v2; // ecx
  int v3; // eax

  sub_8048184(a1);
  v3 = sys_write(1, v2, v1);
}
// 8048180: variable 'v2' is possibly undefined
// 8048180: variable 'v1' is possibly undefined

//----- (08048184) --------------------------------------------------------
char __usercall sub_8048184@<al>(char *a1@<esi>)
{
  int v1; // edx
  char result; // al

  v1 = -1;
  do
  {
    ++v1;
    result = *a1++;
  }
  while ( result );
  return result;
}

//----- (08048194) --------------------------------------------------------
void __usercall sub_8048194(unsigned int a1@<eax>, _WORD *a2@<edi>)
{
  int v2; // ecx
  unsigned int v3; // et2
  char v4; // dl

  v2 = 0;
  do
  {
    v3 = a1 % 0xA;
    a1 /= 0xAu;
    v4 = v3 + 48;
    ++v2;
  }
  while ( a1 );
  do
  {
    *(_BYTE *)a2 = v4;
    a2 = (_WORD *)((char *)a2 + 1);
    --v2;
  }
  while ( v2 );
  *a2 = 9;
}

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
