// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register word24 edx_24_8, Register (ptr32 Eq_3) edi, Stack word32 dwArg00)
void fn0804804C(word24 edx_24_8, union Eq_3 * edi, word32 dwArg00)
{
	ptr32 fp;
	struct Eq_6 * esp_102;
	int32 ebx_109;
	Eq_8 eax_114 = dwArg00 - 0x01;
	if (dwArg00 == 0x01)
		esp_102 = fp + 8;
	else
	{
		esp_102 = fp + 8;
l08048054:
		union Eq_3 * ebx_101 = esp_102->dw0000;
		++esp_102;
		if (ebx_101 != null)
		{
			word16 * esi_118 = g_a80481B4;
			edi = (union Eq_3 *) g_a80481BD;
			uint8 dl_125 = 0x04;
			uip32 ecx_142 = 0x03;
			do
			{
				++esi_118;
				if (*ebx_101 == *esi_118)
				{
					g_b80481BA |= dl_125;
					goto l08048054;
				}
				edi->u1 = 0x00;
				dl_125 >>= 0x01;
				edi = (union Eq_3 *) ((char *) edi + 4);
				--ecx_142;
				Eq_40 edx_157 = SEQ(edx_24_8, dl_125);
			} while (ecx_142 != 0x00);
			eax_114.u0 = 0x00;
			if (ebx_101->u0 != 0x2D)
			{
				g_b80481CA = 0x01;
				esp_102->dwFFFFFFFC = 0x05;
				edi = ebx_101;
				eax_114 = sys_open(ebx_101, 0x00, edx_157);
				if (eax_114 < 0x00)
					goto l0804816A;
l080480AB:
				while (true)
				{
					struct Eq_60 * esp_22 = esp_102 - 4;
					esp_22->ptr0000 = (union Eq_3 *) 0x03;
					edx_24_8 = 0x10;
					esp_102 = (struct Eq_6 *) ((char *) &esp_22->ptr0000 + 4);
					int32 eax_26 = sys_read(eax_114, g_a80481DB, 0x1000);
					if (eax_26 < 0x00)
						break;
					if (eax_26 == 0x00)
					{
						esp_22->ptr0000 = edi;
						byte bl_39 = g_b80481BA;
						uint8 dl_41 = 0x04;
						word32 * esi_42 = g_a80481BD;
						uip32 ecx_255 = 0x03;
						do
						{
							esp_22->dwFFFFFFFC = ecx_255;
							uint32 eax_48 = *esi_42;
							++esi_42;
							if (bl_39 == 0x00 || (bl_39 & dl_41) != 0x00)
							{
								fn08048194(eax_48, &g_b80481CB);
								fn08048172(&g_b80481CB);
								edi = (union Eq_3 *) &g_b80481CB;
							}
							uip32 ecx_81 = esp_22->dwFFFFFFFC;
							dl_41 >>= 0x01;
							ecx_255 = ecx_81 - 0x01;
						} while (ecx_81 != 0x01);
						union Eq_3 * ecx_84 = esp_22->ptr0000;
						esp_102 = (struct Eq_6 *) ((char *) &esp_22->ptr0000 + 4);
						if (g_b80481C9 != 0x01)
							fn08048172(ecx_84);
						fn08048172(&g_t80481BB);
						goto l08048054;
					}
					byte * esi_180 = g_a80481DB;
					int32 ecx_181 = eax_26;
					byte ah_201 = 0x00;
					do
					{
						byte al_189 = *esi_180;
						++g_dw80481C5;
						++esi_180;
						if (al_189 != 0x20 && (al_189 != 0x09 && al_189 != 0x0A))
							ah_201 = 0x01;
						else if (ah_201 != 0x00)
						{
							++g_dw80481C1;
							ah_201 = 0x00;
						}
						if (al_189 == 0x0A)
							++g_a80481BD[0];
						--ecx_181;
					} while (ecx_181 != 0x00);
				}
l0804816A:
				ebx_109 = ~0x00;
				goto l0804816D;
			}
		}
		else
		{
			if (g_b80481CA != 0x00)
			{
				ebx_109 = 0x00;
l0804816D:
				esp_102->dwFFFFFFFC = 0x01;
				sys_exit(ebx_109);
			}
			g_b80481CA = 0x01;
			eax_114.u0 = 0x00;
		}
	}
	g_b80481C9 = 0x01;
	goto l080480AB;
}

// 08048172: void fn08048172(Register (ptr32 Eq_3) ecx)
// Called from:
//      fn0804804C
void fn08048172(union Eq_3 * ecx)
{
	sys_write(0x01, ecx, fn08048184(ecx));
}

// 08048184: Register word32 fn08048184(Register (ptr32 Eq_3) esi)
// Called from:
//      fn08048172
word32 fn08048184(union Eq_3 * esi)
{
	word32 edx_13 = ~0x00;
	do
	{
		++edx_13;
		esi = (union Eq_3 *) ((char *) esi_37 + 1);
		esi_37 = esi;
	} while (esi_37->u0 != 0x00);
	return edx_13;
}

// 08048194: void fn08048194(Register uint32 eax, Register (ptr32 byte) edi)
// Called from:
//      fn0804804C
void fn08048194(uint32 eax, byte * edi)
{
	ptr32 fp;
	word32 dwLoc24;
	word32 * esp_25 = fp - 32;
	word32 ecx_28 = 0x00;
	do
	{
		uint64 edx_eax_36 = (uint64) eax;
		uint32 edx_39 = (uint32) (edx_eax_36 % 0x0A);
		esp_25 -= 4;
		*esp_25 = SEQ(SLICE(edx_39, word24, 8), (byte) edx_39 + 0x30);
		eax = (uint32) (edx_eax_36 /u 0x0A);
		++ecx_28;
	} while (eax != 0x00);
	do
	{
		*edi = (byte) dwLoc24;
		++edi;
		--ecx_28;
	} while (ecx_28 != 0x00);
	*edi = (byte) 0x09;
}

Eq_190 g_a80481B4[] = // 080481B4
	{
	};
byte g_b80481BA = 0x00; // 080481BA
Eq_3 g_t80481BB = // 080481BB
	{
		'\n'
	};
word32 g_a80481BD[] = // 080481BD
	{
	};
word32 g_dw80481C1 = 0x00; // 080481C1
word32 g_dw80481C5 = 0x00; // 080481C5
byte g_b80481C9 = 0x00; // 080481C9
byte g_b80481CA = 0x00; // 080481CA
byte g_b80481CB = 0x00; // 080481CB
byte g_a80481DB[] = // 080481DB
	{
	};
