/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(int@<ebx>);
int sub_8048070();
int sub_80480AB();
void sub_80480E2();
void sub_8048478();
// char __usercall sub_804848C@<al>(char result@<al>, int@<edi>);
// char __usercall sub_80484CB@<al>(_BYTE *@<esi>);
// void __usercall sub_80484FB(int a1@<esi>);
// void __usercall sub_8048518(int a1@<edi>);
// void __usercall sub_8048535(unsigned int@<ecx>, void *@<edi>);
void sub_8048546();
void sub_8048552();

//-------------------------------------------------------------------------
// Data declarations

int (*off_804806C)(void) = &loc_80480F6; // weak
__int16 word_804855A = 0; // weak
int dword_804855C; // weak
int dword_8048560; // weak
int dword_8048564; // weak
char byte_8048569[3]; // weak
char byte_8088569[3]; // weak
char byte_8188569; // weak
size_t len; // idb


//----- (0804804C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn start(int a1@<ebx>)
{
  int (*v1)(); // eax
  int v2; // eax
  const char *v3; // [esp-4h] [ebp-4h]

  if ( v3[strlen(v3) - 7] == 105 )
    v1 = sub_80480AB;
  else
    v1 = sub_8048070;
  v1();
  v2 = sys_exit(a1);
}
// 804804E: positive sp value 8 has been found
// 8048051: variable 'v3' is possibly undefined

//----- (08048070) --------------------------------------------------------
int sub_8048070()
{
  int v1; // [esp-4h] [ebp-4h]

  sub_80480E2();
  v1 = sys_read(0, byte_8088569, 0x100000u);
  byte_8188569 = 0;
  *(_DWORD *)(&byte_8188569 + 1) = v1;
  return off_804806C();
}
// 804806C: using guessed type int (*off_804806C)(void);
// 804855A: using guessed type __int16 word_804855A;
// 8048564: using guessed type int dword_8048564;
// 8048568: using guessed type char byte_8048568;
// 8188569: using guessed type char byte_8188569;

//----- (080480AB) --------------------------------------------------------
int sub_80480AB()
{
  int v0; // eax
  int result; // eax
  char *v2; // edi
  size_t *v3; // esi
  _BYTE *v4; // edi
  _BYTE *v5; // esi
  unsigned __int8 v6; // al
  char v7; // al
  char v8; // al
  unsigned int v9; // ecx

  sub_80480E2();
  v0 = sys_read(0, &byte_8188569, 0x100000u);
  result = (unsigned __int8)byte_8188569;
  switch ( byte_8188569 )
  {
    case 0:
      sub_8048478();
      dword_804855C = (int)&byte_8088569[len];
      *(_WORD *)byte_8088569 = *((_WORD *)&len + 2);
      byte_8088569[2] = *((_BYTE *)&len + 6);
      v2 = &byte_8088569[3];
      v3 = &len + 2;
      HIBYTE(word_804855A) = *((_BYTE *)&len + 7);
      LOBYTE(word_804855A) = 0;
      break;
    default:
      return result;
  }
  while ( 1 )
  {
    do
    {
      while ( 1 )
      {
        do
        {
          while ( 1 )
          {
            if ( dword_804855C <= (unsigned int)v2 )
              return sys_write(1, byte_8088569, len);
            if ( sub_80484CB(v3) )
              break;
            sub_8048518((int)v2);
            *v2 = *(_BYTE *)v3;
            v5 = (char *)v3 + 1;
            v4 = v2 + 1;
            sub_8048518((int)v4);
            *v4 = *v5;
            v3 = (size_t *)(v5 + 1);
            v2 = v4 + 1;
          }
          if ( !sub_80484CB(v3) )
          {
            sub_8048518((int)v2);
            *v2 = *(_BYTE *)v3;
            v3 = (size_t *)((char *)v3 + 1);
            ++v2;
          }
          sub_8048518((int)v2);
          sub_8048535(1u, v2);
        }
        while ( !sub_80484CB(v3) );
        sub_8048535(1u, v2);
        if ( sub_80484CB(v3) )
          break;
LABEL_22:
        if ( sub_80484CB(v3) )
          sub_8048535(1u, v2);
      }
      sub_8048535(2u, v2);
    }
    while ( !sub_80484CB(v3) );
    sub_8048535(1u, v2);
    if ( sub_80484CB(v3) )
    {
      sub_8048535(4u, v2);
      if ( !sub_80484CB(v3) )
        goto LABEL_22;
      if ( sub_80484CB(v3) )
      {
        sub_8048535(3u, v2);
        do
        {
          v6 = *(_BYTE *)v3;
          v3 = (size_t *)((char *)v3 + 1);
          sub_8048535(v6, v2);
        }
        while ( v7 == -1 );
      }
      else
      {
        sub_8048535(2u, v2);
      }
    }
    else
    {
      if ( !sub_80484CB(v3) )
        goto LABEL_22;
      v8 = sub_80484CB(v3);
      v9 = 3;
      if ( v8 != 1 )
        v9 = 2;
      sub_8048535(v9, v2);
    }
  }
}
// 804841B: variable 'v7' is possibly undefined
// 804855A: using guessed type __int16 word_804855A;
// 804855C: using guessed type int dword_804855C;
// 8188569: using guessed type char byte_8188569;

//----- (080480E2) --------------------------------------------------------
void sub_80480E2()
{
  memset32(byte_8088569, -136732609, 0x80000u);
}

//----- (08048478) --------------------------------------------------------
void sub_8048478()
{
  memset32(byte_8048569, (int)byte_8088569, 0x10000u);
}

//----- (0804848C) --------------------------------------------------------
char __usercall sub_804848C@<al>(char result@<al>, int a2@<edi>)
{
  char v2; // bl

  v2 = (result << word_804855A) | HIBYTE(word_804855A);
  HIBYTE(word_804855A) = v2;
  if ( (_BYTE)word_804855A == 7 )
  {
    word_804855A = 0;
    *(_BYTE *)dword_8048564 = v2;
    dword_8048564 = a2;
  }
  else
  {
    LOBYTE(word_804855A) = word_804855A + 1;
  }
  return result;
}
// 804855A: using guessed type __int16 word_804855A;
// 8048564: using guessed type int dword_8048564;

//----- (080484CB) --------------------------------------------------------
char __usercall sub_80484CB@<al>(_BYTE *a1@<esi>)
{
  char result; // al

  result = (HIBYTE(word_804855A) >> word_804855A) & 1;
  if ( (_BYTE)word_804855A == 7 )
  {
    LOBYTE(word_804855A) = 0;
    HIBYTE(word_804855A) = *a1;
  }
  else
  {
    LOBYTE(word_804855A) = word_804855A + 1;
  }
  return result;
}
// 804855A: using guessed type __int16 word_804855A;

//----- (080484FB) --------------------------------------------------------
void __usercall sub_80484FB(int a1@<esi>)
{
  unsigned __int16 v1; // ax
  int *v2; // eax

  LOBYTE(v1) = *(_BYTE *)(a1 - 1);
  HIBYTE(v1) = *(_BYTE *)(a1 - 2);
  v2 = (int *)(4 * v1 + 134514025);
  dword_8048560 = *v2;
  *v2 = a1;
}
// 8048560: using guessed type int dword_8048560;

//----- (08048518) --------------------------------------------------------
void __usercall sub_8048518(int a1@<edi>)
{
  unsigned __int16 v1; // ax
  int *v2; // eax

  LOBYTE(v1) = *(_BYTE *)(a1 - 1);
  HIBYTE(v1) = *(_BYTE *)(a1 - 2);
  v2 = (int *)(4 * v1 + 134514025);
  dword_8048560 = *v2;
  *v2 = a1;
}
// 8048560: using guessed type int dword_8048560;

//----- (08048535) --------------------------------------------------------
void __usercall sub_8048535(unsigned int a1@<ecx>, void *a2@<edi>)
{
  int v2; // esi

  v2 = dword_8048560;
  qmemcpy(a2, (const void *)dword_8048560, a1);
  dword_8048560 = v2 + a1;
}
// 8048560: using guessed type int dword_8048560;

//----- (08048546) --------------------------------------------------------
void sub_8048546()
{
  ;
}
// 8048560: using guessed type int dword_8048560;

//----- (08048552) --------------------------------------------------------
void sub_8048552()
{
  ++dword_8048560;
}
// 8048560: using guessed type int dword_8048560;

// nfuncs=12 queued=12 decompiled=12 lumina nreq=0 worse=0 better=0
// ALL OK, 12 function(s) have been successfully decompiled
