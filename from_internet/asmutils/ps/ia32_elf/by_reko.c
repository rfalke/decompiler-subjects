// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register Eq_2 edx)
void fn0804804C(Eq_2 edx)
{
	fn08048176(&g_t80481BB);
	Eq_8 eax_17 = sys_open(&g_b80481D5, 0x00, edx);
	if (eax_17 >= 0x00)
	{
		while (true)
		{
			int32 eax_33 = sys_getdents(eax_17, &g_t80486EC, 0x1000);
			if (eax_33 < 0x00 || eax_33 == 0x00)
				break;
			struct Eq_27 * ebx_175 = &g_t80486EC;
			int32 ecx_176 = eax_33;
			do
			{
				struct Eq_5 * esi_77 = &ebx_175->w0008 + 1;
				if (fn0804815A(esi_77) == 0x00)
				{
					fn08048196(&g_b80481D5, &g_t80481EC);
					fn080481A3(esi_77, &g_t80481EC);
					fn080481A3(&g_t80481DC, &g_t80481EC);
					Eq_57 eax_116 = sys_open(&g_t80481EC, 0x00, 0x1000);
					if (eax_116 >= 0x00 && sys_read(eax_116, &g_b80482EC, 0x0400) >= 0x00)
					{
						sys_close(eax_116);
						fn08048132(&g_b80482EC);
						fn08048176(&g_t80481E2);
					}
				}
				Eq_30 eax_174 = (uint32) ebx_175->w0008;
				ebx_175 += eax_174;
				ecx_176 -= eax_174;
			} while (ecx_176 != 0x00);
		}
	}
	sys_exit(0x00);
}

// 08048111: void fn08048111(Register word32 ecx, Register (ptr32 Eq_5) edi)
// Called from:
//      fn08048132
void fn08048111(word32 ecx, struct Eq_5 * edi)
{
	do
	{
		edi = edi_88 + (strlen(edi_88) + 1);
		ecx = ecx_87 - 0x01;
		ecx_87 = ecx;
		edi_88 = edi;
	} while (ecx_87 != 0x01);
	fn08048176(edi_88);
	fn08048176(&g_t80481E4);
}

// 08048132: void fn08048132(Register (ptr32 Eq_5) edi)
// Called from:
//      fn0804804C
void fn08048132(struct Eq_5 * edi)
{
	struct Eq_5 * esi_28 = edi;
	while (true)
	{
		byte al_31 = esi_28->b0000;
		++esi_28;
		if (al_31 == 0x00)
			break;
		if (al_31 == 0x20)
			esi_28->bFFFFFFFF = 0x00;
	}
	byte * esi_37 = g_a80481E6;
	while (true)
	{
		byte al_40 = *esi_37;
		++esi_37;
		if (al_40 == 0x00)
			break;
		fn08048111((word32) al_40, edi);
	}
}

// 0804815A: Register uint32 fn0804815A(Register (ptr32 Eq_5) esi)
// Called from:
//      fn0804804C
uint32 fn0804815A(struct Eq_5 * esi)
{
	byte ah_24 = 0x00;
	do
	{
		char al_13 = esi->b0000;
		++esi;
		if (al_13 == 0x00)
			return (uint32) ah_24;
		if (al_13 < 0x30)
		{
			ah_24 = 0x01;
			return (uint32) ah_24;
		}
	} while (al_13 <= 0x39);
	ah_24 = 0x01;
	return (uint32) ah_24;
}

// 08048176: void fn08048176(Register (ptr32 Eq_5) ecx)
// Called from:
//      fn0804804C
//      fn08048111
void fn08048176(struct Eq_5 * ecx)
{
	sys_write(0x01, ecx, fn08048188(ecx));
}

// 08048188: Register word32 fn08048188(Register (ptr32 Eq_5) esi)
// Called from:
//      fn08048176
//      fn08048196
//      fn080481A3
word32 fn08048188(struct Eq_5 * esi)
{
	word32 edx_12 = ~0x00;
	do
	{
		++edx_12;
		esi = esi_36 + 1;
		esi_36 = esi;
	} while (esi_36->b0000 != 0x00);
	return edx_12;
}

// 08048196: void fn08048196(Register (ptr32 Eq_5) esi, Register (ptr32 Eq_42) edi)
// Called from:
//      fn0804804C
void fn08048196(struct Eq_5 * esi, <unknown>* edi)
{
	memcpy(edi, esi, (word32) fn08048188(esi) + 1);
}

// 080481A3: void fn080481A3(Register (ptr32 Eq_5) esi, Register (ptr32 Eq_5) edi)
// Called from:
//      fn0804804C
void fn080481A3(struct Eq_5 * esi, struct Eq_5 * edi)
{
	memcpy(edi + fn08048188(edi), esi, fn08048188(esi) + 0x01);
}

Eq_5 g_t80481BB = // 080481BB
	{
		0xC3,
		'P',
	};
char g_b80481D5 = '/'; // 080481D5
Eq_5 g_t80481DC = // 080481DC
	{
		0x00,
		'/',
	};
Eq_5 g_t80481E2 = // 080481E2
	{
		0x00,
		'\n',
	};
Eq_5 g_t80481E4 = // 080481E4
	{
		0x00,
		'\t',
	};
byte g_a80481E6[] = // 080481E6
	{
	};
Eq_42 g_t80481EC = // 080481EC;
char g_b80482EC = '\0'; // 080482EC
Eq_27 g_t80486EC = // 080486EC
	{
		0x00,
	};
