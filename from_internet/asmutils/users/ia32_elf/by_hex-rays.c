/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __cdecl __noreturn start();

//-------------------------------------------------------------------------
// Data declarations

char filename[] = "/var/run/utmp"; // idb
char byte_80480DE = ' '; // weak
char byte_80480DF = '\n'; // weak
char byte_80480E0; // weak
int dword_804810C[85]; // weak


//----- (0804804C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __cdecl __noreturn start()
{
  char *v0; // edx
  int v1; // eax
  int v2; // eax
  int v3; // eax
  int v4; // eax
  int v5; // eax
  char v6; // [esp-8h] [ebp-8h]
  int v7; // [esp-8h] [ebp-8h]
  char *retaddr; // [esp+0h] [ebp+0h]

  if ( v6 == 2 )
    v0 = retaddr;
  else
    v0 = filename;
  v7 = sys_open(v0, 0, (mode_t)v0);
  if ( v7 != -2 )
  {
    while ( sys_read(v7, &byte_80480E0, 0x180u) )
    {
      byte_80480E0 ^= 7u;
      if ( !byte_80480E0 )
      {
        v1 = sys_write(1, dword_804810C, 0x20u);
        v2 = sys_write(1, &byte_80480DE, 1u);
      }
    }
    v3 = sys_write(1, &byte_80480DF, 1u);
  }
  v4 = sys_close(v7);
  v5 = sys_exit(0);
}
// 804805E: positive sp value 8 has been found
// 8048051: variable 'v6' is possibly undefined
// 80480DE: using guessed type char byte_80480DE;
// 80480DF: using guessed type char byte_80480DF;
// 80480E0: using guessed type char byte_80480E0;
// 804810C: using guessed type int dword_804810C[85];

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
