// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Stack byte bArg00, Stack Eq_3 dwArg08)
void fn0804804C(byte bArg00, Eq_3 dwArg08)
{
	ptr32 fp;
	word32 dwArg00;
	Eq_3 edx_14;
	ptr32 esp_15 = fp + 4;
	if ((byte) dwArg00 != 0x02)
		edx_14 = (Eq_3) &g_b80480D0;
	else
	{
		edx_14 = dwArg08;
		esp_15 = fp + 0x0C;
	}
	struct Eq_16 * esp_22 = esp_15 - 4;
	esp_22->t0000.u0 = 0x05;
	Eq_19 eax_26 = sys_open(edx_14, 0x00, edx_14);
	esp_22->t0000.u0 = (int32) eax_26;
	if (eax_26 != ~0x01)
	{
		while (true)
		{
			Eq_19 ebx_37 = esp_22->t0000.u0;
			esp_22->tFFFFFFFC = 0x03;
			if (sys_read(ebx_37, &g_b80480E0, 0x0180) == 0x00)
				break;
			g_b80480E0 = g_b80480E0 ^ 0x07;
			if (g_b80480E0 == 0x00)
			{
				esp_22->tFFFFFFFC = 0x20;
				Eq_40 edx_86 = esp_22->tFFFFFFFC;
				esp_22->tFFFFFFFC = 0x01;
				Eq_40 ebx_91 = esp_22->tFFFFFFFC;
				esp_22->tFFFFFFFC = 0x04;
				sys_write(ebx_91, &g_b804810C, edx_86);
				esp_22->tFFFFFFFC = 0x01;
				Eq_40 edx_100 = esp_22->tFFFFFFFC;
				esp_22->tFFFFFFFC = 0x01;
				Eq_40 ebx_105 = esp_22->tFFFFFFFC;
				esp_22->tFFFFFFFC = 0x04;
				sys_write(ebx_105, &g_b80480DE, edx_100);
			}
		}
		esp_22->tFFFFFFFC = 0x01;
		Eq_40 edx_49 = esp_22->tFFFFFFFC;
		esp_22->tFFFFFFFC = 0x01;
		Eq_40 ebx_54 = esp_22->tFFFFFFFC;
		esp_22->tFFFFFFFC = 0x04;
		sys_write(ebx_54, &g_b80480DF, edx_49);
	}
	Eq_19 ebx_63 = esp_22->t0000.u0;
	esp_22->tFFFFFFFC = 0x06;
	sys_close(ebx_63);
	esp_22->tFFFFFFFC = 0x01;
	sys_exit(0x00);
}

char g_b80480D0 = '/'; // 080480D0
char g_b80480DE = ' '; // 080480DE
char g_b80480DF = '\n'; // 080480DF
ui8 g_b80480E0 = 0x00; // 080480E0
char g_b804810C = '\0'; // 0804810C
