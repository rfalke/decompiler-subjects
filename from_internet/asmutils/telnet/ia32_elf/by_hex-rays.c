/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(int@<ebp>);
// char __usercall sub_804829F@<al>(int@<edi>, int@<esi>);
int sub_80482C1();
int sub_80482F3();

//-------------------------------------------------------------------------
// Data declarations

int dword_804804C[8] =
{
  1852731203,
  1702126437,
  691675236,
  1668506912,
  543518817,
  1918986339,
  544367988,
  1310749545
}; // weak
char byte_804806F = 'U'; // weak
_UNKNOWN ufds; // weak
__int16 word_8048309; // weak
__int16 word_804830B; // weak
int dword_804830D; // weak
__int16 word_8048311; // weak
__int16 word_8048313; // weak
char byte_8048315[3]; // weak
int dword_8048331; // weak
char byte_8048349[3]; // weak


//----- (0804809D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn start(int a1@<ebp>)
{
  int v1; // eax
  int v2; // eax
  int v3; // eax
  unsigned __int8 *v4; // esi
  char i; // bl
  unsigned __int8 v6; // al
  bool v7; // cf
  unsigned __int8 v8; // al
  int v9; // eax
  int v10; // eax
  char *v11; // esi
  size_t v12; // eax
  size_t v13; // edx
  char *v14; // edi
  int v15; // eax
  char v16; // al
  char *v17; // esi
  char v18; // al
  char v19; // al
  bool v20; // zf
  char v21; // al
  int v22; // eax
  int v23; // eax
  int v24; // eax
  int v25; // [esp-10h] [ebp-10h]
  int v26; // [esp-8h] [ebp-8h]
  size_t v27; // [esp-8h] [ebp-8h]
  unsigned __int8 *v28; // [esp-4h] [ebp-4h]

  sub_80482C1();
  if ( v25 == 1 )
  {
    v1 = sys_write(1, &byte_804806F, 0x18u);
  }
  else
  {
    sub_804829F((int)byte_8048315, v26);
    v4 = v28;
    i = 23;
    if ( v28 )
    {
      for ( i = 0; ; i = v8 + 10 * i )
      {
        v6 = *v4++;
        v7 = v6 < 0x30u;
        v8 = v6 - 48;
        if ( v7 || v8 > 9u )
          break;
      }
    }
    *(_DWORD *)byte_8048315 = 2;
    byte_8048315[3] = i;
    __asm { int     80h; LINUX - sys_socket }
    a1 = 102;
    __asm
    {
      int     80h; LINUX - sys_setsockopt
      int     80h; LINUX - sys_connect
      int     80h; LINUX - sys_setsockopt
    }
    v9 = sys_write(1, dword_804804C, 0x23u);
    while ( 1 )
    {
LABEL_10:
      while ( 1 )
      {
        ufds = 102;
        word_8048309 = 3;
        dword_804830D = 0;
        word_8048311 = 3;
        __asm { int     80h; LINUX - sys_poll }
        if ( (word_804830B & 3) != 0 )
          break;
        if ( (word_8048313 & 3) != 0 )
          v10 = sys_write(102, byte_8048349, sys_read(0, byte_8048349, 0x400u));
      }
      v11 = byte_8048349;
      v12 = sys_read(102, byte_8048349, 0x400u);
      if ( !v12 )
        break;
      v13 = v12;
      v14 = &byte_8048349[v12];
      if ( byte_8048349[0] != -1 )
      {
        v15 = sys_write(1, byte_8048349, v12);
        continue;
      }
      while ( 1 )
      {
        if ( v11 == v14 )
        {
          v22 = sys_write(102, byte_8048349, v13);
          goto LABEL_10;
        }
        v16 = *v11;
        v17 = v11 + 1;
        if ( v16 != -1 )
          break;
        v18 = *v17;
        v11 = v17 + 1;
        if ( v18 == -2 || v18 == -5 || v18 == -4 )
        {
          ++v11;
        }
        else if ( v18 == -3 )
        {
          v19 = *v11++;
          v20 = v19 == 8;
          v21 = -4;
          if ( v20 )
            v21 = -5;
          *(v11 - 2) = v21;
        }
      }
      v27 = v13;
      v23 = sys_write(102, byte_8048349, v17 - byte_8048349 - 1);
      v24 = sys_write(1, v17, v27 - (v17 - byte_8048349));
    }
  }
  sub_80482F3();
  v2 = sys_close(a1);
  v3 = sys_exit(0);
}
// 80480F1: positive sp value 10 has been found
// 80480BA: conditional instruction was optimized away because eax.4==0
// 80480A4: variable 'v25' is possibly undefined
// 80480EB: variable 'v26' is possibly undefined
// 80480F0: variable 'v28' is possibly undefined
// 804804C: using guessed type int dword_804804C[8];
// 804806F: using guessed type char byte_804806F;
// 8048309: using guessed type __int16 word_8048309;
// 804830B: using guessed type __int16 word_804830B;
// 804830D: using guessed type int dword_804830D;
// 8048311: using guessed type __int16 word_8048311;
// 8048313: using guessed type __int16 word_8048313;

//----- (0804829F) --------------------------------------------------------
char __usercall sub_804829F@<al>(int a1@<edi>, int a2@<esi>)
{
  int v2; // edx
  int i; // ecx
  char j; // bl
  unsigned __int8 v5; // al
  bool v6; // cf
  char result; // al

  v2 = 0;
  for ( i = 0; i != 4; ++i )
  {
    for ( j = 0; ; j = result + 10 * j )
    {
      v5 = *(_BYTE *)(a2 + v2++);
      v6 = v5 < 0x30u;
      result = v5 - 48;
      if ( v6 )
        break;
    }
    *(_BYTE *)(a1 + i + 4) = j;
  }
  return result;
}

//----- (080482C1) --------------------------------------------------------
int sub_80482C1()
{
  int v0; // eax
  int result; // eax
  int v2; // [esp-4h] [ebp-4h]

  v0 = sys_ioctl(0, 21505);
  v2 = dword_8048331;
  result = sys_ioctl(0, 21506);
  dword_8048331 = v2;
  return result;
}
// 8048331: using guessed type int dword_8048331;

//----- (080482F3) --------------------------------------------------------
int sub_80482F3()
{
  return sys_ioctl(0, 21506);
}

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
