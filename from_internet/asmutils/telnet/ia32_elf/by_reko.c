// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

char g_b804804C = 'C'; // 0804804C
char g_b804806F = 'U'; // 0804806F
char g_b8048087 = 'C'; // 08048087
// 0804809D: void fn0804809D(Register Eq_2 ebp, Stack word32 dwArg00, Stack uint32 dwArg04, Stack ptr32 dwArg08, Stack (ptr32 byte) dwArg0C)
void fn0804809D(Eq_2 ebp, word32 dwArg00, uint32 dwArg04, ptr32 dwArg08, byte * dwArg0C)
{
	ptr32 fp;
	uint32 dwLoc08;
	uint32 * esp_205;
	Eq_2 eax_112;
	fn080482C1();
	if (dwArg00 == 0x01)
	{
		sys_write(0x01, &g_b804806F, 0x18);
		esp_205 = &dwArg04;
		eax_112.u0 = 0x00;
	}
	else
	{
		fn0804829F(dwArg08, 0x08048315);
		byte bl_33 = 0x17;
		byte * esi_34 = dwArg0C;
		if (dwArg0C != null)
		{
			Eq_113 ebx_339 = 0x00;
			while (true)
			{
				bl_33 = (byte) ebx_339;
				cu8 al_46 = *esi_34;
				++esi_34;
				if (al_46 < 0x30)
					break;
				uint32 eax_338 = (uint32) (al_46 - 0x30);
				if (al_46 > 0x39 || al_46 < 0x30)
					break;
				ebx_339 = ebx_339 *s 0x0A + eax_338;
			}
		}
		g_dw8048315 = 0x02;
		g_b8048318 = bl_33;
		dwArg04 = 0x02;
		eax_112 = sys_socketcall(0x01, &dwArg04);
		bool v35_426 = eax_112 < 0x00;
		do
		{
			esp_205 = fp + 0x10;
			if (v35_426)
				goto l080480B8;
			dwArg04 = (uint32) (fp + 0x0C);
			dwLoc08 = (uint32) eax_475;
			int32 eax_107 = sys_socketcall(0x0E, &dwLoc08);
			ebp = eax_475;
			v35_426 = eax_107 < 0x00;
			eax_112.u0 = 0x10;
			eax_475 = eax_112;
			if (eax_107 < 0x00)
				continue;
			dwArg04 = (uint32) eax_475;
			eax_112 = sys_socketcall(0x03, &dwArg04);
			v35_426 = eax_112 < 0x00;
			eax_476 = eax_112;
			if (eax_112 < 0x00)
				continue;
			dwArg04 = (uint32) (fp + 0x0C);
			dwLoc08 = (uint32) eax_475;
			int32 eax_158 = sys_socketcall(0x0E, &dwLoc08);
			v35_426 = eax_158 < 0x00;
			eax_112.u0 = 0x01;
			eax_477 = eax_112;
		} while (eax_158 < 0x00);
		sys_write(0x01, &g_b804804C, 0x23);
		while (true)
		{
l08048198:
			while (true)
			{
				g_t8048305.u0 = (int32) eax_475;
				g_w8048309 = 0x03;
				g_dw804830D = 0x00;
				g_w8048311 = 0x03;
				sys_poll(&g_t8048305, 0x02, 60000);
				if ((g_w804830B & 0x03) != 0x00)
					break;
				if ((g_w8048313 & 0x03) != 0x00)
					sys_write(eax_475, &g_b8048349, sys_read(0x00, &g_b8048349, 0x0400));
			}
			Eq_2 eax_209 = sys_read(eax_475, &g_b8048349, 0x0400);
			struct Eq_220 * esi_197 = &g_b8048349;
			esp_205 = fp + 0x10;
			eax_112 = eax_209;
			if (eax_209 == 0x00)
				break;
			if (g_b8048349 != ~0x00)
				sys_write(0x01, &g_b8048349, eax_209);
			else
			{
				while (esi_197 != (word32) eax_209 + 134513481)
				{
					struct Eq_295 * esi_236 = &esi_197->b0000 + 1;
					if (esi_197->b0000 != ~0x00)
					{
						dwArg04 = esi_236 - 0x08048349;
						sys_write(eax_475, &g_b8048349, esi_236 - 0x0804834A);
						sys_write(0x01, esi_236, eax_209 - dwArg04);
						goto l08048198;
					}
					byte al_273 = esi_236->b0000;
					esi_197 = (struct Eq_220 *) &esi_236->b0001;
					if (al_273 != ~0x01 && (al_273 != ~0x04 && al_273 != 252))
					{
						if (al_273 == ~0x02)
						{
							esi_197 = (struct Eq_220 *) (&esi_236->b0001 + 1);
							char al_290 = 252;
							if (esi_236->b0001 == 0x08)
								al_290 = ~0x04;
							esi_236->b0000 = al_290;
						}
					}
					else
						esi_197 = (struct Eq_220 *) (&esi_236->b0001 + 1);
				}
				sys_write(eax_475, &g_b8048349, eax_209);
			}
		}
	}
l080480B8:
	if (eax_112 != 0x00 && eax_112 == ~0x6E)
	{
		union Eq_2 * esp_368 = esp_205 - 4;
		esp_368->u0 = 22;
		Eq_2 edx_370 = esp_368->u0;
		esp_368->u0 = 0x01;
		Eq_2 ebx_375 = esp_368->u0;
		esp_368->u0 = 0x04;
		sys_write(ebx_375, &g_b8048087, edx_370);
	}
	fn080482F3();
	word32 * esp_398 = esp_205 - 4;
	*esp_398 = 0x06;
	sys_close(ebp);
	*esp_398 = 0x01;
	sys_exit(0x00);
}

// 0804829F: void fn0804829F(Register ptr32 esi, Register ptr32 edi)
// Called from:
//      fn0804809D
void fn0804829F(ptr32 esi, ptr32 edi)
{
	int32 edx_15 = 0x00;
	int32 ecx_26;
	for (ecx_26 = 0x00; ecx_26 != 0x04; ++ecx_26)
	{
		int32 ebx_34 = 0x00;
		while (true)
		{
			cu8 al_17 = *((word32) esi + edx_15);
			byte bl_22 = (byte) ebx_34;
			++edx_15;
			uint32 eax_33 = (uint32) (al_17 - 0x30);
			if (al_17 < 0x30)
				break;
			ebx_34 = ebx_34 *s 0x0A + eax_33;
		}
		*((word32) (edi + 4) + ecx_26) = (ptr32) bl_22;
	}
}

// 080482C1: void fn080482C1()
// Called from:
//      fn0804809D
void fn080482C1()
{
	sys_ioctl(0x00, 0x5401, 134513445);
	ui32 eax_12 = g_dw8048331;
	g_dw8048331 = eax_12 & ~0x0A;
	sys_ioctl(0x00, 0x5402, 134513445);
	g_dw8048331 = eax_12;
}

// 080482F3: void fn080482F3()
// Called from:
//      fn0804809D
void fn080482F3()
{
	sys_ioctl(0x00, 0x5402, 134513445);
}

Eq_2 g_t8048305 = // 08048305
	{
		0
	};
word16 g_w8048309 = 0x00; // 08048309
cui16 g_w804830B = 0x00; // 0804830B
word32 g_dw804830D = 0x00; // 0804830D
word16 g_w8048311 = 0x00; // 08048311
cui16 g_w8048313 = 0x00; // 08048313
word32 g_dw8048315 = 0x00; // 08048315
byte g_b8048318 = 0x00; // 08048318
ui32 g_dw8048331 = 0x00; // 08048331
byte g_b8048349 = 0x00; // 08048349
