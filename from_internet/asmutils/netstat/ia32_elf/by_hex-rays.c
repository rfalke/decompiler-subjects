/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn sub_8048279(_BYTE *a1@<eax>, char a2@<cl>, int a3@<edi>, int a4@<esi>);
// void __usercall __noreturn sub_804827D(_BYTE *@<eax>, int@<edi>);
// void __usercall __noreturn start(int@<eax>);
// void __usercall sub_8048364(int a1@<eax>, int a2@<ebx>);
// void __usercall sub_80483E9(_DWORD *@<ebx>);
void sub_8048412();
int __fastcall sub_804845B(const void *, size_t);
void __fastcall sub_80484B0(int, mode_t);
// void __usercall sub_8048553(mode_t a1@<edx>, char *a2@<ebx>, void (*a3)(void)@<edi>);
// int __usercall sub_8048568@<eax>(int@<ebx>, void (*)(void)@<edi>);
void sub_80485B8();
void __fastcall sub_8048639(int a1, int a2);
void __fastcall sub_80486CD(int, int);
// int __usercall sub_80487F8@<eax>(int@<edx>, _WORD *@<esi>);
// unsigned int __usercall sub_8048842@<eax>(unsigned int result@<eax>, int@<edx>, int@<ecx>, _BYTE *@<edi>);
// int __usercall sub_804886C@<eax>(int@<edx>, _WORD *@<esi>);
// void __usercall sub_8048884(int a1@<edx>, _BYTE *a2@<edi>, _WORD *a3@<esi>);
// unsigned int __usercall sub_8048895@<eax>(int@<edx>, _BYTE *@<edi>, _WORD *@<esi>);
// void __usercall sub_80488A8(int a1@<edx>, _BYTE *a2@<edi>, _WORD *a3@<esi>);
// int __usercall sub_80488C4@<eax>(int@<edx>, _WORD *@<esi>);
// unsigned int __usercall sub_80488EC@<eax>(_BYTE *@<edi>, _BYTE *@<esi>);

//-------------------------------------------------------------------------
// Data declarations

char aProcNetTcp[14] = "/proc/net/tcp"; // weak
char aProcNetUdp[14] = "/proc/net/udp"; // weak
char aProcNetRaw[14] = "/proc/net/raw"; // weak
char aProcNetUnix[15] = "/proc/net/unix"; // weak
char byte_8048085[3] = { 't', 'c', 'p' }; // weak
char byte_804808B = 'u'; // weak
char byte_8048091[3] = { 'r', 'a', 'w' }; // weak
char byte_8048097 = 'u'; // weak
char byte_804809D[3] = { 'A', 'c', 't' }; // weak
int dword_80480B8[6] = { 1769235265, 1428186486, 542656846, 1634561892, 1931505257, 1701536623 }; // weak
__int16 word_80480D2 = 10272; // weak
__int16 word_80480E2 = 10272; // weak
char byte_80480F1[3] = { ' ', '(', 's' }; // weak
int dword_804810C[16] =
{
  1953460816,
  1867260015,
  543973731,
  1919181889,
  544437093,
  538976288,
  538976288,
  1866866720,
  1734960498,
  1681989742,
  1936028260,
  538976371,
  538976288,
  1951604768,
  543519841,
  538976288
}; // weak
char byte_804814F = 'P'; // weak
char byte_804819F = ' '; // weak
char byte_804822F = 'F'; // weak
char byte_804823D[3] = { 'L', 'I', 'S' }; // weak
char byte_8048275[3] = { 'A', 'C', 'C' }; // weak
_UNKNOWN loc_804827A; // weak
char byte_8048910; // weak
char byte_8048912; // weak
char byte_8048913; // weak
char byte_8048914; // weak
char byte_8048915; // weak
char byte_8048916; // weak
char byte_8048917; // weak
char byte_8048918; // weak
char byte_8048919; // weak
char byte_804891A; // weak
char byte_804891B; // weak
int dword_804991C; // weak
int dword_8049ACA; // weak
int dword_8049AD0[6]; // weak
int dword_8049AE8[6]; // weak
int dword_8049B00[3]; // weak
int dword_8049B0D; // weak
char byte_8049B13; // weak
__int16 word_8049B1A; // weak
__int16 word_8049B26; // weak
char byte_8049B31[3]; // weak
char byte_8049B3F; // weak
__int16 word_8049B46; // weak
int dword_8049B5D; // weak
char byte_8049B62; // weak
int dword_8049B63; // weak


//----- (08048279) --------------------------------------------------------
void __usercall __noreturn sub_8048279(_BYTE *a1@<eax>, char a2@<cl>, int a3@<edi>, int a4@<esi>)
{
  *(_BYTE *)(a4 + 32) &= a2;
  sub_804827D(a1, a3);
}

//----- (0804827D) --------------------------------------------------------
void __usercall __noreturn sub_804827D(_BYTE *a1@<eax>, int a2@<edi>)
{
  *a1 &= BYTE1(a1);
  *a1 &= BYTE1(a1);
  *(_BYTE *)(a2 + 2 * (_DWORD)a1 + 82) &= (unsigned __int8)a1;
  *a1 &= BYTE1(a1);
  *a1 &= BYTE1(a1);
  *a1 &= BYTE1(a1);
  *a1 &= BYTE1(a1);
  *a1 &= BYTE1(a1);
  *a1 &= BYTE1(a1);
  *a1 &= BYTE1(a1);
  *a1 &= BYTE1(a1);
  *a1 &= BYTE1(a1);
  *a1 &= BYTE1(a1);
  *a1 &= BYTE1(a1);
  *a1 &= BYTE1(a1);
  start((int)a1);
}

//----- (080482B4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn start(int a1@<eax>)
{
  int v1; // ebx
  int v2; // eax
  mode_t v3; // edx
  int v4; // ecx
  int v5; // eax
  mode_t v6; // edx
  int v7; // eax
  int v8; // [esp-Ch] [ebp-Ch]
  int v9; // [esp-4h] [ebp-4h]

  v1 = v8 - 1;
  if ( v8 != 1 )
  {
    while ( 1 )
    {
      v1 = v9;
      if ( !v9 )
        break;
      if ( *(_BYTE *)v9 == 45 )
      {
        if ( *(_BYTE *)(v9 + 1) == 45 )
          sub_80483E9((_DWORD *)(v9 + 2));
        else
          sub_8048364(a1, v9 + 1);
      }
    }
  }
  sub_8048412();
  if ( byte_8048916 )
  {
    sub_804845B(byte_804809D, 0x1Bu);
    v1 = 1;
    v2 = sys_write(1, dword_804810C, 0x43u);
    sub_80484B0(v4, v3);
  }
  if ( byte_8048915 )
  {
    sub_804845B(dword_80480B8, 0x1Au);
    v1 = 1;
    v5 = sys_write(1, &byte_804814F, 0x50u);
    if ( byte_8048915 )
    {
      qmemcpy(&dword_8049B0D, &byte_8048097, 6u);
      v1 = (int)aProcNetUnix;
      sub_8048553(v6, aProcNetUnix, (void (*)(void))sub_80486CD);
    }
  }
  v7 = sys_exit(v1);
}
// 80482BA: positive sp value C has been found
// 80482B5: variable 'v8' is possibly undefined
// 80482B9: variable 'v9' is possibly undefined
// 80482C9: variable 'a1' is possibly undefined
// 8048307: variable 'v4' is possibly undefined
// 8048307: variable 'v3' is possibly undefined
// 804835A: variable 'v6' is possibly undefined
// 8048097: using guessed type char byte_8048097;
// 80480B8: using guessed type int dword_80480B8[6];
// 804810C: using guessed type int dword_804810C[16];
// 804814F: using guessed type char byte_804814F;
// 8048915: using guessed type char byte_8048915;
// 8048916: using guessed type char byte_8048916;
// 8049B0D: using guessed type int dword_8049B0D;

//----- (08048364) --------------------------------------------------------
void __usercall sub_8048364(int a1@<eax>, int a2@<ebx>)
{
  int v2; // ecx
  _BYTE *v3; // ebx

  v2 = 6;
  v3 = (_BYTE *)(a2 - 1);
  do
  {
    if ( !*++v3 )
      break;
    if ( *v3 == 97 )
    {
      ++byte_8048914;
      byte_8048912 = 10;
      ++byte_8048913;
    }
    if ( *v3 == 108 && !a1 )
    {
      byte_8048912 = 10;
      byte_8048913 = 0;
    }
    if ( *v3 == 116 )
    {
      ++byte_8048918;
      ++byte_804891B;
    }
    if ( *v3 == 117 )
    {
      ++byte_8048919;
      ++byte_804891B;
    }
    if ( *v3 == 119 )
    {
      ++byte_804891A;
      ++byte_804891B;
    }
    if ( *v3 == 112 )
      ++byte_8048910;
    --v2;
  }
  while ( v2 );
}
// 8048910: using guessed type char byte_8048910;
// 8048912: using guessed type char byte_8048912;
// 8048913: using guessed type char byte_8048913;
// 8048914: using guessed type char byte_8048914;
// 8048918: using guessed type char byte_8048918;
// 8048919: using guessed type char byte_8048919;
// 804891A: using guessed type char byte_804891A;
// 804891B: using guessed type char byte_804891B;

//----- (080483E9) --------------------------------------------------------
void __usercall sub_80483E9(_DWORD *a1@<ebx>)
{
  if ( *a1 == 2020175477 )
  {
    ++byte_8048915;
    ++byte_8048917;
  }
  if ( *a1 == 1952804457 )
  {
    ++byte_8048916;
    ++byte_8048917;
  }
}
// 8048915: using guessed type char byte_8048915;
// 8048916: using guessed type char byte_8048916;
// 8048917: using guessed type char byte_8048917;

//----- (08048412) --------------------------------------------------------
void sub_8048412()
{
  if ( !byte_804891B )
  {
    ++byte_8048918;
    ++byte_8048919;
    ++byte_804891A;
  }
  if ( !byte_8048914 && !byte_8048912 )
    ++byte_8048913;
  if ( !byte_8048917 )
  {
    ++byte_8048915;
    ++byte_8048916;
  }
}
// 8048912: using guessed type char byte_8048912;
// 8048913: using guessed type char byte_8048913;
// 8048914: using guessed type char byte_8048914;
// 8048915: using guessed type char byte_8048915;
// 8048916: using guessed type char byte_8048916;
// 8048917: using guessed type char byte_8048917;
// 8048918: using guessed type char byte_8048918;
// 8048919: using guessed type char byte_8048919;
// 804891A: using guessed type char byte_804891A;
// 804891B: using guessed type char byte_804891B;

//----- (0804845B) --------------------------------------------------------
int __fastcall sub_804845B(const void *a1, size_t a2)
{
  int v2; // eax

  v2 = sys_write(1, a1, a2);
  if ( byte_8048914 )
    return sys_write(1, byte_80480F1, 0x1Bu);
  if ( byte_8048913 )
    return sys_write(1, &word_80480E2, 0xFu);
  return sys_write(1, &word_80480D2, 0x10u);
}
// 80480D2: using guessed type __int16 word_80480D2;
// 80480E2: using guessed type __int16 word_80480E2;
// 8048913: using guessed type char byte_8048913;
// 8048914: using guessed type char byte_8048914;

//----- (080484B0) --------------------------------------------------------
void __fastcall sub_80484B0(int a1, mode_t a2)
{
  if ( byte_8048918 )
  {
    qmemcpy(&dword_8049ACA, byte_8048085, 6u);
    sub_8048553(a2, aProcNetTcp, (void (*)(void))sub_8048639);
  }
  if ( byte_8048919 )
  {
    qmemcpy(&dword_8049ACA, &byte_804808B, 6u);
    sub_8048553(a2, aProcNetUdp, (void (*)(void))sub_8048639);
  }
  if ( byte_804891A )
  {
    qmemcpy(&dword_8049ACA, byte_8048091, 6u);
    sub_8048553(a2, aProcNetRaw, (void (*)(void))sub_8048639);
  }
}
// 80484FD: variable 'a2' is possibly undefined
// 804808B: using guessed type char byte_804808B;
// 8048918: using guessed type char byte_8048918;
// 8048919: using guessed type char byte_8048919;
// 804891A: using guessed type char byte_804891A;
// 8049ACA: using guessed type int dword_8049ACA;

//----- (08048553) --------------------------------------------------------
void __usercall sub_8048553(mode_t a1@<edx>, char *a2@<ebx>, void (*a3)(void)@<edi>)
{
  int v3; // eax

  v3 = sys_open(a2, 0, a1);
  if ( v3 >= 0 )
    sub_8048568(v3, a3);
}

//----- (08048568) --------------------------------------------------------
int __usercall sub_8048568@<eax>(int a1@<ebx>, void (*a2)(void)@<edi>)
{
  int *v2; // esi
  int result; // eax

LABEL_1:
  memset(&dword_804991C, 32, 0x100u);
  v2 = &dword_804991C;
  while ( 1 )
  {
    result = sys_read(a1, v2, 1u);
    if ( result <= 0 )
      return result;
    LOBYTE(result) = *(_BYTE *)v2;
    v2 = (int *)((char *)v2 + 1);
    if ( result == 10 )
    {
      if ( dword_804991C != 1819484192 && dword_804991C != 544044366 )
      {
        a2();
        sub_80485B8();
      }
      goto LABEL_1;
    }
  }
}
// 804991C: using guessed type int dword_804991C;

//----- (080485B8) --------------------------------------------------------
void sub_80485B8()
{
  int *v0; // ecx
  size_t v1; // edx
  int v2; // eax

  if ( (_BYTE)dword_8049B5D == 10 )
  {
LABEL_7:
    if ( !byte_8048912 )
      return;
    goto LABEL_10;
  }
  if ( dword_8049B0D == 2020175477 )
  {
    if ( (_BYTE)dword_8049B5D == 1 && (dword_8049B63 & 0x10000) != 0 )
      goto LABEL_7;
  }
  else if ( !(_BYTE)dword_8049B5D )
  {
    goto LABEL_7;
  }
  if ( !byte_8048913 )
    return;
LABEL_10:
  if ( byte_8049B62 )
  {
    if ( byte_8049B62 != 1 )
      return;
    v0 = &dword_8049B0D;
    v1 = 80;
  }
  else
  {
    v0 = &dword_8049ACA;
    v1 = 67;
  }
  v2 = sys_write(1, v0, v1);
}
// 8048912: using guessed type char byte_8048912;
// 8048913: using guessed type char byte_8048913;
// 8049ACA: using guessed type int dword_8049ACA;
// 8049B0D: using guessed type int dword_8049B0D;
// 8049B5D: using guessed type int dword_8049B5D;
// 8049B62: using guessed type char byte_8049B62;
// 8049B63: using guessed type int dword_8049B63;

//----- (08048639) --------------------------------------------------------
void __fastcall sub_8048639(int a1, int a2)
{
  int v2; // edx
  int v3; // edx
  int v4; // edx
  int v5; // edx
  int v6; // ecx
  char *v7; // esi

  byte_8049B62 = 0;
  memset(dword_8049AD0, 32, 0x3Cu);
  LOBYTE(dword_8049AD0[15]) = 10;
  sub_80488A8(a2, dword_8049AD0, (_WORD *)&dword_804991C + 3);
  LOBYTE(dword_8049AD0[0]) = 58;
  sub_8048884(v2, (_BYTE *)dword_8049AD0 + 1, (int *)((char *)&dword_804991C + 7));
  sub_80488A8(v3, dword_8049AE8, (_WORD *)&dword_804991C + 4);
  LOBYTE(dword_8049AE8[0]) = 58;
  sub_8048884(v4, (_BYTE *)dword_8049AE8 + 1, (int *)((char *)&dword_804991C + 9));
  dword_8049B5D = sub_80487F8(v5, (_WORD *)&dword_804991C + 5);
  v6 = dword_8049B5D;
  v7 = &byte_804819F;
  if ( dword_8049B5D == 7 && dword_8049ACA == 544236661 )
  {
    dword_8049B5D = 0;
  }
  else
  {
    do
    {
      v7 += 12;
      --v6;
    }
    while ( v6 );
  }
  qmemcpy(dword_8049B00, v7, sizeof(dword_8049B00));
}
// 804866F: variable 'v2' is possibly undefined
// 804867C: variable 'v3' is possibly undefined
// 8048688: variable 'v4' is possibly undefined
// 804868E: variable 'v5' is possibly undefined
// 804819F: using guessed type char byte_804819F;
// 804991C: using guessed type int dword_804991C;
// 8049ACA: using guessed type int dword_8049ACA;
// 8049AD0: using guessed type int dword_8049AD0[6];
// 8049AE8: using guessed type int dword_8049AE8[6];
// 8049B00: using guessed type int dword_8049B00[3];
// 8049B5D: using guessed type int dword_8049B5D;
// 8049B62: using guessed type char byte_8049B62;

//----- (080486CD) --------------------------------------------------------
void __fastcall sub_80486CD(int a1, int a2)
{
  int v2; // edx
  int v3; // edx
  int v4; // ebx
  __int16 *v5; // edi
  int v6; // edx
  int v7; // ecx
  char *v8; // esi
  int v9; // eax
  char *v10; // esi
  int v11; // ecx
  char *v12; // esi
  __int16 *v13; // edi
  int v14; // ecx
  char v15; // al

  byte_8049B62 = 1;
  memset(&byte_8049B13, 32, 0x49u);
  *(&byte_8049B13 + 73) = 10;
  sub_8048895(a2, &byte_8049B13, (_WORD *)&dword_804991C + 5);
  dword_8049B63 = sub_80488C4(v2, (_WORD *)&dword_804991C + 10);
  v4 = dword_8049B63;
  word_8049B1A = 8283;
  v5 = &word_8049B1A + 1;
  if ( (dword_8049B63 & 0x10000) != 0 )
  {
    qmemcpy(v5, byte_8048275, 4u);
    v5 = &word_8049B1A + 3;
  }
  if ( (v4 & 0x20000) != 0 )
    qmemcpy(v5++, sub_8048279, sizeof(__int16));
  if ( (v4 & 0x40000) != 0 )
    qmemcpy(v5++, (char *)&loc_804827A + 1, sizeof(__int16));
  *(_BYTE *)v5 = 93;
  v7 = sub_804886C(v3, (int *)((char *)&dword_804991C + 21));
  v8 = (char *)sub_804827D - 11;
  do
  {
    v8 += 11;
    --v7;
  }
  while ( v7 );
  qmemcpy(&word_8049B26, v8, 0xBu);
  v9 = sub_80487F8(v6, (_WORD *)&dword_804991C + 11);
  dword_8049B5D = v9;
  if ( v9 != 1 )
  {
    v11 = v9;
    v10 = &byte_804822F - 14;
    do
    {
      v10 += 14;
      --v11;
    }
    while ( v11 );
    goto LABEL_14;
  }
  if ( (dword_8049B63 & 0x10000) != 0 )
  {
    v10 = byte_804823D;
LABEL_14:
    qmemcpy(byte_8049B31, v10, 0xEu);
  }
  qmemcpy(&byte_8049B3F + 1, (char *)&dword_804991C + 23, 5u);
  v12 = (char *)&dword_804991C + 29;
  v13 = &word_8049B46;
  v14 = 22;
  do
  {
    v15 = *v12++;
    if ( v15 == 10 )
      break;
    *(_BYTE *)v13 = v15;
    v13 = (__int16 *)((char *)v13 + 1);
    --v14;
  }
  while ( v14 );
}
// 80486FF: variable 'v2' is possibly undefined
// 804876B: variable 'v3' is possibly undefined
// 8048793: variable 'v6' is possibly undefined
// 804822F: using guessed type char byte_804822F;
// 804991C: using guessed type int dword_804991C;
// 8049B13: using guessed type char byte_8049B13;
// 8049B1A: using guessed type __int16 word_8049B1A;
// 8049B26: using guessed type __int16 word_8049B26;
// 8049B3F: using guessed type char byte_8049B3F;
// 8049B46: using guessed type __int16 word_8049B46;
// 8049B5D: using guessed type int dword_8049B5D;
// 8049B62: using guessed type char byte_8049B62;
// 8049B63: using guessed type int dword_8049B63;

//----- (080487F8) --------------------------------------------------------
int __usercall sub_80487F8@<eax>(int a1@<edx>, _WORD *a2@<esi>)
{
  int v2; // eax
  int v3; // ecx
  int i; // ebx
  int v5; // ebx

  LOWORD(v2) = *a2;
  v3 = 2;
  for ( i = (unsigned __int8)*a2; ; i = v2 )
  {
    if ( i > 57 )
      v5 = i > 90 ? i - 87 : i - 55;
    else
      v5 = i - 48;
    if ( !--v3 )
      break;
    a1 = 16 * v5;
    v2 = (unsigned __int16)(v2 & 0xFF00) >> 8;
  }
  return v5 + a1;
}

//----- (08048842) --------------------------------------------------------
unsigned int __usercall sub_8048842@<eax>(unsigned int result@<eax>, int a2@<edx>, int a3@<ecx>, _BYTE *a4@<edi>)
{
  if ( result )
  {
    sub_8048842(result / 0xA, result % 0xA, a3, a4);
    goto LABEL_5;
  }
  if ( !a2 )
  {
LABEL_5:
    result = a2 + 48;
    *a4 = a2 + 48;
  }
  return result;
}
// 8048863: variable 'a2' is possibly undefined

//----- (0804886C) --------------------------------------------------------
int __usercall sub_804886C@<eax>(int a1@<edx>, _WORD *a2@<esi>)
{
  int v2; // eax
  int v3; // eax
  int v4; // edx

  v2 = sub_80487F8(a1, a2);
  v3 = sub_80487F8(v2 << 8, a2);
  return v3 + v4;
}
// 804887F: variable 'v4' is possibly undefined

//----- (08048884) --------------------------------------------------------
void __usercall sub_8048884(int a1@<edx>, _BYTE *a2@<edi>, _WORD *a3@<esi>)
{
  int v3; // eax
  int v4; // ecx

  v3 = sub_804886C(a1, a3);
  sub_8048842(v3, 0, v4, a2);
}
// 804888D: variable 'v4' is possibly undefined

//----- (08048895) --------------------------------------------------------
unsigned int __usercall sub_8048895@<eax>(int a1@<edx>, _BYTE *a2@<edi>, _WORD *a3@<esi>)
{
  int v3; // eax
  int v4; // ecx

  v3 = sub_80488C4(a1, a3);
  return sub_8048842(v3, 0, v4, a2);
}
// 804889F: variable 'v4' is possibly undefined

//----- (080488A8) --------------------------------------------------------
void __usercall sub_80488A8(int a1@<edx>, _BYTE *a2@<edi>, _WORD *a3@<esi>)
{
  int v3; // edx

  sub_80488C4(a1, a3);
  *(int *)((char *)&dword_8049B5D + 1) = v3;
  sub_80488EC(a2, (_BYTE *)&dword_8049B5D + 1);
}
// 80488AF: variable 'v3' is possibly undefined
// 8049B5D: using guessed type int dword_8049B5D;

//----- (080488C4) --------------------------------------------------------
int __usercall sub_80488C4@<eax>(int a1@<edx>, _WORD *a2@<esi>)
{
  int v2; // eax
  int v3; // eax
  int v4; // edx
  int v5; // eax
  int v6; // edx
  int v7; // eax
  int v8; // edx

  v2 = sub_80487F8(a1, a2);
  v3 = sub_80487F8(v2 << 24, a2);
  v5 = sub_80487F8((v3 << 16) + v4, a2);
  v7 = sub_80487F8((v5 << 8) + v6, a2);
  return v7 + v8;
}
// 80488D6: variable 'v4' is possibly undefined
// 80488E0: variable 'v6' is possibly undefined
// 80488E9: variable 'v8' is possibly undefined

//----- (080488EC) --------------------------------------------------------
unsigned int __usercall sub_80488EC@<eax>(_BYTE *a1@<edi>, _BYTE *a2@<esi>)
{
  int v2; // ecx
  unsigned int i; // eax
  unsigned int result; // eax
  int v5; // ecx

  v2 = 4;
  for ( i = 0; ; i = 46 )
  {
    LOBYTE(i) = *a2++;
    result = sub_8048842(i, 0, v2, a1);
    v2 = v5 - 1;
    if ( !v2 )
      break;
    *a1++ = 46;
  }
  return result;
}
// 80488FD: variable 'v5' is possibly undefined

// nfuncs=21 queued=21 decompiled=21 lumina nreq=0 worse=0 better=0
// ALL OK, 21 function(s) have been successfully decompiled
