/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __fastcall __noreturn start(int, mode_t);

//-------------------------------------------------------------------------
// Data declarations

char byte_804810D[3] = { 'S', 'W', 'A' }; // weak
char byte_8048117 = 'i'; // weak


//----- (0804804C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall __noreturn start(int a1, mode_t a2)
{
  _BYTE *v2; // esi
  int v3; // eax
  int v4; // ebp
  int v5; // eax
  int v6; // eax
  int v7; // edi
  int v8; // eax
  int v9; // eax
  int v10; // eax
  _BYTE *v11; // [esp-8h] [ebp-8h] BYREF
  int v12; // [esp-4h] [ebp-4h] BYREF

  v2 = v11;
  do
    LOBYTE(v3) = *v2++;
  while ( (_BYTE)v3 );
  while ( 1 )
  {
    if ( !v12 )
      goto LABEL_11;
    if ( *(_WORD *)(v2 - 7) == 27501 )
      break;
    if ( *(_WORD *)(v2 - 3) == 26214 )
      v3 = sys_swapoff((const char *)v12);
    else
      v3 = sys_swapon((const char *)v12, a1);
  }
  v3 = sys_open((char *)v12, 2, a2);
  if ( v3 >= 0 )
  {
    v4 = v3;
    v5 = sys_lseek(v3, 0, 2);
    if ( v5 < 0
      || (v7 = ((unsigned int)v5 >> 12) - 1, sys_lseek(v4, 1024, 0) < 0)
      || (v12 = 1,
          v8 = sys_write(v4, &v12, 4u),
          v11 = (_BYTE *)v7,
          v9 = sys_write(v4, &v11, 4u),
          v10 = sys_lseek(v4, 4086, 0),
          sys_write(v4, byte_804810D, 0xAu) < 0) )
    {
      v3 = sys_write(2, &byte_8048117, 0xBu);
    }
    else
    {
      v3 = sys_close(v4);
      LOBYTE(v3) = 0;
    }
  }
LABEL_11:
  v6 = sys_exit(v3);
}
// 8048054: positive sp value C has been found
// 8048072: variable 'a1' is possibly undefined
// 804807C: variable 'a2' is possibly undefined
// 8048117: using guessed type char byte_8048117;

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
