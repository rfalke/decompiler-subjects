/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start(); // weak

//-------------------------------------------------------------------------
// Data declarations

int dword_804804C[9] =
{
  1969516365,
  538994028,
  538976288,
  538976288,
  538976288,
  538976288,
  1702521171,
  1934958624,
  1646290021
}; // weak
char filename[] = "/proc/modules"; // idb
size_t ret; // idb
int dword_8048120[2048]; // weak


//----- (08048072) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn start()
{
  int v0; // eax
  int v1; // ebp
  int v2; // eax
  int v3; // eax
  mode_t v4; // edx
  int v5; // eax
  size_t v6; // edx
  int *v7; // ecx
  size_t v8; // ecx
  const char *v9; // esi
  int v10; // [esp-Ch] [ebp-Ch]
  const char *v11; // [esp-8h] [ebp-8h]

  if ( *(_WORD *)&v11[strlen(v11) - 5] == 29548 )
  {
    v3 = sys_write(1, dword_804804C, 0x26u);
    v5 = sys_open(filename, 0, v4);
    if ( v5 < 0 )
    {
      __asm { int     80h; LINUX - sys_query_module }
      v8 = ret;
      v9 = (const char *)dword_8048120;
      do
      {
        v9 += strlen(v9) + 1;
        *((_BYTE *)v9 - 1) = 10;
        --v8;
      }
      while ( v8 );
      v7 = dword_8048120;
      v6 = v9 - (const char *)dword_8048120;
    }
    else
    {
      v6 = sys_read(v5, dword_8048120, 0x2000u);
    }
    v0 = sys_write(1, v7, v6);
  }
  else
  {
    v1 = v10 - 1;
    if ( v10 != 1 )
    {
      do
      {
        LOBYTE(v0) = -127;
        __asm { int     80h; LINUX - sys_delete_module }
        --v1;
      }
      while ( v1 );
    }
  }
  v2 = sys_exit(v0);
}
// 8048085: positive sp value C has been found
// 8048077: variable 'v11' is possibly undefined
// 8048081: variable 'v10' is possibly undefined
// 8048097: variable 'v0' is possibly undefined
// 80480B3: variable 'v4' is possibly undefined
// 80480D1: variable 'v7' is possibly undefined
// 804804C: using guessed type int dword_804804C[9];
// 8048072: using guessed type void __noreturn start();
// 8048120: using guessed type int dword_8048120[2048];

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
