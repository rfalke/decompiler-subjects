// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register Eq_2 edx, Stack word32 dwArg00)
void fn0804804C(Eq_2 edx, word32 dwArg00)
{
	ptr32 fp;
	g_t804811E.u0 = 0x00;
	g_t804811A.u0 = 0x0A;
	int32 edi_6 = 0x00;
	Eq_13 ebp_101 = 0x00;
	struct Eq_15 * esp_14 = fp + 8;
	if (dwArg00 != 0x01)
	{
l0804808D:
		while (true)
		{
			char * ebx_18 = esp_14->dw0000;
			++esp_14;
			if (ebx_18 == null)
				break;
			if (*ebx_18 != 28205)
			{
				if (*ebx_18 == 0x632D)
				{
					g_t804811E.u0 = (size_t) fn08048106(esp_14->dw0000);
					++esp_14;
					continue;
				}
				else
				{
					esp_14->dwFFFFFFFC = 0x05;
					Eq_13 eax_57 = sys_open(ebx_18, 0x00, edx);
					ebp_101 = eax_57;
					if (eax_57 < 0x00)
						goto l080480B7;
					goto l080480BA;
				}
			}
			g_t804811A.u0 = (size_t) fn08048106(esp_14->dw0000);
			++esp_14;
		}
		if (ebp_101 != 0x00)
		{
			esp_14->dwFFFFFFFC = 0x01;
			sys_exit(edi_6);
		}
	}
l080480BA:
	uint32 * esp_77 = esp_14 - 4;
	*esp_77 = 0x03;
	esp_14 = (struct Eq_15 *) (esp_77 + 1);
	edx.u0 = 0x2000;
	struct Eq_30 * eax_84 = sys_read(ebp_101, &g_b8048122, 0x2000);
	if (eax_84 >= null)
	{
		if (eax_84 != null)
		{
			Eq_2 esi_103 = g_t804811E.u0;
			if (esi_103 <= 0x00)
			{
				struct Eq_30 * esi_111 = (struct Eq_30 *) ~0x00;
				do
				{
					++esi_111;
					if (esi_111 > eax_84)
						break;
					if (esi_111[0x08048122] != 0x0A)
						continue;
					g_t804811A.u0 = (size_t) (g_t804811A.u0 - 0x01);
				} while (g_t804811A.u0 != 0x00);
				esi_103 = esi_111 + 1;
			}
			*esp_77 = 0x01;
			uint32 ebx_140 = *esp_77;
			*esp_77 = 0x04;
			sys_write(ebx_140, &g_b8048122, esi_103);
			edx = esi_103;
			esp_14 = (struct Eq_15 *) (esp_77 + 1);
		}
		else
		{
			*esp_77 = 0x06;
			sys_close(ebp_101);
			esp_14 = (struct Eq_15 *) (esp_77 + 1);
			ebp_101 = (word32) ebp_101 + 1;
		}
	}
	else
	{
l080480B7:
		++edi_6;
	}
	goto l0804808D;
}

// 08048106: Register Eq_161 fn08048106(Register (ptr32 byte) esi)
// Called from:
//      fn0804804C
Eq_161 fn08048106(byte * esi)
{
	Eq_161 ebx_17 = 0x00;
	while (true)
	{
		byte al_11 = *esi;
		++esi;
		if (al_11 == 0x00)
			break;
		ebx_17 = ebx_17 *s 0x0A + (uint32) (al_11 - 0x30);
	}
	return ebx_17;
}

Eq_2 g_t804811A = // 0804811A
	{
		0x00
	};
Eq_2 g_t804811E = // 0804811E
	{
		0x00
	};
char g_b8048122 = '\0'; // 08048122
