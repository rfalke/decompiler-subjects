/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall sub_804804C@<eax>(_BYTE *@<esi>);
void __noreturn sub_8048145(); // weak
// void __usercall __noreturn start(int@<ebx>);

//-------------------------------------------------------------------------
// Data declarations

char byte_8048081[] = { '\x03' }; // weak
char byte_8048083[] = { 'H' }; // weak
char byte_804822C[]; // weak


//----- (0804804C) --------------------------------------------------------
int __usercall sub_804804C@<eax>(_BYTE *a1@<esi>)
{
  int result; // eax
  __int16 v2; // bx
  int v3; // ecx
  bool v4; // cf

  result = 0;
  v2 = 0;
  v3 = (unsigned __int8)*a1;
  if ( (_BYTE)v3 != 45 )
    goto LABEL_4;
  HIBYTE(v2) = 1;
  ++a1;
  while ( 1 )
  {
    LOBYTE(v3) = *a1;
LABEL_4:
    v4 = (unsigned __int8)v3 < 0x30u;
    LOBYTE(v3) = v3 - 48;
    if ( v4 || (unsigned __int8)v3 > 9u )
      break;
    result = v3 + 10 * result;
    LOBYTE(v2) = v2 + 1;
    ++a1;
  }
  if ( HIBYTE(v2) )
    return -result;
  return result;
}

//----- (08048147) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn start(int a1@<ebx>)
{
  int v1; // edi
  _BYTE *v2; // esi
  _BYTE *v3; // esi
  char *i; // edi
  int v5; // esi
  char *v6; // edi
  int v7; // eax
  int v8; // eax
  int v9; // eax
  int v10; // ecx
  int v11; // eax
  int v12; // edx
  int v13; // esi
  int v14; // eax
  int v15; // ecx
  int v16; // eax
  int v17; // eax
  int v18; // [esp-Ch] [ebp-Ch]
  _BYTE *v19; // [esp-4h] [ebp-4h]
  _BYTE *retaddr; // [esp+0h] [ebp+0h]

  v1 = v18 - 1;
  if ( v18 != 1 )
  {
    v2 = v19;
    LOBYTE(a1) = *v19;
    if ( *v19 != 45 )
      goto LABEL_22;
    v3 = v19 + 1;
    LOBYTE(a1) = v19[1];
    if ( (_BYTE)a1 == 108 )
    {
      for ( i = byte_8048081; *i; i = &v6[v5] )
      {
        v5 = *(_DWORD *)i & 0xF;
        v6 = i + 2;
        v7 = sys_write(1, v6, v5);
        v8 = sys_write(1, (char *)sub_8048145 + 1, 1u);
      }
      a1 = 1;
      v9 = sys_write(1, sub_8048145, 1u);
    }
    else
    {
      v1 = v18 - 2;
      if ( v18 != 2 )
      {
        sub_804804C(v3);
        if ( (_BYTE)a1 )
        {
          do
          {
LABEL_21:
            v2 = retaddr;
LABEL_22:
            v14 = sub_804804C(v2);
            if ( !(_BYTE)a1 )
              break;
            a1 = v14;
            v16 = sys_kill(v14, v15);
            --v1;
          }
          while ( v1 );
        }
        else
        {
          v11 = 0;
          while ( 1 )
          {
            LOBYTE(a1) = *v3;
            if ( !*v3 )
              break;
            byte_804822C[v11] = a1;
            if ( (_BYTE)v11 == 5 )
              goto LABEL_15;
            LOBYTE(v11) = v11 + 1;
            ++v3;
          }
          if ( (_BYTE)v11 )
          {
LABEL_15:
            a1 = 0;
            v12 = -2;
            while ( 1 )
            {
              LOBYTE(v10) = v11;
              v13 = 0;
              do
              {
                v12 += 2;
                LOBYTE(v12) = BYTE1(a1) + v12;
                BYTE1(a1) = byte_8048081[v12];
                if ( !BYTE1(a1) )
                  goto LABEL_24;
              }
              while ( BYTE1(a1) != (_BYTE)v11 );
              while ( 1 )
              {
                LOBYTE(a1) = byte_804822C[v13];
                if ( (_BYTE)a1 != byte_8048083[v12 + v13] )
                  break;
                ++v13;
                if ( !--v10 )
                  goto LABEL_21;
              }
            }
          }
        }
      }
    }
  }
LABEL_24:
  v17 = sys_exit(a1);
}
// 8048151: positive sp value C has been found
// 8048148: variable 'v18' is possibly undefined
// 8048150: variable 'v19' is possibly undefined
// 804820B: variable 'v10' is possibly undefined
// 8048222: variable 'v15' is possibly undefined
// 8048145: using guessed type void __noreturn sub_8048145();

// nfuncs=3 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
