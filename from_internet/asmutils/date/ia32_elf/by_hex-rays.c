/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// char *__usercall sub_804804C@<eax>(mode_t a1@<edx>, char *a2@<ebx>, int a3@<edi>);
void __cdecl __noreturn start(int, int);
// unsigned __int8 __usercall sub_80482B9@<al>(_BYTE *@<ebp>, unsigned __int8 *@<edi>, int@<esi>);
// unsigned __int8 __usercall sub_80482C2@<al>(_BYTE *@<ebp>, unsigned __int8 *@<edi>, unsigned __int8 *@<esi>);
// char __usercall sub_804832A@<al>(int@<eax>, int@<edx>, int@<ebx>, _BYTE *@<edi>);
// char __usercall sub_804833A@<al>(int@<ebx>, _BYTE *@<edi>, int@<esi>);
// int __usercall sub_8048344@<eax>(int@<edx>, _BYTE *@<edi>);

//-------------------------------------------------------------------------
// Data declarations

char aNtzztdrxxcpbbh[69] = "%ntZzTDrXxcpBbhAayjGVWUwulICYmedkHMSs/usr/lib/locale/LC_TIME%m/%d/%y"; // weak
struct timeval tv; // idb


//----- (0804804C) --------------------------------------------------------
char *__usercall sub_804804C@<eax>(mode_t a1@<edx>, char *a2@<ebx>, int a3@<edi>)
{
  char *result; // eax
  int v4; // eax

  result = (char *)sys_open(a2, 0, a1);
  if ( (int)result >= 0 )
  {
    v4 = sys_newfstat((int)result, (struct stat *)(a3 + 116));
    __asm { int     80h; LINUX - sys_mmap2 }
    return a2;
  }
  return result;
}

//----- (0804807E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __cdecl __noreturn start(int a1, int a2)
{
  int v2; // eax
  char *v3; // ecx
  char v4; // al
  char *v5; // esi
  __int64 v6; // rax
  bool v7; // cf
  char v8; // al
  struct timeval *v9; // edx
  char *v10; // edi
  char *v11; // esi
  char v12; // al
  char *v13; // eax
  char v14; // sf
  int v15; // edi
  int v16; // edx
  char *v17; // eax
  unsigned __int32 v18; // ebx
  unsigned __int32 v19; // esi
  unsigned __int32 v20; // ecx
  char *v21; // eax
  char *v22; // eax
  int v23; // ecx
  char *v24; // eax
  char v25; // al
  unsigned __int64 v27; // rt2
  int v28; // et1
  int v29; // ecx
  int v30; // esi
  int v31; // eax
  int v32; // eax
  unsigned __int64 v33; // rt2
  int v35; // eax
  unsigned __int64 v36; // rt2
  int v37; // edx
  bool v40; // cc
  __int64 v41; // rax
  char v42; // ch
  char v43; // cl
  int v44; // esi
  int v45; // ebx
  int v46; // ecx
  _DWORD *v47; // edi
  _DWORD *v51; // edi
  unsigned int v52; // ecx
  _DWORD *v53; // edi
  int v54; // ebx
  int v55; // edx
  unsigned int v56; // ecx
  int v57; // eax
  _DWORD *v58; // edi
  int v59; // ebx
  int v60; // eax
  int v61; // eax
  char *v62; // [esp-8h] [ebp-8h]
  int v63; // [esp-8h] [ebp-8h]
  int v64; // [esp-4h] [ebp-4h]
  int v65; // [esp-4h] [ebp-4h]
  unsigned __int8 *v66; // [esp-4h] [ebp-4h]

  v2 = sys_gettimeofday(&tv, 0);
  v3 = &aNtzztdrxxcpbbh[-53];
  while ( v62 )
  {
    v4 = *v62;
    v5 = v62 + 1;
    if ( *v62 == 43 )
    {
      v3 = v62 + 1;
    }
    else if ( v4 == 61 )
    {
      v6 = 0LL;
      do
      {
        HIDWORD(v6) = v6 + 10 * HIDWORD(v6);
        LOBYTE(v6) = *v5++;
        v7 = (unsigned __int8)v6 < 0x30u;
        LOBYTE(v6) = v6 - 48;
      }
      while ( !v7 && (unsigned __int8)v6 < 0xAu );
      tv.tv_sec = HIDWORD(v6);
    }
    else if ( v4 == 45 )
    {
      while ( 1 )
      {
        v8 = *v5++;
        if ( !v8 )
          break;
        if ( v8 == 117 )
          *(_DWORD *)((char *)&tv + 82) = 4412501;
      }
    }
  }
  *((_DWORD *)&tv + 23) = v3;
  *((_DWORD *)&tv + 24) = &aNtzztdrxxcpbbh[121];
  v9 = &tv;
  qmemcpy((char *)&tv + 116, &aNtzztdrxxcpbbh[37], 0x10u);
  v10 = (char *)&tv + 132;
  while ( 1 )
  {
    if ( !v64 )
      goto LABEL_21;
    if ( *(_DWORD *)v64 == 1196310860 )
    {
      v11 = (char *)(v64 + 5);
      if ( *(_BYTE *)(v64 + 4) == 61 )
        break;
    }
  }
  do
  {
    v12 = *v11++;
    *v10++ = v12;
  }
  while ( v12 );
  strcpy(v10 - 1, "/LC_TIME");
  v13 = sub_804804C((mode_t)&tv, (char *)&tv + 116, (int)&tv);
  if ( !v14 )
    *((_DWORD *)&tv + 24) = v13;
LABEL_21:
  v15 = (int)v9;
  v16 = 0;
  if ( !*(_DWORD *)(v15 + 82) )
  {
    v17 = sub_804804C(0, &aNtzztdrxxcpbbh[90], v15);
    if ( !v14 )
    {
      v18 = _byteswap_ulong(*((_DWORD *)v17 + 8));
      v19 = 3 * _byteswap_ulong(*((_DWORD *)v17 + 9));
      v20 = v18;
      v21 = v17 + 44;
      do
        --v20;
      while ( v20 && (signed __int32)_byteswap_ulong(*(_DWORD *)&v21[4 * v20]) > *(_DWORD *)v15 );
      v22 = &v21[4 * v18];
      v23 = (unsigned __int8)v22[v20];
      v24 = &v22[v18];
      v23 *= 3;
      v16 = _byteswap_ulong(*(_DWORD *)&v24[2 * v23]);
      *(_DWORD *)(v15 + 72) = v16;
      *(_QWORD *)(v15 + 82) = (__int64)(long double)*(__int64 *)&v24[2 * v19 + (unsigned __int8)v24[2 * v23 + 5]];
    }
  }
  v25 = 43;
  if ( v16 < 0 )
  {
    v25 = 45;
    v16 = -v16;
  }
  *(_BYTE *)(v15 + 76) = v25;
  _RAX = v16;
  v27 = (int)(_RAX / (unsigned int)(HIDWORD(_RAX) + 60)) % (unsigned __int64)(unsigned int)(HIDWORD(_RAX) + 60);
  LODWORD(_RAX) = (int)(_RAX / (unsigned int)(HIDWORD(_RAX) + 60))
                / (unsigned __int64)(unsigned int)(HIDWORD(_RAX) + 60);
  __asm { aam }
  v28 = _RAX;
  LODWORD(_RAX) = v27;
  __asm { aam }
  *(_DWORD *)(v15 + 77) = _byteswap_ulong((v28 << 16) + _RAX + 808464432);
  v29 = 1969;
  v30 = 4;
  v31 = *(_DWORD *)(v15 + 72) + *(_DWORD *)v15;
  if ( v31 < 0 != __OFADD__(*(_DWORD *)(v15 + 72), *(_DWORD *)v15) )
  {
    v31 += 31536000;
    v29 = 1968;
    v30 = 3;
  }
  v65 = v30;
  _EBX = (v31 >> 31) + 60;
  *(_DWORD *)(v15 + 4) = v31 % (unsigned __int64)(unsigned int)_EBX;
  v33 = (int)(v31 / (unsigned __int64)(unsigned int)_EBX) % (unsigned __int64)(unsigned int)_EBX;
  v32 = (int)(v31 / (unsigned __int64)(unsigned int)_EBX) / (unsigned __int64)(unsigned int)_EBX;
  *(_DWORD *)(v15 + 8) = v33;
  LOBYTE(_EBX) = 24;
  v36 = v32 % (unsigned __int64)(unsigned int)_EBX;
  v35 = v32 / (unsigned __int64)(unsigned int)_EBX;
  *(_DWORD *)(v15 + 12) = v36;
  v37 = v36 - 12;
  *(_BYTE *)(v15 + 24) = (unsigned int)v36 >= 0xC;
  if ( (unsigned int)v36 <= 0xC )
  {
    do
      v37 += 12;
    while ( !v37 );
  }
  *(_DWORD *)(v15 + 20) = v37;
  v63 = v35;
  LOBYTE(_EBX) = 7;
  _EDX = (v30 + v35) % (unsigned __int64)(unsigned int)_EBX;
  *(_DWORD *)(v15 + 28) = _EDX;
  __asm { cmpxchg edx, ebx }
  *(_DWORD *)(v15 + 32) = _EDX;
  BYTE1(_EBX) = 1;
  do
  {
    LOBYTE(_EBX) = 110;
    if ( (++v29 & 3) != 0 )
      --_EBX;
    v40 = v35 < _EBX;
    v35 -= _EBX;
  }
  while ( !v40 );
  LODWORD(v41) = _EBX + v35;
  *(_DWORD *)(v15 + 16) = v29;
  BYTE1(v29) = 20;
  v7 = (unsigned __int8)v29 < 0xD0u;
  v43 = v29 + 48;
  if ( v7 )
  {
    v42 = 19;
    v43 += 100;
  }
  *(_BYTE *)(v15 + 68) = v43;
  *(_BYTE *)(v15 + 64) = v42;
  v44 = v41;
  v45 = _EBX - 1069826689;
  v46 = 0;
  v41 = (int)v41;
  do
  {
    BYTE4(v41) = 7;
    HIDWORD(v41) = __PAIR64__(HIDWORD(v41), v45) >> 30;
    v45 = __ROR4__(v45, 2);
    ++v46;
    v40 = (int)v41 < SHIDWORD(v41);
    LODWORD(v41) = v41 - HIDWORD(v41);
  }
  while ( !v40 );
  v47 = (_DWORD *)(v15 + 36);
  *v47++ = HIDWORD(v41) + v41 + 1;
  *v47++ = v46;
  _EBX = v65;
  LOBYTE(_EBX) = 7;
  _ECX = (v65 + v63 - v44) % (unsigned __int64)(unsigned int)_EBX;
  __asm { cmpxchg ecx, ebx }
  *v47 = (v44 + _ECX) / (unsigned __int64)(unsigned int)_EBX;
  v51 = v47 + 1;
  v52 = _ECX - 1;
  if ( !v52 )
    v52 = 7;
  v57 = (int)(v44 + v52) / (unsigned __int64)(unsigned int)_EBX;
  v55 = (int)(v44 + v52) % (unsigned __int64)(unsigned int)_EBX;
  *v51 = v57;
  v53 = v51 + 1;
  v54 = *(v53 - 9);
  LOBYTE(v55) = v54 & 3;
  v7 = v52 < 4;
  v56 = v52 - 4;
  LOBYTE(v57) = v7 + v57;
  if ( !(_BYTE)v57 )
  {
    --v54;
    LOBYTE(v57) = 52;
    if ( v56 )
    {
      if ( v56 != 1 )
        goto LABEL_51;
      if ( --v55 )
        goto LABEL_51;
    }
    ++v57;
  }
  if ( (_BYTE)v57 == 53 && (char)(v44 - (((_BYTE)v55 == 0) + 104)) > *((char *)v53 - 24) )
  {
    LOBYTE(v57) = 1;
    ++v54;
  }
LABEL_51:
  *v53 = v57;
  v58 = v53 + 1;
  *v58++ = v54;
  *v58 = v44 + 1;
  v66 = (unsigned __int8 *)(v58 + 14);
  sub_80482C2(aNtzztdrxxcpbbh, v66, (unsigned __int8 *)v58[8]);
  *v66 = 10;
  v59 = 0;
  v60 = -sys_write(1, v66, 1u);
  if ( v60 >= 0 )
    v59 = v60;
  v61 = sys_exit(v59);
}
// 80480EB: positive sp value 10 has been found
// 8048099: variable 'v62' is possibly undefined
// 80480ED: variable 'v64' is possibly undefined
// 8048113: variable 'v14' is possibly undefined
// 8048118: variable 'v9' is possibly undefined
// 804816F: variable 'v16' is possibly undefined

//----- (080482B9) --------------------------------------------------------
unsigned __int8 __usercall sub_80482B9@<al>(_BYTE *a1@<ebp>, unsigned __int8 *a2@<edi>, int a3@<esi>)
{
  return sub_80482C2(a1, a2, &a1[a3]);
}

//----- (080482C2) --------------------------------------------------------
unsigned __int8 __usercall sub_80482C2@<al>(_BYTE *a1@<ebp>, unsigned __int8 *a2@<edi>, unsigned __int8 *a3@<esi>)
{
  unsigned __int8 result; // al
  bool v4; // zf
  _BYTE *v5; // edi
  int v6; // ecx
  unsigned __int8 *v7; // [esp+0h] [ebp-4h]

  while ( 1 )
  {
    result = *a3++;
    if ( !result )
      return result;
    if ( result == 37 && (v4 = *a3 == 0, *a3) )
    {
      result = *a3++;
      v7 = a2;
      v5 = a1;
      v6 = 37;
      do
      {
        if ( !v6 )
          break;
        v4 = *v5++ == result;
        --v6;
      }
      while ( !v4 );
      a2 = v7;
      if ( !v4 )
      {
        *v7 = 37;
        a2 = v7 + 1;
        goto LABEL_11;
      }
      LOBYTE(v6) = a1[v6 - 116];
      (*(void (**)(void))&a1[v6 + 105])();
    }
    else
    {
LABEL_11:
      *a2++ = result;
    }
  }
}

//----- (0804832A) --------------------------------------------------------
char __usercall sub_804832A@<al>(int a1@<eax>, int a2@<edx>, int a3@<ebx>, _BYTE *a4@<edi>)
{
  char *v4; // esi
  char result; // al

  v4 = (char *)(*(_DWORD *)(*(_DWORD *)(a3 + 96) + a2 + 4 * a1) + *(_DWORD *)(a3 + 96));
  do
  {
    result = *v4++;
    *a4++ = result;
  }
  while ( result );
  return result;
}

//----- (0804833A) --------------------------------------------------------
char __usercall sub_804833A@<al>(int a1@<ebx>, _BYTE *a2@<edi>, int a3@<esi>)
{
  char *v3; // esi
  char result; // al

  v3 = (char *)(a1 + a3);
  do
  {
    result = *v3++;
    *a2++ = result;
  }
  while ( result );
  return result;
}

//----- (08048344) --------------------------------------------------------
int __usercall sub_8048344@<eax>(int a1@<edx>, _BYTE *a2@<edi>)
{
  int result; // eax

  result = a1;
  *a2 = a1;
  return result;
}

// nfuncs=7 queued=7 decompiled=7 lumina nreq=0 worse=0 better=0
// ALL OK, 7 function(s) have been successfully decompiled
