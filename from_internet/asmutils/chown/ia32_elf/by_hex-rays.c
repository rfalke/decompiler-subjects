/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void sub_804804C();
void __noreturn start(); // weak
// int __usercall sub_8048115@<eax>(_BYTE *@<esi>);
// char __usercall sub_8048129@<al>(char *@<esi>);

//-------------------------------------------------------------------------
// Data declarations

uid_t owner; // idb
gid_t group; // idb
const char *path; // idb
int dword_804853D; // weak


//----- (0804804C) --------------------------------------------------------
void sub_804804C()
{
  group = -1;
}

//----- (08048057) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn start()
{
  int v0; // ebp
  int v1; // edx
  char *v2; // esi
  int v3; // edx
  int v4; // edx
  int v5; // ecx
  char v6; // al
  int v7; // eax
  int v8; // [esp-10h] [ebp-10h]
  char *v9; // [esp-8h] [ebp-8h]
  const char *v10; // [esp-4h] [ebp-4h]

  owner = -1;
  v0 = 0;
  if ( v8 != 1 )
  {
    sub_8048129(v9);
    if ( *v9 > 47 && *v9 < 58 )
    {
      v2 = v9;
      v3 = v1 - 1;
      v0 = 1;
      if ( v9[v3] != 46 )
      {
        v4 = v3 + 1;
        v0 = 0;
        v5 = 0;
        do
        {
          v6 = *v2++;
          if ( ++v5 > v4 )
            goto LABEL_9;
        }
        while ( v6 != 46 );
        dword_804853D = 1;
LABEL_9:
        group = (gid_t)v2;
        v9[v5 - 1] = 0;
        owner = (uid_t)v9;
        group = sub_8048115((_BYTE *)group);
        owner = sub_8048115((_BYTE *)owner);
        if ( dword_804853D != 1 )
          sub_804804C();
        while ( v10 )
        {
          path = v10;
          __asm { int     80h; LINUX - sys_chown }
        }
      }
    }
  }
  v7 = sys_exit(v0);
}
// 80480EA: positive sp value 10 has been found
// 8048066: variable 'v8' is possibly undefined
// 804806D: variable 'v9' is possibly undefined
// 8048084: variable 'v1' is possibly undefined
// 80480EC: variable 'v10' is possibly undefined
// 8048057: using guessed type void __noreturn start();
// 804853D: using guessed type int dword_804853D;

//----- (08048115) --------------------------------------------------------
int __usercall sub_8048115@<eax>(_BYTE *a1@<esi>)
{
  int v1; // eax
  int i; // ebx

  v1 = 0;
  for ( i = 0; ; i = v1 + 10 * i )
  {
    LOBYTE(v1) = *a1++;
    if ( !(_BYTE)v1 )
      break;
    LOBYTE(v1) = v1 - 48;
  }
  return i;
}

//----- (08048129) --------------------------------------------------------
char __usercall sub_8048129@<al>(char *a1@<esi>)
{
  int v1; // edx
  char result; // al

  v1 = -1;
  do
  {
    ++v1;
    result = *a1++;
  }
  while ( result );
  return result;
}

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
