/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start(); // weak
int sub_804813D();
// void __usercall sub_8048157(unsigned __int8 *a1@<esi>);

//-------------------------------------------------------------------------
// Data declarations

int dword_804816C; // weak
int dword_8048170[3]; // weak
int dword_804817C[256]; // weak


//----- (0804804C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn start()
{
  int v0; // ebp
  int v1; // edi
  unsigned __int8 *v2; // esi
  char v3; // dh
  char v4; // dl
  int *v5; // ebx
  char v6; // dl
  int v7; // ecx
  char v8; // dh
  char v9; // dl
  signed int v10; // eax
  int v11; // eax
  int v12; // eax
  unsigned __int8 *v13; // [esp-10h] [ebp-10h]
  unsigned __int8 *v14; // [esp-Ch] [ebp-Ch]
  unsigned __int8 *v15; // [esp-8h] [ebp-8h]
  unsigned __int8 *v16; // [esp-4h] [ebp-4h]

  v0 = 0;
  v1 = 1;
  v2 = v13;
  if ( v13 )
  {
    dword_804816C = 2;
    if ( *(_WORD *)v13 != 27693 )
      goto LABEL_4;
    sub_804813D();
    sub_8048157(v14);
    BYTE2(dword_804816C) = v3;
    HIBYTE(dword_804816C) = v4;
    __asm
    {
      int     80h; LINUX - sys_bind
      int     80h; LINUX - sys_listen
      int     80h; LINUX - sys_accept
    }
    v0 = 102;
    v2 = v15;
    if ( v15 )
    {
LABEL_4:
      v1 = sub_804813D();
      v5 = dword_8048170;
      do
      {
        sub_8048157(v2);
        *(_BYTE *)v5 = v6;
        v5 = (int *)((char *)v5 + 1);
      }
      while ( v7 != 1 );
      sub_8048157(v16);
      *((_BYTE *)v5 - 6) = v8;
      *((_BYTE *)v5 - 5) = v9;
      __asm { int     80h; LINUX - sys_connect }
    }
  }
  while ( 1 )
  {
    v10 = sys_read(v0, dword_804817C, 0x400u);
    if ( v10 <= 0 )
      break;
    v11 = sys_write(v1, dword_804817C, v10);
  }
  v12 = sys_exit(v0);
}
// 80480EF: positive sp value 18 has been found
// 8048053: variable 'v13' is possibly undefined
// 8048078: variable 'v14' is possibly undefined
// 804807D: variable 'v3' is possibly undefined
// 8048080: variable 'v4' is possibly undefined
// 80480CF: variable 'v15' is possibly undefined
// 80480E9: variable 'v6' is possibly undefined
// 80480EC: variable 'v7' is possibly undefined
// 80480EF: variable 'v16' is possibly undefined
// 80480F4: variable 'v8' is possibly undefined
// 80480F7: variable 'v9' is possibly undefined
// 804804C: using guessed type void __noreturn start();
// 804816C: using guessed type int dword_804816C;
// 8048170: using guessed type int dword_8048170[3];
// 804817C: using guessed type int dword_804817C[256];

//----- (0804813D) --------------------------------------------------------
int sub_804813D()
{
  int result; // eax

  result = 102;
  __asm { int     80h; LINUX - sys_socket }
  return result;
}

//----- (08048157) --------------------------------------------------------
void __usercall sub_8048157(unsigned __int8 *a1@<esi>)
{
  int v1; // eax
  int i; // edx
  unsigned __int8 v3; // al
  bool v4; // cf

  v1 = 0;
  for ( i = 0; ; i = v1 + 10 * i )
  {
    v3 = *a1++;
    v4 = v3 < 0x30u;
    LOBYTE(v1) = v3 - 48;
    if ( v4 )
      break;
  }
}

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
