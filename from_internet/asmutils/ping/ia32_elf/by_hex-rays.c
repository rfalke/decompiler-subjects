/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(int@<eax>);
// char __usercall sub_804811E@<al>(int@<edi>, int@<esi>);

//-------------------------------------------------------------------------
// Data declarations

struct timeval timeout; // idb
fd_set readfds; // idb
__int16 word_804815A; // weak


//----- (0804805F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn start(int a1@<eax>)
{
  int v1; // eax
  int v2; // [esp-Ch] [ebp-Ch]
  int v3; // [esp-4h] [ebp-4h]

  if ( v2 != 1 )
  {
    sub_804811E(134512970, v3);
    *(__fd_mask *)((char *)readfds.__fds_bits + 2) = 2;
    __asm
    {
      int     80h; LINUX - sys_socket
      int     80h; LINUX - sys_sendto
    }
    LOBYTE(timeout.tv_sec) = 5;
    do
    {
      readfds.__fds_bits[0] |= 0x40u;
      __asm
      {
        int     80h; LINUX - sys_select
        int     80h; LINUX - sys_recvfrom
      }
    }
    while ( *((_BYTE *)&word_804815A + 20) );
    a1 = 146;
    __asm { int     80h; LINUX - sys_writev }
  }
  v1 = sys_exit(a1);
}
// 8048069: positive sp value C has been found
// 8048061: variable 'v2' is possibly undefined
// 8048075: variable 'v3' is possibly undefined
// 804815A: using guessed type __int16 word_804815A;

//----- (0804811E) --------------------------------------------------------
char __usercall sub_804811E@<al>(int a1@<edi>, int a2@<esi>)
{
  int v2; // edx
  int i; // ecx
  char j; // bl
  unsigned __int8 v5; // al
  bool v6; // cf
  char result; // al

  v2 = 0;
  for ( i = 0; i != 4; ++i )
  {
    for ( j = 0; ; j = result + 10 * j )
    {
      v5 = *(_BYTE *)(a2 + v2++);
      v6 = v5 < 0x30u;
      result = v5 - 48;
      if ( v6 )
        break;
    }
    *(_BYTE *)(a1 + i + 4) = j;
  }
  return result;
}

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
