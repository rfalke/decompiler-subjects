// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Stack int32 dwArg00)
void fn0804804C(int32 dwArg00)
{
	struct Eq_3 * fp;
	struct Eq_4 * esp_10 = (char *) fp + 4;
	if (dwArg00 >= 0x03)
	{
		Eq_18 v13_17 = fp->a0008[dwArg00 - 0x02].t0000.u0;
		fp->a0008[dwArg00 - 0x02].t0000.u0 = 0x00;
		esp_10 = (struct Eq_4 *) &fp->a0008->t0000.u0;
		while (true)
		{
			Eq_18 esi_22 = esp_10->a0000[0].t0000.u0;
			++esp_10;
			if (esi_22 == 0x00)
				break;
			fn08048071(esi_22, v13_17);
		}
	}
	esp_10->dwFFFFFFFC = 0x01;
	sys_exit(0x00);
}

// 08048071: void fn08048071(Register Eq_18 esi, Register Eq_18 edi)
// Called from:
//      fn0804804C
void fn08048071(Eq_18 esi, Eq_18 edi)
{
	if (!fn080480E7(edi))
	{
		int32 edx_35 = fn0804810E(esi);
		byte * edi_189 = esi.u0 + (edx_35 - 0x01);
		int32 ecx_43 = edx_35;
		bool v24_124 = *edi_189 != 0x2F;
		if (*edi_189 == 0x2F)
			*edi_189 = 0x00;
		while (ecx_43 != 0x00)
		{
			v24_124 = *edi_189 != 0x2F;
			--edi_189;
			--ecx_43;
			if (*edi_189 != 0x2F)
				break;
		}
		if (!v24_124)
			++edi_189;
		fn080480B8(edi_189 + 1, edi, 0x08048184);
		edi.u0 = 0x08048184;
	}
	sys_rename(esi, edi);
}

// 080480B8: void fn080480B8(Register Eq_18 edx, Register Eq_18 esi, Register Eq_18 edi)
// Called from:
//      fn08048071
void fn080480B8(Eq_18 edx, Eq_18 esi, Eq_18 edi)
{
	fn0804811F(esi, edi);
	fn080480CC(edi);
	fn0804812C(edx, edi);
}

// 080480CC: void fn080480CC(Register Eq_18 edi)
// Called from:
//      fn080480B8
void fn080480CC(Eq_18 edi)
{
	int32 edx_12 = fn0804810E(edi);
	if (edi.u0[edx_12 - 0x01] != 0x2F)
		((word32) edi + edx_12)->u0 = 0x2F;
}

// 080480E7: FlagGroup bool fn080480E7(Register Eq_18 edi)
// Called from:
//      fn08048071
bool fn080480E7(Eq_18 edi)
{
	int32 eax_34 = sys_stat(edi, &g_t8048144);
	bool Z_86 = SLICE(cond(eax_34), bool, 2);
	if (eax_34 >= 0x00)
		Z_86 = SLICE(cond(((word32) g_w804814C & 0x4000) - 0x4000), bool, 2);
	return Z_86;
}

// 0804810E: Register word32 fn0804810E(Register Eq_18 esi)
// Called from:
//      fn08048071
//      fn080480CC
//      fn0804811F
//      fn0804812C
word32 fn0804810E(Eq_18 esi)
{
	word32 edx_14 = ~0x00;
	do
	{
		++edx_14;
		esi.u0 = (word32) esi_39 + 1;
		esi_39 = esi;
	} while (*esi_39.u0 != 0x00);
	return edx_14;
}

// 0804811F: void fn0804811F(Register Eq_18 esi, Register Eq_18 edi)
// Called from:
//      fn080480B8
void fn0804811F(Eq_18 esi, Eq_18 edi)
{
	memcpy(edi, esi, fn0804810E(esi) + 0x01);
}

// 0804812C: void fn0804812C(Register Eq_18 esi, Register Eq_18 edi)
// Called from:
//      fn080480B8
void fn0804812C(Eq_18 esi, Eq_18 edi)
{
	memcpy(edi.u0 + fn0804810E(edi), esi, fn0804810E(esi) + 0x01);
}

Eq_137 g_t8048144 = // 08048144
	{
	};
word16 g_w804814C = 0x00; // 0804814C
