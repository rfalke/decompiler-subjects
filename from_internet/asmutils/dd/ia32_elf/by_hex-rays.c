/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __fastcall start(int, int);
// int __usercall sub_8048116@<eax>(int@<ebp>, char *@<esi>);
// char __usercall sub_8048149@<al>(char *@<esi>);
void __fastcall sub_80482A7(int a1);
int sub_80482C8();
// unsigned int __usercall sub_8048318@<eax>(unsigned int@<eax>, _BYTE *@<edi>);
// int __usercall sub_804832F@<eax>(_BYTE *@<esi>);

//-------------------------------------------------------------------------
// Data declarations

int dword_804804C[11] =
{
  1734439797,
  1679833701,
  1935745124,
  1970239776,
  1869507360,
  2019893367,
  1953523043,
  1935829280,
  1651449917,
  1663057267,
  1031171695
}; // weak
int dword_8048367; // weak
size_t len; // idb
char byte_804836C; // weak
int dword_8048377; // weak
int dword_804837B; // weak
char byte_804837F; // weak
char byte_8048380; // weak
char byte_8048381; // weak
char byte_8048382; // weak
char byte_804838B; // weak


//----- (08048082) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __fastcall start(int a1, int a2)
{
  int result; // eax
  int v3; // eax
  int v4; // eax
  _DWORD *v5; // edx
  int v6; // eax
  int v7; // edi
  int v8; // esi
  char *v9; // ecx
  size_t v10; // edx
  int v11; // eax
  unsigned int v12; // edx
  char *v13; // ecx
  bool v14; // cc
  int v15; // ecx
  int v16; // eax
  int v17; // ecx
  int v18; // eax
  int v19; // eax
  int v20; // eax
  int v21; // eax
  int v22; // [esp-Ch] [ebp-Ch]
  int v23; // [esp-8h] [ebp-8h]
  int v24; // [esp-4h] [ebp-4h]

  result = v23;
  if ( v22 == 1 )
  {
    v3 = sys_write(1, dword_804804C, 0x2Du);
    v4 = sys_exit(0);
  }
  byte_804836C = 2;
  if ( !v24 )
  {
    v6 = sys_brk((void *)(len + 134513547));
    __asm
    {
      int     80h; LINUX - sys_llseek
      int     80h; LINUX - sys_llseek
    }
    v7 = 0;
    v8 = dword_8048367;
    while ( 1 )
    {
      v9 = &byte_804838B;
      v10 = len;
      do
      {
        v11 = sys_read(0, v9, v10);
        if ( !v11 )
          goto LABEL_27;
        if ( v11 < 0 )
          goto LABEL_32;
        v9 = &v13[v11];
        v14 = v12 <= v11;
        v10 = v12 - v11;
      }
      while ( !v14 );
      ++dword_8048377;
      sub_80482A7((int)v9);
      v16 = sys_write(1, &byte_804838B, v15 - (_DWORD)&byte_804838B);
      if ( v16 != v12 )
LABEL_32:
        JUMPOUT(0x8048153);
      ++dword_804837B;
      if ( !--v8 )
      {
LABEL_27:
        if ( v12 != len )
        {
          ++byte_804837F;
          ++byte_8048380;
          if ( byte_8048381 == 1 )
          {
            memset(v13, 0, v12);
            v7 = (int)&v13[v12];
            v13 += v12;
            --byte_8048380;
            LOBYTE(dword_804837B) = dword_804837B + 1;
          }
          sub_80482A7((int)v13);
          v18 = sys_write(1, &byte_804838B, v17 - (_DWORD)&byte_804838B);
        }
        v19 = sys_close(v7);
        v20 = sys_close(1);
        sub_80482C8();
        v21 = sys_exit(0);
      }
    }
  }
  if ( *(_WORD *)v24 == 26223 )
    return sub_8048116(1, (char *)v24);
  if ( *(_WORD *)v24 == 26217 )
    return sub_8048116(a2, (char *)v24);
  if ( *(_DWORD *)v24 == 1853189987
    || *(_WORD *)v24 == 29538
    || *(_DWORD *)v24 == 1885956979
    || *(_DWORD *)v24 == 1801807219 )
  {
    sub_8048149((char *)v24);
    result = sub_804832F((_BYTE *)v24);
    *v5 = result;
  }
  else if ( *(_DWORD *)v24 == 1986948963 )
  {
    if ( *(_DWORD *)(v24 + 5) == 1668184435 )
    {
      byte_8048381 = 1;
    }
    else if ( *(_DWORD *)(v24 + 5) == 1650554739 )
    {
      byte_8048382 = 1;
    }
  }
  return result;
}
// 80480AA: positive sp value C has been found
// 80481CF: control flows out of bounds to 8048153
// 8048089: variable 'v23' is possibly undefined
// 804808A: variable 'v22' is possibly undefined
// 80480AC: variable 'v24' is possibly undefined
// 8048132: variable 'v5' is possibly undefined
// 8048211: variable 'v13' is possibly undefined
// 8048213: variable 'v12' is possibly undefined
// 804822B: variable 'v15' is possibly undefined
// 8048284: variable 'v17' is possibly undefined
// 804804C: using guessed type int dword_804804C[11];
// 8048367: using guessed type int dword_8048367;
// 804836C: using guessed type char byte_804836C;
// 8048377: using guessed type int dword_8048377;
// 804837B: using guessed type int dword_804837B;
// 804837F: using guessed type char byte_804837F;
// 8048380: using guessed type char byte_8048380;
// 8048381: using guessed type char byte_8048381;
// 8048382: using guessed type char byte_8048382;
// 804838B: using guessed type char byte_804838B;

//----- (08048116) --------------------------------------------------------
int __usercall sub_8048116@<eax>(int a1@<ebp>, char *a2@<esi>)
{
  mode_t v2; // edx
  int v3; // ecx

  sub_8048149(a2);
  if ( sys_open(a2, v3, v2) < 0 )
    JUMPOUT(0x8048153);
  return a1;
}
// 8048124: control flows out of bounds to 8048153
// 8048120: variable 'v3' is possibly undefined
// 8048120: variable 'v2' is possibly undefined

//----- (08048149) --------------------------------------------------------
char __usercall sub_8048149@<al>(char *a1@<esi>)
{
  char result; // al
  int v2; // eax

  do
  {
    result = *a1++;
    if ( !result )
      v2 = sys_exit(1);
  }
  while ( result != 61 );
  return result;
}

//----- (080482A7) --------------------------------------------------------
void __fastcall sub_80482A7(int a1)
{
  char *v1; // esi
  char *v2; // edi
  int i; // ecx
  __int16 v4; // ax
  char v5; // t0

  if ( (byte_8048382 & 1) != 0 )
  {
    v1 = &byte_804838B;
    v2 = &byte_804838B;
    for ( i = a1 - (_DWORD)&byte_804838B; i; --i )
    {
      v4 = *(_WORD *)v1;
      v1 += 2;
      v5 = v4;
      LOBYTE(v4) = HIBYTE(v4);
      HIBYTE(v4) = v5;
      *(_WORD *)v2 = v4;
      v2 += 2;
    }
  }
}
// 8048382: using guessed type char byte_8048382;
// 804838B: using guessed type char byte_804838B;

//----- (080482C8) --------------------------------------------------------
int sub_80482C8()
{
  unsigned __int16 v0; // ax
  unsigned __int16 v1; // ax

  sub_8048318(dword_8048377, &byte_804838B);
  LOBYTE(v0) = 0;
  HIBYTE(v0) = byte_804837F;
  *(_DWORD *)&byte_804838B = v0 + 2109483;
  *((_DWORD *)&byte_804838B + 1) = 170684009;
  sub_8048318(dword_804837B, &byte_804838B + 8);
  LOBYTE(v1) = 0;
  HIBYTE(v1) = byte_8048380;
  *((_DWORD *)&byte_804838B + 2) = v1 + 2109483;
  *((_DWORD *)&byte_804838B + 3) = 175404399;
  return sys_write(2, &byte_804838B, 0x10u);
}
// 8048377: using guessed type int dword_8048377;
// 804837B: using guessed type int dword_804837B;
// 804837F: using guessed type char byte_804837F;
// 8048380: using guessed type char byte_8048380;
// 804838B: using guessed type char byte_804838B;

//----- (08048318) --------------------------------------------------------
unsigned int __usercall sub_8048318@<eax>(unsigned int a1@<eax>, _BYTE *a2@<edi>)
{
  int v2; // ecx
  unsigned int v3; // et2
  unsigned int v4; // edx
  unsigned int result; // eax

  v2 = 0;
  do
  {
    v3 = a1 % 0xA;
    a1 /= 0xAu;
    v4 = v3;
    LOBYTE(v4) = v3 + 48;
    ++v2;
  }
  while ( a1 );
  do
  {
    result = v4;
    *a2++ = v4;
    --v2;
  }
  while ( v2 );
  return result;
}

//----- (0804832F) --------------------------------------------------------
int __usercall sub_804832F@<eax>(_BYTE *a1@<esi>)
{
  int v1; // eax
  int i; // ebx

  v1 = 0;
  for ( i = 0; ; i = v1 + 10 * i )
  {
    LOBYTE(v1) = *a1++;
    if ( !(_BYTE)v1 )
      break;
    if ( (unsigned __int8)v1 > 0x39u )
    {
      if ( (_BYTE)v1 != 119 )
      {
        if ( (_BYTE)v1 != 98 )
        {
          if ( (_BYTE)v1 != 107 )
          {
            if ( (_BYTE)v1 != 109 )
              JUMPOUT(0x804816A);
            i <<= 10;
          }
          i *= 2;
        }
        i <<= 8;
      }
      i *= 2;
      return i;
    }
    LOBYTE(v1) = v1 - 48;
  }
  return i;
}
// 8048355: control flows out of bounds to 804816A

// nfuncs=7 queued=7 decompiled=7 lumina nreq=0 worse=0 better=0
// ALL OK, 7 function(s) have been successfully decompiled
