// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register int32 ebx, Stack word32 dwArg00, Stack (ptr32 char) dwArg08)
void fn0804804C(int32 ebx, word32 dwArg00, char * dwArg08)
{
	ptr32 fp;
	struct Eq_6 * esp_59 = fp + 4;
	if (dwArg00 == 0x02)
	{
		ptr32 edx_20 = fn080480B1(fn080480A5(dwArg08), dwArg08);
		word32 edi_28 = dwArg08 + edx_20;
		byte * edi_30 = edi_28 - 0x01;
		bool v19_106 = edi_28 != 0x01;
		ptr32 ecx_32 = edx_20;
		while (ecx_32 != 0x00)
		{
			v19_106 = *edi_121 != 0x2F;
			edi_30 = edi_121 + 1;
			--ecx_32;
			edi_121 = edi_30;
			if (*edi_121 != 0x2F)
				break;
		}
		if (!v19_106)
		{
			if (ecx_32 == 0x00)
				++ecx_32;
			ptr32 edx_79 = fn080480B1(ecx_32, dwArg08);
			dwArg08[edx_79] = 0x0A;
			sys_write(0x01, dwArg08, edx_79 + 0x01);
			sys_exit(0x01);
		}
		sys_write(0x01, ".\n\x89\xFAJB\x80:", 0x02);
		ebx = 0x01;
		esp_59 = fp + 0x0C;
	}
	esp_59->dwFFFFFFFC = 0x01;
	sys_exit(ebx);
}

char g_str80480A3[] = ".\n\x89\xFAJB\x80:"; // 080480A3
// 080480A5: Register ptr32 fn080480A5(Register (ptr32 char) edi)
// Called from:
//      fn0804804C
ptr32 fn080480A5(char * edi)
{
	byte * edx_6 = edi - 0x01;
	do
		++edx_6;
	while (*edx_6 != 0x00);
	return edx_6 - edi;
}

// 080480B1: Register ptr32 fn080480B1(Register ptr32 edx, Register (ptr32 char) edi)
// Called from:
//      fn0804804C
ptr32 fn080480B1(ptr32 edx, char * edi)
{
	char * edi_15 = edi + edx - 0x01;
	while (edi_54 != edi)
	{
		edi_15 = edi_54 - 1;
		edi_54 = edi_15;
		if (*edi_54 != 0x2F)
			return edi_54 - edi + 0x01;
	}
	return edi_54 - edi + 0x01;
}

