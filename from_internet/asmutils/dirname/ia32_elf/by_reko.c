// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register word32 edx, Register (ptr32 byte) edi, Stack word32 dwArg00)
void fn0804804C(word32 edx, byte * edi, word32 dwArg00)
{
	if (dwArg00 == 0x02)
	{
		byte * edi_14;
		ptr32 edx_20 = fn080480B1(fn080480A5(out edi_14), edi_14);
		word32 edi_28 = edi_14 + edx_20;
		byte * edi_30 = edi_28 - 0x01;
		bool v19_122 = edi_28 != 0x01;
		ptr32 ecx_32 = edx_20;
		while (ecx_32 != 0x00)
		{
			v19_122 = *edi_150 != 0x2F;
			edi_30 = edi_150 + 1;
			--ecx_32;
			edi_150 = edi_30;
			if (*edi_150 != 0x2F)
				break;
		}
		edi = edi_14;
		if (!v19_122)
		{
			if (ecx_32 == 0x00)
				++ecx_32;
			edi_14[fn080480B1(ecx_32, edi_14)] = 0x0A;
			__syscall(0x80);
			__syscall(0x80);
		}
		__syscall(0x80);
		edx = 0x02;
	}
	__syscall(0x80);
	word32 edi_149;
	fn080480AA((byte *) 0x01, edx, edi, out edi_149);
}

// 080480A5: Register word32 fn080480A5(Register out ptr32 ediOut)
// Called from:
//      fn0804804C
word32 fn080480A5(ptr32 & ediOut)
{
	ptr32 edi_7;
	word32 edx_8 = fn080480A8(out edi_7);
	ediOut = edi_7;
	return edx_8;
}

// 080480A8: Register word32 fn080480A8(Register out ptr32 ediOut)
// Called from:
//      fn080480A5
//      fn080480AA
word32 fn080480A8(ptr32 & ediOut)
{
	ptr32 edi_9;
	word32 edx_8 = fn080480AA(eax, edx + 0x01, edi, out edi_9);
	ediOut = edi_9;
	return edx_8;
}

// 080480AA: Register word32 fn080480AA(Register (ptr32 byte) eax, Register word32 edx, Register (ptr32 byte) edi, Register out (ptr32 byte) ediOut)
// Called from:
//      fn0804804C
//      fn080480A8
word32 fn080480AA(byte * eax, word32 edx, byte * edi, byte & ediOut)
{
	byte al = (byte) eax;
	if (al != *eax)
	{
		byte * edi_22;
		word32 edx_21 = fn080480A8(out edi_22);
		ediOut = edi_22;
		return edx_21;
	}
	else
	{
		ediOut = edi;
		return edx - edi;
	}
}

// 080480B1: Register ptr32 fn080480B1(Register ptr32 edx, Register (ptr32 byte) edi)
// Called from:
//      fn0804804C
ptr32 fn080480B1(ptr32 edx, byte * edi)
{
	byte * edi_14 = edi + edx - 0x01;
	while (edi_51 != edi)
	{
		edi_14 = edi_51 - 1;
		edi_51 = edi_14;
		if (*edi_51 != 0x2F)
			return edi_51 - edi + 0x01;
	}
	return edi_51 - edi + 0x01;
}

