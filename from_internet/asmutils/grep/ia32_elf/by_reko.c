// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 08048057: void fn08048057(Register Eq_2 al, Register Eq_2 edx, Stack word32 dwArg00)
void fn08048057(Eq_2 al, Eq_2 edx, word32 dwArg00)
{
	ptr32 fp;
	g_t804826F.u1 = 0x01;
	Eq_9 ebp_4 = 0x00;
	struct Eq_11 * esp_36 = fp + 4;
	word32 ebx_162 = dwArg00 - 0x01;
	if (dwArg00 == 0x01)
	{
l0804804C:
		Eq_6 ebx_43 = g_t804826F.u0;
		esp_36->dwFFFFFFFC = 0x01;
		sys_exit(ebx_43);
	}
	struct Eq_11 * esp_122 = fp + 8;
l08048065:
	char * edi_16 = esp_122->dw0000;
	++esp_122;
	if (*edi_16 == 0x712D)
	{
		al |= 0x01;
		goto l0804806F;
	}
	if (*edi_16 == 0x632D)
	{
		al |= 0x04;
		goto l0804806F;
	}
	if (*edi_16 == 0x622D)
	{
		al |= 0x80;
		goto l0804806F;
	}
	if (*edi_16 == 30253)
	{
		al |= 0x02;
l0804806F:
		--ebx_162;
		goto l08048065;
	}
	g_t8048274.u0 = (byte) al;
	Eq_67 ebx_29 = ebx_162 - 0x01;
	if (ebx_29 != 0x00)
	{
		g_t804825B.u1 = (word32) ebx_29;
l080480A1:
		do
		{
			char * ebx_35 = esp_122->dw0000;
			esp_36 = esp_122 + 1;
			if (ebx_35 == null)
				goto l0804804C;
			g_dw8048263 = 0x00;
			g_dw8048267 = 0x00;
			g_ptr804825F = ebx_35;
			esp_36->dwFFFFFFFC = 0x05;
			Eq_9 eax_60 = sys_open(ebx_35, 0x00, edx);
			esp_122 = esp_36;
			ebp_4 = eax_60;
		} while (eax_60 < 0x00);
	}
	while (true)
	{
		fn080481D7(ebp_4, &g_b8048285);
		if (g_b8048273 != 0x00)
			break;
		word32 eax_76 = fn0804821C(0x08048285, edi_16);
		edx.u1 = g_t8048274.u1;
		byte dl_86 = (byte) edx;
		if (((int8) ((dl_86 & 0x02) == 0x00) ^ (int8) (eax_76 == 0x00)) != 0x00)
		{
			g_t804826F.u1 = 0x00;
			if ((dl_86 & 0x01) == 0x00)
			{
				++g_dw8048263;
				if ((dl_86 & 0x04) == 0x00)
				{
					fn0804813B();
					fn08048168();
					Eq_2 eax_115 = fn0804824A(&g_b8048285);
					uint32 * esp_123 = esp_122 - 4;
					*esp_123 = 0x01;
					uint32 ebx_125 = *esp_123;
					*esp_123 = 0x04;
					sys_write(ebx_125, &g_b8048285, eax_115);
					edx = eax_115;
					esp_122 = (struct Eq_11 *) (esp_123 + 1);
				}
			}
		}
	}
	if ((g_t8048274.u0 & 0x04) != 0x00)
	{
		fn0804813B();
		fn08048190();
	}
	goto l080480A1;
}

// 0804813B: void fn0804813B()
// Called from:
//      fn08048057
void fn0804813B()
{
	if (g_t804825B.u0 > 0x01)
	{
		char * esi_31 = g_ptr804825F;
		Eq_2 eax_32 = fn0804824A(esi_31);
		Mem37[esi_31 + eax_32:byte] = 0x3A;
		(esi_31 - 1)[sys_write(0x01, esi_31, (word32) eax_32 + 1)] = 0x00;
	}
}

// 08048168: void fn08048168()
// Called from:
//      fn08048057
void fn08048168()
{
	if ((g_t8048274.u0 & 0x80) != 0x00)
	{
		byte * edi_36;
		char * esi_38 = fn080481AF(g_dw804826B, out edi_36);
		*edi_36 = 0x3A;
		sys_write(0x01, esi_38, edi_36 - esi_38 + 0x01);
	}
}

// 08048190: void fn08048190()
// Called from:
//      fn08048057
void fn08048190()
{
	byte * edi_31;
	char * esi_33 = fn080481AF(g_dw8048263, out edi_31);
	*edi_31 = 0x0A;
	sys_write(0x01, esi_33, edi_31 - esi_33 + 0x01);
}

// 080481AF: Register word32 fn080481AF(Register word32 eax, Register out (ptr32 ci8) ediOut)
// Called from:
//      fn08048168
//      fn08048190
word32 fn080481AF(word32 eax, ci8 & ediOut)
{
	uint64 edx_eax_12 = (uint64) eax;
	uint32 edx_14 = (uint32) (edx_eax_12 % 0x0A);
	ci8 dl_20 = (byte) edx_14;
	if ((uint32) (edx_eax_12 /u 0x0A) == 0x00)
	{
		ediOut = fn080481C8(dl_20, &g_b8048275);
		return <invalid>;
	}
	else
	{
		ediOut = fn080481C1((byte) edx_14, &g_b8048275);
		return <invalid>;
	}
}

// 080481B9: void fn080481B9(Register word32 eax, Register uint32 ecx, Register (ptr32 ci8) edi)
// Called from:
//      fn080481C1
void fn080481B9(word32 eax, uint32 ecx, ci8 * edi)
{
	byte dl;
	uint64 edx_eax_6 = (uint64) eax;
	ci8 dl_15 = (byte) (edx_eax_6 % ecx);
	if ((uint32) (edx_eax_6 /u ecx) == 0x00)
		fn080481C8(dl_15, edi);
	else
		fn080481C1(dl, edi);
}

// 080481C1: Register (ptr32 ci8) fn080481C1(Register byte dl, Register (ptr32 ci8) edi)
// Called from:
//      fn080481AF
//      fn080481B9
ci8 * fn080481C1(byte dl, ci8 * edi)
{
	word32 edx;
	word32 eax;
	uint32 ecx;
	fn080481B9(eax, ecx, edi);
	ci8 dl_10 = (byte) edx;
	return fn080481C8(dl_10, edi);
}

// 080481C8: Register (ptr32 ci8) fn080481C8(Register ci8 dl, Register (ptr32 ci8) edi)
// Called from:
//      fn080481AF
//      fn080481B9
//      fn080481C1
ci8 * fn080481C8(ci8 dl, ci8 * edi)
{
	ci8 dl_10 = dl + 0x30;
	if (dl > 0x09)
		dl_10 = dl + 0x57;
	*edi = dl_10;
	return edi + 1;
}

// 080481D7: void fn080481D7(Register Eq_9 ebp, Register (ptr32 byte) esi)
// Called from:
//      fn08048057
void fn080481D7(Eq_9 ebp, byte * esi)
{
	g_b8048273 = 0x01;
	g_dw804826B = g_dw8048267;
	do
	{
		if (sys_read(ebp, &g_b8048273, 0x01) != 0x01)
			return;
		++g_dw8048267;
		byte al_51 = g_b8048273;
		*esi = al_51;
		++esi;
	} while (al_51 != 0x0A);
	*esi = 0x00;
	g_b8048273 = 0x00;
}

// 0804821C: Register Eq_2 fn0804821C(Register Eq_2 esi, Register (ptr32 char) edi)
// Called from:
//      fn08048057
Eq_2 fn0804821C(Eq_2 esi, char * edi)
{
	Eq_2 eax_16;
	if (*esi.u1 != 0x00)
	{
		eax_16 = fn0804824A(edi);
		if (eax_16 != 0x00)
		{
			do
			{
				int32 cmpResult_38 = memcmp(esi, edi, eax_16);
				eax_16.u0 = 0x00;
				esi.u1 += __find_first_difference__(esi, edi);
				if (cmpResult_38 == 0x00)
					goto l08048245;
			} while (*esi.u1 != 0x00);
		}
	}
	else
	{
l08048245:
		eax_16 = esi;
	}
	return eax_16;
}

// 0804824A: Register ptr32 fn0804824A(Register (ptr32 char) esi)
// Called from:
//      fn08048057
//      fn0804813B
//      fn0804821C
ptr32 fn0804824A(char * esi)
{
	byte * edi_10 = esi - 0x01;
	do
		++edi_10;
	while (*edi_10 != 0x00);
	return edi_10 - esi;
}

Eq_67 g_t804825B = // 0804825B
	{
		0x00
	};
char * g_ptr804825F = null; // 0804825F
word32 g_dw8048263 = 0x00; // 08048263
word32 g_dw8048267 = 0x00; // 08048267
word32 g_dw804826B = 0x00; // 0804826B
Eq_6 g_t804826F = // 0804826F
	{
		0
	};
byte g_b8048273 = 0x00; // 08048273
Eq_2 g_t8048274 = // 08048274
	{
		0x00
	};
ci8 g_b8048275 = 0x00; // 08048275
byte g_b8048285 = 0x00; // 08048285
