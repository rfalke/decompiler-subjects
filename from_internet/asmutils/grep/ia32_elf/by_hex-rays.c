/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(char@<al>, mode_t@<edx>);
void sub_804813B();
// void __usercall sub_8048168(_BYTE *a1@<edi>, const void *a2@<esi>);
// void __usercall sub_8048190(_BYTE *a1@<edi>, const void *a2@<esi>);
// int __usercall sub_80481AF@<eax>(unsigned int@<eax>);
// int __usercall sub_80481B9@<eax>(unsigned int@<eax>, unsigned int@<ecx>, char *@<edi>);
// void __usercall sub_80481D7(int a1@<ebp>, _BYTE *a2@<esi>);
// _BYTE *__usercall sub_804821C@<eax>(_BYTE *@<edi>, _BYTE *@<esi>);
// _BYTE *__usercall sub_804824A@<eax>(int@<esi>);

//-------------------------------------------------------------------------
// Data declarations

int dword_804825B; // weak
const void *addr; // idb
int dword_8048263; // weak
int dword_8048267; // weak
int dword_804826B; // weak
int status; // idb
char byte_8048273; // weak
int dword_8048274; // weak
char byte_8048285[3]; // weak


//----- (08048057) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn start(char a1@<al>, mode_t a2@<edx>)
{
  int v2; // eax
  int v3; // ebp
  int v4; // ebx
  int v5; // ebx
  int v6; // eax
  int v7; // [esp-10h] [ebp-10h]
  _BYTE *v8; // [esp-8h] [ebp-8h]
  void *v9; // [esp-4h] [ebp-4h]

  v3 = 0;
  LOBYTE(status) = 1;
  v4 = v7 - 1;
  if ( v7 == 1 )
    goto LABEL_22;
  while ( 1 )
  {
    switch ( *(_WORD *)v8 )
    {
      case 0x712D:
        a1 |= 1u;
        break;
      case 0x632D:
        a1 |= 4u;
        break;
      case 0x622D:
        a1 |= 0x80u;
        break;
      default:
        if ( *(_WORD *)v8 != 30253 )
        {
          LOBYTE(dword_8048274) = a1;
          v5 = v4 - 1;
          if ( !v5 )
            goto LABEL_15;
          dword_804825B = v5;
          while ( v9 )
          {
            dword_8048263 = 0;
            dword_8048267 = 0;
            addr = v9;
            v3 = sys_open((char *)v9, 0, a2);
            if ( v3 >= 0 )
            {
LABEL_15:
              while ( 1 )
              {
                sub_80481D7(v3, byte_8048285);
                if ( byte_8048273 )
                  break;
                if ( (sub_804821C(v8, byte_8048285) == 0) != ((dword_8048274 & 2) == 0) )
                {
                  LOBYTE(status) = 0;
                  if ( (dword_8048274 & 1) == 0 )
                  {
                    ++dword_8048263;
                    if ( (dword_8048274 & 4) == 0 )
                    {
                      sub_804813B();
                      sub_8048168(v8, byte_8048285);
                      v6 = sys_write(1, byte_8048285, (size_t)sub_804824A((int)byte_8048285));
                    }
                  }
                }
              }
              if ( (dword_8048274 & 4) != 0 )
              {
                sub_804813B();
                sub_8048190(v8, byte_8048285);
              }
            }
          }
LABEL_22:
          v2 = sys_exit(status);
        }
        a1 |= 2u;
        break;
    }
    --v4;
  }
}
// 804804C: positive sp value 10 has been found
// 8048061: variable 'v7' is possibly undefined
// 8048066: variable 'v8' is possibly undefined
// 80480A4: variable 'v9' is possibly undefined
// 80480BD: variable 'a2' is possibly undefined
// 804825B: using guessed type int dword_804825B;
// 8048263: using guessed type int dword_8048263;
// 8048267: using guessed type int dword_8048267;
// 8048273: using guessed type char byte_8048273;
// 8048274: using guessed type int dword_8048274;

//----- (0804813B) --------------------------------------------------------
void sub_804813B()
{
  const void *v0; // esi
  _BYTE *v1; // eax

  if ( (unsigned __int8)dword_804825B > 1u )
  {
    v0 = addr;
    v1 = sub_804824A((int)addr);
    v1[(_DWORD)v0] = 58;
    *((char *)v0 + sys_write(1, v0, (size_t)(v1 + 1)) - 1) = 0;
  }
}
// 804825B: using guessed type int dword_804825B;

//----- (08048168) --------------------------------------------------------
void __usercall sub_8048168(_BYTE *a1@<edi>, const void *a2@<esi>)
{
  int v2; // eax

  if ( (dword_8048274 & 0x80u) != 0 )
  {
    sub_80481AF(dword_804826B);
    *a1 = 58;
    v2 = sys_write(1, a2, a1 - (_BYTE *)a2 + 1);
  }
}
// 804826B: using guessed type int dword_804826B;
// 8048274: using guessed type int dword_8048274;

//----- (08048190) --------------------------------------------------------
void __usercall sub_8048190(_BYTE *a1@<edi>, const void *a2@<esi>)
{
  int v2; // eax

  sub_80481AF(dword_8048263);
  *a1 = 10;
  v2 = sys_write(1, a2, a1 - (_BYTE *)a2 + 1);
}
// 8048263: using guessed type int dword_8048263;

//----- (080481AF) --------------------------------------------------------
int __usercall sub_80481AF@<eax>(unsigned int a1@<eax>)
{
  return sub_80481B9(a1, 0xAu, (_BYTE *)&dword_8048274 + 1);
}
// 8048274: using guessed type int dword_8048274;

//----- (080481B9) --------------------------------------------------------
int __usercall sub_80481B9@<eax>(unsigned int a1@<eax>, unsigned int a2@<ecx>, char *a3@<edi>)
{
  int result; // eax
  char v4; // dl
  unsigned int v5; // et2
  char v6; // dl
  char v7; // [esp-4h] [ebp-4h]

  v5 = a1 % a2;
  result = a1 / a2;
  v4 = v5;
  if ( result )
  {
    v7 = v4;
    result = sub_80481B9(result, a2, a3);
    v4 = v7;
  }
  v6 = v4 + 48;
  if ( v6 > 57 )
    v6 += 39;
  *a3 = v6;
  return result;
}

//----- (080481D7) --------------------------------------------------------
void __usercall sub_80481D7(int a1@<ebp>, _BYTE *a2@<esi>)
{
  int v2; // eax
  int v3; // edx
  char v4; // al

  byte_8048273 = 1;
  dword_804826B = dword_8048267;
  while ( 1 )
  {
    v2 = sys_read(a1, &byte_8048273, 1u);
    if ( v2 != v3 )
      break;
    ++dword_8048267;
    v4 = byte_8048273;
    *a2++ = byte_8048273;
    if ( v4 == 10 )
    {
      *a2 = 0;
      byte_8048273 = 0;
      return;
    }
  }
}
// 80481FC: variable 'v3' is possibly undefined
// 8048267: using guessed type int dword_8048267;
// 804826B: using guessed type int dword_804826B;
// 8048273: using guessed type char byte_8048273;

//----- (0804821C) --------------------------------------------------------
_BYTE *__usercall sub_804821C@<eax>(_BYTE *a1@<edi>, _BYTE *a2@<esi>)
{
  _BYTE *result; // eax
  _BYTE *v3; // ecx
  bool v4; // zf
  _BYTE *v5; // [esp-8h] [ebp-10h]
  _BYTE *v6; // [esp-4h] [ebp-Ch]

  if ( *a2 )
  {
    result = sub_804824A((int)a1);
    v3 = result;
    if ( !result )
      return result;
    while ( 1 )
    {
      result = 0;
      v4 = 1;
      v6 = v3;
      v5 = a1;
      do
      {
        if ( !v3 )
          break;
        v4 = *a2++ == *a1++;
        --v3;
      }
      while ( v4 );
      a1 = v5;
      v3 = v6;
      if ( v4 )
        break;
      if ( !*a2 )
        return result;
    }
  }
  return a2;
}

//----- (0804824A) --------------------------------------------------------
_BYTE *__usercall sub_804824A@<eax>(int a1@<esi>)
{
  _BYTE *v1; // edi

  v1 = (_BYTE *)(a1 - 1);
  do
    ++v1;
  while ( *v1 );
  return &v1[-a1];
}

// nfuncs=9 queued=9 decompiled=9 lumina nreq=0 worse=0 better=0
// ALL OK, 9 function(s) have been successfully decompiled
