// subject_bss.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 * g_ptr804C00C = null; // 0804C00C
up32 g_dw804C010 = 0x00; // 0804C010
Eq_12 g_t804C014 = // 0804C014
	{
		0x00
	};
// subject_got.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 ** g_ptr804BFF4 = &g_ptr804C00C; // 0804BFF4
up32 * g_ptr804BFF8 = &g_dw804C010; // 0804BFF8
union Eq_12 * g_ptr804BFFC = &g_t804C014; // 0804BFFC
// subject_rodata.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

Eq_17 g_t804A000 = // 0804A000
	{
		0x0A,
	};
Eq_17 g_t804A034 = // 0804A034
	{
		0x0A,
	};
Eq_17 g_t804A086 = // 0804A086
	{
		0x25,
	};
Eq_17 g_t804A08A = // 0804A08A
	{
		0x0A,
	};
Eq_17 g_t804A0DD = // 0804A0DD
	{
		0x25,
	};
char g_str804A0E1[] = "HOME"; // 0804A0E1
Eq_17 g_t804A0E6 = // 0804A0E6
	{
		0x0A,
	};
Eq_17 g_t804A100 = // 0804A100
	{
		0x0A,
	};
Eq_17 g_t804A112 = // 0804A112
	{
		0x0A,
	};
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 08049000: void main(Register (ptr32 Eq_2) ebp)
// Called from:
//      fn08049240
void main(struct Eq_2 * ebp)
{
}

// 08049240: void fn08049240(Register (ptr32 Eq_403) edi, Stack (ptr32 word32) dwArg00)
void fn08049240(union Eq_403 * edi, word32 * dwArg00)
{
	__start_main(edi, &g_t8049000, dwArg00);
}

// 08049293: void fn08049293(Stack (ptr32 Eq_250) dwArg00)
// Called from:
//      open
//      close
//      read
//      write
//      lseek
//      chmod
//      chown
//      pipe
//      link
//      symlink
//      unlink
//      mkdir
//      rmdir
//      exit
//      fork
//      execve
//      uname
//      ioctl
//      alarm
//      nanosleep
//      kill
//      signal
//      wait4
//      fstat
//      lstat
//      getuid
//      getgid
void fn08049293(struct Eq_250 * dwArg00)
{
	ci8 al_31 = dwArg00->b0000;
	if (al_31 != 0x00 && (al_31 < 0x00 || g_ptr804BFFC->u0 == 0x00))
		;
	up32 eax_61 = (word32) dwArg00->b0001;
	__syscall<byte>(0x80);
	if (eax_61 >= ~0x0FFE)
		*g_ptr804BFF8 = -eax_61;
}

// 08049317: void open(Register (ptr32 word32) ecx, Register (ptr16 Eq_285) es)
void open(word32 * ecx, struct Eq_285 * es)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	++*ecx;
	struct Eq_298 * esp_5 = (struct Eq_298 *) <invalid>;
	esp_5->ptrFFFFFFFE = es;
	read();
}

// 0804931E: void close(Register word32 eax, Register (ptr32 word32) esi)
void close(word32 eax, word32 * esi)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	*esi += eax;
	read();
}

// 08049325: void read()
// Called from:
//      main
//      open
//      close
void read()
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	write();
}

// 0804932C: void write()
// Called from:
//      main
//      read
void write()
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
}

// 08049333: void lseek(Register byte cl, Register word24 ecx_24_8, Register (ptr32 byte) edi)
void lseek(byte cl, word24 ecx_24_8, byte * edi)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	chmod(cl, ecx_24_8, edi);
}

// 0804933A: void chmod(Register byte cl, Register word24 ecx_24_8, Register (ptr32 byte) edi)
// Called from:
//      lseek
void chmod(byte cl, word24 ecx_24_8, byte * edi)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	word32 * ecx_16 = SEQ(ecx_24_8, cl + *edi);
	chown(ecx_16);
}

// 08049341: void chown(Register (ptr32 word32) ecx)
// Called from:
//      chmod
void chown(word32 * ecx)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	fn0804934C(ecx);
}

// 08049348: void pipe(Register (ptr32 word32) ecx)
void pipe(word32 * ecx)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	fn0804934C(ecx);
}

// 0804934C: void fn0804934C(Register (ptr32 word32) ecx)
// Called from:
//      chown
//      pipe
void fn0804934C(word32 * ecx)
{
	++*ecx;
	fn08049350();
}

// 0804934F: void link()
// Called from:
//      pipe
void link()
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	fn08049350();
}

// 08049350: void fn08049350()
// Called from:
//      fn0804934C
//      link
void fn08049350()
{
}

// 08049356: void symlink()
// Called from:
//      link
void symlink()
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	fn0804935E();
}

// 0804935D: void unlink()
void unlink()
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	fn0804935E();
}

// 0804935E: void fn0804935E()
// Called from:
//      symlink
//      unlink
void fn0804935E()
{
}

// 08049364: void mkdir(Register (ptr32 word32) eax, Register (ptr32 word32) ecx, Register (ptr32 Eq_394) edx, Register word32 ebp, Register (ptr32 Eq_403) edi)
// Called from:
//      unlink
void mkdir(word32 * eax, word32 * ecx, struct Eq_394 * edx, word32 ebp, union Eq_403 * edi)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	struct Eq_298 * esp_5 = (struct Eq_298 *) <invalid>;
	edi->u1 = esp_5 + edi->u1 / 8;
	rmdir(eax, ecx, edx, ebp, edi);
}

// 0804936B: void rmdir(Register (ptr32 word32) eax, Register (ptr32 word32) ecx, Register (ptr32 Eq_394) edx, Register word32 ebp, Register (ptr32 Eq_403) edi)
// Called from:
//      mkdir
void rmdir(word32 * eax, word32 * ecx, struct Eq_394 * edx, word32 ebp, union Eq_403 * edi)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	*eax += ebp;
	exit(eax, ecx, edx, edi);
}

// 08049372: void exit(Register (ptr32 word32) eax, Register (ptr32 word32) ecx, Register (ptr32 Eq_394) edx, Register (ptr32 Eq_403) edi)
// Called from:
//      fn08049240
//      rmdir
void exit(word32 * eax, word32 * ecx, struct Eq_394 * edx, union Eq_403 * edi)
{
	struct Eq_250 * dwLoc04;
	byte al_17 = (byte) eax;
	fn08049293(dwLoc04);
	*ecx = eax + *ecx;
	fork(al_17, edx, edi);
}

// 08049379: void fork(Register byte al, Register (ptr32 Eq_394) edx, Register (ptr32 Eq_403) edi)
// Called from:
//      exit
void fork(byte al, struct Eq_394 * edx, union Eq_403 * edi)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	edx->b0000 += al;
	execve(edx, edi);
}

// 08049380: void execve(Register (ptr32 Eq_394) edx, Register (ptr32 Eq_403) edi)
// Called from:
//      fork
void execve(struct Eq_394 * edx, union Eq_403 * edi)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	uname(edx, edi);
}

// 08049387: void uname(Register (ptr32 Eq_394) edx, Register (ptr32 Eq_403) edi)
// Called from:
//      execve
void uname(struct Eq_394 * edx, union Eq_403 * edi)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	edx->dwFFFFFFE8 = &edi->u0 + edx->dwFFFFFFE8;
	fn0804938F();
}

// 0804938E: void ioctl()
void ioctl()
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	fn0804938F();
}

// 0804938F: void fn0804938F()
// Called from:
//      uname
//      ioctl
void fn0804938F()
{
}

// 08049395: void alarm(Register (ptr32 word32) edx, Register (ptr32 word32) ebx)
// Called from:
//      ioctl
void alarm(word32 * edx, word32 * ebx)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	*ebx = ebx + *ebx;
	nanosleep(edx);
}

// 0804939C: void nanosleep(Register (ptr32 word32) edx)
// Called from:
//      alarm
void nanosleep(word32 * edx)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	fn080493A7(edx);
}

// 080493A3: void kill(Register (ptr32 word32) edx)
void kill(word32 * edx)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	fn080493A7(edx);
}

// 080493A7: void fn080493A7(Register (ptr32 word32) edx)
// Called from:
//      nanosleep
//      kill
void fn080493A7(word32 * edx)
{
	++*edx;
	fn080493AE(edx);
}

// 080493AA: void signal(Register (ptr32 word32) edx)
void signal(word32 * edx)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	fn080493AE(edx);
}

// 080493AE: void fn080493AE(Register (ptr32 word32) edx)
// Called from:
//      kill
//      fn080493A7
//      signal
void fn080493AE(word32 * edx)
{
	++*edx;
	fn080493B2();
}

// 080493B1: void wait4()
// Called from:
//      signal
void wait4()
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	fn080493B2();
}

// 080493B2: void fn080493B2()
// Called from:
//      fn080493AE
//      wait4
void fn080493B2()
{
}

// 080493B8: void fstat()
// Called from:
//      wait4
void fstat()
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	fn080493C1();
}

// 080493BF: void lstat()
void lstat()
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	fn080493C1();
}

// 080493C1: void fn080493C1()
// Called from:
//      fstat
//      lstat
void fn080493C1()
{
}

// 080493C6: void getuid(Register (ptr32 byte) eax, Register byte ch, Register byte bl, Register (ptr32 Eq_403) edi)
void getuid(byte * eax, byte ch, byte bl, union Eq_403 * edi)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	fn080493C7(eax, ch, bl, edi);
}

// 080493C7: void fn080493C7(Register (ptr32 byte) eax, Register byte ch, Register byte bl, Register (ptr32 Eq_403) edi)
// Called from:
//      lstat
//      getuid
void fn080493C7(byte * eax, byte ch, byte bl, union Eq_403 * edi)
{
	*eax += bl;
	getgid(ch, edi);
}

// 080493CD: void getgid(Register byte ch, Register (ptr32 Eq_403) edi)
// Called from:
//      getuid
//      fn080493C7
void getgid(byte ch, union Eq_403 * edi)
{
	struct Eq_250 * dwLoc04;
	fn08049293(dwLoc04);
	edi->u0 = (byte) (edi->u0 + ch);
	struct Eq_298 * esp_5 = (struct Eq_298 *) <invalid>;
	__start_main(edi, esp_5->ptr0000, esp_5->ptr0004);
}

// 080493D4: void __start_main(Register (ptr32 Eq_403) edi, Stack (ptr32 Eq_2) dwArg00, Stack (ptr32 word32) dwArg04)
// Called from:
//      fn08049240
//      getgid
void __start_main(union Eq_403 * edi, struct Eq_2 * dwArg00, word32 * dwArg04)
{
	ptr32 fp;
	word32 * ecx_9 = fp + 0x0C + dwArg04 * 0x04;
	*g_ptr804BFF4 = ecx_9;
	main(dwArg00);
	exit(dwArg04, ecx_9, fp + 8, edi);
}

// 080493FA: void _fastcall(Register Eq_12 eax)
// Called from:
//      main
//      fn08049240
void _fastcall(Eq_12 eax)
{
	g_ptr804BFFC->u1 = (word32) eax;
}

// 08049410: void memset(Register Eq_33 eax, Register int32 ecx, Register byte dl, Stack Eq_33 dwArg04, Stack Eq_33 bArg08, Stack int32 dwArg0C)
// Called from:
//      main
void memset(Eq_33 eax, int32 ecx, byte dl, Eq_33 dwArg04, Eq_33 bArg08, int32 dwArg0C)
{
	word32 edx;
	word32 dwArg08;
	Eq_33 edx_14 = eax;
	byte al_54 = (byte) edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		edx_14 = dwArg04;
		al_54 = (byte) dwArg08;
		ecx = dwArg0C;
	}
	Eq_33 edi_36 = edx_14;
	for (; ecx != 0x00; --ecx)
	{
		edi_36.u1->t0000.u0 = al_54;
		&edi_36.u1->t0000.u0 = (word32) edi_36 + 1;
	}
}

// 08049443: void memcpy(Register (ptr32 Eq_656) eax, Register uint32 ecx, Register (ptr32 Eq_658) edx, Stack (ptr32 Eq_656) dwArg04, Stack (ptr32 Eq_658) dwArg08, Stack uint32 dwArg0C)
// Called from:
//      main
void memcpy(<unknown>* eax, uint32 ecx, <unknown> * edx, <unknown>* dwArg04, <unknown>* dwArg08, uint32 dwArg0C)
{
	<unknown>* edi_28 = eax;
	<unknown>* esi_29 = edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		edi_28 = dwArg04;
		esi_29 = dwArg08;
		ecx = dwArg0C;
	}
	memcpy(edi_28, esi_29, ecx);
}

// 08049471: void memcmp(Register uint32 ecx, Register (ptr32 Eq_677) esi, Register (ptr32 Eq_678) edi, Stack (ptr32 Eq_677) dwArg04, Stack (ptr32 Eq_678) dwArg08, Stack uint32 dwArg0C)
void memcmp(uint32 ecx, <unknown> * esi, <unknown>* edi, <unknown>* dwArg04, <unknown>* dwArg08, uint32 dwArg0C)
{
	if (g_ptr804BFFC->u0 == 0x00)
	{
		esi = dwArg04;
		edi = dwArg08;
		ecx = dwArg0C;
	}
	memcmp(esi, edi, ecx) == 0x00;
}

// 080494A6: Register (ptr32 char) getenv(Register (ptr32 char) eax, Stack (ptr32 char) dwArg04)
// Called from:
//      main
char * getenv(char * eax, char * dwArg04)
{
	char * edi_28 = eax;
	if (g_ptr804BFFC->u0 == 0x00)
		edi_28 = dwArg04;
	word32 * ebx_43 = *g_ptr804BFF4;
	uint32 ecx_54 = strlen(edi_28) - ~0x00;
	while (true)
	{
		char * edi_64 = *ebx_43;
		if (edi_64 == null)
			break;
		int32 cmpResult_69 = memcmp(edi_28, edi_64, ecx_54 - 0x01);
		ptr32 edi_73 = edi_64 + __find_first_difference__(edi_28, edi_64);
		if (cmpResult_69 == 0x00)
		{
			edi_64 = edi_73 + 0x01;
			return edi_64;
		}
		++ebx_43;
	}
	return edi_64;
}

// 08049501: void strlen(Register ptr32 eax, Stack ptr32 dwArg04)
void strlen(ptr32 eax, ptr32 dwArg04)
{
	if (g_ptr804BFFC->u0 == 0x00)
		eax = dwArg04;
	int32 eax_21 = 0x00;
	do
	{
		eax_21 = eax_51 + 0x01;
		eax_51 = eax_21;
	} while (*((word32) eax + eax_51) >= 0x01);
}

// 0804952C: void itoa(Register (ptr32 byte) eax, Register uint32 ecx, Register (ptr32 char) edx, Stack (ptr32 byte) dwArg04, Stack (ptr32 char) dwArg08, Stack uint32 dwArg0C)
void itoa(byte * eax, uint32 ecx, char * edx, byte * dwArg04, char * dwArg08, uint32 dwArg0C)
{
	char * edi_28 = edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		eax = dwArg04;
		edi_28 = dwArg08;
		ecx = dwArg0C;
	}
	*fn0804955D(eax, ecx, edi_28) = 0x00;
}

// 0804955D: Register (ptr32 char) fn0804955D(Register (ptr32 byte) eax, Register uint32 ecx, Register (ptr32 char) edi)
// Called from:
//      itoa
//      fn0804955D
//      sprintf
char * fn0804955D(byte * eax, uint32 ecx, char * edi)
{
	uint64 edx_eax_6 = (uint64) eax;
	uint32 edx_9 = (uint32) (edx_eax_6 % ecx);
	byte dl_23 = (byte) edx_9;
	byte * eax_10 = (uint32) (edx_eax_6 /u ecx);
	if (eax_10 != null)
	{
		fn0804955D(eax_10, ecx, edi);
		dl_23 = (byte) edx_9;
	}
	ci8 dl_26 = dl_23 + 0x30;
	if (dl_26 > 0x39)
		dl_26 += 0x27;
	*edi = dl_26;
	return edi + 1;
}

// 0804957B: Register ptr32 sprintf(Stack (ptr32 char) dwArg04, Stack (ptr32 Eq_17) dwArg08)
// Called from:
//      printf
ptr32 sprintf(char * dwArg04, struct Eq_17 * dwArg08)
{
	ptr32 fp;
	word32 * edx_181 = fp + 0x0C;
	struct Eq_17 * esi_192 = dwArg08;
	char * edi_161 = dwArg04;
	while (true)
	{
		byte al_188 = esi_296->b0000;
		esi_192 = &esi_296->b0000 + 1;
		if (al_188 == 0x00)
			break;
		if (al_188 == 0x25)
		{
			byte * ebx_171 = *edx_181;
			al_188 = esi_192->b0000;
			esi_192 = &esi_192->b0000 + 1;
			uint32 ecx_110 = 0x0A;
			if (al_188 != 100)
			{
				ecx_110 = 0x10;
				if (al_188 == 0x78)
					goto l080495CB;
				ecx_110 = 0x08;
				if (al_188 == 111)
					goto l080495CB;
				ecx_110 = 0x02;
				if (al_188 == 0x62)
					goto l080495CB;
				if (al_188 == 99)
					goto l08049593;
				esi_296 = esi_192;
				if (al_188 != 115)
					continue;
				if (ebx_171 != null)
				{
					while (true)
					{
						byte al_173 = *ebx_171;
						if (al_173 == 0x00)
							break;
						*edi_161 = al_173;
						++edi_161;
						++ebx_171;
					}
				}
			}
			else
			{
l080495CB:
				*fn0804955D(ebx_171, ecx_110, edi_161) = 0x00;
				char * edi_140 = edi_161;
				do
				{
					edi_140 = edi_297 + 1;
					edi_297 = edi_140;
				} while (*edi_297 >= 0x01);
				edi_161 = edi_140 - 0x01;
			}
			esi_192 = esi_296 + 1;
			++edx_181;
			continue;
		}
l08049593:
		*edi_161 = al_188;
		++edi_161;
	}
	*edi_161 = 0x00;
	return edi_161 + 1 - dwArg04 - 0x01;
}

// 080495F0: void printf(Stack (ptr32 Eq_17) dwArg04)
// Called from:
//      main
void printf(struct Eq_17 * dwArg04)
{
	char bLoc1000;
	sys_write(0x01, &bLoc1000, sprintf(&bLoc1000, dwArg04));
}

// 0804967A: Register Eq_33 strtol(Register Eq_33 eax, Register int32 ecx, Register Eq_33 edx, Stack Eq_33 dwArg04, Stack Eq_33 dwArg08, Stack int32 dwArg0C)
// Called from:
//      main
Eq_33 strtol(Eq_33 eax, int32 ecx, Eq_33 edx, Eq_33 dwArg04, Eq_33 dwArg08, int32 dwArg0C)
{
	Eq_33 edi_104 = eax;
	Eq_33 esi_119 = edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		edi_104 = dwArg04;
		esi_119 = dwArg08;
		ecx = dwArg0C;
	}
	if (ecx == 0x00)
		ecx = 0x0A;
	Eq_33 eax_156 = 0x00;
	word24 ebx_24_8_115 = 0x00;
	while (edi_104.u1->t0000.u0 == 0x20)
		&edi_104.u1->t0000.u0 = (word32) edi_104 + 1;
	if (edi_104.u1->t0000.u1 == 0x7830)
	{
		ecx = 0x10;
		&edi_104.u1->t0000.u0 = (word32) edi_104 + 2;
	}
	do
	{
		Eq_946 bl_62 = edi_104.u1->t0000.u0;
		if (bl_62 < 0x30)
			return eax_156;
		word32 ebx_79 = SEQ(ebx_24_8_115, bl_62 - 0x30);
		if (bl_62 > 0x39)
		{
			ebx_79 = SEQ(ebx_24_8_115, bl_62 - 55);
			if (bl_62 > 0x5A)
				ebx_79 = SEQ(ebx_24_8_115, bl_62 - 0x57);
		}
		ebx_24_8_115 = SLICE(ebx_79, word24, 8);
		eax_156 = ecx *s eax_156 + ebx_79;
		&edi_104.u1->t0000.u0 = (word32) edi_104 + 1;
	} while (edi_104 != esi_119);
	return eax_156;
}

