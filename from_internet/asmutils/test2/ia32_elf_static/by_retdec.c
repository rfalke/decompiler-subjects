//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
//

#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>

// ------------------- Function Prototypes --------------------

int32_t __get_GOT(int32_t a1);
int32_t __system_call(int32_t a1, int32_t a2, int32_t a3, int32_t a4, int32_t a5, int32_t a6);
int32_t _fastcall(int32_t * a1, int32_t a2, int32_t a3, int32_t a4);
int32_t getenv(int32_t a1);
int32_t itoa_printB(void);
int32_t memcpy(char * a1, char * a2, int32_t a3);
int32_t memset(char * a1, int32_t a2, int32_t a3);
int32_t printf(char * a1);
int32_t read(void);
int32_t sprintf(int32_t a1, int32_t a2);
int32_t strtol(char * a1, int32_t * a2, int32_t a3);
int32_t write(void);

// --------------------- Global Variables ---------------------

int32_t g1 = 0; // 0x804c010
int32_t g2;

// ------------------------ Functions -------------------------

// From module:   /home/hawk/mess/2022/04/asmutils/lib/test2.c
// Address range: 0x8049000 - 0x8049245
// Line range:    18 - 66
int main() {
    char inp[10]; // bp-34, 0x8049000
    char tmp[10]; // bp-44, 0x8049000
    char ** v1 = argv;
    int32_t v2; // 0x8049000
    _fastcall((int32_t *)&v1, v2, v2, argc);
    printf("\n\tprintf() test\nhex: %x, octal: %o, decimal: %d\n");
    printf("\n\tstrtol() test\nInput some decimal number: ");
    int32_t v3 = read(); // 0x804904c
    memcpy(tmp, inp, v3);
    int32_t v4 = (int32_t)&tmp; // 0x8049074
    int32_t v5 = v4 - 1 + v3; // bp-48, 0x8049079
    strtol(tmp, &v5, 10);
    printf("You have entered %d\n");
    printf("\n\tmemset() test\n");
    memset(tmp, 0, 10);
    int32_t v6 = &v5; // 0x80490c2
    int32_t v7; // bp-39, 0x8049000
    v5 = &v7;
    int32_t * v8 = (int32_t *)(v6 - 8);
    int32_t * v9 = (int32_t *)(v6 - 12);
    int32_t * v10 = (int32_t *)(v6 - 16);
    for (int32_t i = 9; i > 0; i--) {
        // 0x80490d7
        *v8 = 5;
        *v9 = i + 48;
        *v10 = v4;
        memset((char *)i, (int32_t)&g2, (int32_t)&g2);
        *v8 = 10;
        *v9 = v6;
        *v10 = v4;
        *v9 = strtol((char *)&g2, &g2, (int32_t)&g2);
        *v10 = (int32_t)"%d ";
        printf((char *)&g2);
    }
    // 0x804911e
    *v10 = (int32_t)"\n\n\tvariable test\n";
    printf(NULL);
    *v8 = 0;
    *v9 = 0;
    *v10 = -1;
    write();
    *v9 = g1;
    *v10 = (int32_t)"errno: %d\n";
    printf((char *)&g2);
    *v10 = (int32_t)"\n\tenvironment test\nPress ENTER to print envrionment\n";
    printf((char *)&g2);
    *v8 = 1;
    *v9 = (int32_t)&inp;
    *v10 = 0;
    read();
    int32_t v11 = *(int32_t *)v2; // 0x80491b5
    int32_t v12 = 0; // 0x80491b9
    int32_t v13 = 0; // 0x80491b9
    if (v11 != 0) {
        *v9 = v11;
        *v10 = (int32_t)"%s\n";
        printf((char *)v12);
        v12++;
        int32_t v14 = *(int32_t *)(4 * v12 + v2); // 0x80491b5
        v13 = v12;
        while (v14 != 0) {
            // 0x8049181
            *v9 = v14;
            *v10 = (int32_t)"%s\n";
            printf((char *)v12);
            v12++;
            v14 = *(int32_t *)(4 * v12 + v2);
            v13 = v12;
        }
    }
    // 0x80491bb
    *v10 = (int32_t)"HOME";
    *v9 = getenv(v13);
    *v10 = (int32_t)"\n\tgetenv(\"HOME\") test\n%s\n";
    printf((char *)&g2);
    if (v1 < (char **)2) {
        // 0x8049226
        *v10 = (int32_t)"\n\tall tests done\n";
        printf((char *)&g2);
        return 0;
    }
    // 0x80491e1
    *v10 = (int32_t)"\n\targuments test\n";
    printf((char *)&g2);
    if (v1 <= NULL) {
        // 0x8049226
        *v10 = (int32_t)"\n\tall tests done\n";
        printf((char *)&g2);
        return 0;
    }
    char * v15 = NULL; // 0x804921c
    int32_t v16 = (int32_t)v15; // 0x80491fa
    *v9 = *(int32_t *)(4 * v16 + (int32_t)envp);
    *v10 = (int32_t)"%s\n";
    printf(v15);
    v15 = (char *)(v16 + 1);
    while (v15 < (char *)v1) {
        // 0x80491fa
        v16 = (int32_t)v15;
        *v9 = *(int32_t *)(4 * v16 + (int32_t)envp);
        *v10 = (int32_t)"%s\n";
        printf(v15);
        v15 = (char *)(v16 + 1);
    }
    // 0x8049226
    *v10 = (int32_t)"\n\tall tests done\n";
    printf((char *)&g2);
    return 0;
}

// Address range: 0x804929f - 0x80492a3
int32_t __get_GOT(int32_t a1) {
    // 0x804929f
    int32_t result; // 0x804929f
    return result;
}

// Address range: 0x80492a3 - 0x8049327
int32_t __system_call(int32_t a1, int32_t a2, int32_t a3, int32_t a4, int32_t a5, int32_t a6) {
    // 0x80492a3
    char * v1; // 0x80492a3
    if (*v1 >= 1) {
        // 0x80492b3
        int32_t v2; // 0x80492a3
        __get_GOT(v2);
    }
    // 0x80492f5
    __asm_int(128);
    return (int32_t)*(char *)((int32_t)v1 + 1);
}

// Address range: 0x8049335 - 0x804933c
int32_t read(void) {
    int32_t v1 = __system_call((int32_t)&g2, (int32_t)&g2, (int32_t)&g2, (int32_t)&g2, (int32_t)&g2, (int32_t)&g2); // 0x8049335
    int32_t v2; // 0x8049335
    return v1 + v2;
}

// Address range: 0x804933c - 0x8049341
int32_t write(void) {
    int32_t result = __system_call((int32_t)&g2, (int32_t)&g2, (int32_t)&g2, (int32_t)&g2, (int32_t)&g2, (int32_t)&g2); // 0x804933c
    return result;
}

// Address range: 0x804940a - 0x8049420
int32_t _fastcall(int32_t * a1, int32_t a2, int32_t a3, int32_t a4) {
    // 0x804940a
    int32_t v1; // 0x804940a
    int32_t result = __get_GOT(v1); // 0x804940b
    *(int32_t *)*(int32_t *)(v1 + 0x2bec) = result;
    return result;
}

// Address range: 0x8049420 - 0x8049453
int32_t memset(char * a1, int32_t a2, int32_t a3) {
    // 0x8049420
    int32_t result; // 0x8049420
    int32_t v1 = __get_GOT(result); // 0x8049425
    char v2 = *(char *)*(int32_t *)(result + 0x2bd2); // 0x8049436
    int32_t v3 = v2 != 0 ? v1 : a2;
    int32_t v4 = v2 != 0 ? result : a3;
    int32_t v5 = v2 != 0 ? result : (int32_t)a1;
    __asm_rep_stosb_memset((char *)v5, (char)v3, v4);
    return result;
}

// Address range: 0x8049453 - 0x8049481
int32_t memcpy(char * a1, char * a2, int32_t a3) {
    // 0x8049453
    int32_t result; // 0x8049453
    __get_GOT(result);
    char v1 = *(char *)*(int32_t *)(result + 0x2b9e); // 0x804946a
    int32_t v2 = v1 != 0 ? result : (int32_t)a2;
    int32_t v3 = v1 != 0 ? result : (int32_t)a1;
    __asm_rep_movsb_memcpy((char *)v3, (char *)v2, v1 != 0 ? result : a3);
    return result;
}

// Address range: 0x80494b6 - 0x8049511
int32_t getenv(int32_t a1) {
    // 0x80494b6
    int32_t v1; // 0x80494b6
    __get_GOT(v1);
    int32_t v2 = *(char *)*(int32_t *)(v1 + 0x2b3d) != 0 ? v1 : a1;
    __get_GOT((int32_t)&g2);
    int32_t v3 = *(int32_t *)*(int32_t *)(v1 + 0x2b1a); // 0x80494e6
    int32_t v4 = -1; // 0x80494f0
    int32_t v5 = v2; // 0x80494f0
    int32_t v6 = 0; // 0x80494f0
    while (v4 != 0) {
        int32_t v7 = v5;
        v4--;
        v5 = v7 + 1;
        v6 = v4;
        if (*(char *)v7 == 0) {
            // break -> 
            break;
        }
        v6 = 0;
    }
    int32_t v8 = *(int32_t *)v3; // 0x80494fb
    if (v8 == 0) {
        // 0x804950b
        return 0;
    }
    int32_t v9 = -2 - v6; // 0x80494f4
    int32_t v10 = v3; // 0x8049505
    int32_t v11 = v9; // 0x8049501
    int32_t v12; // 0x80494b6
    int32_t result; // 0x80494b6
    int32_t v13; // 0x80494b6
    int32_t v14; // 0x8049501
    if (v9 != 0) {
        v13 = v2;
        v12 = v8;
        while (*(char *)v13 == *(char *)v12) {
            // 0x8049501
            v14 = v11 - 1;
            v11 = v14;
            if (v14 == 0) {
                // 0x804950a
                result = v12 + 2;
                return result;
            }
            v13++;
            v12++;
        }
    }
    // 0x8049505
    v10 += 4;
    int32_t v15 = *(int32_t *)v10; // 0x80494fb
    result = 0;
    while (v15 != 0) {
        int32_t v16 = v15; // 0x8049501
        v11 = v9;
        if (v9 != 0) {
            v13 = v2;
            v12 = v16;
            while (*(char *)v13 == *(char *)v12) {
                // 0x8049501
                v14 = v11 - 1;
                v11 = v14;
                if (v14 == 0) {
                    // 0x804950a
                    result = v12 + 2;
                    return result;
                }
                v13++;
                v12++;
            }
        }
        // 0x8049505
        v10 += 4;
        v15 = *(int32_t *)v10;
        result = 0;
    }
  lab_0x804950b:
    // 0x804950b
    return result;
}

// Address range: 0x804956d - 0x804958b
int32_t itoa_printB(void) {
    // 0x804956d
    int32_t v1; // 0x804956d
    int32_t v2 = v1 % v1;
    int32_t v3 = v2; // 0x8049573
    int32_t result = 1; // 0x8049573
    if (v1 <= v1) {
        // 0x8049575
        v3 = 0x1000000 * v2 >> 24;
        result = itoa_printB();
    }
    int32_t v4 = v3 + 48; // 0x804957c
    int32_t v5 = (char)v4 < 58 ? v4 : v3 + 87;
    *(char *)v1 = (char)v5;
    return result;
}

// Address range: 0x804958b - 0x8049600
int32_t sprintf(int32_t a1, int32_t a2) {
    int32_t v1 = a1; // bp-36, 0x8049598
    int32_t v2 = &v1; // 0x8049598
    int32_t * v3 = (int32_t *)(v2 - 4);
    int32_t * v4 = (int32_t *)(v2 - 12);
    int32_t * v5 = (int32_t *)(v2 - 24);
    int32_t * v6 = (int32_t *)(v2 - 28);
    int32_t * v7 = (int32_t *)(v2 - 32);
    int32_t v8; // bp+12, 0x804958b
    int32_t v9 = &v8; // 0x8049599
    int32_t v10 = a2; // 0x8049599
    int32_t v11 = a1; // 0x8049599
    char v12; // 0x804958b
    int32_t v13; // 0x804958b
    int32_t v14; // 0x804958b
    int32_t v15; // 0x804958b
    int32_t v16; // 0x804958b
    int32_t v17; // 0x804958b
    int32_t v18; // 0x804958b
    int32_t v19; // 0x804958b
    int32_t v20; // 0x804958b
    int32_t v21; // 0x804958b
    int32_t v22; // 0x804958b
    int32_t v23; // 0x804959a
    int32_t v24; // 0x80495a8
    while (true) {
      lab_0x804959a_2:
        // 0x804959a
        v16 = v15;
        v21 = v9;
        int32_t v25 = v13;
        int32_t v26 = v10;
        int32_t v27 = v11; // 0x804958b
        int32_t v28; // 0x804958b
        int32_t v29; // 0x80495a6
        int32_t v30; // 0x80495a8
        while (true) {
            // 0x804959a
            v19 = v27;
            int32_t v31 = v25; // 0x804958b
            int32_t v32 = v26; // 0x804958b
            int32_t v33; // 0x804958b
            int32_t v34; // 0x804958b
            unsigned char v35; // 0x804959a
            int32_t v36; // 0x804959a
            while (true) {
              lab_0x804959a:;
                int32_t v37 = v32;
                v35 = *(char *)v37;
                v23 = v31 & -256;
                v36 = v37 + 1;
                switch (v35) {
                    case 0: {
                        goto lab_0x80495f3;
                    }
                    case 37: {
                        // 0x80495a6
                        v29 = *(int32_t *)v21;
                        unsigned char v38 = *(char *)v36; // 0x80495a8
                        v30 = v23 | (int32_t)v38;
                        v24 = v37 + 2;
                        *v3 = 10;
                        v28 = 10;
                        if (v38 == 100) {
                            // break (via goto) -> 0x80495db
                            goto lab_0x80495db_3;
                        }
                        // 0x80495b0
                        *v3 = 16;
                        v28 = 16;
                        if (v38 == 120) {
                            // break (via goto) -> 0x80495db
                            goto lab_0x80495db_3;
                        }
                        // 0x80495b7
                        *v3 = 8;
                        v28 = 8;
                        if (v38 == 111) {
                            // break (via goto) -> 0x80495db
                            goto lab_0x80495db_3;
                        }
                        // 0x80495be
                        *v3 = 2;
                        v33 = v30;
                        v34 = v24;
                        v28 = 2;
                        switch (v38) {
                            case 98: {
                                goto lab_0x80495db_3;
                            }
                            case 99: {
                                goto lab_0x80495a3_2;
                            }
                            default: {
                                // 0x80495c9
                                v31 = v30;
                                v32 = v24;
                                if (v38 == 115) {
                                    // 0x80495cd
                                    v14 = v30;
                                    v22 = v21;
                                    v17 = v16;
                                    v10 = v24;
                                    v11 = v19;
                                    if (v29 == 0) {
                                        goto lab_0x80495ee;
                                    } else {
                                        char v39 = *(char *)v29; // 0x80495d1
                                        v12 = v39;
                                        v20 = v19;
                                        v18 = v29;
                                        v14 = v23;
                                        v22 = v21;
                                        v17 = v16;
                                        v10 = v24;
                                        v11 = v19;
                                        if (v39 == 0) {
                                            goto lab_0x80495ee;
                                        } else {
                                            goto lab_0x80495d7;
                                        }
                                    }
                                }
                                goto lab_0x804959a;
                            }
                        }
                    }
                    default: {
                        goto lab_0x80495a3;
                    }
                }
            }
          lab_0x80495a3:
            // 0x80495a3
            v33 = v23 | (int32_t)v35;
            v34 = v36;
          lab_0x80495a3_2:
            // 0x80495a3
            v26 = v34;
            v25 = v33;
            *(char *)v19 = (char)v25;
            v27 = v19 + 1;
        }
      lab_0x80495db_3:
        // 0x80495db
        *v3 = v30;
        *(int32_t *)(v2 - 8) = v28;
        *v4 = v21;
        *(int32_t *)(v2 - 16) = v29;
        *(int32_t *)(v2 - 20) = v2;
        *v5 = v16;
        *v6 = v24;
        *v7 = v19;
        itoa_printB();
        *(char *)v19 = 0;
        int32_t v40 = *v7;
        int32_t v41 = v40 + 1; // 0x80495eb
        v14 = *v3;
        v22 = *v4;
        v17 = *v5;
        v10 = *v6;
        v11 = v40;
        while (*(char *)v40 != 0) {
            // 0x80495e7
            v40 = v41;
            v41 = v40 + 1;
            v14 = *v3;
            v22 = *v4;
            v17 = *v5;
            v10 = *v6;
            v11 = v40;
        }
        goto lab_0x80495ee;
    }
  lab_0x80495f3:
    // 0x80495f3
    *(char *)v19 = 0;
    int32_t result = v19 - v1; // 0x80495f9
    *(int32_t *)(v2 + 32) = result;
    return result;
  lab_0x80495ee:
    // 0x80495ee
    v13 = v14;
    v9 = v22 + 4;
    v15 = v17;
    goto lab_0x804959a_2;
  lab_0x80495d7:
    // 0x80495d7
    *(char *)v20 = v12;
    int32_t v42 = v20 + 1; // 0x80495d7
    int32_t v43 = v18 + 1; // 0x80495d8
    char v44 = *(char *)v43; // 0x80495d1
    v12 = v44;
    v20 = v42;
    v18 = v43;
    v14 = v23;
    v22 = v21;
    v17 = v16;
    v10 = v24;
    v11 = v42;
    if (v44 == 0) {
        goto lab_0x80495ee;
    } else {
        goto lab_0x80495d7;
    }
}

// Address range: 0x8049600 - 0x8049644
int32_t printf(char * a1) {
    // 0x8049600
    int32_t result; // 0x8049600
    sprintf(result, result);
    __asm_int(128);
    return result;
}

// Address range: 0x804968a - 0x80496fb
int32_t strtol(char * a1, int32_t * a2, int32_t a3) {
    // 0x804968a
    int32_t v1; // 0x804968a
    __get_GOT(v1);
    char v2 = *(char *)*(int32_t *)(v1 + 0x2964); // 0x80496a4
    int32_t v3 = v2 != 0 ? v1 : a3;
    int32_t v4 = v2 != 0 ? v1 : (int32_t)a1; // 0x80496bf
    while (*(char *)v4 == 32) {
        // 0x80496c1
        v4++;
    }
    int16_t v5 = *(int16_t *)v4; // 0x80496c9
    int32_t result = 0; // 0x80496ef
    int32_t v6 = 0;
    int32_t v7 = v5 != 0x7830 ? v4 : v4 + 2; // 0x80496f1
    unsigned char v8 = *(char *)v7; // 0x80496d6
    while (v8 >= 48) {
        int32_t v9 = v6 & -256; // 0x80496d6
        unsigned char v10 = v8 - 48; // 0x80496d8
        int32_t v11 = v9 | (int32_t)v10; // 0x80496d8
        int32_t v12 = v11; // 0x80496e0
        if (v10 >= 10) {
            uint32_t v13 = v11 + 249; // 0x80496e2
            v12 = v13 % 256 | v9;
            if ((char)v13 >= 36) {
                // 0x80496ea
                v12 = v9 | (int32_t)(v8 - 87);
            }
        }
        // 0x80496ed
        v6 = v12;
        result = v6 + result * (v5 != 0x7830 ? v3 != 0 ? v3 : 10 : 16);
        v7++;
        if (v7 == (v2 != 0 ? v1 : (int32_t)a2)) {
            // break -> 0x80496f6
            break;
        }
        v8 = *(char *)v7;
    }
    // 0x80496f6
    return result;
}

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: gcc (11.2.1)
// Detected functions: 13

