// subject_bss.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

Eq_2 g_t804C00C = // 0804C00C
	{
		null,
		null,
		null,
	};
up32 g_dw804C010 = 0x00; // 0804C010
Eq_11 g_t804C014 = // 0804C014
	{
		0x00
	};
// subject_got.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

struct Eq_2 * g_ptr804BFF4 = &g_t804C00C; // 0804BFF4
up32 * g_ptr804BFF8 = &g_dw804C010; // 0804BFF8
union Eq_11 * g_ptr804BFFC = &g_t804C014; // 0804BFFC
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 08049000: void main(Register (ptr32 Eq_2) ebx, Register (ptr32 Eq_3) ebp)
// Called from:
//      fn08049250
void main(struct Eq_2 * ebx, struct Eq_3 * ebp)
{
}

// 08049250: void fn08049250(Register (ptr32 Eq_445) edi, Stack (ptr32 word32) dwArg00)
void fn08049250(union Eq_445 * edi, word32 * dwArg00)
{
	__start_main(edi, &g_t8049000, dwArg00);
}

// 080492A3: void fn080492A3(Stack (ptr32 Eq_292) dwArg00)
// Called from:
//      open
//      close
//      read
//      write
//      lseek
//      chmod
//      chown
//      pipe
//      link
//      symlink
//      unlink
//      mkdir
//      rmdir
//      exit
//      fork
//      execve
//      uname
//      ioctl
//      alarm
//      nanosleep
//      kill
//      signal
//      wait4
//      fstat
//      lstat
//      getuid
//      getgid
void fn080492A3(struct Eq_292 * dwArg00)
{
	ci8 al_31 = dwArg00->b0000;
	if (al_31 != 0x00 && (al_31 < 0x00 || g_ptr804BFFC->u0 == 0x00))
		;
	up32 eax_61 = (word32) dwArg00->b0001;
	__syscall<byte>(0x80);
	if (eax_61 >= ~0x0FFE)
		*g_ptr804BFF8 = -eax_61;
}

// 08049327: void open(Register (ptr32 word32) ecx, Register (ptr16 Eq_327) es)
void open(word32 * ecx, struct Eq_327 * es)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	++*ecx;
	struct Eq_340 * esp_5 = (struct Eq_340 *) <invalid>;
	esp_5->ptrFFFFFFFE = es;
	read();
}

// 0804932E: void close(Register word32 eax, Register (ptr32 word32) esi)
void close(word32 eax, word32 * esi)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	*esi += eax;
	read();
}

// 08049335: void read()
// Called from:
//      main
//      open
//      close
void read()
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	write();
}

// 0804933C: void write()
// Called from:
//      main
//      read
void write()
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
}

// 08049343: void lseek(Register byte cl, Register word24 ecx_24_8, Register (ptr32 byte) edi)
void lseek(byte cl, word24 ecx_24_8, byte * edi)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	chmod(cl, ecx_24_8, edi);
}

// 0804934A: void chmod(Register byte cl, Register word24 ecx_24_8, Register (ptr32 byte) edi)
// Called from:
//      lseek
void chmod(byte cl, word24 ecx_24_8, byte * edi)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	word32 * ecx_16 = SEQ(ecx_24_8, cl + *edi);
	chown(ecx_16);
}

// 08049351: void chown(Register (ptr32 word32) ecx)
// Called from:
//      chmod
void chown(word32 * ecx)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	fn0804935C(ecx);
}

// 08049358: void pipe(Register (ptr32 word32) ecx)
void pipe(word32 * ecx)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	fn0804935C(ecx);
}

// 0804935C: void fn0804935C(Register (ptr32 word32) ecx)
// Called from:
//      chown
//      pipe
void fn0804935C(word32 * ecx)
{
	++*ecx;
	fn08049360();
}

// 0804935F: void link()
// Called from:
//      pipe
void link()
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	fn08049360();
}

// 08049360: void fn08049360()
// Called from:
//      fn0804935C
//      link
void fn08049360()
{
}

// 08049366: void symlink()
// Called from:
//      link
void symlink()
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	fn0804936E();
}

// 0804936D: void unlink()
void unlink()
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	fn0804936E();
}

// 0804936E: void fn0804936E()
// Called from:
//      symlink
//      unlink
void fn0804936E()
{
}

// 08049374: void mkdir(Register (ptr32 word32) eax, Register (ptr32 word32) ecx, Register (ptr32 Eq_436) edx, Register word32 ebp, Register (ptr32 Eq_445) edi)
// Called from:
//      unlink
void mkdir(word32 * eax, word32 * ecx, struct Eq_436 * edx, word32 ebp, union Eq_445 * edi)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	struct Eq_340 * esp_5 = (struct Eq_340 *) <invalid>;
	edi->u1 = esp_5 + edi->u1 / 8;
	rmdir(eax, ecx, edx, ebp, edi);
}

// 0804937B: void rmdir(Register (ptr32 word32) eax, Register (ptr32 word32) ecx, Register (ptr32 Eq_436) edx, Register word32 ebp, Register (ptr32 Eq_445) edi)
// Called from:
//      mkdir
void rmdir(word32 * eax, word32 * ecx, struct Eq_436 * edx, word32 ebp, union Eq_445 * edi)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	*eax += ebp;
	exit(eax, ecx, edx, edi);
}

// 08049382: void exit(Register (ptr32 word32) eax, Register (ptr32 word32) ecx, Register (ptr32 Eq_436) edx, Register (ptr32 Eq_445) edi)
// Called from:
//      fn08049250
//      rmdir
void exit(word32 * eax, word32 * ecx, struct Eq_436 * edx, union Eq_445 * edi)
{
	struct Eq_292 * dwLoc04;
	byte al_17 = (byte) eax;
	fn080492A3(dwLoc04);
	*ecx = eax + *ecx;
	fork(al_17, edx, edi);
}

// 08049389: void fork(Register byte al, Register (ptr32 Eq_436) edx, Register (ptr32 Eq_445) edi)
// Called from:
//      exit
void fork(byte al, struct Eq_436 * edx, union Eq_445 * edi)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	edx->b0000 += al;
	execve(edx, edi);
}

// 08049390: void execve(Register (ptr32 Eq_436) edx, Register (ptr32 Eq_445) edi)
// Called from:
//      fork
void execve(struct Eq_436 * edx, union Eq_445 * edi)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	uname(edx, edi);
}

// 08049397: void uname(Register (ptr32 Eq_436) edx, Register (ptr32 Eq_445) edi)
// Called from:
//      execve
void uname(struct Eq_436 * edx, union Eq_445 * edi)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	edx->dwFFFFFFE8 = &edi->u0 + edx->dwFFFFFFE8;
	fn0804939F();
}

// 0804939E: void ioctl()
void ioctl()
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	fn0804939F();
}

// 0804939F: void fn0804939F()
// Called from:
//      uname
//      ioctl
void fn0804939F()
{
}

// 080493A5: void alarm(Register (ptr32 word32) edx, Register (ptr32 word32) ebx)
// Called from:
//      ioctl
void alarm(word32 * edx, word32 * ebx)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	*ebx = ebx + *ebx;
	nanosleep(edx);
}

// 080493AC: void nanosleep(Register (ptr32 word32) edx)
// Called from:
//      alarm
void nanosleep(word32 * edx)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	fn080493B7(edx);
}

// 080493B3: void kill(Register (ptr32 word32) edx)
void kill(word32 * edx)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	fn080493B7(edx);
}

// 080493B7: void fn080493B7(Register (ptr32 word32) edx)
// Called from:
//      nanosleep
//      kill
void fn080493B7(word32 * edx)
{
	++*edx;
	fn080493BE(edx);
}

// 080493BA: void signal(Register (ptr32 word32) edx)
void signal(word32 * edx)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	fn080493BE(edx);
}

// 080493BE: void fn080493BE(Register (ptr32 word32) edx)
// Called from:
//      kill
//      fn080493B7
//      signal
void fn080493BE(word32 * edx)
{
	++*edx;
	fn080493C2();
}

// 080493C1: void wait4()
// Called from:
//      signal
void wait4()
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	fn080493C2();
}

// 080493C2: void fn080493C2()
// Called from:
//      fn080493BE
//      wait4
void fn080493C2()
{
}

// 080493C8: void fstat()
// Called from:
//      wait4
void fstat()
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	fn080493D1();
}

// 080493CF: void lstat()
void lstat()
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	fn080493D1();
}

// 080493D1: void fn080493D1()
// Called from:
//      fstat
//      lstat
void fn080493D1()
{
}

// 080493D6: void getuid(Register (ptr32 byte) eax, Register byte ch, Register byte bl, Register (ptr32 Eq_445) edi)
void getuid(byte * eax, byte ch, byte bl, union Eq_445 * edi)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	fn080493D7(eax, ch, bl, edi);
}

// 080493D7: void fn080493D7(Register (ptr32 byte) eax, Register byte ch, Register byte bl, Register (ptr32 Eq_445) edi)
// Called from:
//      lstat
//      getuid
void fn080493D7(byte * eax, byte ch, byte bl, union Eq_445 * edi)
{
	*eax += bl;
	getgid(ch, edi);
}

// 080493DD: void getgid(Register byte ch, Register (ptr32 Eq_445) edi)
// Called from:
//      getuid
//      fn080493D7
void getgid(byte ch, union Eq_445 * edi)
{
	struct Eq_292 * dwLoc04;
	fn080492A3(dwLoc04);
	edi->u0 = (byte) (edi->u0 + ch);
	struct Eq_340 * esp_5 = (struct Eq_340 *) <invalid>;
	__start_main(edi, esp_5->ptr0000, esp_5->ptr0004);
}

// 080493E4: void __start_main(Register (ptr32 Eq_445) edi, Stack (ptr32 Eq_3) dwArg00, Stack (ptr32 word32) dwArg04)
// Called from:
//      fn08049250
//      getgid
void __start_main(union Eq_445 * edi, struct Eq_3 * dwArg00, word32 * dwArg04)
{
	ptr32 fp;
	word32 * ecx_9 = fp + 0x0C + dwArg04 * 0x04;
	struct Eq_2 * ebx_13 = g_ptr804BFF4;
	ebx_13->ptr0000 = ecx_9;
	main(ebx_13, dwArg00);
	exit(dwArg04, ecx_9, fp + 8, edi);
}

// 0804940A: void _fastcall(Register Eq_11 eax)
// Called from:
//      main
//      fn08049250
void _fastcall(Eq_11 eax)
{
	g_ptr804BFFC->u1 = (word32) eax;
}

// 08049420: void memset(Register Eq_16 eax, Register int32 ecx, Register byte dl, Stack Eq_16 dwArg04, Stack Eq_16 bArg08, Stack int32 dwArg0C)
// Called from:
//      main
void memset(Eq_16 eax, int32 ecx, byte dl, Eq_16 dwArg04, Eq_16 bArg08, int32 dwArg0C)
{
	word32 edx;
	word32 dwArg08;
	Eq_16 edx_14 = eax;
	byte al_54 = (byte) edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		edx_14 = dwArg04;
		al_54 = (byte) dwArg08;
		ecx = dwArg0C;
	}
	Eq_16 edi_36 = edx_14;
	for (; ecx != 0x00; --ecx)
	{
		*edi_36.u1 = al_54;
		edi_36.u1 = (word32) edi_36 + 1;
	}
}

// 08049453: void memcpy(Register (ptr32 Eq_699) eax, Register uint32 ecx, Register (ptr32 Eq_701) edx, Stack (ptr32 Eq_699) dwArg04, Stack (ptr32 Eq_701) dwArg08, Stack uint32 dwArg0C)
// Called from:
//      main
void memcpy(<unknown>* eax, uint32 ecx, <unknown> * edx, <unknown>* dwArg04, <unknown>* dwArg08, uint32 dwArg0C)
{
	<unknown>* edi_28 = eax;
	<unknown>* esi_29 = edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		edi_28 = dwArg04;
		esi_29 = dwArg08;
		ecx = dwArg0C;
	}
	memcpy(edi_28, esi_29, ecx);
}

// 08049481: void memcmp(Register uint32 ecx, Register (ptr32 Eq_720) esi, Register (ptr32 Eq_721) edi, Stack (ptr32 Eq_720) dwArg04, Stack (ptr32 Eq_721) dwArg08, Stack uint32 dwArg0C)
void memcmp(uint32 ecx, <unknown> * esi, <unknown>* edi, <unknown>* dwArg04, <unknown>* dwArg08, uint32 dwArg0C)
{
	if (g_ptr804BFFC->u0 == 0x00)
	{
		esi = dwArg04;
		edi = dwArg08;
		ecx = dwArg0C;
	}
	memcmp(esi, edi, ecx) == 0x00;
}

// 080494B6: Register Eq_16 getenv(Register Eq_16 eax, Stack Eq_16 dwArg04)
// Called from:
//      main
Eq_16 getenv(Eq_16 eax, Eq_16 dwArg04)
{
	Eq_16 edi_28 = eax;
	if (g_ptr804BFFC->u0 == 0x00)
		edi_28 = dwArg04;
	word32 * ebx_43 = g_ptr804BFF4->ptr0000;
	uint32 ecx_54 = strlen(edi_28) - ~0x00;
	while (true)
	{
		Eq_16 edi_64 = *ebx_43;
		if (edi_64 == 0x00)
			break;
		int32 cmpResult_69 = memcmp(edi_28, edi_64, ecx_54 - 0x01);
		ptr32 edi_73 = edi_64.u1 + __find_first_difference__(edi_28, edi_64);
		if (cmpResult_69 == 0x00)
		{
			edi_64 = edi_73 + 0x01;
			return edi_64;
		}
		++ebx_43;
	}
	return edi_64;
}

// 08049511: void strlen(Register ptr32 eax, Stack ptr32 dwArg04)
void strlen(ptr32 eax, ptr32 dwArg04)
{
	if (g_ptr804BFFC->u0 == 0x00)
		eax = dwArg04;
	int32 eax_21 = 0x00;
	do
	{
		eax_21 = eax_51 + 0x01;
		eax_51 = eax_21;
	} while (*((word32) eax + eax_51) >= 0x01);
}

// 0804953C: void itoa(Register (ptr32 byte) eax, Register uint32 ecx, Register (ptr32 char) edx, Stack (ptr32 byte) dwArg04, Stack (ptr32 char) dwArg08, Stack uint32 dwArg0C)
void itoa(byte * eax, uint32 ecx, char * edx, byte * dwArg04, char * dwArg08, uint32 dwArg0C)
{
	char * edi_28 = edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		eax = dwArg04;
		edi_28 = dwArg08;
		ecx = dwArg0C;
	}
	*fn0804956D(eax, ecx, edi_28) = 0x00;
}

// 0804956D: Register (ptr32 char) fn0804956D(Register (ptr32 byte) eax, Register uint32 ecx, Register (ptr32 char) edi)
// Called from:
//      itoa
//      fn0804956D
//      sprintf
char * fn0804956D(byte * eax, uint32 ecx, char * edi)
{
	uint64 edx_eax_6 = (uint64) eax;
	uint32 edx_9 = (uint32) (edx_eax_6 % ecx);
	byte dl_23 = (byte) edx_9;
	byte * eax_10 = (uint32) (edx_eax_6 /u ecx);
	if (eax_10 != null)
	{
		fn0804956D(eax_10, ecx, edi);
		dl_23 = (byte) edx_9;
	}
	ci8 dl_26 = dl_23 + 0x30;
	if (dl_26 > 0x39)
		dl_26 += 0x27;
	*edi = dl_26;
	return edi + 1;
}

// 0804958B: Register ptr32 sprintf(Stack (ptr32 char) dwArg04, Stack Eq_16 dwArg08)
// Called from:
//      printf
ptr32 sprintf(char * dwArg04, Eq_16 dwArg08)
{
	ptr32 fp;
	word32 * edx_181 = fp + 0x0C;
	Eq_16 esi_192 = dwArg08;
	char * edi_161 = dwArg04;
	while (true)
	{
		byte al_188 = *esi_296.u1;
		esi_192.u1 = (word32) esi_296 + 1;
		if (al_188 == 0x00)
			break;
		if (al_188 == 0x25)
		{
			byte * ebx_171 = *edx_181;
			al_188 = *esi_192.u1;
			esi_192.u1 = (word32) esi_192 + 1;
			uint32 ecx_110 = 0x0A;
			if (al_188 != 100)
			{
				ecx_110 = 0x10;
				if (al_188 == 0x78)
					goto l080495DB;
				ecx_110 = 0x08;
				if (al_188 == 111)
					goto l080495DB;
				ecx_110 = 0x02;
				if (al_188 == 0x62)
					goto l080495DB;
				if (al_188 == 99)
					goto l080495A3;
				esi_296 = esi_192;
				if (al_188 != 115)
					continue;
				if (ebx_171 != null)
				{
					while (true)
					{
						byte al_173 = *ebx_171;
						if (al_173 == 0x00)
							break;
						*edi_161 = al_173;
						++edi_161;
						++ebx_171;
					}
				}
			}
			else
			{
l080495DB:
				*fn0804956D(ebx_171, ecx_110, edi_161) = 0x00;
				char * edi_140 = edi_161;
				do
				{
					edi_140 = edi_297 + 1;
					edi_297 = edi_140;
				} while (*edi_297 >= 0x01);
				edi_161 = edi_140 - 0x01;
			}
			esi_192.u1 = (word32) esi_296 + 2;
			++edx_181;
			continue;
		}
l080495A3:
		*edi_161 = al_188;
		++edi_161;
	}
	*edi_161 = 0x00;
	return edi_161 + 1 - dwArg04 - 0x01;
}

// 08049600: void printf(Stack Eq_16 dwArg04)
// Called from:
//      main
void printf(Eq_16 dwArg04)
{
	char bLoc1000;
	sys_write(0x01, &bLoc1000, sprintf(&bLoc1000, dwArg04));
}

// 0804968A: Register Eq_16 strtol(Register Eq_16 eax, Register int32 ecx, Register Eq_16 edx, Stack Eq_16 dwArg04, Stack Eq_16 dwArg08, Stack int32 dwArg0C, Register out Eq_16 edxOut)
// Called from:
//      main
Eq_16 strtol(Eq_16 eax, int32 ecx, Eq_16 edx, Eq_16 dwArg04, Eq_16 dwArg08, int32 dwArg0C, union Eq_16 & edxOut)
{
	Eq_16 edi_104 = eax;
	Eq_16 esi_119 = edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		edi_104 = dwArg04;
		esi_119 = dwArg08;
		ecx = dwArg0C;
	}
	if (ecx == 0x00)
		ecx = 0x0A;
	Eq_16 eax_156 = 0x00;
	word24 ebx_24_8_115 = 0x00;
	while (*edi_104.u1 == 0x20)
		edi_104.u1 = (word32) edi_104 + 1;
	if (edi_104.u2->t0000.u1 == 0x7830)
	{
		ecx = 0x10;
		edi_104.u1 = (word32) edi_104 + 2;
	}
	do
	{
		Eq_989 bl_62 = *edi_104.u1;
		if (bl_62 < 0x30)
			break;
		word32 ebx_79 = SEQ(ebx_24_8_115, bl_62 - 0x30);
		if (bl_62 > 0x39)
		{
			ebx_79 = SEQ(ebx_24_8_115, bl_62 - 55);
			if (bl_62 > 0x5A)
				ebx_79 = SEQ(ebx_24_8_115, bl_62 - 0x57);
		}
		int64 edx_eax_77 = ecx *s64 eax_156;
		ebx_24_8_115 = SLICE(ebx_79, word24, 8);
		edx.u1 = SLICE(edx_eax_77, word32, 32);
		eax_156 = (word32) edx_eax_77 + ebx_79;
		edi_104.u1 = (word32) edi_104 + 1;
	} while (edi_104 != esi_119);
	edxOut = edx;
	return eax_156;
}

