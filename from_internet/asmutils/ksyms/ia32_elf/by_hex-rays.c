/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __cdecl __noreturn start(int, _WORD *, _BYTE *);
// void __usercall sub_80480F1(_BYTE *a1@<esi>);
// char __usercall sub_8048214@<al>(unsigned int@<eax>, unsigned int@<ecx>, char *@<edi>);
// int __usercall sub_804822C@<eax>(unsigned int@<eax>, unsigned int@<ecx>, char *@<edi>);
// size_t __usercall sub_804824A@<eax>(_BYTE *@<esi>);

//-------------------------------------------------------------------------
// Data declarations

char aHackersKsymsV0[22] = "hackers' ksyms v 0.1\n"; // weak
char aAddressSymbolD[56] = "Address   Symbol                            Defined by\n"; // weak
char asc_80482BF[2] = "\n"; // weak
char asc_80482C1[2] = " "; // weak
char asc_80482C3[3] = "  "; // weak
char asc_80482C6[2] = "["; // weak
char asc_80482C8[2] = "]"; // weak
__int16 word_80482CA; // weak
__int16 word_80682CA; // weak
__int16 word_80882CA; // weak
size_t dword_80A82CA; // idb


//----- (0804804C) --------------------------------------------------------
void __cdecl __noreturn start(int a1, _WORD *a2, _BYTE *a3)
{
  __int16 *v3; // esi
  int v4; // eax
  int v5; // ecx
  int v6; // eax
  void *retaddr; // [esp+4h] [ebp+4h]

  if ( (char)retaddr < 2 )
    goto LABEL_9;
  if ( *a2 == 22061 )
  {
    sub_804824A(aHackersKsymsV0);
    goto LABEL_14;
  }
  if ( *a2 != 26669 )
    sub_804824A(aAddressSymbolD);
  if ( *a2 == 28461 )
  {
    if ( (char)retaddr >= 3 )
    {
      sub_80480F1(a3);
      goto LABEL_14;
    }
  }
  else
  {
LABEL_9:
    __asm { int     80h; LINUX - sys_query_module }
    v3 = &word_80482CA;
    do
    {
      sub_80480F1(v3);
      v3 = (__int16 *)((char *)v3 + strlen((const char *)v3) + 1);
    }
    while ( v5 != 1 );
    if ( (char)retaddr < 2 )
LABEL_15:
      v6 = sys_exit(v4);
    if ( *a2 != 24877 )
    {
LABEL_14:
      v4 = 0;
      goto LABEL_15;
    }
  }
  sub_80480F1(0);
  goto LABEL_14;
}
// 80480CF: variable 'v5' is possibly undefined
// 80480EF: variable 'v4' is possibly undefined
// 80482CA: using guessed type __int16 word_80482CA;

//----- (080480F1) --------------------------------------------------------
void __usercall sub_80480F1(_BYTE *a1@<esi>)
{
  size_t v1; // ecx
  int v2; // eax
  size_t v3; // eax
  int v4; // ecx
  size_t v5; // [esp-24h] [ebp-30h]
  unsigned int *v6; // [esp+4h] [ebp-8h]

  __asm { int     80h; LINUX - sys_query_module }
  v1 = dword_80A82CA;
  v6 = (unsigned int *)&word_80882CA;
  do
  {
    v5 = v1;
    sub_8048214(*v6, 0x10u, (char *)&word_80682CA);
    v2 = sys_write(1, &word_80682CA, 8u);
    sub_804824A(asc_80482C3);
    v3 = sub_804824A((_BYTE *)&word_80882CA + v6[1]);
    if ( a1 )
    {
      if ( v3 < 0x20 )
      {
        do
          sub_804824A(asc_80482C1);
        while ( v4 != 1 );
      }
      sub_804824A(asc_80482C3);
      sub_804824A(asc_80482C6);
      sub_804824A(a1);
      sub_804824A(asc_80482C8);
    }
    sub_804824A(asc_80482BF);
    v6 += 2;
    v1 = v5 - 1;
  }
  while ( v5 != 1 );
}
// 80480F1: could not find valid save-restore pair for esi
// 80481CC: variable 'v4' is possibly undefined
// 80682CA: using guessed type __int16 word_80682CA;
// 80882CA: using guessed type __int16 word_80882CA;

//----- (08048214) --------------------------------------------------------
char __usercall sub_8048214@<al>(unsigned int a1@<eax>, unsigned int a2@<ecx>, char *a3@<edi>)
{
  char result; // al
  char *v4; // edi
  char v5; // cl
  char v6; // [esp+0h] [ebp-4h]

  sub_804822C(a1, a2, a3);
  result = 9;
  *a3 = 9;
  v4 = a3 + 1;
  if ( v5 == 16 && (unsigned __int8)(v6 - (_BYTE)v4) > 0xF9u )
    *v4 = 9;
  return result;
}
// 8048221: variable 'v5' is possibly undefined
// 8048223: variable 'v6' is possibly undefined

//----- (0804822C) --------------------------------------------------------
int __usercall sub_804822C@<eax>(unsigned int a1@<eax>, unsigned int a2@<ecx>, char *a3@<edi>)
{
  int result; // eax
  char v4; // dl
  unsigned int v5; // et2
  char v6; // dl
  char v7; // [esp-4h] [ebp-4h]

  v5 = a1 % a2;
  result = a1 / a2;
  v4 = v5;
  if ( result )
  {
    v7 = v4;
    result = sub_804822C(result, a2, a3);
    v4 = v7;
  }
  v6 = v4 + 48;
  if ( v6 > 57 )
    v6 += 39;
  *a3 = v6;
  return result;
}

//----- (0804824A) --------------------------------------------------------
size_t __usercall sub_804824A@<eax>(_BYTE *a1@<esi>)
{
  size_t i; // ecx
  const void *v3; // esi
  int v4; // eax
  size_t result; // eax
  _BYTE *v6; // [esp-8h] [ebp-8h]
  size_t v7; // [esp-8h] [ebp-8h]

  if ( a1 )
  {
    v6 = a1;
    for ( i = 0; *a1++; ++i )
      ;
    v3 = v6;
    v7 = i;
    v4 = sys_write(1, v3, i);
    return v7;
  }
  return result;
}

// nfuncs=5 queued=5 decompiled=5 lumina nreq=0 worse=0 better=0
// ALL OK, 5 function(s) have been successfully decompiled
