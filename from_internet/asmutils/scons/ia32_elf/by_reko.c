// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

char g_b804804C = '\r'; // 0804804C
int32 g_t804804E() = ??/* Unexpected function type (fn int32 ()) */ ; // 0804804E
// 08048067: void fn08048067(Register Eq_2 edx, Stack word32 dwArg00, Stack (ptr32 char) dwArg08)
void fn08048067(Eq_2 edx, word32 dwArg00, char * dwArg08)
{
	ptr32 fp;
	word32 dwLoc04;
	if (dwArg00 == 0x01)
	{
		sys_write(0x01, &g_b80481CA, 0x22);
		sys_exit(0x02);
	}
	else
	{
		sys_signal(0x03, &g_t804804E);
		Eq_30 eax_51 = sys_open(dwArg08, 0x0102, edx);
		if (eax_51 < 0x00)
		{
			sys_write(0x01, &g_b80481EC, 0x1C);
			sys_exit(0x01);
		}
		else
		{
			g_t804826C.u0 = (int32) eax_51;
			sys_ioctl(eax_51, 0x5401, fp + 0x0C);
			sys_ioctl(g_t804826C.u0, 0x5402, fp + 0x0C);
			sys_ioctl(0x00, 0x5401, 0x08048270);
			sys_ioctl(0x00, 0x5401, fp + 0x0C);
			byte * edi_116 = fp + 29;
			word32 ecx_117;
			for (ecx_117 = 0x13; ecx_117 != 0x00; --ecx_117)
			{
				*edi_116 = 0x00;
				++edi_116;
			}
			sys_ioctl(0x00, 0x5402, fp + 0x0C);
			sys_write(g_t804826C.u0, &g_b804804C, 0x02);
			dwLoc04 = g_t804826C.u0;
			while (true)
			{
				sys_poll(&dwLoc04, 0x02, 100000);
				sys_write(g_t804826C.u0, &g_b8048208, sys_read(0x00, &g_b8048208, 100));
			}
		}
	}
}

char g_b80481CA = '$'; // 080481CA
char g_b80481EC = 'E'; // 080481EC
char g_b8048208 = '\0'; // 08048208
Eq_30 g_t804826C = // 0804826C
	{
		0
	};
