/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn sub_804804C(); // weak
// void __usercall __noreturn start(mode_t@<edx>, int, int, int, __int128);

//-------------------------------------------------------------------------
// Data declarations

__int16 word_80481CA = 16420; // weak
int dword_80481EC[7] =
{
  1869771333,
  1886330994,
  1852403301,
  1702043751,
  1818323314,
  1986356256,
  174416745
}; // weak
int dword_8048208[25]; // weak
int fd; // idb


//----- (0804804C) --------------------------------------------------------
void __noreturn sub_804804C()
{
  int v0; // eax
  int v1; // eax

  v0 = sys_ioctl(0, 21506);
  v1 = sys_exit(66);
}
// 804804C: using guessed type void __noreturn sub_804804C();

//----- (08048067) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn start(mode_t a1@<edx>, int a2, int a3, int a4, __int128 a5)
{
  int v5; // eax
  int v6; // eax
  int v7; // eax
  int v8; // eax
  int v9; // eax
  int v10; // eax
  int v11; // eax
  size_t v12; // eax
  int v13; // eax
  int v14; // eax
  int v15; // eax
  int v16; // eax
  int v17; // eax
  int v18; // [esp-Ch] [ebp-Ch]
  char *v19; // [esp-4h] [ebp-4h]

  if ( v18 != 1 )
  {
    __asm { int     80h; LINUX - sys_signal }
    v5 = sys_open(v19, 258, a1);
    if ( v5 >= 0 )
    {
      fd = v5;
      v6 = sys_ioctl(v5, 21505);
      v7 = sys_ioctl(fd, 21506);
      v8 = sys_ioctl(0, 21505);
      v9 = sys_ioctl(0, 21505);
      memset((char *)&a5 + 1, 0, 0x13u);
      BYTE2(a5) = 28;
      v10 = sys_ioctl(0, 21506);
      v11 = sys_write(fd, sub_804804C, 2u);
      while ( 1 )
      {
        __asm { int     80h; LINUX - sys_poll }
        v12 = sys_read(0, dword_8048208, 0x64u);
        v13 = sys_write(fd, dword_8048208, v12);
      }
    }
    v14 = sys_write(1, dword_80481EC, 0x1Cu);
    v15 = sys_exit(1);
  }
  v16 = sys_write(1, &word_80481CA, 0x22u);
  v17 = sys_exit(2);
}
// 8048071: positive sp value C has been found
// 8048141: conditional instruction was optimized away because %0x8.4==1
// 804814B: conditional instruction was optimized away because %0x10.4==1
// 8048069: variable 'v18' is possibly undefined
// 8048088: variable 'v19' is possibly undefined
// 804804C: using guessed type void __noreturn sub_804804C();
// 80481CA: using guessed type __int16 word_80481CA;
// 80481EC: using guessed type int dword_80481EC[7];
// 8048208: using guessed type int dword_8048208[25];

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
