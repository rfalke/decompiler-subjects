// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Stack int32 dwArg00, Stack (ptr32 word16) dwArg08)
void fn0804804C(int32 dwArg00, word16 * dwArg08)
{
	if (dwArg00 >= 0x02)
	{
		word32 ebp_11 = 0x00;
		struct Eq_16 * esp_13 = fp + 0x0C;
		if (*dwArg08 == 29229)
			ebp_11 = 0x01;
		else
			esp_13 = fp + 8;
		while (true)
		{
			word32 edi_22 = esp_13->dw0000;
			++esp_13;
			if (edi_22 == 0x00)
				break;
			if (!fn08048177())
			{
				if (ebp_11 != 0x00)
				{
					esp_13->dwFFFFFFFC = edi_22;
					ebp_11 = fn08048094();
					esp_13->dwFFFFFFFC = 0x28;
					__syscall(0x80);
				}
			}
			else
			{
				esp_13->dwFFFFFFFC = 0x0A;
				__syscall(0x80);
			}
		}
	}
	__syscall(0x80);
	if (fn08048177())
		fn08048140();
	else
		fn080480AB(fp + 4366);
}

// 08048094: Register word32 fn08048094()
// Called from:
//      fn0804804C
//      fn080480AB
word32 fn08048094()
{
	if (fn08048177())
		return fn08048140();
	return fn080480AB(fp - 4);
}

// 080480AB: Register (ptr32 Eq_41) fn080480AB(Register (ptr32 Eq_41) ebp)
// Called from:
//      fn0804804C
//      fn08048094
struct Eq_41 * fn080480AB(struct Eq_41 * ebp)
{
	__syscall(0x80);
	ebp->dwFFFFFFFC = 0x05;
	while (true)
	{
		__syscall(0x80);
		struct Eq_86 * edi_156 = ebp - 0x010E;
		uip32 ecx_159;
		for (ecx_159 = 141; ecx_159 != 0x00; ecx_159 -= eax_155)
		{
			struct Eq_91 * edx_55 = &edi_156->w0008 + 1;
			if (edx_55->a0000[0] != 0x2E || edx_55[1] != 0x00 && edx_55[1] != 0x2E)
			{
				fn08048148(edx_55, ebp->ptr0008, (char *) ebp - 4366);
				if (!fn08048177())
				{
					fn08048094();
					__syscall(0x80);
				}
				else
					__syscall(0x80);
			}
			Eq_123 eax_155 = (uint32) edi_156->w0008;
			edi_156 += eax_155;
		}
	}
}

// 08048140: Register word32 fn08048140()
// Called from:
//      fn0804804C
//      fn08048094
//      fn080480AB
word32 fn08048140()
{
	return dwArg110E;
}

// 08048148: void fn08048148(Register (ptr32 Eq_91) edx, Register (ptr32 Eq_91) esi, Register (ptr32 Eq_91) edi)
// Called from:
//      fn0804804C
void fn08048148(struct Eq_91 * edx, struct Eq_91 * esi, struct Eq_91 * edi)
{
	fn080481AE(esi, edi);
	fn0804815C(edi);
	fn080481BB(edx, edi);
}

// 0804815C: void fn0804815C(Register (ptr32 Eq_91) edi)
// Called from:
//      fn08048148
void fn0804815C(struct Eq_91 * edi)
{
	int32 edx_11 = fn0804819E(edi);
	if (edi[edx_11 - 0x01] != 0x2F)
		edi[edx_11] = (struct Eq_91) 0x2F;
}

// 08048177: FlagGroup bool fn08048177()
// Called from:
//      fn0804804C
//      fn08048094
bool fn08048177()
{
	__syscall(0x80);
	bool Z_82 = SLICE(cond(((word32) g_w80481DB & 0x4000) - 0x4000), bool, 2);
	return Z_82;
}

// 0804819E: Register word32 fn0804819E(Register (ptr32 Eq_91) esi)
// Called from:
//      fn0804815C
//      fn080481AE
//      fn080481BB
word32 fn0804819E(struct Eq_91 * esi)
{
	word32 edx_12 = ~0x00;
	do
	{
		++edx_12;
		esi = esi_34 + 1;
		esi_34 = esi;
	} while (esi_34->a0000[0] != 0x00);
	return edx_12;
}

// 080481AE: void fn080481AE(Register (ptr32 Eq_91) esi, Register (ptr32 Eq_91) edi)
// Called from:
//      fn08048148
void fn080481AE(struct Eq_91 * esi, struct Eq_91 * edi)
{
	word32 ecx_34;
	for (ecx_34 = fn0804819E(esi) + 0x01; ecx_34 != 0x00; --ecx_34)
	{
		edi->a0000[0] = esi->a0000[0];
		++esi;
		++edi;
	}
}

// 080481BB: void fn080481BB(Register (ptr32 Eq_91) esi, Register (ptr32 Eq_91) edi)
// Called from:
//      fn08048148
void fn080481BB(struct Eq_91 * esi, struct Eq_91 * edi)
{
	byte * edi_38 = edi + fn0804819E(edi);
	struct Eq_91 * esi_37 = esi;
	word32 ecx_47;
	for (ecx_47 = fn0804819E(esi) + 0x01; ecx_47 != 0x00; --ecx_47)
	{
		*edi_38 = esi_37->a0000[0];
		++esi_37;
		++edi_38;
	}
}

word16 g_w80481DB = 0x00; // 080481DB
