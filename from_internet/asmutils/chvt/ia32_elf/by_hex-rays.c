/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall sub_804804C@<eax>(_BYTE *@<esi>);
// int __usercall sub_8048068@<eax>(mode_t@<edx>, char *@<ebx>);
void __fastcall start(int, mode_t);


//----- (0804804C) --------------------------------------------------------
int __usercall sub_804804C@<eax>(_BYTE *a1@<esi>)
{
  int result; // eax
  int v2; // ecx

  result = 0;
  v2 = 0;
  while ( 1 )
  {
    LOBYTE(v2) = *a1 - 48;
    if ( *a1 < 0x30u || (unsigned __int8)v2 > 9u )
      break;
    LOWORD(result) = 10 * result;
    result += v2;
    ++a1;
  }
  return result;
}

//----- (08048068) --------------------------------------------------------
int __usercall sub_8048068@<eax>(mode_t a1@<edx>, char *a2@<ebx>)
{
  int v2; // eax
  int v4; // eax

  v2 = sys_open(a2, 0, a1);
  if ( v2 < 0 )
    v4 = sys_exit(1);
  return sys_ioctl(v2, 19251);
}

//----- (0804808E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall start(int a1, mode_t a2)
{
  const char *v2; // ebx
  mode_t v3; // edx
  char v4; // zf
  int v5; // eax
  int v6; // eax
  int v7; // eax
  int v8; // eax
  int v9; // [esp-Ch] [ebp-Ch]
  const char *v10; // [esp-8h] [ebp-8h]
  _BYTE *v11; // [esp-4h] [ebp-4h]

  v2 = "/dev/tty0";
  sub_8048068(a2, "/dev/tty0");
  if ( v4 || (v2 = "/dev/console", sub_8048068(v3, "/dev/console"), v4) )
  {
    if ( *(_DWORD *)&v10[strlen(v10) - 4] != 1953917027 )
    {
      if ( v9 == 1 )
        goto LABEL_11;
      while ( v11 )
      {
        sub_804804C(v11);
LABEL_11:
        v8 = sys_ioctl((int)v2, 22024);
      }
LABEL_7:
      v7 = sys_exit(0);
    }
    if ( v9 == 2 )
    {
      if ( v11 )
      {
        sub_804804C(v11);
        v5 = sys_ioctl((int)v2, 22022);
        v6 = sys_ioctl((int)v2, 22023);
      }
      goto LABEL_7;
    }
  }
  JUMPOUT(0x8048086);
}
// 80480BE: positive sp value C has been found
// 80480A4: control flows out of bounds to 8048086
// 8048098: variable 'v4' is possibly undefined
// 804809F: variable 'v3' is possibly undefined
// 80480AD: variable 'v10' is possibly undefined
// 80480BB: variable 'v9' is possibly undefined
// 80480C0: variable 'v11' is possibly undefined

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
