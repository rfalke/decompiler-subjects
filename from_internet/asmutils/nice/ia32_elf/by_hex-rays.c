/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall sub_804804C@<eax>(_BYTE *@<esi>);
void __cdecl __noreturn start();


//----- (0804804C) --------------------------------------------------------
int __usercall sub_804804C@<eax>(_BYTE *a1@<esi>)
{
  int v1; // eax
  int v2; // edx

  v1 = 0;
  v2 = 0;
  do
    LOBYTE(v1) = *a1++;
  while ( (char)v1 <= 33 );
  while ( (char)v1 > 47 )
  {
    if ( (char)v1 > 58 )
      break;
    LOBYTE(v1) = v1 - 48;
    v2 += v1;
    LOBYTE(v1) = *a1++;
    if ( (char)v1 <= 47 || (char)v1 > 58 )
      break;
    v2 *= 10;
  }
  return v2;
}

//----- (08048072) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __cdecl __noreturn start()
{
  const char **v0; // ebp
  char *v1; // esi
  int v2; // eax
  int v3; // eax
  int i; // ecx
  const char *v5; // esi
  int v6; // eax
  _BYTE *v7; // esi
  char v8; // al
  const char *v9; // esi
  unsigned int j; // ecx
  _BYTE *v11; // edi
  char v12; // al
  const char *v13; // esi
  _BYTE *v14; // edi
  char v15; // al
  unsigned int v16; // edi
  int v17; // eax
  int v18; // eax
  int v19; // [esp-10h] [ebp-10h]
  _BYTE *v20; // [esp-8h] [ebp-8h] BYREF
  const char *v21; // [esp-4h] [ebp-4h]
  const char *retaddr; // [esp+0h] [ebp+0h] BYREF

  v0 = (const char **)&(&v20)[v19];
  if ( v19 != 1 )
  {
    v1 = v20 + 1;
    if ( *v20 == 45 )
    {
      if ( *v1 == 110 )
        v1 = (char *)v21;
      v2 = sub_804804C(v1);
    }
    else
    {
      v2 = 10;
    }
    v3 = sys_setpriority(0, 0, v2);
    for ( i = 0; ; ++i )
    {
      v5 = v0[i];
      if ( !v5 )
        break;
      v6 = *(_DWORD *)v5;
      v7 = v5 + 4;
      if ( v6 == 1213481296 )
      {
        v8 = *v7;
        v9 = v7 + 1;
        if ( v8 == 61 )
        {
          for ( j = ~(strlen(v9) + 1) + ~(strlen(retaddr) + 1); ; j = v16 )
          {
            v11 = (char *)&retaddr + j;
            do
            {
              v12 = *v9++;
              if ( v12 == 58 )
                break;
              *v11++ = v12;
            }
            while ( v12 );
            v21 = v9;
            v13 = retaddr;
            *v11 = 47;
            v14 = v11 + 1;
            do
            {
              v15 = *v13++;
              *v14++ = v15;
            }
            while ( v15 );
            v16 = j;
            v9 = v21;
            v17 = sys_execve((const char *)&retaddr + j, &retaddr, v0);
          }
        }
      }
    }
  }
  v18 = sys_exit(127);
}
// 8048094: positive sp value 10 has been found
// 8048073: variable 'v19' is possibly undefined

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
