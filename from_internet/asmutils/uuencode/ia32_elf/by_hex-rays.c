/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start(); // weak
// char __usercall sub_804831C@<al>(unsigned int@<edx>, char *@<ebx>, _BYTE *@<edi>);
// __int16 __usercall sub_8048340@<ax>(__int16 result@<ax>, _DWORD *@<edi>);
// void __usercall sub_8048368(int@<esi>);
// void __usercall sub_8048374(int a1@<edi>, char *a2@<esi>);
// char __usercall sub_8048388@<al>(_BYTE *@<edi>, char *@<esi>);

//-------------------------------------------------------------------------
// Data declarations

char byte_804843B = '`'; // weak
char aAbcdefghijklmn[127] = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/Usage: uuencode [-m] [infile] header\nuuencode: unable to open "; // weak
char aNoSuchFileOrDi[29] = ": no such file or directory\n"; // weak
char byte_8048517 = 'u'; // weak
int status; // idb
int dword_804854C; // weak
size_t len; // idb
int dword_8048554; // weak
int dword_8048558; // weak
int fd; // idb
int dword_8048560[2048]; // weak
int dword_804A560[2825]; // weak
struct stat buf; // idb
int dword_804D9C4[512]; // weak


//----- (0804804C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn start()
{
  unsigned int v0; // eax
  char *v1; // ebx
  char *v2; // edi
  int v3; // eax
  _WORD *v4; // edi
  int v5; // eax
  _BYTE *v6; // edi
  int v7; // edx
  int v8; // eax
  size_t v9; // ebx
  int v10; // eax
  unsigned int *v11; // esi
  int *v12; // edi
  unsigned int v13; // edx
  char v15; // al
  unsigned __int32 v16; // eax
  unsigned __int32 v17; // ecx
  _BYTE *v19; // edi
  int v21; // eax
  __int16 v22; // cx
  _BYTE *v24; // edi
  char *v26; // edi
  char v29; // cl
  _BYTE *v31; // edi
  _WORD *v32; // edi
  int v35; // eax
  int v36; // eax
  int v37; // eax
  int v38; // eax
  int v39; // eax
  int v40; // eax
  size_t v41; // edx
  int v42; // eax
  int v43; // edx
  int v44; // eax
  int v45; // eax
  int v46; // [esp-14h] [ebp-14h]
  char *v47; // [esp-Ch] [ebp-Ch]
  char *v48; // [esp-8h] [ebp-8h]
  char *v49; // [esp-4h] [ebp-4h]

  dword_804D9C4[0] = 1768383842;
  LOBYTE(dword_804D9C4[1]) = 110;
  if ( v46 >= 2 )
  {
    v0 = v46 - 1;
    v1 = v47;
    if ( *(_WORD *)v47 == 27949 )
    {
      dword_804854C = (int)aAbcdefghijklmn;
      strcpy((char *)&dword_804D9C4[1] + 1, "-base64 ");
      v2 = (char *)&dword_804D9C4[3] + 1;
      v1 = v48;
      v0 = v46 - 2;
    }
    else
    {
      dword_804854C = (int)&byte_804843B;
      *(_WORD *)((char *)&dword_804D9C4[1] + 1) = 32;
      v2 = (char *)&dword_804D9C4[1] + 2;
    }
    if ( v0 <= 2 )
    {
      if ( v0 >= 2 )
      {
        v3 = sys_newstat(v1, &buf);
        if ( v3 )
        {
          status = -v3;
          sub_8048388(&buf.st_mtim, v1);
          sub_8048374(134533572, aNoSuchFileOrDi);
          sub_8048368(134533572);
          v42 = sys_write(2, &buf.st_mtim, v41);
          goto LABEL_44;
        }
        sub_8048340(buf.__pad1 & 0x1FF, v2);
        v4 = v2 + 3;
        *v4 = 32;
        sub_8048374((int)v4 - 1, v49);
        v5 = sys_open(v1, 0, 0);
        if ( v5 < 0 )
        {
          status = -v5;
          sub_8048388(&buf.st_mtim, &aAbcdefghijklmn[101]);
          sub_8048374(134533572, v1);
          sub_8048368(134533572);
          *(_WORD *)(v43 + 134533572) = 10;
          v44 = sys_write(2, &buf.st_mtim, v43 + 1);
          goto LABEL_44;
        }
        fd = v5;
        goto LABEL_12;
      }
      if ( v0 == 1 )
      {
        *(_DWORD *)v2 = 540292150;
        v6 = v2 + 4;
        *v6 = 0;
        sub_8048374((int)(v6 - 1), v1);
        fd = 0;
LABEL_12:
        sub_8048368((int)dword_804D9C4);
        *((_BYTE *)dword_804D9C4 + v7) = 10;
        v8 = sys_write(1, dword_804D9C4, v7 + 1);
        do
        {
          len = 8190;
          do
          {
            v9 = 8190;
            if ( !len )
              break;
            v10 = sys_read(fd, (char *)dword_8048560 + 8190 - len, len);
            dword_8048554 = v10;
            if ( v10 < 0 )
            {
              status = -v10;
              v45 = sys_write(2, &byte_8048517, 0x2Fu);
              goto LABEL_44;
            }
            v9 = len - v10;
            len = v9;
          }
          while ( v9 && v10 );
          v11 = (unsigned int *)dword_8048560;
          v12 = dword_804A560;
          v13 = 8190 - v9;
          if ( v9 != 8190 )
          {
            dword_8048558 = 0;
            _EBX = (char *)dword_804854C;
            if ( (char *)dword_804854C != aAbcdefghijklmn )
            {
              v15 = v13;
              if ( v13 >= 0x2D )
                v15 = 45;
              LOBYTE(dword_804A560[0]) = v15 + 32;
              v12 = (int *)((char *)dword_804A560 + 1);
            }
            while ( v13 > 2 )
            {
              if ( dword_8048558 >= 45 )
                sub_804831C(v13, _EBX, v12);
              v16 = _byteswap_ulong(*v11);
              v11 = (unsigned int *)((char *)v11 + 3);
              v17 = v16 >> 8;
              _EAX = ((v16 >> 8) & 0xFC0000) >> 18;
              __asm { xlat }
              *(_BYTE *)v12 = _EAX;
              v19 = (char *)v12 + 1;
              _EAX = (v17 & 0x3F000) >> 12;
              __asm { xlat }
              *v19++ = _EAX;
              LOWORD(_EAX) = (unsigned __int16)(v17 & 0xFC0) >> 6;
              __asm { xlat }
              *v19++ = _EAX;
              LOBYTE(_EAX) = v17 & 0x3F;
              __asm { xlat }
              *v19 = _EAX;
              v12 = (int *)(v19 + 1);
              v13 -= 3;
              dword_8048558 += 3;
            }
            if ( v13 )
            {
              if ( dword_8048558 >= 45 )
                sub_804831C(v13, _EBX, v12);
              v21 = 0;
              if ( v13 == 1 )
              {
                LOBYTE(v21) = *(_BYTE *)v11;
                v29 = 16 * *(_BYTE *)v11;
                _AX = (unsigned __int16)((16 * v21) & 0xFC0) >> 6;
                __asm { xlat }
                *(_BYTE *)v12 = _AX;
                v31 = (char *)v12 + 1;
                LOBYTE(_AX) = v29 & 0x3F;
                __asm { xlat }
                *v31 = _AX;
                v32 = v31 + 1;
                if ( _EBX == aAbcdefghijklmn )
                {
                  LOBYTE(_AX) = 61;
                }
                else
                {
                  _AL = 0;
                  __asm { xlat }
                }
                HIBYTE(_AX) = _AX;
                *v32 = _AX;
                v12 = (int *)(v32 + 1);
              }
              else
              {
                BYTE1(v21) = *(_WORD *)v11;
                LOBYTE(v21) = HIBYTE(*(_WORD *)v11);
                v22 = 4 * v21;
                _EAX = ((4 * v21) & 0x3F000u) >> 12;
                __asm { xlat }
                *(_BYTE *)v12 = _EAX;
                v24 = (char *)v12 + 1;
                _EAX = (unsigned __int16)(v22 & 0xFC0) >> 6;
                __asm { xlat }
                *v24++ = _EAX;
                LOBYTE(_EAX) = v22 & 0x3F;
                __asm { xlat }
                *v24 = _EAX;
                v26 = v24 + 1;
                if ( _EBX == aAbcdefghijklmn )
                {
                  _AL = 61;
                }
                else
                {
                  _AL = 0;
                  __asm { xlat }
                }
                *v26 = _AL;
                v12 = (int *)(v26 + 1);
              }
            }
          }
          if ( v12 == dword_804A560 )
            break;
          *(_BYTE *)v12 = 10;
          v35 = sys_write(1, dword_804A560, (char *)v12 + 1 - (char *)dword_804A560);
        }
        while ( dword_8048554 );
        if ( (char *)dword_804854C == &byte_804843B )
        {
          LOWORD(dword_804A560[0]) = 2656;
          *(int *)((char *)dword_804A560 + 2) = 174354021;
          v36 = sys_write(1, dword_804A560, 6u);
        }
        else
        {
          dword_804A560[0] = 1027423549;
          LOBYTE(dword_804A560[1]) = 10;
          v37 = sys_write(1, dword_804A560, 5u);
        }
LABEL_44:
        v38 = sys_close(fd);
        v39 = sys_exit(status);
      }
    }
  }
  v40 = sys_write(2, &aAbcdefghijklmn[64], 0x25u);
  goto LABEL_44;
}
// 80480AF: positive sp value 14 has been found
// 8048063: variable 'v46' is possibly undefined
// 804806A: variable 'v47' is possibly undefined
// 804808F: variable 'v48' is possibly undefined
// 80480DA: variable 'v49' is possibly undefined
// 8048129: variable 'v7' is possibly undefined
// 804820C: variable 'v13' is possibly undefined
// 80483D9: variable 'v41' is possibly undefined
// 8048404: variable 'v43' is possibly undefined
// 804804C: using guessed type void __noreturn start();
// 804843B: using guessed type char byte_804843B;
// 8048517: using guessed type char byte_8048517;
// 804854C: using guessed type int dword_804854C;
// 8048554: using guessed type int dword_8048554;
// 8048558: using guessed type int dword_8048558;
// 8048560: using guessed type int dword_8048560[2048];
// 804A560: using guessed type int dword_804A560[2825];
// 804D9C4: using guessed type int dword_804D9C4[512];

//----- (0804831C) --------------------------------------------------------
char __usercall sub_804831C@<al>(unsigned int a1@<edx>, char *a2@<ebx>, _BYTE *a3@<edi>)
{
  char result; // al
  _BYTE *v4; // edi
  char v5; // al

  result = 10;
  *a3 = 10;
  v4 = a3 + 1;
  if ( a2 != aAbcdefghijklmn )
  {
    if ( a1 < 0x2D )
      v5 = a1;
    else
      v5 = 45;
    result = v5 + 32;
    *v4 = result;
  }
  dword_8048558 = 0;
  return result;
}
// 8048558: using guessed type int dword_8048558;

//----- (08048340) --------------------------------------------------------
__int16 __usercall sub_8048340@<ax>(__int16 result@<ax>, _DWORD *a2@<edi>)
{
  int v2; // ebx

  v2 = (result & 0x1C0) << 10;
  BYTE1(v2) = (unsigned __int8)(result & 0x38) >> 3;
  LOBYTE(v2) = result & 7;
  *a2 = _byteswap_ulong((v2 << 8) | 0x30303000);
  return result;
}

//----- (08048368) --------------------------------------------------------
void __usercall sub_8048368(int a1@<esi>)
{
  _BYTE *v1; // edx

  v1 = (_BYTE *)(a1 - 1);
  do
    ++v1;
  while ( *v1 );
}

//----- (08048374) --------------------------------------------------------
void __usercall sub_8048374(int a1@<edi>, char *a2@<esi>)
{
  int v2; // edx
  _BYTE *v3; // edi
  char v4; // al

  sub_8048368(a1);
  v3 = (_BYTE *)(v2 + a1);
  do
  {
    v4 = *a2++;
    *v3++ = v4;
  }
  while ( v4 );
}
// 8048374: could not find valid save-restore pair for edi
// 8048374: could not find valid save-restore pair for esi
// 804837E: variable 'v2' is possibly undefined

//----- (08048388) --------------------------------------------------------
char __usercall sub_8048388@<al>(_BYTE *a1@<edi>, char *a2@<esi>)
{
  char result; // al

  do
  {
    result = *a2++;
    *a1++ = result;
  }
  while ( result );
  return result;
}

// nfuncs=6 queued=6 decompiled=6 lumina nreq=0 worse=0 better=0
// ALL OK, 6 function(s) have been successfully decompiled
