/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __fastcall __noreturn start(int, mode_t);
// void __usercall sub_804809D(int@<ecx>, char *@<esi>);
// _BOOL4 __usercall sub_80482CF@<eax>(unsigned int@<ecx>, const void *@<edi>, const void *@<esi>);
// size_t __usercall sub_80482DF@<eax>(_BYTE *@<esi>);

//-------------------------------------------------------------------------
// Data declarations

char filename[] = "/proc/bus/usb/devices"; // idb
char aBusportdevSpee[51] = "BusPortDev Speed   Ver [Manufacturer]Name{driver}\n"; // weak
char byte_8048349[3] = { 'S', ':', ' ' }; // weak
__int16 word_804835A = 14931; // weak
__int16 word_8048366 = 14921; // weak
int dword_8048370[2] = { 538982980, 1030907222 }; // weak
char aTBusError[14] = "T:  Bus=error"; // weak
char asc_8048387[2] = "\n"; // weak
char asc_8048389[2] = "."; // weak
char asc_804838B[2] = " "; // weak
__int16 asc_8048390[4] = { 91, 93, 123, 125 }; // weak
char aMb[3] = "Mb"; // weak
char byte_804839B; // weak
char byte_808839B; // weak


//----- (0804804C) --------------------------------------------------------
void __fastcall __noreturn start(int a1, mode_t a2)
{
  int v2; // eax
  char v3; // zf
  int v4; // eax
  int v5; // ecx
  int v6; // eax
  int fd; // [esp+0h] [ebp-4h]

  v2 = sys_open(filename, 0, a2);
  if ( v2 >= 0 )
  {
    fd = v2;
    v2 = sys_read(v2, &byte_804839B, 0x40000u);
    if ( !v3 )
    {
      v4 = sys_close(fd);
      sub_80482DF(aBusportdevSpee);
      sub_804809D(v5, &byte_804839B);
    }
  }
  v6 = sys_exit(v2);
}
// 8048076: variable 'v3' is possibly undefined
// 8048091: variable 'v5' is possibly undefined
// 804809B: variable 'v2' is possibly undefined
// 804839B: using guessed type char byte_804839B;

//----- (0804809D) --------------------------------------------------------
void __usercall sub_804809D(int a1@<ecx>, char *a2@<esi>)
{
  int v2; // ecx
  char *v3; // esi
  char *v4; // edi
  char v5; // al
  char *v6; // esi
  char v7; // al
  char *v8; // esi
  char v9; // al
  char *v10; // esi
  char v11; // al
  char v12; // al
  char *v13; // esi
  char v14; // al
  int v15; // ecx
  char *v16; // esi
  char v17; // al
  int v18; // ecx
  char *v19; // esi
  char v20; // al
  char *v21; // esi
  char *v22; // esi
  char v23; // al
  char *v24; // esi
  char *v25; // esi
  char v26; // al
  char *v27; // esi
  char *v28; // [esp-4h] [ebp-10h]
  _BYTE *v29; // [esp-4h] [ebp-10h]
  _BYTE *v30; // [esp-4h] [ebp-10h]
  _BYTE *v31; // [esp-4h] [ebp-10h]
  int v32; // [esp+0h] [ebp-Ch]

  v32 = 0;
  while ( 1 )
  {
    v2 = a1;
    if ( !a1 )
      break;
    v3 = a2;
    v4 = &byte_808839B;
    do
    {
      v5 = *v3++;
      *v4++ = v5;
      if ( v5 == 10 )
        break;
      --v2;
    }
    while ( v2 );
    *v4 = 0;
    a2 = v3;
    a1 = v2;
    if ( sub_80482CF(8u, aTBusError, v3) )
    {
      if ( sub_80482CF(9u, dword_8048370, v3) )
      {
        if ( sub_80482CF(0x11u, byte_8048349, v3) )
        {
          if ( sub_80482CF(0xCu, &word_804835A, v3) )
          {
            if ( !sub_80482CF(0xAu, &word_8048366, v3) )
            {
              v25 = v3 + 62;
              do
                v26 = *v25++;
              while ( v26 != 10 );
              v27 = v25 - 1;
              *v27 = 0;
              sub_80482DF(&asc_8048390[2]);
              sub_80482DF(a2 + 62);
              *v27 = 10;
              sub_80482DF(&asc_8048390[3]);
              sub_80482DF(asc_8048387);
            }
          }
          else
          {
            v22 = v3 + 12;
            do
              v23 = *v22++;
            while ( v23 != 10 );
            v24 = v22 - 1;
            *v24 = 0;
            sub_80482DF(a2 + 12);
            *v24 = 10;
          }
        }
        else
        {
          v19 = v3 + 17;
          do
            v20 = *v19++;
          while ( v20 != 10 );
          v21 = v19 - 1;
          *v21 = 0;
          sub_80482DF(asc_8048390);
          sub_80482DF(a2 + 17);
          *v21 = 10;
          sub_80482DF(&asc_8048390[1]);
        }
      }
      else
      {
        v16 = v3 + 9;
        do
          v17 = *v16++;
        while ( v17 != 32 );
        *(v16 - 1) = 0;
        if ( !v32 )
        {
          do
            sub_80482DF(asc_804838B);
          while ( v18 != 1 );
        }
        sub_80482DF(a2 + 9);
        sub_80482DF(asc_804838B);
      }
    }
    else
    {
      v32 = 1;
      v6 = v3 + 8;
      v28 = v6;
      do
        v7 = *v6++;
      while ( v7 != 32 );
      *(v6 - 1) = 0;
      sub_80482DF(v28);
      sub_80482DF(asc_8048389);
      v8 = v28 + 23;
      v29 = v28 + 23;
      do
        v9 = *v8++;
      while ( v9 != 32 );
      *(v8 - 1) = 0;
      sub_80482DF(v29);
      sub_80482DF(asc_8048389);
      v10 = v29 + 15;
      v30 = v29 + 15;
      do
        v11 = *v10++;
      while ( v11 == 32 );
      do
        v12 = *v10++;
      while ( v12 != 32 );
      *(v10 - 1) = 0;
      sub_80482DF(v30);
      sub_80482DF(asc_8048390);
      v13 = v30 + 8;
      v31 = v30 + 8;
      do
        v14 = *v13++;
      while ( v14 != 32 );
      *(v13 - 1) = 0;
      if ( (int)(4 - sub_80482DF(v31)) > 0 )
      {
        do
          sub_80482DF(asc_804838B);
        while ( v15 != 1 );
      }
      sub_80482DF(aMb);
      sub_80482DF(&asc_8048390[1]);
      sub_80482DF(asc_804838B);
    }
  }
}
// 8048181: variable 'v15' is possibly undefined
// 80481E3: variable 'v18' is possibly undefined
// 804835A: using guessed type __int16 word_804835A;
// 8048366: using guessed type __int16 word_8048366;
// 8048370: using guessed type int dword_8048370[2];
// 8048390: using guessed type __int16 asc_8048390[4];
// 808839B: using guessed type char byte_808839B;

//----- (080482CF) --------------------------------------------------------
_BOOL4 __usercall sub_80482CF@<eax>(unsigned int a1@<ecx>, const void *a2@<edi>, const void *a3@<esi>)
{
  return memcmp(a3, a2, a1) != 0;
}

//----- (080482DF) --------------------------------------------------------
size_t __usercall sub_80482DF@<eax>(_BYTE *a1@<esi>)
{
  size_t i; // ecx
  const void *v3; // esi
  int v4; // eax
  size_t result; // eax
  _BYTE *v6; // [esp-8h] [ebp-8h]
  size_t v7; // [esp-8h] [ebp-8h]

  if ( a1 )
  {
    v6 = a1;
    for ( i = 0; *a1++; ++i )
      ;
    v3 = v6;
    v7 = i;
    v4 = sys_write(1, v3, i);
    return v7;
  }
  return result;
}

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
