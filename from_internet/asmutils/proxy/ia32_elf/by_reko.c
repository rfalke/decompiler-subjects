// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804805C: void fn0804805C(Register (ptr32 byte) esi, Stack word32 dwArg00, Stack (ptr32 byte) dwArg08, Stack (ptr32 byte) dwArg0C, Stack (ptr32 byte) dwArg10)
void fn0804805C(byte * esi, word32 dwArg00, byte * dwArg08, byte * dwArg0C, byte * dwArg10)
{
	struct Eq_7 * esp_118 = fp + 4;
	if (dwArg00 == 0x04)
	{
		word32 esi_377;
		word32 ebx_13 = fn080480E5(dwArg08, out esi_377);
		g_dw8048211 = fn080480D1(dwArg0C);
		word32 ebx_35 = fn080480E5(dwArg10, out esi);
		g_dw804820D = SEQ(SLICE(SEQ(SLICE(ebx_35, word16, 16), (byte) ebx_35, SLICE(ebx_35, byte, 8)) << 0x10, word24, 8), 0x02);
		g_dw80481FD = SEQ(SLICE(SEQ(SLICE(ebx_13, word16, 16), (byte) ebx_13, SLICE(ebx_13, byte, 8)) << 0x10, word24, 8), 0x02);
		__syscall(0x80);
		__syscall(0x80);
		__syscall(0x80);
		esp_118 = fp + 0x14;
	}
	esp_118->dwFFFFFFFC = 0x01;
	__syscall(0x80);
	fn080480D1(esi);
}

// 080480D1: Register word32 fn080480D1(Register (ptr32 byte) esi)
// Called from:
//      fn0804805C
word32 fn080480D1(byte * esi)
{
	word24 edx_24_8_17 = 0x00;
	word32 ecx_22;
	for (ecx_22 = 0x04; ecx_22 != 0x00; --ecx_22)
	{
		word32 edx_20 = __ror<word32,byte>(SEQ(edx_24_8_17, (byte) fn080480E5(esi, out esi)), 0x08);
		edx_24_8_17 = SLICE(edx_20, word24, 8);
	}
	return edx_20;
}

// 080480E5: Register Eq_97 fn080480E5(Register (ptr32 byte) esi, Register out (ptr32 byte) esiOut)
// Called from:
//      fn0804805C
//      fn080480D1
Eq_97 fn080480E5(byte * esi, byte & esiOut)
{
	Eq_97 ebx_16 = 0x00;
	while (true)
	{
		cu8 al_9 = *esi;
		++esi;
		if (al_9 < 0x30)
			break;
		uint32 eax_19 = (uint32) (al_9 - 0x30);
		if (al_9 > 0x39)
			break;
		ebx_16 = ebx_16 *s 0x0A + eax_19;
	}
	esiOut = esi;
	return ebx_16;
}

word32 g_dw80481FD = 0x00; // 080481FD
word32 g_dw804820D = 0x00; // 0804820D
word32 g_dw8048211 = 0x00; // 08048211
