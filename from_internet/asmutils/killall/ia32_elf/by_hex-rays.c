/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall sub_804804C@<eax>(_BYTE *@<esi>);
int start();
void sub_8048367();
int sub_8048380();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_80480AE; // weak
_UNKNOWN loc_804833F; // weak
_UNKNOWN loc_80483AF; // weak
char aUnknownOptionR[94] = "Unknown option: Really kill Killing of process failed\nSuccessfully killed a process\n(y/n)\nHUP"; // weak
int status; // idb
int dword_80484E3; // weak
int dword_80484E7; // weak
int dword_80484EB; // weak
int sig; // idb
char addr[256]; // idb


//----- (0804804C) --------------------------------------------------------
int __usercall sub_804804C@<eax>(_BYTE *a1@<esi>)
{
  int v1; // eax
  int v2; // edx

  v1 = 0;
  v2 = 0;
  do
    LOBYTE(v1) = *a1++;
  while ( (char)v1 <= 33 );
  while ( (char)v1 > 47 )
  {
    if ( (char)v1 > 58 )
      break;
    LOBYTE(v1) = v1 - 48;
    v2 += v1;
    LOBYTE(v1) = *a1++;
    if ( (char)v1 <= 47 || (char)v1 > 58 )
      break;
    v2 *= 10;
  }
  return v2;
}

//----- (0804807A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int start()
{
  const char *v0; // edi
  void (*v1)(); // ebp
  int v2; // ecx
  char *v3; // esi
  char v4; // al
  char *v5; // esi
  int v6; // eax
  char *v7; // esi
  int v8; // eax
  int v9; // eax
  int v10; // eax
  const char *v12; // [esp-8h] [ebp-8h]
  _BYTE *v13; // [esp-4h] [ebp-4h]

  sig = 15;
  v0 = &v12[strlen(v12) + 1];
  if ( *(_DWORD *)(v0 - 5) == 1718576233 )
  {
    LOBYTE(status) = 1;
    v1 = sub_8048367;
  }
  else if ( *(v0 - 2) == 53 )
  {
    v1 = (void (*)())&loc_804833F;
  }
  else
  {
    v1 = (void (*)())&loc_80480AE;
  }
  while ( v13 )
  {
    v2 = 0;
    v3 = v13 + 1;
    if ( *v13 != 45 )
      break;
    v4 = *v3;
    if ( *v3 == 45 )
      break;
    if ( v4 <= 57 )
      goto LABEL_32;
    if ( v4 != 101 )
    {
      switch ( v4 )
      {
        case 'g':
          v2 = 1;
LABEL_25:
          ++v2;
LABEL_26:
          ++v2;
LABEL_27:
          ++v2;
LABEL_28:
          ++v2;
LABEL_29:
          ++v2;
LABEL_30:
          ++v2;
          goto LABEL_31;
        case 'i':
          goto LABEL_25;
        case 'l':
LABEL_32:
          __debugbreak();
          __debugbreak();
          return ((int (*)(void))v1)();
        case 'q':
          goto LABEL_26;
        case 'v':
          goto LABEL_27;
        case 'V':
          goto LABEL_28;
      }
      if ( v4 != 119 )
      {
        if ( v4 == 115 )
          goto LABEL_29;
        if ( v4 == 120 )
          goto LABEL_30;
        if ( v4 != 111 )
        {
          v5 = &aUnknownOptionR[90];
          do
          {
            v6 = *(_DWORD *)v5;
            v7 = v5 + 4;
            if ( !v6 )
            {
              v8 = sys_write(1, aUnknownOptionR, 0x10u);
              v13[2] = 10;
              v9 = sys_write(1, v13 - 1, 4u);
              v10 = sys_exit(1);
            }
            v5 = v7 + 1;
          }
          while ( v6 != *(_DWORD *)(v13 + 1) );
          LOBYTE(sig) = *(v5 - 1);
          return ((int (*)(void))v1)();
        }
LABEL_31:
        _bittestandset(&dword_80484E3, v2 + 1);
      }
    }
  }
  return ((int (*)(void))v1)();
}
// 804825A: positive sp value C has been found
// 804807A: could not find valid save-restore pair for ebx
// 804808B: variable 'v12' is possibly undefined
// 804825C: variable 'v13' is possibly undefined
// 80484E3: using guessed type int dword_80484E3;

//----- (08048367) --------------------------------------------------------
void sub_8048367()
{
  dword_80484E7 = (int)sub_8048380;
  dword_80484EB = (int)&loc_80483AF;
  JUMPOUT(0x8048183);
}
// 804837B: control flows out of bounds to 8048183
// 80484E7: using guessed type int dword_80484E7;
// 80484EB: using guessed type int dword_80484EB;

//----- (08048380) --------------------------------------------------------
int sub_8048380()
{
  char *v0; // edi
  int v1; // ecx
  bool v2; // zf
  int result; // eax
  int v4; // eax
  int v5; // eax

  v0 = addr;
  v1 = -1;
  do
  {
    if ( !v1 )
      break;
    v2 = *v0++ == 32;
    --v1;
  }
  while ( !v2 );
  result = sys_write(1, addr, ~v1);
  LOBYTE(status) = 0;
  if ( _bittest(&dword_80484E3, 3u) )
  {
    v4 = sys_write(1, &aUnknownOptionR[89], 1u);
    v5 = sys_exit(status);
  }
  return result;
}
// 80484E3: using guessed type int dword_80484E3;

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
