// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804807A: void fn0804807A(Register Eq_2 edx, Stack (ptr32 char) dwArg04)
void fn0804807A(Eq_2 edx, char * dwArg04)
{
	ptr32 fp;
	byte v18;
	g_t80484EF.u1 = 0x0F;
	struct Eq_9 * esp_177 = fp + 8;
	struct Eq_12 * edi_101 = dwArg04 + (strlen(dwArg04) + 1);
	if (edi_101->dwFFFFFFFB != 0x666F6469)
		edi_101->bFFFFFFFE == 0x35;
	else
		g_b80484DF = 0x01;
	while (true)
	{
		struct Eq_33 * esi_26 = esp_177->dw0000;
		++esp_177;
		if (esi_26 == null)
			break;
		if (esi_26->b0000 != 0x2D)
		{
l08048330:
			esp_177 -= 0x04;
			break;
		}
		Eq_48 al_38 = esi_26->t0001.u0;
		if (al_38 == 0x2D)
			goto l08048330;
		if (al_38 <= 0x39)
		{
l0804832E:
			__syscall<byte>(0x03);
			__syscall<byte>(0x03);
			goto l08048330;
		}
		if (al_38 == 101)
			continue;
		if (al_38 != 0x67 && al_38 != 0x69)
		{
			if (al_38 == 0x6C)
				goto l0804832E;
			if (al_38 == 113)
				goto l0804831C;
			if (al_38 == 118)
				goto l0804831D;
			if (al_38 == 0x56)
				goto l0804831E;
			if (al_38 == 0x77)
				continue;
			if (al_38 == 115)
				goto l0804831F;
			if (al_38 == 0x78)
				goto l08048320;
			if (al_38 != 111)
			{
				edi_101 = (struct Eq_12 *) &esi_26->t0001.u0;
				word32 * esi_102 = g_a8048430;
				do
				{
					Eq_48 eax_105 = *esi_102;
					union Eq_6 * esi_106 = esi_102 + 1;
					if (eax_105 == 0x00)
					{
						esp_177->dwFFFFFFFC = 0x01;
						uint32 ebx_117 = esp_177->dwFFFFFFFC;
						esp_177->dwFFFFFFFC = 0x04;
						sys_write(ebx_117, &g_b80483D6, 0x10);
						esi_26->b0002 = 0x0A;
						esp_177->dwFFFFFFFC = 0x04;
						Eq_106 edx_131 = esp_177->dwFFFFFFFC;
						esp_177->dwFFFFFFFC = 0x01;
						uint32 ebx_136 = esp_177->dwFFFFFFFC;
						esp_177->dwFFFFFFFC = 0x04;
						sys_write(ebx_136, esi_26 - 0x01, edx_131);
						esp_177->dwFFFFFFFC = 0x01;
						int32 ebx_145 = esp_177->dwFFFFFFFC;
						esp_177->dwFFFFFFFC = 0x01;
						sys_exit(ebx_145);
					}
					esi_102 = (word32 *) ((char *) esi_106 + 1);
				} while (eax_105 != (esi_26->t0001).u1);
				g_t80484EF.u0 = esi_106->u0;
				break;
			}
		}
		else
		{
l0804831C:
l0804831D:
l0804831E:
l0804831F:
l08048320:
		}
	}
	switch (v18)
	{
	case 0x00:
		g_ptr80484E7 = &g_t80480C7;
		g_ptr80484EB = &g_t80483BF;
		word32 * esp_178 = esp_177 - 4;
		*esp_178 = 0x05;
		Eq_189 eax_195 = sys_open(&g_b80483CA, 0x00010000, edx);
		if (eax_195 < 0x00)
			goto l08048072;
		g_t80484F7.u0 = (int32) eax_195;
		*esp_178 = 0x0C;
		sys_chdir(&g_b80483CA);
		if (edi_101->b0000 == 0x00)
		{
l08048072:
			int32 * esp_222 = esp_177 - 4;
			*esp_222 = 0x02;
			int32 ebx_224 = *esp_222;
			*esp_222 = 0x01;
			sys_exit(ebx_224);
		}
		else
		{
			while (true)
			{
				byte * edi_235 = g_a80484FB;
				word32 ecx_236;
				for (ecx_236 = 0x0600; ecx_236 != 0x00; --ecx_236)
				{
					*edi_235 = 0x00;
					++edi_235;
				}
				Eq_2 edx_247 = 0x0600;
				if (sys_getdents(g_t80484F7.u0, g_a80484FB, 0x0600) == 0x00)
					break;
				struct Eq_263 * ebp_260 = g_a80484FB;
				while (true)
				{
					word16 bp_265 = (word16) ebp_260;
					word16 ebp_16_16_267 = SLICE(ebp_260, word16, 16);
					if (ebp_260->t0008.u0 == 0x00)
						break;
					ebp_260 = SEQ(ebp_16_16_267, bp_265 + (ebp_260->t0008).u1);
					byte * edi_270 = &g_b8048AFB;
					ci8 al_271 = ebp_260->b000A;
					byte * esi_272 = &ebp_260->b000A + 1;
					if (al_271 > 0x30 && al_271 <= 0x39)
					{
						do
						{
							*edi_270 = al_271;
							ci8 al_282 = *esi_272;
							++edi_270;
							++esi_272;
							al_271 = al_282;
						} while (al_282 != 0x00);
						byte * esi_289 = g_a80483D0;
						do
						{
							byte al_292 = *esi_289;
							*edi_270 = al_292;
							++esi_289;
							++edi_270;
						} while (al_292 != 0x00);
						struct Eq_320 * esp_307 = esp_177 - 4;
						esp_307->dw0000 = 0x05;
						Eq_327 eax_314 = sys_open(&g_b8048AFB, 0x00, edx_247);
						if (eax_314 >= 0x00)
						{
							g_t80484F3.u0 = (int32) eax_314;
							esp_307->dw0000 = 0x03;
							sys_read(eax_314, &g_b8048AFB, 0x0100);
							edx_247 = 0x0100;
							byte * esi_336 = &g_b8048AFB;
							do
							{
								esi_336 = esi_423 + 1;
								esi_423 = esi_336;
							} while (*esi_423 != 0x28);
							<unknown>* edi_346 = esp_307->ptr0004;
							memcmp(esi_336, edi_346, ~0x00);
							if ((esi_336 + __find_first_difference__(esi_336, edi_346))[-1] == 0x29)
								g_ptr80484E7();
						}
					}
				}
			}
			g_ptr80484EB();
			return;
		}
	}
}

<anonymous> g_t80480C7 = <code>; // 080480C7
<anonymous> g_t80483BF = <code>; // 080483BF
char g_b80483CA = '/'; // 080483CA
byte g_a80483D0[] = // 080483D0
	{
	};
char g_b80483D6 = 'U'; // 080483D6
Eq_48 g_a8048430[] = // 08048430
	{
	};
byte g_b80484DF = 0x00; // 080484DF
<anonymous> * g_ptr80484E7 = null; // 080484E7
<anonymous> * g_ptr80484EB = null; // 080484EB
Eq_6 g_t80484EF = // 080484EF
	{
		0x00
	};
Eq_327 g_t80484F3 = // 080484F3
	{
		0
	};
Eq_189 g_t80484F7 = // 080484F7
	{
		0
	};
byte g_a80484FB[] = // 080484FB
	{
	};
byte g_b8048AFB = 0x00; // 08048AFB
