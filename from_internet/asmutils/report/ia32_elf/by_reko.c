// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

struct Eq_21 g_t804804C = // 0804804C
	{
		
		{
			0x007D
		},
	};
word32 g_dw8049194 = 0x1F; // 08049194
union Eq_2 g_u80491B6 = // 080491B6
	{
		'r'
	};
// 0804922A: void fn0804922A(Register (ptr32 Eq_2) esi, Stack word32 dwArg00)
void fn0804922A(union Eq_2 * esi, word32 dwArg00)
{
	ptr32 fp;
	int32 ebx_10 = dwArg00 - 0x01;
	if (dwArg00 == 0x01)
		fn08049250(&g_t804804C, esi);
	else
	{
		union Eq_2 * esi_14 = fp + 8;
		uint32 dwArg00_100 = 0x00;
		do
		{
			byte bArg00_104 = (byte) dwArg00_100;
			word24 nArg01_106 = SLICE(dwArg00_100, word24, 8);
			word32 * eax_19 = esi_14->u1.dw0000;
			esi_14 = (union Eq_2 *) ((char *) esi_14 + 4);
			if (eax_19 == null)
			{
				union Eq_2 * esi_25 = esi_14->u2.dwFFFFFFF8;
				Eq_18 ecx_32 = fn08049319(&g_t804804C, esi_25);
				if (dwArg00_100 >> 0x01 < 0x00)
					fn08049265(&g_u80491B6);
				if (dwArg00_100 >> 0x02 < 0x00)
					fn08049250(&g_t804804C, esi_25);
				if (dwArg00_100 >> 0x03 >= 0x00)
				{
					fn080492A1(ecx_32, &g_t804804C, esi_25);
					return;
				}
				else
				{
					word32 edx_68 = g_dw8049194;
					fn080492AD(ecx_32, 134517074, edx_68 + 0x01, esi_25);
					return;
				}
			}
			--ebx_10;
			dwArg00_100 = SEQ(nArg01_106, bArg00_104 | SLICE((uint32) fn080492F1(eax_19, &g_t804804C), byte, 8));
		} while (ebx_10 >= 0x00);
		fn08049250(&g_t804804C, esi_14);
	}
}

// 08049250: void fn08049250(Register (ptr32 Eq_21) ebp, Register (ptr32 Eq_2) esi)
// Called from:
//      fn0804922A
//      fn08049319
void fn08049250(struct Eq_21 * ebp, union Eq_2 * esi)
{
	word32 ebp_11 = fn080492A1(0x00, ebp, esi);
	fn08049265(ebp_11 + 0x1187);
}

// 08049265: void fn08049265(Register (ptr32 Eq_2) ecx)
// Called from:
//      fn0804922A
//      fn08049250
void fn08049265(union Eq_2 * ecx)
{
	fn080492D9(ecx);
	sys_exit(0x00);
}

// 080492A1: Register (ptr32 Eq_21) fn080492A1(Register Eq_18 eax, Register (ptr32 Eq_21) ebp, Register (ptr32 Eq_2) esi)
// Called from:
//      fn0804922A
struct Eq_21 * fn080492A1(Eq_18 eax, struct Eq_21 * ebp, union Eq_2 * esi)
{
	Eq_18 edx_7 = ebp->t0E40.u0;
	return fn080492AD(eax, (char *) ebp + 3398, edx_7, esi);
}

// 080492AD: Register word32 fn080492AD(Register Eq_18 eax, Register ptr32 ecx, Register Eq_18 edx, Register (ptr32 Eq_2) esi)
// Called from:
//      fn0804922A
//      fn080492A1
word32 fn080492AD(Eq_18 eax, ptr32 ecx, Eq_18 edx, union Eq_2 * esi)
{
	if (eax >= 0x00)
		return fn080492B3(eax, ecx, edx, esi);
	return fn080492B1(eax, ecx, edx, esi);
}

// 080492B1: Register word32 fn080492B1(Register Eq_18 eax, Register ptr32 ecx, Register Eq_18 edx, Register (ptr32 Eq_2) esi)
// Called from:
//      fn080492A1
//      fn080492AD
word32 fn080492B1(Eq_18 eax, ptr32 ecx, Eq_18 edx, union Eq_2 * esi)
{
	Eq_18 eax_6 = -eax;
	return fn080492B3(eax_6, ecx, edx, esi);
}

// 080492B3: Register word32 fn080492B3(Register Eq_18 eax, Register ptr32 ecx, Register Eq_18 edx, Register (ptr32 Eq_2) esi)
// Called from:
//      fn080492A1
//      fn080492AD
word32 fn080492B3(Eq_18 eax, ptr32 ecx, Eq_18 edx, union Eq_2 * esi)
{
	if (eax >= edx)
		eax = fn080492D9(esi);
	word16 * ecx_33 = ecx + (int32) (ecx - 2)[eax];
	int32 edx_34 = (int32) *ecx_33;
	fn080492E5((char *) ecx_33 + 3, edx_34 - 0x01);
	return ebp_65;
}

// 080492D9: Register word32 fn080492D9(Register (ptr32 Eq_2) ecx)
// Called from:
//      fn0804922A
//      fn080492A1
word32 fn080492D9(union Eq_2 * ecx)
{
	byte * edx_28 = ecx - 1;
	do
		++edx_28;
	while (*edx_28 != 0x00);
	Eq_162 edx_37 = edx_28 - ecx;
	return fn080492E5(ecx, edx_37);
}

// 080492E5: Register Eq_162 fn080492E5(Register (ptr32 Eq_2) ecx, Register Eq_162 edx)
// Called from:
//      fn080492A1
//      fn080492D9
Eq_162 fn080492E5(union Eq_2 * ecx, Eq_162 edx)
{
	Eq_184 SZO;
	Eq_162 dwArg14;
	if (SZO)
		return dwArg14;
	return fn080492E7(ecx, edx);
}

// 080492E7: Register Eq_162 fn080492E7(Register (ptr32 Eq_2) ecx, Register Eq_162 edx)
// Called from:
//      fn080492D9
//      fn080492E5
Eq_162 fn080492E7(union Eq_2 * ecx, Eq_162 edx)
{
	Eq_162 dwArg14;
	sys_write(0x01, ecx, edx);
	return dwArg14;
}

// 080492F1: Register byte fn080492F1(Register (ptr32 word32) eax, Register (ptr32 Eq_21) ebp)
// Called from:
//      fn0804922A
byte fn080492F1(word32 * eax, struct Eq_21 * ebp)
{
	word32 ebx_11 = *eax;
	word16 bx_68 = (word16) ebx_11;
	byte dh_40 = 0x00;
	uint8 dl_42 = 0x08;
	word16 * esi_17 = (char *) &ebp->t0E40 + 780;
	do
	{
		word32 * esi_21 = esi_17 + 1;
		word16 ax_20 = *esi_17;
		word32 eax_25 = *esi_21;
		esi_17 = (word16 *) (esi_21 + 1);
		word32 edx_103 = SEQ(0x00, dh_40, dl_42);
		if (eax_25 == 0x00)
			return SLICE(edx_103, byte, 8);
		if (bx_68 == ax_20 || ebx_11 == eax_25)
			dh_40 |= dl_42;
		dl_42 >>= 0x01;
		edx_103 = SEQ(0x00, dh_40, dl_42);
	} while (dl_42 != 0x00);
	return SLICE(edx_103, byte, 8);
}

// 08049319: Register uint32 fn08049319(Register (ptr32 Eq_21) ebp, Register (ptr32 Eq_2) esi)
// Called from:
//      fn0804922A
uint32 fn08049319(struct Eq_21 * ebp, union Eq_2 * esi)
{
	uint32 eax_6 = esi->u1.dw0000;
	char al_14 = (byte) eax_6;
	byte ah_21 = SLICE(eax_6, byte, 8);
	uint32 ecx_7 = 0x00;
	if (al_14 == 0x2D)
	{
		esi = (union Eq_2 *) ((char *) esi + 1);
		al_14 = (byte) (eax_6 >> 0x08);
		ah_21 = SLICE(eax_6 >> 0x08, byte, 8);
	}
	if (al_14 == 0x30)
	{
		uint32 ebx_19 = 0x00;
		Eq_265 ch_42 = 0x08;
		byte cl_55 = 0x03;
		if (ah_21 == 0x78)
		{
			esi = (union Eq_2 *) ((char *) esi + 2);
			ch_42.u0 = 0x10;
			cl_55 = 0x04;
		}
		while (true)
		{
			Eq_284 al_32 = esi->u0;
			esi = (union Eq_2 *) ((char *) esi + 1);
			Eq_265 al_34 = al_32 - 0x30;
			if (al_32 < 0x30)
				break;
			if (al_32 >= 0x3A)
			{
				al_34 = al_32 - 55;
				if (al_32 < 55)
					return ebx_19;
				if (al_32 - 55 < ch_42)
					goto l08049374;
				al_34 = al_32 - 0x57;
			}
			if (al_34 >= ch_42)
				return ebx_19;
l08049374:
			ui32 ebx_57 = ebx_19 << cl_55;
			ebx_19 = SEQ(SLICE(ebx_57, word24, 8), (byte) ebx_57 | al_34);
		}
		return ebx_19;
	}
	else if (al_14 < 0x30 || al_14 > 0x39)
		fn08049250(ebp, esi);
	else
	{
		while (true)
		{
			Eq_275 al_76 = esi->u0;
			esi = (union Eq_2 *) ((char *) esi + 1);
			if (al_76 < 0x30)
				break;
			uint32 eax_86 = (uint32) (al_76 - 0x30);
			if (al_76 >= 0x3A)
				return ecx_7;
			ecx_7 = eax_86 + ecx_7 * 0x0A;
		}
		return ecx_7;
	}
}

