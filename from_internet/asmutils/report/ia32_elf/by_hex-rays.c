/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall start(unsigned __int8 *@<esi>, int, char);
// void __usercall sub_80492A1(int@<eax>, int@<ebp>, _BYTE *@<esi>);
void __fastcall sub_80492D9(_BYTE *a1);
// int __usercall sub_80492F1@<eax>(int *@<eax>, int@<ebp>);
// char __usercall sub_8049319@<al>(unsigned __int8 *@<esi>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN unk_804804C; // weak


//----- (0804922A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall start(unsigned __int8 *a1@<esi>, int a2, char a3)
{
  int v3; // ebx
  int *v4; // eax
  char v5; // dh
  _BYTE *v6; // ecx
  int v7; // eax
  int v8; // ecx
  unsigned __int32 v9; // ebx
  char v10; // cf
  unsigned __int32 v11; // ebx
  unsigned __int32 v12; // ebx
  unsigned __int8 *v13; // [esp-8h] [ebp-8h]
  __int32 v14; // [esp-4h] [ebp-4h] BYREF

  v3 = v14 - 1;
  if ( v14 == 1 )
    goto LABEL_5;
  a1 = (unsigned __int8 *)&a2;
  v14 = 0;
  while ( 1 )
  {
    v4 = *(int **)a1;
    a1 += 4;
    if ( !v4 )
      break;
    sub_80492F1(v4, (int)&unk_804804C);
    LOBYTE(v14) = v5 | v14;
    if ( --v3 < 0 )
      goto LABEL_5;
  }
  v13 = (unsigned __int8 *)*((_DWORD *)a1 - 2);
  sub_8049319(v13);
  a1 = v13;
  v9 = _InterlockedExchange(&v14, (__int32)&unk_804804C + 4638);
  v10 = v9 & 1;
  v11 = v9 >> 1;
  if ( v10 )
  {
    v6 = (char *)&unk_804804C + 4458;
LABEL_7:
    sub_80492D9(v6);
    v7 = sys_exit(0);
  }
  v10 = v11 & 1;
  v12 = v11 >> 1;
  if ( v10 )
  {
LABEL_5:
    sub_80492A1(0, (int)&unk_804804C, a1);
    v6 = (char *)&unk_804804C + 4487;
    goto LABEL_7;
  }
  if ( v12 & 1 )
    JUMPOUT(0x80492AD);
  sub_80492A1(v8, (int)&unk_804804C, v13);
}
// 8049237: positive sp value 4 has been found
// 804929F: control flows out of bounds to 80492AD
// 804924A: variable 'v5' is possibly undefined
// 8049290: variable 'v8' is possibly undefined

//----- (080492A1) --------------------------------------------------------
void __usercall sub_80492A1(int a1@<eax>, int a2@<ebp>, _BYTE *a3@<esi>)
{
  if ( a1 < 0 )
    a1 = -a1;
  if ( (unsigned int)a1 >= *(_DWORD *)(a2 + 3648) )
    sub_80492D9(a3);
  JUMPOUT(0x80492E5);
}
// 80492D1: control flows out of bounds to 80492E5

//----- (080492D9) --------------------------------------------------------
void __fastcall sub_80492D9(_BYTE *a1)
{
  _BYTE *v1; // edx
  bool v2; // cc
  size_t v3; // edx
  int v4; // eax

  v1 = a1 - 1;
  do
    ++v1;
  while ( *v1 );
  v2 = (int)v1 <= (int)a1;
  v3 = v1 - a1;
  if ( !v2 )
    v4 = sys_write(1, a1, v3);
}

//----- (080492F1) --------------------------------------------------------
int __usercall sub_80492F1@<eax>(int *a1@<eax>, int a2@<ebp>)
{
  int v2; // ebx
  __int16 v3; // dx
  _WORD *v4; // esi
  __int16 v5; // ax
  int *v6; // esi
  __int16 v7; // cx
  int result; // eax

  v2 = *a1;
  v3 = 8;
  v4 = (_WORD *)(a2 + 4428);
  do
  {
    v5 = *v4;
    v6 = (int *)(v4 + 1);
    v7 = v5;
    result = *v6;
    v4 = v6 + 1;
    if ( !result )
      break;
    if ( (_WORD)v2 == v7 || v2 == result )
      HIBYTE(v3) |= v3;
    LOBYTE(v3) = (unsigned __int8)v3 >> 1;
  }
  while ( (_BYTE)v3 );
  return result;
}

//----- (08049319) --------------------------------------------------------
char __usercall sub_8049319@<al>(unsigned __int8 *a1@<esi>)
{
  unsigned int v1; // eax
  int v2; // ecx
  int i; // eax
  unsigned __int8 v4; // al
  bool v5; // cf
  int v6; // ebx
  __int16 v7; // cx
  unsigned __int8 v8; // al

  v1 = *(_DWORD *)a1;
  v2 = 0;
  if ( (unsigned __int8)*(_DWORD *)a1 == 45 )
  {
    ++a1;
    v1 >>= 8;
  }
  if ( (_BYTE)v1 == 48 )
  {
    v6 = 0;
    v7 = 2051;
    if ( BYTE1(v1) == 120 )
    {
      a1 += 2;
      v7 = 4100;
    }
    while ( 1 )
    {
      v8 = *a1++;
      v5 = v8 < 0x30u;
      LOBYTE(i) = v8 - 48;
      if ( v5 )
        return i;
      if ( (unsigned __int8)i >= 0xAu )
      {
        v5 = (unsigned __int8)i < 7u;
        LOBYTE(i) = i - 7;
        if ( v5 )
          return i;
        if ( (unsigned __int8)i < HIBYTE(v7) )
          goto LABEL_21;
        LOBYTE(i) = i - 32;
      }
      if ( (unsigned __int8)i >= HIBYTE(v7) )
        return i;
LABEL_21:
      v6 <<= v7;
      LOBYTE(v6) = i | v6;
    }
  }
  if ( (char)(v1 - 48) < 0 || (unsigned __int8)v1 > 0x39u )
    JUMPOUT(0x8049250);
  for ( i = 0; ; v2 = i + 10 * v2 )
  {
    v4 = *a1++;
    v5 = v4 < 0x30u;
    LOBYTE(i) = v4 - 48;
    if ( v5 || (unsigned __int8)i >= 0xAu )
      break;
  }
  return i;
}
// 804933B: control flows out of bounds to 8049250

// nfuncs=5 queued=5 decompiled=5 lumina nreq=0 worse=0 better=0
// ALL OK, 5 function(s) have been successfully decompiled
