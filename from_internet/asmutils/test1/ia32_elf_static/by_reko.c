// subject_bss.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 fd = 0x00; // 0804C084
word32 len = 0x00; // 0804C088
word32 * g_ptr804C08C = null; // 0804C08C
up32 g_dw804C090 = 0x00; // 0804C090
Eq_11 g_t804C094 = // 0804C094
	{
		0x00
	};
// subject_data.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 fname = 0x0804A000; // 0804C00C
ptr32 s = 0x0804A008; // 0804C010
// subject_got.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 ** g_ptr804BFF4 = &g_ptr804C08C; // 0804BFF4
up32 * g_ptr804BFF8 = &g_dw804C090; // 0804BFF8
union Eq_11 * g_ptr804BFFC = &g_t804C094; // 0804BFFC
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 08049000: void main(Register (ptr16 Eq_2) es, Stack ui32 tArg04)
// Called from:
//      fn08049150
void main(struct Eq_2 * es, ui32 tArg04)
{
	ptr32 fp;
	__align_stack<word32>(fp);
	_fastcall(0x00);
	ptr32 eax_22 = s;
	len = strlen(eax_22, eax_22);
	open(&tArg04, es);
}

// 08049150: void fn08049150(Register (ptr16 Eq_2) es, Stack ui32 dwArg00)
void fn08049150(struct Eq_2 * es, ui32 dwArg00)
{
	__start_main(es, dwArg00);
}

// 080491A3: void fn080491A3(Stack (ptr32 Eq_37) dwArg00)
// Called from:
//      open
//      close
//      read
//      write
//      lseek
//      chmod
//      chown
//      pipe
//      link
//      symlink
//      unlink
//      mkdir
//      rmdir
//      exit
//      fork
//      execve
//      uname
//      ioctl
//      alarm
//      nanosleep
//      kill
//      signal
//      wait4
//      fstat
//      lstat
//      getuid
//      getgid
void fn080491A3(struct Eq_37 * dwArg00)
{
	ci8 al_31 = dwArg00->b0000;
	if (al_31 != 0x00 && (al_31 < 0x00 || g_ptr804BFFC->u0 == 0x00))
		;
	up32 eax_61 = (word32) dwArg00->b0001;
	__syscall<byte>(0x80);
	if (eax_61 >= ~0x0FFE)
		*g_ptr804BFF8 = -eax_61;
}

// 08049227: void open(Register (ptr32 word32) ecx, Register (ptr16 Eq_2) es)
// Called from:
//      main
void open(word32 * ecx, struct Eq_2 * es)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	++*ecx;
	struct Eq_83 * esp_5 = (struct Eq_83 *) <invalid>;
	esp_5->ptrFFFFFFFE = es;
	read();
}

// 0804922E: void close(Register word32 eax, Register (ptr32 word32) esi)
// Called from:
//      main
void close(word32 eax, word32 * esi)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	*esi += eax;
	read();
}

// 08049235: void read()
// Called from:
//      main
//      open
//      close
void read()
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	write();
}

// 0804923C: void write()
// Called from:
//      main
//      read
void write()
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
}

// 08049243: void lseek(Register byte cl, Register word24 ecx_24_8, Register (ptr32 byte) edi)
// Called from:
//      main
void lseek(byte cl, word24 ecx_24_8, byte * edi)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	chmod(cl, ecx_24_8, edi);
}

// 0804924A: void chmod(Register byte cl, Register word24 ecx_24_8, Register (ptr32 byte) edi)
// Called from:
//      lseek
void chmod(byte cl, word24 ecx_24_8, byte * edi)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	word32 * ecx_16 = SEQ(ecx_24_8, cl + *edi);
	chown(ecx_16);
}

// 08049251: void chown(Register (ptr32 word32) ecx)
// Called from:
//      chmod
void chown(word32 * ecx)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	fn0804925C(ecx);
}

// 08049258: void pipe(Register (ptr32 word32) ecx)
void pipe(word32 * ecx)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	fn0804925C(ecx);
}

// 0804925C: void fn0804925C(Register (ptr32 word32) ecx)
// Called from:
//      chown
//      pipe
void fn0804925C(word32 * ecx)
{
	++*ecx;
	fn08049260();
}

// 0804925F: void link()
// Called from:
//      pipe
void link()
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	fn08049260();
}

// 08049260: void fn08049260()
// Called from:
//      fn0804925C
//      link
void fn08049260()
{
}

// 08049266: void symlink()
// Called from:
//      link
void symlink()
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	fn0804926E();
}

// 0804926D: void unlink()
// Called from:
//      main
void unlink()
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	fn0804926E();
}

// 0804926E: void fn0804926E()
// Called from:
//      symlink
//      unlink
void fn0804926E()
{
}

// 08049274: void mkdir(Register (ptr32 word32) eax, Register (ptr32 word32) ecx, Register (ptr32 Eq_181) edx, Register word32 ebp, Register (ptr32 word32) edi)
// Called from:
//      unlink
void mkdir(word32 * eax, word32 * ecx, struct Eq_181 * edx, word32 ebp, word32 * edi)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	struct Eq_83 * esp_5 = (struct Eq_83 *) <invalid>;
	*edi = esp_5 + *edi / 8;
	rmdir(eax, ecx, edx, ebp, edi);
}

// 0804927B: void rmdir(Register (ptr32 word32) eax, Register (ptr32 word32) ecx, Register (ptr32 Eq_181) edx, Register word32 ebp, Register (ptr32 word32) edi)
// Called from:
//      mkdir
void rmdir(word32 * eax, word32 * ecx, struct Eq_181 * edx, word32 ebp, word32 * edi)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	*eax += ebp;
	exit(eax, ecx, edx, edi);
}

// 08049282: void exit(Register (ptr32 word32) eax, Register (ptr32 word32) ecx, Register (ptr32 Eq_181) edx, Register (ptr32 word32) edi)
// Called from:
//      fn08049150
//      rmdir
void exit(word32 * eax, word32 * ecx, struct Eq_181 * edx, word32 * edi)
{
	struct Eq_37 * dwLoc04;
	byte al_17 = (byte) eax;
	fn080491A3(dwLoc04);
	*ecx = eax + *ecx;
	fork(al_17, edx, edi);
}

// 08049289: void fork(Register byte al, Register (ptr32 Eq_181) edx, Register (ptr32 word32) edi)
// Called from:
//      exit
void fork(byte al, struct Eq_181 * edx, word32 * edi)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	edx->b0000 += al;
	execve(edx, edi);
}

// 08049290: void execve(Register (ptr32 Eq_181) edx, Register (ptr32 word32) edi)
// Called from:
//      fork
void execve(struct Eq_181 * edx, word32 * edi)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	uname(edx, edi);
}

// 08049297: void uname(Register (ptr32 Eq_181) edx, Register (ptr32 word32) edi)
// Called from:
//      execve
void uname(struct Eq_181 * edx, word32 * edi)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	edx->dwFFFFFFE8 = edi + edx->dwFFFFFFE8;
	fn0804929F();
}

// 0804929E: void ioctl()
void ioctl()
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	fn0804929F();
}

// 0804929F: void fn0804929F()
// Called from:
//      uname
//      ioctl
void fn0804929F()
{
}

// 080492A5: void alarm(Register (ptr32 word32) edx, Register (ptr32 word32) ebx)
// Called from:
//      ioctl
void alarm(word32 * edx, word32 * ebx)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	*ebx = ebx + *ebx;
	nanosleep(edx);
}

// 080492AC: void nanosleep(Register (ptr32 word32) edx)
// Called from:
//      alarm
void nanosleep(word32 * edx)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	fn080492B7(edx);
}

// 080492B3: void kill(Register (ptr32 word32) edx)
void kill(word32 * edx)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	fn080492B7(edx);
}

// 080492B7: void fn080492B7(Register (ptr32 word32) edx)
// Called from:
//      nanosleep
//      kill
void fn080492B7(word32 * edx)
{
	++*edx;
	fn080492BE(edx);
}

// 080492BA: void signal(Register (ptr32 word32) edx)
void signal(word32 * edx)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	fn080492BE(edx);
}

// 080492BE: void fn080492BE(Register (ptr32 word32) edx)
// Called from:
//      kill
//      fn080492B7
//      signal
void fn080492BE(word32 * edx)
{
	++*edx;
	fn080492C2();
}

// 080492C1: void wait4()
// Called from:
//      signal
void wait4()
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	fn080492C2();
}

// 080492C2: void fn080492C2()
// Called from:
//      fn080492BE
//      wait4
void fn080492C2()
{
}

// 080492C8: void fstat()
// Called from:
//      wait4
void fstat()
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	fn080492D1();
}

// 080492CF: void lstat()
void lstat()
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	fn080492D1();
}

// 080492D1: void fn080492D1()
// Called from:
//      fstat
//      lstat
void fn080492D1()
{
}

// 080492D6: void getuid(Register (ptr32 byte) eax, Register byte ch, Register byte bl, Register (ptr32 byte) edi, Register (ptr16 Eq_2) es)
void getuid(byte * eax, byte ch, byte bl, byte * edi, struct Eq_2 * es)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	fn080492D7(eax, ch, bl, edi, es);
}

// 080492D7: void fn080492D7(Register (ptr32 byte) eax, Register byte ch, Register byte bl, Register (ptr32 byte) edi, Register (ptr16 Eq_2) es)
// Called from:
//      lstat
//      getuid
void fn080492D7(byte * eax, byte ch, byte bl, byte * edi, struct Eq_2 * es)
{
	*eax += bl;
	getgid(ch, edi, es);
}

// 080492DD: void getgid(Register byte ch, Register (ptr32 byte) edi, Register (ptr16 Eq_2) es)
// Called from:
//      getuid
//      fn080492D7
void getgid(byte ch, byte * edi, struct Eq_2 * es)
{
	struct Eq_37 * dwLoc04;
	fn080491A3(dwLoc04);
	*edi += ch;
	struct Eq_83 * esp_5 = (struct Eq_83 *) <invalid>;
	__start_main(es, esp_5->dw0004);
}

// 080492E4: void __start_main(Register (ptr16 Eq_2) es, Stack ui32 dwArg04)
// Called from:
//      fn08049150
//      getgid
void __start_main(struct Eq_2 * es, ui32 dwArg04)
{
	ptr32 fp;
	*g_ptr804BFF4 = fp + 0x0C + dwArg04 * 0x04;
	main(es, dwArg04);
}

// 0804930A: void _fastcall(Register Eq_11 eax)
// Called from:
//      main
//      fn08049150
void _fastcall(Eq_11 eax)
{
	g_ptr804BFFC->u1 = (word32) eax;
}

// 08049320: void memset(Register (ptr32 byte) eax, Register word32 ecx, Register byte dl, Stack (ptr32 byte) dwArg04, Stack byte bArg08, Stack word32 dwArg0C)
void memset(byte * eax, word32 ecx, byte dl, byte * dwArg04, byte bArg08, word32 dwArg0C)
{
	word32 edx;
	word32 dwArg08;
	byte * edx_14 = eax;
	byte al_54 = (byte) edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		edx_14 = dwArg04;
		al_54 = (byte) dwArg08;
		ecx = dwArg0C;
	}
	byte * edi_36 = edx_14;
	for (; ecx != 0x00; --ecx)
	{
		*edi_36 = al_54;
		++edi_36;
	}
}

// 08049353: void memcpy(Register (ptr32 Eq_444) eax, Register uint32 ecx, Register (ptr32 Eq_446) edx, Stack (ptr32 Eq_444) dwArg04, Stack (ptr32 Eq_446) dwArg08, Stack uint32 dwArg0C)
void memcpy(<unknown>* eax, uint32 ecx, <unknown> * edx, <unknown>* dwArg04, <unknown>* dwArg08, uint32 dwArg0C)
{
	<unknown>* edi_28 = eax;
	<unknown>* esi_29 = edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		edi_28 = dwArg04;
		esi_29 = dwArg08;
		ecx = dwArg0C;
	}
	memcpy(edi_28, esi_29, ecx);
}

// 08049381: void memcmp(Register uint32 ecx, Register (ptr32 Eq_465) esi, Register (ptr32 Eq_466) edi, Stack (ptr32 Eq_465) dwArg04, Stack (ptr32 Eq_466) dwArg08, Stack uint32 dwArg0C)
void memcmp(uint32 ecx, <unknown> * esi, <unknown>* edi, <unknown>* dwArg04, <unknown>* dwArg08, uint32 dwArg0C)
{
	if (g_ptr804BFFC->u0 == 0x00)
	{
		esi = dwArg04;
		edi = dwArg08;
		ecx = dwArg0C;
	}
	memcmp(esi, edi, ecx) == 0x00;
}

// 080493B6: void getenv(Register (ptr32 char) eax, Stack (ptr32 char) dwArg04)
void getenv(char * eax, char * dwArg04)
{
	char * edi_28 = eax;
	if (g_ptr804BFFC->u0 == 0x00)
		edi_28 = dwArg04;
	word32 * ebx_43 = *g_ptr804BFF4;
	uint32 ecx_54 = strlen(edi_28) - ~0x00;
	while (true)
	{
		<unknown>* edi_64 = *ebx_43;
		if (edi_64 == null || memcmp(edi_28, edi_64, ecx_54 - 0x01) == 0x00)
			break;
		++ebx_43;
	}
}

// 08049411: Register ptr32 strlen(Register ptr32 eax, Stack ptr32 dwArg04)
// Called from:
//      main
ptr32 strlen(ptr32 eax, ptr32 dwArg04)
{
	if (g_ptr804BFFC->u0 == 0x00)
		eax = dwArg04;
	int32 eax_21 = 0x00;
	do
	{
		eax_21 = eax_51 + 0x01;
		eax_51 = eax_21;
	} while (*((word32) eax + eax_51) >= 0x01);
	return eax_21 - 0x01;
}

// 0804943C: void itoa(Register (ptr32 byte) eax, Register uint32 ecx, Register (ptr32 char) edx, Stack (ptr32 byte) dwArg04, Stack (ptr32 char) dwArg08, Stack uint32 dwArg0C)
void itoa(byte * eax, uint32 ecx, char * edx, byte * dwArg04, char * dwArg08, uint32 dwArg0C)
{
	char * edi_28 = edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		eax = dwArg04;
		edi_28 = dwArg08;
		ecx = dwArg0C;
	}
	*fn0804946D(eax, ecx, edi_28) = 0x00;
}

// 0804946D: Register (ptr32 char) fn0804946D(Register (ptr32 byte) eax, Register uint32 ecx, Register (ptr32 char) edi)
// Called from:
//      itoa
//      fn0804946D
//      sprintf
char * fn0804946D(byte * eax, uint32 ecx, char * edi)
{
	uint64 edx_eax_6 = (uint64) eax;
	uint32 edx_9 = (uint32) (edx_eax_6 % ecx);
	byte dl_23 = (byte) edx_9;
	byte * eax_10 = (uint32) (edx_eax_6 /u ecx);
	if (eax_10 != null)
	{
		fn0804946D(eax_10, ecx, edi);
		dl_23 = (byte) edx_9;
	}
	ci8 dl_26 = dl_23 + 0x30;
	if (dl_26 > 0x39)
		dl_26 += 0x27;
	*edi = dl_26;
	return edi + 1;
}

// 0804948B: Register ptr32 sprintf(Stack (ptr32 char) dwArg04, Stack (ptr32 Eq_592) dwArg08)
// Called from:
//      printf
ptr32 sprintf(char * dwArg04, struct Eq_592 * dwArg08)
{
	ptr32 fp;
	word32 * edx_181 = fp + 0x0C;
	struct Eq_592 * esi_192 = dwArg08;
	char * edi_161 = dwArg04;
	while (true)
	{
		byte al_188 = esi_296->b0000;
		esi_192 = &esi_296->b0000 + 1;
		if (al_188 == 0x00)
			break;
		if (al_188 == 0x25)
		{
			byte * ebx_171 = *edx_181;
			al_188 = esi_192->b0000;
			esi_192 = &esi_192->b0000 + 1;
			uint32 ecx_110 = 0x0A;
			if (al_188 != 100)
			{
				ecx_110 = 0x10;
				if (al_188 == 0x78)
					goto l080494DB;
				ecx_110 = 0x08;
				if (al_188 == 111)
					goto l080494DB;
				ecx_110 = 0x02;
				if (al_188 == 0x62)
					goto l080494DB;
				if (al_188 == 99)
					goto l080494A3;
				esi_296 = esi_192;
				if (al_188 != 115)
					continue;
				if (ebx_171 != null)
				{
					while (true)
					{
						byte al_173 = *ebx_171;
						if (al_173 == 0x00)
							break;
						*edi_161 = al_173;
						++edi_161;
						++ebx_171;
					}
				}
			}
			else
			{
l080494DB:
				*fn0804946D(ebx_171, ecx_110, edi_161) = 0x00;
				char * edi_140 = edi_161;
				do
				{
					edi_140 = edi_297 + 1;
					edi_297 = edi_140;
				} while (*edi_297 >= 0x01);
				edi_161 = edi_140 - 0x01;
			}
			esi_192 = esi_296 + 1;
			++edx_181;
			continue;
		}
l080494A3:
		*edi_161 = al_188;
		++edi_161;
	}
	*edi_161 = 0x00;
	return edi_161 + 1 - dwArg04 - 0x01;
}

// 08049500: void printf(Stack (ptr32 Eq_592) dwArg04)
void printf(struct Eq_592 * dwArg04)
{
	char bLoc1000;
	sys_write(0x01, &bLoc1000, sprintf(&bLoc1000, dwArg04));
}

// 0804958A: void strtol(Register (ptr32 Eq_700) eax, Register word32 ecx, Register (ptr32 Eq_700) edx, Stack (ptr32 Eq_700) dwArg04, Stack (ptr32 Eq_700) dwArg08, Stack word32 dwArg0C)
void strtol(struct Eq_700 * eax, word32 ecx, struct Eq_700 * edx, struct Eq_700 * dwArg04, struct Eq_700 * dwArg08, word32 dwArg0C)
{
	struct Eq_700 * edi_104 = eax;
	struct Eq_700 * esi_119 = edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		edi_104 = dwArg04;
		esi_119 = dwArg08;
		ecx = dwArg0C;
	}
	while (edi_104->w0000 == 0x20)
		++edi_104;
	if (edi_104->w0000 == 0x7830)
		edi_104 += 2;
	do
	{
		Eq_728 bl_62 = edi_104->w0000;
		if (bl_62 < 0x30)
			return;
		++edi_104;
	} while (edi_104 != esi_119);
}

