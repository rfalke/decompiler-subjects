// subject_bss.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 fd = 0x00; // 0804C084
word32 len = 0x00; // 0804C088
word32 * g_ptr804C08C = null; // 0804C08C
up32 g_dw804C090 = 0x00; // 0804C090
Eq_14 g_t804C094 = // 0804C094
	{
		0x00
	};
// subject_data.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 fname = 0x0804A000; // 0804C00C
ptr32 s = 0x0804A008; // 0804C010
// subject_got.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 ** g_ptr804BFF4 = &g_ptr804C08C; // 0804BFF4
up32 * g_ptr804BFF8 = &g_dw804C090; // 0804BFF8
union Eq_14 * g_ptr804BFFC = &g_t804C094; // 0804BFFC
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 08049000: void main(Register (ptr32 word32) ecx, Register (ptr16 Eq_3) es)
// Called from:
//      fn08049130
void main(word32 * ecx, struct Eq_3 * es)
{
	ptr32 fp;
	ptr32 dwLoc24;
	__align_stack<word32>(fp - 4);
	_fastcall(0x03);
	len = strlen(s, dwLoc24);
	open(ecx, es);
}

// 08049130: void fn08049130(Register (ptr16 Eq_3) es, Stack ui32 dwArg00)
void fn08049130(struct Eq_3 * es, ui32 dwArg00)
{
	__start_main(es, dwArg00);
}

// 08049183: void fn08049183(Stack (ptr32 Eq_38) dwArg00)
// Called from:
//      open
//      close
//      read
//      write
//      lseek
//      chmod
//      chown
//      pipe
//      link
//      symlink
//      unlink
//      mkdir
//      rmdir
//      exit
//      fork
//      execve
//      uname
//      ioctl
//      alarm
//      nanosleep
//      kill
//      signal
//      wait4
//      fstat
//      lstat
//      getuid
//      getgid
void fn08049183(struct Eq_38 * dwArg00)
{
	ci8 al_31 = dwArg00->b0000;
	if (al_31 != 0x00 && (al_31 < 0x00 || g_ptr804BFFC->u0 == 0x00))
		;
	up32 eax_61 = (word32) dwArg00->b0001;
	__syscall<byte>(0x80);
	if (eax_61 >= ~0x0FFE)
		*g_ptr804BFF8 = -eax_61;
}

// 08049207: void open(Register (ptr32 word32) ecx, Register (ptr16 Eq_3) es)
// Called from:
//      main
void open(word32 * ecx, struct Eq_3 * es)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	++*ecx;
	struct Eq_84 * esp_5 = (struct Eq_84 *) <invalid>;
	esp_5->ptrFFFFFFFE = es;
	read();
}

// 0804920E: void close(Register word32 eax, Register (ptr32 word32) esi)
// Called from:
//      main
void close(word32 eax, word32 * esi)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	*esi += eax;
	read();
}

// 08049215: void read()
// Called from:
//      main
//      open
//      close
void read()
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	write();
}

// 0804921C: void write()
// Called from:
//      main
//      read
void write()
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
}

// 08049223: void lseek(Register byte cl, Register word24 ecx_24_8, Register (ptr32 byte) edi)
// Called from:
//      main
void lseek(byte cl, word24 ecx_24_8, byte * edi)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	chmod(cl, ecx_24_8, edi);
}

// 0804922A: void chmod(Register byte cl, Register word24 ecx_24_8, Register (ptr32 byte) edi)
// Called from:
//      lseek
void chmod(byte cl, word24 ecx_24_8, byte * edi)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	word32 * ecx_16 = SEQ(ecx_24_8, cl + *edi);
	chown(ecx_16);
}

// 08049231: void chown(Register (ptr32 word32) ecx)
// Called from:
//      chmod
void chown(word32 * ecx)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	fn0804923C(ecx);
}

// 08049238: void pipe(Register (ptr32 word32) ecx)
void pipe(word32 * ecx)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	fn0804923C(ecx);
}

// 0804923C: void fn0804923C(Register (ptr32 word32) ecx)
// Called from:
//      chown
//      pipe
void fn0804923C(word32 * ecx)
{
	++*ecx;
	fn08049240();
}

// 0804923F: void link()
// Called from:
//      pipe
void link()
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	fn08049240();
}

// 08049240: void fn08049240()
// Called from:
//      fn0804923C
//      link
void fn08049240()
{
}

// 08049246: void symlink()
// Called from:
//      link
void symlink()
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	fn0804924E();
}

// 0804924D: void unlink()
// Called from:
//      main
void unlink()
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	fn0804924E();
}

// 0804924E: void fn0804924E()
// Called from:
//      symlink
//      unlink
void fn0804924E()
{
}

// 08049254: void mkdir(Register (ptr32 word32) eax, Register (ptr32 word32) ecx, Register (ptr32 Eq_182) edx, Register word32 ebp, Register (ptr32 word32) edi)
// Called from:
//      unlink
void mkdir(word32 * eax, word32 * ecx, struct Eq_182 * edx, word32 ebp, word32 * edi)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	struct Eq_84 * esp_5 = (struct Eq_84 *) <invalid>;
	*edi = esp_5 + *edi / 8;
	rmdir(eax, ecx, edx, ebp, edi);
}

// 0804925B: void rmdir(Register (ptr32 word32) eax, Register (ptr32 word32) ecx, Register (ptr32 Eq_182) edx, Register word32 ebp, Register (ptr32 word32) edi)
// Called from:
//      mkdir
void rmdir(word32 * eax, word32 * ecx, struct Eq_182 * edx, word32 ebp, word32 * edi)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	*eax += ebp;
	exit(eax, ecx, edx, edi);
}

// 08049262: void exit(Register (ptr32 word32) eax, Register (ptr32 word32) ecx, Register (ptr32 Eq_182) edx, Register (ptr32 word32) edi)
// Called from:
//      fn08049130
//      rmdir
void exit(word32 * eax, word32 * ecx, struct Eq_182 * edx, word32 * edi)
{
	struct Eq_38 * dwLoc04;
	byte al_17 = (byte) eax;
	fn08049183(dwLoc04);
	*ecx = eax + *ecx;
	fork(al_17, edx, edi);
}

// 08049269: void fork(Register byte al, Register (ptr32 Eq_182) edx, Register (ptr32 word32) edi)
// Called from:
//      exit
void fork(byte al, struct Eq_182 * edx, word32 * edi)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	edx->b0000 += al;
	execve(edx, edi);
}

// 08049270: void execve(Register (ptr32 Eq_182) edx, Register (ptr32 word32) edi)
// Called from:
//      fork
void execve(struct Eq_182 * edx, word32 * edi)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	uname(edx, edi);
}

// 08049277: void uname(Register (ptr32 Eq_182) edx, Register (ptr32 word32) edi)
// Called from:
//      execve
void uname(struct Eq_182 * edx, word32 * edi)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	edx->dwFFFFFFE8 = edi + edx->dwFFFFFFE8;
	fn0804927F();
}

// 0804927E: void ioctl()
void ioctl()
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	fn0804927F();
}

// 0804927F: void fn0804927F()
// Called from:
//      uname
//      ioctl
void fn0804927F()
{
}

// 08049285: void alarm(Register (ptr32 word32) edx, Register (ptr32 word32) ebx)
// Called from:
//      ioctl
void alarm(word32 * edx, word32 * ebx)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	*ebx = ebx + *ebx;
	nanosleep(edx);
}

// 0804928C: void nanosleep(Register (ptr32 word32) edx)
// Called from:
//      alarm
void nanosleep(word32 * edx)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	fn08049297(edx);
}

// 08049293: void kill(Register (ptr32 word32) edx)
void kill(word32 * edx)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	fn08049297(edx);
}

// 08049297: void fn08049297(Register (ptr32 word32) edx)
// Called from:
//      nanosleep
//      kill
void fn08049297(word32 * edx)
{
	++*edx;
	fn0804929E(edx);
}

// 0804929A: void signal(Register (ptr32 word32) edx)
void signal(word32 * edx)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	fn0804929E(edx);
}

// 0804929E: void fn0804929E(Register (ptr32 word32) edx)
// Called from:
//      kill
//      fn08049297
//      signal
void fn0804929E(word32 * edx)
{
	++*edx;
	fn080492A2();
}

// 080492A1: void wait4()
// Called from:
//      signal
void wait4()
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	fn080492A2();
}

// 080492A2: void fn080492A2()
// Called from:
//      fn0804929E
//      wait4
void fn080492A2()
{
}

// 080492A8: void fstat()
// Called from:
//      wait4
void fstat()
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	fn080492B1();
}

// 080492AF: void lstat()
void lstat()
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	fn080492B1();
}

// 080492B1: void fn080492B1()
// Called from:
//      fstat
//      lstat
void fn080492B1()
{
}

// 080492B6: void getuid(Register (ptr32 byte) eax, Register byte ch, Register byte bl, Register (ptr32 byte) edi, Register (ptr16 Eq_3) es)
void getuid(byte * eax, byte ch, byte bl, byte * edi, struct Eq_3 * es)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	fn080492B7(eax, ch, bl, edi, es);
}

// 080492B7: void fn080492B7(Register (ptr32 byte) eax, Register byte ch, Register byte bl, Register (ptr32 byte) edi, Register (ptr16 Eq_3) es)
// Called from:
//      lstat
//      getuid
void fn080492B7(byte * eax, byte ch, byte bl, byte * edi, struct Eq_3 * es)
{
	*eax += bl;
	getgid(ch, edi, es);
}

// 080492BD: void getgid(Register byte ch, Register (ptr32 byte) edi, Register (ptr16 Eq_3) es)
// Called from:
//      getuid
//      fn080492B7
void getgid(byte ch, byte * edi, struct Eq_3 * es)
{
	struct Eq_38 * dwLoc04;
	fn08049183(dwLoc04);
	*edi += ch;
	struct Eq_84 * esp_5 = (struct Eq_84 *) <invalid>;
	__start_main(es, esp_5->dw0004);
}

// 080492C4: void __start_main(Register (ptr16 Eq_3) es, Stack ui32 dwArg04)
// Called from:
//      fn08049130
//      getgid
void __start_main(struct Eq_3 * es, ui32 dwArg04)
{
	ptr32 fp;
	word32 * ecx_9 = fp + 0x0C + dwArg04 * 0x04;
	*g_ptr804BFF4 = ecx_9;
	main(ecx_9, es);
}

// 080492EA: void _fastcall(Register Eq_14 eax)
// Called from:
//      main
//      fn08049130
void _fastcall(Eq_14 eax)
{
	g_ptr804BFFC->u1 = (word32) eax;
}

// 08049300: void memset(Register (ptr32 byte) eax, Register word32 ecx, Register byte dl, Stack (ptr32 byte) dwArg04, Stack byte bArg08, Stack word32 dwArg0C)
void memset(byte * eax, word32 ecx, byte dl, byte * dwArg04, byte bArg08, word32 dwArg0C)
{
	word32 edx;
	word32 dwArg08;
	byte * edx_14 = eax;
	byte al_54 = (byte) edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		edx_14 = dwArg04;
		al_54 = (byte) dwArg08;
		ecx = dwArg0C;
	}
	byte * edi_36 = edx_14;
	for (; ecx != 0x00; --ecx)
	{
		*edi_36 = al_54;
		++edi_36;
	}
}

// 08049333: void memcpy(Register (ptr32 Eq_446) eax, Register uint32 ecx, Register (ptr32 Eq_448) edx, Stack (ptr32 Eq_446) dwArg04, Stack (ptr32 Eq_448) dwArg08, Stack uint32 dwArg0C)
void memcpy(<unknown>* eax, uint32 ecx, <unknown> * edx, <unknown>* dwArg04, <unknown>* dwArg08, uint32 dwArg0C)
{
	<unknown>* edi_28 = eax;
	<unknown>* esi_29 = edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		edi_28 = dwArg04;
		esi_29 = dwArg08;
		ecx = dwArg0C;
	}
	memcpy(edi_28, esi_29, ecx);
}

// 08049361: void memcmp(Register uint32 ecx, Register (ptr32 Eq_467) esi, Register (ptr32 Eq_468) edi, Stack (ptr32 Eq_467) dwArg04, Stack (ptr32 Eq_468) dwArg08, Stack uint32 dwArg0C)
void memcmp(uint32 ecx, <unknown> * esi, <unknown>* edi, <unknown>* dwArg04, <unknown>* dwArg08, uint32 dwArg0C)
{
	if (g_ptr804BFFC->u0 == 0x00)
	{
		esi = dwArg04;
		edi = dwArg08;
		ecx = dwArg0C;
	}
	memcmp(esi, edi, ecx) == 0x00;
}

// 08049396: void getenv(Register (ptr32 char) eax, Stack (ptr32 char) dwArg04)
void getenv(char * eax, char * dwArg04)
{
	char * edi_28 = eax;
	if (g_ptr804BFFC->u0 == 0x00)
		edi_28 = dwArg04;
	word32 * ebx_43 = *g_ptr804BFF4;
	uint32 ecx_54 = strlen(edi_28) - ~0x00;
	while (true)
	{
		<unknown>* edi_64 = *ebx_43;
		if (edi_64 == null || memcmp(edi_28, edi_64, ecx_54 - 0x01) == 0x00)
			break;
		++ebx_43;
	}
}

// 080493F1: Register ptr32 strlen(Register ptr32 eax, Stack ptr32 dwArg04)
// Called from:
//      main
ptr32 strlen(ptr32 eax, ptr32 dwArg04)
{
	if (g_ptr804BFFC->u0 == 0x00)
		eax = dwArg04;
	int32 eax_21 = 0x00;
	do
	{
		eax_21 = eax_51 + 0x01;
		eax_51 = eax_21;
	} while (*((word32) eax + eax_51) >= 0x01);
	return eax_21 - 0x01;
}

// 0804941C: void itoa(Register (ptr32 byte) eax, Register uint32 ecx, Register (ptr32 char) edx, Stack (ptr32 byte) dwArg04, Stack (ptr32 char) dwArg08, Stack uint32 dwArg0C)
void itoa(byte * eax, uint32 ecx, char * edx, byte * dwArg04, char * dwArg08, uint32 dwArg0C)
{
	char * edi_28 = edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		eax = dwArg04;
		edi_28 = dwArg08;
		ecx = dwArg0C;
	}
	*fn0804944D(eax, ecx, edi_28) = 0x00;
}

// 0804944D: Register (ptr32 char) fn0804944D(Register (ptr32 byte) eax, Register uint32 ecx, Register (ptr32 char) edi)
// Called from:
//      itoa
//      fn0804944D
//      sprintf
char * fn0804944D(byte * eax, uint32 ecx, char * edi)
{
	uint64 edx_eax_6 = (uint64) eax;
	uint32 edx_9 = (uint32) (edx_eax_6 % ecx);
	byte dl_23 = (byte) edx_9;
	byte * eax_10 = (uint32) (edx_eax_6 /u ecx);
	if (eax_10 != null)
	{
		fn0804944D(eax_10, ecx, edi);
		dl_23 = (byte) edx_9;
	}
	ci8 dl_26 = dl_23 + 0x30;
	if (dl_26 > 0x39)
		dl_26 += 0x27;
	*edi = dl_26;
	return edi + 1;
}

// 0804946B: Register ptr32 sprintf(Stack (ptr32 char) dwArg04, Stack (ptr32 Eq_594) dwArg08)
// Called from:
//      printf
ptr32 sprintf(char * dwArg04, struct Eq_594 * dwArg08)
{
	ptr32 fp;
	word32 * edx_181 = fp + 0x0C;
	struct Eq_594 * esi_192 = dwArg08;
	char * edi_161 = dwArg04;
	while (true)
	{
		byte al_188 = esi_296->b0000;
		esi_192 = &esi_296->b0000 + 1;
		if (al_188 == 0x00)
			break;
		if (al_188 == 0x25)
		{
			byte * ebx_171 = *edx_181;
			al_188 = esi_192->b0000;
			esi_192 = &esi_192->b0000 + 1;
			uint32 ecx_110 = 0x0A;
			if (al_188 != 100)
			{
				ecx_110 = 0x10;
				if (al_188 == 0x78)
					goto l080494BB;
				ecx_110 = 0x08;
				if (al_188 == 111)
					goto l080494BB;
				ecx_110 = 0x02;
				if (al_188 == 0x62)
					goto l080494BB;
				if (al_188 == 99)
					goto l08049483;
				esi_296 = esi_192;
				if (al_188 != 115)
					continue;
				if (ebx_171 != null)
				{
					while (true)
					{
						byte al_173 = *ebx_171;
						if (al_173 == 0x00)
							break;
						*edi_161 = al_173;
						++edi_161;
						++ebx_171;
					}
				}
			}
			else
			{
l080494BB:
				*fn0804944D(ebx_171, ecx_110, edi_161) = 0x00;
				char * edi_140 = edi_161;
				do
				{
					edi_140 = edi_297 + 1;
					edi_297 = edi_140;
				} while (*edi_297 >= 0x01);
				edi_161 = edi_140 - 0x01;
			}
			esi_192 = esi_296 + 1;
			++edx_181;
			continue;
		}
l08049483:
		*edi_161 = al_188;
		++edi_161;
	}
	*edi_161 = 0x00;
	return edi_161 + 1 - dwArg04 - 0x01;
}

// 080494E0: void printf(Stack (ptr32 Eq_594) dwArg04)
void printf(struct Eq_594 * dwArg04)
{
	char bLoc1000;
	sys_write(0x01, &bLoc1000, sprintf(&bLoc1000, dwArg04));
}

// 0804956A: void strtol(Register (ptr32 Eq_702) eax, Register word32 ecx, Register (ptr32 Eq_702) edx, Stack (ptr32 Eq_702) dwArg04, Stack (ptr32 Eq_702) dwArg08, Stack word32 dwArg0C)
void strtol(struct Eq_702 * eax, word32 ecx, struct Eq_702 * edx, struct Eq_702 * dwArg04, struct Eq_702 * dwArg08, word32 dwArg0C)
{
	struct Eq_702 * edi_104 = eax;
	struct Eq_702 * esi_119 = edx;
	if (g_ptr804BFFC->u0 == 0x00)
	{
		edi_104 = dwArg04;
		esi_119 = dwArg08;
		ecx = dwArg0C;
	}
	while (edi_104->w0000 == 0x20)
		++edi_104;
	if (edi_104->w0000 == 0x7830)
		edi_104 += 2;
	do
	{
		Eq_730 bl_62 = edi_104->w0000;
		if (bl_62 < 0x30)
			return;
		++edi_104;
	} while (edi_104 != esi_119);
}

