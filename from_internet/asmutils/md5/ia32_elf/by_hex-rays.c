/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <math.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall sub_804804C@<eax>(int@<edx>, int@<ecx>, int@<ebx>);
// int __usercall sub_8048059@<eax>(int@<edx>, int@<ecx>, int@<ebx>);
// int __usercall sub_8048066@<eax>(int@<edx>, int@<ecx>, int@<ebx>);
// int __usercall sub_804806D@<eax>(int@<edx>, int@<ecx>, int@<ebx>);
void __fastcall __noreturn start(int, signed int);

//-------------------------------------------------------------------------
// Data declarations

double dbl_804825B = 4.294967296e9; // weak
char byte_8048263 = ' '; // weak
char byte_8048264 = '\n'; // weak
char byte_8048265[] = { '\x15' }; // weak
char byte_8048275[] = { '\a' }; // weak
char byte_8048279[] = { '\0' }; // weak
int (*funcs_8048195[4])() = { &sub_804806D, &sub_8048066, &sub_8048059, &sub_804804C }; // weak
int dword_804828D[]; // weak
char byte_80482CD[3]; // weak
char byte_80483CD[3]; // weak
char byte_80483D9[3]; // weak
int dword_80483DD; // weak
char byte_80483E1; // weak
char byte_80483E2; // weak


//----- (0804804C) --------------------------------------------------------
int __usercall sub_804804C@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<ebx>)
{
  return a1 & ~a3 | a2 & a3;
}

//----- (08048059) --------------------------------------------------------
int __usercall sub_8048059@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<ebx>)
{
  return a2 & ~a1 | a3 & a1;
}

//----- (08048066) --------------------------------------------------------
int __usercall sub_8048066@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<ebx>)
{
  return a1 ^ a2 ^ a3;
}

//----- (0804806D) --------------------------------------------------------
int __usercall sub_804806D@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<ebx>)
{
  return a2 ^ (a3 | ~a1);
}

//----- (08048076) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall __noreturn start(int a1, signed int a2)
{
  char *v2; // edi
  int v3; // ebp
  int v4; // ebx
  int *v6; // edi
  size_t v7; // edx
  int v8; // edx
  int v9; // edx
  int v10; // edx
  int v11; // ecx
  int v12; // ebx
  int v13; // eax
  char *v14; // esi
  int v15; // ebp
  int v16; // edi
  int v17; // eax
  int v18; // edx
  int v19; // et1
  int v20; // ett
  char *v21; // esi
  char *v22; // edi
  int v23; // ecx
  _BYTE *v26; // edi
  int v28; // et0
  int v30; // eax
  int v31; // eax
  _BYTE *v32; // esi
  size_t v33; // edx
  int v35; // eax
  int v36; // eax
  int v37; // eax
  int v38; // [esp-8h] [ebp-10h]
  int v39; // [esp-4h] [ebp-Ch]
  unsigned int v40; // [esp+0h] [ebp-8h]
  int v41; // [esp+0h] [ebp-8h]
  _BYTE *v42; // [esp+4h] [ebp-4h]

  v2 = byte_80482CD;
  do
  {
    *(_DWORD *)v2 = (__int64)(fabs(sin((long double)++a2)) * dbl_804825B);
    v2 += 4;
  }
  while ( a2 < 64 );
  v3 = 0;
  if ( v42 )
    goto LABEL_4;
LABEL_7:
  *(_DWORD *)byte_80483CD = 1732584193;
  *(_DWORD *)&byte_80483CD[4] = -271733879;
  *(_DWORD *)&byte_80483CD[8] = -1732584194;
  *(_DWORD *)&byte_80483CD[12] = 271733878;
  *(_DWORD *)&byte_80483CD[16] = 0;
  *(_WORD *)&byte_80483CD[20] = 0;
  while ( 1 )
  {
    v6 = dword_804828D;
    v7 = 64;
    do
    {
      _EAX = sys_read(v3, v6, v7);
      v7 = v8 - _EAX;
      v6 = (int *)((char *)v6 + _EAX);
      if ( _EAX < 0 )
        goto LABEL_31;
    }
    while ( _EAX );
    v9 = 64 - v7;
    dword_80483DD += v9;
    if ( v9 < 64 )
    {
      if ( !v9 && byte_80483E1 )
      {
        v21 = byte_80483CD;
        v22 = &byte_80483CD[22];
        v23 = 16;
        do
        {
          LOBYTE(_EAX) = *v21++;
          LOBYTE(v9) = _EAX;
          LOBYTE(_EAX) = (unsigned __int8)_EAX >> 4;
          __asm
          {
            aam
            aad     31h ; '1'
          }
          LOBYTE(_EAX) = _EAX + 48;
          *v22 = _EAX;
          v26 = v22 + 1;
          v28 = _EAX;
          _EAX = v9;
          v9 = v28;
          LOBYTE(_EAX) = _EAX & 0xF;
          __asm
          {
            aam
            aad     31h ; '1'
          }
          *v26 = _EAX + 48;
          v22 = v26 + 1;
          --v23;
        }
        while ( v23 );
        v30 = sys_write(1, &byte_80483CD[22], 0x20u);
        if ( v3 )
        {
          v31 = sys_write(1, &byte_8048263, 1u);
          v32 = v42;
          v33 = -1;
          do
            ++v33;
          while ( *v32++ );
          v35 = sys_write(1, v42, v33);
        }
        v36 = sys_write(1, &byte_8048264, 1u);
LABEL_4:
        v4 = (int)v42;
        if ( v42 )
        {
          _EAX = sys_open(v42, 0, a2);
          if ( _EAX >= 0 )
          {
            v3 = _EAX;
            goto LABEL_7;
          }
LABEL_31:
          v4 = _EAX;
        }
        v37 = sys_exit(v4);
      }
      if ( !byte_80483E2 )
      {
        ++byte_80483E2;
        *((_BYTE *)dword_804828D + v9++) = 0x80;
      }
      if ( v9 > 56 )
      {
        memset((char *)dword_804828D + v9, 0, 64 - v9);
      }
      else
      {
        memset((char *)dword_804828D + v9, 0, 56 - v9);
        v40 = dword_80483DD;
        dword_804828D[14] = 8 * dword_80483DD;
        dword_804828D[15] = v40 >> 29;
        ++byte_80483E1;
      }
    }
    v41 = v3;
    v10 = *(_DWORD *)byte_80483D9;
    v11 = *(_DWORD *)&byte_80483D9[-4];
    v12 = *(_DWORD *)&byte_80483D9[-8];
    v13 = *(_DWORD *)&byte_80483D9[-12];
    v14 = byte_80482CD;
    v15 = 3;
    v39 = 15;
    do
    {
      v16 = (unsigned __int8)byte_8048279[v15];
      do
      {
        v38 = v11;
        v17 = __ROL4__(
                dword_804828D[v16]
              + *(_DWORD *)v14
              + ((int (__usercall *)@<eax>(int@<edx>, int@<ecx>, int@<ebx>))funcs_8048195[v15])(v10, v11, v12)
              + v13,
                byte_8048265[4 * v15 + (v39 & 3)]);
        v16 = (byte_8048275[v15] + (_BYTE)v16) & 0xF;
        v14 += 4;
        v19 = v18;
        v10 = v38;
        v11 = v12;
        v20 = v12 + v17;
        v13 = v19;
        v12 = v20;
        --v39;
      }
      while ( v39 >= 0 );
      v39 &= 0xFu;
      --v15;
    }
    while ( v15 >= 0 );
    *(_DWORD *)v14 += v13;
    *((_DWORD *)v14 + 1) += v12;
    *((_DWORD *)v14 + 2) += v11;
    *((_DWORD *)v14 + 3) += v38;
    v3 = v41;
  }
}
// 80480A4: positive sp value C has been found
// 80480A9: variable 'v42' is possibly undefined
// 80480BA: variable 'a2' is possibly undefined
// 80480F9: variable 'v8' is possibly undefined
// 80481CA: variable 'v18' is possibly undefined
// 804825B: using guessed type double dbl_804825B;
// 8048263: using guessed type char byte_8048263;
// 8048264: using guessed type char byte_8048264;
// 804827D: using guessed type int (*funcs_8048195[4])();
// 804828D: using guessed type int dword_804828D[];
// 80483DD: using guessed type int dword_80483DD;
// 80483E1: using guessed type char byte_80483E1;
// 80483E2: using guessed type char byte_80483E2;

// nfuncs=5 queued=5 decompiled=5 lumina nreq=0 worse=0 better=0
// ALL OK, 5 function(s) have been successfully decompiled
