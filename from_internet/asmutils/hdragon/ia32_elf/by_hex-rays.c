/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// __int64 __usercall sub_804804C@<edx:eax>(__int64@<edx:eax>, int@<ecx>, int@<edi>, _BYTE *@<esi>);
void __fastcall __noreturn start(int, mode_t);


//----- (0804804C) --------------------------------------------------------
__int64 __usercall sub_804804C@<edx:eax>(__int64 a1@<edx:eax>, int a2@<ecx>, int a3@<edi>, _BYTE *a4@<esi>)
{
  __int64 v4; // rax
  int v5; // ecx
  int v6; // eax
  _DWORD *v7; // esi
  int v8; // eax
  int v9; // ecx
  int v11; // [esp-24h] [ebp-24h]
  __int64 v12; // [esp-20h] [ebp-20h]

  v12 = a1;
  if ( HIDWORD(a1) )
  {
    --HIDWORD(a1);
    v11 = a1;
    LOBYTE(a1) = 1;
    v4 = sub_804804C(a1, a2, a3, a4);
    LODWORD(v4) = v11;
    *a4 += v11;
    *a4 &= 3u;
    LOBYTE(v4) = -1;
    sub_804804C(v4, v5, a3, a4);
  }
  else
  {
    v6 = *(_DWORD *)a4;
    v7 = a4 + 4;
    if ( (_BYTE)v6 )
    {
      if ( (_BYTE)v6 == 2 )
      {
        LOWORD(v6) = 640;
      }
      else if ( (_BYTE)v6 != 1 )
      {
        v6 = -1;
      }
    }
    else
    {
      v6 = -640;
    }
    v8 = *v7 + v6;
    *(_BYTE *)(a3 + v8) = 14;
    *v7 = v8;
    v9 = 0xFFFF;
    do
      --v9;
    while ( v9 );
  }
  return v12;
}
// 8048062: variable 'v5' is possibly undefined

//----- (08048098) --------------------------------------------------------
void __fastcall __noreturn start(int a1, mode_t a2)
{
  const char *v2; // ebx
  int v3; // eax
  int v4; // eax
  int v5; // eax
  int v6; // eax
  _DWORD v7[2]; // [esp-Ch] [ebp-Ch] BYREF
  const char *v8; // [esp-4h] [ebp-4h]

  v2 = "/dev/fb0";
  v3 = sys_open("/dev/fb0", 2, a2);
  if ( v3 >= 0 )
  {
    v8 = (const char *)v3;
    __asm { int     80h; LINUX - sys_mmap2 }
    memset((void *)0xC0, 0, 0x4B000u);
    v7[1] = 205120;
    v7[0] = 0;
    sub_804804C(0x1000000001LL, 0, 192, v7);
    v4 = sys_munmap((void *)0xC0, 307200);
    v2 = v8;
    v5 = sys_close((int)v8);
  }
  v6 = sys_exit((int)v2);
}

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
