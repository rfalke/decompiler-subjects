// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word16 g_w804804C = 0x00; // 0804804C
word16 g_w8048066 = 0x00; // 08048066
word32 g_a8048080[] = // 08048080
	{
	};
word32 g_dw80480B6 = 0x20202020; // 080480B6
byte g_b80480BD = 0x20; // 080480BD
byte g_b80480D8 = 0x61; // 080480D8
// 08048158: void fn08048158(Stack word32 dwArg00, Stack (ptr32 byte) dwArg08, Stack (ptr32 byte) dwArg0C)
void fn08048158(word32 dwArg00, byte * dwArg08, byte * dwArg0C)
{
	if (dwArg00 == 0x03)
	{
		Eq_12 edx_17 = fn080482EC(dwArg08);
		uint64 edx_eax_36 = (fn080482EC(dwArg0C) - 0x07B2) *64 31536000;
		g_dw8048301 = (SEQ(SLICE(edx_eax_36, word16, 48), (word32) edx_17 + 0x0804804B + (edx_17 - 0x01)) + 0x14) * 0x00015180 + (word32) edx_eax_36;
	}
	else
		__syscall(0x80);
	uint32 eax_57 = (uint32) ((uint64) (g_dw8048301 + ~0x464F) /u 0x00015180);
	g_dw8048321 = (uint32) ((uint64) (eax_57 + 0x04) % 0x07);
	uint64 edx_eax_74 = (uint64) eax_57;
	uint32 eax_77 = (uint32) (edx_eax_74 /u 0x016D);
	g_dw804831D = eax_77 + 0x07B2;
	uint64 edx_eax_88 = (uint64) (eax_77 + 0x02);
	uint32 ebx_92 = (uint32) (edx_eax_74 % 0x016D) - (uint32) (edx_eax_88 /u 0x04);
	word16 ebx_16_16_131 = SLICE(ebx_92, word16, 16);
	ci16 bx_282 = (word16) ebx_92;
	word16 eax_16_16_288 = SLICE(eax_77 + 0x07B2, word16, 16);
	word32 esi_100 = 0x0804804C;
	if ((uint32) (edx_eax_88 % 0x04) == 0x00)
	{
		g_dw8048335 = 0x01;
		ebx_16_16_131 = SLICE(ebx_92 + 0x01, word16, 16);
		bx_282 = (word16) ebx_92 + 0x01;
		esi_100 = 0x08048066;
	}
	word32 ecx_106;
	word16 * esi_109 = esi_100 + 22;
	for (ecx_106 = 0x0C; ecx_106 != 0x00; --ecx_106)
	{
		ci16 ax_114 = *esi_109;
		esi_109 -= 2;
		if (bx_282 > ax_114)
			break;
	}
	g_dw8048319 = ecx_106 - 0x01;
	g_dw8048315 = SEQ(ebx_16_16_131, bx_282 - ax_114) + 0x01;
	word32 * esi_137 = g_a8048080;
	word32 ecx_139;
	word32 eax_144 = SEQ(eax_16_16_288, ax_114);
	for (ecx_139 = g_dw8048319 + 0x01; ecx_139 != 0x00; --ecx_139)
	{
		eax_144 = *esi_137;
		++esi_137;
	}
	g_dw80480B6 = eax_144;
	fn080482D0(g_dw804831D, 0x03, &g_b80480BD);
	int32 ecx_172 = g_dw8048321 - ((uint32) ((uint64) g_dw8048315 % 0x07) - 0x01);
	int32 ecx_173 = ecx_172;
	if (ecx_172 < 0x00)
		ecx_173 = ecx_172 + 0x07;
	word32 ecx_180 = ecx_173 + 0x01;
	byte * edi_183 = &g_b80480D8;
	do
	{
		edi_183 += 3;
		--ecx_180;
	} while (ecx_180 != 0x00);
	word16 * esi_190 = &g_w804804C;
	if (g_dw8048335 == 0x01)
		esi_190 = &g_w8048066;
	word16 * esi_205 = esi_190 + 1;
	uint32 edx_209 = (uint32) *esi_190;
	word16 eax_16_16_219 = 0x00;
	word32 ecx_211 = g_dw8048319 + 0x01;
	do
	{
		uint32 eax_220 = SEQ(eax_16_16_219, *esi_205);
		++esi_205;
		edx_209 = eax_220;
		eax_16_16_219 = SLICE(edx_311, word16, 16);
		--ecx_211;
		edx_311 = edx_209;
	} while (ecx_211 != 0x00);
	word32 edx_225 = eax_220 - edx_311;
	word32 ecx_229 = edx_225;
	do
	{
		fn080482D0(edx_225 + 0x01 - ecx_229, 0x01, edi_183);
		edi_183 += 3;
		--ecx_229;
	} while (ecx_229 != 0x00);
	__syscall(0x80);
	__syscall(0x80);
	fn080482D0(0x01, 0x00, edi_183);
}

// 080482D0: void fn080482D0(Register uint32 eax, Register word32 ebx, Register (ptr32 byte) edi)
// Called from:
//      fn08048158
void fn080482D0(uint32 eax, word32 ebx, byte * edi)
{
	word32 ecx_28 = ebx;
	do
	{
		uint64 edx_eax_35 = (uint64) eax;
		*edi = (byte) (edx_eax_35 % 0x0A) + 0x30;
		uint32 eax_39 = (uint32) (edx_eax_35 /u 0x0A);
		--edi;
		eax = eax_39;
		byte al_59 = (byte) eax_39;
		--ecx_28;
	} while (ecx_28 != 0x00);
	if (eax_39 != 0x00)
		*edi = al_59 + 0x30;
}

// 080482EC: Register ui32 fn080482EC(Register (ptr32 byte) esi)
// Called from:
//      fn08048158
ui32 fn080482EC(byte * esi)
{
	ui32 edx_20 = 0x00;
	while (true)
	{
		cu8 al_12 = *esi;
		++esi;
		uint32 eax_24 = (uint32) (al_12 - 0x30);
		if (al_12 < 0x30)
			break;
		edx_20 = edx_20 * 0x0A + eax_24;
	}
	return edx_20;
}

uint32 g_dw8048301 = 0x00; // 08048301
word32 g_dw8048315 = 0x00; // 08048315
word32 g_dw8048319 = 0x00; // 08048319
uint32 g_dw804831D = 0x00; // 0804831D
uint32 g_dw8048321 = 0x00; // 08048321
word32 g_dw8048335 = 0x00; // 08048335
