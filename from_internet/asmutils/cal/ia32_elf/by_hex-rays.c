/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __fastcall __noreturn start(struct timezone *);
// void __usercall sub_80482D0(unsigned int a1@<eax>, int a2@<ebx>, _BYTE *a3@<edi>);
// void __usercall sub_80482EC(unsigned __int8 *a1@<esi>);

//-------------------------------------------------------------------------
// Data declarations

__int16 word_804804C[] = { 0 }; // weak
int dword_8048080[12] =
{
  544104778,
  543319366,
  544366925,
  544370753,
  544825677,
  544109898,
  543978826,
  543651137,
  544236883,
  544498511,
  544632654,
  543384900
}; // weak
int dword_80480B0[10] =
{
  538976288,
  538976288,
  538976288,
  538976288,
  538976288,
  544559882,
  1411411789,
  1700208757,
  543708192,
  1394635334
}; // weak
__int16 word_80480DA = 8224; // weak
struct timeval tv; // idb
int dword_8048315; // weak
int dword_8048319; // weak
int dword_804831D; // weak
int dword_8048321; // weak
int dword_8048335; // weak


//----- (08048158) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall __noreturn start(struct timezone *a1)
{
  int v1; // edx
  int v2; // ebx
  int v3; // edx
  int v4; // eax
  int v5; // eax
  unsigned int v6; // ebx
  int v7; // eax
  __int16 *v8; // esi
  int v9; // ecx
  _WORD *v10; // esi
  int *v11; // esi
  unsigned int v12; // ecx
  __int16 *v13; // edi
  __int16 *v14; // esi
  _WORD *v15; // esi
  int v16; // eax
  int v17; // edx
  int v18; // ecx
  int v19; // et1
  int v20; // edx
  int v21; // ecx
  int v22; // ecx
  int v23; // eax
  int v24; // eax
  int v25; // [esp-10h] [ebp-10h]
  unsigned __int8 *v26; // [esp-8h] [ebp-8h]
  unsigned __int8 *v27; // [esp-4h] [ebp-4h]

  if ( v25 == 3 )
  {
    sub_80482EC(v26);
    v2 = v1 - 1;
    sub_80482EC(v27);
    v4 = 31536000 * (v3 - 1970);
    HIWORD(v3) = (31536000 * (unsigned __int64)(unsigned int)(v3 - 1970)) >> 48;
    LOWORD(v3) = word_804804C[v2];
    tv.tv_sec = v4 + 86400 * (v3 + 20);
  }
  else
  {
    v5 = sys_gettimeofday(&tv, a1);
  }
  dword_8048321 = ((tv.tv_sec - 18000) / 0x15180u + 4) % 7;
  dword_804831D = (tv.tv_sec - 18000) / 0x15180u / 0x16D + 1970;
  v6 = (tv.tv_sec - 18000) / 0x15180u % 0x16D - ((tv.tv_sec - 18000) / 0x15180u / 0x16D + 2) / 4;
  HIWORD(v7) = HIWORD(dword_804831D);
  v8 = word_804804C;
  if ( !(((tv.tv_sec - 18000) / 0x15180u / 0x16D + 2) % 4) )
  {
    ++v6;
    v8 = &word_804804C[13];
    dword_8048335 = 1;
  }
  v9 = 12;
  v10 = v8 + 11;
  do
  {
    LOWORD(v7) = *v10--;
    if ( (__int16)v6 > (__int16)v7 )
      break;
    --v9;
  }
  while ( v9 );
  dword_8048319 = v9 - 1;
  LOWORD(v6) = v6 - v7;
  dword_8048315 = v6 + 1;
  v11 = dword_8048080;
  while ( v9 )
  {
    v7 = *v11++;
    --v9;
  }
  *(int *)((char *)&dword_80480B0[1] + 2) = v7;
  sub_80482D0(dword_804831D, 3, (_BYTE *)&dword_80480B0[3] + 1);
  v12 = dword_8048321 - (dword_8048315 % 7u - 1) + ((int)(dword_8048321 - (dword_8048315 % 7u - 1)) < 0 ? 7 : 0) + 1;
  v13 = &word_80480DA - 1;
  do
  {
    v13 = (__int16 *)((char *)v13 + 3);
    --v12;
  }
  while ( v12 );
  v14 = word_804804C;
  if ( dword_8048335 == 1 )
    v14 = &word_804804C[13];
  LOWORD(v16) = *v14;
  v15 = v14 + 1;
  v16 = (unsigned __int16)v16;
  v17 = (unsigned __int16)v16;
  v18 = dword_8048319 + 1;
  do
  {
    LOWORD(v16) = *v15++;
    v19 = v16;
    v16 = v17;
    v17 = v19;
    --v18;
  }
  while ( v18 );
  v20 = v17 - v16 + 1;
  v21 = v20 - 1;
  do
  {
    sub_80482D0(v20 - v21, 1, v13);
    v13 = (__int16 *)((char *)v13 + 3);
    v21 = v22 - 1;
  }
  while ( v21 );
  v23 = sys_write(1, dword_80480B0, 0xA8u);
  v24 = sys_exit(0);
}
// 8048169: positive sp value 10 has been found
// 804815C: variable 'v25' is possibly undefined
// 8048160: variable 'v26' is possibly undefined
// 8048167: variable 'v1' is possibly undefined
// 8048169: variable 'v27' is possibly undefined
// 804816E: variable 'v3' is possibly undefined
// 80482AB: variable 'v20' is possibly undefined
// 80482B5: variable 'v22' is possibly undefined
// 804804C: using guessed type __int16 word_804804C[];
// 8048080: using guessed type int dword_8048080[12];
// 80480B0: using guessed type int dword_80480B0[10];
// 80480DA: using guessed type __int16 word_80480DA;
// 8048315: using guessed type int dword_8048315;
// 8048319: using guessed type int dword_8048319;
// 804831D: using guessed type int dword_804831D;
// 8048321: using guessed type int dword_8048321;
// 8048335: using guessed type int dword_8048335;

//----- (080482D0) --------------------------------------------------------
void __usercall sub_80482D0(unsigned int a1@<eax>, int a2@<ebx>, _BYTE *a3@<edi>)
{
  do
  {
    *a3++ = a1 % 0xA + 48;
    a1 /= 0xAu;
    --a2;
  }
  while ( a2 );
  if ( a1 )
    *a3 = a1 + 48;
}

//----- (080482EC) --------------------------------------------------------
void __usercall sub_80482EC(unsigned __int8 *a1@<esi>)
{
  int v1; // eax
  int i; // edx
  unsigned __int8 v3; // al
  bool v4; // cf

  v1 = 0;
  for ( i = 0; ; i = v1 + 10 * i )
  {
    v3 = *a1++;
    v4 = v3 < 0x30u;
    LOBYTE(v1) = v3 - 48;
    if ( v4 )
      break;
  }
}

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
