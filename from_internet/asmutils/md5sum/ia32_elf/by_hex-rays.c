/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(char *@<esi>);
void sub_80482B3();
// int __usercall sub_80482E2@<eax>(int@<eax>, int@<edx>, int@<ecx>, int@<ebx>, int@<edi>, int@<esi>);
void sub_804831C();
// void __usercall sub_80483B8(signed int@<ecx>, char *@<esi>);
// void __usercall sub_804841F(char *@<edi>);

//-------------------------------------------------------------------------
// Data declarations

int (*off_8048123)() = &sub_80482E2; // weak
char byte_8048483; // weak
char byte_8048493[]; // weak
char byte_804849B; // weak
char byte_80484DB; // weak
char byte_804A4DB; // weak
char byte_804A4EB; // weak
int dword_804A50F; // weak


//----- (0804804C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn start(char *a1@<esi>)
{
  mode_t v1; // edx
  int v2; // edi
  int v3; // ebp
  int v4; // eax
  signed int v5; // eax
  int v6; // ecx
  char *v7; // esi
  char *v8; // edi
  char v9; // al
  int v10; // edx
  char v11; // ah
  char v12; // al
  int v13; // eax
  int v14; // ecx
  char *v15; // ecx
  size_t v16; // edx
  int v17; // eax
  int v18; // eax
  char *v19; // [esp-24h] [ebp-24h]
  mode_t v20; // [esp-1Ch] [ebp-1Ch]
  int v21; // [esp-Ch] [ebp-Ch]
  int v22; // [esp-8h] [ebp-8h]
  char *v23; // [esp-4h] [ebp-4h]

  sub_80482B3();
  v2 = 0;
  v3 = 0;
  if ( v21 == 1 )
    goto LABEL_6;
  while ( 1 )
  {
    while ( 1 )
    {
      if ( !v23 )
        v4 = sys_exit(0);
      dword_804A50F = (int)v23;
      v3 = sys_open(v23, 0, v1);
      if ( v3 >= 0 )
        break;
LABEL_5:
      ++v2;
    }
    while ( 1 )
    {
LABEL_6:
      v5 = sys_read(v3, &byte_80484DB, 0x2000u);
      if ( v5 < 0 )
        goto LABEL_5;
      if ( !v5 )
        break;
      a1 = &byte_80484DB;
      sub_80483B8(v5, &byte_80484DB);
    }
    v23 = a1;
    v22 = v2;
    v20 = v1;
    sub_804841F(&byte_804A4DB);
    v6 = 16;
    v7 = &byte_804A4DB;
    v8 = &byte_804A4DB + 16;
    do
    {
      v9 = *v7++;
      v10 = 2;
      v11 = v9;
      do
      {
        v11 = __ROL1__(v11, 4);
        v12 = (v11 & 0xF) + 48;
        if ( v12 > 57 )
          v12 = (v11 & 0xF) + 87;
        *v8++ = v12;
        --v10;
      }
      while ( v10 );
      --v6;
    }
    while ( v6 );
    *(_DWORD *)v8 = 170729504;
    v13 = sys_write(1, &byte_804A4EB, 0x22u);
    sub_80482B3();
    v15 = (char *)(v14 + 34);
    v16 = 2;
    if ( dword_804A50F )
    {
      v19 = v15;
      v17 = sys_write(1, (const void *)dword_804A50F, strlen((const char *)dword_804A50F));
      v15 = v19 + 1;
      v16 = 1;
    }
    v18 = sys_write(1, v15, v16);
    v1 = v20;
    v2 = v22;
    a1 = v23;
  }
}
// 804805B: positive sp value C has been found
// 8048058: variable 'v21' is possibly undefined
// 804805D: variable 'v23' is possibly undefined
// 8048071: variable 'v1' is possibly undefined
// 80480EF: variable 'v14' is possibly undefined
// 80484DB: using guessed type char byte_80484DB;
// 804A4DB: using guessed type char byte_804A4DB;
// 804A4EB: using guessed type char byte_804A4EB;
// 804A50F: using guessed type int dword_804A50F;

//----- (080482B3) --------------------------------------------------------
void sub_80482B3()
{
  *(_DWORD *)&byte_8048483 = 1732584193;
  *((_DWORD *)&byte_8048483 + 1) = -271733879;
  *((_DWORD *)&byte_8048483 + 2) = -1732584194;
  *((_DWORD *)&byte_8048483 + 3) = 271733878;
  *((_DWORD *)&byte_8048483 + 4) = 0;
  *((_DWORD *)&byte_8048483 + 5) = 0;
  memset(&byte_804849B, 0, 0x40u);
}
// 8048483: using guessed type char byte_8048483;
// 804849B: using guessed type char byte_804849B;

//----- (080482E2) --------------------------------------------------------
int __usercall sub_80482E2@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  return a4
       + __ROL4__(
           *(_DWORD *)(a5 + 4 * *(unsigned __int8 *)(a6 + 4)) + *(_DWORD *)a6 + (~a4 & a2 | a4 & a3) + a1,
           *(_BYTE *)(a6 + 5));
}

//----- (0804831C) --------------------------------------------------------
void sub_804831C()
{
  int (**v0)(); // esi
  int v1; // ecx
  int (*v2)(void); // eax
  int v3; // ecx
  int v4; // [esp-3Ch] [ebp-3Ch]
  int v5; // [esp-38h] [ebp-38h]
  int (*v6)(void); // [esp-34h] [ebp-34h]
  int v7; // [esp-30h] [ebp-30h]
  int v8; // [esp-2Ch] [ebp-2Ch]
  int v9; // [esp-28h] [ebp-28h]
  int v10; // [esp-24h] [ebp-24h]

  v9 = *((_DWORD *)&byte_8048483 + 1);
  v8 = *((_DWORD *)&byte_8048483 + 2);
  v7 = *((_DWORD *)&byte_8048483 + 3);
  v0 = &off_8048123;
  v1 = 4;
  do
  {
    v5 = v1;
    v2 = *v0++;
    v6 = v2;
    v3 = 4;
    do
    {
      v4 = v3;
      v10 = ((int (__fastcall *)(int, int))v6)(v8, v7);
      v7 = ((int (__fastcall *)(int, int))v6)(v9, v8);
      v8 = ((int (__fastcall *)(int, int))v6)(v10, v9);
      v9 = v6();
      v3 = v4 - 1;
    }
    while ( v4 != 1 );
    v1 = v5 - 1;
  }
  while ( v5 != 1 );
  *(_DWORD *)&byte_8048483 += v10;
  *((_DWORD *)&byte_8048483 + 1) += v9;
  *((_DWORD *)&byte_8048483 + 2) += v8;
  *((_DWORD *)&byte_8048483 + 3) += v7;
}
// 8048123: using guessed type int (*off_8048123)();
// 8048483: using guessed type char byte_8048483;

//----- (080483B8) --------------------------------------------------------
void __usercall sub_80483B8(signed int a1@<ecx>, char *a2@<esi>)
{
  unsigned int v2; // edx
  int v3; // edx
  char *v4; // edi
  signed int v5; // edx
  int v6; // edx
  signed int v7; // [esp-24h] [ebp-24h]
  signed int v8; // [esp-24h] [ebp-24h]

  v2 = *(_DWORD *)byte_8048493;
  *(_DWORD *)byte_8048493 += 8 * a1;
  if ( *(_DWORD *)byte_8048493 < v2 )
    ++*(_DWORD *)&byte_8048493[4];
  *(_DWORD *)&byte_8048493[4] += (unsigned int)a1 >> 29;
  v3 = (v2 >> 3) & 0x3F;
  if ( v3 )
  {
    v4 = &byte_8048493[v3 + 8];
    v5 = 64 - v3;
    if ( a1 < v5 )
      goto LABEL_9;
    v7 = a1;
    qmemcpy(v4, a2, v5);
    a2 += v5;
    sub_804831C();
    a1 = v7 - v6;
  }
  v4 = &byte_804849B;
  while ( a1 >= 64 )
  {
    v8 = a1;
    qmemcpy(&byte_804849B, a2, 0x40u);
    a2 += 64;
    sub_804831C();
    a1 = v8 - 64;
  }
LABEL_9:
  qmemcpy(v4, a2, a1);
}
// 80483FC: variable 'v6' is possibly undefined
// 804849B: using guessed type char byte_804849B;

//----- (0804841F) --------------------------------------------------------
void __usercall sub_804841F(char *a1@<edi>)
{
  int v1; // edx
  char *v2; // edi
  unsigned int v3; // edx
  void *v4; // edi
  int v5; // eax

  v1 = (*(_DWORD *)byte_8048493 >> 3) & 0x3F;
  v2 = &byte_8048493[v1 + 8];
  *v2 = 0x80;
  v3 = 63 - v1;
  v4 = v2 + 1;
  if ( v3 > 7 )
  {
    memset(v4, 0, v3 - 8);
  }
  else
  {
    memset(v4, 0, v3);
    sub_804831C();
    memset32(&byte_804849B, v5, 0xEu);
  }
  *((_DWORD *)&byte_804849B + 14) = *(_DWORD *)byte_8048493;
  *((_DWORD *)&byte_804849B + 15) = *(_DWORD *)&byte_8048493[4];
  sub_804831C();
  qmemcpy(a1, &byte_8048493[-16], 0x10u);
}
// 804841F: could not find valid save-restore pair for edi
// 8048456: variable 'v5' is possibly undefined
// 804849B: using guessed type char byte_804849B;

// nfuncs=6 queued=6 decompiled=6 lumina nreq=0 worse=0 better=0
// ALL OK, 6 function(s) have been successfully decompiled
