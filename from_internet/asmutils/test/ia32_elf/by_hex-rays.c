/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall sub_804805C@<eax>(_BYTE *@<esi>);
void __noreturn start(); // weak

//-------------------------------------------------------------------------
// Data declarations

char byte_804826D[3] = { 'b', '\0', '`' }; // weak
struct stat buf; // idb


//----- (0804805C) --------------------------------------------------------
int __usercall sub_804805C@<eax>(_BYTE *a1@<esi>)
{
  int v1; // eax
  int v2; // edx

  v1 = 0;
  v2 = 0;
  do
    LOBYTE(v1) = *a1++;
  while ( (char)v1 <= 33 );
  while ( (char)v1 > 47 )
  {
    if ( (char)v1 > 58 )
      break;
    LOBYTE(v1) = v1 - 48;
    v2 += v1;
    LOBYTE(v1) = *a1++;
    if ( (char)v1 <= 47 || (char)v1 > 58 )
      break;
    v2 *= 10;
  }
  return v2;
}

//----- (08048082) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn start()
{
  int v0; // eax
  int v1; // eax
  int v2; // ebp
  __int16 v3; // ax
  int v4; // eax
  int v5; // eax
  char v6; // bl
  char *v7; // edx
  char v8; // bl
  char *v9; // esi
  char v10; // al
  _DWORD *v11; // esi
  int v12; // ecx
  int v13; // eax
  _BYTE *v14; // esi
  unsigned int v15; // ecx
  char *v16; // edi
  bool v17; // zf
  int v18; // eax
  int v19; // eax
  int v20; // [esp-14h] [ebp-14h]
  char *v21; // [esp-Ch] [ebp-Ch]
  int v22; // [esp-8h] [ebp-8h]
  _BYTE *v23; // [esp-4h] [ebp-4h]
  int v24; // [esp-4h] [ebp-4h]
  int v25; // [esp-4h] [ebp-4h]

  if ( v20 == 1 )
    goto LABEL_62;
  v2 = 0;
  if ( *v21 == 45 )
  {
    v6 = v21[1];
    if ( !v22 )
      goto LABEL_62;
    if ( v6 != 122 )
    {
      if ( v6 != 110 )
      {
        if ( v6 == 116 )
        {
          if ( sys_ioctl(sub_804805C((_BYTE *)v22), 21505) < 0 )
            goto LABEL_62;
          goto LABEL_61;
        }
        if ( sys_newlstat((const char *)v22, &buf) < 0 )
          goto LABEL_62;
        v8 = v21[1];
        switch ( v8 )
        {
          case 's':
            if ( !buf.st_nlink )
              goto LABEL_61;
            goto LABEL_62;
          case 'r':
            v12 = 0;
            break;
          case 'w':
            v12 = 1;
            break;
          default:
            v9 = byte_804826D;
            while ( 1 )
            {
              v10 = *v9;
              v11 = v9 + 1;
              if ( v10 == v8 )
                break;
              v9 = (char *)(v11 + 1);
              if ( !v10 )
                goto LABEL_63;
            }
            if ( *v11 == (*v11 & *(_DWORD *)&buf.__pad1) )
              goto LABEL_61;
            goto LABEL_62;
        }
        if ( sys_open(v7, v12, (mode_t)v7) < 0 )
          goto LABEL_62;
        goto LABEL_61;
      }
      v2 = 1;
    }
    if ( !v2 )
      goto LABEL_61;
    goto LABEL_62;
  }
  if ( *v21 != 33 )
  {
    if ( !v22 )
      goto LABEL_63;
    if ( *(_BYTE *)v22 == 61 )
      goto LABEL_54;
    if ( *(_WORD *)v22 == 15649 )
    {
LABEL_53:
      v2 = 1;
      goto LABEL_54;
    }
    if ( *(_BYTE *)v22 == 45 )
    {
      v3 = *(_WORD *)(v22 + 1);
      if ( *(_BYTE *)(v22 + 3) )
        goto LABEL_63;
      if ( v3 != 29029 )
      {
        if ( v3 != 25966 )
        {
          if ( v3 != 29799 )
          {
            if ( v3 != 25959 )
            {
              if ( v3 != 29804 )
              {
                if ( v3 != 25964 )
LABEL_63:
                  v0 = sys_exit(2);
                v2 = 2;
              }
              v25 = sub_804805C(v23);
              v5 = sub_804805C(v21);
              if ( v2 != 2 )
              {
                if ( v5 >= v25 )
                  goto LABEL_62;
LABEL_61:
                v18 = sys_exit(0);
              }
              if ( v5 <= v25 )
                goto LABEL_61;
LABEL_62:
              v19 = sys_exit(1);
            }
            v2 = 2;
          }
          v24 = sub_804805C(v23);
          v4 = sub_804805C(v21);
          if ( v2 == 2 )
          {
            if ( v4 < v24 )
              goto LABEL_62;
          }
          else if ( v4 <= v24 )
          {
            goto LABEL_62;
          }
          goto LABEL_61;
        }
        goto LABEL_53;
      }
LABEL_54:
      v13 = 0;
      v14 = v23;
      v15 = strlen(v21) + 1;
      v16 = v21;
      do
      {
        if ( !v15 )
          break;
        v17 = *v14++ == (unsigned __int8)*v16++;
        --v15;
      }
      while ( v17 );
      if ( !*(v16 - 1) && !*(v14 - 1) )
        v13 = 1;
      if ( v2 != v13 )
        goto LABEL_61;
      goto LABEL_62;
    }
  }
  v1 = sys_exit(3);
}
// 8048110: positive sp value 14 has been found
// 8048086: variable 'v20' is possibly undefined
// 8048090: variable 'v21' is possibly undefined
// 80480A1: variable 'v22' is possibly undefined
// 8048110: variable 'v23' is possibly undefined
// 8048225: variable 'v7' is possibly undefined
// 8048082: using guessed type void __noreturn start();

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
