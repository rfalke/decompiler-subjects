// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Register byte al, Register word16 eax_16_16, Stack int32 dwArg00, Stack int32 dwArg04, Stack (ptr32 byte) dwArg08, Stack (ptr32 word32) dwArg0C)
void fn0804804C(byte al, word16 eax_16_16, int32 dwArg00, int32 dwArg04, byte * dwArg08, word32 * dwArg0C)
{
	ptr32 fp;
	bool C;
	struct Eq_10 * esp_205;
	int32 ebx_207 = dwArg00 - 0x02;
	bool v46_226 = dwArg00 < 0x02;
	if (dwArg00 >= 0x02)
	{
		al = (byte) dwArg08;
		eax_16_16 = SLICE(dwArg08, word16, 16);
		C = SLICE(cond(*dwArg08 - 0x2D), bool, 1);
		if (*dwArg08 != 0x2D)
			goto l08048074;
		int32 eax_26 = sys_read(0x00, &g_b80480D7, 0x0FFF);
		dwArg08 = &g_b80480D7;
		dwArg04 = dwArg00 - 0x02;
		ebx_207 = 0x00;
		al = (byte) eax_26;
		eax_16_16 = SLICE(eax_26, word16, 16);
		v46_226 = eax_26 < 0x00;
		C = false;
	}
	esp_205 = fp + 4;
	if (v46_226)
		goto l080480D2;
	ebx_207 = dwArg04;
l08048074:
	byte * edi_101 = dwArg08;
	ptr32 esp_195 = fp + 0x0C;
	word32 eax_47 = SEQ(eax_16_16, 0x2E, al);
	if (ebx_207 >= 0x01)
	{
		eax_47 = *dwArg0C;
		byte ah_48 = SLICE(eax_47, byte, 8);
		byte al_49 = (byte) eax_47;
		esp_195 = fp + 16;
		word16 eax_16_16_70 = SLICE(eax_47, word16, 16);
		bool C_53 = SLICE(cond(ah_48 - al_49), bool, 1);
		if (ah_48 != al_49)
		{
			C_53 = true;
			eax_47 = SEQ(eax_16_16_70, al_49, al_49);
		}
		C = !C_53;
	}
	word32 eax_80 = __ror<word32,byte>(__rcl<word32,byte>(eax_47, 0x01, C), 0x01);
	byte ah_134 = SLICE(eax_80, byte, 8);
	word32 ecx_86 = ~0x00;
	while (ecx_86 != 0x00)
	{
		++edi_101;
		--ecx_86;
		if (*edi_101 != 0x00)
			break;
	}
	word32 ecx_98 = ~ecx_86;
	byte * edi_102 = edi_101 - 0x01;
	bool v49_229 = ecx_98 == 0x01;
	ecx_105 = ecx_98;
	do
	{
		word32 ecx_105;
		if (ecx_105 == 0x00)
			break;
		v49_229 = *edi_102 == 0x2F;
		--edi_102;
		--ecx_105;
	} while (*edi_102 == 0x2F);
	if (!v49_229)
		--edi_102;
	word32 edx_124 = ecx_98 - 0x01 - ecx_105;
	word32 ecx_126 = edx_124;
	byte * edi_136 = edi_102 + (edx_124 + 2) - 0x01;
	bool v53_233 = edx_124 == 0x01;
	word24 eax_24_8_169 = SLICE(eax_80, word24, 8);
	do
	{
		int32 eax_161 = SEQ(eax_24_8_169, ah_134);
		if (ecx_126 == 0x00)
			break;
		v53_233 = ah_134 == *edi_136;
		++edi_136;
		--ecx_126;
		eax_161 = SEQ(eax_24_8_169, ah_134);
	} while (ah_134 == *edi_136);
	if (!v53_233)
	{
l080480AF:
		ecx_126 = edx_124;
	}
	if (ecx_126 != 0x00)
	{
		int32 eax_173 = eax_161 >> 0x1F;
		int32 edx_179 = edx_124 - 0x01 - ((ecx_126 - 0x01) - eax_173);
		char * ecx_184 = edi_136 + 1 - eax_173;
		ecx_184[edx_179] = 0x0A;
		uint32 * esp_198 = esp_195 - 4;
		*esp_198 = 0x01;
		uint32 ebx_200 = *esp_198;
		*esp_198 = 0x04;
		sys_write(ebx_200, ecx_184, edx_179 + 0x01);
		esp_205 = (struct Eq_10 *) (esp_198 + 1);
		ebx_207 = 0x00;
l080480D2:
		esp_205->dwFFFFFFFC = 0x01;
		sys_exit(ebx_207);
	}
	goto l080480AF;
}

char g_b80480D7 = '\0'; // 080480D7
