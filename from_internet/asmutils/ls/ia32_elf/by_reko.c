// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C()
void fn0804804C()
{
	g_dw8048440 = 0x080534AC;
	__syscall(0x80);
	g_b8048457 = 0x36;
	struct Eq_13 * ebp_3 = &g_t804845B;
	word32 * esp_23 = fp + 8;
	while (true)
	{
		struct Eq_19 * esi_26 = *esp_23;
		++esp_23;
		struct Eq_19 * esi_141 = esi_26;
		if (esi_26 == null)
			break;
		if (Mem25[esi_26 + 0x00:byte] != 0x2D)
			goto l080480A3;
		byte * esi_105 = esi_26 + 1;
		if (Mem25[esi_26 + 0x00:byte] == Mem25[esi_26 + 1:byte])
		{
			struct Eq_19 * esi_38 = *esp_23;
			++esp_23;
			esi_141 = esi_38;
			if (esi_38 == null)
				break;
			goto l080480A3;
		}
		while (true)
		{
			byte al_107 = *esi_105;
			++esi_105;
			if (al_107 == 0x00)
				break;
			byte * edi_113 = &g_b80483E8;
			struct Eq_71 * ecx_115 = (struct Eq_71 *) 0x0C;
			while (ecx_115 != null)
			{
				edi_113 = edi_148 + 1;
				--ecx_115;
				edi_148 = edi_113;
				if (al_107 != *edi_148)
					break;
			}
			ecx_115[0x0804844C] = (struct Eq_71) al_107;
			if (al_107 == 0x43)
				g_dw8048456 = 0x00;
		}
	}
	struct Eq_19 * esp_45 = esp_23 - 4;
	Mem46[esp_45 + 0x00:word32] = 0x2E;
	esp_45->dwFFFFFFFC = 0x00;
	esi_141 = esp_45;
l080480A3:
	do
	{
		ebp_3 = fn080480C7(ebp_3, esi_141);
		struct Eq_13 * esp_63 = (struct Eq_13 *) <invalid>;
		struct Eq_19 * esi_72 = esp_63->ptr0004;
		esi_141 = esi_72;
	} while (esi_72 != null);
	ebp_3->tFFFFFFFD.u0 = 0x3A;
	fn08048395(ebp_3, &g_t80534AC);
	esp_63->ptr0004 = (struct Eq_19 *) 0x01;
	__syscall(0x80);
	fn080480C7(ebp_3, &g_t80534AC);
}

// 080480C7: Register (ptr32 Eq_13) fn080480C7(Register (ptr32 Eq_13) ebp, Register (ptr32 Eq_19) esi)
// Called from:
//      fn0804804C
//      fn08048395
struct Eq_13 * fn080480C7(struct Eq_13 * ebp, struct Eq_19 * esi)
{
	ebp->b0000 = 0x0A;
	word32 edi_13 = ebp + 1;
	do
	{
		byte al_11 = Mem10[esi + 0x00:byte];
		*edi_13 = al_11;
		++esi;
		++edi_13;
	} while (al_11 != 0x00);
	word32 edi_29 = edi_13 - (ebp + 1);
	word32 edx_37;
	byte al_365;
	word32 ebx_366;
	fn0804827F(ebp, ebp + 1, edi_29 - 0x01, out al_365, out edx_37, out ebx_366);
	struct Eq_13 * eax_34 = (struct Eq_13 *) <invalid>;
	word32 esi_155 = ebp + 1;
	bool Z_40 = <invalid>;
	bool C_39 = <invalid>;
	byte al_60 = (byte) eax_34;
	if (C_39)
	{
		fn080480F2(ebp, ebp + 1);
		return ebp;
	}
	else if (Z_40)
	{
		fn0804810A(ebp, ebp + 1, edi_29 - 0x01);
		return ebp;
	}
	else if (al_60 != ebp->bFFFFFFF2)
	{
		fn0804810A(ebp, ebp + 1, edi_29 - 0x01);
		return ebp;
	}
	else if (edx_37 == 0x00)
	{
		__syscall(0x80);
		Eq_105 eax_87 = ebp->tFFFFFFFD;
		Eq_187 al_88 = (byte) eax_87;
		byte ah_96 = SLICE(eax_87, byte, 8);
		word16 eax_16_16_101 = SLICE(eax_87, word16, 16);
		if (al_88 != 0x00)
		{
			ebp->tFFFFFFFE = al_88;
			Mem103[ebp + 1 + (edi_29 - 0x01):word32] = SEQ(eax_16_16_101, 0x0A, al_88);
			__syscall(0x80);
		}
		Mem121[ebp + 1 + (edi_29 - 0x01):byte] = 0x2F;
		int32 edi_122 = edi_29;
		word32 ebx_125 = 0x05;
		ptr32 esp_126 = fp - 4;
		while (true)
		{
			__syscall(0x80);
			ptr32 ecx_127 = 134550700;
			int32 eax_134 = 141;
			int32 edx_181 = 0x2000;
			do
			{
				struct Eq_221 * esp_174 = esp_126 - 4;
				esp_174->dw0000 = eax_134;
				esp_174->ptrFFFFFFFC = ecx_127;
				esp_174->dwFFFFFFF8 = edx_181;
				esp_174->dwFFFFFFF4 = ebx_125;
				esp_174->ptrFFFFFFF0 = esp_126;
				esp_174->ptrFFFFFFEC = ebp;
				esp_174->ptrFFFFFFE8 = esi_155;
				esp_174->dwFFFFFFE4 = edi_122;
				struct Eq_19 * esi_201 = ecx_127 + 0x0A;
				esp_174->ptrFFFFFFE0 = esi_201;
				word32 edx_211 = SLICE((int64) eax_134, word32, 32);
				byte * edi_198 = edi_122 + esi_155;
				do
				{
					byte al_206 = Mem205[esi_201 + 0x00:byte];
					*edi_198 = al_206;
					++esi_201;
					++edi_198;
					++edx_211;
				} while (al_206 != 0x00);
				struct Eq_19 * edi_217 = edx_211 - 0x01;
				struct Eq_19 * esi_219 = esp_174->ptrFFFFFFE0;
				struct Eq_284 * esp_220 = esp_174 - 28;
				if (Mem209[esi_219 + 0x00:byte] != 0x2E || al_206 != ebp->bFFFFFFF3)
				{
					word32 edx_371;
					byte al_370;
					struct Eq_294 * ebx_230;
					fn0804827F(ebp, esi_219, edx_211 - 0x01, out al_370, out edx_371, out ebx_230);
					struct Eq_13 * eax_229 = (struct Eq_13 *) <invalid>;
					bool Z_235 = <invalid>;
					bool C_234 = <invalid>;
					byte al_237 = (byte) eax_229;
					if (C_234)
						goto l08048347;
					if (!Z_235 && al_237 != ebp->bFFFFFFF6)
					{
						esp_174->ptrFFFFFFE0 = esi_219;
						struct Eq_357 * esp_242 = esp_174 - 32;
						if (Mem243[esi_219 + 0x00:byte] == 0x2E)
						{
							Eq_22 al_248 = esi_219[1];
							if (al_248 == 0x2E)
								al_248 = esi_219[2];
							if (al_248 != 0x00)
								goto l08048338;
						}
						else
						{
l08048338:
							esp_174->dwFFFFFFDC = edx_211 - 0x01;
							fn080480F2(ebp, ebx_230);
							edi_217 = esp_174->ptrFFFFFFE0;
							esp_242 = esp_174 - 0x1C;
						}
						esi_219 = esp_242->dw0000;
						esp_220 = (struct Eq_284 *) (&esp_242->dw0000 + 1);
					}
					fn0804810A(ebp, esi_219, edi_217);
					esp_220 = &esp_220->dw0000 + 1;
				}
l08048347:
				struct Eq_310 * esp_307 = &esp_220->dw0000 + 1;
				struct Eq_313 * ecx_317 = esp_307->ptr0014;
				edx_181 = (word32) ecx_317->w0008;
				edi_122 = esp_220->dw0000;
				esi_155 = esp_307->ptr0000;
				ebp = esp_307->ptr0004;
				ebx_125 = esp_307->dw000C;
				esp_126 = &esp_307->dw0018 + 1;
				ecx_127 = ecx_317 + edx_181 / 0x0A;
				eax_134 = esp_307->dw0018 - edx_181;
			} while (eax_134 > 0x00);
		}
	}
	else
	{
		fn080480F2(ebp, ebp + 1);
		return ebp;
	}
}

// 080480F2: void fn080480F2(Register (ptr32 Eq_13) ebp, Register (ptr32 Eq_294) esi)
// Called from:
//      fn080480C7
void fn080480F2(struct Eq_13 * ebp, struct Eq_294 * esi)
{
	struct Eq_19 * edi_10 = ebp->ptrFFFFFFE5;
	do
	{
		byte al_8 = Mem7[esi + 0x00:byte];
		Mem11[edi_10 + 0x00:byte] = al_8;
		++esi;
		++edi_10;
	} while (al_8 != 0x00);
	ebp->ptrFFFFFFE5 = edi_10;
	__syscall(0x80);
}

// 0804810A: void fn0804810A(Register (ptr32 Eq_13) ebp, Register (ptr32 Eq_19) esi, Register (ptr32 Eq_19) edi)
// Called from:
//      fn080480C7
void fn0804810A(struct Eq_13 * ebp, struct Eq_19 * esi, struct Eq_19 * edi)
{
	int64 edx_eax_16 = (int64) edi;
	byte * edi_14 = &g_b804946C;
	byte dh_17 = SLICE(edx_eax_16, byte, 40);
	word24 edx_24_8_23 = SLICE(edx_eax_16, word24, 40);
	word24 eax_24_8_68 = SLICE(edx_eax_16, word24, 8);
	if (dh_17 != ebp->bFFFFFFF7)
	{
		Eq_458 eax_21 = ebp->tFFFFFFA9;
		fn080483B9(eax_21, SEQ(edx_24_8_23, 0x08), &g_b804946C);
		g_b804946C = 0x20;
		eax_24_8_68 = SLICE(eax_21, word24, 8);
		edi_14 = &g_b804946D;
	}
	word24 edx_24_8_44 = SLICE(edx_eax_16, word24, 40);
	if (dh_17 != ebp->bFFFFFFF9)
	{
		uint32 eax_38 = ebp->dwFFFFFFC1;
		fn080483B9(eax_38 >> 0x01, SEQ(edx_24_8_44, 0x04), edi_14);
		*edi_14 = 0x20;
		eax_24_8_68 = SLICE(eax_38 >> 0x01, word24, 8);
		++edi_14;
	}
	word16 eax_16_16_278 = SLICE(eax_24_8_68, word16, 8);
	if (dh_17 != ebp->bFFFFFFFB)
	{
		ui32 edx_60 = ebp->dwFFFFFFAD;
		bcu8 dh_61 = SLICE(edx_60, byte, 8);
		*edi_14 = g_a80483DF[(uint32) (dh_61 >> 0x04)];
		byte dl_448 = (byte) edx_60;
		byte * edi_124 = edi_14 + 1;
		ui8 dh_100 = __rcr<byte,byte,bool>(dh_61, 0x01, SLICE(cond(dh_61 >> 0x04), bool, 1));
		bool v81_463 = (dh_61 & 0x02) != 0x00;
		uint32 ecx_133 = 292;
		while (true)
		{
			byte cl_90 = (byte) ecx_133;
			byte al_104 = 0x07;
			if (!v81_463)
				al_104 = cl_90 & 0x07;
			if ((cl_90 & 0x01) != 0x00)
			{
				dh_100 <<= 0x01;
				if ((dh_100 & 0x08) != 0x00)
					al_104 = (al_104 + cl_90 & 0x1F) + 0x01;
			}
			*edi_124 = g_a80483DB[(uint32) al_104];
			ecx_133 >>= 0x01;
			++edi_124;
			bool C_450 = SLICE(cond(ecx_133), bool, 1);
			if (ecx_133 == 0x00)
				break;
			dl_448 = __rcl<byte,byte,bool>(dl_448, 0x01, C_450);
			v81_463 = (dl_448 & 0x80) != 0x00;
		}
		struct Eq_630 * esp_141 = fp - 20;
		ptr32 esi_151 = ebp - 0x4F;
		do
		{
			word32 esi_159;
			word32 ebx_163;
			struct Eq_684 * ds_164;
			esp_141->ptr0000();
			esi_151 = esi_159 + 2;
		} while (ebx_163 != 0x01);
		<anonymous> * esi_173 = esp_141->ptr0000;
		if ((esp_141->b0004 & ~0x04) == 0x02)
		{
			struct Eq_729 * ds_192;
			esi_173();
		}
		struct Eq_703 * esp_200;
		word32 eax_201;
		<anonymous> * esi_202;
		word32 * edi_203;
		struct Eq_707 * ebp_205;
		struct Eq_708 * ds_207;
		esi_173();
		esp_200->dwFFFFFFFC = 0x4E;
		__syscall(0x80);
		word24 ecx_24_8_460 = SLICE(eax_201, word24, 8);
		int32 eax_217 = *edi_203 - ebp_205->dwFFFFFFCD;
		struct Eq_726 * ebx_219 = (char *) esi_202 + 61;
		do
		{
			--ebx_219;
			int64 edx_eax_221 = (int64) eax_217;
			int32 ecx_227 = SEQ(ecx_24_8_460, ebx_219[4]);
			if (ecx_227 == 0x00)
				break;
			int32 eax_236 = (int32) (edx_eax_221 /32 ecx_227);
			eax_217 = eax_236;
		} while (eax_236 != 0x00);
		word32 eax_254;
		struct Eq_731 * edi_256;
		byte ebx_259[];
		struct Eq_733 * ds_260;
		esi_202();
		edi_256->b0000 = ebx_259[(uint32) (byte) eax_254];
		edi_256->b0001 = 0x20;
		eax_16_16_278 = SLICE(eax_254, word16, 16);
		edi_14 = (byte *) (&edi_256->b0001 + 1);
	}
	union Eq_187 * edi_284;
	word32 esi_285 = fn08048354(eax_16_16_278, edi, ebp, esi, edi_14, out edi_284);
	uint32 eax_290 = ebp->dwFFFFFFAB;
	byte ah_295 = SLICE(eax_290 >> 0x1D, byte, 8);
	if ((byte) (eax_290 >> 0x1D) == 0x05 && ah_295 != ebp->bFFFFFFFB)
	{
		*edi_284 = 0x203E2D20;
		struct Eq_19 * ecx_322 = ebp->ptrFFFFFFE5;
		__syscall(0x80);
		fn08048354(SLICE(esi_285, word16, 16), (struct Eq_19 *) 0x55, ebp, ecx_322, (char *) edi_284 + 4, out edi_284);
	}
	else if (ah_295 != ebp->bFFFFFFFA)
	{
		Eq_187 al_307 = (eax_290 >> 0x1D)->t80483D5;
		if (al_307 != 0x2A || (ebp->dwFFFFFFAD & 0x49) != 0x00)
		{
			*edi_284 = (union Eq_187 *) al_307;
			++edi_284;
		}
	}
	Eq_187 al_344 = 0x0A;
	if (ebp->bFFFFFFFC == 0x00)
	{
		uint32 ecx_357 = (edi_284 - &g_b804946C >> 0x03) + 0x01;
		cu8 dl_360 = ebp->bFFFFFFFF + (byte) ecx_357;
		if (dl_360 > 0x0A)
		{
			fn080482A0(ebp);
			dl_360 = (byte) ecx_357;
		}
		al_344.u0 = 0x09;
		if (dl_360 >= 0x09)
		{
			al_344.u0 = 0x0A;
			dl_360 = 0x00;
		}
		if ((dl_360 & 0x01) != 0x00)
		{
			*edi_284 = (union Eq_187 *) al_344;
			++edi_284;
			++dl_360;
		}
		ebp->bFFFFFFFF = dl_360;
	}
	*edi_284 = (union Eq_187 *) al_344;
	ebp->tFFFFFFFE = al_344;
	__syscall(0x80);
}

// 08048261: FlagGroup byte fn08048261(Register int32 eax, Register (ptr32 Eq_13) ebp, Register (ptr32 Eq_19) esi, Register Eq_155 edi, Register out Eq_156 alOut, Register out ptr32 edxOut, Register out ptr32 ebxOut)
// Called from:
//      fn080480C7
//      fn0804827F
byte fn08048261(int32 eax, struct Eq_13 * ebp, struct Eq_19 * esi, Eq_155 edi, union Eq_156 & alOut, ptr32 & edxOut, ptr32 & ebxOut)
{
	ebp->dwFFFFFFED = eax;
	fn080482A0(ebp);
	Mem16[edi + esi:word32] = 0x0A3F3F20;
	__syscall(0x80);
	alOut.u1 = <invalid>;
	edxOut = (word32) edi.u1 + 4;
	ebxOut = 0x02;
	return <invalid>;
}

// 0804827F: FlagGroup byte fn0804827F(Register (ptr32 Eq_13) ebp, Register (ptr32 Eq_19) esi, Register Eq_155 edi, Register out Eq_156 alOut, Register out ptr32 edxOut, Register out ptr32 ebxOut)
// Called from:
//      fn080480C7
byte fn0804827F(struct Eq_13 * ebp, struct Eq_19 * esi, Eq_155 edi, union Eq_156 & alOut, ptr32 & edxOut, ptr32 & ebxOut)
{
	__syscall(0x80);
	if (Test(ULT,true))
	{
		ptr32 ebx_15;
		ptr32 edx_17;
		byte al_45;
		fn08048261(-0x006B, ebp, esi, edi, out al_45, out edx_17, out ebx_15);
		alOut.u1 = <invalid>;
		edxOut = edx_17;
		ebxOut = ebx_15;
		return <invalid>;
	}
	else
	{
		alOut.u1 = <invalid>;
		edxOut = edx;
		ebxOut = ebx;
		return <invalid>;
	}
}

// 080482A0: FlagGroup bool fn080482A0(Register (ptr32 Eq_13) ebp)
// Called from:
//      fn080480C7
//      fn0804810A
//      fn08048261
//      fn08048395
bool fn080482A0(struct Eq_13 * ebp)
{
	bool Z_9 = SLICE(cond(0x00 - ebp->bFFFFFFFF), bool, 2);
	if (ebp->bFFFFFFFF != 0x00)
	{
		ebp->bFFFFFFFF = 0x00;
		__syscall(0x80);
	}
	return Z_9;
}

// 08048354: Register (ptr32 Eq_19) fn08048354(Register word16 eax_16_16, Register (ptr32 Eq_19) ecx, Register (ptr32 Eq_13) ebp, Register (ptr32 Eq_19) esi, Register (ptr32 byte) edi, Register out (ptr32 byte) ediOut)
// Called from:
//      fn0804810A
struct Eq_19 * fn08048354(word16 eax_16_16, struct Eq_19 * ecx, struct Eq_13 * ebp, struct Eq_19 * esi, byte * edi, byte & ediOut)
{
	word32 edx_5 = ebp->dwFFFFFFF4;
	byte dl_84 = (byte) edx_5;
	byte dh_88 = SLICE(edx_5, byte, 8);
	do
	{
		byte al_8 = Mem7[esi + 0x00:byte];
		++esi;
		word32 eax_115 = SEQ(eax_16_16, ah, al_8);
		if (dl_84 == 0x00)
		{
			word24 eax_24_8_33 = SEQ(eax_16_16, 0x5C);
			word32 eax_121 = SEQ(eax_16_16, 0x5C, al_8);
			if (al_8 != 0x5C)
			{
				eax_121 = SEQ(eax_16_16, 0x5C, al_8);
				if (al_8 == 0x22)
					goto l08048385;
				word32 eax_31 = SEQ(eax_24_8_33, al_8);
				if (al_8 <= 0x7E)
				{
					eax_31 = SEQ(eax_24_8_33, al_8);
					eax_115 = SEQ(eax_16_16, 0x5C, al_8);
					if (al_8 < 0x20)
						goto l0804836E;
					goto l08048390;
				}
l0804836E:
				if (dh_88 != 0x00)
				{
					word32 eax_37 = __ror<word32,byte>(eax_31, 0x08);
					*edi = (byte) eax_37;
					uint32 eax_47 = __rol<word32,byte>(SEQ(SLICE(eax_37, word24, 8), 0x0C), 0x02);
					byte * edi_42 = edi + 1;
					*edi_42 = (byte) eax_47;
					word16 ax_53 = __aam((byte) (eax_47 >> 0x1A));
					edi = edi_42 + 1;
					eax_121 = SEQ(SLICE(eax_47 >> 0x1A, word16, 16), SLICE(ax_53 + 0x3030, byte, 8), (byte) ax_53 + 0x30);
					goto l08048385;
				}
				eax_115 = SEQ(SLICE(eax_31, word24, 8), 0x3F);
			}
			else
			{
l08048385:
				byte ah_61 = SLICE(eax_121, byte, 8);
				eax_115 = eax_121;
				if (dh_88 != 0x00)
				{
					*edi = ah_61;
					++edi;
					eax_115 = eax_121;
				}
			}
		}
l08048390:
		*edi = (byte) eax_115;
		ah = SLICE(eax_115, byte, 8);
		eax_16_16 = SLICE(eax_115, word16, 16);
		++edi;
		--ecx;
	} while (ecx != null);
	ediOut = edi;
	return esi;
}

// 08048395: Register (ptr32 Eq_13) fn08048395(Register (ptr32 Eq_13) ebp, Register (ptr32 Eq_19) esi)
// Called from:
//      fn0804804C
//      fn08048395
struct Eq_13 * fn08048395(struct Eq_13 * ebp, struct Eq_19 * esi)
{
	fn080482A0(ebp);
	struct Eq_19 * edx_13 = ebp->ptrFFFFFFE5;
	while (esi < edx_13)
	{
		struct Eq_13 * esp_31 = (struct Eq_13 *) <invalid>;
		ebp = fn08048395(fn080480C7(ebp, esi), esp_31->ptr0004);
		ebp->ptrFFFFFFE5 = edx_13;
		esi = dwLoc08;
	}
	return (struct Eq_13 *) <invalid>;
}

// 080483B9: void fn080483B9(Register Eq_458 eax, Register word32 edx, Register (ptr32 byte) edi)
// Called from:
//      fn0804810A
void fn080483B9(Eq_458 eax, word32 edx, byte * edi)
{
	word32 ecx_11 = edx;
	while (true)
	{
		word24 ecx_24_8_47 = SLICE(ecx_11, word24, 8);
		if (ecx_11 == 0x00)
			break;
		*edi = 0x20;
		++edi;
		--ecx_11;
	}
	Eq_458 eax_14 = eax;
	int32 ecx_48 = SEQ(ecx_24_8_47, 0x0A);
	do
	{
		int64 edx_eax_21 = (int64) eax_14;
		--edi;
		*edi = (byte) (edx_eax_21 % ecx_48) + 0x30;
		Eq_458 eax_27 = (int32) (edx_eax_21 /32 ecx_48);
		eax_14 = eax_27;
	} while (eax_27 != 0x00);
}

byte g_a80483DB[] = // 080483DB
	{
	};
byte g_a80483DF[] = // 080483DF
	{
	};
byte g_b80483E8 = 0x31; // 080483E8
word32 g_dw8048440 = 0x00; // 08048440
word32 g_dw8048456 = 0x00; // 08048456
byte g_b8048457 = 0x00; // 08048457
Eq_13 g_t804845B = // 0804845B
	{
		
		{
			0
		},
		0x00,
		0x00,
		0x00,
		null,
		0,
		0x00,
		0x00,
		0x00,
		0x00,
		0x00,
		0x00,
		0x00,
		0x00,
		0x00,
		
		{
			0x00
		},
		
		{
			0x00
		},
		0x00,
		0x00,
		
		{
		},
		null,
	};
byte g_b804946C = 0x00; // 0804946C
byte g_b804946D = 0x00; // 0804946D
Eq_19 g_t80534AC = // 080534AC
	{
		0x00,
		
		{
		},
		
		{
			0x00
		},
		
		{
			0x00
		},
	};
