/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// char __usercall sub_804804C@<al>(_BYTE *@<ecx>, int@<ebp>);
// unsigned __int32 __usercall sub_8048083@<eax>(int@<eax>, _DWORD *@<edi>);
// char __usercall sub_80480A5@<al>(int@<eax>, char@<dl>, int@<ebp>, _DWORD *@<edi>);
// int __usercall sub_80480BA@<eax>(_DWORD *@<edi>);
void __noreturn start(); // weak

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN locret_80480D9; // weak
char byte_8048457[] = { 'E' }; // weak
float flt_80485DF = 0.5; // weak
float flt_80485E3 = 3.259629e-9; // weak
char byte_80485E7 = ' '; // weak
int dword_8048640[479]; // weak
int dword_8048DBC[542]; // weak
int dword_8049635[]; // weak
int dword_8049A35[]; // weak
fd_set readfds; // idb


//----- (0804804C) --------------------------------------------------------
char __usercall sub_804804C@<al>(_BYTE *a1@<ecx>, int a2@<ebp>)
{
  _DWORD *v2; // edi
  int v3; // ecx

  *a1 = 0;
  readfds.__fds_bits[0] |= 1u;
  v2 = (_DWORD *)(a2 - 36);
  *v2 = 0;
  v2[1] = 0;
  __asm { int     80h; LINUX - sys_select }
  if ( sys_read(0, a1, 1u) != 1 )
    *(_BYTE *)v3 = 113;
  return *(_BYTE *)v3;
}
// 804807D: variable 'v3' is possibly undefined

//----- (08048083) --------------------------------------------------------
unsigned __int32 __usercall sub_8048083@<eax>(int a1@<eax>, _DWORD *a2@<edi>)
{
  __int16 v2; // t2
  unsigned __int32 result; // eax
  int v8; // [esp-4h] [ebp-4h]

  v2 = (unsigned __int16)a1 % 0x4Eu;
  LOBYTE(a1) = (unsigned __int16)a1 / 0x4Eu;
  BYTE1(a1) = v2;
  v8 = a1;
  _EAX = a1 + 1;
  __asm { aam }
  *a2 = _byteswap_ulong(_EAX) + 808475419;
  _EAX = v8;
  LOBYTE(_EAX) = BYTE1(v8);
  ++_EAX;
  __asm { aam }
  result = (_byteswap_ulong(_EAX) >> 8) + 1211117627;
  a2[1] = result;
  return result;
}

//----- (080480A5) --------------------------------------------------------
char __usercall sub_80480A5@<al>(int a1@<eax>, char a2@<dl>, int a3@<ebp>, _DWORD *a4@<edi>)
{
  char result; // al

  *(_BYTE *)(a1 + a3 + 44) = a2;
  sub_8048083(a1, a4);
  _DL = a2;
  _EBX = &byte_80485E7;
  __asm { xlat }
  *(_BYTE *)a4 = result;
  return result;
}
// 80485E7: using guessed type char byte_80485E7;

//----- (080480BA) --------------------------------------------------------
int __usercall sub_80480BA@<eax>(_DWORD *a1@<edi>)
{
  _DWORD *v1; // edi

  *a1 = 875715355;
  v1 = a1 + 1;
  *v1 = 256389179;
  return sys_write(1, dword_8048DBC, (char *)(v1 + 1) - (char *)dword_8048DBC);
}
// 8048DBC: using guessed type int dword_8048DBC[542];

//----- (080480DA) --------------------------------------------------------
void __noreturn start()
{
  int v0; // eax
  int v1; // eax
  int v2; // eax
  int *v3; // ecx
  struct itimerval *v4; // edx
  int v5; // eax
  int *v6; // edi
  int v7; // eax
  bool v8; // pf
  unsigned int v9; // eax
  int *v10; // ecx
  char v11; // dl
  int v12; // ecx
  int v13; // ecx
  int v14; // ecx
  bool v15; // cf
  _DWORD *v16; // edi
  _BYTE *v17; // edi
  int *v18; // esi
  int v20; // ecx
  int v23; // esi
  int v24; // ebx
  unsigned int v26; // esi
  char v27; // cf
  unsigned int v28; // eax
  int v29; // et2
  unsigned int v30; // eax
  int v31; // et2
  unsigned int v32; // esi
  _BOOL4 v33; // ett
  int v34; // eax
  int v35; // et2
  int v36; // eax
  bool v37; // zf
  int *v38; // edi
  int v39; // eax
  int v40; // ecx
  int v41; // eax
  int v42; // edx
  __int16 v43; // t2
  int *v44; // edi
  int v45; // eax
  char v46; // dh
  int v47; // et2
  int v48; // eax
  _BYTE *v49; // edi
  int v50; // ebx
  int v51; // ecx
  unsigned __int8 v52; // dl
  long double v53; // fst7
  int *v54; // edi
  int v55; // eax
  char v56; // cl
  char v57; // dl
  char v58; // dh
  char v59; // al
  unsigned __int8 v60; // dl
  char v61; // al
  char v62; // al
  char v63; // dl
  unsigned int v64; // kr00_4
  char *v66; // esi
  unsigned int v67; // eax
  char v68; // cl
  unsigned int v69; // edx
  int v72; // eax
  int v73; // [esp+0h] [ebp-4h]
  int v74; // [esp+0h] [ebp-4h]
  int v75; // [esp+0h] [ebp-4h]

  v0 = sys_ioctl(0, 21505);
  v73 = dword_8048640[-15];
  dword_8048640[-15] = v73 & 0xFFFFFFF5;
  v1 = sys_ioctl(0, 21506);
  dword_8048640[-15] = v73;
  dword_8048640[-5] = (int)&locret_80480D9;
  v2 = sys_sigaction(14, (const struct sigaction *)&dword_8048640[-5], 0);
  v3 = &dword_8048640[-9];
  v3[1] = 200000;
  v3[3] = 200000;
  v5 = sys_setitimer(0, (struct itimerval *)&dword_8048640[-9], v4);
  LOBYTE(dword_8048640[11]) = 6;
  memset((char *)&dword_8048640[11] + 1, 10, 0x4Cu);
  BYTE1(dword_8048640[30]) = 12;
  BYTE2(dword_8048640[30]) = 5;
  HIBYTE(dword_8048640[49]) = 5;
  qmemcpy(&dword_8048640[50], (char *)&dword_8048640[30] + 2, 0x666u);
  BYTE2(dword_8048640[459]) = 3;
  memset((char *)&dword_8048640[459] + 3, 10, 0x4Cu);
  HIBYTE(dword_8048640[478]) = 9;
  v6 = dword_8048DBC;
  dword_8049635[0] = 975;
  HIBYTE(dword_8048640[254]) = 10;
  dword_8048640[4] = 975;
  v7 = sys_gettimeofday((struct timeval *)&dword_8048640[8], 0);
  v8 = __SETP__(dword_8048640[8] + v7, 0);
  v9 = dword_8048640[8] + v7;
  LOBYTE(v9) = 8;
  if ( !v8 )
    LOBYTE(v9) = 2;
  LOBYTE(dword_8048640[1]) = v9;
  BYTE1(dword_8048640[10]) = 12;
  while ( 1 )
  {
    v10 = &dword_8048640[10];
    LOBYTE(v9) = BYTE1(dword_8048640[10]);
    if ( (_BYTE)v9 )
    {
      v11 = 0;
      if ( BYTE2(dword_8048640[10]) )
      {
        v11 = BYTE2(dword_8048640[10]);
        BYTE2(dword_8048640[10]) = 0;
      }
      BYTE1(dword_8048640[10]) = v11;
      *(_BYTE *)v10 = v9;
    }
    else
    {
      LOBYTE(v9) = sub_804804C(v10, (int)dword_8048640);
      if ( (_BYTE)v9 == 27 )
      {
        LOBYTE(v9) = sub_804804C((_BYTE *)(v12 + 1), (int)dword_8048640);
        if ( (_BYTE)v9 == 91 || (_BYTE)v9 == 79 )
        {
          LOBYTE(v9) = sub_804804C((_BYTE *)(v13 + 1), (int)dword_8048640);
          if ( (_BYTE)v9 == 67 || (_BYTE)v9 == 68 )
          {
            v9 = (unsigned __int8)(v9 + 42);
            *(_DWORD *)(v14 - 2) = v9;
          }
        }
      }
    }
    if ( (_BYTE)v9 == 113 )
      goto LABEL_64;
    v15 = (unsigned __int8)v9 < 0xCu;
    if ( (_BYTE)v9 == 12 )
      break;
    v23 = dword_8048640[5];
    v24 = dword_8048640[6];
    if ( --dword_8048640[7] < 0 )
    {
      ++dword_8048640[7];
      sub_80480A5(dword_8049635[v24], 0, (int)dword_8048640, v6);
      ++LOBYTE(dword_8048640[6]);
    }
    v26 = dword_8049635[v23];
    LOBYTE(v9) = dword_8048640[1];
    v29 = v15 << 31;
    v27 = v9 & 1;
    v28 = (v9 >> 1) | v29;
    if ( v27 )
    {
      v27 = v26 < 0x4E;
      v26 -= 78;
    }
    v31 = v27 << 31;
    v15 = v28 & 1;
    v30 = (v28 >> 1) | v31;
    v33 = v15;
    v15 = __CFADD__(v15, v26);
    v32 = v33 + v26;
    v35 = v15 << 31;
    v15 = v30 & 1;
    v34 = (v30 >> 1) | v35;
    if ( v15 )
      v32 += 78;
    v18 = (int *)(v32 - (v34 & 1));
    v36 = dword_8048640[4] - (_DWORD)v18;
    if ( v36 < 0 )
      v36 = (int)v18 - dword_8048640[4];
    if ( v36 <= 1 )
    {
      v40 = dword_8048640[2];
      dword_8048640[7] += v40;
      dword_8048640[7] *= 2;
      dword_8048640[0] += v40;
LABEL_36:
      v41 = dword_8048640[0];
      v42 = 926628443;
      do
      {
        v43 = (unsigned __int16)v41 % 0xAu;
        LOBYTE(v41) = (unsigned __int16)v41 / 0xAu;
        BYTE1(v41) = v43;
        v74 = v41;
        *(_BYTE *)v6 = 27;
        v44 = (int *)((char *)v6 + 1);
        v45 = v42;
        v46 = v43;
        --BYTE1(v45);
        *v44++ = v45;
        v47 = v45;
        BYTE1(v45) = v46;
        v42 = v47;
        LOBYTE(v45) = 57;
        *(_BYTE *)v44 = 57;
        v44 = (int *)((char *)v44 + 1);
        *(_WORD *)v44 = v45 + 12303;
        v6 = (int *)((char *)v44 + 2);
        v41 = v74;
        BYTE1(v41) = 0;
      }
      while ( v41 );
      goto LABEL_38;
    }
    v37 = LOBYTE(dword_8048640[3])-- == 1;
    if ( !v37 )
      goto LABEL_45;
    v37 = LOBYTE(dword_8048640[2])-- == 1;
    if ( !v37 )
    {
      LOBYTE(dword_8048640[3]) = 42;
      sub_8048083(dword_8048640[4], v6);
      *v6 = 1832344347;
      v38 = v6 + 1;
      v39 = 1528504368;
      LOBYTE(v39) = LOBYTE(dword_8048640[2]) + 48;
      *v38++ = v39;
      *v38 = 258815794;
      v6 = v38 + 1;
      goto LABEL_45;
    }
LABEL_38:
    v48 = dword_8048640[4];
    if ( LOBYTE(dword_8048640[10]) != 12 )
    {
      sub_8048083(v48 - 1, v6);
      *(_BYTE *)v6 = 32;
      v49 = (char *)v6 + 1;
      *v49++ = 32;
      *v49 = 32;
      v6 = (int *)(v49 + 1);
      *((_BYTE *)&dword_8048640[11] + (_DWORD)v18) ^= 0x20u;
      v50 = 0;
      v51 = 1794;
      do
      {
        dword_8049A35[v50] = v51;
        v50 += *(unsigned int *)((char *)&dword_8048640[10] + v51-- + 2) < 0x100;
      }
      while ( v51 );
      *((_BYTE *)&dword_8048640[11] + (_DWORD)v18) ^= 0x20u;
      v52 = 101;
      if ( !v50 )
        goto LABEL_59;
      v53 = flt_80485E3 * (long double)v50;
      dword_8048640[8] = (unsigned int)(2 * (1103515245 * dword_8048640[8] + 12345)) >> 1;
      v75 = (int)(v53 * (long double)dword_8048640[8] - flt_80485DF);
      LOBYTE(v51) = 7;
      v48 = dword_8049A35[(unsigned int)(v75 / (unsigned __int64)(unsigned int)v51)];
      dword_8048640[4] = v48;
      LOBYTE(dword_8048640[2]) = v75 % (unsigned __int64)(unsigned int)v51 + 3;
      LOBYTE(dword_8048640[3]) = 42;
    }
    sub_8048083(v48 - 1, v6);
    *v6 = 1832344347;
    v54 = v6 + 1;
    v55 = 455094304;
    BYTE1(v55) = v56 + 48;
    *v54++ = v55;
    *v54 = 1832333915;
    v6 = v54 + 1;
    if ( LOBYTE(dword_8048640[10]) == 12 )
    {
      v9 = sub_80480BA(v6);
    }
    else
    {
LABEL_45:
      *(_BYTE *)v6 = 14;
      v6 = (int *)((char *)v6 + 1);
      v57 = dword_8048640[1];
      v58 = ((unsigned __int8)(v57 | (16 * v57)) >> 2) & 0xF;
      v59 = *((_BYTE *)&dword_8048640[11] + (_DWORD)v18);
      if ( v59 )
      {
        v64 = __readeflags();
        sub_80480A5((int)v18, v58 | v59, (int)dword_8048640, v6);
        __writeeflags(v64);
        if ( v37 || (v52 = -121, v18 != (int *)dword_8049635[dword_8048640[6]]) )
        {
          v52 = 51;
          if ( dword_8048640[0] )
          {
            v52 = -47;
            if ( dword_8048640[0] != 100 )
            {
              v52 = -84;
              if ( (unsigned int)dword_8048640[7] <= 0xF )
                v52 = 91;
            }
          }
        }
LABEL_59:
        _EBX = byte_8048457;
        v66 = &byte_8048457[v52];
        *v6++ = 828054287;
        while ( 1 )
        {
          v67 = *(_DWORD *)v66;
          v66 += 3;
          if ( !(_BYTE)v67 )
            break;
          v68 = 4;
          v69 = v67;
          do
          {
            _AL = v69 & 0x3F;
            __asm { xlat }
            *(_BYTE *)v6 = _AL;
            v6 = (int *)((char *)v6 + 1);
            v69 >>= 6;
            --v68;
          }
          while ( v68 );
        }
LABEL_64:
        sub_80480BA(v6);
        v72 = sys_exit(sys_ioctl(0, 21506));
      }
      ++LOBYTE(dword_8048640[5]);
      dword_8049635[dword_8048640[5]] = (int)v18;
      v60 = (16 * v57) | v57;
      v61 = dword_8048640[10];
      if ( v61 == 52 )
        goto LABEL_51;
      if ( v61 == 54 )
        goto LABEL_50;
      v62 = v61 | 0x20;
      if ( v62 != 110 )
      {
        if ( v62 != 109 )
          goto LABEL_52;
LABEL_50:
        v60 >>= 2;
      }
LABEL_51:
      v60 >>= 1;
LABEL_52:
      v63 = v60 & 0xF;
      LOBYTE(dword_8048640[1]) = v63;
      sub_80480A5((int)v18, v58 | v63, (int)dword_8048640, v6);
      sub_80480BA(v6);
      v9 = 29;
      __asm { int     80h; LINUX - sys_pause }
    }
  }
  *v6 = 457726747;
  v16 = v6 + 1;
  *v16 = 235817563;
  v17 = v16 + 1;
  v18 = &dword_8048640[11];
  _EBX = &byte_80485E7;
  v20 = 24;
  while ( 1 )
  {
    BYTE1(v20) = 78;
    do
    {
      _AL = *(_BYTE *)v18;
      v18 = (int *)((char *)v18 + 1);
      __asm { xlat }
      *v17++ = _AL;
      --BYTE1(v20);
    }
    while ( BYTE1(v20) );
    if ( !--v20 )
      break;
    *v17++ = 10;
  }
  *v17 = 15;
  v6 = (int *)(v17 + 1);
  goto LABEL_36;
}
// 804812E: variable 'v4' is possibly undefined
// 80481AD: variable 'v12' is possibly undefined
// 80481BB: variable 'v13' is possibly undefined
// 80481CE: variable 'v14' is possibly undefined
// 8048236: variable 'v15' is possibly undefined
// 8048236: variable 'v9' is possibly undefined
// 804835B: variable 'v56' is possibly undefined
// 80483EA: variable 'v37' is possibly undefined
// 80480DA: using guessed type void __noreturn start();
// 80485DF: using guessed type float flt_80485DF;
// 80485E3: using guessed type float flt_80485E3;
// 80485E7: using guessed type char byte_80485E7;
// 8048640: using guessed type int dword_8048640[479];
// 8048DBC: using guessed type int dword_8048DBC[542];
// 8049635: using guessed type int dword_8049635[];
// 8049A35: using guessed type int dword_8049A35[];

// nfuncs=5 queued=5 decompiled=5 lumina nreq=0 worse=0 better=0
// ALL OK, 5 function(s) have been successfully decompiled
