// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0804804C: void fn0804804C(Stack word32 dwArg00, Stack (ptr32 char) dwArg08)
void fn0804804C(word32 dwArg00, char * dwArg08)
{
	ptr32 fp;
	struct Eq_5 * esp_104;
	word32 * edi_113 = g_a804A0FF;
	int32 ebp_116 = 0x00;
	struct Eq_10 * esp_100 = fp + 8;
	if (dwArg00 != 0x01)
	{
		int32 ecx_106 = 577;
		char * ebx_105 = dwArg08;
		esp_100 = fp + 0x0C;
		byte * esi_20 = dwArg08 + 1;
		if (*dwArg08 != 0x2D)
		{
l0804809D:
			word32 * esp_101 = esp_100 - 4;
			*esp_101 = 0x05;
			esp_104 = (struct Eq_5 *) (esp_101 + 1);
			int32 eax_108 = sys_open(ebx_105, ecx_106, 0x01B4);
			if (eax_108 < 0x00)
				++ebp_116;
			else
			{
				*edi_113 = eax_108;
				++edi_113;
			}
			goto l08048098;
		}
		while (true)
		{
			esp_104 = fp + 0x0C;
			byte al_25 = *esi_20;
			++esi_20;
			if (al_25 == 0x00)
				break;
			if (al_25 != 0x61)
			{
				if (al_25 != 0x69)
					goto l080480E8;
				sys_sigaction(0x0D, &g_t80480EF, null);
				sys_sigaction(0x02, &g_t80480EF, null);
				continue;
			}
			ecx_106 = 0x0441;
		}
l08048098:
		char * ebx_34 = esp_104->dw0000;
		esp_100 = (struct Eq_10 *) (esp_104 + 1);
		ebx_105 = ebx_34;
		if (ebx_34 != null)
			goto l0804809D;
	}
	*edi_113 = 0x00;
	while (true)
	{
		uint32 * esp_54 = esp_100 - 4;
		*esp_54 = 0x03;
		esp_104 = (struct Eq_5 *) (esp_54 + 1);
		Eq_75 eax_61 = sys_read(0x00, &g_b80480FF, 0x2000);
		if (eax_61 < 0x00)
			break;
		if (eax_61 == 0x00)
			goto l080480E8;
		*esp_54 = 0x01;
		uint32 ebx_73 = *esp_54;
		*esp_54 = 0x04;
		sys_write(ebx_73, &g_b80480FF, eax_61);
		word32 * esi_80 = g_a804A0FF;
		while (true)
		{
			uint32 eax_83 = *esi_80;
			++esi_80;
			if (eax_83 == 0x00)
				break;
			esp_100->dwFFFFFFFC = 0x04;
			sys_write(eax_83, &g_b80480FF, eax_61);
		}
	}
	++ebp_116;
l080480E8:
	esp_104->dwFFFFFFFC = 0x01;
	sys_exit(ebp_116);
}

Eq_149 g_t80480EF = // 080480EF
	{
	};
char g_b80480FF = '\0'; // 080480FF
uint32 g_a804A0FF[] = // 0804A0FF
	{
	};
