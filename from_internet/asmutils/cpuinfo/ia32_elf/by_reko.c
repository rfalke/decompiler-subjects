// subject_seg08048000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

Eq_140 g_t8048054 = // 08048054
	{
		110
	};
// 08048060: FlagGroup bool fn08048060(Register (ptr32 Eq_3) edi, Register out ptr32 eaxOut, Register out ptr32 ecxOut)
// Called from:
//      fn0804807F
bool fn08048060(struct Eq_3 * edi, ptr32 & eaxOut, ptr32 & ecxOut)
{
	ptr32 dwLoc04_38 = eax;
	ptr32 ecx_10 = ~0x00;
	while (ecx_10 != 0x00)
	{
		++edi;
		--ecx_10;
		if (edi->b0000 != 0x00)
			break;
	}
	bool C_43 = SLICE(cond(edi->dwFFFFFFFB - 0x64656570), bool, 1);
	if (edi->dwFFFFFFFB == 0x64656570)
	{
		C_43 = SLICE(cond(edi->dwFFFFFFF7 - 0x73757063), bool, 1);
		if (edi->dwFFFFFFF7 == 0x73757063)
			dwLoc04_38 = 0x00;
	}
	eaxOut = dwLoc04_38;
	ecxOut = ecx_10;
	return C_43;
}

// 0804807F: void fn0804807F(Register word32 edx, Stack ui32 dwArg00, Stack (ptr32 Eq_3) dwArg04, Stack (ptr32 word32) dwArg08)
void fn0804807F(word32 edx, ui32 dwArg00, struct Eq_3 * dwArg04, word32 * dwArg08)
{
	struct Eq_49 * ebp_7 = fp + 0x08 + dwArg00 * 0x04;
	word32 ecx_9;
	int32 eax_10;
	Eq_58 C_12 = fn08048060(dwArg04, out eax_10, out ecx_9);
	ebp_7->b000B = (byte) eax_10 - 0x01;
	ptr32 esp_22 = fp + 4;
	Eq_73 SCZDOP_39 = cond(eax_10 - 0x01) | C_12 | SCZDOP;
	if (eax_10 > 0x01)
	{
		word32 eax_23 = *dwArg08;
		esp_22 = fp + 0x0C;
		if ((word16) eax_23 == 0x742D)
		{
l080480A8:
			ci8 v12_31 = ebp_7->b000B;
			ci8 v14_33 = -v12_31;
			ebp_7->b000B = v14_33;
			SCZDOP_39 = cond(v14_33) | v12_31 != 0x00 | SCZDOP;
			goto l080480AB;
		}
		SCZDOP_39 = cond(eax_23 - 1769221421) | SCZDOP;
		if (eax_23 == 1769221421)
			goto l080480A8;
	}
l080480AB:
	union Eq_73 * esp_38 = esp_22 - 4;
	*esp_38 = (union Eq_73 *) SCZDOP_39;
	Eq_73 eax_46 = *esp_38;
	*esp_38 = (union Eq_73 *) (eax_46 ^ 0x00200000);
	*esp_38 = *esp_38;
	if (*esp_38 == eax_46)
	{
		word32 ebx_215;
		word32 edx_214;
		word32 ecx_213;
		word32 esi_201;
		fn080481C8(&g_t8048054, out ecx_213, out edx_214, out ebx_215, out esi_201);
	}
	else if (ebp_7->b000B < 0x00)
	{
		*esp_38 = (union Eq_73 *) (word32) __rdtsc();
		__syscall(0x80);
		uint32 eax_100 = (word32) __rdtsc() - *esp_38 >> 0x01;
		*esp_38 = 0x00;
		ebp_7->w0009 = 0x0A;
		union Eq_140 * ecx_84 = &ebp_7->w0009;
		do
		{
			*esp_38 = (union Eq_73 *) ((char *) *esp_38 + 1);
			uint64 edx_eax_96 = (uint64) eax_100;
			--ecx_84;
			*ecx_84 = (union Eq_140 *) ((byte) (edx_eax_96 % 0x0A) | 0x30);
			eax_100 = (uint32) (edx_eax_96 /u 0x0A);
		} while (eax_100 != 0x00);
		word32 ebx_221;
		word32 edx_220;
		word32 esi_113;
		word32 ecx_219;
		fn080481C8(ecx_84, out ecx_219, out edx_220, out ebx_221, out esi_113);
	}
	else
	{
		__cpuid(0x00, ecx_9, &0x00, &eax_46, &ecx_9, &edx);
		*esp_38 = 0x00;
		struct Eq_49 * ebp_127;
		word32 ebx_128;
		word32 edx_131;
		word32 esi_132;
		word32 ecx_129 = fn08048142(0x00, ebp_7, out edx_131, out ebx_128, out ebp_127, out esi_132);
		__cpuid(0x80000000, ecx_129, &0x80000000, &ebx_128, &ecx_129, &edx_131);
		word32 ebp_142;
		word32 ebx_143;
		word32 edx_146;
		word32 esi_147;
		fn08048142(0x80000000, ebp_127, out edx_146, out ebx_143, out ebp_142, out esi_147);
	}
}

// 08048142: Register word32 fn08048142(Register word32 eax, Register (ptr32 Eq_49) ebp, Register out ptr32 edxOut, Register out ptr32 ebxOut, Register out (ptr32 Eq_49) ebpOut, Register out ptr32 esiOut)
// Called from:
//      fn0804807F
word32 fn08048142(word32 eax, struct Eq_49 * ebp, ptr32 & edxOut, ptr32 & ebxOut, struct Eq_49 & ebpOut, ptr32 & esiOut)
{
	word16 eax_16_16_9 = SLICE(eax, word16, 16);
	ci8 bLoc04_37 = (byte) eax;
	word32 edi_11 = SEQ(eax_16_16_9, 0x00);
	do
	{
		ci8 v8_29 = bLoc04_37 - 0x01;
		ptr32 ebx_17;
		word32 edi_19;
		ptr32 edx_20;
		ptr32 esi_21;
		word32 ecx_18 = fn08048157(edi_11, ebp, out edx_20, out ebx_17, out ebp, out esi_21, out edi_19);
		edi_11 = edi_19 + 0x01;
		bLoc04_37 = v8_29;
	} while (v8_29 >= 0x00);
	edxOut = edx_20;
	ebxOut = ebx_17;
	ebpOut = ebp;
	esiOut = esi_21;
	return ecx_18;
}

// 08048157: Register word32 fn08048157(Register word32 eax, Register (ptr32 Eq_49) ebp, Register out ptr32 edxOut, Register out ptr32 ebxOut, Register out ptr32 ebpOut, Register out ptr32 esiOut, Register out ptr32 ediOut)
// Called from:
//      fn08048142
word32 fn08048157(word32 eax, struct Eq_49 * ebp, ptr32 & edxOut, ptr32 & ebxOut, ptr32 & ebpOut, ptr32 & esiOut, ptr32 & ediOut)
{
	word32 eax_6 = __rol<word32,byte>(eax, 0x08);
	struct Eq_49 * ebp_16;
	ui32 ebx_17;
	word32 edx_20;
	word32 ecx_18 = fn08048203(SEQ(SLICE(eax_6, word24, 8), (byte) eax_6 | SLICE(eax_6, byte, 8)), ebp, out edx_20, out ebx_17, out ebp_16);
	__cpuid(ebx_17 & ~0x10000000, ecx_18, &(ebx_17 & ~0x10000000), &ebx_17, &ecx_18, &edx_20);
	struct Eq_49 * ebp_32;
	uint32 ebx_33;
	word32 edx_237;
	word32 esi_238;
	word16 di_239;
	fn080481DE(ebx_17 & ~0x10000000, ebp_16, out edx_237, out ebx_33, out ebp_32, out esi_238, out di_239);
	struct Eq_49 * ebp_47;
	struct Eq_49 * ebp_62;
	uint32 edx_66;
	word32 edx_240;
	word32 ebx_241;
	word32 esi_242;
	word16 di_243;
	word32 ebx_244;
	word32 esi_245;
	word16 di_246;
	fn080481DE(fn080481DE(ebx_33, ebp_32, out edx_240, out ebx_241, out ebp_47, out esi_242, out di_243), ebp_47, out edx_66, out ebx_244, out ebp_62, out esi_245, out di_246);
	struct Eq_397 * edi_80 = (struct Eq_397 *) <invalid>;
	struct Eq_399 * ebp_77;
	word32 edx_247;
	word32 ebx_248;
	word16 di_249;
	word32 esi_179;
	uint32 ecx_79 = fn080481DE(edx_66, ebp_62, out edx_247, out ebx_248, out ebp_77, out esi_179, out di_249);
	struct Eq_397 * esp_83 = (struct Eq_397 *) <invalid>;
	word16 di_91 = (word16) edi_80;
	if (ebp_77->b000B > 0x00)
	{
		esp_83->dwFFFFFFFC = ecx_79;
		ebp_77->dw0001 = 0x2720;
		word32 ebx_107;
		struct Eq_433 * ecx_108;
		word32 edx_250;
		word32 esi_251;
		fn080481C8(&ebp_77->dw0001, out ecx_108, out edx_250, out ebx_107, out esi_251);
		ecx_108->dwFFFFFFFF = ebx_107;
		union Eq_140 * ecx_123;
		word32 edx_252;
		word32 ebx_253;
		word32 esi_254;
		fn080481C8(ecx_108 - 0x01, out ecx_123, out edx_252, out ebx_253, out esi_254);
		struct Eq_397 * esp_127 = (struct Eq_397 *) <invalid>;
		*ecx_123 = esp_127->dw0000;
		union Eq_140 * ecx_137;
		word32 edx_139;
		word32 ebx_255;
		word32 esi_256;
		fn080481C8(ecx_123, out ecx_137, out edx_139, out ebx_255, out esi_256);
		*ecx_137 = edx_139;
		union Eq_140 * ecx_150;
		word32 edx_257;
		word32 ebx_258;
		word32 esi_259;
		*ecx_150 = fn080481C8(ecx_137, out ecx_150, out edx_257, out ebx_258, out esi_259);
		union Eq_140 * ecx_163;
		word32 edx_260;
		word32 ebx_261;
		word32 esi_262;
		fn080481C8(ecx_150, out ecx_163, out edx_260, out ebx_261, out esi_262);
		*ecx_163 = (union Eq_140 *) 0x27;
		word32 ecx_263;
		word32 edx_264;
		word32 ebx_265;
		fn080481C8(ecx_163, out ecx_263, out edx_264, out ebx_265, out esi_179);
	}
	word32 ecx_186 = esi_179 + 0x12;
	ptr32 ebp_214;
	ptr32 ebx_215;
	word32 ecx_216;
	ptr32 edi_217;
	ptr32 edx_218;
	ptr32 esi_219;
	fn080481CC(ecx_186 - 0x01, out ecx_216, out edx_218, out ebx_215, out ebp_214, out esi_219, out edi_217);
	edxOut = edx_218;
	ebxOut = ebx_215;
	ebpOut = ebp_214;
	esiOut = esi_219;
	ediOut = edi_217;
	return ecx_216;
}

// 080481C8: Register word32 fn080481C8(Register (ptr32 Eq_140) ecx, Register out ptr32 ecxOut, Register out ptr32 edxOut, Register out ptr32 ebxOut, Register out ptr32 esiOut)
// Called from:
//      fn0804807F
//      fn08048157
word32 fn080481C8(union Eq_140 * ecx, ptr32 & ecxOut, ptr32 & edxOut, ptr32 & ebxOut, ptr32 & esiOut)
{
	ptr32 ebx_32;
	ptr32 ecx_33;
	ptr32 edx_35;
	ptr32 esi_36;
	word32 ebp_53;
	word32 edi_54;
	word32 eax_30 = fn080481CC(ecx - 0x01, out ecx_33, out edx_35, out ebx_32, out ebp_53, out esi_36, out edi_54);
	ecxOut = ecx_33;
	edxOut = edx_35;
	ebxOut = ebx_32;
	esiOut = esi_36;
	return eax_30;
}

// 080481CC: Register word32 fn080481CC(Register (ptr32 ci8) edx, Register out ptr32 ecxOut, Register out ptr32 edxOut, Register out ptr32 ebxOut, Register out ptr32 ebpOut, Register out ptr32 esiOut, Register out ptr32 ediOut)
// Called from:
//      fn08048157
//      fn080481C8
word32 fn080481CC(ci8 * edx, ptr32 & ecxOut, ptr32 & edxOut, ptr32 & ebxOut, ptr32 & ebpOut, ptr32 & esiOut, ptr32 & ediOut)
{
	do
		++edx;
	while (*edx >= 0x09);
	ptr32 ebp_13;
	ptr32 ebx_14;
	ptr32 ecx_15;
	ptr32 edi_16;
	ptr32 edx_17;
	ptr32 esi_18;
	word32 eax_12 = fn080481D4(out ecx_15, out edx_17, out ebx_14, out ebp_13, out esi_18, out edi_16);
	ecxOut = ecx_15;
	edxOut = edx_17;
	ebxOut = ebx_14;
	ebpOut = ebp_13;
	esiOut = esi_18;
	ediOut = edi_16;
	return eax_12;
}

// 080481D4: Register word32 fn080481D4(Register out ptr32 ecxOut, Register out ptr32 edxOut, Register out ptr32 ebxOut, Register out ptr32 ebpOut, Register out ptr32 esiOut, Register out ptr32 ediOut)
// Called from:
//      fn08048157
//      fn080481E1
word32 fn080481D4(ptr32 & ecxOut, ptr32 & edxOut, ptr32 & ebxOut, ptr32 & ebpOut, ptr32 & esiOut, ptr32 & ediOut)
{
	__syscall(0x80);
	ecxOut = dwArg18;
	edxOut = dwArg14;
	ebxOut = dwArg10;
	ebpOut = dwArg08;
	esiOut = dwArg04;
	ediOut = dwArg00;
	return dwArg1C;
}

// 080481DE: Register word32 fn080481DE(Register uint32 eax, Register (ptr32 Eq_49) ebp, Register out ptr32 edxOut, Register out ptr32 ebxOut, Register out ptr32 ebpOut, Register out ptr32 esiOut, Register out Eq_365 diOut)
// Called from:
//      fn08048157
word32 fn080481DE(uint32 eax, struct Eq_49 * ebp, ptr32 & edxOut, ptr32 & ebxOut, ptr32 & ebpOut, ptr32 & esiOut, union Eq_365 & diOut)
{
	ptr32 ebp_30;
	ptr32 ebx_31;
	ptr32 edx_34;
	ptr32 esi_35;
	word16 di_54;
	word32 ecx_32 = fn080481E1(eax, ebp, 0x08, out edx_34, out ebx_31, out ebp_30, out esi_35, out di_54);
	edxOut = edx_34;
	ebxOut = ebx_31;
	ebpOut = ebp_30;
	esiOut = esi_35;
	diOut.u0 = <invalid>;
	return ecx_32;
}

// 080481E1: Register word32 fn080481E1(Register uint32 eax, Register (ptr32 Eq_49) ebp, Stack int32 dwArg00, Register out ptr32 edxOut, Register out ptr32 ebxOut, Register out ptr32 ebpOut, Register out ptr32 esiOut, Register out Eq_365 diOut)
// Called from:
//      fn080481DE
//      fn08048203
word32 fn080481E1(uint32 eax, struct Eq_49 * ebp, int32 dwArg00, ptr32 & edxOut, ptr32 & ebxOut, ptr32 & ebpOut, ptr32 & esiOut, union Eq_365 & diOut)
{
	ebp->b0008 = 0x20;
	int32 ebx_29 = dwArg00;
	byte * ecx_12 = &ebp->b0008;
	do
	{
		byte dl_17 = (byte) eax;
		--ecx_12;
		*ecx_12 = (dl_17 & 0x0F) - 0x69 - (byte) ((dl_17 & 0x0F) < 0x0A);
		--ebx_29;
		eax >>= 0x04;
	} while (ebx_29 > 0x00);
	ptr32 ebp_38;
	ptr32 ebx_39;
	word32 ecx_40;
	word32 edi_41;
	ptr32 edx_42;
	ptr32 esi_43;
	fn080481D4(out ecx_40, out edx_42, out ebx_39, out ebp_38, out esi_43, out edi_41);
	edxOut = edx_42;
	ebxOut = ebx_39;
	ebpOut = ebp_38;
	esiOut = esi_43;
	diOut.u0 = <invalid>;
	return ecx_40;
}

// 08048203: Register word32 fn08048203(Register uint32 eax, Register (ptr32 Eq_49) ebp, Register out ptr32 edxOut, Register out ptr32 ebxOut, Register out ptr32 ebpOut)
// Called from:
//      fn08048157
word32 fn08048203(uint32 eax, struct Eq_49 * ebp, ptr32 & edxOut, ptr32 & ebxOut, ptr32 & ebpOut)
{
	ptr32 ebp_30;
	ptr32 ebx_31;
	ptr32 edx_34;
	word32 esi_52;
	word16 di_53;
	word32 ecx_32 = fn080481E1(eax, ebp, 0x02, out edx_34, out ebx_31, out ebp_30, out esi_52, out di_53);
	edxOut = edx_34;
	ebxOut = ebx_31;
	ebpOut = ebp_30;
	return ecx_32;
}

