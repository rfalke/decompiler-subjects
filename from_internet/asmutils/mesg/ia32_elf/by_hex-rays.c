/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start(); // weak

//-------------------------------------------------------------------------
// Data declarations

int dword_80480C8 = 2032169833; // weak
char byte_80480CD[3] = { 'i', 's', ' ' }; // weak
char filename[15] = "/proc/self/fd/0"; // idb
char pathname[320]; // idb


//----- (0804804C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn start()
{
  int v0; // eax
  int v1; // eax
  int v2; // ecx
  int *v3; // ecx
  int v4; // eax
  int v5; // eax
  _BYTE *v6; // [esp-4h] [ebp-4h]

  v0 = sys_readlink(filename, pathname, 0x100u);
  if ( v0 >= 0 )
  {
    v1 = sys_newstat(pathname, (struct stat *)&pathname[256]);
    v0 = *(_DWORD *)(v2 + 8);
    if ( v6 )
    {
      if ( *v6 == 110 )
      {
        v5 = (v0 | 0x10) ^ 0x10;
      }
      else
      {
        if ( *v6 != 121 )
          goto LABEL_7;
        v5 = v0 | 0x10;
      }
      v0 = sys_chmod(pathname, v5);
    }
    else
    {
      if ( (*(_DWORD *)(v2 + 8) & 0x10) == 16 )
        v3 = &dword_80480C8;
      else
        v3 = (int *)byte_80480CD;
      v0 = sys_write(1, v3, 5u);
    }
  }
LABEL_7:
  v4 = sys_exit(v0);
}
// 804807B: positive sp value C has been found
// 8048074: variable 'v2' is possibly undefined
// 804807D: variable 'v6' is possibly undefined
// 804804C: using guessed type void __noreturn start();
// 80480C8: using guessed type int dword_80480C8;

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
