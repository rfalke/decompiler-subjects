// subject_rdata.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__ExitProcess = &g_t2384; // 00402000
<anonymous> * __imp__GetCommandLineW = &g_t2392; // 00402004
<anonymous> * __imp__FindFirstFileW = &g_t23A4; // 00402008
<anonymous> * __imp__CreateProcessW = &g_t23B6; // 0040200C
<anonymous> * __imp__OpenProcess = &g_t23C8; // 00402010
<anonymous> * __imp__Sleep = &g_t23D6; // 00402014
<anonymous> * __imp__FormatMessageW = &g_t23DE; // 00402018
<anonymous> * __imp__TerminateProcess = &g_t23F0; // 0040201C
<anonymous> * __imp__lstrlenW = &g_t2404; // 00402020
<anonymous> * __imp__GetLastError = &g_t2410; // 00402024
<anonymous> * __imp__MoveFileW = &g_t2420; // 00402028
<anonymous> * __imp__FindClose = &g_t242C; // 0040202C
<anonymous> * __imp__LocalAlloc = &g_t2438; // 00402030
<anonymous> * __imp__CloseHandle = &g_t2446; // 00402034
<anonymous> * __imp__DeleteFileW = &g_t2454; // 00402038
<anonymous> * __imp__LocalFree = &g_t2462; // 0040203C
<anonymous> * __imp__SetFileAttributesW = &g_t246E; // 00402040
<anonymous> * __imp__CommandLineToArgvW = &g_t24B8; // 00402048
<anonymous> * __imp__wsprintfW = &g_t24A0; // 00402050
<anonymous> * __imp__MessageBoxW = &g_t2492; // 00402054
word32 g_dw402328 = 9092; // 00402328
word32 g_dw40232C = 0x2392; // 0040232C
word32 g_dw402330 = 0x23A4; // 00402330
word32 g_dw402334 = 0x23B6; // 00402334
word32 g_dw402338 = 0x23C8; // 00402338
word32 g_dw40233C = 0x23D6; // 0040233C
word32 g_dw402340 = 0x23DE; // 00402340
word32 g_dw402344 = 9200; // 00402344
word32 g_dw402348 = 0x2404; // 00402348
word32 g_dw40234C = 9232; // 0040234C
word32 g_dw402350 = 0x2420; // 00402350
word32 g_dw402354 = 0x242C; // 00402354
word32 g_dw402358 = 9272; // 00402358
word32 g_dw40235C = 0x2446; // 0040235C
word32 g_dw402360 = 0x2454; // 00402360
word32 g_dw402364 = 0x2462; // 00402364
word32 g_dw402368 = 0x246E; // 00402368
word32 g_dw402370 = 9400; // 00402370
word32 g_dw402378 = 0x24A0; // 00402378
word32 g_dw40237C = 0x2492; // 0040237C
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: void fn00401000(Register Eq_2 eax)
// Called from:
//      Win32CrtStartup
void fn00401000(Eq_2 eax)
{
	Eq_3 tLoc08;
	Eq_2 eax_20 = GetLastError();
	FormatMessageW(0x1300, null, eax_20, 0x0400, &tLoc08, 0x00, null);
	Eq_2 eax_57 = LocalAlloc(0x40, (lstrlenW(tLoc08) + lstrlenW(eax)) * 0x02 + 0x2000);
	wsprintfW(eax_57, 0x00402080, 0x00);
	((word32) eax_57 + 0x0800)->u2 = 0x00;
	MessageBoxW(null, eax_57, 0x00402234, 0x00);
	LocalFree(tLoc08);
	LocalFree(eax_57);
	ExitProcess(eax_20);
}

// 004010A0: Register word32 fn004010A0(Register Eq_2 edi)
// Called from:
//      Win32CrtStartup
word32 fn004010A0(Eq_2 edi)
{
	Eq_87 tLoc0254;
	int32 esi_19 = 0x00;
	if (DeleteFileW(edi) != 0x00)
		return 0x01;
	SetFileAttributesW(edi, 0x80);
	if (DeleteFileW(edi) != 0x00)
		return 0x01;
	do
	{
		if (DeleteFileW(edi) != 0x00)
			return 0x01;
		Eq_109 eax_58 = FindFirstFileW(edi, &tLoc0254);
		if (eax_58 == (void *) ~0x00)
		{
			if (GetLastError() == 0x02)
				return 0x01;
		}
		else
			FindClose(eax_58);
		Sleep(100);
		++esi_19;
	} while (esi_19 < 0x0A);
	return 0x00;
}

// 00401130: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	ptr32 fp;
	int32 dwLoc60;
	Eq_146 tLoc5C;
	Eq_147 tLoc4C;
	__align_stack<word32>(fp - 4);
	struct Eq_154 * eax_24 = CommandLineToArgvW(GetCommandLineW(), &dwLoc60);
	if (eax_24 != null)
	{
		word32 eax_34 = dwLoc60;
		if (eax_34 != 0x05)
			return eax_34 + 1000;
		uint32 edx_252;
		struct Eq_178 * edi_37 = eax_24->ptr0004;
		if (edi_37 != null)
		{
			int32 esi_43;
			struct Eq_178 * eax_44 = edi_37;
			for (esi_43 = 20; esi_43 != 0x00; --esi_43)
			{
				if (eax_44->a0000[0] == 0x00)
				{
					if (esi_43 == 0x00)
						break;
					edx_252 = 0x14 - esi_43;
					goto l00401195;
				}
				++eax_44;
			}
		}
		edx_252 = 0x00;
l00401195:
		Eq_2 ecx_71 = 0x00;
		uint32 eax_60 = 0x00;
		if (edx_252 != 0x00)
		{
			do
			{
				++eax_60;
				ecx_71 = (word32) edi_37[eax_60] - 48 + ecx_71 * 0x0A;
			} while (eax_60 < edx_252);
		}
		Eq_109 eax_88 = OpenProcess(0x01, 0x00, ecx_71);
		if (eax_88 != null)
		{
			if (TerminateProcess(eax_88, 0x00) != 0x00)
			{
				Eq_2 esi_126;
				CloseHandle(eax_88);
				if (fn004010A0(eax_24->t000C.u0) == 0x00)
					esi_126.u0 = eax_24->t0010.u0;
				else
					esi_126.u0 = eax_24->t000C.u0;
				if (MoveFileW(eax_24->t0008.u0, esi_126) != 0x00)
				{
					word32 ecx_147;
					union Eq_279 * eax_148 = &tLoc4C;
					for (ecx_147 = 0x44; ecx_147 != 0x00; --ecx_147)
					{
						*eax_148 = (union Eq_279 *) 0x00;
						eax_148 = (union Eq_279 *) ((char *) eax_148 + 1);
					}
					tLoc4C.cb = (DWORD) 0x44;
					Eq_2 ecx_159;
					union Eq_301 * eax_160 = &tLoc5C;
					for (ecx_159 = 0x10; ecx_159 != 0x00; --ecx_159)
					{
						*eax_160 = (union Eq_301 *) 0x00;
						eax_160 = (union Eq_301 *) ((char *) eax_160 + 1);
					}
					if (CreateProcessW(ecx_159, esi_126, ecx_159, ecx_159, ecx_159, ecx_159, ecx_159, ecx_159, &tLoc4C, &tLoc5C) != 0x00)
					{
						if (esi_126 != (eax_24->t000C).u0)
						{
							word32 esi_206;
							for (esi_206 = 100; esi_206 != 0x00; --esi_206)
								fn004010A0(eax_24->t000C.u0);
						}
						return 0x00;
					}
					else
						fn00401000(0x004022B8);
				}
				else
					fn00401000(0x004022A4);
			}
			else
				fn00401000(0x00402280);
		}
		else
			fn00401000(0x00402268);
	}
	else
		fn00401000(0x00402240);
}

