// subject_bss.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw405000 = 0x00; // 00405000
word32 g_dw405004 = 0x00; // 00405004
word32 g_dw405034 = 0x00; // 00405034
ui32 g_dw405038 = 0x00; // 00405038
word32 g_dw40503C = 0x00; // 0040503C
word32 g_dw405040 = 0x00; // 00405040
word32 g_dw405044 = 0x00; // 00405044
Eq_167 g_t405048 = 0x00; // 00405048
struct _RTL_CRITICAL_SECTION g_t40504C = // 0040504C
	{
		null,
		0,
		0,
		null,
		null,
		0x00,
	};
struct Eq_748 * g_ptr405064 = null; // 00405064
// subject_data.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

int32 g_dw402000 = -1; // 00402000
word32 g_dw402004 = 0x4000; // 00402004
struct Eq_515 * g_ptr402008 = &g_t401C74; // 00402008
// subject_idata.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw406064 = 24988; // 00406064
word32 g_dw406068 = 25012; // 00406068
word32 g_dw40606C = 0x61CC; // 0040606C
word32 g_dw406070 = 25050; // 00406070
word32 g_dw406074 = 25066; // 00406074
word32 g_dw406078 = 0x61FE; // 00406078
word32 g_dw40607C = 0x6210; // 0040607C
word32 g_dw406080 = 0x622C; // 00406080
word32 g_dw406084 = 0x6244; // 00406084
word32 g_dw406088 = 0x6262; // 00406088
word32 g_dw40608C = 25200; // 0040608C
word32 g_dw406090 = 0x6282; // 00406090
word32 g_dw406098 = 0x6292; // 00406098
word32 g_dw40609C = 25250; // 0040609C
word32 g_dw4060A0 = 25266; // 004060A0
word32 g_dw4060A4 = 0x62C0; // 004060A4
word32 g_dw4060A8 = 0x62D2; // 004060A8
word32 g_dw4060AC = 0x62DC; // 004060AC
word32 g_dw4060B0 = 0x62E4; // 004060B0
word32 g_dw4060B4 = 0x62EE; // 004060B4
word32 g_dw4060B8 = 25338; // 004060B8
word32 g_dw4060BC = 0x6302; // 004060BC
word32 g_dw4060C0 = 0x630C; // 004060C0
word32 g_dw4060C4 = 0x6316; // 004060C4
word32 g_dw4060C8 = 0x631E; // 004060C8
word32 g_dw4060CC = 0x6328; // 004060CC
word32 g_dw4060D0 = 0x6332; // 004060D0
word32 g_dw4060D8 = 0x6340; // 004060D8
word32 g_dw4060DC = 0x635C; // 004060DC
word32 g_dw4060E4 = 0x6374; // 004060E4
word32 g_dw4060E8 = 0x6388; // 004060E8
word32 g_dw4060EC = 25508; // 004060EC
word32 g_dw4060F0 = 0x63C0; // 004060F0
word32 g_dw4060F4 = 0x63CC; // 004060F4
word32 g_dw4060F8 = 0x640C; // 004060F8
<anonymous> * __imp__DeleteCriticalSection = &g_t619C; // 00406100
<anonymous> * __imp__EnterCriticalSection = &g_t61B4; // 00406104
<anonymous> * __imp__ExitProcess = &g_t61CC; // 00406108
<anonymous> * __imp__GetLastError = &g_t61DA; // 0040610C
<anonymous> * __imp__GetModuleHandleA = &g_t61EA; // 00406110
<anonymous> * __imp__GetProcAddress = &g_t61FE; // 00406114
<anonymous> * __imp__InitializeCriticalSection = &g_t6210; // 00406118
<anonymous> * __imp__LeaveCriticalSection = &g_t622C; // 0040611C
<anonymous> * __imp__SetUnhandledExceptionFilter = &g_t6244; // 00406120
<anonymous> * __imp__TlsGetValue = &g_t6262; // 00406124
<anonymous> * __imp__VirtualProtect = &g_t6270; // 00406128
<anonymous> * __imp__VirtualQuery = &g_t6282; // 0040612C
<anonymous> * __imp____getmainargs = &g_t6292; // 00406134
<anonymous> * __imp____p__environ = &g_t62A2; // 00406138
<anonymous> * __imp____p__fmode = &g_t62B2; // 0040613C
<anonymous> * __imp____set_app_type = &g_t62C0; // 00406140
<anonymous> * __imp___cexit = &g_t62D2; // 00406144
<anonymous> * __imp___iob = &g_t62DC; // 00406148
<anonymous> * __imp___onexit = &g_t62E4; // 0040614C
<anonymous> * __imp___setmode = &g_t62EE; // 00406150
<anonymous> * __imp__abort = &g_t62FA; // 00406154
<anonymous> * __imp__atexit = &g_t6302; // 00406158
<anonymous> * __imp__calloc = &g_t630C; // 0040615C
<anonymous> * __imp__free = &g_t6316; // 00406160
<anonymous> * __imp__fwrite = &g_t631E; // 00406164
<anonymous> * __imp__signal = &g_t6328; // 00406168
<anonymous> * __imp__vfprintf = &g_t6332; // 0040616C
<anonymous> * __imp____deregister_frame_info = &g_t6340; // 00406174
<anonymous> * __imp____register_frame_info = &g_t635C; // 00406178
<anonymous> * __imp___ZNSolsEPFRSoS_E = &g_t6374; // 00406180
<anonymous> * __imp___ZNSt8ios_base4InitC1Ev = &g_t6388; // 00406184
<anonymous> * __imp___ZNSt8ios_base4InitD1Ev = &g_t63A4; // 00406188
<anonymous> * __imp___ZSt4cerr = &g_t63C0; // 0040618C
<anonymous> * __imp___ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_ = &g_t63CC; // 00406190
<anonymous> * __imp___ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc = &g_t640C; // 00406194
// subject_rdata.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw403074 = 0x0040148C; // 00403074
void g_v403078 = ??void??; // 00403078
word32 g_dw403128 = 0x00; // 00403128
word32 g_dw40312C = 0x00; // 0040312C
word32 g_dw403130 = 0x01; // 00403130
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: void fn00401000(Register word32 ecx, Register Eq_3 edx, Register word32 ebx)
// Called from:
//      Win32CrtStartup
void fn00401000(word32 ecx, Eq_3 edx, word32 ebx)
{
	if (g_dw403074 != 0x00)
		ecx = fn0040148C(ecx, edx, 0x00, 0x02, 0x00, out ebx);
	SetUnhandledExceptionFilter(&g_t401110);
	word32 edx_41;
	word32 ecx_42 = fn00401514(ecx, ebx, out edx_41);
	fn004015F4();
	__getmainargs(&g_dw405000, &g_dw405004, fp - 0x10, g_dw402000);
	ptr32 esp_111 = fp - 0x3C;
	word32 eax_60 = g_dw405034;
	if (eax_60 != 0x00)
	{
		g_dw402004 = eax_60;
		word32 eax_67 = iob->dw0010;
		struct Eq_69 * esp_70;
		word32 edx_72;
		word32 ecx_74;
		setmode();
		esp_70->dw0004 = g_dw405034;
		word32 eax_78 = iob->dw0030;
		esp_70->dw0000 = eax_78;
		struct Eq_86 * esp_80;
		word32 edx_82;
		word32 ecx_84;
		setmode();
		esp_80->dw0004 = g_dw405034;
		word32 eax_88 = iob->dw0050;
		esp_80->dw0000 = eax_88;
		setmode();
	}
	*__p__fmode() = g_dw402004;
	fn0040172C();
	__align(esp_111);
	word32 edx_115;
	struct Eq_121 * esp_121;
	word32 * eax_122;
	_p__environ();
	esp_121->dw0008 = *eax_122;
	esp_121->dw0004 = g_dw405004;
	esp_121->dw0000 = g_dw405000;
	UINT * esp_142;
	cexit();
	word32 ecx_135;
	word32 edx_136;
	*esp_142 = (uint32) fn0040138C(esp_121->dwFFFFFFFC, out ecx_135, out edx_136);
	ExitProcess(*esp_142);
}

LONG g_t401110(struct _EXCEPTION_POINTERS * ExceptionInfo) = ??/* Unexpected function type (fn LONG ((ptr32 (struct "_EXCEPTION_POINTERS")))) */ ; // 00401110
// 0040126C: Register Eq_167 Win32CrtStartup()
Eq_167 Win32CrtStartup()
{
	__set_app_type(0x01);
	fn00401000(ecx, edx, ebx);
}

// 0040129C: void fn0040129C(Stack (ptr32 Eq_179) ptrArg04)
// Called from:
//      Win32CrtStartup
//      fn00401974
void fn0040129C(void (* ptrArg04)())
{
	atexit(ptrArg04);
}

// 0040138C: Register word32 fn0040138C(Stack word32 dwArg00, Register out ptr32 ecxOut, Register out ptr32 edxOut)
// Called from:
//      fn00401000
word32 fn0040138C(word32 dwArg00, ptr32 & ecxOut, ptr32 & edxOut)
{
	__align(fp);
	word32 edx_62;
	fn00401974(out edx_62);
	word32 * esp_27;
	word32 eax_29;
	ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc();
	*esp_27 = 0x00401430;
	ptr32 edx_39;
	ZNSolsEPFRSoS_E();
	ecxOut = fp + 0x04;
	edxOut = edx_39;
	return 0x00;
}

// 0040148C: Register word32 fn0040148C(Register word32 ecx, Register Eq_3 edx, Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C, Register out ptr32 ebxOut)
// Called from:
//      fn00401000
word32 fn0040148C(word32 ecx, Eq_3 edx, word32 dwArg04, word32 dwArg08, word32 dwArg0C, ptr32 & ebxOut)
{
	if (g_dw405044 != 0x02)
		g_dw405044 = 0x02;
	if (dwArg08 != 0x02 && dwArg08 == 0x01)
		ecx = fn00401B04(ecx, edx, 0x01);
	ebxOut = ebx;
	return ecx;
}

// 00401514: Register word32 fn00401514(Register word32 ecx, Register word32 ebx, Register out Eq_20 edxOut)
// Called from:
//      fn00401000
word32 fn00401514(word32 ecx, word32 ebx, union Eq_20 & edxOut)
{
	word32 ebx;
	byte SCZDOP;
	word32 ecx;
	cl_105 = (byte) ecx;
	ch_121 = SLICE(ecx, byte, 8);
	ecx_16_16_141 = SLICE(ecx, word16, 16);
	edx_18 = SCZDOP;
	dh_40 = SLICE(SCZDOP, byte, 8);
	eax_30 = SCZDOP ^ 0x00200000 ^ SCZDOP;
	if ((eax_30 & 0x00200000) != 0x00)
		__cpuid(0x00, ecx, &0x00, &ebx, &ecx, &SCZDOP);
	edx_243 = ϕ(edx_18, edx_18, edx_90, edx_166, edx_166);
	ecx_241 = ϕ(ecx, ecx, ecx_142, ecx_142, ecx_142);
	edxOut = edx_243;
	return ecx_241;
}

// 004015F4: void fn004015F4()
// Called from:
//      fn00401000
void fn004015F4()
{
	__fninit();
}

// 004015FC: Register Eq_115 fn004015FC(Stack word32 dwArg04, Register out ptr32 ecxOut, Register out ptr32 edxOut)
// Called from:
//      fn00401648
//      fn0040172C
Eq_115 fn004015FC(word32 dwArg04, ptr32 & ecxOut, ptr32 & edxOut)
{
	FILE * ebx_17 = iob + 0x40;
	fwrite(&g_v403078, 0x01, 0x17, ebx_17);
	msvcrt.dll!vfprintf();
	abort();
	Eq_115 eax_33 = fn00401648(eax, ecx, edx);
	ecxOut = <invalid>;
	edxOut = <invalid>;
	return eax_33;
}

// 00401648: Register Eq_115 fn00401648(Register Eq_115 eax, Register word32 ecx, Register (ptr32 byte) edx)
// Called from:
//      fn004015FC
//      fn0040172C
Eq_115 fn00401648(Eq_115 eax, word32 ecx, byte * edx)
{
	byte * esi_126 = edx;
	if (ecx == 0x00)
		return eax;
	word32 ecx_36 = ecx;
	if (VirtualQuery(eax, fp - 0x3C, 0x1C) == 0x00)
	{
		word32 edx_256;
		word32 ecx_255;
		fn004015FC(0x00403090, out ecx_255, out edx_256);
		return fn0040172C();
	}
	else if (dwLoc28 == 0x40 || dwLoc28 == 0x04)
	{
		Eq_115 edi_60 = eax;
		for (; ecx_36 != 0x00; --ecx_36)
		{
			*edi_60 = *esi_126;
			++esi_126;
			++edi_60;
		}
		return dwLoc28;
	}
	else
	{
		VirtualProtect(dwLoc3C, dwLoc30, 0x40, fp - 0x20);
		eax = dwLoc28;
		word32 ecx_132;
		Eq_115 edi_128 = eax;
		for (ecx_132 = ecx; ecx_132 != 0x00; --ecx_132)
		{
			*edi_128 = *esi_126;
			++esi_126;
			++edi_128;
		}
		if (dwLoc28 == 0x40 || dwLoc28 == 0x04)
			return eax;
		return VirtualProtect(dwLoc3C, dwLoc30, dwLoc20, fp - 0x20);
	}
}

// 0040172C: Register Eq_115 fn0040172C()
// Called from:
//      fn00401000
//      fn00401648
Eq_115 fn0040172C()
{
fn0040172C_entry:
	def fp
	def eax
	esp_17 = fp - 0x3C
	eax_18 = g_dw40503C
	branch eax_18 == 0x00 l00401748
	g_dw40503C = 0x01
	eax_24 = 0x18
	ebx_27 = (struct Eq_449 *) &g_dw403128
	edi_30 = g_dw403128
	branch edi_30 != 0x00 l00401780
	goto l00401775
l0040172C:
l00401748:
l00401761:
l0040176B:
l00401775:
	esi_34 = g_dw40312C
	branch esi_34 == 0x00 l004017BC
l00401780:
	eax_339 = PHI((eax_24, l0040176B), (eax_24, l0040177F), (eax_49, l004017D2))
	ebx_245 = PHI((ebx_27, l0040176B), (ebx_27, l0040177F), (ebx_43, l004017D2))
	branch ebx_245 >= (struct Eq_449 *) 0x00403140 l0040173E
	goto l00401790
l00401788:
l00401790:
	Mem252 = PHI((Mem22, l00401788), (Mem260, l00401790))
	ebx_251 = PHI((ebx_245, l00401788), (ebx_272, l00401790))
	eax_253 = ebx_251->dw0004
	eax_267 = fn00401648(eax_253 + 0x00400000, 0x04, fp - 0x24)
	ebx_272 = (struct Eq_449 *) &ebx_251->dw0008
	branch ebx_272 < (struct Eq_449 *) 0x00403140 l00401790
l004017B3:
	return eax_267
l004017BC:
	ecx_38 = g_dw403130
	branch ecx_38 != 0x00 l004017D9
l004017C6:
	ebx_42 = 0x00403134
l004017D2:
	eax_49 = ebx_43->dw0004
	branch eax_49 != 0x00 l00401780
l004017D9:
	ebx_53 = PHI((ebx_27, l004017BC), (ebx_43, l004017D2))
	eax_55 = ebx_53->dw0008
	branch eax_55 != 0x01 l004018E7
l004017E5:
	ebx_113 = (struct Eq_524 *) (&ebx_53->dw0008 + 1)
	branch ebx_113 >= (struct Eq_524 *) 0x00403140 l0040173E
l004017F4:
	esp_148 = PHI((esp_17, l004017E5), (esp_287, l004018AC))
	Mem118 = PHI((Mem22, l004017E5), (Mem292, l004018AC))
	ebx_117 = PHI((ebx_113, l004017E5), (ebx_241, l004018AC))
	eax_119 = ebx_117->dw0004 + 0x00400000
	edx_122 = ebx_117->dw0008
	edx_123 = edx_122 & 0xFF
	branch (edx_122 & 0xFF) == 0x10 l00401858
l00401812:
	branch (edx_122 & 0xFF) == 0x20 l00401890
l00401817:
	branch (edx_122 & 0xFF) == 0x08 l00401834
l0040181C:
	esp_148->dw0004 = edx_122 & 0xFF
	esp_148->dw0000 = 0x004030F8
	// Failed to bind call argument.
	// Please report this issue at https://github.com/uxmal/reko
	stackArg4 = <invalid>
	eax_154 = fn004015FC(stackArg4, out ecx_412, out edx_156)
	esp_159 = (struct Eq_437 *) ((char *) esp_148 - 4)
l00401834:
	esp_192 = PHI((esp_148, l00401817), (esp_159, l0040181C))
	edx_179 = PHI((edx_123, l00401817), (edx_156, l0040181C))
	Mem161 = PHI((Mem118, l00401817), (Mem150, l0040181C))
	eax_160 = PHI((eax_119, l00401817), (eax_154, l0040181C))
	edi_162 = (word32) *eax_160
	branch (edi_162 & 0x80) == 0x00 l00401863
	goto l00401881
l00401858:
	edi_126 = (word32) *eax_119
	branch (edi_126 & 0x8000) != 0x00 l004018C4
l00401863:
	esp_191 = PHI((esp_192, l00401834), (esp_148, l00401858))
	edx_178 = PHI((edx_179, l00401834), (edx_123, l00401858))
	branch edx_178 == 0x10 l004018D8
l00401877:
	branch edx_178 == 0x20 l0040189F
l0040187C:
	branch edx_178 != 0x08 l004018AC
l00401881:
	Mem294 = PHI((Mem225, l0040183F), (Mem177, l0040187C))
	esp_232 = PHI((esp_192, l0040183F), (esp_191, l0040187C))
	fn00401648(eax, 0x01, fp - 0x20)
	esp_234 = esp_232
	goto l004018AC
l0040189F:
	Mem293 = PHI((Mem144, l00401890), (Mem177, l00401877))
	esp_210 = PHI((esp_148, l00401890), (esp_191, l00401877))
	fn00401648(eax, 0x04, fp - 0x20)
	esp_212 = esp_210
l004018AC:
	Mem292 = PHI((Mem293, l0040189F), (Mem177, l0040187C), (Mem294, l00401881), (Mem295, l004018D8))
	esp_287 = PHI((esp_212, l0040189F), (esp_191, l0040187C), (esp_234, l00401881), (esp_196, l004018D8))
	ebx_241 = &ebx_117->dw0008 + 1
	eax_242 = 0x00403140
	branch ebx_241 < (struct Eq_524 *) 0x00403140 l004017F4
l004018BC:
l004018D8:
	Mem295 = PHI((Mem177, l00401863), (Mem136, l004018C4))
	esp_190 = PHI((esp_191, l00401863), (esp_148, l004018C4))
	fn00401648(eax, 0x02, fp - 0x20)
	esp_196 = esp_190
	goto l004018AC
l004018E7:
	fn004015FC(0x004030C4, out ecx_409, out edx_410)
	eax_81 = g_ptr402008
	eax_82 = eax_81->t0000
	branch eax_82 == 0x00 l00401923
l0040190C:
	Mem100 = PHI((Mem78, l00401909), (Mem103, l0040190C))
	eax_87 = PHI((eax_82, l00401909), (eax_104, l0040190C))
	eax_87()
	eax_101 = g_ptr402008
	g_ptr402008 = (struct Eq_515 *) &eax_101->t0004
	eax_104 = eax_101->t0004
	branch eax_104 != 0x00 l0040190C
l00401923:
	eax_341 = PHI((eax_82, l004018E7), (eax_104, l0040190C))
	return eax_341
fn0040172C_exit:
}

Eq_179 g_t4018F8 = ??/* Unexpected function type (fn void ()) */ ; // 004018F8
// 00401974: Register word32 fn00401974(Register out ptr32 edxOut)
// Called from:
//      fn00401000
//      fn0040138C
word32 fn00401974(ptr32 & edxOut)
{
	word32 ecx_47 = g_dw405040;
	if (ecx_47 == 0x00)
	{
		g_dw405040 = 0x01;
		void (** esp_23)() = fp - 0x1C;
		ui32 ebx_24 = g_dw401C60;
		if (ebx_24 == ~0x00)
		{
			ebx_24 = 0x00;
			while (true)
			{
				ui32 eax_31 = ebx_24 + 0x01;
				edx = (ptr32) (&g_dw401C60)[eax_31 * 0x04];
				if (edx == 0x00)
					break;
				ebx_24 = eax_31;
			}
		}
		for (; ebx_24 != 0x00; --ebx_24)
		{
			word32 eax_48;
			fn909090C3();
		}
		*esp_23 = (void (**)()) &g_t4018F8;
		fn0040129C(*esp_23);
		edxOut = edx;
		return ecx_47;
	}
	else
	{
		edxOut = edx;
		return ecx_47;
	}
}

// 00401998: Register word32 fn00401998(Register word32 ecx, Register Eq_3 edx)
// Called from:
//      fn00401B04
word32 fn00401998(word32 ecx, Eq_3 edx)
{
	Eq_167 eax_15 = g_t405048;
	if (eax_15 == 0x00)
		return ecx;
	EnterCriticalSection(&g_t40504C);
	word32 * esp_21 = fp - 0x1C;
	struct Eq_748 * ebx_24;
	for (ebx_24 = g_ptr405064; ebx_24 != null; ebx_24 = ebx_24->ptr0008)
	{
		Eq_3 edx_54;
		*esp_21 = ebx_24->dw0000;
		struct Eq_779 * esp_34 = esp_21 + 1;
		Eq_3 eax_33 = TlsGetValue(*esp_21);
		esp_34->tFFFFFFFC = edx;
		esp_21 = esp_34 - 4;
		eax_15 = GetLastError();
		if (eax_15 == 0x00 && eax_33 != null)
		{
			<anonymous> * eax_46 = ebx_24->ptr0004;
			esp_34->tFFFFFFFC = eax_33;
			eax_46();
			edx = edx_54;
		}
	}
	*esp_21 = 0x0040504C;
	LeaveCriticalSection(*esp_21);
	*esp_21 = (word32) eax_15;
	return ecx;
}

// 00401B04: Register word32 fn00401B04(Register word32 ecx, Register Eq_3 edx, Stack up32 dwArg08)
// Called from:
//      fn0040148C
word32 fn00401B04(word32 ecx, Eq_3 edx, up32 dwArg08)
{
	if (dwArg08 == 0x01)
	{
		if (g_t405048 == 0x00)
			InitializeCriticalSection(&g_t40504C);
		g_t405048 = 0x01;
		return ecx;
	}
	else
	{
		if (dwArg08 >= 0x01)
		{
			if (dwArg08 == 0x03)
				ecx = fn00401998(ecx, edx);
		}
		else
		{
			ecx = fn00401998(ecx, edx);
			if (g_t405048 == 0x01)
			{
				g_t405048 = 0x00;
				DeleteCriticalSection(&g_t40504C);
			}
		}
		return ecx;
	}
}

ui32 g_dw401C60 = ~0x00; // 00401C60
Eq_515 g_t401C74 = // 00401C74
	{
		
		{
			null
		},
		
		{
			null
		},
	};
