// subject_bss.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw405000 = 0x00; // 00405000
word32 g_dw405004 = 0x00; // 00405004
word32 g_dw405034 = 0x00; // 00405034
word32 g_dw40503C = 0x00; // 0040503C
word32 g_dw405040 = 0x00; // 00405040
word32 g_dw405044 = 0x00; // 00405044
Eq_129 g_t405048 = 0x00; // 00405048
struct _RTL_CRITICAL_SECTION g_t40504C = // 0040504C
	{
		null,
		0,
		0,
		null,
		null,
		0x00,
	};
struct Eq_617 * g_ptr405064 = null; // 00405064
// subject_data.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

int32 g_dw402000 = -1; // 00402000
word32 g_dw402004 = 0x4000; // 00402004
struct Eq_416 * g_ptr402008 = &g_t401C74; // 00402008
// subject_idata.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw406064 = 24988; // 00406064
word32 g_dw406068 = 25012; // 00406068
word32 g_dw40606C = 0x61CC; // 0040606C
word32 g_dw406070 = 25050; // 00406070
word32 g_dw406074 = 25066; // 00406074
word32 g_dw406078 = 0x61FE; // 00406078
word32 g_dw40607C = 0x6210; // 0040607C
word32 g_dw406080 = 0x622C; // 00406080
word32 g_dw406084 = 0x6244; // 00406084
word32 g_dw406088 = 0x6262; // 00406088
word32 g_dw40608C = 25200; // 0040608C
word32 g_dw406090 = 0x6282; // 00406090
word32 g_dw406098 = 0x6292; // 00406098
word32 g_dw40609C = 25250; // 0040609C
word32 g_dw4060A0 = 25266; // 004060A0
word32 g_dw4060A4 = 0x62C0; // 004060A4
word32 g_dw4060A8 = 0x62D2; // 004060A8
word32 g_dw4060AC = 0x62DC; // 004060AC
word32 g_dw4060B0 = 0x62E4; // 004060B0
word32 g_dw4060B4 = 0x62EE; // 004060B4
word32 g_dw4060B8 = 25338; // 004060B8
word32 g_dw4060BC = 0x6302; // 004060BC
word32 g_dw4060C0 = 0x630C; // 004060C0
word32 g_dw4060C4 = 0x6316; // 004060C4
word32 g_dw4060C8 = 0x631E; // 004060C8
word32 g_dw4060CC = 0x6328; // 004060CC
word32 g_dw4060D0 = 0x6332; // 004060D0
word32 g_dw4060D8 = 0x6340; // 004060D8
word32 g_dw4060DC = 0x635C; // 004060DC
word32 g_dw4060E4 = 0x6374; // 004060E4
word32 g_dw4060E8 = 0x6388; // 004060E8
word32 g_dw4060EC = 25508; // 004060EC
word32 g_dw4060F0 = 0x63C0; // 004060F0
word32 g_dw4060F4 = 0x63CC; // 004060F4
word32 g_dw4060F8 = 0x640C; // 004060F8
<anonymous> * __imp__DeleteCriticalSection = &g_t619C; // 00406100
<anonymous> * __imp__EnterCriticalSection = &g_t61B4; // 00406104
<anonymous> * __imp__ExitProcess = &g_t61CC; // 00406108
<anonymous> * __imp__GetLastError = &g_t61DA; // 0040610C
<anonymous> * __imp__GetModuleHandleA = &g_t61EA; // 00406110
<anonymous> * __imp__GetProcAddress = &g_t61FE; // 00406114
<anonymous> * __imp__InitializeCriticalSection = &g_t6210; // 00406118
<anonymous> * __imp__LeaveCriticalSection = &g_t622C; // 0040611C
<anonymous> * __imp__SetUnhandledExceptionFilter = &g_t6244; // 00406120
<anonymous> * __imp__TlsGetValue = &g_t6262; // 00406124
<anonymous> * __imp__VirtualProtect = &g_t6270; // 00406128
<anonymous> * __imp__VirtualQuery = &g_t6282; // 0040612C
<anonymous> * __imp____getmainargs = &g_t6292; // 00406134
<anonymous> * __imp____p__environ = &g_t62A2; // 00406138
<anonymous> * __imp____p__fmode = &g_t62B2; // 0040613C
<anonymous> * __imp____set_app_type = &g_t62C0; // 00406140
<anonymous> * __imp___cexit = &g_t62D2; // 00406144
<anonymous> * __imp___iob = &g_t62DC; // 00406148
<anonymous> * __imp___onexit = &g_t62E4; // 0040614C
<anonymous> * __imp___setmode = &g_t62EE; // 00406150
<anonymous> * __imp__abort = &g_t62FA; // 00406154
<anonymous> * __imp__atexit = &g_t6302; // 00406158
<anonymous> * __imp__calloc = &g_t630C; // 0040615C
<anonymous> * __imp__free = &g_t6316; // 00406160
<anonymous> * __imp__fwrite = &g_t631E; // 00406164
<anonymous> * __imp__signal = &g_t6328; // 00406168
<anonymous> * __imp__vfprintf = &g_t6332; // 0040616C
<anonymous> * __imp____deregister_frame_info = &g_t6340; // 00406174
<anonymous> * __imp____register_frame_info = &g_t635C; // 00406178
<anonymous> * __imp___ZNSolsEPFRSoS_E = &g_t6374; // 00406180
<anonymous> * __imp___ZNSt8ios_base4InitC1Ev = &g_t6388; // 00406184
<anonymous> * __imp___ZNSt8ios_base4InitD1Ev = &g_t63A4; // 00406188
<anonymous> * __imp___ZSt4cerr = &g_t63C0; // 0040618C
<anonymous> * __imp___ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_ = &g_t63CC; // 00406190
<anonymous> * __imp___ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc = &g_t640C; // 00406194
// subject_rdata.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw403074 = 0x0040148C; // 00403074
void g_v403078 = ??void??; // 00403078
word32 g_dw403128 = 0x00; // 00403128
word32 g_dw40312C = 0x00; // 0040312C
word32 g_dw403130 = 0x01; // 00403130
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: void fn00401000(Register word32 ecx, Register Eq_3 edx, Register word32 ebx)
// Called from:
//      Win32CrtStartup
void fn00401000(word32 ecx, Eq_3 edx, word32 ebx)
{
	char ** ptrLoc10;
	if (g_dw403074 != 0x00)
		ecx = fn0040148C(ecx, edx, 0x02, out ebx);
	SetUnhandledExceptionFilter(&g_t401110);
	fn00401514(ecx, ebx);
	fn004015F4();
	__getmainargs(&g_dw405000, &g_dw405004, &ptrLoc10, g_dw402000);
	word32 eax_62 = g_dw405034;
	if (eax_62 != 0x00)
	{
		g_dw402004 = eax_62;
		setmode(iob->dw0010, eax_62);
		setmode(iob->dw0030, g_dw405034);
		setmode(iob->dw0050, g_dw405034);
	}
	*__p__fmode() = g_dw402004;
	fn0040172C();
	struct Eq_83 * esp_110 = (struct Eq_83 *) <invalid>;
	__align_stack<word32>(esp_110);
	fn00401974();
	esp_110->dw0008 = *__p__environ();
	esp_110->dw0004 = g_dw405004;
	esp_110->dw0000 = g_dw405000;
	Eq_111 eax_132 = fn0040138C();
	cexit();
	*esp_143 = (uint32) eax_132;
	ExitProcess(*esp_143);
}

LONG g_t401110(struct _EXCEPTION_POINTERS * ExceptionInfo) = ??/* Unexpected function type (fn LONG ((ptr32 (struct "_EXCEPTION_POINTERS" 0008)))) */ ; // 00401110
// 0040126C: Register Eq_129 Win32CrtStartup()
Eq_129 Win32CrtStartup()
{
	word32 ebx;
	Eq_3 edx;
	word32 ecx;
	__set_app_type(0x01);
	fn00401000(ecx, edx, ebx);
}

// 0040129C: void fn0040129C(Stack (ptr32 Eq_141) ptrArg04)
// Called from:
//      Win32CrtStartup
//      fn00401974
void fn0040129C(void (* ptrArg04)())
{
	atexit(ptrArg04);
}

// 0040138C: Register word32 fn0040138C()
// Called from:
//      fn00401000
word32 fn0040138C()
{
	struct Eq_83 * fp;
	__align_stack<word32>(fp);
	fn00401974();
	ZNSolsEPFRSoS_E(ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc(0x0040618C, 0x00403064), 0x00401430);
	return 0x00;
}

// 0040148C: Register word32 fn0040148C(Register word32 ecx, Register Eq_3 edx, Stack word32 dwArg08, Register out ptr32 ebxOut)
// Called from:
//      fn00401000
word32 fn0040148C(word32 ecx, Eq_3 edx, word32 dwArg08, ptr32 & ebxOut)
{
	ptr32 ebx;
	if (g_dw405044 != 0x02)
		g_dw405044 = 0x02;
	if (dwArg08 != 0x02 && dwArg08 == 0x01)
		ecx = fn00401B04(ecx, edx, 0x01);
	ebxOut = ebx;
	return ecx;
}

// 00401514: void fn00401514(Register word32 ecx, Register word32 ebx)
// Called from:
//      fn00401000
void fn00401514(word32 ecx, word32 ebx)
{
	byte SCZDOP;
	if (((SCZDOP ^ 0x00200000 ^ SCZDOP) & 0x00200000) != 0x00)
		__cpuid(0x00, ecx, &0x00, &ebx, &ecx, &SCZDOP);
}

// 004015F4: void fn004015F4()
// Called from:
//      fn00401000
void fn004015F4()
{
	__fninit();
}

// 004015FC: Register Eq_82 fn004015FC(Stack word32 dwArg04, Register out ptr32 ecxOut, Register out ptr32 edxOut)
// Called from:
//      fn00401648
//      fn0040172C
Eq_82 fn004015FC(word32 dwArg04, ptr32 & ecxOut, ptr32 & edxOut)
{
	ptr32 fp;
	Eq_82 eax;
	uint32 ecx;
	<unknown>* edx;
	FILE * ebx_17 = iob + 0x40;
	fwrite(&g_v403078, 0x01, 0x17, ebx_17);
	msvcrt.dll!vfprintf(ebx_17, 0x00403078, dwArg04, 0x01, fp + 8, 0x17, ebx_17);
	abort();
	Eq_82 eax_33 = fn00401648(eax, ecx, edx);
	ecxOut = <invalid>;
	edxOut = <invalid>;
	return eax_33;
}

// 00401648: Register Eq_82 fn00401648(Register Eq_82 eax, Register uint32 ecx, Register (ptr32 Eq_212) edx)
// Called from:
//      fn004015FC
//      fn0040172C
Eq_82 fn00401648(Eq_82 eax, uint32 ecx, <unknown> * edx)
{
	Eq_247 tLoc3C;
	Eq_129 tLoc20;
	if (ecx == 0x00)
		return eax;
	if (VirtualQuery(eax, &tLoc3C, 0x1C) == 0x00)
	{
		word32 ecx_223;
		word32 edx_224;
		fn004015FC(0x00403090, out ecx_223, out edx_224);
		return fn0040172C();
	}
	else
	{
		Eq_82 eax_55 = tLoc3C.Protect;
		if (eax_55 == 0x40 || eax_55 == 0x04)
		{
			memcpy(eax, edx, ecx);
			return eax_55;
		}
		else
		{
			VirtualProtect(tLoc3C.BaseAddress, tLoc3C.RegionSize, 0x40, &tLoc20);
			eax.u0 = tLoc3C.Protect;
			memcpy(eax, edx, ecx);
			Eq_289 dwLoc44_153 = &tLoc20;
			if (eax == 0x40 || eax == 0x04)
				return eax;
			return VirtualProtect(tLoc3C.BaseAddress, tLoc3C.RegionSize, tLoc20, dwLoc44_153);
		}
	}
}

// 0040172C: Register Eq_82 fn0040172C()
// Called from:
//      fn00401000
//      fn00401648
Eq_82 fn0040172C()
{
fn0040172C_entry:
	def fp
	def eax
	eax_18 = g_dw40503C
	branch eax_18 == 0x00 l00401748
	g_dw40503C = 0x01
	eax_25 = 0x18
	ebx_28 = (struct Eq_348 *) &g_dw403128
	edi_31 = g_dw403128
	branch edi_31 != 0x00 l00401780
	goto l00401775
l0040172C:
l00401748:
l00401761:
l0040176B:
l00401775:
	esi_36 = g_dw40312C
	branch esi_36 == 0x00 l004017BC
l00401780:
	eax_347 = PHI((eax_25, l0040176B), (eax_25, l0040177F), (eax_54, l004017D2))
	ebx_253 = PHI((ebx_28, l0040176B), (ebx_28, l0040177F), (ebx_47, l004017D2))
	branch ebx_253 >= (struct Eq_348 *) 0x00403140 l0040173E
	goto l00401790
l00401788:
l00401790:
	Mem260 = PHI((Mem23, l00401788), (Mem268, l00401790))
	ebx_259 = PHI((ebx_253, l00401788), (ebx_280, l00401790))
	eax_261 = ebx_259->dw0004
	eax_275 = fn00401648(eax_261 + 0x00400000, 0x04, fp - 36)
	ebx_280 = (struct Eq_348 *) &ebx_259->dw0008
	branch ebx_280 < (struct Eq_348 *) 0x00403140 l00401790
l004017B3:
	esp_292 = fp
	return eax_275
l004017BC:
	ecx_41 = g_dw403130
	branch ecx_41 != 0x00 l004017D9
l004017C6:
	ebx_46 = 0x00403134
l004017D2:
	eax_54 = ebx_47->dw0004
	branch eax_54 != 0x00 l00401780
l004017D9:
	ebx_59 = PHI((ebx_28, l004017BC), (ebx_47, l004017D2))
	eax_61 = ebx_59->dw0008
	branch eax_61 != 0x01 l004018E7
l004017E5:
	ebx_120 = (struct Eq_425 *) (&ebx_59->dw0008 + 1)
	branch ebx_120 >= (struct Eq_425 *) 0x00403140 l0040173E
l004017F4:
	Mem125 = PHI((Mem23, l004017E5), (Mem300, l004018AC))
	ebx_124 = PHI((ebx_120, l004017E5), (ebx_249, l004018AC))
	eax_126 = ebx_124->dw0004 + 0x00400000
	edx_129 = ebx_124->dw0008
	edx_130 = edx_129 & 0xFF
	branch (edx_129 & 0xFF) == 0x10 l00401858
l00401812:
	branch (edx_129 & 0xFF) == 0x20 l00401890
l00401817:
	branch (edx_129 & 0xFF) == 0x08 l00401834
l0040181C:
	eax_162 = fn004015FC(0x004030F8, out ecx_467, out edx_164)
l00401834:
	edx_187 = PHI((edx_130, l00401817), (edx_164, l0040181C))
	Mem168 = PHI((Mem125, l00401817), (Mem158, l0040181C))
	eax_167 = PHI((eax_126, l00401817), (eax_162, l0040181C))
	edi_169 = (word32) eax_167->u0
	branch (edi_169 & 0x80) == 0x00 l00401863
	goto l00401881
l00401858:
	edi_133 = (word32) eax_126->u1
	branch (edi_133 & 0x8000) != 0x00 l004018C4
l00401863:
	edx_186 = PHI((edx_187, l00401834), (edx_130, l00401858))
	branch edx_186 == 0x10 l004018D8
l00401877:
	branch edx_186 == 0x20 l0040189F
l0040187C:
	branch edx_186 != 0x08 l004018AC
l00401881:
	Mem302 = PHI((Mem233, l0040183F), (Mem185, l0040187C))
	fn00401648(eax, 0x01, fp - 32)
	goto l004018AC
l0040189F:
	Mem301 = PHI((Mem152, l00401890), (Mem185, l00401877))
	fn00401648(eax, 0x04, fp - 32)
l004018AC:
	Mem300 = PHI((Mem301, l0040189F), (Mem185, l0040187C), (Mem302, l00401881), (Mem303, l004018D8))
	ebx_249 = &ebx_124->dw0008 + 1
	eax_250 = 0x00403140
	branch ebx_249 < (struct Eq_425 *) 0x00403140 l004017F4
l004018BC:
l004018D8:
	Mem303 = PHI((Mem185, l00401863), (Mem144, l004018C4))
	fn00401648(eax, 0x02, fp - 32)
	goto l004018AC
l004018E7:
	fn004015FC(0x004030C4, out ecx_465, out edx_466)
	eax_86 = g_ptr402008
	eax_87.u0 = eax_86->t0000.u0
	branch eax_87 == 0x00 l00401923
l0040190C:
	Mem106 = PHI((Mem83, l00401909), (Mem109, l0040190C))
	eax_93 = PHI((eax_87, l00401909), (eax_110, l0040190C))
	eax_93()
	eax_107 = g_ptr402008
	g_ptr402008 = (struct Eq_416 *) &eax_107->t0004.u0
	eax_110.u0 = eax_107->t0004.u0
	branch eax_110 != 0x00 l0040190C
l00401923:
	eax_349 = PHI((eax_87, l004018E7), (eax_110, l0040190C))
	esp_119 = fp - 0x3C
	return eax_349
fn0040172C_exit:
}

Eq_141 g_t4018F8 = ??/* Unexpected function type (fn void ()) */ ; // 004018F8
// 00401974: void fn00401974()
// Called from:
//      fn00401000
//      fn0040138C
void fn00401974()
{
	ptr32 fp;
	if (g_dw405040 != 0x00)
		return;
	g_dw405040 = 0x01;
	void (** esp_24)() = fp - 0x1C;
	ui32 ebx_25 = g_dw401C60;
	if (ebx_25 == ~0x00)
	{
		ebx_25 = 0x00;
		while (true)
		{
			ui32 eax_33 = ebx_25 + 1;
			if ((&g_dw401C60)[eax_33 * 0x04] == 0x00)
				break;
			ebx_25 = eax_33;
		}
	}
	for (; ebx_25 != 0x00; --ebx_25)
		fn909090C3();
	*esp_24 = (void (**)()) &g_t4018F8;
	fn0040129C(*esp_24);
}

// 00401998: Register word32 fn00401998(Register word32 ecx, Register Eq_3 edx)
// Called from:
//      fn00401B04
word32 fn00401998(word32 ecx, Eq_3 edx)
{
	ptr32 fp;
	Eq_129 eax_15 = g_t405048;
	if (eax_15 == 0x00)
		return ecx;
	EnterCriticalSection(&g_t40504C);
	word32 * esp_22 = fp - 0x1C;
	struct Eq_617 * ebx_25;
	for (ebx_25 = g_ptr405064; ebx_25 != null; ebx_25 = ebx_25->ptr0008)
	{
		Eq_3 edx_58;
		*esp_22 = ebx_25->dw0000;
		struct Eq_648 * esp_36 = esp_22 + 1;
		Eq_3 eax_35 = TlsGetValue(*esp_22);
		esp_36->tFFFFFFFC.u0 = (LPVOID) edx;
		esp_22 = esp_36 - 4;
		eax_15 = GetLastError();
		if (eax_15 == 0x00 && eax_35 != 0x00)
		{
			<anonymous> * eax_50 = ebx_25->ptr0004;
			esp_36->tFFFFFFFC.u0 = (LPVOID) eax_35;
			eax_50();
			edx = edx_58;
		}
	}
	*esp_22 = 0x0040504C;
	LeaveCriticalSection(*esp_22);
	*esp_22 = (word32) eax_15;
	return ecx;
}

// 00401B04: Register word32 fn00401B04(Register word32 ecx, Register Eq_3 edx, Stack up32 dwArg08)
// Called from:
//      fn0040148C
word32 fn00401B04(word32 ecx, Eq_3 edx, up32 dwArg08)
{
	if (dwArg08 == 0x01)
	{
		if (g_t405048 == 0x00)
			InitializeCriticalSection(&g_t40504C);
		g_t405048 = 0x01;
		return ecx;
	}
	else
	{
		if (dwArg08 >= 0x01)
		{
			if (dwArg08 == 0x03)
				ecx = fn00401998(ecx, edx);
		}
		else
		{
			ecx = fn00401998(ecx, edx);
			if (g_t405048 == 0x01)
			{
				g_t405048 = 0x00;
				DeleteCriticalSection(&g_t40504C);
			}
		}
		return ecx;
	}
}

ui32 g_dw401C60 = ~0x00; // 00401C60
Eq_416 g_t401C74 = // 00401C74
	{
		
		{
			null
		},
		
		{
			null
		},
	};
