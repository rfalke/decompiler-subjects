//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
//

#include <stdint.h>
#include <stdlib.h>

// ------------------- Function Prototypes --------------------

int64_t __do_global_ctors(void);
int64_t __main(void);
int64_t _decode_pointer(int64_t result);
int64_t _encode_pointer(int64_t result);
int64_t mingw_onexit(int64_t a1);

// --------------------- Global Variables ---------------------

int32_t g1 = -1; // 0x402d10
int32_t g2 = 0; // 0x407380
int64_t g3 = 0; // 0x4079a8
int64_t g4 = 0; // 0x4079b0

// ------------------------ Functions -------------------------

// From module:   C:\yegor\tmp/test.cpp
// Address range: 0x4014f0 - 0x40152a
// Line range:    3 - 5
int main() {
    // 0x4014f0
    __main();
    _ZNSolsEPFRSoS_E((int64_t * (*)(int64_t *))_ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc((int64_t *)0x408420, "Hello, World!"));
    return 0;
}

// Address range: 0x401690 - 0x401694
int64_t _decode_pointer(int64_t result) {
    // 0x401690
    return result;
}

// Address range: 0x4016a0 - 0x4016a4
int64_t _encode_pointer(int64_t result) {
    // 0x4016a0
    return result;
}

// Address range: 0x4016b0 - 0x40175a
int64_t mingw_onexit(int64_t a1) {
    int64_t v1 = _decode_pointer(g3); // 0x4016bf
    int64_t v2 = v1; // bp-24, 0x4016c8
    if (v1 == -1) {
        // 0x401745
        return (int64_t)_onexit((int32_t (*)())a1);
    }
    // 0x4016cf
    _lock(8);
    v2 = _decode_pointer(g3);
    int64_t v3 = _decode_pointer(g4); // bp-16, 0x401703
    int32_t (*v4)() = __dllonexit((int32_t (*)())a1, (void (***)())&v2, (void (***)())&v3); // 0x401708
    g3 = _encode_pointer(v2);
    g4 = _encode_pointer(v3);
    _unlock(8);
    return (int64_t)v4;
}

// Address range: 0x4026b0 - 0x402710
int64_t __do_global_ctors(void) {
    int64_t v1 = 0;
    int64_t v2 = v1 + 1; // 0x402702
    while (*(int64_t *)((8 * v2 & 0x7fffffff8) + (int64_t)&g1) != 0) {
        // 0x402702
        v1 = v2 & 0xffffffff;
        v2 = v1 + 1;
    }
    // 0x40270e
    if (v1 == 0) {
        // 0x4026da
        return atexit(0x402670);
    }
    uint32_t v3 = v1; // 0x4026c6
    while (v3 != 0) {
        // 0x4026d0
        v3 = (int64_t)v3;
    }
    // 0x4026da
    return atexit(0x402670);
}

// Address range: 0x402710 - 0x40272c
int64_t __main(void) {
    uint32_t result = g2; // 0x402710
    if (result != 0) {
        // 0x40271a
        return result;
    }
    // 0x402720
    g2 = 1;
    return __do_global_ctors();
}

// --------------- Statically Linked Functions ----------------

// int64_t atexit(int64_t a1);

// --------------- Dynamically Linked Functions ---------------

// _onexit_t __dllonexit(_onexit_t func, _PVFV ** pbegin, _PVFV ** pend);
// void __cdecl _lock(int locknum);
// _onexit_t _onexit(_onexit_t Function);
// void __cdecl _unlock(int locknum);
// int64_t _ZNSolsEPFRSoS_E(int64_t * (*a1)(int64_t *));
// int64_t _ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc(int64_t * a1, char * a2);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: gcc (4.6.3)
// Detected functions: 6

