// subject_PE_header.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

Eq_600 g_t400000 = // 00400000
	{
		23117,
		0xE0,
	};
// subject_data.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

ui32 g_dw405078 = 0xBB40E64E; // 00405078
ui32 g_dw40507C = 1153374641; // 0040507C
word32 g_dw405190 = 0x00; // 00405190
Eq_146 g_t405194 = // 00405194
	{
		0x00
	};
word32 g_dw405198 = 0x00; // 00405198
word32 g_dw40519C = 0x00; // 0040519C
Eq_146 g_t4051A8 = // 004051A8
	{
		0x00
	};
word32 g_dw4051AC = 0x00; // 004051AC
word32 g_dw4054E4 = 0x00; // 004054E4
Eq_232 g_t4054F4 = 0; // 004054F4
word32 g_dw40550C = 0x00; // 0040550C
<anonymous> * g_ptr405510 = null; // 00405510
// subject_idata.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw40603C = 0x6556; // 0040603C
word32 g_dw406040 = 25922; // 00406040
word32 g_dw406044 = 25902; // 00406044
word32 g_dw406048 = 0x6514; // 00406048
word32 g_dw40604C = 25854; // 0040604C
word32 g_dw406050 = 25832; // 00406050
word32 g_dw406054 = 0x64D8; // 00406054
word32 g_dw406058 = 0x64BE; // 00406058
word32 g_dw40605C = 25774; // 0040605C
word32 g_dw406060 = 0x6490; // 00406060
word32 g_dw406064 = 0x6480; // 00406064
word32 g_dw406068 = 0x646A; // 00406068
word32 g_dw40606C = 0x644C; // 0040606C
word32 g_dw406070 = 0x6444; // 00406070
word32 g_dw406074 = 25646; // 00406074
word32 g_dw406078 = 0x6572; // 00406078
word32 g_dw4060B4 = 0x637C; // 004060B4
word32 g_dw4060B8 = 25522; // 004060B8
word32 g_dw4060BC = 25532; // 004060BC
word32 g_dw4060C0 = 0x6368; // 004060C0
word32 g_dw4060C4 = 25554; // 004060C4
word32 g_dw4060C8 = 25564; // 004060C8
word32 g_dw4060CC = 0x63F6; // 004060CC
word32 g_dw4060D0 = 0x6408; // 004060D0
word32 g_dw4060D4 = 25624; // 004060D4
word32 g_dw4060D8 = 0x6356; // 004060D8
word32 g_dw4060DC = 25420; // 004060DC
word32 g_dw4060E0 = 0x6340; // 004060E0
word32 g_dw4060E4 = 25388; // 004060E4
word32 g_dw4060E8 = 0x6316; // 004060E8
word32 g_dw4060EC = 25352; // 004060EC
word32 g_dw4060F0 = 0x62FC; // 004060F0
word32 g_dw4060F4 = 0x62F0; // 004060F4
word32 g_dw4060F8 = 25320; // 004060F8
word32 g_dw4060FC = 0x62DA; // 004060FC
word32 g_dw406100 = 0x62D2; // 00406100
word32 g_dw406104 = 25288; // 00406104
word32 g_dw406108 = 25272; // 00406108
word32 g_dw40610C = 25258; // 0040610C
word32 g_dw406110 = 25228; // 00406110
word32 g_dw406114 = 25546; // 00406114
word32 g_dw406118 = 25212; // 00406118
<anonymous> * __imp__UnhandledExceptionFilter = &g_t6556; // 0040615C
<anonymous> * __imp__GetCurrentProcess = &g_t6542; // 00406160
<anonymous> * __imp__TerminateProcess = &g_t652E; // 00406164
<anonymous> * __imp__GetSystemTimeAsFileTime = &g_t6514; // 00406168
<anonymous> * __imp__GetCurrentProcessId = &g_t64FE; // 0040616C
<anonymous> * __imp__GetCurrentThreadId = &g_t64E8; // 00406170
<anonymous> * __imp__GetTickCount = &g_t64D8; // 00406174
<anonymous> * __imp__QueryPerformanceCounter = &g_t64BE; // 00406178
<anonymous> * __imp__DecodePointer = &g_t64AE; // 0040617C
<anonymous> * __imp__SetUnhandledExceptionFilter = &g_t6490; // 00406180
<anonymous> * __imp__EncodePointer = &g_t6480; // 00406184
<anonymous> * __imp__HeapSetInformation = &g_t646A; // 00406188
<anonymous> * __imp__InterlockedCompareExchange = &g_t644C; // 0040618C
<anonymous> * __imp__Sleep = &g_t6444; // 00406190
<anonymous> * __imp__InterlockedExchange = &g_t642E; // 00406194
<anonymous> * __imp__IsDebuggerPresent = &g_t6572; // 00406198
<anonymous> * __imp__?_type_info_dtor_internal_method@type_info@@QAEXXZ = &g_t637C; // 004061D4
<anonymous> * __imp___unlock = &g_t63B2; // 004061D8
<anonymous> * __imp____dllonexit = &g_t63BC; // 004061DC
<anonymous> * __imp__?terminate@@YAXXZ = &g_t6368; // 004061E0
<anonymous> * __imp___onexit = &g_t63D2; // 004061E4
<anonymous> * __imp___except_handler4_common = &g_t63DC; // 004061E8
<anonymous> * __imp___invoke_watson = &g_t63F6; // 004061EC
<anonymous> * __imp___controlfp_s = &g_t6408; // 004061F0
<anonymous> * __imp___crt_debugger_hook = &g_t6418; // 004061F4
<anonymous> * __imp____set_app_type = &g_t6356; // 004061F8
<anonymous> * __imp___fmode = &g_t634C; // 004061FC
<anonymous> * __imp___commode = &g_t6340; // 00406200
<anonymous> * __imp____setusermatherr = &g_t632C; // 00406204
<anonymous> * __imp___configthreadlocale = &g_t6316; // 00406208
<anonymous> * __imp___initterm_e = &g_t6308; // 0040620C
<anonymous> * __imp___initterm = &g_t62FC; // 00406210
<anonymous> * __imp____initenv = &g_t62F0; // 00406214
<anonymous> * __imp__exit = &g_t62E8; // 00406218
<anonymous> * __imp___XcptFilter = &g_t62DA; // 0040621C
<anonymous> * __imp___exit = &g_t62D2; // 00406220
<anonymous> * __imp___cexit = &g_t62C8; // 00406224
<anonymous> * __imp____getmainargs = &g_t62B8; // 00406228
<anonymous> * __imp___amsg_exit = &g_t62AA; // 0040622C
<anonymous> * __imp__??2@YAPAXI@Z = &g_t628C; // 00406230
<anonymous> * __imp___lock = &g_t63CA; // 00406234
<anonymous> * __imp__??3@YAXPAX@Z = &g_t627C; // 00406238
// subject_rdata.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

Eq_328 g_t403000 = null; // 00403000
Eq_324 g_t403208 = null; // 00403208
<anonymous> * ??_7Z@@6B@[1] = // 00403740
	{
		fn00401041,
	};
<anonymous> * ??_7B@@6B@[2] = // 0040375C
	{
		fn00401069,
		fn0040100A,
	};
<anonymous> * g_ptr40376C = &g_t401005; // 0040376C
<anonymous> * ??_7C@@6B@[2] = // 0040377C
	{
		fn00401019,
		fn00401028,
	};
<anonymous> * ??_7type_info@@6B@[1] = // 00403798
	{
		fn00401360,
	};
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> g_t401005 = <code>; // 00401005
// 0040100A: void fn0040100A(Register (ptr32 ptr32) ecx, Stack byte bArg04)
void fn0040100A(ptr32 * ecx, byte bArg04)
{
	*ecx = 0x0040375C;
	if ((bArg04 & 0x01) != 0x00)
		operator delete(ecx);
}

// 00401019: void fn00401019()
void fn00401019()
{
}

// 00401028: void fn00401028(Register (ptr32 Eq_16) ecx, Stack byte bArg04)
void fn00401028(struct Eq_16 * ecx, byte bArg04)
{
	ecx->ptr0008 = 0x0040375C;
	ecx->ptr0000 = 0x0040374C;
	ecx->ptrFFFFFFF8 = 0x00403740;
	if ((bArg04 & 0x01) != 0x00)
		operator delete(ecx - 0x08);
}

// 00401041: void fn00401041(Register (ptr32 ptr32) ecx, Stack byte bArg04)
void fn00401041(ptr32 * ecx, byte bArg04)
{
	*ecx = 0x00403740;
	if ((bArg04 & 0x01) != 0x00)
		operator delete(ecx);
}

// 00401069: void fn00401069()
void fn00401069()
{
	operator new(0x50);
}

// 0040106E: Register word32 fn0040106E()
// Called from:
//      Win32CrtStartup
word32 fn0040106E()
{
	struct Eq_60 * eax_6 = operator new(0x18);
	if (eax_6 == null)
	{
		<anonymous> ** eax_17 = *(<anonymous> ***) 16;
		(*eax_17)();
		return;
	}
	else
	{
		eax_6->dw0004 = 0x0A;
		eax_6->ptr0008 = 0x0040374C;
		eax_6->ptr0010 = ??_7B@@6B@;
		eax_6->ptr0000 = 4208524;
		eax_6->ptr0008 = 0x0040377C;
		eax_6->ptr0010 = &g_ptr40376C;
		<anonymous> ** eax_36 = eax_6->ptr0010;
		(*eax_36)();
		return;
	}
}

// 00401360: void fn00401360(Register (ptr32 Eq_105) ecx, Register word32 ebx, Stack byte bArg04)
void fn00401360(struct type_info * ecx, word32 ebx, byte bArg04)
{
	if ((bArg04 & 0x02) != 0x00)
	{
		void * esi_48;
		if ((fn00401714(ebx, ecx - 4, ecx, out esi_48)->b0008 & 0x01) != 0x00)
			operator delete(esi_48);
	}
	else
	{
		_type_info_dtor_internal_method(ecx);
		if ((bArg04 & 0x01) != 0x00)
			operator delete(ecx);
	}
}

// 0040169A: Register Eq_146 Win32CrtStartup()
Eq_146 Win32CrtStartup()
{
	ptr32 fp;
	struct Eq_148 * fs;
	word32 ebx;
	Eq_124 esi;
	struct type_info * edi;
	word32 dwLoc0C;
	Eq_153 tLoc14;
	fn00401B30();
	ptr32 esp_12 = fp - 8;
	struct Eq_160 * ebp_19 = fn00401A50(ebx, esi, edi, dwLoc0C, 0x10);
	if (g_dw40550C == 0x00)
	{
		HeapSetInformation(null, tLoc14, (void *) 0x01, 0x00);
		esp_12 = fp - 0x0C;
	}
	ebp_19->dwFFFFFFFC = 0x00;
	Eq_146 esi_42 = fs->ptr0018->t0004.u0;
	ebp_19->dwFFFFFFE4 = 0x00;
	while (true)
	{
		struct Eq_204 * esp_46 = esp_12 - 4;
		esp_46->t0000.u0 = 0x00;
		esp_46->tFFFFFFFC.u0 = (DWORD) esi_42;
		esp_46->ptrFFFFFFF8 = &g_t4054F4;
		Eq_146 eax_55 = InterlockedCompareExchange(esp_46->ptrFFFFFFF8, esp_46->tFFFFFFFC.u1, esp_46->t0000.u1);
		if (eax_55 == 0x00)
			break;
		if (eax_55 == esi_42)
		{
			ebp_19->dwFFFFFFE4 = 0x01;
			break;
		}
		esp_46->t0000.u0 = 1000;
		Sleep(esp_46->t0000.u0);
	}
	if (g_dw4054E4 == 0x01)
	{
		esp_46->t0000.u0 = 0x1F;
		_amsg_exit(esp_46->t0000.u1);
	}
	struct Eq_253 * esp_203;
	Eq_146 eax_224;
	if (g_dw4054E4 == 0x00)
	{
		g_dw4054E4 = 0x01;
		esp_46->t0000.u0 = 0x00403618;
		esp_46->tFFFFFFFC.u0 = 0x0040330C;
		esp_203 = (struct Eq_253 *) ((char *) &esp_46->t0000 + 4);
		if (_initterm_e(esp_46->tFFFFFFFC.u0, esp_46->t0000.u0) != 0x00)
		{
			ebp_19->dwFFFFFFFC = ~0x01;
			eax_224.u0 = 0xFF;
			goto l00401593;
		}
	}
	else
		g_dw4051AC = 0x01;
	if (g_dw4054E4 == 0x01)
	{
		struct Eq_321 * esp_106 = esp_12 - 4;
		esp_106->ptr0000 = &g_t403208;
		esp_106->ptrFFFFFFFC = &g_t403000;
		_initterm(esp_106->ptrFFFFFFFC, esp_106->ptr0000);
		g_dw4054E4 = 0x02;
	}
	if (ebp_19->dwFFFFFFE4 == 0x00)
	{
		struct Eq_350 * esp_125 = esp_12 - 4;
		esp_125->t0000.u0 = 0x00;
		esp_125->ptrFFFFFFFC = (LONG *) &g_t4054F4;
		InterlockedExchange(esp_125->ptrFFFFFFFC, esp_125->t0000.u1);
	}
	ptr32 esp_138 = esp_12;
	if (g_ptr405510 != null)
	{
		struct Eq_408 * esp_139 = esp_12 - 4;
		esp_139->dw0000 = 0x00405510;
		esp_138 = &esp_139->dw0000 + 1;
		if (fn00401980(esp_139->dw0000) != 0x00)
		{
			esp_139->dw0000 = 0x00;
			esp_139->dwFFFFFFFC = 0x02;
			esp_139->dwFFFFFFF8 = 0x00;
			word32 edx_179;
			g_ptr405510();
		}
	}
	_initenv->u0 = g_t405194.u0;
	struct Eq_379 * esp_187 = esp_138 - 4;
	esp_187->t0000.u0 = g_t405194.u0;
	esp_187->dwFFFFFFFC = g_dw405198;
	esp_187->dwFFFFFFF8 = g_dw405190;
	Eq_146 eax_195 = fn0040106E();
	g_t4051A8.u0 = (DWORD) eax_195;
	esp_203 = (struct Eq_253 *) ((char *) &esp_187->t0000 + 4);
	if (g_dw40519C == 0x00)
	{
		esp_187->t0000.u0 = (DWORD) eax_195;
		exit(esp_187->t0000.u1);
	}
	if (g_dw4051AC == 0x00)
		cexit();
	ebp_19->dwFFFFFFFC = ~0x01;
	eax_224.u0 = g_t4051A8.u0;
l00401593:
	word32 esi_239;
	fn00401A95(ebp_19, esp_203->ptrFFFFFFFC, out esi_239);
	return eax_224;
}

// 004016B6: Register word32 fn004016B6(Register word32 ebx, Register Eq_124 esi, Register (ptr32 Eq_105) edi)
// Called from:
//      fn0040175F
word32 fn004016B6(word32 ebx, Eq_124 esi, struct type_info * edi)
{
	ptr32 fp;
	word32 dwLoc0C;
	struct Eq_160 * ebp_13 = fn00401A50(ebx, esi, edi, dwLoc0C, 0x14);
	ebp_13->dwFFFFFFFC = 0x00;
	struct Eq_475 * esp_31 = fp - 8;
	while (true)
	{
		int32 v9_25 = ebp_13->dw0010 - 0x01;
		ebp_13->dw0010 = v9_25;
		if (v9_25 < 0x00)
			break;
		word32 ecx_39 = ebp_13->dw0008 - (ebp_13->t000C).u0;
		ebp_13->dw0008 = ecx_39;
		ebp_13->ptr0014();
	}
	ebp_13->dwFFFFFFFC = ~0x01;
	word32 esi_60;
	return fn00401A95(ebp_13, esp_31->ptrFFFFFFFC, out esi_60);
}

// 00401714: Register word32 fn00401714(Register word32 ebx, Register Eq_124 esi, Register (ptr32 Eq_105) edi, Register out ptr32 esiOut)
// Called from:
//      fn00401360
word32 fn00401714(word32 ebx, Eq_124 esi, struct type_info * edi, ptr32 & esiOut)
{
	ptr32 fp;
	word32 dwLoc0C;
	struct Eq_160 * ebp_13 = fn00401A50(ebx, esi, edi, dwLoc0C, 0x0C);
	ebp_13->dwFFFFFFE4 = 0x00;
	Eq_124 esi_21 = ebp_13->t000C.u0;
	ebp_13->dw0008 += esi_21 *s ebp_13->dw0010;
	ebp_13->dwFFFFFFFC = 0x00;
	struct Eq_544 * esp_53 = fp - 8;
	while (true)
	{
		int32 v14_33 = ebp_13->dw0010 - 0x01;
		ebp_13->dw0010 = v14_33;
		if (v14_33 < 0x00)
			break;
		ebp_13->dw0008 -= esi_21;
		ebp_13->ptr0014();
	}
	ebp_13->dwFFFFFFE4 = 0x01;
	ebp_13->dwFFFFFFFC = ~0x01;
	ptr32 esi_58;
	word32 ebp_54 = fn00401A95(fn0040175F(ebx, ebp_13, esi_21, edi), esp_53->ptrFFFFFFFC, out esi_58);
	esiOut = esi_58;
	return ebp_54;
}

// 0040175F: Register (ptr32 Eq_160) fn0040175F(Register word32 ebx, Register (ptr32 Eq_160) ebp, Register Eq_124 esi, Register (ptr32 Eq_105) edi)
// Called from:
//      fn00401714
struct Eq_160 * fn0040175F(word32 ebx, struct Eq_160 * ebp, Eq_124 esi, struct type_info * edi)
{
	if (ebp->dwFFFFFFE4 == 0x00)
		ebp = fn004016B6(ebx, esi, edi);
	return ebp;
}

// 004018F0: Register uint32 fn004018F0(Stack (ptr32 Eq_600) dwArg04)
// Called from:
//      fn00401980
uint32 fn004018F0(struct Eq_600 * dwArg04)
{
	if (dwArg04->w0000 != 23117)
		return 0x00;
	struct Eq_606 * eax_16 = dwArg04 + dwArg04->dw003C / 64;
	if (eax_16->dw0000 != 0x4550)
		return 0x00;
	return (uint32) (int8) (eax_16->w0018 == 0x010B);
}

// 00401930: Register (ptr32 Eq_624) fn00401930(Stack (ptr32 Eq_625) dwArg04, Stack uint32 dwArg08)
// Called from:
//      fn00401980
struct Eq_624 * fn00401930(struct Eq_625 * dwArg04, uint32 dwArg08)
{
	struct Eq_627 * ecx_12 = dwArg04 + dwArg04->dw003C / 64;
	up32 esi_20 = (word32) ecx_12->w0006;
	up32 edx_21 = 0x00;
	struct Eq_624 * eax_24 = ecx_12 + ((word32) ecx_12->w0014 + 24) / 22;
	if (esi_20 != 0x00)
	{
		do
		{
			uint32 ecx_32 = eax_24->dw000C;
			if (dwArg08 >= ecx_32 && dwArg08 < eax_24->dw0008 + ecx_32)
				return eax_24;
			++edx_21;
			++eax_24;
		} while (edx_21 < esi_20);
	}
	eax_24 = null;
	return eax_24;
}

// 00401980: Register ui32 fn00401980(Stack ui32 dwArg04)
// Called from:
//      Win32CrtStartup
ui32 fn00401980(ui32 dwArg04)
{
	ptr32 fp;
	struct Eq_667 * fs;
	ptr32 eax_17 = fs->ptr0000;
	fs->ptr0000 = fp - 20;
	if (fn004018F0(&g_t400000) != 0x00)
	{
		struct Eq_687 * eax_64 = fn00401930(&g_t400000, dwArg04 - 0x00400000);
		if (eax_64 != null)
		{
			ui32 eax_100 = ~(eax_64->dw0024 >> 0x1F) & 0x01;
			fs->ptr0000 = eax_17;
			return eax_100;
		}
	}
	fs->ptr0000 = eax_17;
	return 0x00;
}

// 00401A50: Register ptr32 fn00401A50(Register word32 ebx, Register Eq_124 esi, Register (ptr32 Eq_105) edi, Stack word32 dwArg00, Stack ui32 dwArg08)
// Called from:
//      Win32CrtStartup
//      fn004016B6
//      fn00401714
ptr32 fn00401A50(word32 ebx, Eq_124 esi, struct type_info * edi, word32 dwArg00, ui32 dwArg08)
{
	ptr32 fp;
	struct Eq_710 * fs;
	struct Eq_711 * esp_14 = fp - 8 - dwArg08;
	esp_14->dwFFFFFFFC = ebx;
	esp_14->tFFFFFFF8.u0 = (int32) esi;
	esp_14->ptrFFFFFFF4 = edi;
	esp_14->dwFFFFFFF0 = g_dw405078 ^ fp + 8;
	esp_14->dwFFFFFFEC = dwArg00;
	fs->ptr0000 = fp - 8;
	return fp + 8;
}

// 00401A95: Register (ptr32 Eq_160) fn00401A95(Register (ptr32 Eq_160) ebp, Stack (ptr32 Eq_160) dwArg00, Register out ptr32 esiOut)
// Called from:
//      Win32CrtStartup
//      fn004016B6
//      fn00401714
struct Eq_160 * fn00401A95(struct Eq_160 * ebp, struct Eq_160 * dwArg00, ptr32 & esiOut)
{
	struct Eq_741 * fs;
	ptr32 dwArg0C;
	fs->dw0000 = ebp->dwFFFFFFF0;
	struct Eq_160 * ebp_19 = ebp->ptr0000;
	ebp->ptr0000 = dwArg00;
	esiOut = dwArg0C;
	return ebp_19;
}

// 00401B30: void fn00401B30()
// Called from:
//      Win32CrtStartup
void fn00401B30()
{
	Eq_756 tLoc14;
	Eq_757 tLoc0C;
	ui32 eax_11 = g_dw405078;
	tLoc0C.dwLowDateTime = (DWORD) 0x00;
	tLoc0C.dwHighDateTime = (DWORD) 0x00;
	if (eax_11 != 0xBB40E64E && (eax_11 & 0xFFFF0000) != 0x00)
		g_dw40507C = ~eax_11;
	else
	{
		GetSystemTimeAsFileTime(&tLoc0C);
		ui32 esi_48 = tLoc0C.dwHighDateTime ^ tLoc0C.dwLowDateTime ^ GetCurrentProcessId() ^ GetCurrentThreadId() ^ GetTickCount();
		QueryPerformanceCounter(&tLoc14);
		ui32 esi_56 = esi_48 ^ (tLoc14.dw0004 ^ (tLoc14.u).LowPart);
		if (esi_56 == 0xBB40E64E)
			esi_56 = ~0x44BF19B0;
		else if ((esi_56 & 0xFFFF0000) == 0x00)
			esi_56 |= (esi_56 | 0x4711) << 0x10;
		g_dw405078 = esi_56;
		g_dw40507C = ~esi_56;
	}
}

