/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

int sub_401000();
int (**sub_401010())();
void *__thiscall sub_401040(void *this, char a2);
void __thiscall CWinApp::~CWinApp(CWinApp *__hidden this); // idb
int sub_401070();
// int unknown_libname_1(void); weak
// void __cdecl unknown_libname_2(); idb
int __thiscall sub_4010B0(CWinApp *this);
void __thiscall CDialog::~CDialog(CDialog *__hidden this); // idb
CDialog *__thiscall sub_401150(CDialog *this, struct CWnd *a2);
void *__thiscall sub_4011C0(void *this, char a2);
int sub_4011F0();
int (**sub_401200())();
int __thiscall sub_401210(int this);
void __thiscall sub_401250(struct CWnd *this);
void *__thiscall sub_4015A0(void *this, char a2);
int __thiscall sub_4015C0(CGdiObject *this);
int __thiscall sub_401610(CGdiObject *this);
int __thiscall sub_401660(CGdiObject *this);
void *__thiscall sub_4016B0(void *this, char a2);
int __thiscall sub_4016D0(CGdiObject *this);
BOOL __thiscall sub_401720(HWND *this);
BOOL __thiscall sub_401730(HWND *this);
// void __cdecl operator delete(void *); idb
// void __thiscall CDialog::~CDialog(CDialog *__hidden this); idb
// int __thiscall CDialog::DoModal(CDialog *__hidden this); idb
// int __thiscall CWinApp::Enable3dControls(CWinApp *__hidden this); idb
// HINSTANCE __stdcall AfxFindResourceHandle(const char *, const char *); idb
// struct AFX_MODULE_STATE *__stdcall AfxGetModuleState(); idb
// CDialog *__thiscall CDialog::CDialog(CDialog *__hidden this, unsigned int, struct CWnd *); idb
// int __thiscall CDialog::OnInitDialog(CDialog *__hidden this); idb
// void __thiscall CPaintDC::~CPaintDC(CPaintDC *__hidden this); idb
// int __thiscall CGdiObject::DeleteObject(CGdiObject *__hidden this); idb
// struct CFont *__thiscall CDC::SelectObject(CDC *__hidden this, struct CFont *); idb
// int __thiscall CGdiObject::Attach(CGdiObject *__hidden this, void *); idb
// int __thiscall CDC::SetBkMode(CDC *__hidden this, int); idb
// unsigned int __thiscall CDC::SetTextAlign(CDC *__hidden this, unsigned int); idb
// struct CPen *__thiscall CDC::SelectObject(CDC *__hidden this, struct CPen *); idb
// CPen *__thiscall CPen::CPen(CPen *__hidden this, int, int, unsigned int); idb
// int __thiscall CDC::LineTo(CDC *__hidden this, int, int); idb
// int __thiscall CDC::MoveTo(_DWORD, _DWORD, _DWORD, _DWORD); weak
// CBrush *__thiscall CBrush::CBrush(CBrush *__hidden this, unsigned int); idb
// int __thiscall CDC::SetMapMode(CDC *__hidden this, int); idb
// CPaintDC *__thiscall CPaintDC::CPaintDC(CPaintDC *__hidden this, struct CWnd *); idb
// int __cdecl atexit(void (__cdecl *)());
int __cdecl UserMathErrorFunction();
// _AFX_TERM_APP_STATE *__thiscall _AFX_TERM_APP_STATE::_AFX_TERM_APP_STATE(_AFX_TERM_APP_STATE *__hidden this); idb
_AFX_TERM_APP_STATE *sub_401C55();
// BOOL __stdcall GetTextExtentPointA(HDC hdc, LPCSTR lpString, int c, LPSIZE lpsz);
// BOOL __stdcall TextOutA(HDC hdc, int x, int y, LPCSTR lpString, int c);
// HFONT __stdcall CreateFontA(int cHeight, int cWidth, int cEscapement, int cOrientation, int cWeight, DWORD bItalic, DWORD bUnderline, DWORD bStrikeOut, DWORD iCharSet, DWORD iOutPrecision, DWORD iClipPrecision, DWORD iQuality, DWORD iPitchAndFamily, LPCSTR pszFaceName);
// HGDIOBJ __stdcall SelectObject(HDC hdc, HGDIOBJ h);
// BOOL __stdcall EnableWindow(HWND hWnd, BOOL bEnable);
// LRESULT __stdcall SendMessageA(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// int __stdcall FillRect(HDC hDC, const RECT *lprc, HBRUSH hbr);
// HICON __stdcall LoadIconA(HINSTANCE hInstance, LPCSTR lpIconName);

//-------------------------------------------------------------------------
// Data declarations

int (*off_402000)() = &sub_401000; // weak
int (*off_4020E0)() = &sub_4011F0; // weak
struct CRuntimeClass *(__thiscall *off_402138)(CDialog *__hidden this) = &CDialog::GetRuntimeClass; // weak
struct CRuntimeClass *(__thiscall *off_402210)(CObject *__hidden this) = &CObject::GetRuntimeClass; // weak
struct CRuntimeClass *(__thiscall *off_402228)(CGdiObject *__hidden this) = &CGdiObject::GetRuntimeClass; // weak
struct CRuntimeClass *(__thiscall *off_402240)(CFont *__hidden this) = &CFont::GetRuntimeClass; // weak
char aFading[10] = "Fading..."; // weak
CHAR pszFaceName[] = "Arial"; // idb
_UNKNOWN unk_403124; // weak
// extern _UNKNOWN CDialog::messageMap; weak
// extern _UNKNOWN CWinApp::messageMap; weak


//----- (00401000) --------------------------------------------------------
int sub_401000()
{
  return CWinApp::messageMap;
}

//----- (00401010) --------------------------------------------------------
int (**sub_401010())()
{
  return &off_402000;
}
// 402000: using guessed type int (*off_402000)();

//----- (00401040) --------------------------------------------------------
void *__thiscall sub_401040(void *this, char a2)
{
  CWinApp::~CWinApp((CWinApp *)this);
  if ( (a2 & 1) != 0 )
    operator delete(this);
  return this;
}

//----- (00401070) --------------------------------------------------------
int sub_401070()
{
  unknown_libname_1();
  return atexit(unknown_libname_2);
}
// 401080: using guessed type int unknown_libname_1(void);

//----- (004010B0) --------------------------------------------------------
int __thiscall sub_4010B0(CWinApp *this)
{
  char v3[100]; // [esp+4h] [ebp-70h] BYREF
  int v4; // [esp+70h] [ebp-4h]

  CWinApp::Enable3dControls(this);
  sub_401150((CDialog *)v3, 0);
  v4 = 0;
  *((_DWORD *)this + 8) = v3;
  CDialog::DoModal((CDialog *)v3);
  v4 = -1;
  CDialog::~CDialog((CDialog *)v3);
  return 0;
}

//----- (00401150) --------------------------------------------------------
CDialog *__thiscall sub_401150(CDialog *this, struct CWnd *a2)
{
  HINSTANCE v3; // eax

  CDialog::CDialog(this, 0x66u, a2);
  *(_DWORD *)this = &off_402138;
  AfxGetModuleState();
  v3 = AfxFindResourceHandle((const char *)0x80, (const char *)0xE);
  *((_DWORD *)this + 24) = LoadIconA(v3, (LPCSTR)0x80);
  return this;
}
// 402138: using guessed type struct CRuntimeClass *(__thiscall *off_402138)(CDialog *__hidden this);

//----- (004011C0) --------------------------------------------------------
void *__thiscall sub_4011C0(void *this, char a2)
{
  CDialog::~CDialog((CDialog *)this);
  if ( (a2 & 1) != 0 )
    operator delete(this);
  return this;
}

//----- (004011F0) --------------------------------------------------------
int sub_4011F0()
{
  return CDialog::messageMap;
}

//----- (00401200) --------------------------------------------------------
int (**sub_401200())()
{
  return &off_4020E0;
}
// 4020E0: using guessed type int (*off_4020E0)();

//----- (00401210) --------------------------------------------------------
int __thiscall sub_401210(int this)
{
  CDialog::OnInitDialog((CDialog *)this);
  SendMessageA(*(HWND *)(this + 32), 0x80u, 1u, *(_DWORD *)(this + 96));
  SendMessageA(*(HWND *)(this + 32), 0x80u, 0, *(_DWORD *)(this + 96));
  return 1;
}

//----- (00401250) --------------------------------------------------------
void __thiscall sub_401250(struct CWnd *this)
{
  int v1; // esi
  int v2; // edi
  int v3; // ebp
  int v4; // edi
  int i; // ebp
  HFONT v6; // eax
  _BYTE v7[16]; // [esp+0h] [ebp-A4h] BYREF
  int v8[2]; // [esp+10h] [ebp-94h] BYREF
  float v9; // [esp+18h] [ebp-8Ch]
  int v10[2]; // [esp+1Ch] [ebp-88h] BYREF
  struct CFont *v11; // [esp+24h] [ebp-80h] BYREF
  struct CPen *h; // [esp+28h] [ebp-7Ch] BYREF
  int v13[2]; // [esp+2Ch] [ebp-78h] BYREF
  RECT rc; // [esp+34h] [ebp-70h] BYREF
  char v15[4]; // [esp+44h] [ebp-60h] BYREF
  HDC hDC; // [esp+48h] [ebp-5Ch]
  HDC hdc; // [esp+4Ch] [ebp-58h]
  int v18; // [esp+A0h] [ebp-4h]

  CPaintDC::CPaintDC((CPaintDC *)v15, this);
  v18 = 0;
  CDC::SetMapMode((CDC *)v15, 2);
  CBrush::CBrush((CBrush *)v10, 0xC0FFFFu);
  LOBYTE(v18) = 1;
  rc.left = 100;
  rc.top = -100;
  rc.right = 600;
  rc.bottom = -600;
  FillRect(hDC, &rc, (HBRUSH)(v10 != 0 ? v10[1] : 0));
  v1 = 100;
  v2 = -100;
  v3 = 11;
  do
  {
    CDC::MoveTo(v15, &rc, v1, -600);
    CDC::LineTo((CDC *)v15, v2 + 700, -100);
    CDC::MoveTo(v15, v8, 100, v2);
    CDC::LineTo((CDC *)v15, 600, v1 - 700);
    v1 += 50;
    v2 -= 50;
    --v3;
  }
  while ( v3 );
  CPen::CPen((CPen *)v13, 0, 30, 0xFFu);
  LOBYTE(v18) = 2;
  h = CDC::SelectObject((CDC *)v15, (struct CPen *)v13);
  CDC::MoveTo(v15, &rc, 100, -100);
  CDC::LineTo((CDC *)v15, 100, -600);
  CDC::LineTo((CDC *)v15, 600, -600);
  CDC::LineTo((CDC *)v15, 600, -100);
  CDC::LineTo((CDC *)v15, 100, -100);
  if ( v7 != (_BYTE *)-40 )
    SelectObject(hDC, &h);
  v4 = 700;
  v9 = 500.0;
  CDC::SetTextAlign((CDC *)v15, 0x18u);
  CDC::SetBkMode((CDC *)v15, 1);
  for ( i = 0; i < 9; ++i )
  {
    v8[1] = 0;
    v8[0] = (int)&off_402240;
    LOBYTE(v18) = 3;
    v6 = CreateFontA((__int64)-v9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0x22u, pszFaceName);
    CGdiObject::Attach((CGdiObject *)v8, v6);
    v11 = CDC::SelectObject((CDC *)v15, (struct CFont *)v8);
    TextOutA(hDC, v4, -600, &aFading[i], 1);
    GetTextExtentPointA(hdc, &aFading[i], 1, (LPSIZE)&rc);
    v4 += rc.left;
    if ( v7 != (_BYTE *)-36 )
      SelectObject(hDC, &v11);
    v8[0] = (int)&off_402228;
    v9 = v9 * 0.80000001;
    LOBYTE(v18) = 4;
    CGdiObject::DeleteObject((CGdiObject *)v8);
    v8[0] = (int)&off_402210;
  }
  v13[0] = (int)&off_402228;
  LOBYTE(v18) = 5;
  CGdiObject::DeleteObject((CGdiObject *)v13);
  v10[0] = (int)&off_402228;
  v13[0] = (int)&off_402210;
  LOBYTE(v18) = 6;
  CGdiObject::DeleteObject((CGdiObject *)v10);
  v10[0] = (int)&off_402210;
  v18 = -1;
  CPaintDC::~CPaintDC((CPaintDC *)v15);
}
// 401950: using guessed type int __thiscall CDC::MoveTo(_DWORD, _DWORD, _DWORD, _DWORD);
// 402210: using guessed type struct CRuntimeClass *(__thiscall *off_402210)(CObject *__hidden this);
// 402228: using guessed type struct CRuntimeClass *(__thiscall *off_402228)(CGdiObject *__hidden this);
// 402240: using guessed type struct CRuntimeClass *(__thiscall *off_402240)(CFont *__hidden this);

//----- (004015A0) --------------------------------------------------------
void *__thiscall sub_4015A0(void *this, char a2)
{
  sub_4015C0((CGdiObject *)this);
  if ( (a2 & 1) != 0 )
    operator delete(this);
  return this;
}

//----- (004015C0) --------------------------------------------------------
int __thiscall sub_4015C0(CGdiObject *this)
{
  int result; // eax

  *(_DWORD *)this = &off_402228;
  result = CGdiObject::DeleteObject(this);
  *(_DWORD *)this = &off_402210;
  return result;
}
// 402210: using guessed type struct CRuntimeClass *(__thiscall *off_402210)(CObject *__hidden this);
// 402228: using guessed type struct CRuntimeClass *(__thiscall *off_402228)(CGdiObject *__hidden this);

//----- (00401610) --------------------------------------------------------
int __thiscall sub_401610(CGdiObject *this)
{
  int result; // eax

  *(_DWORD *)this = &off_402228;
  result = CGdiObject::DeleteObject(this);
  *(_DWORD *)this = &off_402210;
  return result;
}
// 402210: using guessed type struct CRuntimeClass *(__thiscall *off_402210)(CObject *__hidden this);
// 402228: using guessed type struct CRuntimeClass *(__thiscall *off_402228)(CGdiObject *__hidden this);

//----- (00401660) --------------------------------------------------------
int __thiscall sub_401660(CGdiObject *this)
{
  int result; // eax

  *(_DWORD *)this = &off_402228;
  result = CGdiObject::DeleteObject(this);
  *(_DWORD *)this = &off_402210;
  return result;
}
// 402210: using guessed type struct CRuntimeClass *(__thiscall *off_402210)(CObject *__hidden this);
// 402228: using guessed type struct CRuntimeClass *(__thiscall *off_402228)(CGdiObject *__hidden this);

//----- (004016B0) --------------------------------------------------------
void *__thiscall sub_4016B0(void *this, char a2)
{
  sub_4016D0((CGdiObject *)this);
  if ( (a2 & 1) != 0 )
    operator delete(this);
  return this;
}

//----- (004016D0) --------------------------------------------------------
int __thiscall sub_4016D0(CGdiObject *this)
{
  int result; // eax

  *(_DWORD *)this = &off_402228;
  result = CGdiObject::DeleteObject(this);
  *(_DWORD *)this = &off_402210;
  return result;
}
// 402210: using guessed type struct CRuntimeClass *(__thiscall *off_402210)(CObject *__hidden this);
// 402228: using guessed type struct CRuntimeClass *(__thiscall *off_402228)(CGdiObject *__hidden this);

//----- (00401720) --------------------------------------------------------
BOOL __thiscall sub_401720(HWND *this)
{
  return EnableWindow(this[8], 0);
}

//----- (00401730) --------------------------------------------------------
BOOL __thiscall sub_401730(HWND *this)
{
  return EnableWindow(this[8], 1);
}

//----- (00401BD0) --------------------------------------------------------
int __cdecl UserMathErrorFunction()
{
  return 0;
}

//----- (00401C55) --------------------------------------------------------
_AFX_TERM_APP_STATE *sub_401C55()
{
  return _AFX_TERM_APP_STATE::_AFX_TERM_APP_STATE((_AFX_TERM_APP_STATE *)&unk_403124);
}

// nfuncs=137 queued=21 decompiled=21 lumina nreq=0 worse=0 better=0
// ALL OK, 21 function(s) have been successfully decompiled
