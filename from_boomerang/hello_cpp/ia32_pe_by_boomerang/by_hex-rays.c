/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl j___except_handler3(int, PVOID TargetFrame, int); // idb
void __cdecl __noreturn j____security_error_handler(_DWORD, _DWORD); // weak
INT_PTR __stdcall DialogFunc(HWND, UINT, WPARAM, LPARAM); // idb
int __stdcall sub_411447(HWND hWndParent, UINT Msg, WPARAM wParam, LPARAM lParam); // idb
int sub_411B80();
ATOM __cdecl sub_411D60(HINSTANCE hInstance);
int __cdecl sub_411EA0(HINSTANCE hInstance, int nCmdShow); // idb
LRESULT __stdcall sub_411F80(HWND hWndParent, UINT Msg, WPARAM wParam, LPARAM lParam);
int __stdcall sub_412170(HWND hDlg, int, int, int); // idb
int __cdecl sub_412830(int a1);
int sub_412850();
BOOL sub_413180();
HANDLE sub_413190();
struct _TEB *sub_4131A0();
void sub_4146A0();
void sub_414740();
void sub_414FE0();
// void __usercall sub_41D0F0(int a1@<ecx>, int a2@<ebx>, int a3@<ebp>, int a4@<edi>, int a5@<esi>);
int __cdecl sub_41F8F0(int a1);
// void __stdcall DebugBreak();
// void __stdcall __noreturn ExitProcess(UINT uExitCode);
// BOOL __stdcall EndDialog(HWND hDlg, INT_PTR nResult);
// INT_PTR __stdcall DialogBoxParamA(HINSTANCE hInstance, LPCSTR lpTemplateName, HWND hWndParent, DLGPROC lpDialogFunc, LPARAM dwInitParam);
// BOOL __stdcall DestroyWindow(HWND hWnd);
// LRESULT __stdcall DefWindowProcA(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// HDC __stdcall BeginPaint(HWND hWnd, LPPAINTSTRUCT lpPaint);
// BOOL __stdcall EndPaint(HWND hWnd, const PAINTSTRUCT *lpPaint);
// void __stdcall PostQuitMessage(int nExitCode);
// HWND __stdcall CreateWindowExA(DWORD dwExStyle, LPCSTR lpClassName, LPCSTR lpWindowName, DWORD dwStyle, int X, int Y, int nWidth, int nHeight, HWND hWndParent, HMENU hMenu, HINSTANCE hInstance, LPVOID lpParam);
// BOOL __stdcall ShowWindow(HWND hWnd, int nCmdShow);
// BOOL __stdcall UpdateWindow(HWND hWnd);
// HICON __stdcall LoadIconA(HINSTANCE hInstance, LPCSTR lpIconName);
// HCURSOR __stdcall LoadCursorA(HINSTANCE hInstance, LPCSTR lpCursorName);
// ATOM __stdcall RegisterClassExA(const WNDCLASSEXA *);

//-------------------------------------------------------------------------
// Data declarations

_SCOPETABLE_ENTRY stru_426A30 = { -1, &loc_41D152, &loc_41D158 }; // weak
_UNKNOWN unk_427828; // weak
void (*dword_427A2C[66])(void) =
{
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL
}; // idb
_UNKNOWN unk_427B34; // weak
void (*dword_427D38[178])(void) =
{
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL
}; // idb
int dword_428EB0 = -1153374642; // weak
CHAR ClassName[104] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // idb
CHAR WindowName[100] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // idb
HINSTANCE hInstance = NULL; // idb
int dword_42960C = 0; // weak
int dword_42992C = 0; // weak


//----- (00411B80) --------------------------------------------------------
int sub_411B80()
{
  return 5;
}

//----- (00411D60) --------------------------------------------------------
ATOM __cdecl sub_411D60(HINSTANCE hInstance)
{
  WNDCLASSEXA v2; // [esp+D0h] [ebp-34h] BYREF

  v2.cbSize = 48;
  v2.style = 3;
  v2.lpfnWndProc = sub_411447;
  v2.cbClsExtra = 0;
  v2.cbWndExtra = 0;
  v2.hInstance = hInstance;
  v2.hIcon = LoadIconA(hInstance, (LPCSTR)0x6B);
  v2.hCursor = LoadCursorA(0, (LPCSTR)0x7F00);
  v2.hbrBackground = (HBRUSH)6;
  v2.lpszMenuName = (LPCSTR)109;
  v2.lpszClassName = ClassName;
  v2.hIconSm = LoadIconA(hInstance, (LPCSTR)0x6C);
  return RegisterClassExA(&v2);
}

//----- (00411EA0) --------------------------------------------------------
int __cdecl sub_411EA0(HINSTANCE hInstance, int nCmdShow)
{
  HWND hWnd; // [esp+D0h] [ebp-8h]

  ::hInstance = hInstance;
  hWnd = CreateWindowExA(0, ClassName, WindowName, 0xCF0000u, 0x80000000, 0, 0x80000000, 0, 0, 0, hInstance, 0);
  if ( !hWnd )
    return 0;
  ShowWindow(hWnd, nCmdShow);
  UpdateWindow(hWnd);
  return 1;
}

//----- (00411F80) --------------------------------------------------------
LRESULT __stdcall sub_411F80(HWND hWndParent, UINT Msg, WPARAM wParam, LPARAM lParam)
{
  struct tagPAINTSTRUCT Paint; // [esp+E0h] [ebp-5Ch] BYREF
  int v6; // [esp+128h] [ebp-14h]
  int v7; // [esp+134h] [ebp-8h]

  switch ( Msg )
  {
    case 2u:
      PostQuitMessage(0);
      break;
    case 0xFu:
      BeginPaint(hWndParent, &Paint);
      EndPaint(hWndParent, &Paint);
      break;
    case 0x111u:
      v7 = (unsigned __int16)wParam;
      v6 = HIWORD(wParam);
      if ( (unsigned __int16)wParam == 104 )
      {
        DialogBoxParamA(hInstance, (LPCSTR)0x67, hWndParent, DialogFunc, 0);
      }
      else
      {
        if ( (unsigned __int16)wParam != 105 )
          return DefWindowProcA(hWndParent, Msg, wParam, lParam);
        DestroyWindow(hWndParent);
      }
      break;
    default:
      return DefWindowProcA(hWndParent, Msg, wParam, lParam);
  }
  return 0;
}

//----- (00412170) --------------------------------------------------------
int __stdcall sub_412170(HWND hDlg, int a2, int a3, int a4)
{
  if ( a2 == 272 )
    return 1;
  if ( a2 != 273 || (unsigned __int16)a3 != 1 && (unsigned __int16)a3 != 2 )
    return 0;
  EndDialog(hDlg, (unsigned __int16)a3);
  return 1;
}

//----- (00412830) --------------------------------------------------------
int __cdecl sub_412830(int a1)
{
  int result; // eax

  result = dword_42960C;
  dword_42960C = a1;
  return result;
}
// 42960C: using guessed type int dword_42960C;

//----- (00412850) --------------------------------------------------------
int sub_412850()
{
  return dword_42960C;
}
// 42960C: using guessed type int dword_42960C;

//----- (00413180) --------------------------------------------------------
BOOL sub_413180()
{
  return sub_413190() != 0;
}

//----- (00413190) --------------------------------------------------------
HANDLE sub_413190()
{
  return sub_4131A0()->ClientId.UniqueProcess;
}

//----- (004131A0) --------------------------------------------------------
struct _TEB *sub_4131A0()
{
  return NtCurrentTeb();
}

//----- (004146A0) --------------------------------------------------------
void sub_4146A0()
{
  void (**i)(void); // esi

  for ( i = (void (**)(void))&unk_427828; i < dword_427A2C; ++i )
  {
    if ( *i )
      (*i)();
  }
}

//----- (00414740) --------------------------------------------------------
void sub_414740()
{
  void (**i)(void); // esi

  for ( i = (void (**)(void))&unk_427B34; i < dword_427D38; ++i )
  {
    if ( *i )
      (*i)();
  }
}

//----- (00414FE0) --------------------------------------------------------
void sub_414FE0()
{
  DebugBreak();
}

//----- (0041D0F0) --------------------------------------------------------
void __usercall sub_41D0F0(int a1@<ecx>, int a2@<ebx>, int a3@<ebp>, int a4@<edi>, int a5@<esi>)
{
  _DWORD v5[8]; // [esp-28h] [ebp-28h] BYREF
  int v6; // [esp-8h] [ebp-8h]
  int v7; // [esp-4h] [ebp-4h]

  if ( a1 != dword_428EB0 )
  {
    v7 = a3;
    v6 = -1;
    v5[7] = &stru_426A30;
    v5[6] = j___except_handler3;
    v5[5] = NtCurrentTeb()->NtTib.ExceptionList;
    v5[2] = a2;
    v5[1] = a5;
    v5[0] = a4;
    v5[3] = v5;
    v6 = 0;
    j____security_error_handler(1, 0);
  }
}
// 4111F4: using guessed type void __cdecl __noreturn j____security_error_handler(_DWORD, _DWORD);
// 426A30: using guessed type _SCOPETABLE_ENTRY stru_426A30;
// 428EB0: using guessed type int dword_428EB0;

//----- (0041F8F0) --------------------------------------------------------
int __cdecl sub_41F8F0(int a1)
{
  int v2; // [esp+0h] [ebp-4h]

  v2 = dword_42992C;
  dword_42992C = a1;
  return v2;
}
// 42992C: using guessed type int dword_42992C;

// nfuncs=378 queued=15 decompiled=15 lumina nreq=0 worse=0 better=0
// ALL OK, 15 function(s) have been successfully decompiled
