/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __fastcall __noreturn start(__int64, __int64, __int64, __int64, __int64, __int64, const char *);
void *__fastcall dumpline(unsigned __int8 *, __int64, int);
__int64 __fastcall hexdump(char *); // idb
int __cdecl main(int argc, const char **argv, const char **envp);
// int __sprintf_chk(char *, int, size_t, const char *, ...);
// __int64 __fastcall __strcat_chk(_QWORD, _QWORD, _QWORD); weak
// void __cdecl __noreturn exit(int);
// int __cdecl fclose(FILE *);
// FILE *__cdecl fopen(const char *__filename, const char *__mode);
// size_t __cdecl fread(void *, size_t, size_t, FILE *);
// void __cdecl perror(const char *);
// int __cdecl puts(const char *);
// int sprintf(char *, const char *, ...);
// __int64 __fastcall stat_INODE64(_QWORD, _QWORD, _QWORD); weak

//-------------------------------------------------------------------------
// Data declarations

// extern _UNKNOWN __stack_chk_guard; weak


//----- (0000000100000AB0) ----------------------------------------------------
void __fastcall __noreturn start(
        __int64 a1,
        __int64 a2,
        __int64 a3,
        __int64 a4,
        __int64 a5,
        __int64 a6,
        const char *a7)
{
  _QWORD *i; // rcx
  int v8; // eax
  void *retaddr; // [rsp+0h] [rbp+0h]

  for ( i = (const char **)((char *)&a7 + (unsigned int)(8 * ((_DWORD)retaddr + 1))); *i; ++i )
    ;
  v8 = main((int)retaddr, &a7, (const char **)((char *)&a7 + (unsigned int)(8 * ((_DWORD)retaddr + 1))));
  exit(v8);
}

//----- (0000000100000AEC) ----------------------------------------------------
void *__fastcall dumpline(unsigned __int8 *a1, __int64 a2, int a3)
{
  int v4; // er14
  int v5; // ebx
  unsigned __int8 *v6; // rbx
  int v7; // er13
  int v8; // er12
  int v9; // ecx
  int v10; // er8
  int v11; // edi
  __int64 v12; // rsi
  int v13; // edx
  int v14; // ecx
  int v15; // ecx
  unsigned __int8 v16; // dl
  char v19[88]; // [rsp+10h] [rbp-90h] BYREF

  __sprintf_chk(v19, 0, 0x50uLL, "%08lX:", a2);
  v4 = 16;
  if ( a3 <= 16 )
    v4 = a3;
  v5 = 1;
  if ( v4 > 0 )
  {
    v6 = a1;
    v7 = 0;
    v8 = 0;
    do
    {
      sprintf(&v19[v8 + 9], " %02lX", *v6);
      ++v7;
      ++v6;
      v8 += 3;
    }
    while ( v7 != v4 );
    if ( v4 > 15 )
    {
      v9 = strlen(v19);
      *(_DWORD *)&v19[v9] = 8134688;
      v10 = v9 + 3;
      v11 = 0;
      v12 = 0LL;
      goto LABEL_12;
    }
    v5 = v4 + 1;
  }
  do
  {
    __strcat_chk(v19, "   ", 80LL);
    ++v5;
  }
  while ( v5 - 1 <= 15 );
  v9 = strlen(v19);
  *(_DWORD *)&v19[v9] = 8134688;
  v10 = v9 + 3;
  v11 = 0;
  v12 = 0LL;
  if ( v4 <= 0 )
  {
    v13 = 0;
    goto LABEL_11;
  }
LABEL_12:
  v15 = v9 + 3;
  do
  {
    v16 = a1[v12];
    if ( (unsigned __int8)(v16 - 32) >= 0x5Fu )
      v16 = 46;
    v19[v15 + (int)v12] = v16;
    ++v11;
    ++v12;
  }
  while ( v11 != v4 );
  v13 = v11;
  if ( v11 <= 15 )
  {
    v13 = v4;
LABEL_11:
    v14 = v10 + v13;
    do
    {
      v19[v14] = 32;
      ++v13;
      ++v14;
    }
    while ( v13 <= 15 );
  }
  *(_WORD *)&v19[v10 + v13] = 124;
  puts(v19);
  return &__stack_chk_guard;
}
// 100000E14: using guessed type __int64 __fastcall __strcat_chk(_QWORD, _QWORD, _QWORD);
// 100000AEC: using guessed type char var_90[88];

//----- (0000000100000CD9) ----------------------------------------------------
__int64 __fastcall hexdump(char *a1)
{
  FILE *v2; // r13
  unsigned __int64 i; // r12
  int v4; // eax
  int v5; // ebx
  char v6[96]; // [rsp+0h] [rbp-D0h] BYREF
  unsigned __int64 v7; // [rsp+60h] [rbp-70h]
  unsigned __int8 v8[24]; // [rsp+90h] [rbp-40h] BYREF

  if ( (unsigned int)stat_INODE64(a1, v6, 0LL) || (v2 = fopen(a1, "rb")) == 0LL )
  {
    perror(a1);
    return 1LL;
  }
  else
  {
    for ( i = 0LL; v7 > i; i += v5 )
    {
      v4 = fread(v8, 1uLL, 0x10uLL, v2);
      v5 = v4;
      if ( !v4 )
        break;
      dumpline(v8, i, v4);
    }
    fclose(v2);
    return 0LL;
  }
}
// 100000E44: using guessed type __int64 __fastcall stat_INODE64(_QWORD, _QWORD, _QWORD);
// 100000CD9: using guessed type char var_D0[96];

//----- (0000000100000DBC) ----------------------------------------------------
int __cdecl main(int argc, const char **argv, const char **envp)
{
  int v3; // er13
  int v5; // er12

  v3 = 0;
  if ( argc > 1 )
  {
    v5 = 1;
    v3 = 0;
    do
    {
      v3 += hexdump((char *)argv[1]);
      ++v5;
      ++argv;
    }
    while ( v5 != argc );
  }
  return v3;
}

// nfuncs=16 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
