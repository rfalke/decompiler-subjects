/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

void __cdecl __noreturn j____report_gsfailure();
char *__cdecl j_strcat(char *Destination, const char *Source);
size_t __cdecl j_strlen(const char *Str);
_DWORD __cdecl sub_4110C3(_DWORD, _DWORD, _DWORD); // weak
char *__cdecl j_strcpy(char *Destination, const char *Source);
int __cdecl sub_411163(char *ErrMsg); // idb
int __cdecl sub_411410(int a1, int a2, int a3);
int __cdecl sub_4116A0(char *ErrMsg); // idb
char *__cdecl strstr(char *_Str, const char *_SubStr); // idb
int __cdecl main_0(int argc, const char **argv, const char **envp);
void __thiscall sub_411970(void *this);
int __cdecl sub_412C60(int a1);
int sub_412C90();
int sub_412CA0();
void __cdecl _RTC_Terminate();
void __cdecl _RTC_Terminate_0();
// int __cdecl stat64i32(const char *FileName, struct _stat64i32 *Stat);
// void __cdecl perror(const char *ErrMsg);
// FILE *__cdecl fopen(const char *FileName, const char *Mode);
// size_t __cdecl fread(void *Buffer, size_t ElementSize, size_t ElementCount, FILE *Stream);
// int __cdecl fclose(FILE *Stream);
// int sprintf(char *const Buffer, const char *const Format, ...);
// int printf(const char *const Format, ...);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN unk_4164A0; // weak
void (*dword_4166A4[66])(void) =
{
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL
}; // idb
_UNKNOWN unk_4167AC; // weak
void (*dword_4169B0[66])(void) =
{
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL,
  NULL
}; // idb
int dword_417000 = -1153374642; // weak
int dword_417538; // weak
int dword_41753C; // weak


//----- (00411410) --------------------------------------------------------
int __cdecl sub_411410(int a1, int a2, int a3)
{
  int v3; // eax
  char v5; // [esp+Ch] [ebp-138h]
  size_t v6; // [esp+D4h] [ebp-70h]
  size_t v7; // [esp+D4h] [ebp-70h]
  int i; // [esp+E0h] [ebp-64h]
  int j; // [esp+E0h] [ebp-64h]
  char Buffer[84]; // [esp+ECh] [ebp-58h] BYREF

  sprintf(Buffer, "%08lX:", a2);
  if ( a3 > 16 )
    a3 = 16;
  for ( i = 0; i < a3; ++i )
    sprintf(&Buffer[3 * i + 9], " %02lX", *(unsigned __int8 *)(i + a1));
  while ( 1 )
  {
    v3 = i++;
    if ( v3 >= 16 )
      break;
    j_strcat(Buffer, "   ");
  }
  v6 = j_strlen(Buffer);
  j_strcpy(&Buffer[v6], "  |");
  v7 = v6 + 3;
  for ( j = 0; j < a3; ++j )
  {
    if ( *(unsigned __int8 *)(j + a1) < 0x20u || *(unsigned __int8 *)(j + a1) > 0x7Eu )
      v5 = 46;
    else
      v5 = *(_BYTE *)(j + a1);
    Buffer[j + v7] = v5;
  }
  while ( j < 16 )
  {
    Buffer[j + v7] = 32;
    ++j;
  }
  j_strcpy(&Buffer[v7 + j], "|");
  return printf("%s\n", Buffer);
}

//----- (004116A0) --------------------------------------------------------
int __cdecl sub_4116A0(char *ErrMsg)
{
  int result; // eax
  size_t v2; // [esp+D0h] [ebp-74h]
  char v3[20]; // [esp+DCh] [ebp-68h] BYREF
  unsigned int v4; // [esp+F0h] [ebp-54h]
  FILE *Stream; // [esp+114h] [ebp-30h]
  unsigned int i; // [esp+120h] [ebp-24h]
  char Buffer[20]; // [esp+12Ch] [ebp-18h] BYREF

  if ( strstr(ErrMsg, v3) || (Stream = fopen(ErrMsg, "rb")) == 0 )
  {
    perror(ErrMsg);
    result = 1;
  }
  else
  {
    for ( i = 0; i < v4; i += v2 )
    {
      v2 = fread(Buffer, 1u, 0x10u, Stream);
      if ( !v2 )
        break;
      sub_4110C3(Buffer, i, v2);
    }
    fclose(Stream);
    result = 0;
  }
  return result;
}
// 4110C3: using guessed type _DWORD __cdecl sub_4110C3(_DWORD, _DWORD, _DWORD);

//----- (00411860) --------------------------------------------------------
char *__cdecl strstr(char *_Str, const char *_SubStr)
{
  return (char *)stat64i32(_Str, (struct _stat64i32 *)_SubStr);
}

//----- (004118C0) --------------------------------------------------------
int __cdecl main_0(int argc, const char **argv, const char **envp)
{
  int v4; // [esp+D0h] [ebp-14h]
  int i; // [esp+DCh] [ebp-8h]

  v4 = 0;
  for ( i = 1; i < argc; ++i )
    v4 += sub_411163((char *)argv[i]);
  return v4;
}

//----- (00411970) --------------------------------------------------------
void __thiscall sub_411970(void *this)
{
  if ( this != (void *)dword_417000 )
    j____report_gsfailure();
}
// 417000: using guessed type int dword_417000;

//----- (00412C60) --------------------------------------------------------
int __cdecl sub_412C60(int a1)
{
  int result; // eax

  result = dword_41753C;
  dword_41753C = a1;
  dword_417538 = 0;
  return result;
}
// 417538: using guessed type int dword_417538;
// 41753C: using guessed type int dword_41753C;

//----- (00412C90) --------------------------------------------------------
int sub_412C90()
{
  return dword_417538;
}
// 417538: using guessed type int dword_417538;

//----- (00412CA0) --------------------------------------------------------
int sub_412CA0()
{
  return dword_41753C;
}
// 41753C: using guessed type int dword_41753C;

//----- (00412E00) --------------------------------------------------------
void __cdecl _RTC_Terminate()
{
  void (**v0)(void); // esi

  v0 = (void (**)(void))&unk_4164A0;
  if ( &unk_4164A0 < (_UNKNOWN *)dword_4166A4 )
  {
    do
    {
      if ( *v0 )
        (*v0)();
      ++v0;
    }
    while ( v0 < dword_4166A4 );
  }
}

//----- (00412E30) --------------------------------------------------------
void __cdecl _RTC_Terminate_0()
{
  void (**v0)(void); // esi

  v0 = (void (**)(void))&unk_4167AC;
  if ( &unk_4167AC < (_UNKNOWN *)dword_4169B0 )
  {
    do
    {
      if ( *v0 )
        (*v0)();
      ++v0;
    }
    while ( v0 < dword_4169B0 );
  }
}

// nfuncs=115 queued=10 decompiled=10 lumina nreq=0 worse=0 better=0
// ALL OK, 10 function(s) have been successfully decompiled
