//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
//

#include <stdint.h>
#include <stdio.h>
#include <string.h>
#include <sys/stat.h>

// ------------------------ Structures ------------------------

struct _IO_FILE {
    int32_t e0;
};

// ------------------- Function Prototypes --------------------

int32_t __i686_get_pc_thunk_bx(int32_t a1);
void dumpline(char * p, int32_t offset, int32_t cnt);
int32_t hexdump(char * fname);

// --------------------- Global Variables ---------------------

int32_t g1 = 0x6272007c; // 0x8048a36
int32_t g2;

// ------------------------ Functions -------------------------

// From module:   /home/gcaprino/t/hd.c
// Address range: 0x8048634 - 0x80487c6
// Line range:    5 - 27
void dumpline(char * p, int32_t offset, int32_t cnt) {
    char buff[80]; // bp-100, 0x8048634
    char buff2[80]; // bp-104, 0x8048634
    char v1[80]; // 0x80486db
    char v2[80]; // 0x80486ee
    char v3[80]; // 0x8048712
    char v4[80]; // 0x8048755
    char v5[80]; // 0x8048771
    char v6[80]; // 0x80486db
    char v7[80]; // 0x80486b2
    int32_t v8 = (int32_t)p;
    int32_t v9 = __readgsdword(20); // 0x8048644
    int32_t str; // bp-96, 0x8048634
    sprintf((char *)&str, "%08lX:", offset);
    int32_t v10 = cnt < 16 ? cnt : 16;
    buff = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
    int32_t v11 = *(int32_t *)&buff; // 0x80486b6
    int32_t v12 = v11; // 0x80486bc
    if (v11 < v10) {
        int32_t v13 = (int32_t)&str + 9; // 0x804869a
        unsigned char v14 = *(char *)(v11 + v8); // 0x8048686
        sprintf((char *)(v13 + 3 * v11), " %02lX", (int32_t)v14);
        v7[0] = (char)v11 + 1;
        buff = v7;
        int32_t v15 = *(int32_t *)&buff; // 0x80486b6
        v12 = v15;
        while (v15 < v10) {
            // 0x8048680
            v14 = *(char *)(v15 + v8);
            sprintf((char *)(v13 + 3 * v15), " %02lX", (int32_t)v14);
            v7[0] = (char)v15 + 1;
            buff = v7;
            v15 = *(int32_t *)&buff;
            v12 = v15;
        }
    }
    int32_t v16 = v12; // 0x80486d4
    int32_t v17 = v16 - 15; // 0x80486d4
    v6[0] = (char)v16 + 1;
    buff = v6;
    if (v17 == 0 || v17 < 0 != (14 - v16 & v16) < 0) {
        strcat((char *)&str, "   ");
        int32_t v18 = *(int32_t *)&buff; // 0x80486d4
        int32_t v19 = v18 - 15; // 0x80486d4
        v1[0] = (char)v18 + 1;
        buff = v1;
        while (v19 == 0 || v19 < 0 != (14 - v18 & v18) < 0) {
            // 0x80486c0
            strcat((char *)&str, "   ");
            v18 = *(int32_t *)&buff;
            v19 = v18 - 15;
            v1[0] = (char)v18 + 1;
            buff = v1;
        }
    }
    // 0x80486e3
    int32_t v20; // bp-4, 0x8048634
    int32_t v21 = &v20; // 0x8048635
    int32_t len = strlen((char *)&str); // 0x80486e9
    v2[0] = len;
    buff2 = v2;
    int32_t v22 = *(int32_t *)&buff2;
    int32_t v23 = &str; // 0x80486f9
    memcpy((int32_t *)(v22 + v23), (int32_t *)"  |", 4);
    v3[0] = (char)v22 + 3;
    buff2 = v3;
    buff = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
    int32_t v24 = *(int32_t *)&buff;
    int32_t v25 = v24; // 0x804875f
    if (v24 < v10) {
        unsigned char v26 = *(char *)(v24 + v8); // 0x804872d
        char v27 = v26 < 32 ? 46 : v26 < 127 ? v26 : 46;
        *(char *)(v21 - 92 + v24 + *(int32_t *)&buff2) = v27;
        v4[0] = (char)*(int32_t *)&buff + 1;
        buff = v4;
        int32_t v28 = *(int32_t *)&buff;
        v25 = v28;
        while (v28 < v10) {
            // 0x804871f
            v26 = *(char *)(v28 + v8);
            v27 = v26 < 32 ? 46 : v26 < 127 ? v26 : 46;
            *(char *)(v21 - 92 + v28 + *(int32_t *)&buff2) = v27;
            v4[0] = (char)*(int32_t *)&buff + 1;
            buff = v4;
            v28 = *(int32_t *)&buff;
            v25 = v28;
        }
    }
    int32_t v29 = *(int32_t *)&buff2;
    int32_t v30 = v25; // 0x8048779
    int32_t v31 = v29; // 0x8048779
    if (v25 < 16) {
        // 0x8048763
        *(char *)(v21 - 92 + v29 + v25) = 32;
        v5[0] = (char)*(int32_t *)&buff + 1;
        buff = v5;
        int32_t v32 = *(int32_t *)&buff;
        int32_t v33 = *(int32_t *)&buff2;
        v30 = v32;
        v31 = v33;
        while (v32 < 16) {
            // 0x8048763
            *(char *)(v21 - 92 + v33 + v32) = 32;
            v5[0] = (char)*(int32_t *)&buff + 1;
            buff = v5;
            v32 = *(int32_t *)&buff;
            v33 = *(int32_t *)&buff2;
            v30 = v32;
            v31 = v33;
        }
    }
    // 0x804877b
    memcpy((int32_t *)(v30 + v23 + v31), &g1, 2);
    puts((char *)&str);
    if (v9 != __readgsdword(20)) {
        // 0x80487b8
        __stack_chk_fail();
    }
}

// From module:   /home/gcaprino/t/hd.c
// Address range: 0x80487c6 - 0x80488ca
// Line range:    29 - 56
int32_t hexdump(char * fname) {
    char buff[16]; // bp-36, 0x80487c6
    char buff2[16]; // bp-40, 0x80487c6
    char v1[16]; // 0x8048899
    char v2[16]; // 0x804882b
    // 0x80487c6
    int32_t v3; // 0x80487c6
    uint32_t v4 = v3;
    int32_t v5 = __readgsdword(20); // 0x80487d8
    int32_t v6; // 0x80487c6
    int32_t buf; // bp-132, 0x80487c6
    if (stat((int32_t)fname, &buf) == 0) {
        struct _IO_FILE * file = fopen(fname, "rb"); // 0x8048826
        v2[0] = (int32_t)file;
        buff2 = v2;
        int32_t v7 = *(int32_t *)&buff2; // 0x804882e
        if (v7 != 0) {
            // 0x804889c
            buff = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
            uint32_t v8 = *(int32_t *)&buff; // 0x804889f
            struct _IO_FILE * stream = (struct _IO_FILE *)v7;
            if (v4 > v8) {
                uint32_t v9 = v8; // 0x804889f
                int32_t data; // bp-32, 0x80487c6
                int32_t items_read = fread(&data, 1, 16, stream); // 0x804886f
                while (items_read != 0) {
                    // 0x804887d
                    dumpline((char *)&data, v9, items_read);
                    v1[0] = items_read + v9;
                    buff = v1;
                    v9 = *(int32_t *)&buff;
                    if (v4 <= v9) {
                        // break -> 0x80488a7
                        break;
                    }
                    items_read = fread(&data, 1, 16, stream);
                }
            }
            // 0x80488a7
            fclose(stream);
            v6 = 0;
        } else {
            // 0x8048834
            perror(fname);
            v6 = 1;
        }
    } else {
        // 0x80487fc
        perror(fname);
        v6 = 1;
    }
    int32_t result = v6; // 0x80488c1
    if (v5 != __readgsdword(20)) {
        // 0x80488c3
        __stack_chk_fail();
        result = &g2;
    }
    // 0x80488c8
    return result;
}

// From module:   /home/gcaprino/t/hd.c
// Address range: 0x80488ca - 0x8048911
// Line range:    58 - 67
int main(int argc, char ** argv) {
    // 0x80488ca
    if (argc <= 1) {
        // 0x804890b
        return 0;
    }
    int32_t v1 = 1; // 0x80488fd
    int32_t result = 0; // 0x80488f9
    result += hexdump((char *)*(int32_t *)(4 * v1 + (int32_t)argv));
    v1++;
    while (v1 != argc) {
        // 0x80488e5
        result += hexdump((char *)*(int32_t *)(4 * v1 + (int32_t)argv));
        v1++;
    }
    // 0x804890b
    return result;
}

// Address range: 0x804898a - 0x804898e
int32_t __i686_get_pc_thunk_bx(int32_t a1) {
    // 0x804898a
    int32_t result; // 0x804898a
    return result;
}

// --------------- Statically Linked Functions ----------------

// int32_t stat(int32_t a1, int32_t * a2);

// --------------- Dynamically Linked Functions ---------------

// void __stack_chk_fail(void);
// int __xstat(int ver, const char * filename, struct stat * stat_buf);
// int fclose(FILE * stream);
// FILE * fopen(const char * restrict filename, const char * restrict modes);
// size_t fread(void * restrict ptr, size_t size, size_t n, FILE * restrict stream);
// void * memcpy(void * restrict dest, const void * restrict src, size_t n);
// void perror(const char * s);
// int puts(const char * s);
// int sprintf(char * restrict s, const char * restrict format, ...);
// char * strcat(char * restrict dest, const char * restrict src);
// size_t strlen(const char * s);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: gcc (4.5.x)
// Detected functions: 4

