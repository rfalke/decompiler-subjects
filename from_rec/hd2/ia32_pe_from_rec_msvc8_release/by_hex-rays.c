/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

int __cdecl sub_401000(int, int);
int __thiscall sub_401140(char *FileName); // idb
int __cdecl main(int argc, const char **argv, const char **envp);
// LONG __stdcall __CxxUnhandledExceptionFilter(struct _EXCEPTION_POINTERS *ExceptionInfo); idb
int sub_40163E();
void *sub_40170E();
void __cdecl sub_401734(); // idb
int __cdecl UserMathErrorFunction();
// void *__cdecl memset(void *, int Val, size_t Size);

//-------------------------------------------------------------------------
// Data declarations

// extern LPTOP_LEVEL_EXCEPTION_FILTER (__stdcall *SetUnhandledExceptionFilter)(LPTOP_LEVEL_EXCEPTION_FILTER lpTopLevelExceptionFilter);
// extern int (__cdecl *stat64i32)(const char *FileName, struct _stat64i32 *Stat);
// extern int (__cdecl *fclose)(FILE *Stream);
// extern size_t (__cdecl *fread)(void *Buffer, size_t ElementSize, size_t ElementCount, FILE *Stream);
// extern FILE *(__cdecl *fopen)(const char *FileName, const char *Mode);
// extern int (*printf)(const char *const Format, ...);
// extern void (__cdecl *perror)(const char *ErrMsg);
// extern int (*sprintf)(char *const Buffer, const char *const Format, ...);
_UNKNOWN unk_4021C8; // weak


//----- (00401000) --------------------------------------------------------
int __cdecl sub_401000(int a1, int a2)
{
  int v2; // ecx
  int v3; // ebp
  int v4; // esi
  char *v5; // edi
  int v6; // ecx
  _DWORD *v7; // edi
  char v8; // al
  unsigned int v9; // kr00_4
  unsigned int v10; // ebx
  int v11; // esi
  char v12; // al
  int v14; // [esp+10h] [ebp-58h] BYREF
  char Buffer[4]; // [esp+14h] [ebp-54h] BYREF
  char v16; // [esp+1Dh] [ebp-4Bh] BYREF

  v3 = a2;
  v14 = a1;
  sprintf(Buffer, "%08lX:", v2);
  if ( a2 > 16 )
    v3 = 16;
  v4 = 0;
  if ( v3 <= 0 )
    goto LABEL_7;
  v5 = &v16;
  do
  {
    sprintf(v5, " %02lX", *(unsigned __int8 *)(v14 + v4++));
    v5 += 3;
  }
  while ( v4 < v3 );
  if ( v4 < 16 )
  {
LABEL_7:
    v6 = 16 - v4;
    do
    {
      v7 = (int *)((char *)&v14 + 3);
      do
      {
        v8 = *((_BYTE *)v7 + 1);
        v7 = (_DWORD *)((char *)v7 + 1);
      }
      while ( v8 );
      --v6;
      *v7 = 2105376;
    }
    while ( v6 );
  }
  v9 = strlen(Buffer);
  *(_DWORD *)&Buffer[v9] = 8134688;
  v10 = v9 + 3;
  v11 = 0;
  if ( v3 <= 0 )
    goto LABEL_17;
  do
  {
    v12 = *(_BYTE *)(v14 + v11);
    if ( (unsigned __int8)v12 < 0x20u || (unsigned __int8)v12 > 0x7Eu )
      v12 = 46;
    Buffer[v10 + v11++] = v12;
  }
  while ( v11 < v3 );
  if ( v11 < 16 )
  {
LABEL_17:
    memset(&Buffer[v10 + v11], 32, 16 - v11);
    v11 = 16;
  }
  *(_WORD *)&Buffer[v11 + v10] = 124;
  return printf("%s\n", Buffer);
}
// 40102F: variable 'v2' is possibly undefined

//----- (00401140) --------------------------------------------------------
int __thiscall sub_401140(char *FileName)
{
  FILE *v3; // edi
  unsigned int i; // ebp
  int v5; // eax
  int v6; // esi
  struct _stat64i32 v7; // [esp+10h] [ebp-4Ch] BYREF
  char Buffer[16]; // [esp+44h] [ebp-18h] BYREF

  if ( stat64i32(FileName, &v7) || (v3 = fopen(FileName, "rb")) == 0 )
  {
    perror(FileName);
    return 1;
  }
  else
  {
    for ( i = 0; i < v7.st_size; i += v6 )
    {
      v5 = fread(Buffer, 1u, 0x10u, v3);
      v6 = v5;
      if ( !v5 )
        break;
      sub_401000((int)Buffer, v5);
    }
    fclose(v3);
    return 0;
  }
}

//----- (00401200) --------------------------------------------------------
int __cdecl main(int argc, const char **argv, const char **envp)
{
  int v3; // edi
  int i; // esi
  int v5; // eax

  v3 = 0;
  for ( i = 1; i < argc; v3 += v5 )
    v5 = sub_401140((char *)argv[i++]);
  return v3;
}

//----- (0040163E) --------------------------------------------------------
int sub_40163E()
{
  SetUnhandledExceptionFilter(__CxxUnhandledExceptionFilter);
  return 0;
}

//----- (0040170E) --------------------------------------------------------
void *sub_40170E()
{
  return &unk_4021C8;
}

//----- (00401734) --------------------------------------------------------
void __cdecl sub_401734()
{
  ;
}

//----- (00401965) --------------------------------------------------------
int __cdecl UserMathErrorFunction()
{
  return 0;
}

// nfuncs=37 queued=7 decompiled=7 lumina nreq=0 worse=0 better=0
// ALL OK, 7 function(s) have been successfully decompiled
