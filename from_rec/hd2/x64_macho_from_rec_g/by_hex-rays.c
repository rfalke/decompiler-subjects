/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __fastcall __noreturn start(__int64, __int64, __int64, __int64, __int64, __int64, const char *);
void *__fastcall dumpline(__int64, __int64, int);
__int64 __fastcall __inline_strcpy_chk(__int64, __int64);
__int64 __fastcall hexdump(const char *);
int __cdecl main(int argc, const char **argv, const char **envp);
// int __sprintf_chk(char *, int, size_t, const char *, ...);
// __int64 __fastcall __strcat_chk(_QWORD, _QWORD, _QWORD); weak
// __int64 __fastcall __strcpy_chk(_QWORD, _QWORD, _QWORD); weak
// void __cdecl __noreturn exit(int);
// int __cdecl fclose(FILE *);
// FILE *__cdecl fopen(const char *__filename, const char *__mode);
// size_t __cdecl fread(void *, size_t, size_t, FILE *);
// void __cdecl perror(const char *);
// int __cdecl puts(const char *);
// __int64 __fastcall stat_INODE64(_QWORD, _QWORD, _QWORD); weak
// size_t __cdecl strlen(const char *__s);

//-------------------------------------------------------------------------
// Data declarations

// extern _UNKNOWN __stack_chk_guard; weak


//----- (00000001000009F0) ----------------------------------------------------
void __fastcall __noreturn start(
        __int64 a1,
        __int64 a2,
        __int64 a3,
        __int64 a4,
        __int64 a5,
        __int64 a6,
        const char *a7)
{
  _QWORD *i; // rcx
  int v8; // eax
  void *retaddr; // [rsp+0h] [rbp+0h]

  for ( i = (const char **)((char *)&a7 + (unsigned int)(8 * ((_DWORD)retaddr + 1))); *i; ++i )
    ;
  v8 = main((int)retaddr, &a7, (const char **)((char *)&a7 + (unsigned int)(8 * ((_DWORD)retaddr + 1))));
  exit(v8);
}

//----- (0000000100000A2C) ----------------------------------------------------
void *__fastcall dumpline(__int64 a1, __int64 a2, int a3)
{
  char v5; // [rsp+Bh] [rbp-85h]
  int v7; // [rsp+28h] [rbp-68h]
  int v8; // [rsp+28h] [rbp-68h]
  int i; // [rsp+2Ch] [rbp-64h]
  int j; // [rsp+2Ch] [rbp-64h]
  char __s[88]; // [rsp+30h] [rbp-60h] BYREF

  __sprintf_chk(__s, 0, 0x50uLL, "%08lX:", a2);
  if ( a3 > 16 )
    a3 = 16;
  for ( i = 0; i < a3; ++i )
    __sprintf_chk(&__s[3 * i + 9], 0, 0xFFFFFFFFFFFFFFFFLL, " %02lX", *(unsigned __int8 *)(a1 + i));
  while ( i++ <= 15 )
    __strcat_chk(__s, "   ", 80LL);
  v7 = strlen(__s);
  __inline_strcpy_chk((__int64)&__s[v7], (__int64)"  |");
  v8 = v7 + 3;
  for ( j = 0; j < a3; ++j )
  {
    if ( *(_BYTE *)(a1 + j) <= 0x1Fu || *(_BYTE *)(a1 + j) > 0x7Eu )
      v5 = 46;
    else
      v5 = *(_BYTE *)(a1 + j);
    __s[j + v8] = v5;
  }
  while ( j <= 15 )
  {
    __s[j + v8] = 32;
    ++j;
  }
  __inline_strcpy_chk((__int64)&__s[v8 + j], (__int64)"|");
  puts(__s);
  return &__stack_chk_guard;
}
// 100000DF0: using guessed type __int64 __fastcall __strcat_chk(_QWORD, _QWORD, _QWORD);
// 100000DF6: using guessed type __int64 __fastcall __strcpy_chk(_QWORD, _QWORD, _QWORD);
// 100000A2C: using guessed type char __s[88];

//----- (0000000100000C70) ----------------------------------------------------
__int64 __fastcall __inline_strcpy_chk(__int64 a1, __int64 a2)
{
  return __strcpy_chk(a1, a2, -1LL);
}
// 100000DF6: using guessed type __int64 __fastcall __strcpy_chk(_QWORD, _QWORD, _QWORD);

//----- (0000000100000C96) ----------------------------------------------------
__int64 __fastcall hexdump(const char *a1)
{
  char v3[96]; // [rsp+10h] [rbp-D0h] BYREF
  unsigned __int64 v4; // [rsp+70h] [rbp-70h]
  FILE *v5; // [rsp+A8h] [rbp-38h]
  unsigned __int64 i; // [rsp+B0h] [rbp-30h]
  int v7; // [rsp+BCh] [rbp-24h]
  char v8[24]; // [rsp+C0h] [rbp-20h] BYREF

  if ( (unsigned int)stat_INODE64(a1, v3, 0LL) || (v5 = fopen(a1, "rb")) == 0LL )
  {
    perror(a1);
    return 1;
  }
  else
  {
    for ( i = 0LL; v4 > i; i += v7 )
    {
      v7 = fread(v8, 1uLL, 0x10uLL, v5);
      if ( !v7 )
        break;
      dumpline((__int64)v8, i, v7);
    }
    fclose(v5);
    return 0;
  }
}
// 100000E20: using guessed type __int64 __fastcall stat_INODE64(_QWORD, _QWORD, _QWORD);
// 100000C96: using guessed type char var_D0[96];

//----- (0000000100000D9D) ----------------------------------------------------
int __cdecl main(int argc, const char **argv, const char **envp)
{
  int v4; // [rsp+18h] [rbp-8h]
  int i; // [rsp+1Ch] [rbp-4h]

  v4 = 0;
  for ( i = 1; i < argc; ++i )
    v4 += hexdump(argv[i]);
  return v4;
}

// nfuncs=18 queued=5 decompiled=5 lumina nreq=0 worse=0 better=0
// ALL OK, 5 function(s) have been successfully decompiled
