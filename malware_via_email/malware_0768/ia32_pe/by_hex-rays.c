/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall sub_401006@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, __int32 a4@<edi>);
// void __usercall sub_401068(__int32 a1@<edx>, int _ESI@<esi>);
// void __usercall sub_401129(char a1@<ah>, int a2@<ecx>);
// void __usercall sub_401162(char a1@<ah>, int a2@<ecx>);
void __fastcall sub_4011BB(int a1, int a2);
// void __usercall sub_4011F7(int a1@<eax>, char a2@<dh>, int a3@<ebx>, int a4@<esi>);
// int __usercall sub_401253@<eax>(int a1@<esi>);
// int __usercall sub_40128F@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<esi>);
// int __usercall sub_4012B3@<eax>(int a1@<eax>);
// int __usercall sub_4012F5@<eax>(int a1@<eax>, int a2@<ecx>, int a3@<ebx>, int a4@<esi>);
void sub_401376();
// void __usercall sub_4013D5(char a1@<al>, char a2@<dl>, __int16 a3@<cx>, __int16 a4@<di>);
void sub_401412();
// void __usercall sub_40144E(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>);
// void __usercall sub_401481(__int32 a1@<ebx>);
void __fastcall sub_40149C(__int16 a1);
// int __usercall sub_4014ED@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>);
// void __usercall sub_40154A(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>);
_DWORD sub_40159A(); // weak
// void __usercall sub_40160C(char a1@<ah>, int a2@<edx>, int a3@<ecx>);
// int __usercall sub_4016A5@<eax>(int result@<eax>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401025; // weak
_UNKNOWN loc_401081; // weak
_UNKNOWN loc_4010BE; // weak
_UNKNOWN loc_40117B; // weak
_UNKNOWN loc_401219; // weak
_UNKNOWN loc_4013BA; // weak
_UNKNOWN loc_4013F6; // weak
_UNKNOWN loc_40142F; // weak
_UNKNOWN loc_4014B4; // weak
_UNKNOWN loc_40152C; // weak
_UNKNOWN loc_401582; // weak
_UNKNOWN loc_401666; // weak


//----- (00401006) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_401006@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, __int32 a4@<edi>)
{
  __int32 v6; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v6, a4);
  __asm { smsw    eax }
  sub_40144E(_EAX, a1, a2, a3, v6, a3 - 1);
  return MEMORY[0x25FF2574]();
}
// 401012: positive sp value 4 has been found

//----- (00401068) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401068(__int32 a1@<edx>, int _ESI@<esi>)
{
  __int32 v3; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v3, a1);
  __asm { rep mov esi, esi }
  ((void (*)(void))loc_401219)();
  MEMORY[0x64CD8585]();
  JUMPOUT(0x401086);
}
// 40106F: positive sp value 4 has been found
// 401081: control flows out of bounds to 401086

//----- (00401129) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401129(char a1@<ah>, int a2@<ecx>)
{
  int v2; // ecx
  char v3; // zf

  v2 = a2 + 1;
  LOBYTE(v2) = a1 | v2;
  BYTE1(v2) -= a1;
  ((void (__thiscall *)(int))loc_4014B4)(v2);
  if ( !v3 )
    JUMPOUT(0x401145);
  JUMPOUT(0x4011B5);
}
// 4010D4: positive sp value 4 has been found
// 401143: control flows out of bounds to 401145
// 4010D6: control flows out of bounds to 4010D8
// 40113F: control flows out of bounds to 4011B5
// 401141: control flows out of bounds to 401142
// 40113F: variable 'v3' is possibly undefined

//----- (00401162) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401162(char a1@<ah>, int a2@<ecx>)
{
  sub_401129(a1, a2);
  JUMPOUT(0x401180);
}
// 40116C: positive sp value 4 has been found
// 40117B: control flows out of bounds to 401180

//----- (004011BB) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_4011BB(int a1, int a2)
{
  ((void (__fastcall *)(int, int))loc_401025)(-1176898682, (a1 | a2) + 1176898683);
  MEMORY[0x8D644E69]();
  JUMPOUT(0x4011E2);
}
// 4011BF: positive sp value 4 has been found
// 4011DD: control flows out of bounds to 4011E2

//----- (004011F7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4011F7(int a1@<eax>, char a2@<dh>, int a3@<ebx>, int a4@<esi>)
{
  int v4; // ecx
  char v5; // zf

  v4 = a1 | a3;
  LOBYTE(v4) = a2 + (a1 | a3);
  sub_401162(SBYTE1(a1), v4 - a4);
  if ( !v5 )
    JUMPOUT(0x401219);
  JUMPOUT(0x4011FC);
}
// 4011FB: positive sp value 4 has been found
// 401214: control flows out of bounds to 401219
// 401212: control flows out of bounds to 4011FC
// 401212: variable 'v5' is possibly undefined

//----- (00401253) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_401253@<eax>(int a1@<esi>)
{
  void *v2; // [esp+14h] [ebp-4h]
  void *retaddr; // [esp+18h] [ebp+0h]

  *(&retaddr - 7) = v2;
  ((void (__thiscall *)(int))((char *)&loc_40152C + 2))(a1);
  return MEMORY[0x8D2574E8]();
}
// 401257: positive sp value 4 has been found

//----- (0040128F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_40128F@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<esi>)
{
  int v5; // eax

  sub_40154A(
    a1 & 0xEEEEEEEE,
    a1 & 0xEEEEEEEE ^ a1 ^ a3 ^ a2,
    (a1 & 0xEEEEEEEE ^ a1 ^ a3 ^ a2) + (a1 ^ a3) - a4,
    a4,
    (a1 ^ a3 ^ a2) + (a1 ^ a3) - 1,
    a4 + a5);
  return sub_4012B3(v5 & 0x74FFFFE8);
}
// 401293: positive sp value 4 has been found
// 4012AE: variable 'v5' is possibly undefined

//----- (004012B3) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4012B3@<eax>(int a1@<eax>)
{
  int v1; // edx
  int v2; // ecx
  char v3; // zf

  ((void (__cdecl *)(_DWORD))loc_40142F)(*(_DWORD *)(a1 + 144));
  if ( v3 )
  {
    sub_401376();
    if ( !v3 )
    {
      MEMORY[0x8A28877F]();
      JUMPOUT(0x4014CF);
    }
    JUMPOUT(0x401354);
  }
  ((void (__fastcall *)(int, int))((char *)&loc_401081 + 3))(v2, v2 + v1);
  return MEMORY[0xE874E825]();
}
// 401360: positive sp value 8 has been found
// 40136C: control flows out of bounds to 4014CF
// 4012D4: control flows out of bounds to 4012FB
// 401353: control flows out of bounds to 401354
// 4012D2: variable 'v3' is possibly undefined
// 4012E8: variable 'v2' is possibly undefined
// 4012E2: variable 'v1' is possibly undefined

//----- (004012F5) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4012F5@<eax>(int a1@<eax>, int a2@<ecx>, int a3@<ebx>, int a4@<esi>)
{
  sub_40128F(a1, a4, a1 | a1 | a2, a3, a4);
  MEMORY[0xFFB48780]();
  return MEMORY[0x24648D74]();
}
// 4012F9: positive sp value 4 has been found

//----- (00401376) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401376()
{
  void *v0; // [esp+28h] [ebp-4h]
  void *retaddr; // [esp+2Ch] [ebp+0h]

  *(&retaddr - 12) = v0;
  JUMPOUT(0x4016C2);
}
// 40137A: positive sp value 4 has been found
// 401386: control flows out of bounds to 4016C2

//----- (004013D5) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4013D5(char a1@<al>, char a2@<dl>, __int16 a3@<cx>, __int16 a4@<di>)
{
  void *v4; // [esp+18h] [ebp-4h]
  void *retaddr; // [esp+1Ch] [ebp+0h]

  *(&retaddr - 8) = v4;
  LOBYTE(a3) = -HIBYTE(a4) | a3;
  HIBYTE(a3) = (a1 | HIBYTE(a3)) - a2;
  sub_40149C(a3);
  JUMPOUT(0x4013F6);
}
// 4013D9: positive sp value 4 has been found
// 4013F1: control flows out of bounds to 4013F6

//----- (00401412) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401412()
{
  ((void (*)(void))loc_401666)();
  JUMPOUT(0x40142F);
}
// 401416: positive sp value 4 has been found
// 40142A: control flows out of bounds to 40142F

//----- (0040144E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40144E(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  void *retaddr; // [esp+14h] [ebp+0h] BYREF

  sub_4014ED(a1, a2 - 1, (a6 | a3) - a5 - (a2 - 1), a4, (a2 - 1) ^ a5, a6);
  MEMORY[0x245C9B8E](*(void **)((char *)&retaddr + 2 * a6 - 24));
  JUMPOUT(0x401469);
}
// 401452: positive sp value 4 has been found
// 401464: control flows out of bounds to 401469

//----- (00401481) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401481(__int32 a1@<ebx>)
{
  __int16 v1; // cx
  __int32 v2; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v2, a1);
  ((void (*)(void))loc_4013BA)();
  sub_40149C(v1);
}
// 401489: positive sp value 4 has been found
// 401498: variable 'v1' is possibly undefined

//----- (0040149C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_40149C(__int16 a1)
{
  void *v1; // [esp+28h] [ebp-4h]
  void *retaddr; // [esp+2Ch] [ebp+0h]

  *(&retaddr - 12) = v1;
  HIBYTE(a1) = 123;
  ((void (__thiscall *)(__int16))loc_4010BE)(a1);
  JUMPOUT(0x4014B4);
}
// 4014A0: positive sp value 4 has been found
// 4014AF: control flows out of bounds to 4014B4

//----- (004014ED) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4014ED@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  int v6; // edi
  int v7; // edx
  int v8; // ecx
  char v9; // zf
  void *v11; // [esp+8h] [ebp-4h]
  void *retaddr; // [esp+Ch] [ebp+0h]

  v6 = a5 - a3 - ((a6 - a4 - a4 + a2) ^ (a6 - a4 - a4));
  sub_4016A5(a1);
  MEMORY[0xE928FD2D]();
  if ( v9 )
    JUMPOUT(0x40152F);
  *(&retaddr - 5) = v11;
  ((void (__fastcall *)(int, int))((char *)&loc_40117B + 1))(v8, ((v8 - v6) ^ ((v8 - v6) | v7)) - 1);
  MEMORY[0xFFB489A0]();
  return MEMORY[0x87240C89]();
}
// 40150E: positive sp value 8 has been found
// 401508: control flows out of bounds to 40152F
// 401508: variable 'v9' is possibly undefined
// 401522: variable 'v8' is possibly undefined
// 401516: variable 'v7' is possibly undefined

//----- (0040154A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40154A(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  int v6; // ebx
  char v7; // zf

  do
  {
    a5 = a5 - a1 - 1;
    v6 = a1 ^ a4;
    a6 += v6 | a2;
    a4 = a6 + v6;
    a1 = ((int (__thiscall *)(int))((char *)&loc_401582 + 1))(a3 - 1);
  }
  while ( v7 );
  MEMORY[0x24A4A2DF]();
  JUMPOUT(0x40156B);
}
// 40154E: positive sp value 4 has been found
// 401566: control flows out of bounds to 40156B
// 401554: variable 'a2' is possibly undefined
// 40154E: variable 'a3' is possibly undefined
// 401564: variable 'v7' is possibly undefined

//----- (0040159A) --------------------------------------------------------
#error "4015E1: cannot convert to microcode (funcsize=28)"

//----- (0040160C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40160C(char a1@<ah>, int a2@<edx>, int a3@<ecx>)
{
  void *v3; // [esp+Ch] [ebp-4h]
  void *retaddr; // [esp+10h] [ebp+0h]

  *(&retaddr - 5) = v3;
  BYTE1(a2) ^= a1;
  BYTE1(a3) += a3;
  ((void (__fastcall *)(int, int))loc_4013F6)(a3, a2);
  MEMORY[0x3CCA15A4]();
  JUMPOUT(0x401630);
}
// 401610: positive sp value 4 has been found
// 40162B: control flows out of bounds to 401630

//----- (004016A5) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4016A5@<eax>(int result@<eax>)
{
  if ( (result & 8) == 0 )
  {
    sub_401412();
    result = MEMORY[0xE8FF7474]();
  }
  return result;
}
// 4016AF: positive sp value 8 has been found
// 4016A5: could not find valid save-restore pair for ebp

// nfuncs=21 queued=21 decompiled=21 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 21 function(s)"
