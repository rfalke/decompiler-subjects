/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int, int, int);
// int __usercall sub_401108@<eax>(int result@<eax>);
// void __usercall sub_4040EE(int@<edx>, signed int@<ecx>, int@<ebx>, int@<edi>, double@<st2>, double@<st1>, double@<st0>);
// void __usercall sub_4041DD(int@<eax>, int@<ecx>, int@<esi>, double@<st1>, double@<st0>);

//-------------------------------------------------------------------------
// Data declarations

// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);
_UNKNOWN loc_40427D; // weak


//----- (004010B3) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  sub_401108(0x10000);
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 3;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (00401108) --------------------------------------------------------
int __usercall sub_401108@<eax>(int result@<eax>)
{
  int v1; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v1);
  MEMORY[0] &= result;
  return result;
}

//----- (004040EE) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4040EE(
        int a1@<edx>,
        signed int a2@<ecx>,
        int a3@<ebx>,
        int a4@<edi>,
        double a5@<st2>,
        double a6@<st1>,
        double a7@<st0>)
{
  signed int v7; // edx
  int v9; // edi
  bool v10; // cf
  bool v11; // zf
  char v12; // sf
  char v13; // of
  unsigned int v14; // eax
  int v15; // edi
  int v16; // edx
  int v17; // eax
  int v18; // edx
  int v19; // edi
  signed int v20; // ecx
  int v22; // ecx
  int v23; // eax
  int v25; // eax
  int v26; // ecx
  int v27; // ecx
  int v28; // et0
  int v29; // eax
  unsigned int v31; // esi
  int savedregs; // [esp+0h] [ebp+0h]
  int savedregsa; // [esp+0h] [ebp+0h]

  v7 = __ROL4__(a1, 2);
  _ESI = 1023956565;
  v9 = a4 + 1;
  __asm
  {
    rcr     esi, 0ACh
    fcom    st(5)
  }
  LOWORD(v9) = 29601;
  __asm { fsub    st(3), st }
  LOWORD(a2) = -32068;
  v11 = !_BitScanReverse(&v14, a2);
  v15 = ~v9;
  __asm { fcom    st(5) }
  LOWORD(a3) = 21528;
  if ( v12 )
    a2 = v7;
  v16 = -1350652385;
  if ( v12 ^ v13 | v11 )
  {
    _BitScanForward((unsigned int *)&v16, a3);
    v10 = a3 != 0;
    a3 = ~(a3 ^ (1 << v16));
    v15 = a2;
  }
  __asm { fsub    st(1), st }
  savedregs = v15;
  v17 = v16;
  v18 = v15;
  LOWORD(a2) = v15 + v10 + 23445;
  v19 = 1 - v15;
  v20 = a2 >> 13;
  _ESI = 575553898;
  if ( (BYTE1(v17) & (unsigned __int8)a3) != 0 )
  {
    LOWORD(_ESI) = v17 ^ 0x416A;
    __asm { fcom    st(6) }
    v19 = v17;
    ++v20;
  }
  v22 = -v20;
  if ( !__OFSUB__((_BYTE)v17, BYTE1(a3)) )
  {
    v22 = -v22;
    if ( v22 < 0 )
      v22 = a3;
    v23 = v18 ^ v17;
    _ESI = v23;
    __asm { rcr     esi, 17h }
    v17 = v22 * v23;
    v19 = -489949656;
  }
  sub_4041DD(v17, v22, _ESI, a6, a7);
  v27 = v26 - 1;
  if ( !v11 && v27 )
    JUMPOUT(0x404144);
  *(_DWORD *)v19 += v27;
  v28 = v25;
  v29 = v27 * (v25 + v19);
  savedregsa = v28;
  __asm
  {
    rep pop ebx
    fmul    st(2), st
  }
  _BitScanReverse(&v31, v29);
  sub_4041DD(v29, v28, v31 + 1, a6, a7);
}
// 40411A: positive sp value 4 has been found
// 4040FE: inconsistent fpu stack
// 4041B5: control flows out of bounds to 404144
// 404115: variable 'v12' is possibly undefined
// 404122: variable 'v13' is possibly undefined
// 40414A: variable 'v10' is possibly undefined
// 4041B5: variable 'v26' is possibly undefined
// 4041B5: variable 'v11' is possibly undefined
// 4041BE: variable 'v25' is possibly undefined

//----- (004041DD) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4041DD(int a1@<eax>, int a2@<ecx>, int a3@<esi>, double a4@<st1>, double a5@<st0>)
{
  int v6; // et1
  int v7; // edx
  _WORD v15[16]; // [esp-20h] [ebp-20h] BYREF
  int savedregs; // [esp+0h] [ebp+0h] BYREF
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  v6 = a3 + 1;
  HIWORD(_ESI) = HIWORD(a1);
  LOWORD(_ESI) = v15[14] ^ 0x3786;
  v7 = savedregs;
  savedregs = _ESI;
  __asm { rcr     esi, 0FAh }
  ((void (__usercall *)(int, int, int, int, int, void **, int *, double@<st0>))loc_40427D)(
    v7,
    v6,
    v7,
    a2,
    1234141371,
    &retaddr,
    &savedregs,
    a4 - a5);
  if ( __OFSUB__(v15, 1234108416) )
  {
    _EBX = 1519050752;
    __asm { repne inc ebx }
  }
  JUMPOUT(0x40427D);
}
// 4041F9: positive sp value 8 has been found
// 40427B: control flows out of bounds to 40427D

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
