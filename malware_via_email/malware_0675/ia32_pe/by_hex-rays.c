/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <math.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start(); // weak
void sub_401105();
void sub_40113B();
// void __usercall sub_401295(int _EAX@<eax>, int a2@<edx>, unsigned int a3@<ecx>, int _EBX@<ebx>, int a5@<edi>, int a6@<esi>);
void sub_4012E4();
// void __usercall __noreturn sub_401327(__int32 a1@<esi>);
void __noreturn sub_401362(); // weak
void __fastcall __noreturn sub_40142D(int a1, int a2);
// void __usercall sub_402218(char a1@<cf>, int a2@<eax>, __int16 a3@<dx>, __int16 a4@<cx>, __int16 a5@<bx>, int a6@<edi>);
// void __userpurge sub_402239(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int _EBP@<ebp>, int a5@<edi>, int a6@<esi>, double a7@<st0>, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
double sub_40225A(); // weak
// void __usercall sub_402353(int a1@<edx>, int a2@<ecx>, int a3@<edi>, __int32 a4@<esi>);
void sub_4023B6();
void __fastcall __noreturn sub_4023EE(int a1);
// void __usercall __noreturn sub_40253B(int a1@<ecx>, int a2@<edi>);
void sub_4025E6();
void sub_402644();
void sub_402672();
void sub_40271F();
_DWORD sub_402774(); // weak
_DWORD sub_402A23(); // weak
void sub_402B45();
// void __usercall sub_402B7A(_BYTE *a1@<ebx>);
double sub_402BAD(); // weak
void sub_402C52();
void __noreturn sub_402C99(); // weak
void sub_402D66();
void __noreturn sub_402EE4(); // weak
void sub_402F05();
// void __usercall sub_402F4D(char a1@<ah>, _BYTE *a2@<edx>, __int32 a3@<ecx>, __int16 a4@<bx>, int a5@<ebp>, int a6@<edi>, int a7@<esi>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401122; // weak
_UNKNOWN loc_4013B3; // weak
_UNKNOWN loc_402493; // weak
_UNKNOWN sub_402609; // weak
_UNKNOWN sub_402A8E; // weak
_UNKNOWN loc_402EC0; // weak


//----- (00401070) --------------------------------------------------------
void __noreturn start()
{
  JUMPOUT(0x401057);
}
// 401017: control flows out of bounds to 401057
// 401070: using guessed type void __noreturn start();

//----- (00401105) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401105()
{
  int v0; // ecx
  void *v1; // [esp+14h] [ebp-4h]
  void *retaddr; // [esp+18h] [ebp+0h]

  *(&retaddr - 7) = v1;
  sub_4012E4();
  --*(_DWORD *)(v0 + 1532175364);
  JUMPOUT(0x401128);
}
// 401109: positive sp value 4 has been found
// 401122: control flows out of bounds to 401128
// 401122: variable 'v0' is possibly undefined

//----- (0040113B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40113B()
{
  JUMPOUT(0x40137D);
}
// 40131A: positive sp value 8 has been found
// 401179: control flows out of bounds to 40117D
// 401322: control flows out of bounds to 401323
// 401149: control flows out of bounds to 40137D
// 401153: conditional instruction was optimized away because of 'edi.4>=0'

//----- (00401295) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401295(int _EAX@<eax>, int a2@<edx>, unsigned int a3@<ecx>, int _EBX@<ebx>, int a5@<edi>, int a6@<esi>)
{
  int v6; // ecx
  int v7; // ebx
  int v8; // edi
  int v9; // ecx
  int v10; // ebx
  bool v11; // pf
  char v12; // cc
  int v13; // ecx
  int v14; // edx
  int v15; // ebx
  int v19; // [esp-20h] [ebp-20h]
  int v20; // [esp-1Ch] [ebp-1Ch]
  unsigned int v21; // [esp-18h] [ebp-18h]
  int v22; // [esp-14h] [ebp-14h]
  int v23; // [esp-8h] [ebp-8h]
  int v24; // [esp-4h] [ebp-4h]

  while ( 1 )
  {
    v14 = _EAX ^ a2;
    v15 = a6 + _EBX - 1;
    v6 = v15 + (v14 ^ (a3 - 2)) - 1;
    v7 = _EAX ^ v15;
    v8 = v6 + (((v6 ^ v14) + a6 + 1 + (v7 | a5)) ^ v6 ^ v14);
    v9 = v7 + v6;
    v19 = *(_DWORD *)(v19 + 48);
    v10 = v9 + v7;
    v11 = __SETP__(v8 + v9, 0);
    v12 = (v8 + v9 < 0) ^ __OFADD__(v8, v9) | (v8 + v9 == 0);
    v13 = v8 + v9;
    if ( v12 || !v12 )
      break;
    if ( !v11 )
      JUMPOUT(0x40123D);
    _EAX = v19;
    a2 = v20;
    _EBX = v22;
    a5 = v23;
    a6 = v24;
    a3 = v21 >> 6;
    __asm { xlat }
  }
  _EBX = (v8 | v13) + v10 + 1;
  _AL = ((int (*)(void))((char *)&loc_401122 + 1))();
  __asm
  {
    xlat
    int     0Fh;  - IRQ7 - PRINTER INTERRUPT
  }
  JUMPOUT(0x401415);
}
// 401291: positive sp value 24 has been found
// 401413: control flows out of bounds to 401415
// 40128E: control flows out of bounds to 40123D
// 401274: variable 'v19' is possibly undefined
// 401290: variable 'v20' is possibly undefined
// 401290: variable 'v22' is possibly undefined
// 401290: variable 'v23' is possibly undefined
// 401290: variable 'v24' is possibly undefined
// 401291: variable 'v21' is possibly undefined

//----- (004012E4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4012E4()
{
  JUMPOUT(0x40115E);
}
// 4012EC: positive sp value 4 has been found
// 4012F2: control flows out of bounds to 40115E

//----- (00401327) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_401327(__int32 a1@<esi>)
{
  __int32 v1; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v1, a1);
  JUMPOUT(0x401446);
}
// 40132D: positive sp value 4 has been found
// 401335: control flows out of bounds to 401446

//----- (00401362) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn sub_401362()
{
  JUMPOUT(0x401415);
}
// 40118B: positive sp value 4 has been found
// 401371: control flows out of bounds to 401415
// 401362: using guessed type void __noreturn sub_401362();

//----- (0040142D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall __noreturn sub_40142D(int a1, int a2)
{
  int v2; // [esp-4h] [ebp-4h]

  v2 = ((int (__fastcall *)(int, int))loc_4013B3)(a1, a2);
  ((void (__cdecl *)(int))sub_402C99)(v2);
}
// 401433: positive sp value 4 has been found
// 402C99: using guessed type void __noreturn sub_402C99();

//----- (00402218) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402218(char a1@<cf>, int a2@<eax>, __int16 a3@<dx>, __int16 a4@<cx>, __int16 a5@<bx>, int a6@<edi>)
{
  __int16 v6; // bx
  int v7; // eax
  __int16 v8; // dx
  __int16 v9; // cx
  __int16 v10; // bx
  __int16 v11; // bx
  int v12; // eax
  int v13; // edi
  __int16 v14; // bx
  __int16 v15; // bx
  int v16; // edi

  v6 = a5 - a4;
  LOBYTE(v6) = a4;
  LOBYTE(a2) = HIBYTE(a4) | a2;
  v7 = a2 + 1;
  HIBYTE(a3) = ~(HIBYTE(a3) - (a1 - 65));
  v8 = a3 - 1;
  v9 = a4 - 1;
  v10 = v6 - v9;
  HIBYTE(v10) = (HIBYTE(v9) ^ HIBYTE(v10)) + 1;
  v11 = v9 | v10;
  BYTE1(v7) |= HIBYTE(v11);
  if ( !__SETP__(BYTE1(v7), 0) && __SETP__(BYTE1(v7), 0) )
  {
    v12 = v7 + 1780187871;
    v13 = v12 ^ a6;
    v14 = (v8 | v11) - 1;
    --HIBYTE(v14);
    v15 = (v13 ^ v14) - 1;
    v16 = v13 + 1;
    if ( !(((char)(__CFADD__((_BYTE)v15, HIBYTE(v15)) + v15 + HIBYTE(v15) + 95) < 0) ^ (__OFADD__(
                                                                                          __CFADD__(
                                                                                            (_BYTE)v15,
                                                                                            HIBYTE(v15)),
                                                                                          v15 + HIBYTE(v15)) | __OFADD__(95, __CFADD__((_BYTE)v15, HIBYTE(v15)) + v15 + HIBYTE(v15))) | (__CFADD__((_BYTE)v15, HIBYTE(v15)) + (_BYTE)v15 + HIBYTE(v15) == -95))
      && ((char)(__CFADD__((_BYTE)v15, HIBYTE(v15)) + v15 + HIBYTE(v15) + 95) < 0) ^ (__OFADD__(
                                                                                        __CFADD__(
                                                                                          (_BYTE)v15,
                                                                                          HIBYTE(v15)),
                                                                                        v15 + HIBYTE(v15)) | __OFADD__(95, __CFADD__((_BYTE)v15, HIBYTE(v15)) + v15 + HIBYTE(v15))) | (__CFADD__((_BYTE)v15, HIBYTE(v15)) + (_BYTE)v15 + HIBYTE(v15) == -95) )
    {
      JUMPOUT(0x402D60);
    }
    if ( !__OFSUB__(v16, v12) && __OFSUB__(v16, v12) )
      JUMPOUT(0x402166);
    JUMPOUT(0x402EA5);
  }
  JUMPOUT(0x4026B6);
}
// 402142: positive sp value 4 has been found
// 402161: control flows out of bounds to 402166
// 4022A6: control flows out of bounds to 4022A9
// 40231B: control flows out of bounds to 40231D
// 402AC8: control flows out of bounds to 402ACA
// 402D5A: control flows out of bounds to 402D60
// 402E8B: control flows out of bounds to 402E8C
// 4022A4: control flows out of bounds to 402319
// 402309: control flows out of bounds to 402EA5
// 402AC8: control flows out of bounds to 402AFD
// 402E5B: control flows out of bounds to 4026B6
// 402312: conditional instruction was optimized away because of 'bh.1>=0'

//----- (00402239) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __userpurge sub_402239(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int _EBP@<ebp>, int a5@<edi>, int a6@<esi>, double a7@<st0>, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  int v64; // edi
  int v65; // eax
  int v66; // edi
  int *v69; // eax
  int v70; // ebx
  int v71; // esi
  int v72; // ebx
  int v73; // esi
  int v74; // ebx
  int v75; // esi
  int v76; // eax
  __int16 v77; // di
  char v78; // al
  __int16 v79; // di
  int v80; // esi
  int v81; // [esp+20h] [ebp-8h]
  int v82; // [esp+24h] [ebp-4h]

  *(&v82 - 11) = v81;
  v69 = (int *)(a1 + 120);
  HIWORD(v70) = HIWORD(a2);
  v71 = a6 - (_DWORD)v69;
  LOBYTE(v70) = -(char)a2;
  BYTE1(v70) = BYTE1(a2) - 1;
  v72 = v71 + v70;
  v69 += 2;
  v73 = a5 | v71;
  BYTE1(v72) += 0x80;
  LOBYTE(v72) = v72 - 1;
  v74 = v72 - v73 - a5;
  LOBYTE(v74) = a3;
  v64 = a5 - v74;
  BYTE1(v74) = BYTE1(v69);
  v65 = *v69;
  v66 = a3 ^ v64;
  _BH = ~BYTE1(v74);
  if ( v66 )
    __asm { repne mov bh, bh }
  v79 = v66 - 1;
  v80 = v65 | v73;
  v75 = v65 + v80 + 1;
  v76 = a3 + v65;
  v77 = v76 | (v79 - a3);
  if ( a3 + v75 + 1 < 0 == __OFADD__(a3, v75 + 1) && a3 + v75 + 1 < 0 != __OFADD__(a3, v75 + 1) )
  {
    __asm { rcl     dword ptr [ebp+7DD780FCh], 46h }
    BYTE1(a2) += __CFADD__(BYTE1(a3), (_BYTE)a2) + 17;
    LOBYTE(a2) = -(char)(BYTE1(a3) + a2);
    v78 = v77 - (((_BYTE)a2 != 0) + 47);
    LOBYTE(a2) = ((unsigned __int8)v77 < (unsigned __int8)(((_BYTE)a2 != 0) + 47)) + a2 - 19;
    ++BYTE1(a3);
    LOBYTE(a3) = v77 ^ a3;
    BYTE1(a2) = a2 + (a2 ^ v78) + 1 + BYTE1(a2) - HIBYTE(v77);
    ((void (__usercall *)(int@<ecx>, int@<edx>, double@<st0>))((char *)&loc_402493 + 2))(a3, a2, a7);
    JUMPOUT(0x403038);
  }
  ((void (__usercall *)(_DWORD, double@<st0>))sub_402A8E)(*(_DWORD *)(v76 + 16), a7);
  JUMPOUT(0x402533);
}
// 40289E: positive sp value 8 has been found
// 40252E: control flows out of bounds to 402533
// 403033: control flows out of bounds to 403038
// 4021F0: control flows out of bounds to 4021F1
// 40293B: control flows out of bounds to 402623
// 4021EA: conditional instruction was optimized away because of 'edi.4!=0'
// 402239: too many input arguments, some ignored
// 402774: using guessed type _DWORD sub_402774();
// 402BAD: using guessed type double sub_402BAD();

//----- (0040225A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40225A()
{
  JUMPOUT(0x402B22);
}
// 40225E: positive sp value 4 has been found
// 40226A: control flows out of bounds to 402B22

//----- (00402353) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402353(int a1@<edx>, int a2@<ecx>, int a3@<edi>, __int32 a4@<esi>)
{
  int v4; // ebx
  __int32 v5; // esi
  long double *v6; // eax
  int v7; // edx
  long double v8; // st7
  char v9; // pf
  unsigned __int8 v11; // al
  __int32 v12; // [esp-Ch] [ebp-Ch] BYREF

  _InterlockedExchange(&v12, a4);
  v4 = a3 + v12;
  LOBYTE(v4) = a3 + v12 + 106;
  v5 = a2 | ((a1 ^ v4 ^ v12) + 1);
  v8 = sub_40225A();
  if ( v9 )
  {
    *v6 = __FBSTP__(v8);
    _EDX = (*(_DWORD *)(v5 - 232506233) ^ v7) - 1;
    if ( _EDX >= 0 )
      __asm { rep push edx }
    sub_402644();
    if ( v11 < 0x39u )
      JUMPOUT(0x4025E4);
    JUMPOUT(0x40265E);
  }
  JUMPOUT(0x40241A);
}
// 4024A3: positive sp value C has been found
// 4024B6: control flows out of bounds to 4024B7
// 4025E2: control flows out of bounds to 4025E4
// 402FBC: control flows out of bounds to 402FBE
// 40248F: control flows out of bounds to 40241A
// 4025E2: control flows out of bounds to 40265E
// 402FBC: control flows out of bounds to 403036
// 402FB0: conditional instruction was optimized away because of 'esi.4!=0'
// 4024AC: conditional instruction was optimized away because of 'edx.4>=0'
// 40248F: variable 'v9' is possibly undefined
// 402491: variable 'v6' is possibly undefined
// 402493: variable 'v7' is possibly undefined
// 4025E2: variable 'v11' is possibly undefined
// 40225A: using guessed type double sub_40225A();

//----- (004023B6) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4023B6()
{
  JUMPOUT(0x4026F8);
}
// 4023BA: positive sp value 4 has been found
// 4023C6: control flows out of bounds to 4026F8

//----- (004023EE) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall __noreturn sub_4023EE(int a1)
{
  LOBYTE(a1) = ~(_BYTE)a1;
  BYTE1(a1) -= 63;
  ((void (__thiscall *)(int))sub_402EE4)(a1);
}
// 4023F2: positive sp value 4 has been found
// 402EE4: using guessed type void __noreturn sub_402EE4();

//----- (0040253B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_40253B(int a1@<ecx>, int a2@<edi>)
{
  sub_4023EE(a2 | a1);
}
// 402544: positive sp value 4 has been found

//----- (004025E6) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4025E6()
{
  void *v0; // [esp+8h] [ebp-4h]
  void *retaddr; // [esp+Ch] [ebp+0h]

  *(&retaddr - 4) = v0;
  JUMPOUT(0x40297F);
}
// 4025EA: positive sp value 4 has been found
// 402600: control flows out of bounds to 40297F

//----- (00402609) --------------------------------------------------------
#error "40261D: cannot convert to microcode (funcsize=8)"

//----- (00402644) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402644()
{
  JUMPOUT(0x402659);
}
// 40264D: positive sp value 4 has been found
// 402657: control flows out of bounds to 402659

//----- (00402672) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402672()
{
  JUMPOUT(0x402125);
}
// 402676: positive sp value 4 has been found
// 4026D7: control flows out of bounds to 4026D9
// 402694: control flows out of bounds to 402696
// 402680: control flows out of bounds to 402125
// 4026CB: control flows out of bounds to 402D86
// 402689: conditional instruction was optimized away because of 'ah.1!=0'

//----- (0040271F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40271F()
{
  sub_402B45();
  JUMPOUT(0x402744);
}
// 402723: positive sp value 4 has been found
// 402742: control flows out of bounds to 402744

//----- (00402774) --------------------------------------------------------
#error "4027E8: cannot convert to microcode (funcsize=53)"

//----- (00402A23) --------------------------------------------------------
#error "4027C0: cannot convert to microcode (funcsize=51)"

//----- (00402A8E) --------------------------------------------------------
#error "4025A8: cannot convert to microcode (funcsize=68)"

//----- (00402B45) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402B45()
{
  void *v0; // [esp+24h] [ebp-4h]
  void *retaddr; // [esp+28h] [ebp+0h]

  *(&retaddr - 11) = v0;
  sub_402672();
}
// 402B49: positive sp value 4 has been found

//----- (00402B7A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402B7A(_BYTE *a1@<ebx>)
{
  char v1; // al

  BYTE1(a1) = (_BYTE)a1 - 1;
  LOBYTE(a1) = (_BYTE)a1 - 9;
  ++BYTE1(a1);
  sub_4023B6();
  *a1 = v1;
  __asm { iret }
}
// 402B7E: positive sp value 4 has been found
// 402B95: control flows out of bounds to 402B96
// 402B93: variable 'v1' is possibly undefined

//----- (00402BAD) --------------------------------------------------------
#error "402BAD: stack frame is too big (funcsize=0)"

//----- (00402C52) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402C52()
{
  JUMPOUT(0x402FD8);
}
// 402C58: positive sp value 4 has been found
// 402C77: control flows out of bounds to 402C7D
// 402C67: control flows out of bounds to 402FD8
// 402C71: conditional instruction was optimized away because of 'al.1>=0'

//----- (00402C99) --------------------------------------------------------
void __noreturn sub_402C99()
{
  sub_40271F();
  JUMPOUT(0xFE6C1E6B);
}
// 402EA1: control flows out of bounds to FE6C1E6B
// 402C99: using guessed type void __noreturn sub_402C99();

//----- (00402D66) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402D66()
{
  JUMPOUT(0x402427);
}
// 402E20: positive sp value C has been found
// 402D7B: control flows out of bounds to 402427
// 402D9C: control flows out of bounds to 402A47

//----- (00402EE4) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
void __noreturn sub_402EE4()
{
  ((void (*)(void))sub_402609)();
  __halt();
}
// 402EFD: positive sp value B105 has been found
// 402EF8: bad sp value at call
// 402EE4: using guessed type void __noreturn sub_402EE4();

//----- (00402F05) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402F05()
{
  JUMPOUT(0x402BD5);
}
// 402F09: positive sp value 4 has been found
// 402F14: control flows out of bounds to 402BD5

//----- (00402F4D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402F4D(char a1@<ah>, _BYTE *a2@<edx>, __int32 a3@<ecx>, __int16 a4@<bx>, int a5@<ebp>, int a6@<edi>, int a7@<esi>)
{
  char v7; // dh
  unsigned __int8 v8; // ah
  int v9; // edi

  v8 = a4 ^ HIBYTE(a4) ^ a1;
  v9 = a7 + a6;
  if ( v8 < 0xBCu && v8 != 0xBC && (v8 >= 0xBCu || v8 == 0xBC) )
  {
    *a2 |= 0xF0u;
    _InterlockedExchange((volatile __int32 *)(v9 - 19389372), a3);
    JUMPOUT(0x402F77);
  }
  ((void (*)(void))loc_402EC0)();
  *(_BYTE *)(a5 - 887856232) |= v7;
  JUMPOUT(0x402427);
}
// 40240C: positive sp value 4 has been found
// 402F71: control flows out of bounds to 402F77
// 402425: control flows out of bounds to 402427
// 40241F: variable 'v7' is possibly undefined

// nfuncs=32 queued=32 decompiled=32 lumina nreq=0 worse=0 better=0
#error "There were 5 decompilation failure(s) on 32 function(s)"
