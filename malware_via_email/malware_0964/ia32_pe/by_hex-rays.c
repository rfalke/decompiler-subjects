/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int a1, int a2, int a3);
void sub_401072();
// void __usercall sub_404110(char a1@<sf>, char a2@<of>, int a3@<eax>, int a4@<ecx>, int a5@<ebx>, double a6@<st4>, double a7@<st0>);
// void __usercall sub_404166(int a1@<ecx>, int a2@<ebx>, int a3@<edi>, int a4@<esi>, double a5@<st0>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_404204; // weak


//----- (0040104A) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // ebx

  sub_401072();
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 3;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (00401072) --------------------------------------------------------
void sub_401072()
{
  int v0; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v0);
  __debugbreak();
  __debugbreak();
}

//----- (00404110) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_404110(char a1@<sf>, char a2@<of>, int a3@<eax>, int a4@<ecx>, int a5@<ebx>, double a6@<st4>, double a7@<st0>)
{
  int v7; // esi
  double v8; // st7
  char v9; // cf
  int v10; // ecx
  int v11; // edi
  unsigned int v12; // edx
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  if ( a1 != a2 )
    a3 = a4;
  v7 = a3;
  v8 = a6 - a7;
  sub_404166(a4 + 1, a5, -1311123697, a3, v8);
  __asm { into }
  v11 = v10 - 1311123697;
  _BitScanReverse((unsigned int *)&v10, v12);
  sub_404166(v10 >> 25, (int)&retaddr + v9 + a5, v11, v7, v8);
}
// 404141: positive sp value 4 has been found
// 40414B: variable 'v10' is possibly undefined
// 404159: variable 'v12' is possibly undefined
// 404148: variable 'v9' is possibly undefined

//----- (00404166) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_404166(int a1@<ecx>, int a2@<ebx>, int a3@<edi>, int a4@<esi>, double a5@<st0>)
{
  int v5; // [esp-4h] [ebp-4h]
  int savedregs; // [esp+0h] [ebp+0h] BYREF
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  ((void (__usercall *)(int, int, int, int, int, void **, int *, int, int, double@<st0>))loc_404204)(
    savedregs,
    v5,
    savedregs,
    a1,
    a3,
    &retaddr,
    &savedregs,
    a2,
    a4,
    a5);
  JUMPOUT(0x404204);
}
// 40416F: positive sp value 8 has been found
// 404203: control flows out of bounds to 404204

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
