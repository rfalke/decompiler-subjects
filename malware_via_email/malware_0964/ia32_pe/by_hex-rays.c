/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int, int, int);
void sub_401072();
// void __usercall sub_404110(char a1@<sf>, char a2@<of>, int a3@<eax>, int a4@<ecx>, int *a5@<ebx>, double a6@<st4>, double a7@<st0>);
// void __usercall sub_404166(int a1@<ecx>, int *a2@<ebx>, int a3@<edi>, int a4@<esi>, double a5@<st0>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_404204; // weak


//----- (0040104A) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // ebx

  sub_401072();
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 3;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (00401072) --------------------------------------------------------
void sub_401072()
{
  int v0; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v0);
  __debugbreak();
  __debugbreak();
}

//----- (00404110) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_404110(
        char a1@<sf>,
        char a2@<of>,
        int a3@<eax>,
        int a4@<ecx>,
        int *a5@<ebx>,
        double a6@<st4>,
        double a7@<st0>)
{
  int v7; // esi
  char v8; // cf
  int v9; // ecx
  int v10; // edi
  unsigned int v11; // edx
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  if ( a1 != a2 )
  {
    __asm { fadd    st(2), st }
    a3 = a4;
  }
  v7 = a3;
  __asm
  {
    fcomp   st(1)
    fsubr   st(4), st
  }
  sub_404166(a4 + 1, a5, -1311123697, a3, a7);
  __asm { into }
  v10 = v9 - 1311123697;
  _BitScanReverse((unsigned int *)&v9, v11);
  sub_404166(v9 >> 25, (int *)((char *)&retaddr + (_DWORD)a5 + v8), v10, v7, a7);
}
// 404141: positive sp value 4 has been found
// 40411C: inconsistent fpu stack
// 40414B: variable 'v9' is possibly undefined
// 404159: variable 'v11' is possibly undefined
// 404148: variable 'v8' is possibly undefined

//----- (00404166) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_404166(int a1@<ecx>, int *a2@<ebx>, int a3@<edi>, int a4@<esi>, double a5@<st0>)
{
  int v5; // eax
  int v6; // edx
  char v7; // sf
  char v8; // of
  int v9; // [esp-20h] [ebp-20h] BYREF
  int v10; // [esp-1Ch] [ebp-1Ch]
  int v11; // [esp-18h] [ebp-18h]
  int v12; // [esp-14h] [ebp-14h]
  int v13; // [esp-10h] [ebp-10h]
  void **v14; // [esp-Ch] [ebp-Ch]
  int *v15; // [esp-8h] [ebp-8h]
  int v16; // [esp-4h] [ebp-4h]
  int savedregs; // [esp+0h] [ebp+0h] BYREF
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  v5 = v16;
  v6 = savedregs;
  savedregs = a4;
  v16 = (int)a2;
  v15 = &savedregs;
  v14 = &retaddr;
  v13 = a3;
  v12 = a1;
  v11 = v6;
  v10 = v5;
  v9 = v6;
  LOWORD(a2) = ~(_WORD)a3;
  if ( v7 == ((unsigned __int64)(a4 * (__int64)v6) >> 32 != 0) )
    a2 = &v9;
  __asm { fsubr   st(6), st }
  if ( __OFSUB__(&savedregs, &v9) )
    LOWORD(v5) = (_WORD)a2 + (&savedregs < &v9) + (_WORD)v5;
  if ( __CFSHL__(((unsigned int)v5 | 0x4969FADB00000000ui64) >> a1, 101) )
  {
    __asm
    {
      fadd    st(3), st
      fcom    st(7)
    }
  }
  ((void (__cdecl *)(int, int, int, int, int, void **, int *, int, int))loc_404204)(
    v9,
    v10,
    v11,
    v12,
    v13,
    v14,
    v15,
    v16,
    savedregs);
  if ( !v8 )
    __asm { fsubr   st(6), st }
  JUMPOUT(0x404204);
}
// 40416F: positive sp value 8 has been found
// 40417E: inconsistent fpu stack
// 404203: control flows out of bounds to 404204
// 404176: variable 'v7' is possibly undefined
// 4041D2: variable 'v8' is possibly undefined

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
