/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int, int, int);
// int __usercall sub_4010A5@<eax>(int result@<eax>);
// void __usercall sub_405079(int *@<edi>);
// void __usercall sub_4050EC(int *@<edi>);

//-------------------------------------------------------------------------
// Data declarations

int dword_401000 = -1817687880; // weak
// extern LPSTR (__stdcall *GetCommandLineA)();
// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);
_UNKNOWN loc_4052AC; // weak


//----- (00401069) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // ebx

  GetModuleHandleA(0);
  GetCommandLineA();
  sub_4010A5(86016);
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 10;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (004010A5) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4010A5@<eax>(int result@<eax>)
{
  int v1; // [esp-8h] [ebp-8h] BYREF

  __writefsdword(0, (unsigned int)&v1);
  dword_401000 = -1817687880 - result;
  return result;
}
// 4010B6: positive sp value 4 has been found
// 4010AD: write access to const memory at 401000 has been detected
// 401000: using guessed type int dword_401000;

//----- (00405079) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_405079(int *a1@<edi>)
{
  __int16 savedregs; // [esp+0h] [ebp+0h]

  __asm
  {
    fsubr   st(5), st
    repne pop ebp
    fadd    st(3), st
    fcomp   st(2)
  }
  sub_4050EC(a1);
  if ( !__SETP__((savedregs + 1) ^ 0x4F ^ ((_WORD)a1 + savedregs), 0) )
    __asm { fsub    st, st }
  __asm { fsubr   st(2), st }
  sub_4050EC(a1);
}
// 405090: positive sp value 4 has been found
// 405086: inconsistent fpu stack
// 405095: variable 'savedregs' is possibly undefined

//----- (004050EC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4050EC(int *a1@<edi>)
{
  int v7; // esi
  int v8; // edi
  unsigned __int64 v9; // rt0
  char v10; // al
  int v11; // edx
  int v12; // esi
  char v13; // cc
  int v14; // edx
  int v16; // ecx
  int v17; // [esp-8h] [ebp-8h]
  int v18; // [esp-4h] [ebp-4h] BYREF

  __asm
  {
    fcom    st
    fcomp   st
    fmul    st(5), st
  }
  _EBX = a1;
  _ECX = (_DWORD *)(v17 + 537);
  __asm { repne mov edi, ecx }
  _ESI = 1869778094;
  if ( __OFADD__(1869778094, __ROL4__(694202930, 253)) )
    _EBX = &v18;
  __asm
  {
    rcl     ebx, 0FFh
    rcl     esi, 75h
  }
  v7 = -_ESI;
  v8 = _EDI + 966;
  while ( 1 )
  {
    __asm { fadd    st(1), st }
    *_ECX -= 916773057;
    LODWORD(v9) = (__PAIR64__(v7 & 0x1E2DBD3, _EBX) >> (char)_ECX) + 1;
    HIDWORD(v9) = -281351807;
    v10 = -126;
    __asm { fadd    st(2), st }
    v11 = (v9 >> (char)_ECX) - 1967099040;
    __asm { fsubr   st(7), st }
    _EBX = 1623991681;
    __asm { fmul    st(2), st }
    v12 = -1247746032;
    if ( ((unsigned __int8)++_ECX & 0x25) != 0 )
    {
      v13 = (v11 + 1 < 0) ^ __OFADD__(1, v11) | (v11 == -1);
      v14 = v11 + 1;
      __asm { fadd    st, st }
      v10 = v14;
      if ( !v13 )
      {
        _EBX = v14;
        v12 = v14 - 1;
      }
      _ESI = v12 + 1;
      __asm { rcl     esi, 59h }
    }
    v7 = -1079260406;
    if ( (int)_ECX >= v8 )
    {
      if ( (unsigned __int8)v10 > 0xCFu )
      {
        __asm { fsubr   st(7), st }
        ((void (*)(void))loc_4052AC)();
        __asm { fcom    st }
        v18 = v16;
        JUMPOUT(0x4052AC);
      }
      JUMPOUT(0x405287);
    }
  }
}
// 40528D: positive sp value 8 has been found
// 40512C: inconsistent fpu stack
// 4052AB: control flows out of bounds to 4052AC
// 405275: control flows out of bounds to 405287
// 40517C: variable 'v17' is possibly undefined
// 405295: variable 'v16' is possibly undefined

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
