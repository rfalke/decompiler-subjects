/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int a1, int a2, int a3);
void __fastcall sub_4010F8(int a1, int a2);
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// void __usercall sub_404114(int a1@<eax>, int a2@<edi>);
void sub_4041E7();
void __noreturn sub_404386(); // weak
// void __usercall __noreturn sub_4043F3(char _SF@<sf>, char _OF@<of>, int a3@<edx>, int a4@<ecx>, int a5@<ebx>, _DWORD *a6@<esi>);

//-------------------------------------------------------------------------
// Data declarations

int dword_401000 = 1002652431; // weak


//----- (004010A7) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  HMODULE v3; // eax
  int v4; // edx
  int v5; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  v3 = GetModuleHandleA(0);
  sub_4010F8((int)v3, v4);
  v5 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 10;
  *(_DWORD *)(a3 + 176) = v5;
  return 0;
}
// 4010D6: variable 'v4' is possibly undefined

//----- (004010F8) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
void __fastcall sub_4010F8(int a1, int a2)
{
  int v2; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v2);
  dword_401000 = a2;
}
// 401100: write access to const memory at 401000 has been detected
// 401000: using guessed type int dword_401000;

//----- (00404114) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_404114(int a1@<eax>, int a2@<edi>)
{
  int v2; // edi
  char v3; // sf
  int v4; // eax
  int v5; // esi
  int v6; // eax
  unsigned int v8; // ebx
  char v9; // of
  int savedregs; // [esp+0h] [ebp+0h]

  v2 = -a2;
  v4 = (a1 >> 1) ^ 0x80;
  v5 = v4;
  __asm { fsubr   st(1), st }
  if ( v3 )
    v5 = v4;
  LOWORD(v5) = v2 + v5;
  v6 = v5;
  _ESI = -989689168;
  _BitScanReverse(&v8, 0xC5028AB0);
  if ( (BYTE1(v6) & v8 & 0x80u) != 0 && v9 )
  {
    __asm { rcr     esi, 0BEh }
    _ESI = _ESI + 1;
  }
  if ( __SETP__(v6 + 38, 0) )
  {
    if ( (char)v6 > -38 )
    {
      __asm
      {
        repne cmc
        rcr     esi, 0E4h
        fsub    st(2), st
      }
      _ESI = v6;
    }
    __asm { fcomp   st(7) }
  }
  __asm { fcom    st(7) }
  savedregs = _ESI;
  sub_4041E7();
  __asm { outsb }
  sub_4041E7();
}
// 4041CC: positive sp value 8 has been found
// 40412B: inconsistent fpu stack
// 404130: variable 'v3' is possibly undefined
// 404186: variable 'v9' is possibly undefined

//----- (004041E7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4041E7()
{
  int savedregs; // [esp+0h] [ebp+0h]

  savedregs = 4211229;
  JUMPOUT(0x404268);
}
// 4041F5: positive sp value 4 has been found
// 404267: control flows out of bounds to 40426C
// 404218: control flows out of bounds to 404268

//----- (004043F3) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_4043F3(char _SF@<sf>, char _OF@<of>, int a3@<edx>, int a4@<ecx>, int a5@<ebx>, _DWORD *a6@<esi>)
{
  bool v6; // of
  bool v7; // cc
  char v8; // al
  int savedregs; // [esp+0h] [ebp+0h]

  if ( _SF == _OF )
  {
    if ( _OF )
      a3 -= 217199327;
    __asm { fcom    st }
    _EDI = -1692772839;
    __asm { rep inc edi }
  }
  LOWORD(a4) = -8353;
  if ( (int)a6 >= a5 )
  {
    savedregs = 6172672;
    JUMPOUT(0x359);
  }
  v6 = __OFSUB__((_BYTE)a3, -49);
  v7 = (unsigned __int8)a3 <= 0xCFu;
  if ( (char)(a3 + 49) >= 0 )
  {
    __asm { fadd    st(3), st }
    LOWORD(a4) = 17988;
    __asm { fsub    st(4), st }
    _CF = __CFADD__(a4, a3);
    v6 = __OFADD__(a4, a3);
    a4 += a3;
    v7 = _CF || a4 == 0;
  }
  v8 = -1;
  if ( v6 )
  {
    __asm { fcomp   st(7) }
    v7 = 0;
    v8 = a3;
    __asm { fmul    st(3), st }
  }
  __asm { fsub    st(1), st }
  if ( !v7 )
    v8 = a4;
  *a6 = __ROR4__(*a6, 248);
  if ( !__SETP__(v8 + 30, 0) )
    ++a4;
  ((void (__fastcall *)(int, int))sub_404386)(a4, 1854955309);
}
// 404322: positive sp value 4 has been found
// 40440B: inconsistent fpu stack
// 40437F: control flows out of bounds to 404384
// 40445F: control flows out of bounds to 359
// 404386: using guessed type void __noreturn sub_404386();

// nfuncs=6 queued=5 decompiled=5 lumina nreq=0 worse=0 better=0
// ALL OK, 5 function(s) have been successfully decompiled
