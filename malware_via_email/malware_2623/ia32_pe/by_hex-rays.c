/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int start();
int __stdcall sub_4011ED(_DWORD *a1, unsigned int a2, int a3);
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// BOOL __stdcall CloseHandle(HANDLE hObject);
// LPSTR __stdcall GetCommandLineA();
// HANDLE __stdcall CreateFileA(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// DWORD __stdcall GetCurrentProcessId();
// LPWSTR __stdcall GetCommandLineW();
// HANDLE __stdcall GetProcessHeap();
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);
// DWORD __stdcall GetVersion();
// DWORD __stdcall GetCurrentThreadId();

//-------------------------------------------------------------------------
// Data declarations

char byte_4010EF[] = { '\xFF' }; // weak
CHAR ModuleName[] = "NTDLL.DLL"; // idb
CHAR FileName[] = "RA9skpovn0ZuDqQ9iMOwCw3ZY.3Qq"; // idb
CHAR ProcName[] = "ZwOpenEventPair"; // idb


//----- (00401012) --------------------------------------------------------
int start()
{
  LPSTR v0; // eax
  int v2; // [esp+0h] [ebp-30h]
  HANDLE hObject; // [esp+4h] [ebp-2Ch]
  LPSTR v4; // [esp+8h] [ebp-28h]
  HMODULE hModule; // [esp+Ch] [ebp-24h]
  int v6; // [esp+14h] [ebp-1Ch]
  int v7; // [esp+14h] [ebp-1Ch]
  int v8; // [esp+18h] [ebp-18h]
  int v9; // [esp+1Ch] [ebp-14h]
  int v10; // [esp+20h] [ebp-10h]
  FARPROC ZwOpenEventPair; // [esp+24h] [ebp-Ch]
  DWORD v12; // [esp+28h] [ebp-8h]
  LPSTR v13; // [esp+2Ch] [ebp-4h]
  int savedregs; // [esp+30h] [ebp+0h]

  v13 = GetCommandLineA();
  hObject = CreateFileA(FileName, 0x20000000u, 0, 0, 3u, 0x85u, 0);
  hModule = GetModuleHandleA(ModuleName);
  v4 = GetCommandLineA();
  GetCurrentThreadId();
  GetCurrentProcessId();
  CloseHandle(hObject);
  ZwOpenEventPair = GetProcAddress(hModule, ProcName);
  v12 = GetVersion();
  CloseHandle(hObject);
  GetProcessHeap();
  v0 = GetCommandLineA();
  v7 = ((int (__stdcall *)(_DWORD, _DWORD, _DWORD, int, HANDLE, LPSTR, HMODULE, LPSTR, int, int, int, int, FARPROC, DWORD, LPSTR, int))ZwOpenEventPair)(
         0,
         0,
         0,
         v2,
         hObject,
         v4,
         hModule,
         v0,
         v6,
         v8,
         v9,
         v10,
         ZwOpenEventPair,
         v12,
         v13,
         savedregs);
  GetCommandLineW();
  return ((int (*)(void))&byte_4010EF[v7 ^ 0xC0000005])();
}
// 4010C9: variable 'v2' is possibly undefined
// 4010C9: variable 'v6' is possibly undefined
// 4010C9: variable 'v8' is possibly undefined
// 4010C9: variable 'v9' is possibly undefined
// 4010C9: variable 'v10' is possibly undefined
// 4010C9: variable 'savedregs' is possibly undefined

//----- (004011ED) --------------------------------------------------------
int __stdcall sub_4011ED(_DWORD *a1, unsigned int a2, int a3)
{
  unsigned int v4; // edx
  int result; // eax

  v4 = a2 >> 2;
  result = a3;
  do
  {
    *a1 -= a3;
    *a1 -= a3;
    *a1 += 701614541;
    *a1 ^= 0x3745BED9u;
    *a1 += a3;
    *a1++ -= 2028538341;
    --v4;
  }
  while ( v4 );
  return result;
}

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
