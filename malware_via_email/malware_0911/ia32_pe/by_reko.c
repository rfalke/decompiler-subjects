// subject_rsec.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw40A078 = 0xA0AD; // 0040A078
word32 g_dw40A07C = 41151; // 0040A07C
word32 g_dw40A080 = 41166; // 0040A080
word32 g_dw40A084 = 0xA0E1; // 0040A084
word32 g_dw40A088 = 0xA0F3; // 0040A088
word32 g_dw40A08C = 41222; // 0040A08C
word32 g_dw40A094 = 0xA120; // 0040A094
word32 g_dw40A098 = 41266; // 0040A098
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401004: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	word32 ebp;
	word32 dwLoc2C;
	word32 ebp_107;
	fn004010D0(ebp, (word16) dwLoc2C, out ebp_107);
	word32 ebp_119;
	return fn004010D0(ebp_107, 0x00, out ebp_119);
}

// 004010D0: Register word32 fn004010D0(Register word32 ebp, Stack word16 wArg00, Register out ptr32 ebpOut)
// Called from:
//      Win32CrtStartup
word32 fn004010D0(word32 ebp, word16 wArg00, ptr32 & ebpOut)
{
	ptr32 fp;
	struct Eq_21 * fs;
	word32 dwArg00;
	word32 dwLoc30;
	int32 dwLoc0130;
	word16 eax_16_16_22 = SLICE(dwArg00, word16, 16);
	word32 eax_37 = SEQ(eax_16_16_22, 0x00);
	struct Eq_30 * ebx_114;
	word32 ecx_115;
	word32 eax_113 = fn00401698((word16) dwLoc30, out ecx_115, out ebx_114);
	word32 eax_141;
	word32 ecx_143;
	ebx_114->ptr0018();
	struct Eq_47 * esp_148;
	<unknown> Eq_21::* eax_149;
	word32 ecx_151;
	ebx_114->ptr001C();
	word16 ecx_16_16_169 = SLICE(ecx_151, word16, 16);
	uint32 esi_161 = (uint32) ((&(fs->*((char *) eax_149 + 4)))[(char *) eax_149 + 6].w0000 + 0x02);
	esp_148->ptrFFFFFFFC = (<unknown> Eq_21::*) ((char *) eax_149 + 6);
	esp_148->ptrFFFFFFF8 = (<unknown> Eq_21::*) ((char *) eax_149 + 6);
	struct Eq_75 * esp_170;
	struct Eq_30 * eax_171;
	word32 ecx_173;
	ebx_114->ptr0000();
	word16 ecx_16_16_218 = SLICE(ecx_173, word16, 16);
	esp_170->ptr0038 = ebx_114;
	esp_170->dw003C = esi_161 - 0x01;
	esp_170->ptrFFFFFFFC = ebx_114;
	esp_170->ptrFFFFFFFC -= 0x04;
	struct Eq_30 * edi_189 = esp_170->ptrFFFFFFFC;
	esp_170->ptrFFFFFFFC = eax_171;
	esp_170->dwFFFFFFF8 = ecx_173;
	esp_170->ptrFFFFFFF4 = esp_170 - 8;
	esp_170->dwFFFFFFF0 = 0x40;
	esp_170->dwFFFFFFEC = esp_170->dw0020;
	esp_170->dwFFFFFFE8 = esp_170->dw0014;
	esp_170->dw0018 = 0x00;
	esp_170->dwFFFFFFE4 = ~0x00;
	struct Eq_141 * esp_219;
	struct Eq_142 Eq_21::* eax_220;
	edi_189->ptr0010();
	struct Eq_146 * eax_225 = eax_220 + (fs->*eax_220).dw002F / 0x0033;
	word32 ecx_227 = eax_225->dw0003;
	esp_219->dw0030 += ecx_227;
	esp_219->ptrFFFFFFFC = eax_225;
	esp_219->ptr0000 = esp_219->ptrFFFFFFFC;
	struct Eq_146 * eax_241 = esp_219->ptr0000;
	byte * edi_245 = esp_219->ptr0008;
	word32 ecx_254 = eax_241->dw0003;
	esp_219->ptr0010 = &eax_241->dw0003;
	word32 * eax_258 = esp_219->ptr0010;
	esp_219->dw003C = esp_219->dw003C ^ ecx_254;
	esp_219->ptr0010 = eax_258;
	esp_219->ptr0010 = esp_219->ptr001C;
	word32 ecx_274 = esp_219->dw002C;
	esp_219->ptr0010 = esp_219->ptr0010;
	word16 ecx_16_16_339 = SLICE(ecx_274, word16, 16);
	word32 * eax_278 = esp_219->ptr0010;
	esp_219->ptrFFFFFF0C = eax_278;
	esp_219->dwFFFFFF10 = ecx_274;
	esp_219->ptrFFFFFF08 = edi_245;
	esp_219->ptrFFFFFF04 = null;
	byte * eax_293 = esp_219->ptrFFFFFF04;
	do
	{
		byte al_298 = (byte) eax_293;
		byte * edi_297 = eax_293 + (esp_219 - 0xEC);
		*edi_297 = al_298;
		esp_219->ptrFFFFFF04 = eax_293 + 1;
		byte * eax_305 = esp_219->ptrFFFFFF04;
		esp_219->ptrFFFFFF04 = eax_305;
		eax_293 = esp_219->ptrFFFFFF04;
	} while (eax_305 < (byte *) 0x0100);
	esp_219->ptrFFFFFF04 = eax_293;
	esp_219->ptrFFFFFF08 = esp_219->ptrFFFFFF04;
	if (esp_219->b0044 != 121)
	{
		struct Eq_278 * edi_329 = esp_219->ptr0040;
		esp_219->ptrFFFFFF08 = &esp_219->b0044;
		byte * eax_333 = esp_219->ptrFFFFFF08;
		do
		{
			struct Eq_324 * esp_345;
			word32 eax_346;
			word32 ecx_348;
			edi_329->ptr0018();
			esp_345->dwFFFFFFFC = eax_346;
			struct Eq_333 * esp_357;
			word32 eax_358;
			word32 ecx_360;
			edi_329->ptr0010();
			esp_357->dwFFFFFFFC = eax_358;
			struct Eq_342 * esp_369;
			word32 eax_370;
			word32 ecx_372;
			edi_329->ptr0018();
			esp_369->dwFFFFFFFC = eax_370;
			struct Eq_351 * esp_381;
			word32 eax_382;
			word32 ecx_384;
			edi_329->ptr0018();
			esp_381->dwFFFFFFFC = eax_382;
			struct Eq_360 * esp_393;
			word32 eax_394;
			word32 ecx_396;
			edi_329->ptr0018();
			esp_393->dwFFFFFFFC = eax_394;
			struct Eq_369 * esp_405;
			word32 eax_406;
			word32 ecx_408;
			edi_329->ptr0018();
			esp_405->dwFFFFFFFC = eax_406;
			struct Eq_378 * esp_417;
			word32 eax_418;
			word32 ecx_420;
			edi_329->ptr0018();
			esp_417->dwFFFFFFFC = eax_418;
			struct Eq_292 * esp_429;
			byte * eax_430;
			word32 ecx_432;
			edi_329->ptr0010();
			word16 cx_449 = (word16) ecx_432;
			ecx_16_16_339 = SLICE(ecx_432, word16, 16);
			esp_429->ptrFFFFFFFC = eax_430;
			++esp_429->ptrFFFFFFFC;
			byte * eax_446 = esp_429->ptrFFFFFFFC;
			cup16 ax_450 = (word16) eax_446 - cx_449;
			esp_429->ptrFFFFFFFC = SEQ(SLICE(eax_446, word16, 16), ax_450);
			eax_333 = esp_429->ptrFFFFFFFC;
		} while (ax_450 < 0x00);
		esp_429->ptrFFFFFFFC = eax_333;
	}
	int32 esi_505 = 0x00;
	int32 ebp_506 = 0x00;
	Eq_398 eax_522 = 0x00;
	do
	{
		word32 ebx_527 = (word32) (fp - 300)[ebp_506];
		byte bl_609 = (byte) ebx_527;
		word32 edx_540 = (word32) *((word32) eax_522 + dwLoc0130);
		word32 ecx_543 = ebx_527 + esi_505;
		word32 edx_545 = edx_540 + ecx_543;
		byte dl_559 = (byte) edx_545;
		word16 edx_16_16_560 = SLICE(edx_545, word16, 16);
		int32 edx_561 = SEQ(edx_16_16_560, 0x00, dl_559);
		esi_505 = edx_561;
		Eq_398 eax_573 = (word32) eax_522 + 1;
		if ((word32) eax_522 + 1 >= fp - 40)
			eax_573.u0 = 0x00;
		byte dl_593 = *((word32) (fp - 300) + edx_561);
		*((word32) (fp - 300) + ebp_506) = (ptr32) dl_593;
		++ebp_506;
		ptr32 edx_598 = fp - 300 + edx_561;
		ptr32 edx_600 = edx_598 - eax_573;
		*((word32) eax_573.u0 + edx_600) = SEQ(*((word32) ((word32) eax_573.u0 + 1) + edx_600), bl_609);
		eax_522 = eax_573;
	} while (SLICE(ebp_506, byte, 8) != 0x01);
	ebpOut = ebp + 0x01;
	return eax_113;
}

// 00401258: Register ptr32 fn00401258(Register ptr32 eax, Register (ptr32 Eq_461) ecx, Register out Eq_462 ecxOut, Register out ptr32 ebxOut)
// Called from:
//      fn00401698
ptr32 fn00401258(ptr32 eax, struct Eq_461 * ecx, union Eq_462 & ecxOut, ptr32 & ebxOut)
{
	Eq_462 ecx_40 = *((word32) eax + (ecx->dw002B + eax)->dw0080);
	ptr32 eax_46 = (word32) ecx_40.u0 + eax;
	fn00401776();
	ecxOut = ecx_40;
	ebxOut = eax_46 + 0x04;
	return eax_46 + 0x04;
}

// 00401698: Register word32 fn00401698(Stack word16 wArg00, Register out ptr32 ecxOut, Register out ptr32 ebxOut)
// Called from:
//      fn004010D0
word32 fn00401698(word16 wArg00, ptr32 & ecxOut, ptr32 & ebxOut)
{
	word32 dwArg00;
	word32 eax_109 = dwArg00;
	while (true)
	{
		word16 eax_16_16_38 = SLICE(eax_109, word16, 16);
		word16 * eax_47 = SEQ(eax_16_16_38, 0x00);
		word16 ax_53 = *eax_47;
		word32 eax_57 = SEQ(eax_16_16_38, ax_53 + 42421);
		if (ax_53 == 23117)
			break;
		eax_109 = eax_57 - 0x00010000;
	}
	ptr32 eax_70;
	__btc<word32>(eax_57, 0x01, out eax_70);
	ptr32 ebx_86;
	ptr32 ecx_87;
	word32 eax_85 = fn00401258(eax_70, eax_70 + 0x11, out ecx_87, out ebx_86);
	ecxOut = ecx_87;
	ebxOut = ebx_86;
	return eax_85;
}

// 00401776: void fn00401776()
// Called from:
//      fn00401258
void fn00401776()
{
}

