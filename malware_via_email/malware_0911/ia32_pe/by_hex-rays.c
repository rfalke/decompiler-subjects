/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void start();
// int __usercall sub_4010D0@<eax>(int a1@<ecx>, int a2@<ebx>, _WORD *a3@<ebp>, int a4@<edi>, int a5@<esi>);
void sub_401698();


//----- (00401004) --------------------------------------------------------
void start()
{
  JUMPOUT(0x401159);
}
// 401089: control flows out of bounds to 401159

//----- (004010D0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4010D0@<eax>(int a1@<ecx>, int a2@<ebx>, _WORD *a3@<ebp>, int a4@<edi>, int a5@<esi>)
{
  int v5; // edx
  _WORD *v6; // eax
  int v7; // ebp
  int v8; // eax
  unsigned __int16 v9; // si
  int v10; // ecx
  int v11; // eax
  int v12; // eax
  unsigned int v13; // eax
  unsigned int i; // eax
  unsigned int v15; // edi
  int v16; // edi
  int v17; // eax
  unsigned __int16 v18; // cx
  unsigned int v19; // eax
  int v20; // ebp
  int v21; // ebx
  int v22; // edx
  unsigned __int8 v23; // cl
  int v24; // esi
  int v25; // eax
  int v26; // ebp
  int j; // edi
  _BYTE *v28; // edx
  int v29; // ebx
  char v30; // dh
  int result; // eax
  int v32; // eax
  int v33; // esi
  _DWORD v34[2]; // [esp-Ch] [ebp-15Ch]
  int v35; // [esp-4h] [ebp-154h]
  int v36; // [esp+0h] [ebp-150h]
  int v37; // [esp+4h] [ebp-14Ch]
  _BYTE v38[4]; // [esp+8h] [ebp-148h] BYREF
  int v39; // [esp+FCh] [ebp-54h]
  int v40; // [esp+100h] [ebp-50h]
  int *v41; // [esp+104h] [ebp-4Ch]
  int v42; // [esp+108h] [ebp-48h] BYREF
  int v43; // [esp+10Ch] [ebp-44h]
  int v44; // [esp+110h] [ebp-40h]
  int v45; // [esp+114h] [ebp-3Ch]
  int v46; // [esp+118h] [ebp-38h]
  int v47; // [esp+11Ch] [ebp-34h] BYREF
  int v48; // [esp+120h] [ebp-30h]
  int v49; // [esp+124h] [ebp-2Ch]
  int *v50; // [esp+128h] [ebp-28h]
  int v51; // [esp+12Ch] [ebp-24h]
  int v52; // [esp+130h] [ebp-20h]
  int v53; // [esp+134h] [ebp-1Ch]
  int v54; // [esp+138h] [ebp-18h]
  _WORD *v55; // [esp+13Ch] [ebp-14h]
  _WORD *v56; // [esp+140h] [ebp-10h]
  _WORD *v57; // [esp+144h] [ebp-Ch]
  int v58; // [esp+148h] [ebp-8h]
  int v59; // [esp+14Ch] [ebp-4h]

  v56 = a3;
  LOWORD(v6) = 0;
  HIWORD(v6) = HIWORD(v57);
  LOWORD(a1) = *v6;
  LOWORD(v6) = 0;
  v57 = v6 + 12312;
  v56 = v6 + 13884;
  v55 = v6 + 12312;
  v54 = a5;
  v53 = a2;
  v52 = a4;
  v51 = 0;
  v50 = 0;
  v49 = 16711681;
  v48 = a4 - (a1 + 42418) + 2;
  v47 = 16711686;
  v7 = (int)a3 + 1;
  sub_401698();
  v50 = &v47;
  v49 = v8;
  v48 = v8;
  v47 = v8;
  v46 = v8;
  (*(void (**)(void))(a2 + 24))();
  v32 = (*(int (**)(void))(a2 + 28))() + 6;
  v9 = __readfsword(9 * v32 - 2) + 2;
  v45 = v32;
  v44 = v32;
  v11 = (*(int (**)(void))a2)();
  v58 = a2;
  v59 = v9 - 1;
  v43 = v11;
  v42 = v10;
  v41 = &v42;
  v40 = 64;
  v50 = 0;
  v12 = (*(int (__cdecl **)(int, int, int))(a2 - 4 + 16))(-1, v49, v52);
  v13 = __readfsdword(v12 + 47) + v12;
  v49 += *(_DWORD *)(v13 + 3);
  v52 ^= *(_DWORD *)(v13 + 3);
  v36 = v44;
  v37 = v48;
  v35 = v39;
  for ( i = 0; i < 0x100; ++i )
    v38[i] = i;
  v16 = v35;
  if ( (_BYTE)v54 != 121 )
  {
    v16 = v53;
    do
    {
      (*(void (**)(void))(v16 + 24))();
      (*(void (**)(void))(v16 + 16))();
      (*(void (**)(void))(v16 + 24))();
      (*(void (**)(void))(v16 + 24))();
      (*(void (**)(void))(v16 + 24))();
      (*(void (**)(void))(v16 + 24))();
      (*(void (**)(void))(v16 + 24))();
      v17 = (*(int (**)(void))(v16 + 16))() + 1;
    }
    while ( (unsigned __int16)v17 < v18 );
  }
  v35 = v7;
  v34[1] = &v42;
  v34[0] = v16;
  v15 = v46;
  v19 = 0;
  v33 = 0;
  v20 = 0;
  do
  {
    v21 = (unsigned __int8)v38[v20];
    v22 = v33 + v21 + *(unsigned __int8 *)(v37 + v19);
    BYTE1(v22) = 0;
    ++v19;
    v33 = v22;
    if ( v19 >= v15 )
      v19 = 0;
    v38[v20++] = v38[v22];
    v28 = &v38[v22 - v19];
    BYTE1(v21) = v28[v19 + 1];
    *(_WORD *)&v28[v19] = v21;
  }
  while ( BYTE1(v20) != 1 );
  v24 = 0;
  v25 = 0;
  v26 = v47;
  for ( j = v36; v26; --v26 )
  {
    ++v25;
    BYTE1(v25) = 0;
    v23 = v38[v25];
    v29 = v24 + v23;
    BYTE1(v29) = 0;
    v30 = *((_BYTE *)&v34[5] + v29);
    v38[v25] = v30;
    *((_BYTE *)&v34[5] + v29) = v23;
    v5 = (unsigned __int8)(v23 + v30) + 20;
    v24 = v29;
    *(_WORD *)(j++ - 1) ^= *(_WORD *)((char *)v34 + v5) << 8;
  }
  result = v43;
  v53 = v43;
  return result;
}
// 401159: positive sp value C has been found
// 4010D0: could not find valid save-restore pair for esi
// 40121E: variable 'v8' is possibly undefined
// 4012B1: variable 'v10' is possibly undefined
// 401440: variable 'v18' is possibly undefined

//----- (00401698) --------------------------------------------------------
void sub_401698()
{
  JUMPOUT(0x4014BC);
}
// 4016C6: control flows out of bounds to 4014BC

// nfuncs=4 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
