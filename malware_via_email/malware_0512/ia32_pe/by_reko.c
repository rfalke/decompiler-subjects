// subject_data_0000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

byte g_b3E3000 = 0x46; // 003E3000
uint32 g_dw3E8803 = 0x5800; // 003E8803
Eq_32 g_t3E8810 = null; // 003E8810
Eq_32 g_t3E8814 = null; // 003E8814
Eq_33 g_t3E8818 = null; // 003E8818
Eq_3 g_t3E881C = // 003E881C
	{
		null
	};
// subject_data_0002.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw40FC7D = 0x00; // 0040FC7D
word32 g_dw40FC81 = 0x00; // 0040FC81
word32 g_dw40FC85 = 0x00; // 0040FC85
word32 g_dw40FC89 = 0x00; // 0040FC89
// subject_rdata.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__VirtualProtect = &g_t20BC; // 003E2000
<anonymous> * __imp__GetProcAddress = &g_t20CE; // 003E2004
<anonymous> * __imp__LoadLibraryA = &g_t20E0; // 003E2008
<anonymous> * __imp__GetModuleHandleA = &g_t20F0; // 003E200C
<anonymous> * __imp__ReadFile = &g_t2104; // 003E2010
<anonymous> * __imp__WriteFile = &g_t2110; // 003E2014
<anonymous> * __imp__CloseHandle = &g_t211C; // 003E2018
<anonymous> * __imp__CreateThread = &g_t212A; // 003E201C
<anonymous> * __imp__CreatePipe = &g_t213A; // 003E2020
<anonymous> * __imp__ExitProcess = &g_t2148; // 003E2024
byte g_b3E2030 = 0x6B; // 003E2030
byte g_b3E2040 = 0x47; // 003E2040
byte g_b3E2054 = 0x47; // 003E2054
word32 g_dw3E2090 = 8380; // 003E2090
word32 g_dw3E2094 = 8398; // 003E2094
word32 g_dw3E2098 = 0x20E0; // 003E2098
word32 g_dw3E209C = 0x20F0; // 003E209C
word32 g_dw3E20A0 = 0x2104; // 003E20A0
word32 g_dw3E20A4 = 0x2110; // 003E20A4
word32 g_dw3E20A8 = 0x211C; // 003E20A8
word32 g_dw3E20AC = 0x212A; // 003E20AC
word32 g_dw3E20B0 = 0x213A; // 003E20B0
word32 g_dw3E20B4 = 0x2148; // 003E20B4
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 003E1000: Register word32 fn003E1000(Stack Eq_3 dwArg04)
// Called from:
//      fn003E143B
word32 fn003E1000(Eq_3 dwArg04)
{
	return dwArg04 + Mem26[dwArg04 + 60:word32];
}

// 003E101F: void fn003E101F(Register word32 ecx, Stack (ptr32 byte) dwArg04, Stack Eq_3 dwArg08, Stack Eq_11 dwArg0C)
// Called from:
//      fn003E143B
void fn003E101F(word32 ecx, byte * dwArg04, Eq_3 dwArg08, Eq_11 dwArg0C)
{
	Eq_12 tLoc08;
	tLoc08 = (Eq_12) ecx;
	fn003E1942(dwArg08, dwArg04, dwArg0C);
	VirtualProtect(dwArg08, dwArg0C, 0x02, &tLoc08);
}

int32 g_t3E1050() = ??/* Unexpected function type (fn int32 ()) */ ; // 003E1050
int32 g_t3E1081() = ??/* Unexpected function type (fn int32 ()) */ ; // 003E1081
// 003E10B0: Register Eq_32 fn003E10B0(Stack Eq_33 dwArg04, Stack Eq_34 dwArg08, Stack Eq_34 dwArg0C)
// Called from:
//      fn003E1136
Eq_32 fn003E10B0(Eq_33 dwArg04, Eq_34 dwArg08, Eq_34 dwArg0C)
{
	Eq_32 eax_122;
	Eq_32 eax_21 = GetProcAddress(dwArg04, dwArg0C);
	if (fn003E1A30(dwArg08, &g_b3E2030) == 0x00)
	{
		if (fn003E19AF(dwArg0C, &g_b3E2040) == 0x00)
		{
			g_t3E8810 = eax_21;
			eax_122 = (Eq_32) &g_t3E1050;
			return eax_122;
		}
		if (fn003E19AF(dwArg0C, &g_b3E2054) == 0x00)
		{
			g_t3E8814 = eax_21;
			eax_122 = (Eq_32) &g_t3E1081;
			return eax_122;
		}
	}
	eax_122 = eax_21;
	return eax_122;
}

// 003E1122: Register byte fn003E1122(Stack ui32 dwArg04)
// Called from:
//      fn003E1136
byte fn003E1122(ui32 dwArg04)
{
	return (byte) ((dwArg04 & 0x80000000) != 0x00);
}

// 003E1136: void fn003E1136(Stack (ptr32 Eq_77) dwArg04, Stack Eq_3 dwArg08)
// Called from:
//      fn003E143B
void fn003E1136(struct Eq_77 * dwArg04, Eq_3 dwArg08)
{
	g_t3E8818 = GetModuleHandleA(null);
	g_t3E881C.u0 = (struct Eq_668 *) dwArg08;
	struct Eq_88 * dwLoc08_267 = dwArg08.u0 + dwArg04->dw0080;
	while (dwLoc08_267->dw000C != 0x00)
	{
		union Eq_93 * dwLoc10_275;
		Eq_34 ecx_65 = dwArg08.u0 + dwLoc08_267->dw000C;
		Eq_33 eax_70 = LoadLibraryA(ecx_65);
		if (dwLoc08_267->dw0004 == 0x00)
			dwLoc10_275 = (union Eq_93 *) (dwArg08.u0 + dwLoc08_267->dw0010);
		else
			dwLoc10_275 = (union Eq_93 *) (dwArg08.u0 + dwLoc08_267->dw0000);
		word32 * dwLoc18_279 = dwArg08.u0 + dwLoc08_267->dw0010;
		while (dwLoc10_275->u1 != 0x00)
		{
			Eq_32 dwLoc14_287;
			if ((word32) fn003E1122(dwLoc10_275->u1) != 0x00)
				dwLoc14_287 = GetProcAddress(eax_70, (word32) dwLoc10_275->u0);
			else
				dwLoc14_287 = fn003E10B0(eax_70, ecx_65, dwArg08.u0 + dwLoc10_275->u1 + 2);
			*dwLoc18_279 = (word32) dwLoc14_287;
			++dwLoc18_279;
			dwLoc10_275 = (union Eq_93 *) ((char *) dwLoc10_275 + 4);
		}
		++dwLoc08_267;
	}
}

// 003E1270: void fn003E1270(Register word32 ecx, Stack Eq_170 dwArg04, Stack Eq_3 dwArg08, Stack word32 dwArg0C)
// Called from:
//      fn003E12DC
void fn003E1270(word32 ecx, Eq_170 dwArg04, Eq_3 dwArg08, word32 dwArg0C)
{
	Eq_12 tLoc08;
	tLoc08 = (Eq_12) ecx;
	tLoc08 = (Eq_12) 0x00;
	do
		;
	while (ReadFile(dwArg04, dwArg08, dwArg0C - tLoc08, &tLoc08, null) != 0x00 && tLoc08 != dwArg0C);
}

// 003E12A6: void fn003E12A6(Stack Eq_170 dwArg04, Stack Eq_206 dwArg08, Stack Eq_12 dwArg0C)
// Called from:
//      fn003E12DC
void fn003E12A6(Eq_170 dwArg04, Eq_206 dwArg08, Eq_12 dwArg0C)
{
	ptr32 fp;
	do
		;
	while (WriteFile(dwArg04, dwArg08, dwArg0C, fp - 8, null) != 0x00 && dwArg0C != 0x00);
}

// 003E12DC: void fn003E12DC(Stack (ptr32 Eq_224) dwArg04, Stack word32 dwArg08, Stack uint32 dwArg0C)
// Called from:
//      fn003E143B
void fn003E12DC(struct Eq_224 * dwArg04, word32 dwArg08, uint32 dwArg0C)
{
	uint32 dwLoc08_82;
	for (dwLoc08_82 = 0x00; dwLoc08_82 < dwArg0C; dwLoc08_82 += 0x02)
	{
		fn003E12A6(dwArg04->t0004, dwArg08 + dwLoc08_82 * 0x04, 0x08);
		fn003E1270(dwArg08, dwArg04->t0000, dwArg08 + dwLoc08_82 * 0x04, 0x08);
	}
}

DWORD g_t3E1330(LPVOID lpThreadParameter) = ??/* Unexpected function type (fn DWORD (LPVOID)) */ ; // 003E1330
// 003E141E: void fn003E141E(Stack (ptr32 Eq_252) dwArg04)
// Called from:
//      fn003E143B
void fn003E141E(struct Eq_252 * dwArg04)
{
	CloseHandle(dwArg04->t0000);
	CloseHandle(dwArg04->t0004);
}

// 003E143B: Register word32 fn003E143B()
// Called from:
//      Win32CrtStartup
word32 fn003E143B()
{
	Eq_268 tLoc24;
	Eq_269 tLoc18;
	Eq_12 tLoc0C;
	struct Eq_271 * eax_18 = fn003E15D0()->ptr0030;
	if ((word32) eax_18->b0002 == 0x00)
	{
		g_dw40FC7D = 17757;
		g_dw40FC81 = 14108;
		g_dw40FC85 = 22572;
		g_dw40FC89 = 0x20CD;
		g_dw40FC89 += 19255;
		if (CreatePipe(&tLoc24, (char *) &tLoc18 + 4, null, 0x10) != 0x00 && CreatePipe(&tLoc18, (char *) (&tLoc24) + 4, null, 0x10) != 0x00)
		{
			Eq_170 eax_78 = CreateThread(null, 0x00, &g_t3E1330, &tLoc24, 0x00, &tLoc0C);
			fn003E12DC(&tLoc18, 0x003E3000, g_dw3E8803 >> 0x02);
			fn003E141E(&tLoc18);
			fn003E141E(&tLoc24);
			CloseHandle(eax_78);
			struct Eq_77 * eax_117 = fn003E1000(0x003E3000);
			if (eax_117 != null)
			{
				Eq_3 eax_133 = eax_117->t0034.u0;
				fn003E101F(0x003E3000, &g_b3E3000, eax_133, eax_117->t0054);
				fn003E15E0(eax_117, 0x003E3000, eax_133);
				struct Eq_77 * eax_172 = fn003E1000(eax_133);
				if (eax_172 != null)
				{
					fn003E1136(eax_172, eax_133);
					fn003E1776(eax_172, eax_133);
					eax_18->t0008.u0 = (struct Eq_668 *) eax_133;
					<anonymous> * ecx_228 = eax_133.u0 + eax_117->dw0028;
					ecx_228();
				}
			}
		}
	}
	return 0x00;
}

// 003E15B5: Register Eq_12 Win32CrtStartup()
Eq_12 Win32CrtStartup()
{
	ExitProcess(fn003E143B());
}

// 003E15D0: Register word32 fn003E15D0()
// Called from:
//      fn003E143B
word32 fn003E15D0()
{
	struct Eq_423 * fs;
	return fs->dw0018;
}

// 003E15E0: void fn003E15E0(Stack (ptr32 Eq_77) dwArg04, Stack word32 dwArg08, Stack Eq_3 dwArg0C)
// Called from:
//      fn003E143B
void fn003E15E0(struct Eq_77 * dwArg04, word32 dwArg08, Eq_3 dwArg0C)
{
	word16 ax_21 = dwArg04->w0006;
	word16 wLoc14_152;
	for (wLoc14_152 = 0x00; (word32) wLoc14_152 < (word32) ax_21; ++wLoc14_152)
	{
		Eq_11 dwLoc2C_159;
		Eq_11 eax_46 = (&dwArg04->dw0080 + 30)[((word32) wLoc14_152 *s 0x28 + 8) / 0x0084];
		Eq_11 v18_56 = (&dwArg04->dw0080 + 30)[((word32) wLoc14_152 *s 0x28 + 16) / 0x0084];
		if (eax_46 < v18_56)
			dwLoc2C_159 = eax_46;
		else
			dwLoc2C_159 = v18_56;
		fn003E1942(dwArg0C + Mem81[(CONVERT(wLoc14_152, word16, word32) *s 0x28 + 0x0C) + (dwArg04 + 0xF8):word32], dwArg08 + Mem97[(CONVERT(wLoc14_152, word16, word32) *s 0x28 + 20) + (dwArg04 + 0xF8):word32], dwLoc2C_159);
	}
}

// 003E16AB: Register ui32 fn003E16AB(Stack ui32 dwArg04)
// Called from:
//      fn003E1776
ui32 fn003E16AB(ui32 dwArg04)
{
	ui32 dwLoc08_180 = 0x00;
	if ((dwArg04 & 0x04000000) != 0x00)
		dwLoc08_180 = 0x0200;
	ui32 dwLoc08_189;
	if ((dwArg04 & 0x20000000) != 0x00)
	{
		if ((dwArg04 & 0x40000000) != 0x00)
		{
			if ((dwArg04 & 0x80000000) != 0x00)
				dwLoc08_189 = dwLoc08_180 | 0x40;
			else
				dwLoc08_189 = dwLoc08_180 | 0x20;
		}
		else if ((dwArg04 & 0x80000000) != 0x00)
			dwLoc08_189 = dwLoc08_180 | 0x80;
		else
			dwLoc08_189 = dwLoc08_180 | 0x10;
	}
	else if ((dwArg04 & 0x40000000) != 0x00)
	{
		if ((dwArg04 & 0x80000000) != 0x00)
			dwLoc08_189 = dwLoc08_180 | 0x04;
		else
			dwLoc08_189 = dwLoc08_180 | 0x02;
	}
	else if ((dwArg04 & 0x80000000) != 0x00)
		dwLoc08_189 = dwLoc08_180 | 0x08;
	else
		dwLoc08_189 = dwLoc08_180 | 0x01;
	return dwLoc08_189;
}

// 003E1776: void fn003E1776(Stack (ptr32 Eq_77) dwArg04, Stack Eq_3 dwArg08)
// Called from:
//      fn003E143B
void fn003E1776(struct Eq_77 * dwArg04, Eq_3 dwArg08)
{
	ptr32 fp;
	word16 ax_21 = dwArg04->w0006;
	word16 wLoc14_126;
	for (wLoc14_126 = 0x00; (word32) wLoc14_126 < (word32) ax_21; ++wLoc14_126)
		VirtualProtect(dwArg08 + Mem53[(CONVERT(wLoc14_126, word16, word32) *s 0x28 + 0x0C) + (dwArg04 + 0xF8):word32], Mem57[CONVERT(wLoc14_126, word16, word32) *s 0x28 + 8 + (dwArg04 + 0xF8):word32], fn003E16AB(Mem75[CONVERT(wLoc14_126, word16, word32) *s 0x28 + 36 + (dwArg04 + 0xF8):word32]), fp - 24);
}

// 003E1810: Register int32 fn003E1810(Stack int32 dwArg04)
// Called from:
//      fn003E1A30
int32 fn003E1810(int32 dwArg04)
{
	int32 eax_18;
	if (dwArg04 >= 0x41 && dwArg04 <= 0x5A)
		eax_18 = dwArg04 + 0x20;
	else
		eax_18 = dwArg04;
	return eax_18;
}

// 003E1942: void fn003E1942(Stack Eq_3 dwArg04, Stack (ptr32 byte) dwArg08, Stack Eq_11 dwArg0C)
// Called from:
//      fn003E101F
//      fn003E15E0
void fn003E1942(Eq_3 dwArg04, byte * dwArg08, Eq_11 dwArg0C)
{
	while (true)
	{
		--dwArg0C;
		if (dwArg0C == 0x00)
			break;
		dwArg04.u0->b0000 = *dwArg08;
		&dwArg04.u0->b0000 = (word32) dwArg04 + 1;
		++dwArg08;
	}
}

// 003E19AF: Register Eq_606 fn003E19AF(Stack Eq_34 dwArg04, Stack (ptr32 byte) dwArg08)
// Called from:
//      fn003E10B0
Eq_606 fn003E19AF(Eq_34 dwArg04, byte * dwArg08)
{
	while (true)
	{
		Eq_606 eax_26 = *dwArg04 - *dwArg08;
		Eq_606 dwLoc08_110 = eax_26;
		if (eax_26 != 0x00 || (int32) (*dwArg08) == 0x00)
			break;
		dwArg04 = (Eq_34) (dwArg04 + 1);
		++dwArg08;
	}
	if (eax_26 < 0x00)
		dwLoc08_110.u0 = ~0x00;
	else if (eax_26 > 0x00)
		dwLoc08_110.u0 = 0x01;
	return dwLoc08_110;
}

// 003E1A30: Register word32 fn003E1A30(Stack Eq_34 dwArg04, Stack (ptr32 byte) dwArg08)
// Called from:
//      fn003E10B0
word32 fn003E1A30(Eq_34 dwArg04, byte * dwArg08)
{
	do
	{
		word32 eax_19 = fn003E1810((word32) *dwArg04);
		dwArg04 = (Eq_34) (dwArg04 + 1);
		word32 eax_45 = fn003E1810((word32) *dwArg08);
		++dwArg08;
	} while (eax_19 != 0x00 && eax_19 == eax_45);
	return eax_19 - eax_45;
}

