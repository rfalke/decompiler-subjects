// subject_rsec.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw409078 = 37037; // 00409078
word32 g_dw40907C = 0x90BF; // 0040907C
word32 g_dw409080 = 37070; // 00409080
word32 g_dw409084 = 0x90E1; // 00409084
word32 g_dw409088 = 0x90F3; // 00409088
word32 g_dw40908C = 0x9106; // 0040908C
word32 g_dw409094 = 0x9121; // 00409094
word32 g_dw409098 = 0x9131; // 00409098
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401005: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	word32 ebp;
	word32 dwLoc2C;
	word32 ebp_107;
	fn004010CA(ebp, (word16) dwLoc2C, out ebp_107);
	word32 ebp_118;
	return fn004010CA(ebp_107, 0x00, out ebp_118);
}

// 004010CA: Register word32 fn004010CA(Register word32 ebp, Stack word16 wArg00, Register out ptr32 ebpOut)
// Called from:
//      Win32CrtStartup
word32 fn004010CA(word32 ebp, word16 wArg00, ptr32 & ebpOut)
{
	ptr32 fp;
	struct Eq_21 * fs;
	word32 dwArg00;
	word32 dwLoc30;
	struct Eq_24 * dwLoc0134;
	int32 dwLoc0130;
	word16 eax_16_16_22 = SLICE(dwArg00, word16, 16);
	word32 eax_36 = SEQ(eax_16_16_22, 0x00);
	struct Eq_31 * ebx_112;
	word32 ecx_113;
	up32 eax_111 = fn00401697((word16) dwLoc30, out ecx_113, out ebx_112);
	word32 eax_136;
	word32 ecx_138;
	ebx_112->ptr0018();
	struct Eq_48 * esp_143;
	<unknown> Eq_21::* eax_144;
	word32 ecx_146;
	ebx_112->ptr001C();
	word16 ecx_16_16_167 = SLICE(ecx_146, word16, 16);
	uint32 esi_157 = (uint32) ((&(fs->*((char *) eax_144 + 4)))[(char *) eax_144 + 6].w0000 + 0x02);
	esp_143->ptrFFFFFFFC = (<unknown> Eq_21::*) ((char *) eax_144 + 6);
	esp_143->ptrFFFFFFF8 = (<unknown> Eq_21::*) ((char *) eax_144 + 6);
	struct Eq_76 * esp_168;
	struct Eq_31 * eax_169;
	word32 ecx_171;
	ebx_112->ptr0000();
	esp_168->ptr0038 = ebx_112;
	esp_168->dw003C = esi_157 - 0x01;
	esp_168->ptrFFFFFFFC = ebx_112;
	esp_168->ptrFFFFFFFC -= 0x04;
	word16 ecx_16_16_215 = SLICE(ecx_171, word16, 16);
	struct Eq_31 * edi_188 = esp_168->ptrFFFFFFFC;
	esp_168->ptrFFFFFFFC = eax_169;
	esp_168->dwFFFFFFF8 = ecx_171;
	esp_168->ptrFFFFFFF4 = esp_168 - 8;
	esp_168->dwFFFFFFF0 = 0x40;
	esp_168->dwFFFFFFEC = esp_168->dw0020;
	esp_168->dwFFFFFFE8 = esp_168->dw0014;
	esp_168->dw0018 = 0x00;
	esp_168->dwFFFFFFE4 = ~0x00;
	struct Eq_142 * esp_216;
	struct Eq_143 Eq_21::* eax_217;
	edi_188->ptr0010();
	struct Eq_147 * eax_223 = eax_217 + (fs->*eax_217).dw002F / 0x0033;
	esp_216->dw0030 += eax_223->dw0003;
	esp_216->ptrFFFFFFFC = eax_223;
	esp_216->ptr0000 = esp_216->ptrFFFFFFFC;
	esp_216->ptr0004 = esp_216->ptr0000;
	struct Eq_147 * edi_249 = esp_216->ptr0008;
	esp_216->ptr0008 = esp_216->ptr0004;
	esp_216->ptr000C = esp_216->ptr0008;
	struct Eq_147 * eax_261 = esp_216->ptr000C;
	esp_216->ptr0010 = (struct Eq_147 *) &eax_261->dw0003;
	struct Eq_147 * eax_270 = esp_216->ptr0010;
	Eq_203 ecx_272 = eax_270->t0000.u1;
	esp_216->ptr0010 = eax_270;
	esp_216->dw003C = esp_216->dw003C ^ ecx_272;
	struct Eq_147 * eax_283 = esp_216->ptr001C;
	word32 ecx_284 = esp_216->dw002C;
	esp_216->ptr0010 = eax_283;
	word16 ecx_16_16_364 = SLICE(ecx_284, word16, 16);
	struct Eq_147 * eax_288 = esp_216->ptr0010;
	esp_216->ptrFFFFFF0C = eax_288;
	esp_216->dwFFFFFF10 = ecx_284;
	esp_216->ptrFFFFFF08 = eax_288;
	esp_216->ptrFFFFFF08 = edi_249;
	struct Eq_147 * eax_301 = null;
	do
	{
		esp_216->ptrFFFFFF04 = eax_301;
		struct Eq_147 * eax_311 = esp_216->ptrFFFFFF04;
		eax_301[(esp_216 - 0xEC) / 7] = (struct Eq_147) (byte) eax_311;
		esp_216->ptrFFFFFF04 = eax_311;
		esp_216->ptrFFFFFF04 = (struct Eq_147 *) ((char *) &esp_216->ptrFFFFFF04->t0000 + 1);
		struct Eq_147 * eax_325 = esp_216->ptrFFFFFF04;
		esp_216->ptrFFFFFF04 = eax_325;
		eax_301 = esp_216->ptrFFFFFF04;
	} while (eax_325 < (struct Eq_147 *) 0x0100);
	esp_216->ptrFFFFFF04 = eax_301;
	esp_216->ptrFFFFFF08 = esp_216->ptrFFFFFF04;
	esp_216->ptrFFFFFF08 = (struct Eq_147 *) (&esp_216->dw003C + 2);
	struct Eq_147 * eax_350 = esp_216->ptrFFFFFF08;
	esp_216->ptrFFFFFF08 = eax_350;
	struct Eq_147 * eax_356 = esp_216->ptrFFFFFF08;
	if (eax_350->t0000.u0 != 121)
	{
		struct Eq_312 * edi_359 = eax_356->ptrFFFFFFFC;
		do
		{
			struct Eq_316 * esp_370;
			word32 eax_371;
			word32 ecx_373;
			edi_359->ptr0018();
			esp_370->dwFFFFFFFC = eax_371;
			word32 eax_379 = esp_370->dwFFFFFFFC;
			__syscall<byte>(0x00);
			esp_370->dwFFFFFFFC = eax_379;
			++esp_370->dwFFFFFFFC;
			struct Eq_345 * esp_394;
			word32 eax_395;
			word32 ecx_397;
			edi_359->ptr0018();
			esp_394->dwFFFFFFFC = eax_395;
			struct Eq_354 * esp_406;
			word32 eax_407;
			word32 ecx_409;
			edi_359->ptr0018();
			esp_406->dwFFFFFFFC = eax_407;
			struct Eq_363 * esp_418;
			word32 eax_419;
			word32 ecx_421;
			edi_359->ptr0018();
			esp_418->dwFFFFFFFC = eax_419;
			struct Eq_372 * esp_430;
			word32 eax_431;
			word32 ecx_433;
			edi_359->ptr0018();
			esp_430->dwFFFFFFFC = eax_431;
			struct Eq_381 * esp_442;
			word32 eax_443;
			word32 ecx_445;
			edi_359->ptr0018();
			esp_442->dwFFFFFFFC = eax_443;
			struct Eq_390 * esp_454;
			struct Eq_147 * eax_455;
			word32 ecx_457;
			edi_359->ptr0010();
			word16 cx_474 = (word16) ecx_457;
			ecx_16_16_364 = SLICE(ecx_457, word16, 16);
			esp_454->ptrFFFFFFFC = eax_455;
			esp_454->ptrFFFFFFFC = (struct Eq_147 *) ((char *) &esp_454->ptrFFFFFFFC->t0000 + 1);
			struct Eq_147 * eax_471 = esp_454->ptrFFFFFFFC;
			cup16 ax_475 = (word16) eax_471 - cx_474;
			esp_454->ptrFFFFFFFC = SEQ(SLICE(eax_471, word16, 16), ax_475);
			eax_356 = esp_454->ptrFFFFFFFC;
		} while (ax_475 < 0x00);
		esp_454->ptrFFFFFFFC = eax_356;
	}
	int32 esi_522 = 0x00;
	int32 ebp_528 = 0x00;
	Eq_431 eax_544 = 0x00;
	do
	{
		word32 ebx_549 = (word32) (fp - 300)[ebp_528];
		byte bl_644 = (byte) ebx_549;
		word32 edx_562 = (word32) *((word32) eax_544 + dwLoc0130);
		word32 ecx_575 = ebx_549 + esi_522;
		word32 edx_577 = edx_562 + ecx_575;
		byte dl_589 = (byte) edx_577;
		word16 edx_16_16_590 = SLICE(edx_577, word16, 16);
		int32 edx_591 = SEQ(edx_16_16_590, 0x00, dl_589);
		esi_522 = edx_591;
		Eq_431 eax_603 = (word32) eax_544 + 1;
		if ((word32) eax_544 + 1 >= eax_111)
			eax_603.u0 = 0x00;
		byte dl_623 = *((word32) (fp - 300) + edx_591);
		*((word32) (fp - 300) + ebp_528) = (ptr32) dl_623;
		++ebp_528;
		ptr32 edx_628 = fp - 300 + edx_591;
		ptr32 edx_630 = edx_628 - eax_603;
		*((word32) eax_603.u0 + edx_630) = SEQ(*((word32) ((word32) eax_603.u0 + 1) + edx_630), bl_644);
		byte bh_648 = SLICE(ebp_528, byte, 8);
		eax_544 = eax_603;
	} while (bh_648 != 0x01);
	word32 esi_663 = 0x00;
	ptr32 ebp_675 = fp - 40;
	struct Eq_24 * edi_681 = dwLoc0134;
	if (fp > 0x28)
	{
		int32 eax_696 = 0x00;
		do
		{
			int32 eax_699 = eax_696 + 0x01;
			int32 eax_710 = SEQ(SLICE(eax_699, word16, 16), 0x00, (byte) eax_699);
			byte cl_715 = (fp - 300)[eax_710];
			uint32 ebx_727 = (uint32) cl_715;
			uint32 ebx_729 = ebx_727 + esi_663;
			word32 ebx_746 = SEQ(SLICE(ebx_729, word16, 16), 0x00, (byte) ebx_729);
			byte dh_753 = *((word32) (fp - 320) + (ebx_746 + 20));
			*((word32) (fp - 300) + eax_710) = (ptr32) dh_753;
			*((word32) (fp - 320) + (ebx_746 + 20)) = (ptr32) cl_715;
			word32 edx_786 = (word32) dh_753;
			byte dl_787 = (byte) edx_786;
			word24 edx_24_8_790 = SLICE(edx_786, word24, 8);
			word32 edx_791 = SEQ(edx_24_8_790, dl_787 + cl_715);
			word32 ecx_799 = *((word32) (fp - 320) + (edx_791 + 0x14));
			ui16 cx_809 = (word16) ecx_799 << 0x08;
			edi_681->wFFFFFFFF = edi_681->wFFFFFFFF ^ cx_809;
			esi_663 = ebx_746;
			eax_696 = eax_710;
			++edi_681;
			--ebp_675;
		} while (ebp_675 != 0x00);
	}
	ebpOut = ebp + 0x01;
	return 0x00FF0006;
}

// 00401697: Register ptr32 fn00401697(Stack word16 wArg00, Register out Eq_37 ecxOut, Register out ptr32 ebxOut)
// Called from:
//      fn004010CA
ptr32 fn00401697(word16 wArg00, union Eq_37 & ecxOut, ptr32 & ebxOut)
{
	word32 dwArg00;
	word32 eax_156 = dwArg00;
	while (true)
	{
		word16 eax_16_16_38 = SLICE(eax_156, word16, 16);
		word16 * eax_47 = SEQ(eax_16_16_38, 0x00);
		word16 ax_53 = *eax_47;
		word32 eax_57 = SEQ(eax_16_16_38, ax_53 + 42421);
		if (ax_53 == 23117)
			break;
		eax_156 = eax_57 - 0x00010000;
	}
	struct Eq_592 * eax_70;
	__btc<word32>(eax_57, 0x01, out eax_70);
	Eq_37 ecx_118 = eax_70[(&(eax_70 + eax_70->dw003C / 64)->dw003C)[0x0011] / 64];
	word32 eax_124 = eax_70 + ecx_118;
	ecxOut = ecx_118;
	ebxOut = eax_124 + 0x04;
	return eax_124 + 0x04;
}

