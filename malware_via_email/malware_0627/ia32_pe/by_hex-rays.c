/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall start@<eax>(unsigned int@<ecx>, int@<ebp>);
// int __usercall sub_41201F@<eax>(unsigned int@<ecx>, int@<ebp>, _BYTE *@<edi>, _BYTE *@<esi>);
_DWORD sub_412090(); // weak
int __cdecl sub_412092(int (__thiscall *)(int));

//-------------------------------------------------------------------------
// Data declarations

int dword_401000[98]; // weak
_BYTE byte_411C2C[853] =
{
  -95,
  28,
  -24,
  48,
  64,
  1,
  105,
  -64,
  -3,
  67,
  3,
  -64,
  5,
  -61,
  56,
  -98,
  38,
  40,
  -93,
  16,
  3,
  -63,
  -8,
  16,
  37,
  -1,
  127,
  -121,
  0,
  -61,
  -117,
  68,
  36,
  85,
  4,
  18,
  -23,
  85,
  -20,
  -20,
  81,
  7,
  83,
  86,
  87,
  51,
  -1,
  49,
  -119,
  125,
  -4,
  -44,
  21,
  28,
  96,
  32,
  40,
  -117,
  -16,
  104,
  -56,
  -64,
  55,
  15,
  -73,
  69,
  8,
  80,
  100,
  86,
  38,
  24,
  33,
  -40,
  83,
  -111,
  21,
  20,
  50,
  80,
  14,
  16,
  33,
  59,
  -57,
  -119,
  -118,
  60,
  116,
  42,
  22,
  17,
  12,
  13,
  87,
  104,
  128,
  -84,
  -64,
  106,
  2,
  -15,
  -80,
  18,
  17,
  64,
  -1,
  117,
  108,
  12,
  -118,
  52,
  8,
  -120,
  -125,
  -8,
  -5,
  -65,
  84,
  1,
  117,
  4,
  51,
  -64,
  -21,
  65,
  -48,
  -37,
  59,
  3,
  -9,
  118,
  24,
  -24,
  97,
  -1,
  28,
  2,
  -103,
  -71,
  27,
  1,
  82,
  -15,
  -7,
  -117,
  128,
  -116,
  48,
  20,
  3,
  67,
  59,
  -34,
  30,
  114,
  -24,
  -115,
  -52,
  -4,
  87,
  -31,
  117,
  108,
  8,
  125,
  120,
  4,
  -118,
  46,
  9,
  17,
  103,
  122,
  57,
  -79,
  -4,
  15,
  -108,
  -40,
  95,
  94,
  41,
  91,
  -55,
  -78,
  28,
  -127,
  -116,
  100,
  12,
  124,
  86,
  112,
  -66,
  96,
  4,
  12,
  87,
  -115,
  -123,
  -100,
  111,
  -13,
  -94,
  -90,
  80,
  106,
  96,
  41,
  21,
  44,
  -84,
  13,
  61,
  40,
  13,
  -120,
  44,
  -32,
  -5,
  78,
  -116,
  -41,
  20,
  -68,
  70,
  -9,
  0,
  128,
  125,
  -2,
  92,
  -117,
  53,
  36,
  -59,
  61,
  -65,
  -32,
  69,
  -31,
  116,
  10,
  34,
  37,
  87,
  5,
  -42,
  33,
  10,
  104,
  -48,
  -80,
  47,
  29,
  128,
  -67,
  -36,
  -119,
  92,
  -95,
  66,
  60,
  32,
  33,
  -2,
  53,
  -31,
  -95,
  57,
  16,
  52,
  97,
  48,
  9,
  106,
  101,
  -24,
  50,
  -69,
  -2,
  16,
  89,
  -109,
  63,
  -67,
  10,
  -125,
  80,
  -114,
  -54,
  38,
  -111,
  32,
  65,
  -80,
  6,
  -81,
  114,
  68,
  8,
  106,
  -37,
  5,
  40,
  -60,
  70,
  -93,
  -28,
  31,
  -56,
  22,
  60,
  -119,
  61,
  -73,
  35,
  45,
  116,
  83,
  20,
  52,
  -24,
  108,
  69,
  118,
  117,
  34,
  -58,
  3,
  21,
  56,
  53,
  124,
  80,
  81,
  90,
  18,
  9,
  117,
  88,
  -106,
  -123,
  18,
  -64,
  116,
  5,
  84,
  77,
  19,
  70,
  21,
  35,
  52,
  17,
  20,
  117,
  25,
  15,
  106,
  1,
  -25,
  48,
  72,
  18,
  2,
  -12,
  -48,
  -112,
  49,
  48,
  -62,
  16,
  0,
  -76,
  56,
  48,
  64,
  50,
  -112,
  9,
  116,
  36,
  16,
  67,
  85,
  39,
  108,
  -105,
  -50,
  -114,
  105,
  -49,
  109,
  10,
  97,
  8,
  -97,
  118,
  -113,
  101,
  32,
  -17,
  69,
  -17,
  110,
  -17,
  99,
  -17,
  114,
  -17,
  121,
  -20,
  112,
  43,
  101,
  -4,
  100,
  -49,
  38,
  87,
  -19,
  111,
  35,
  -101,
  76,
  68,
  13,
  -42,
  47,
  -27,
  22,
  20,
  -51,
  48,
  98,
  74,
  -97,
  10,
  83,
  -39,
  107,
  89,
  78,
  -77,
  39,
  92,
  46,
  -13,
  67,
  -13,
  90,
  118,
  51,
  -88,
  49,
  112,
  42,
  -1,
  -61,
  -123,
  60,
  53,
  100,
  -89,
  46,
  -72,
  83,
  14,
  -54,
  70,
  -127,
  -97,
  103,
  -103,
  104,
  21,
  115,
  -7,
  66,
  84,
  -111,
  14,
  -124,
  107,
  25,
  3,
  117,
  -8,
  101,
  114,
  -10,
  111,
  0,
  110,
  102,
  105,
  103,
  57,
  120,
  46,
  100,
  113,
  108,
  -31,
  16,
  66,
  73,
  78,
  24,
  65,
  82,
  89,
  16,
  70,
  86,
  3,
  80,
  114,
  111,
  116,
  101,
  99,
  -101,
  46,
  -93,
  120,
  -74,
  49,
  96,
  92,
  0,
  0,
  -32,
  1,
  -32,
  2,
  -32,
  32,
  -30,
  16,
  -50,
  17,
  4,
  13,
  -24,
  22,
  -66,
  17,
  125,
  -92,
  14,
  123,
  40,
  -125,
  70,
  34,
  1,
  -116,
  40,
  9,
  16,
  -119,
  32,
  22,
  73,
  -119,
  20,
  -64,
  -62,
  -97,
  1,
  21,
  128,
  3,
  111,
  8,
  20,
  7,
  -112,
  2,
  102,
  19,
  -64,
  2,
  -48,
  16,
  9,
  112,
  85,
  -1,
  3,
  -68,
  8,
  82,
  7,
  65,
  2,
  6,
  19,
  10,
  -114,
  66,
  40,
  1,
  119,
  1,
  108,
  112,
  16,
  40,
  -97,
  -47,
  4,
  8,
  16,
  121,
  -103,
  -125,
  -12,
  68,
  -9,
  -3,
  38,
  16,
  34,
  -124,
  16,
  -30,
  -9,
  -114,
  -48,
  2,
  16,
  -100,
  -111,
  79,
  -67,
  24,
  8,
  -16,
  -85,
  1,
  25,
  -46,
  15,
  -113,
  3,
  128,
  92,
  120,
  -64,
  84,
  7,
  -80,
  3,
  -83,
  4,
  82,
  3,
  56,
  -22,
  -81,
  0,
  0,
  1,
  -32,
  32,
  112,
  64,
  14,
  75,
  69,
  82,
  78,
  96,
  76,
  51,
  50,
  46,
  100,
  113,
  108,
  -32,
  70,
  -24,
  111,
  6,
  115,
  101,
  72,
  97,
  110,
  24,
  -19,
  -64,
  90,
  114,
  62,
  105,
  116,
  58,
  70,
  110,
  21,
  -66,
  -65,
  41,
  97,
  11,
  28,
  65,
  29,
  86,
  -97,
  122,
  71,
  111,
  102,
  82,
  -25,
  115,
  81,
  117,
  114,
  99,
  -97,
  54,
  79,
  58,
  -87,
  107,
  13,
  98,
  97,
  100,
  22,
  16,
  73,
  105,
  110,
  -74,
  110,
  122,
  74,
  61,
  116,
  77,
  -66,
  100,
  41,
  108,
  93,
  -77,
  34,
  70,
  -15,
  112,
  121,
  73,
  82,
  -101,
  -28,
  116,
  70,
  68,
  -64,
  36,
  87,
  -63,
  107,
  111,
  119,
  115,
  68,
  -33,
  62,
  -28,
  99,
  -7,
  -22,
  121,
  -91,
  57,
  -96,
  45,
  20,
  78,
  97,
  109,
  76,
  -122,
  80,
  114,
  -16,
  -14,
  100,
  -29,
  -100,
  76,
  115,
  106,
  118,
  31,
  76,
  105,
  98,
  59,
  83,
  47,
  62,
  84,
  80,
  -109,
  67,
  -49,
  -18,
  110,
  52,
  13,
  24,
  76,
  97,
  -68,
  69,
  114,
  -36,
  92,
  -21,
  -59,
  -116,
  77,
  117,
  8,
  120,
  -52,
  78,
  3,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
}; // weak
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);


//----- (00412000) --------------------------------------------------------
int __usercall start@<eax>(unsigned int a1@<ecx>, int a2@<ebp>)
{
  return sub_41201F(a1, a2, dword_401000, byte_411C2C);
}
// 401000: using guessed type int dword_401000[98];
// 411C2C: using guessed type _BYTE byte_411C2C[853];

//----- (0041201F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_41201F@<eax>(unsigned int a1@<ecx>, int a2@<ebp>, _BYTE *a3@<edi>, _BYTE *a4@<esi>)
{
  char v4; // dl
  int v5; // ebx
  unsigned int v6; // eax
  int v7; // ecx
  int v8; // eax
  char v9; // tt
  int v10; // eax
  int v11; // ecx
  char v12; // cf
  unsigned int v13; // eax
  const CHAR *v14; // edi
  _DWORD **v15; // edi
  int *v16; // esi
  HMODULE LibraryA; // ebp
  bool v18; // zf
  _DWORD *v19; // edi
  int v20; // eax
  int result; // eax
  void (__fastcall *v22)(unsigned int, char); // [esp-Ch] [ebp-Ch]
  _WORD *v23; // [esp-8h] [ebp-8h]
  const CHAR *v24; // [esp-8h] [ebp-8h]
  const CHAR *v25; // [esp-4h] [ebp-4h]

  v4 = 0x80;
LABEL_2:
  *a3++ = *a4++;
  v5 = 2;
  while ( 1 )
  {
    v22(a1, v4);
    if ( !v12 )
      goto LABEL_2;
    ((void (__thiscall *)(_DWORD))v22)(0);
    if ( !v12 )
    {
      v10 = sub_412092((int (__thiscall *)(int))v22);
      if ( v11 == v5 )
      {
        sub_412090();
LABEL_20:
        v8 = a2;
        LOBYTE(v5) = 1;
        goto LABEL_21;
      }
      ++a4;
      v13 = ((int (__thiscall *)(int))sub_412090)(v10);
      if ( v13 < 0x7D00 )
      {
        if ( BYTE1(v13) >= 5u )
        {
LABEL_18:
          ++a1;
          goto LABEL_19;
        }
        if ( v13 > 0x7F )
        {
LABEL_19:
          a2 = v13;
          goto LABEL_20;
        }
      }
LABEL_17:
      ++a1;
      goto LABEL_18;
    }
    v6 = ((int (*)(void))v22)();
    if ( !v12 )
      break;
    LOBYTE(v5) = 2;
    a1 = v7 + 1;
    do
    {
      v8 = ((int (__thiscall *)(unsigned int))v22)(a1);
      v9 = v12 + v8;
      v12 = __CFADD__(v12, (_BYTE)v8) | __CFADD__((_BYTE)v8, v12 + v8);
      LOBYTE(v8) = v8 + v9;
    }
    while ( !v12 );
    if ( (_BYTE)v8 )
    {
LABEL_21:
      qmemcpy(a3, &a3[-v8], a1);
      a3 += a1;
      a1 = 0;
    }
    else
    {
      *a3++ = 0;
    }
  }
  LOBYTE(v6) = *a4++;
  v12 = v6 & 1;
  v13 = v6 >> 1;
  if ( v13 )
  {
    a1 = v7 + v12 + v7;
    goto LABEL_17;
  }
  if ( *v23 == 1 || *v23 != 2 )
    JUMPOUT(0x41200F);
  v14 = v25;
LABEL_27:
  v15 = (_DWORD **)(v14 + 1);
  v16 = *v15;
  v14 = (const CHAR *)(v15 + 1);
  LibraryA = LoadLibraryA(v14);
  do
  {
    do
      v18 = *v14++ == 0;
    while ( !v18 );
    v18 = (*v14)-- == 1;
    if ( v18 )
      goto LABEL_27;
    v18 = (*v14)-- == 1;
    if ( v18 )
    {
      v19 = v14 + 1;
      v24 = (const CHAR *)*v19;
      v14 = (const CHAR *)(v19 + 1);
    }
    else
    {
      v18 = (*v14)-- == 1;
      if ( v18 )
        JUMPOUT(0x401189);
      v24 = v14;
    }
    v20 = ((int (__cdecl *)(HMODULE, const CHAR *))*(&LoadLibraryA + 1))(LibraryA, v24);
    v18 = (v20 | *v16) == 0;
    *v16 |= v20;
    result = *v16++;
  }
  while ( !v18 );
  return result;
}
// 4120BF: positive sp value C has been found
// 4120B9: control flows out of bounds to 41200F
// 4120E1: control flows out of bounds to 401189
// 412026: variable 'v22' is possibly undefined
// 412026: variable 'a1' is possibly undefined
// 412026: variable 'v4' is possibly undefined
// 412029: variable 'v12' is possibly undefined
// 41203B: variable 'v7' is possibly undefined
// 41204F: variable 'v11' is possibly undefined
// 4120A2: variable 'v23' is possibly undefined
// 4120BE: variable 'v25' is possibly undefined
// 412090: using guessed type _DWORD sub_412090();

//----- (00412092) --------------------------------------------------------
int __cdecl sub_412092(int (__thiscall *a1)(int))
{
  int v1; // ecx
  int v2; // ecx
  char v3; // cf
  int v4; // ecx
  int result; // eax

  v2 = v1 + 1;
  do
  {
    a1(v2);
    result = a1(v4 + v3 + v4);
  }
  while ( v3 );
  return result;
}
// 412092: variable 'v1' is possibly undefined
// 412093: variable 'v2' is possibly undefined
// 412097: variable 'v4' is possibly undefined
// 412097: variable 'v3' is possibly undefined

// nfuncs=4 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
