// subject_rsec.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw40A078 = 0xA0AD; // 0040A078
word32 g_dw40A07C = 41151; // 0040A07C
word32 g_dw40A080 = 41166; // 0040A080
word32 g_dw40A084 = 0xA0E1; // 0040A084
word32 g_dw40A088 = 0xA0F3; // 0040A088
word32 g_dw40A08C = 41222; // 0040A08C
word32 g_dw40A094 = 0xA120; // 0040A094
word32 g_dw40A098 = 0xA12C; // 0040A098
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401004: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	word32 ebp;
	word32 dwLoc2C;
	word32 ebp_106;
	fn004010D0(ebp, (word16) dwLoc2C, out ebp_106);
	word32 ebp_117;
	return fn004010D0(ebp_106, 0x00, out ebp_117);
}

// 004010D0: Register word32 fn004010D0(Register word32 ebp, Stack word16 wArg00, Register out ptr32 ebpOut)
// Called from:
//      Win32CrtStartup
word32 fn004010D0(word32 ebp, word16 wArg00, ptr32 & ebpOut)
{
	ptr32 fp;
	struct Eq_21 * fs;
	word32 dwArg00;
	word32 dwLoc30;
	int32 dwLoc0130;
	word16 eax_16_16_22 = SLICE(dwArg00, word16, 16);
	word32 eax_36 = SEQ(eax_16_16_22, 0x00);
	struct Eq_30 * ebx_116;
	word32 ecx_117;
	word32 eax_115 = fn0040169A((word16) dwLoc30, out ecx_117, out ebx_116);
	word32 eax_140;
	word32 ecx_142;
	ebx_116->ptr0018();
	struct Eq_47 * esp_147;
	<unknown> Eq_21::* eax_148;
	word32 ecx_150;
	ebx_116->ptr001C();
	word16 ecx_16_16_171 = SLICE(ecx_150, word16, 16);
	uint32 esi_161 = (uint32) ((&(fs->*((char *) eax_148 + 4)))[(char *) eax_148 + 6].w0000 + 0x02);
	esp_147->ptrFFFFFFFC = (<unknown> Eq_21::*) ((char *) eax_148 + 6);
	esp_147->ptrFFFFFFF8 = (<unknown> Eq_21::*) ((char *) eax_148 + 6);
	struct Eq_75 * esp_172;
	struct Eq_30 * eax_173;
	word32 ecx_175;
	ebx_116->ptr0000();
	esp_172->ptr0038 = ebx_116;
	esp_172->dw003C = esi_161 - 0x01;
	esp_172->ptrFFFFFFFC = ebx_116;
	esp_172->ptrFFFFFFFC -= 0x04;
	word16 ecx_16_16_219 = SLICE(ecx_175, word16, 16);
	struct Eq_30 * edi_192 = esp_172->ptrFFFFFFFC;
	esp_172->ptrFFFFFFFC = eax_173;
	esp_172->dwFFFFFFF8 = ecx_175;
	esp_172->ptrFFFFFFF4 = esp_172 - 8;
	esp_172->dwFFFFFFF0 = 0x40;
	esp_172->dwFFFFFFEC = esp_172->dw0020;
	esp_172->dwFFFFFFE8 = esp_172->dw0014;
	esp_172->dw0018 = 0x00;
	esp_172->dwFFFFFFE4 = ~0x00;
	struct Eq_141 * esp_220;
	struct Eq_142 Eq_21::* eax_221;
	edi_192->ptr0010();
	struct Eq_146 * eax_227 = eax_221 + (fs->*eax_221).dw002F / 0x0033;
	word32 ecx_230 = eax_227->dw0003;
	esp_220->dw0030 += ecx_230;
	esp_220->ptr0000 = eax_227;
	esp_220->ptr0004 = esp_220->ptr0000;
	struct Eq_146 * edi_248 = esp_220->ptr0008;
	esp_220->ptr0008 = esp_220->ptr0004;
	esp_220->ptr000C = esp_220->ptr0008;
	struct Eq_146 * eax_260 = esp_220->ptr000C;
	esp_220->ptr0010 = (struct Eq_146 *) &eax_260->dw0003;
	struct Eq_146 * eax_269 = esp_220->ptr0010;
	Eq_197 ecx_271 = eax_269->t0000.u1;
	esp_220->ptr0010 = eax_269;
	struct Eq_146 * eax_275 = esp_220->ptr0010;
	esp_220->dw003C = esp_220->dw003C ^ ecx_271;
	esp_220->ptr0010 = eax_275;
	esp_220->ptr0010 = esp_220->ptr001C;
	word32 ecx_291 = esp_220->dw002C;
	esp_220->ptr0010 = esp_220->ptr0010;
	esp_220->ptrFFFFFF08 = esp_220->ptr0010;
	struct Eq_146 * eax_302 = esp_220->ptrFFFFFF08;
	esp_220->ptrFFFFFF0C = eax_302;
	esp_220->ptrFFFFFF08 = eax_302;
	struct Eq_146 * eax_308 = esp_220->ptrFFFFFF08;
	esp_220->dwFFFFFF10 = ecx_291;
	esp_220->ptrFFFFFF08 = eax_308;
	esp_220->ptrFFFFFF08 = edi_248;
	word16 ecx_16_16_381 = SLICE(ecx_291, word16, 16);
	struct Eq_146 * eax_318 = null;
	do
	{
		esp_220->ptrFFFFFF04 = eax_318;
		struct Eq_146 * eax_328 = esp_220->ptrFFFFFF04;
		eax_318[(esp_220 - 0xEC) / 7] = (struct Eq_146) (byte) eax_328;
		esp_220->ptrFFFFFF04 = eax_328;
		esp_220->ptrFFFFFF04 = (struct Eq_146 *) ((char *) &esp_220->ptrFFFFFF04->t0000 + 1);
		struct Eq_146 * eax_342 = esp_220->ptrFFFFFF04;
		esp_220->ptrFFFFFF04 = eax_342;
		eax_318 = esp_220->ptrFFFFFF04;
	} while (eax_342 < (struct Eq_146 *) 0x0100);
	esp_220->ptrFFFFFF04 = eax_318;
	esp_220->ptrFFFFFF08 = esp_220->ptrFFFFFF04;
	esp_220->ptrFFFFFF08 = (struct Eq_146 *) (&esp_220->dw003C + 2);
	struct Eq_146 * eax_367 = esp_220->ptrFFFFFF08;
	esp_220->ptrFFFFFF08 = eax_367;
	struct Eq_146 * eax_373 = esp_220->ptrFFFFFF08;
	if (eax_367->t0000.u0 != 121)
	{
		struct Eq_329 * edi_376 = eax_373->ptrFFFFFFFC;
		do
		{
			word32 eax_388;
			edi_376->ptr0018();
			word32 eax_400 = fn00000000(eax_388);
			word16 ecx_16_16_405 = SLICE(ecx_402, word16, 16);
			word32 eax_407;
			word32 ecx_409;
			edi_376->ptr0018();
			word16 ecx_16_16_412 = SLICE(ecx_409, word16, 16);
			word32 eax_414;
			word32 ecx_416;
			edi_376->ptr0018();
			word16 ecx_16_16_419 = SLICE(ecx_416, word16, 16);
			word32 eax_421;
			word32 ecx_423;
			edi_376->ptr0018();
			word16 ecx_16_16_426 = SLICE(ecx_423, word16, 16);
			word32 eax_428;
			word32 ecx_430;
			edi_376->ptr0018();
			word16 ecx_16_16_433 = SLICE(ecx_430, word16, 16);
			word32 eax_435;
			edi_376->ptr0018();
			word32 eax_447 = fn00000000(eax_435);
			word16 cx_461 = (word16) ecx_449;
			ecx_16_16_381 = SLICE(ecx_449, word16, 16);
			esp_446->ptrFFFFFFFC = eax_447 + 0x01;
			struct Eq_146 * eax_458 = esp_446->ptrFFFFFFFC;
			cup16 ax_462 = (word16) eax_458 - cx_461;
			esp_446->ptrFFFFFFFC = SEQ(SLICE(eax_458, word16, 16), ax_462);
			eax_373 = esp_446->ptrFFFFFFFC;
		} while (ax_462 < 0x00);
		esp_446->ptrFFFFFFFC = eax_373;
	}
	int32 esi_512 = 0x00;
	int32 ebp_518 = 0x00;
	Eq_362 eax_534 = 0x00;
	do
	{
		word32 ebx_539 = (word32) (fp - 300)[ebp_518];
		word32 edx_571 = (word32) *((word32) eax_534 + dwLoc0130) + (ebx_539 + esi_512);
		byte bl_638 = (byte) ebx_539;
		byte dl_583 = (byte) edx_571;
		word16 edx_16_16_584 = SLICE(edx_571, word16, 16);
		int32 edx_585 = SEQ(edx_16_16_584, 0x00, dl_583);
		esi_512 = edx_585;
		Eq_362 eax_597 = (word32) eax_534 + 1;
		if ((word32) eax_534 + 1 >= fp - 40)
			eax_597.u0 = 0x00;
		byte dl_612 = *((word32) (fp - 300) + edx_585);
		*((word32) (fp - 300) + ebp_518) = (ptr32) dl_612;
		++ebp_518;
		ptr32 edx_628 = fp - 300 + edx_585;
		ptr32 edx_629 = edx_628 - eax_597;
		*((word32) eax_597.u0 + edx_629) = SEQ(*((word32) ((word32) eax_597.u0 + 1) + edx_629), bl_638);
		byte bh_642 = SLICE(ebp_518, byte, 8);
		eax_534 = eax_597;
	} while (bh_642 != 0x01);
	ebpOut = ebp + 0x01;
	return eax_115;
}

// 0040169A: Register ptr32 fn0040169A(Stack word16 wArg00, Register out Eq_36 ecxOut, Register out ptr32 ebxOut)
// Called from:
//      fn004010D0
ptr32 fn0040169A(word16 wArg00, union Eq_36 & ecxOut, ptr32 & ebxOut)
{
	word32 dwArg00;
	word32 eax_132 = dwArg00;
	while (true)
	{
		word16 eax_16_16_39 = SLICE(eax_132, word16, 16);
		word16 * eax_40 = SEQ(eax_16_16_39, 0x00);
		word16 ax_47 = *eax_40;
		word32 eax_53 = SEQ(eax_16_16_39, ax_47 + 42421);
		if (ax_47 == 23117)
			break;
		eax_132 = eax_53 - 0x00010000;
	}
	struct Eq_492 * eax_59;
	__btc<word32>(eax_53, 0x01, out eax_59);
	word32 ecx_80 = eax_59->dw003C;
	struct Eq_507 * ecx_81 = eax_59 + ecx_80 / 64;
	Eq_36 ecx_94 = eax_59[ecx_81->dw0080 / 64];
	ecxOut = ecx_94;
	word32 eax_100 = eax_59 + ecx_94;
	ebxOut = eax_100 + 0x04;
	return eax_100 + 0x04;
}

