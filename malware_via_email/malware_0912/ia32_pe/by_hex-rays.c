/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall start(int a1@<ebx>, int a2@<ebp>, int a3@<edi>, int a4@<esi>, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13);
// void __usercall sub_4010D0(int a1@<ecx>, int a2@<ebx>, int a3@<ebp>, int a4@<edi>, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13);
int sub_40169A();


//----- (00401004) --------------------------------------------------------
void __usercall start(int a1@<ebx>, int a2@<ebp>, int a3@<edi>, int a4@<esi>, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13)
{
  int v13; // ecx
  int v14; // [esp+12Ch] [ebp-18h] BYREF

  sub_4010D0(0, a1, a2, a3, 0, 16, 8752, (int)&v14, 192232246, 0, -685544414, -345149848, a4);
  sub_4010D0(v13, a1, a2, a3, a5, a6, a7, a8, a9, a10, a11, a12, a13);
}
// 401049: variable 'v13' is possibly undefined

//----- (004010D0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4010D0(int a1@<ecx>, int a2@<ebx>, int a3@<ebp>, int a4@<edi>, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13)
{
  _WORD *v13; // eax
  int v14; // eax
  int v15; // ecx
  int v16; // eax
  unsigned int v17; // eax
  int v18; // eax
  unsigned __int16 v19; // cx
  int v20; // edi
  unsigned int i; // eax
  int v22; // [esp-4h] [ebp-144h]
  int v23; // [esp+0h] [ebp-140h]
  int v24[64]; // [esp+4h] [ebp-13Ch]
  _DWORD v25[2]; // [esp+104h] [ebp-3Ch] BYREF
  _DWORD *v26; // [esp+10Ch] [ebp-34h]
  _DWORD *v27; // [esp+110h] [ebp-30h]
  _DWORD v28[2]; // [esp+114h] [ebp-2Ch] BYREF
  int v29; // [esp+11Ch] [ebp-24h]
  _DWORD *v30; // [esp+120h] [ebp-20h]
  int v31; // [esp+124h] [ebp-1Ch]
  int v32; // [esp+128h] [ebp-18h]
  int v33; // [esp+12Ch] [ebp-14h]
  int v34; // [esp+130h] [ebp-10h]
  _WORD *v35; // [esp+134h] [ebp-Ch]
  _WORD *v36; // [esp+138h] [ebp-8h]
  _WORD *v37; // [esp+13Ch] [ebp-4h]

  v36 = (_WORD *)a3;
  LOWORD(v13) = 0;
  HIWORD(v13) = HIWORD(v37);
  LOWORD(a1) = *v13;
  LOWORD(v13) = 0;
  v37 = v13 + 12312;
  v36 = v13 + 13886;
  v35 = v13 + 12312;
  v33 = a2;
  v32 = a4;
  v31 = 0;
  v30 = 0;
  v29 = 16711681;
  v28[1] = a4 - (a1 + 42418) + 2;
  v28[0] = 16711686;
  v27 = v28;
  v14 = sub_40169A();
  v30 = v28;
  v29 = v14;
  (*(void (__cdecl **)(int, int))(a2 + 24))(v14, v14);
  v27 = (_DWORD *)((*(int (**)(void))(a2 + 28))() + 6);
  v26 = v27;
  v25[1] = (*(int (**)(void))a2)();
  v25[0] = v15;
  v24[63] = (int)v25;
  v24[62] = 64;
  v31 = 0;
  v16 = (*(int (__cdecl **)(int, _DWORD *, int))(a2 - 4 + 16))(-1, v30, v33);
  v17 = __readfsdword(v16 + 47) + v16;
  v30 = (_DWORD *)((char *)v30 + *(_DWORD *)(v17 + 3));
  v33 ^= *(_DWORD *)(v17 + 3);
  v22 = (int)v26;
  v23 = v29;
  for ( i = 0; i < 0x100; ++i )
    *((_BYTE *)v24 + i) = i;
  if ( (_BYTE)v35 != 121 )
  {
    v20 = v34;
    do
    {
      (*(void (__cdecl **)(int, int))(v20 + 24))(v22, v23);
      (*(void (**)(void))(v20 + 16))();
      (*(void (**)(void))(v20 + 24))();
      (*(void (**)(void))(v20 + 24))();
      (*(void (**)(void))(v20 + 24))();
      (*(void (**)(void))(v20 + 24))();
      (*(void (**)(void))(v20 + 24))();
      v18 = (*(int (**)(void))(v20 + 16))() + 1;
    }
    while ( (unsigned __int16)v18 < v19 );
  }
  JUMPOUT(0x401487);
}
// 401122: positive sp value 4 has been found
// 401486: control flows out of bounds to 401487
// 4012A7: variable 'v15' is possibly undefined
// 4013D4: variable 'v22' is possibly undefined
// 4013D4: variable 'v23' is possibly undefined
// 401430: variable 'v19' is possibly undefined

//----- (0040169A) --------------------------------------------------------
int sub_40169A()
{
  unsigned int v0; // eax
  void *retaddr; // [esp+0h] [ebp+0h]

  HIWORD(v0) = HIWORD(retaddr);
  while ( 1 )
  {
    LOWORD(v0) = 0;
    LOWORD(v0) = *(_WORD *)v0 - 23115;
    if ( (_WORD)v0 == 2 )
      break;
    v0 -= 0x10000;
  }
  return (v0 ^ 2) + *(_DWORD *)((v0 ^ 2) + *(_DWORD *)((v0 ^ 2) + *(_DWORD *)((v0 ^ 2) + 0x3C) + 128)) + 4;
}

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
