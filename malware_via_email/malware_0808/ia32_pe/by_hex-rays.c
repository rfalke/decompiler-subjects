/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

// int __usercall sub_401005@<eax>(int@<ebp>);
// int __usercall sub_401024@<eax>(__int32@<eax>, __int32@<edx>, int@<ebp>);
// void __usercall sub_401098(int@<eax>, int@<ecx>, int@<edi>, int@<esi>);
// void __usercall sub_4010D0(__int32@<edx>, int@<ecx>, int@<edi>);
// void __usercall sub_40110B(int@<esi>);
// void __usercall sub_401160(char *this@<ecx>, int@<eax>, int@<ebx>, int@<edi>, int@<esi>);
// void __usercall sub_40117A(int@<eax>, __int32@<edx>, int@<ecx>, int@<ebx>, int@<edi>, int@<esi>);
// void __usercall sub_4011D3(__int32@<eax>, int@<edx>, int@<ecx>, int@<ebx>, __int32@<edi>);
// void __usercall sub_4011F4(__int32@<eax>, int@<ecx>, int@<ebx>, int@<edi>, int@<esi>);
// void __usercall sub_40124C(int@<eax>, int@<edx>, int@<ecx>);
void sub_40129F();
// void __usercall sub_4012D0(__int16@<ax>, char@<dl>, int@<edi>, int@<esi>);
// void __usercall sub_4012E8(int@<eax>, int@<ecx>, int@<ebx>);
void sub_40133E();
// void __usercall sub_40138E(char@<ah>, char@<dh>, char@<ch>, char@<bh>);
// void __usercall sub_40147A(__int32@<edx>, int@<ecx>, int@<edi>);
// void __usercall sub_4014C9(int@<eax>, int@<edx>, int@<ebx>, int@<edi>, int@<esi>, int@<ecx>);
// void __usercall sub_4014E3(__int32@<eax>, int@<edx>, int@<ecx>, int@<ebx>, int@<edi>, int@<esi>);
int sub_40153E();
// void __usercall sub_4015B0(int@<ecx>, int@<ebx>);
void __thiscall sub_4015C7(char *this);
void sub_4015FC();
// void __usercall sub_401630(int@<ecx>, int@<edx>, int@<edi>);
// void __usercall sub_40164A(__int32@<eax>, int@<edx>, int@<ecx>, int@<edi>);
// char __usercall sub_4016B1@<al>(char result@<al>);
// void __usercall sub_4016D2(__int16@<ax>, char@<cl>, __int16@<bx>, __int16@<si>);
// void __usercall sub_401714(__int32@<eax>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401057; // weak
_UNKNOWN loc_401124; // weak
_UNKNOWN loc_4011B0; // weak
_UNKNOWN loc_40122F; // weak
_UNKNOWN loc_4013C7; // weak
_UNKNOWN loc_4013E1; // weak
_UNKNOWN loc_4013F9; // weak
_UNKNOWN loc_40141C; // weak
_UNKNOWN loc_401459; // weak
_UNKNOWN loc_401492; // weak
_UNKNOWN loc_401502; // weak
_UNKNOWN loc_401554; // weak
_UNKNOWN loc_40157A; // weak
_UNKNOWN loc_401596; // weak
_UNKNOWN loc_4015DB; // weak


//----- (00401005) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_401005@<eax>(int a1@<ebp>)
{
  char v1; // zf
  __int64 v2; // rax

  ((void (*)(void))((char *)&loc_4013E1 + 2))();
  if ( v1 )
    JUMPOUT(0x40101E);
  v2 = MEMORY[0xFFB50F49]();
  return sub_401024(v2, SHIDWORD(v2), a1);
}
// 401009: positive sp value 4 has been found
// 40101D: control flows out of bounds to 40101E
// 40101D: variable 'v1' is possibly undefined

//----- (00401024) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_401024@<eax>(__int32 a1@<eax>, __int32 a2@<edx>, int a3@<ebp>)
{
  int v4; // edx
  int v5; // ecx
  __int32 v7[2]; // [esp-8h] [ebp-8h] BYREF

  _InterlockedExchange(v7, a2);
  sub_401714(a1);
  v7[0] = *(_DWORD *)(a3 - 24);
  _InterlockedExchange(v7, a1);
  ((void (__fastcall *)(int, int))((char *)&loc_4011B0 + 4))(v5, v5 ^ v4);
  return MEMORY[0x2525FF74]();
}
// 401042: positive sp value 8 has been found
// 40104A: variable 'v5' is possibly undefined
// 401048: variable 'v4' is possibly undefined

//----- (00401098) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401098(int a1@<eax>, int a2@<ecx>, int a3@<edi>, int a4@<esi>)
{
  unsigned int v4; // edi
  char v5; // dh
  __int16 v6; // cx
  char v7; // zf
  unsigned int v8; // edi
  int v9; // [esp-4h] [ebp-4h]

  v4 = a1 & 0xEEEEEEEE ^ a3;
  ((void (__fastcall *)(int, int))((char *)&loc_40141C + 3))(a4 + a2 - 1, (a4 + a2 - 1) | a4);
  v9 = *(_DWORD *)(9 * v4 + 0x74);
  if ( !v7 )
    JUMPOUT(0x4010B7);
  v8 = v4 - 1;
  sub_40138E(SBYTE1(v9), v5, -((unsigned __int16)(v6 - 1) >> 8), SBYTE1(v8));
  MEMORY[0x753F856B]();
  ++*(_DWORD *)(v8 + 32056324);
  JUMPOUT(0x40114C);
}
// 40109C: positive sp value 4 has been found
// 4010B5: control flows out of bounds to 4010B7
// 401146: control flows out of bounds to 40114C
// 4010B5: variable 'v7' is possibly undefined
// 40113C: variable 'v5' is possibly undefined
// 401131: variable 'v6' is possibly undefined

//----- (004010D0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4010D0(__int32 a1@<edx>, int a2@<ecx>, int a3@<edi>)
{
  __int32 v3; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v3, a1);
  ((void (__fastcall *)(int, int))((char *)&loc_401502 + 1))(a3 ^ a2, 324471871);
  MEMORY[0x2484A068]();
  JUMPOUT(0x4010F4);
}
// 4010D8: positive sp value 4 has been found
// 4010EF: control flows out of bounds to 4010F4

//----- (0040110B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40110B(int a1@<esi>)
{
  ((void (__thiscall *)(int))((char *)&loc_4013C7 + 3))(a1);
  JUMPOUT(0x401129);
}
// 40110F: positive sp value 4 has been found
// 401124: control flows out of bounds to 401129

//----- (00401160) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401160(char *this@<ecx>, int a2@<eax>, int a3@<ebx>, int a4@<edi>, int a5@<esi>)
{
  int v5; // edi
  __int64 v6; // rax
  int v7; // ecx
  void *v8; // [esp+18h] [ebp-4h]
  void *retaddr; // [esp+1Ch] [ebp+0h]

  *(&retaddr - 8) = v8;
  v5 = a2 | a4;
  ((void (__fastcall *)(char *, char *))((char *)&loc_4013F9 + 4))(this + 1, this);
  v6 = MEMORY[0x25B4F9EE]();
  sub_40117A(v6, SHIDWORD(v6), v7, (v5 ^ (a3 - 1)) - 1, v5, a5 - 1);
}
// 401164: positive sp value 4 has been found
// 401176: variable 'v7' is possibly undefined

//----- (0040117A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40117A(int a1@<eax>, __int32 a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  char v6; // zf
  __int32 v7; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v7, a2);
  sub_401098(a1, a4 + a3, v7 + 1 + (a6 ^ a5), a6);
  if ( !v6 )
    JUMPOUT(0x401199);
  JUMPOUT(0x401208);
}
// 401180: positive sp value 4 has been found
// 401194: control flows out of bounds to 401199
// 401192: control flows out of bounds to 401208
// 401192: variable 'v6' is possibly undefined

//----- (004011D3) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4011D3(__int32 a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, __int32 a5@<edi>)
{
  int v5; // edi
  int v7; // ebx
  __int32 v8; // eax
  int v9; // ecx
  char v10; // zf
  __int32 v11; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v11, a5);
  v5 = v11;
  v11 = *(_DWORD *)(a1 + 8);
  v7 = a4 + 1;
  sub_40164A(a1, a2 + 1, v5 + (a1 ^ a3), v5);
  if ( v10 )
    JUMPOUT(0x401268);
  sub_4011F4(v8, v9, v7, v5, a4);
}
// 4011DB: positive sp value 4 has been found
// 4011F2: control flows out of bounds to 401268
// 4011F2: variable 'v10' is possibly undefined
// 4011F3: variable 'v8' is possibly undefined
// 4011F3: variable 'v9' is possibly undefined

//----- (004011F4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4011F4(__int32 a1@<eax>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>)
{
  char v5; // zf
  int v6; // [esp+4h] [ebp-8h]
  int v7; // [esp+8h] [ebp-4h]

  *(&v7 - 4) = v6;
  sub_40117A(v7, a1, a3 | a4 ^ a2, a3, v7 + a1, a5 + 1);
  if ( !v5 )
    JUMPOUT(0x40120F);
  JUMPOUT(0x4011F3);
}
// 401202: positive sp value 8 has been found
// 40120D: control flows out of bounds to 40120F
// 401209: control flows out of bounds to 4011F3
// 40120B: control flows out of bounds to 4011F5
// 40120D: control flows out of bounds to 401283
// 40120D: conditional instruction was optimized away because zf.1==0
// 401209: variable 'v5' is possibly undefined

//----- (0040124C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40124C(int a1@<eax>, int a2@<edx>, int a3@<ecx>)
{
  void *v3; // [esp+24h] [ebp-4h]
  void *retaddr; // [esp+28h] [ebp+0h]

  *(&retaddr - 11) = v3;
  BYTE1(a1) = 43;
  LOBYTE(a3) = -(char)a3;
  ((void (__fastcall *)(int, int))((char *)&loc_401554 + 5))(a3 - a1, a2 + 2113402445);
  MEMORY[0x8E28FB6C]();
  JUMPOUT(0x40126D);
}
// 401250: positive sp value 4 has been found
// 401268: control flows out of bounds to 40126D

//----- (0040129F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40129F()
{
  void *v0; // [esp+18h] [ebp-4h]
  void *retaddr; // [esp+1Ch] [ebp+0h]

  *(&retaddr - 8) = v0;
  sub_40133E();
  JUMPOUT(0x4012B7);
}
// 4012A3: positive sp value 4 has been found
// 4012B2: control flows out of bounds to 4012B7

//----- (004012D0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4012D0(__int16 a1@<ax>, char a2@<dl>, int a3@<edi>, int a4@<esi>)
{
  int v4; // ebx
  int v5; // eax
  int v6; // ecx
  char v7; // zf
  void *v8; // [esp+24h] [ebp-4h]
  void *retaddr; // [esp+28h] [ebp+0h]

  *(&retaddr - 11) = v8;
  v4 = a4 - (a3 - 1) + 1;
  sub_4016D2(a1, a2, v4, a4);
  if ( v7 )
    JUMPOUT(0x401308);
  sub_4012E8(v5 & 0xE874E825, v6, v4);
}
// 4012D4: positive sp value 4 has been found
// 4012E1: control flows out of bounds to 401308
// 4012E1: variable 'v7' is possibly undefined
// 4012E3: variable 'v5' is possibly undefined
// 4012E4: variable 'v6' is possibly undefined

//----- (004012E8) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4012E8(int a1@<eax>, int a2@<ecx>, int a3@<ebx>)
{
  int v3; // eax

  sub_4015B0(a2 - a1, a2 | a3);
  if ( (v3 & 0x74E8E874) != 0 )
    JUMPOUT(0x401307);
  JUMPOUT(0x401306);
}
// 4012EC: positive sp value 4 has been found
// 401305: control flows out of bounds to 401307
// 401305: control flows out of bounds to 401306
// 401300: variable 'v3' is possibly undefined

//----- (0040133E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40133E()
{
  char v1; // zf

  __asm { smsw    eax }
  sub_4016B1(_EAX);
  if ( !v1 )
  {
    MEMORY[0x2484A2D0]();
    JUMPOUT(0x40135C);
  }
  JUMPOUT(0x4013CB);
}
// 401342: positive sp value 4 has been found
// 401357: control flows out of bounds to 40135C
// 401355: control flows out of bounds to 4013CB
// 401355: variable 'v1' is possibly undefined

//----- (0040138E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40138E(char a1@<ah>, char a2@<dh>, char a3@<ch>, char a4@<bh>)
{
  __int16 v4; // cx

  HIBYTE(v4) = a1 ^ a3;
  LOBYTE(v4) = (a2 ^ a4) + (a2 ^ a4) + 39;
  ((void (__thiscall *)(__int16))loc_40122F)(v4);
  MEMORY[0x28FCAA]();
  JUMPOUT(0x4013B0);
}
// 401392: positive sp value 4 has been found
// 4013AB: control flows out of bounds to 4013B0

//----- (0040147A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40147A(__int32 a1@<edx>, int a2@<ecx>, int a3@<edi>)
{
  char v3; // zf
  __int32 v4; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v4, a1);
  sub_4010D0((a2 + 1) | v4, a2 + 1, a3);
  if ( !v3 )
  {
    MEMORY[0x2628FD7A]();
    JUMPOUT(0x401497);
  }
  JUMPOUT(0x401501);
}
// 401480: positive sp value 4 has been found
// 401492: control flows out of bounds to 401497
// 40148B: control flows out of bounds to 401501
// 40148B: variable 'v3' is possibly undefined

//----- (004014C9) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4014C9(int a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>, int a6@<ecx>)
{
  int v6; // ebx
  int v7; // esi
  int v8; // edi
  int v9; // ebx
  int v10; // edi
  __int32 v11; // eax
  int v12; // edx
  int v13; // ecx
  void *v14; // [esp+4h] [ebp-4h]
  void *retaddr; // [esp+8h] [ebp+0h]

  *(&retaddr - 3) = v14;
  v6 = a3 + 1;
  v7 = v6 | a5;
  v8 = (a1 | a4) - v7;
  v9 = v8 + a6 + v6;
  v10 = a2 + v8;
  sub_4012D0(a1, a2, v10, v7);
  sub_4014E3(v11, v12, v13, v9, v10, v7);
}
// 4014CD: positive sp value 4 has been found
// 4014E0: variable 'v11' is possibly undefined
// 4014E0: variable 'v12' is possibly undefined
// 4014E0: variable 'v13' is possibly undefined

//----- (004014E3) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4014E3(__int32 a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  void *v6; // [esp+18h] [ebp-4h]
  void *retaddr; // [esp+1Ch] [ebp+0h]

  *(&retaddr - 8) = v6;
  sub_4011D3(a1, a1 ^ a2, a2 + a3 + 1, a2 ^ (a5 + a6 + a4), a2 ^ (a5 + a6 + a4));
  MEMORY[0xF0645996]();
  JUMPOUT(0x401507);
}
// 4014E7: positive sp value 4 has been found
// 401502: control flows out of bounds to 401507

//----- (0040153E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int sub_40153E()
{
  __asm { rep pop esi }
  ((void (*)(void))((char *)&loc_401459 + 1))();
  return MEMORY[0x8DE825E8]();
}
// 401545: positive sp value 4 has been found

//----- (004015B0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4015B0(int a1@<ecx>, int a2@<ebx>)
{
  char *v2; // ecx
  int v3; // [esp+Ch] [ebp-8h]
  int v4; // [esp+10h] [ebp-4h]

  *(&v4 - 6) = v3;
  ((void (__fastcall *)(int, int))loc_401596)(a1 + 1, a2);
  MEMORY[0x74B43BC6]();
  sub_4015C7(v2);
}
// 4015BA: positive sp value 8 has been found
// 4015C3: variable 'v2' is possibly undefined

//----- (004015C7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __thiscall sub_4015C7(char *this)
{
  void *v1; // [esp+Ch] [ebp-4h]
  void *retaddr; // [esp+10h] [ebp+0h]

  *(&retaddr - 5) = v1;
  ((void (__thiscall *)(char *))((char *)&loc_401492 + 1))(this - 1);
  JUMPOUT(0x4015E0);
}
// 4015CB: positive sp value 4 has been found
// 4015DB: control flows out of bounds to 4015E0

//----- (004015FC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4015FC()
{
  void *v0; // [esp+20h] [ebp-4h]
  void *retaddr; // [esp+24h] [ebp+0h]

  *(&retaddr - 10) = v0;
  ((void (*)(void))((char *)&loc_401124 + 4))();
  MEMORY[0xCC645AAE]();
  JUMPOUT(0x401744);
}
// 401600: positive sp value 4 has been found
// 40162B: control flows out of bounds to 401744

//----- (00401630) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401630(int a1@<ecx>, int a2@<edx>, int a3@<edi>)
{
  __int64 v3; // rax
  int v4; // ecx
  void *v5; // [esp+14h] [ebp-4h]
  void *retaddr; // [esp+18h] [ebp+0h]

  *(&retaddr - 7) = v5;
  ((void (__thiscall *)(int))loc_40157A)(a1 - 1 - a2);
  v3 = MEMORY[0xFF66156F]();
  sub_40164A(v3, SHIDWORD(v3), v4, a3);
}
// 401634: positive sp value 4 has been found
// 401646: variable 'v4' is possibly undefined

//----- (0040164A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40164A(__int32 a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<edi>)
{
  sub_4011F4(a1, a3, a2, a4 + 1, a2);
  MEMORY[0xE8661647]();
  JUMPOUT(0x401664);
}
// 40164E: positive sp value 4 has been found
// 40165F: control flows out of bounds to 401664

//----- (004016B1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
char __usercall sub_4016B1@<al>(char result@<al>)
{
  void *v1; // [esp+28h] [ebp-4h]
  void *retaddr; // [esp+2Ch] [ebp+0h]

  *(&retaddr - 12) = v1;
  if ( (result & 8) == 0 )
    JUMPOUT(0x401041);
  return result;
}
// 4016B5: positive sp value 4 has been found
// 4016BE: control flows out of bounds to 401041

//----- (004016D2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4016D2(__int16 a1@<ax>, char a2@<cl>, __int16 a3@<bx>, __int16 a4@<si>)
{
  int v4; // edi
  int v5; // ecx
  __int16 v6; // bx
  char v7; // zf
  int v8; // edx
  int v9; // ecx
  int v10; // eax
  __int16 v11; // bx
  int v12; // eax

  v6 = a3 - a1;
  HIBYTE(v6) ^= a2 - 2;
  sub_4015FC();
  if ( v7 )
    JUMPOUT(0x4016D8);
  v10 = MEMORY[0x8DB516F4]();
  LOBYTE(v10) = v10 & 4;
  v11 = (v6 + (a4 | (a4 - 1))) | v6;
  if ( v8 == 1150881500 )
  {
    v12 = ((int (*)(void))loc_401057)();
    sub_401714(v12 & 0xFF74E825);
  }
  else
  {
    LOBYTE(v9) = (v11 - HIBYTE(v11)) ^ v9;
    sub_40124C(v10, v8, v9);
    MEMORY[0xFF653C77]();
    v4 = MEMORY[0xFA44080D]();
    ((void (__thiscall *)(int))((char *)&loc_4015DB + 4))(v4 + v5);
    MEMORY[0x89FF74E8]();
  }
}
// 401668: positive sp value 4 has been found
// 4016EE: control flows out of bounds to 4016D8
// 4016EE: variable 'v7' is possibly undefined
// 401702: variable 'v8' is possibly undefined
// 40166B: variable 'v9' is possibly undefined
// 401686: variable 'v5' is possibly undefined

//----- (00401714) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401714(__int32 a1@<eax>)
{
  char v1; // zf
  __int32 v2; // [esp+0h] [ebp-4h] BYREF

  _InterlockedExchange(&v2, a1);
  sub_40153E();
  if ( !v1 )
    JUMPOUT(0x40172A);
  JUMPOUT(0x401710);
}
// 40171A: positive sp value 4 has been found
// 401728: control flows out of bounds to 40172A
// 401726: control flows out of bounds to 401710
// 401728: control flows out of bounds to 40179E
// 401726: variable 'v1' is possibly undefined

// nfuncs=27 queued=27 decompiled=27 lumina nreq=0 worse=0 better=0
// ALL OK, 27 function(s) have been successfully decompiled
