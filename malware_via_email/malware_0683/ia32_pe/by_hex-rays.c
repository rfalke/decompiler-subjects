/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

// void __usercall sub_40112B(int a1@<eax>, int a2@<edx>, int a3@<ebx>, __int32 a4@<edi>);
void start();
void __noreturn sub_4013A3(); // weak
// void __usercall sub_40219D(char a1@<cf>, int a2@<eax>, int a3@<edx>, void *a4@<ecx>, __int32 a5@<ebx>);
_DWORD sub_402253(); // weak
// void __usercall sub_4022B6(int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4@<esi>);
// void __usercall sub_402392(char a1@<cf>, void (__thiscall **a2)(__int16)@<edx>, __int16 a3@<bx>);
// void __usercall sub_4023C9(void (__thiscall *a1)(__int16)@<eax>, __int16 a2@<cx>, char a3@<bh>);
// void __usercall sub_4024FB(void (__thiscall *a1)(__int16)@<eax>, char a2@<cl>);
double sub_4025F9(); // weak
// void __usercall sub_40266D(char a1@<al>, char a2@<bl>);
// int __userpurge sub_4027B7@<eax>(int a1@<eax>, int a2@<ecx>, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
_DWORD __far sub_40281E(); // weak
_DWORD sub_40288B(); // weak
void __thiscall sub_402979(_DWORD *this);
void sub_4029A7();
// void __usercall sub_4029DB(unsigned int a1@<ecx>, __int16 a2@<bx>, __int16 a3@<di>, __int32 a4@<esi>);
_DWORD __far sub_402A33(); // weak
void sub_402BE1();
void sub_402C83();
// void __usercall sub_402CAC(int a1@<ecx>, __int32 a2@<esi>);
void sub_402DBA();
void sub_402E61();
int __thiscall sub_402E97(void *this);
void sub_402F31();
// void __usercall sub_402F71(int a1@<ecx>, __int32 a2@<esi>);
// char __usercall sub_403031@<al>(int a1@<edx>, void *a2@<ecx>, int a3@<ebx>);
// void __usercall sub_40308D(char a1@<cf>, int a2@<edx>, int a3@<ecx>, __int32 a4@<edi>);
// void __usercall sub_4030EC(char a1@<ah>, unsigned int a2@<ebx>, _DWORD *a3@<edi>, int a4@<esi>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_40136B; // weak
_UNKNOWN loc_402558; // weak
_UNKNOWN loc_402617; // weak
_UNKNOWN loc_402A14; // weak
_UNKNOWN loc_402DD6; // weak
_UNKNOWN loc_402F8A; // weak


//----- (0040112B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40112B(int a1@<eax>, int a2@<edx>, int a3@<ebx>, __int32 a4@<edi>)
{
  __int32 v5; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v5, a4);
  __asm { rep pop edi }
  v5 = *(_DWORD *)(a1 + 8);
  ((void (__fastcall *)(int, int))sub_4013A3)(2 * (a3 | a2), (a3 | a2) - a1);
}
// 401131: positive sp value 4 has been found
// 401276: control flows out of bounds to 401278
// 4013A3: using guessed type void __noreturn sub_4013A3();

//----- (0040127A) --------------------------------------------------------
void start()
{
  JUMPOUT(0x40142C);
}
// 40129B: control flows out of bounds to 4012A0
// 4011F0: control flows out of bounds to 40142C

//----- (004013A3) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn sub_4013A3()
{
  int v0; // eax
  char v1; // cf
  int v2; // edx

  v0 = ((int (*)(void))((char *)&loc_40136B + 3))();
  *(_BYTE *)(v2 + 608472833) += BYTE1(v0) + v1;
  __halt();
}
// 4013AF: positive sp value 4 has been found
// 4013C0: variable 'v1' is possibly undefined
// 4013C0: variable 'v2' is possibly undefined
// 4013A3: using guessed type void __noreturn sub_4013A3();

//----- (0040219D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40219D(char a1@<cf>, int a2@<eax>, int a3@<edx>, void *a4@<ecx>, __int32 a5@<ebx>)
{
  int v5; // ebx
  int v6; // edx
  int v7; // ebx
  __int32 v8; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v8, a5);
  HIWORD(v5) = HIWORD(v8);
  LOBYTE(a3) = (unsigned __int8)a4 ^ a3;
  BYTE1(a3) = ~(a1 + BYTE1(a3) - 54);
  BYTE1(v5) = -126;
  v6 = a3 + 1;
  LOBYTE(v5) = v8 - 1 - (_BYTE)a4;
  v7 = a2 ^ v5;
  LOBYTE(v6) = 49 - v6;
  BYTE1(v6) = BYTE1(a4) - 72;
  LOBYTE(v7) = BYTE1(a4) ^ BYTE1(a2) ^ 0xBD;
  sub_403031(v6, a4, v7 - 1);
  v8 = (unsigned __int16)__DS__;
  JUMPOUT(0x40224D);
}
// 4021A8: positive sp value 4 has been found
// 40224C: control flows out of bounds to 40224D

//----- (00402253) --------------------------------------------------------
#error "4027AF: cannot convert to microcode (funcsize=163)"

//----- (004022B6) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4022B6(int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4@<esi>)
{
  if ( !__OFSUB__(a3 + a2 + a4 - a1 + 1 - (a1 - 773167195), 1) && __OFSUB__(a3 + a2 + a4 - a1 + 1 - (a1 - 773167195), 1) )
    JUMPOUT(0x402B5C);
  JUMPOUT(0x4021E8);
}
// 4022BA: positive sp value 4 has been found
// 402B57: control flows out of bounds to 402B5C
// 402B4A: control flows out of bounds to 4021E8

//----- (00402392) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402392(char a1@<cf>, void (__thiscall **a2)(__int16)@<edx>, __int16 a3@<bx>)
{
  __int16 v3; // cx
  char v4; // zf
  int v5; // ecx
  int v6; // ecx

  HIBYTE(v3) = HIBYTE(a3) - (a1 + 113);
  LOBYTE(v3) = a3 - 1;
  sub_4023C9(*a2, v3, SHIBYTE(v3));
  v6 = v5 - 1;
  if ( v4 )
  {
    if ( v6 )
      JUMPOUT(0x4023B1);
  }
  JUMPOUT(0x4023AB);
}
// 402396: positive sp value 4 has been found
// 4023A8: control flows out of bounds to 4023AB
// 4023A6: control flows out of bounds to 4023B1
// 4023A6: variable 'v5' is possibly undefined
// 4023A6: variable 'v4' is possibly undefined

//----- (004023C9) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4023C9(void (__thiscall *a1)(__int16)@<eax>, __int16 a2@<cx>, char a3@<bh>)
{
  char v3; // bh
  __int16 v4; // cx
  char v5; // of
  char v6; // zf
  int v7; // ecx
  int v8; // ecx

  v3 = a2 + a3;
  LOBYTE(a2) = 0;
  v4 = a2 + 1;
  if ( (unsigned __int8)(v3 + 1) < 0xAAu && v3 != -87 && ((unsigned __int8)(v3 + 1) >= 0xAAu || v3 == -87) )
  {
    ((void (*)(void))((char *)&loc_402F8A + 1))();
    JUMPOUT(0x4023B9);
  }
  sub_4024FB(a1, (_BYTE)a1 + HIBYTE(v4));
  v8 = v7 - 1;
  if ( v6 || !v8 )
  {
    if ( v5 )
      JUMPOUT(0x4025C0);
    JUMPOUT(0x4025EC);
  }
  JUMPOUT(0x402552);
}
// 4023CD: positive sp value 4 has been found
// 4025BF: control flows out of bounds to 4025C0
// 40240D: control flows out of bounds to 4023B9
// 4025BB: control flows out of bounds to 402552
// 4025BD: control flows out of bounds to 4025EC
// 402AA0: control flows out of bounds to 402A6A
// 4025BB: variable 'v7' is possibly undefined
// 4025BB: variable 'v6' is possibly undefined
// 4025BD: variable 'v5' is possibly undefined

//----- (004024FB) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4024FB(void (__thiscall *a1)(__int16)@<eax>, char a2@<cl>)
{
  __int16 v2; // cx
  char v3; // pf
  unsigned __int8 v4; // al
  int v5; // [esp+Ch] [ebp-8h]
  int v6; // [esp+10h] [ebp-4h]

  *(&v6 - 6) = v5;
  HIBYTE(v2) = BYTE1(a1);
  LOBYTE(v2) = a2 + 41;
  a1(v2);
  if ( !v3 && v3 )
  {
    sub_402253();
    v4 = __inbyte(0xABu);
    _enable();
    JUMPOUT(0x402ED5);
  }
  JUMPOUT(0x4030B1);
}
// 40254D: positive sp value 8 has been found
// 40254F: control flows out of bounds to 402ED5
// 402511: control flows out of bounds to 4030B1
// 402511: variable 'v3' is possibly undefined
// 402253: using guessed type _DWORD sub_402253();

//----- (004025F9) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4025F9()
{
  JUMPOUT(0x40304A);
}
// 4025FD: positive sp value 4 has been found
// 40260E: control flows out of bounds to 40304A

//----- (0040266D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40266D(char a1@<al>, char a2@<bl>)
{
  if ( !__SETP__(a1 + a2, 0) && __SETP__(a1 + a2, 0) )
  {
    if ( (char)(a1 + a2) < 0 == __OFADD__(a1, a2) )
      JUMPOUT(0x40269C);
    JUMPOUT(0x402685);
  }
  JUMPOUT(0x402328);
}
// 402675: positive sp value 4 has been found
// 40269A: control flows out of bounds to 40269C
// 402681: control flows out of bounds to 402328
// 402695: control flows out of bounds to 402685

//----- (004027B7) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
int __userpurge sub_4027B7@<eax>(int a1@<eax>, int a2@<ecx>, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  void *retaddr[2]; // [esp+0h] [ebp+0h]

  if ( __SETP__(a2 + a1, 0) || !__SETP__(a2 + a1, 0) )
    JUMPOUT(0x402942);
  return MK_FP(retaddr[0], retaddr[0])();
}
// 4027C4: positive sp value 4 has been found
// 402941: control flows out of bounds to 402942
// 4027E2: bad sp value at call
// 4027B7: too many input arguments, some ignored

//----- (0040281E) --------------------------------------------------------
#error "402856: cannot convert to microcode (funcsize=21)"

//----- (0040288B) --------------------------------------------------------
#error "4028CC: cannot convert to microcode (funcsize=25)"

//----- (00402979) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __thiscall sub_402979(_DWORD *this)
{
  ((void (__cdecl *)(_DWORD))loc_402617)(*this);
  JUMPOUT(0x402ADD);
}
// 402981: positive sp value 4 has been found
// 402AD8: control flows out of bounds to 402ADD

//----- (004029A7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4029A7()
{
  void *v0; // [esp+24h] [ebp-4h]
  void *retaddr; // [esp+28h] [ebp+0h]

  *(&retaddr - 11) = v0;
  JUMPOUT(0x40227B);
}
// 4029AB: positive sp value 4 has been found
// 4029B7: control flows out of bounds to 40227B

//----- (004029DB) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4029DB(unsigned int a1@<ecx>, __int16 a2@<bx>, __int16 a3@<di>, __int32 a4@<esi>)
{
  __int16 v5; // ax
  char v6; // bl
  void *v7; // [esp+8h] [ebp-4h]
  void *retaddr; // [esp+Ch] [ebp+0h]

  *(&retaddr - 4) = v7;
  sub_402CAC(a1 >> 15, a4);
  v6 = -(char)((((unsigned __int16)((a3 | (a2 - 1)) + _DX + v5) >> 8) ^ 0xFE)
             + (a3 | (a2 - 1))
             - ((-(char)(_DX + v5) | a4)
              - (_DX
               + v5)
              + 1));
  if ( !v6 )
    __asm { repne push dx }
  JUMPOUT(0x402529);
}
// 4025E0: positive sp value 4 has been found
// 403001: control flows out of bounds to 403002
// 402FEA: control flows out of bounds to 402529
// 402FF5: conditional instruction was optimized away because of 'bl.1==0'
// 4029FA: variable '_DX' is possibly undefined
// 4029FA: variable 'v5' is possibly undefined

//----- (00402A33) --------------------------------------------------------
#error "402A33: function frame is wrong (funcsize=0)"

//----- (00402BE1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402BE1()
{
  JUMPOUT(0x4028FE);
}
// 402BEA: positive sp value 4 has been found
// 402C04: control flows out of bounds to 402C09
// 402BF0: control flows out of bounds to 4028FE
// 402BFB: conditional instruction was optimized away because of 'bl.1>=1'

//----- (00402C83) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402C83()
{
  JUMPOUT(0x402868);
}
// 402C87: positive sp value 4 has been found
// 402C96: control flows out of bounds to 402868
// 402C9E: conditional instruction was optimized away because of 'ah.1>=0'

//----- (00402CAC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402CAC(int a1@<ecx>, __int32 a2@<esi>)
{
  sub_402F71(a1, a2);
  JUMPOUT(0x402CCB);
}
// 402CB0: positive sp value 4 has been found
// 402CCA: control flows out of bounds to 402CCB

//----- (00402DBA) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402DBA()
{
  void *v0; // [esp+20h] [ebp-4h]
  void *retaddr; // [esp+24h] [ebp+0h]

  *(&retaddr - 10) = v0;
  JUMPOUT(0x402C38);
}
// 402DBE: positive sp value 4 has been found
// 402DCD: control flows out of bounds to 402C38

//----- (00402E61) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402E61()
{
  JUMPOUT(0x4026E2);
}
// 402E65: positive sp value 4 has been found
// 402E6F: control flows out of bounds to 4026E2

//----- (00402E97) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __thiscall sub_402E97(void *this)
{
  __int32 v2; // [esp-4h] [ebp-4h] BYREF
  void *retaddr[2]; // [esp+0h] [ebp+0h]

  _InterlockedExchange(&v2, (__int32)this);
  ((void (*)(void))loc_402DD6)();
  return MK_FP(retaddr[0], retaddr[0])();
}
// 402B5C: positive sp value 4 has been found

//----- (00402F31) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402F31()
{
  JUMPOUT(0x402AA6);
}
// 402F94: positive sp value C has been found
// 402FB0: control flows out of bounds to 402FB1
// 402F3F: control flows out of bounds to 402AA6
// 402F6D: control flows out of bounds to 402F49
// 402F9A: control flows out of bounds to 40274A

//----- (00402F71) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402F71(int a1@<ecx>, __int32 a2@<esi>)
{
  __int32 v2; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v2, a2);
  ((void (__thiscall *)(int))loc_402558)(a1 << 15);
  JUMPOUT(0x402F9D);
}
// 402F78: positive sp value 4 has been found
// 402F87: control flows out of bounds to 402F9D

//----- (00403031) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
char __usercall sub_403031@<al>(int a1@<edx>, void *a2@<ecx>, int a3@<ebx>)
{
  char result; // al

  _EBX = a1 | a3;
  _AL = sub_402E97(a2);
  __asm { xlat }
  return result;
}
// 403046: positive sp value 8 has been found

//----- (0040308D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40308D(char a1@<cf>, int a2@<edx>, int a3@<ecx>, __int32 a4@<edi>)
{
  __int32 v4; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v4, a4);
  BYTE1(a2) = a1 + BYTE1(a2) - 82;
  LOBYTE(a2) = ~(a2 - 87);
  ((void (__fastcall *)(int, __int32))loc_402A14)(a3, v4 + a2);
  JUMPOUT(0x40283F);
}
// 403099: positive sp value 4 has been found
// 4030E0: control flows out of bounds to 402C68
// 4030C0: control flows out of bounds to 40283F

//----- (004030EC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4030EC(char a1@<ah>, unsigned int a2@<ebx>, _DWORD *a3@<edi>, int a4@<esi>)
{
  bool v6; // cf
  int v8; // eax
  unsigned __int32 v9; // eax
  char v10; // cl
  int v11; // edx
  int v12; // ecx
  int v13; // eax
  char v14; // dl
  char v15; // dh
  char v16; // ch
  int v17; // edx
  void *v18; // [esp+18h] [ebp-4h]
  void *retaddr; // [esp+1Ch] [ebp+0h]

  *(&retaddr - 8) = v18;
  BYTE1(a2) ^= a1;
  v6 = a2 < (unsigned int)a3;
  _EBX = a2 - (_DWORD)a3;
  BYTE1(_EBX) -= v6 + 44;
  LOBYTE(_EBX) = _EBX + 1;
  ++_EBX;
  LOBYTE(_EBX) = _EBX - 1;
  sub_4029A7();
  *a3 = v8;
  v9 = __indword(0x5Eu);
  LOBYTE(v11) = v11 + 1;
  BYTE1(_EBX) = -50;
  LOBYTE(v12) = _EBX ^ BYTE1(v12) ^ v10;
  BYTE1(v11) = -61;
  ((void (__fastcall *)(int, int))sub_4025F9)(v12, v11);
  LOBYTE(v13) = v13 & 0xE4;
  LOBYTE(v17) = ~(v14 + 110);
  BYTE1(v17) = (v16 | v15) - 39;
  sub_4022B6(v13 - 1, _EBX, (int)(a3 + 1), (v17 | _EBX ^ (a4 + 1)) + 1);
  __asm { xlat }
  JUMPOUT(0x4029A1);
}
// 402806: positive sp value 4 has been found
// 4029A0: control flows out of bounds to 4029A1
// 403106: variable 'v8' is possibly undefined
// 403110: variable 'v11' is possibly undefined
// 40310E: variable 'v12' is possibly undefined
// 40310E: variable 'v10' is possibly undefined
// 403128: variable 'v13' is possibly undefined
// 40312A: variable 'v14' is possibly undefined
// 40312D: variable 'v16' is possibly undefined
// 40312D: variable 'v15' is possibly undefined
// 403134: variable 'v17' is possibly undefined
// 4025F9: using guessed type double sub_4025F9();

// nfuncs=29 queued=29 decompiled=29 lumina nreq=0 worse=0 better=0
#error "There were 4 decompilation failure(s) on 29 function(s)"
