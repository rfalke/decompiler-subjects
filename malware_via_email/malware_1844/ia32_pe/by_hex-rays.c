/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall start@<eax>(void *a1@<ebx>, void *a2@<edi>, void *a3@<esi>);
// LPVOID __stdcall TlsGetValue(DWORD dwTlsIndex);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);
// BOOL __stdcall ResetEvent(HANDLE hEvent);
// BOOL __stdcall SetEvent(HANDLE hEvent);

//-------------------------------------------------------------------------
// Data declarations

char aIr31ykppcgj7dt[17] = "IR31yKPpcGJ7DtIH"; // weak
CHAR ProcName[] = "DllGetClassObject"; // idb
CHAR LibFileName[] = "ACTXPRXY.DLL"; // idb


//----- (0040107D) --------------------------------------------------------
int __usercall start@<eax>(void *a1@<ebx>, void *a2@<edi>, void *a3@<esi>)
{
  unsigned int v3; // eax
  int v4; // eax
  int v6; // [esp+0h] [ebp-34h]
  LPVOID v7; // [esp+4h] [ebp-30h]
  int v8; // [esp+8h] [ebp-2Ch]
  unsigned int v9; // [esp+8h] [ebp-2Ch]
  unsigned int v10; // [esp+8h] [ebp-2Ch]
  HMODULE hModule; // [esp+Ch] [ebp-28h]
  int v12; // [esp+10h] [ebp-24h]
  int v13; // [esp+14h] [ebp-20h]
  unsigned int v14; // [esp+18h] [ebp-1Ch]
  int v15; // [esp+18h] [ebp-1Ch]
  int v16; // [esp+1Ch] [ebp-18h]
  int v17; // [esp+1Ch] [ebp-18h]
  _BYTE *v18; // [esp+20h] [ebp-14h]
  int v19; // [esp+20h] [ebp-14h]
  int v20; // [esp+24h] [ebp-10h]
  int v21; // [esp+28h] [ebp-Ch] BYREF
  int v22; // [esp+2Ch] [ebp-8h]
  HRESULT (__stdcall *DllGetClassObject)(const IID *const, const IID *const, LPVOID *); // [esp+30h] [ebp-4h]
  int savedregs; // [esp+34h] [ebp+0h]

  v8 = SetEvent(HANDLE_FLAG_PROTECT_FROM_CLOSE|HANDLE_FLAG_INHERIT|0x8);
  v3 = (unsigned int)TlsGetValue(4u);
  if ( v3 != 2 )
    v8 &= v3;
  v4 = ResetEvent(a3);
  if ( v4 )
    v8 -= v4;
  v9 = (unsigned int)TlsGetValue(0x68u) | v8;
  TlsGetValue(0x38u);
  SetEvent((HANDLE)0x852028C0);
  SetEvent(a1);
  v14 = (unsigned int)TlsGetValue(0xFFFFFF97);
  if ( TlsGetValue(0xFFFFFFFC) == (LPVOID)88 )
    v22 = 88;
  SetEvent(a1);
  v10 = ResetEvent(a1) + v9;
  SetEvent((HANDLE)0xFFFFFFF6);
  ResetEvent((HANDLE)0xFFFFFFB6);
  SetEvent(a3);
  ResetEvent(a1);
  SetEvent((HANDLE)0x5084182);
  v18 = TlsGetValue(0xFFFFFFAD);
  hModule = LoadLibraryA(LibFileName);
  SetEvent((HANDLE)0xFFFFFF96);
  v7 = TlsGetValue(0x23u);
  ResetEvent(a3);
  DllGetClassObject = (HRESULT (__stdcall *)(const IID *const, const IID *const, LPVOID *))GetProcAddress(
                                                                                             hModule,
                                                                                             ProcName);
  SetEvent((HANDLE)0x14C1208);
  ResetEvent(a3);
  v15 = SetEvent(a2) | v14;
  ResetEvent((HANDLE)6);
  v19 = v18 - (_BYTE *)TlsGetValue(0x25u);
  if ( TlsGetValue(0x6Fu) == (LPVOID)2138856074 )
    v10 -= 2138856074;
  ResetEvent((HANDLE)0xFFFFFFC1);
  v17 = ((int (__stdcall *)(char *, _DWORD, int *, int, LPVOID, unsigned int, HMODULE, int, int, int, int, int, int, int, int, HRESULT (__stdcall *)(const IID *const, const IID *const, LPVOID *), int))DllGetClassObject)(
          aIr31ykppcgj7dt,
          0,
          &v21,
          v6,
          v7,
          v10,
          hModule,
          v12,
          v13,
          v15,
          v16,
          v19,
          v20,
          v21,
          v22,
          DllGetClassObject,
          savedregs);
  ResetEvent(a2);
  ResetEvent(HANDLE_FLAG_INHERIT);
  ResetEvent((HANDLE)0x8D460024);
  TlsGetValue(0xFFFFFFB6);
  TlsGetValue(0x48u);
  return ((int (*)(void))(v17 - 2143547081))();
}
// 4011CF: variable 'v6' is possibly undefined
// 4011CF: variable 'v12' is possibly undefined
// 4011CF: variable 'v13' is possibly undefined
// 4011CF: variable 'v16' is possibly undefined
// 4011CF: variable 'v20' is possibly undefined

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
