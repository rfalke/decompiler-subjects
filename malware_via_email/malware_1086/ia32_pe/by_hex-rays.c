/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// double __usercall sub_407D81@<st0>(int a1@<edx>, int _EBX@<ebx>, unsigned int a3@<edi>, unsigned int a4@<esi>, double result@<st0>);
// double __usercall sub_407F6D@<st0>(int a1@<eax>, int a2@<edx>, int _ECX@<ecx>, unsigned int a4@<edi>, unsigned int a5@<esi>, double a6@<st0>);


//----- (00407D81) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
double __usercall sub_407D81@<st0>(
        int a1@<edx>,
        int _EBX@<ebx>,
        unsigned int a3@<edi>,
        unsigned int a4@<esi>,
        double result@<st0>)
{
  unsigned int v6; // ecx
  unsigned int v8; // edx
  _BYTE *v9; // eax
  unsigned int v10; // esi
  unsigned int v11; // esi
  signed int v13; // edi
  int v18; // esi
  char v19; // bl
  char *v21; // eax
  unsigned int v22; // edi
  char v25; // bl
  bool v26; // tt
  unsigned int v27; // ecx
  unsigned int i; // eax
  __int16 v31; // cx
  __int16 v32; // cx
  unsigned int v33; // eax
  unsigned __int16 v39; // dx
  __int16 v40; // dx
  __int16 v42; // dx
  bool v43; // cf
  __int16 v49; // dx
  _BYTE *v50; // eax
  _DWORD *v51; // edi
  int v52; // esi
  int v54; // esi
  _BYTE *v55; // edi
  int v56; // edx
  unsigned int v57; // [esp-10h] [ebp-10h]
  int v58; // [esp-10h] [ebp-10h]
  _DWORD *v59; // [esp-10h] [ebp-10h]
  unsigned int v60; // [esp-Ch] [ebp-Ch]
  int *v61; // [esp-8h] [ebp-8h] BYREF
  int v62; // [esp-4h] [ebp-4h] BYREF

  v27 = (unsigned int)v59;
  for ( i = 1; i; i = ~((_EBX + a1 + HIWORD(*(_DWORD *)v27)) ^ 0xFFFFFEC8) )
  {
    _ECX = (v27 - 1) >> 15;
    if ( a1 == -2016821772 )
    {
      _EDX = -1740351629;
      LOBYTE(i) = __inbyte(0x5773u);
      goto LABEL_4;
    }
    v27 = _ECX << 15;
    a1 = (unsigned __int8)*(_DWORD *)v27;
    _EBX = (unsigned __int8)BYTE1(*(_DWORD *)v27);
  }
  v21 = (char *)(*(_DWORD *)(v27 + 60) + v27);
  v57 = *((_DWORD *)v21 + 20);
  v9 = (_BYTE *)*((_DWORD *)v21 + 32);
  if ( _EBX == -1739255616 )
  {
    result = result + *(double *)(a4 - 2102208742);
    v22 = a3 | 0x817F76AF;
    __asm { rcl     ebx, 15h }
    v43 = __CFADD__((_WORD)v22, (_WORD)a4);
    LOWORD(a4) = v22 + a4;
    _ECX = v27 ^ 0xDB5F4AB5;
    LOWORD(v22) = __ROL2__(v22 - 1, _ECX);
    BYTE1(a1) = 0;
    BYTE1(_EBX) = (v43 + BYTE1(_EBX) - 15) << 6;
    if ( v9 == (_BYTE *)368007773 )
      JUMPOUT(0x407CB0);
    LOWORD(a1) = a1 + 1;
    BYTE1(_EBX) -= ((unsigned int)v9 < 0x15EF5A5D) + BYTE1(v9);
    _EDX = _EBX ^ a1;
    v43 = (unsigned __int8)_EDX < (unsigned __int8)_ECX;
    LOBYTE(_EDX) = _EDX - _ECX;
    __asm { rcl     bl, 19h }
  }
  else
  {
    while ( 1 )
    {
      (*(void (__cdecl **)(unsigned int))(v27 + *(_DWORD *)&v9[v27 + 16]))(v57);
      _ECX = v58;
      i = v60;
      a3 = a3 - (v43 - 818238311) - ((a3 < (unsigned int)v43 - 818238311) - 1770180891);
      __asm { rcl     dl, 2 }
      if ( _EBX == 960483827 )
        break;
LABEL_4:
      v31 = _ECX + 31914;
      BYTE1(_EDX) = 0;
      a3 <<= 22;
      --HIBYTE(v31);
      v32 = a3 + v31;
      v43 = i < 0xFFFFFB6F;
      v33 = i + 1169;
      BYTE1(_EBX) -= v43 + HIBYTE(v32);
      LOBYTE(_EBX) = v32;
      v6 = a3;
      a4 |= 0x80AA79A2;
      __asm { rcl     edx, 17h }
      v57 = v33;
      BYTE1(v6) = BYTE1(a3) - 34;
      v8 = a3 & _EDX;
      v27 = v6 - 1604961620;
      BYTE1(v8) = ((unsigned __int8)v27 ^ BYTE1(v8)) << v27;
      if ( v33 != -1503436380 )
      {
        if ( (v33 ^ a3) == 284576363 )
          JUMPOUT(0x407F66);
LABEL_41:
        JUMPOUT(0x407C7B);
      }
      LOBYTE(v8) = -7;
      v9 = (_BYTE *)(v8 | 0xA66361A4);
    }
    v9 = (_BYTE *)_EDX;
    v10 = a4 + 1;
    *(_DWORD *)(v10 + 27) = &v61;
    ++*(_BYTE *)(v58 - 2015459106);
    v11 = ((v10 - 1) & 0x84734F5F) + 1;
    _EDX = v60 + 1817666761;
    LOWORD(a3) = a3 + 11789;
    v13 = a3 | 0x393FD1F3;
    LOWORD(v11) = __ROR2__(v11, v58);
    a4 = v11 ^ 0x393FD1F3;
    v22 = v13 >> 23;
    LOWORD(v22) = _EDX ^ v22;
    v43 = v60 >= 0x93A89B37;
    if ( !v60 )
    {
      BYTE1(_EDX) = -17;
      LOWORD(_EDX) = __ROL2__(_EDX, v58);
      BYTE1(_EDX) <<= v58;
      _AH = BYTE1(v9) | 0x29;
      if ( a4 == -1001971521 )
        JUMPOUT(0x407EA8);
      _CL = __ROR4__(v58 >> 5, v58 >> 5);
      __asm
      {
        rcl     edx, cl
        rcl     ah, 3
        rcr     cl, cl
      }
      return result;
    }
  }
  v54 = ~a4;
  v55 = &v9[v43 + v22];
  LOBYTE(_EDX) = _EDX | 0xF0;
  LOWORD(v55) = (_WORD)v55 << _ECX;
  v56 = __ROR4__(_EDX, 7);
  if ( v9 == (_BYTE *)915862002 )
    JUMPOUT(0x407FF7);
  LOWORD(v54) = ~(_WORD)v54;
  _EDX = __ROL4__(v56 - (((unsigned int)v9 < 0x3696F1F2) - 2108909017), _ECX);
  v43 = __CFADD__(v55, -2131085714);
  v51 = v55 - 2131085714;
  v52 = v54 - (v43 + 1883908057);
  BYTE1(_EDX) ^= BYTE1(_ECX);
  LOWORD(_EDX) = _EDX + 1;
  LOBYTE(_EDX) = (BYTE1(v9) | (unsigned __int8)_EDX) << _ECX;
  __asm { rcr     dl, cl }
  LOBYTE(_EDX) = 0;
  if ( _ECX == 220656231 )
  {
    if ( *v51 < (int)v9 )
      JUMPOUT(0x407FCE);
    JUMPOUT(0x407FDA);
  }
  BYTE1(_EDX) <<= _ECX;
  LOBYTE(_EBX) = *v9 ^ 0x6C;
  __asm { rcl     dh, cl }
  _EDX = _EDX << _ECX;
  if ( _EBX != 228553793 )
  {
    __asm { rcl     dh, cl }
    LOBYTE(_EBX) = ~(_BYTE)_EBX;
    _ESI = v52 ^ 0x3C069243;
    _EDX = (_ESI & 0xF0D62B55) << 13;
    if ( _ECX != -471605817 )
    {
      LOBYTE(_EDX) = -BYTE1(v9);
      __asm { rcr     edx, 10h }
      v26 = __CFSHL__(_EBX, 17);
      LOBYTE(_EBX) = __ROL1__(_EBX, 17);
      LOBYTE(_EDX) = BYTE1(_EBX) + v26 + _EDX + 1;
      if ( v9 != (_BYTE *)-511627686 )
      {
        __asm
        {
          rcl     esi, 17h
          rcr     dh, cl
        }
        LOBYTE(_EDX) = _EDX & 0xC0;
        __asm { rcl     dl, 18h }
        v18 = -_ESI;
        v19 = v25 - 122;
        __asm { rcr     dl, 17h }
        BYTE1(_EDX) = __ROR1__(BYTE1(_EDX), _ECX);
        LOBYTE(_EDX) = -(char)_EDX;
        v43 = _EDX < 0x10B4C61A;
        __asm { rcl     dl, 2 }
        _ESI = _ECX + v43 + v18;
        if ( v9 == (_BYTE *)1437156323 )
          JUMPOUT(0x407CFA);
        __asm { rcr     esi, 3 }
        _EDX = 1733338151;
        __asm
        {
          rcl     dh, cl
          rcr     edx, 0Eh
          rcl     dl, cl
        }
        *v9 = v19;
        v39 = _EDX & 0xCDA0;
        if ( _ESI != -1459631362 )
        {
          LOBYTE(v49) = -(char)v9;
          v50 = v9 + 1;
          HIBYTE(v49) = -17;
          v43 = __CFSHL__(v49, _ECX);
          v40 = v49 << _ECX;
          HIBYTE(v40) = __ROL1__(v43 + HIBYTE(v40) + 122, _ECX);
          _SI = 12808;
          v43 = __CFSHR__(v40, 28);
          LOBYTE(v40) = (char)v40 >> 7;
          HIBYTE(v40) += v40 + v43;
          v42 = (_WORD)v50 + v40;
          _DX = -v42 ^ 0xB924;
          __asm { rcl     si, cl }
          _CL = _ECX - 1;
          __asm { rcr     dh, cl }
          if ( v50 == (_BYTE *)-1557258365 )
          {
            v61 = &v62;
            JUMPOUT(0x407DF5);
          }
          JUMPOUT(0x407BB7);
        }
        __outbyte(v39, (unsigned __int8)v9);
        __debugbreak();
        __asm { int     0C4h; used by BASIC while in interpreter }
        goto LABEL_41;
      }
    }
  }
  return result;
}
// 407CFD: positive sp value 10 has been found
// 407CAA: control flows out of bounds to 407CB0
// 407CF9: control flows out of bounds to 407CFA
// 407DF4: control flows out of bounds to 407DF5
// 407EA7: control flows out of bounds to 407EA8
// 407F60: control flows out of bounds to 407F66
// 407FCC: control flows out of bounds to 407FCE
// 407FF2: control flows out of bounds to 407FF7
// 407D19: control flows out of bounds to 407C7B
// 407D3B: control flows out of bounds to 407BB7
// 407FCA: control flows out of bounds to 407FDA
// 407FCC: control flows out of bounds to 407FE1
// 407D81: variable 'v59' is possibly undefined
// 407B8F: variable 'v58' is possibly undefined
// 407B95: variable 'v60' is possibly undefined
// 407B96: variable 'v43' is possibly undefined
// 407BB4: variable '_EDX' is possibly undefined

//----- (00407F6D) --------------------------------------------------------
double __usercall sub_407F6D@<st0>(
        int a1@<eax>,
        int a2@<edx>,
        int _ECX@<ecx>,
        unsigned int a4@<edi>,
        unsigned int a5@<esi>,
        double a6@<st0>)
{
  double v6; // st7
  int v7; // edx
  __int16 v9; // bx
  __int16 v10; // bx
  unsigned int v11; // edi

  LOBYTE(a1) = (_BYTE)a1 << _ECX;
  v9 = _ECX;
  BYTE1(a1) &= a1;
  BYTE1(_ECX) = a1 << _ECX;
  v10 = -v9;
  v11 = (a4 >> _ECX) + 1027841828;
  __asm { rcr     ecx, cl }
  v6 = sub_407D81(a2, v10, v11, a5, a6);
  return sub_407D81(v7, v10, v11, a5, v6);
}
// 407CC2: inconsistent fpu stack
// 407CC2: variable 'v7' is possibly undefined

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
