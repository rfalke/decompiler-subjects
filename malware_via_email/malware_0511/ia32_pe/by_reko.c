// subject_data_0000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

byte g_b3E3000 = 0x43; // 003E3000
uint32 g_dw3E8803 = 0x5800; // 003E8803
Eq_32 g_t3E8810 = null; // 003E8810
Eq_32 g_t3E8814 = null; // 003E8814
Eq_33 g_t3E8818 = null; // 003E8818
Eq_3 g_t3E881C = // 003E881C
	{
		null
	};
// subject_data_0002.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw40FF0E = 0x00; // 0040FF0E
word32 g_dw40FF12 = 0x00; // 0040FF12
word32 g_dw40FF16 = 0x00; // 0040FF16
word32 g_dw40FF1A = 0x00; // 0040FF1A
// subject_rdata.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__VirtualProtect = &g_t20BC; // 003E2000
<anonymous> * __imp__GetProcAddress = &g_t20CE; // 003E2004
<anonymous> * __imp__LoadLibraryA = &g_t20E0; // 003E2008
<anonymous> * __imp__GetModuleHandleA = &g_t20F0; // 003E200C
<anonymous> * __imp__ReadFile = &g_t2104; // 003E2010
<anonymous> * __imp__WriteFile = &g_t2110; // 003E2014
<anonymous> * __imp__CloseHandle = &g_t211C; // 003E2018
<anonymous> * __imp__CreateThread = &g_t212A; // 003E201C
<anonymous> * __imp__CreatePipe = &g_t213A; // 003E2020
<anonymous> * __imp__ExitProcess = &g_t2148; // 003E2024
byte g_b3E2030 = 0x6B; // 003E2030
byte g_b3E2040 = 0x47; // 003E2040
byte g_b3E2054 = 0x47; // 003E2054
word32 g_dw3E2090 = 8380; // 003E2090
word32 g_dw3E2094 = 8398; // 003E2094
word32 g_dw3E2098 = 0x20E0; // 003E2098
word32 g_dw3E209C = 0x20F0; // 003E209C
word32 g_dw3E20A0 = 0x2104; // 003E20A0
word32 g_dw3E20A4 = 0x2110; // 003E20A4
word32 g_dw3E20A8 = 0x211C; // 003E20A8
word32 g_dw3E20AC = 0x212A; // 003E20AC
word32 g_dw3E20B0 = 0x213A; // 003E20B0
word32 g_dw3E20B4 = 0x2148; // 003E20B4
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 003E1000: Register word32 fn003E1000(Stack Eq_3 dwArg04)
// Called from:
//      fn003E1432
word32 fn003E1000(Eq_3 dwArg04)
{
	return dwArg04 + Mem14[dwArg04 + 60:word32];
}

// 003E101C: void fn003E101C(Register word32 ecx, Stack (ptr32 byte) dwArg04, Stack Eq_3 dwArg08, Stack Eq_11 dwArg0C)
// Called from:
//      fn003E1432
void fn003E101C(word32 ecx, byte * dwArg04, Eq_3 dwArg08, Eq_11 dwArg0C)
{
	Eq_12 tLoc08;
	tLoc08 = (Eq_12) ecx;
	fn003E1944(dwArg08, dwArg04, dwArg0C);
	VirtualProtect(dwArg08, dwArg0C, 0x02, &tLoc08);
}

int32 g_t3E1050() = ??/* Unexpected function type (fn int32 ()) */ ; // 003E1050
int32 g_t3E1081() = ??/* Unexpected function type (fn int32 ()) */ ; // 003E1081
// 003E10B3: Register Eq_32 fn003E10B3(Stack Eq_33 dwArg04, Stack Eq_34 dwArg08, Stack Eq_34 dwArg0C)
// Called from:
//      fn003E1138
Eq_32 fn003E10B3(Eq_33 dwArg04, Eq_34 dwArg08, Eq_34 dwArg0C)
{
	Eq_32 eax_126;
	Eq_32 eax_17 = GetProcAddress(dwArg04, dwArg0C);
	if (fn003E1A34(dwArg08, &g_b3E2030) == 0x00)
	{
		if (fn003E19B0(dwArg0C, &g_b3E2040) == 0x00)
		{
			g_t3E8810 = eax_17;
			eax_126 = (Eq_32) &g_t3E1050;
			return eax_126;
		}
		if (fn003E19B0(dwArg0C, &g_b3E2054) == 0x00)
		{
			g_t3E8814 = eax_17;
			eax_126 = (Eq_32) &g_t3E1081;
			return eax_126;
		}
	}
	eax_126 = eax_17;
	return eax_126;
}

// 003E1125: Register byte fn003E1125(Stack ui32 dwArg04)
// Called from:
//      fn003E1138
byte fn003E1125(ui32 dwArg04)
{
	return (byte) ((dwArg04 & 0x80000000) != 0x00);
}

// 003E1138: void fn003E1138(Stack (ptr32 Eq_77) dwArg04, Stack Eq_3 dwArg08)
// Called from:
//      fn003E1432
void fn003E1138(struct Eq_77 * dwArg04, Eq_3 dwArg08)
{
	g_t3E8818 = GetModuleHandleA(null);
	g_t3E881C.u0 = (struct Eq_689 *) dwArg08;
	struct Eq_88 * dwLoc08_247 = dwArg08.u0 + dwArg04->dw0080;
	while (dwLoc08_247->dw000C != 0x00)
	{
		union Eq_93 * dwLoc10_255;
		Eq_34 ecx_57 = dwArg08.u0 + dwLoc08_247->dw000C;
		Eq_33 eax_62 = LoadLibraryA(ecx_57);
		if (dwLoc08_247->dw0004 == 0x00)
			dwLoc10_255 = (union Eq_93 *) (dwArg08.u0 + dwLoc08_247->dw0010);
		else
			dwLoc10_255 = (union Eq_93 *) (dwArg08.u0 + dwLoc08_247->dw0000);
		word32 * dwLoc18_259 = dwArg08.u0 + dwLoc08_247->dw0010;
		while (dwLoc10_255->u1 != 0x00)
		{
			Eq_32 dwLoc14_267;
			if ((word32) fn003E1125(dwLoc10_255->u1) != 0x00)
				dwLoc14_267 = GetProcAddress(eax_62, (word32) dwLoc10_255->u0);
			else
				dwLoc14_267 = fn003E10B3(eax_62, ecx_57, dwArg08.u0 + dwLoc10_255->u1 + 2);
			*dwLoc18_259 = (word32) dwLoc14_267;
			++dwLoc18_259;
			dwLoc10_255 = (union Eq_93 *) ((char *) dwLoc10_255 + 4);
		}
		++dwLoc08_247;
	}
}

// 003E1260: void fn003E1260(Register word32 ecx, Stack Eq_170 dwArg04, Stack Eq_3 dwArg08, Stack word32 dwArg0C)
// Called from:
//      fn003E12CE
void fn003E1260(word32 ecx, Eq_170 dwArg04, Eq_3 dwArg08, word32 dwArg0C)
{
	Eq_12 tLoc08;
	tLoc08 = (Eq_12) ecx;
	tLoc08 = (Eq_12) 0x00;
	do
		;
	while (ReadFile(dwArg04, dwArg08, dwArg0C - tLoc08, &tLoc08, null) != 0x00 && tLoc08 != dwArg0C);
}

// 003E1297: void fn003E1297(Register word32 ecx, Stack Eq_170 dwArg04, Stack Eq_207 dwArg08, Stack word32 dwArg0C)
// Called from:
//      fn003E12CE
void fn003E1297(word32 ecx, Eq_170 dwArg04, Eq_207 dwArg08, word32 dwArg0C)
{
	Eq_12 tLoc08;
	tLoc08 = (Eq_12) ecx;
	tLoc08 = (Eq_12) 0x00;
	do
		;
	while (WriteFile(dwArg04, dwArg08, dwArg0C - tLoc08, &tLoc08, null) != 0x00 && tLoc08 != dwArg0C);
}

// 003E12CE: void fn003E12CE(Stack (ptr32 Eq_241) dwArg04, Stack word32 dwArg08, Stack uint32 dwArg0C)
// Called from:
//      fn003E1432
void fn003E12CE(struct Eq_241 * dwArg04, word32 dwArg08, uint32 dwArg0C)
{
	uint32 dwLoc08_103;
	for (dwLoc08_103 = 0x00; dwLoc08_103 < dwArg0C; dwLoc08_103 += 0x02)
	{
		fn003E1297(dwArg08, dwArg04->t0004, dwArg08 + dwLoc08_103 * 0x04, 0x08);
		fn003E1260(dwArg08, dwArg04->t0000, dwArg08 + dwLoc08_103 * 0x04, 0x08);
	}
}

DWORD g_t3E1322(LPVOID lpThreadParameter) = ??/* Unexpected function type (fn DWORD (LPVOID)) */ ; // 003E1322
// 003E1415: void fn003E1415(Stack (ptr32 Eq_269) dwArg04)
// Called from:
//      fn003E1432
void fn003E1415(struct Eq_269 * dwArg04)
{
	CloseHandle(dwArg04->t0000);
	CloseHandle(dwArg04->t0004);
}

// 003E1432: Register word32 fn003E1432()
// Called from:
//      Win32CrtStartup
word32 fn003E1432()
{
	Eq_285 tLoc24;
	Eq_286 tLoc18;
	Eq_12 tLoc0C;
	struct Eq_288 * eax_18 = fn003E15D0()->ptr0030;
	if ((word32) eax_18->b0002 == 0x00)
	{
		g_dw40FF0E = 5900;
		g_dw40FF0E += 22702;
		g_dw40FF12 = 0x24C5;
		g_dw40FF16 = 0x17F4;
		g_dw40FF16 += 22574;
		g_dw40FF1A = 0x4BC0;
		if (CreatePipe(&tLoc24, (char *) &tLoc18 + 4, null, 0x10) != 0x00 && CreatePipe(&tLoc18, (char *) (&tLoc24) + 4, null, 0x10) != 0x00)
		{
			Eq_170 eax_84 = CreateThread(null, 0x00, &g_t3E1322, &tLoc24, 0x00, &tLoc0C);
			fn003E12CE(&tLoc18, 0x003E3000, g_dw3E8803 >> 0x02);
			fn003E1415(&tLoc18);
			fn003E1415(&tLoc24);
			CloseHandle(eax_84);
			struct Eq_77 * eax_123 = fn003E1000(0x003E3000);
			if (eax_123 != null)
			{
				Eq_3 eax_135 = eax_123->t0034.u0;
				fn003E101C(0x003E3000, &g_b3E3000, eax_135, eax_123->t0054);
				fn003E15E0(eax_123, 0x003E3000, eax_135);
				struct Eq_77 * eax_174 = fn003E1000(eax_135);
				if (eax_174 != null)
				{
					fn003E1138(eax_174, eax_135);
					fn003E1778(eax_174, eax_135);
					eax_18->t0008.u0 = (struct Eq_689 *) eax_135;
					<anonymous> * ecx_230 = eax_135.u0 + eax_123->dw0028;
					ecx_230();
				}
			}
		}
	}
	return 0x00;
}

// 003E15B6: Register Eq_12 Win32CrtStartup()
Eq_12 Win32CrtStartup()
{
	ExitProcess(fn003E1432());
}

// 003E15D0: Register word32 fn003E15D0()
// Called from:
//      fn003E1432
word32 fn003E15D0()
{
	struct Eq_444 * fs;
	return fs->dw0018;
}

// 003E15E0: void fn003E15E0(Stack (ptr32 Eq_77) dwArg04, Stack word32 dwArg08, Stack Eq_3 dwArg0C)
// Called from:
//      fn003E1432
void fn003E15E0(struct Eq_77 * dwArg04, word32 dwArg08, Eq_3 dwArg0C)
{
	word16 ax_21 = dwArg04->w0006;
	word16 wLoc14_167;
	for (wLoc14_167 = 0x00; (word32) wLoc14_167 < (word32) ax_21; ++wLoc14_167)
	{
		Eq_11 dwLoc2C_174;
		Eq_11 v17_46 = (&dwArg04->dw0080 + 30)[((word32) wLoc14_167 *s 0x28 + 8) / 0x0084];
		Eq_11 eax_60 = (&dwArg04->dw0080 + 30)[((word32) wLoc14_167 *s 0x28 + 16) / 0x0084];
		if (v17_46 < eax_60)
			dwLoc2C_174 = v17_46;
		else
			dwLoc2C_174 = eax_60;
		fn003E1944(dwArg0C + Mem95[(CONVERT(wLoc14_167, word16, word32) *s 0x28 + 0x0C) + (dwArg04 + 0xF8):word32], dwArg08 + Mem109[(CONVERT(wLoc14_167, word16, word32) *s 0x28 + 20) + (dwArg04 + 0xF8):word32], dwLoc2C_174);
	}
}

// 003E16AE: Register ui32 fn003E16AE(Stack ui32 dwArg04)
// Called from:
//      fn003E1778
ui32 fn003E16AE(ui32 dwArg04)
{
	ui32 dwLoc08_225 = 0x00;
	if ((dwArg04 & 0x04000000) != 0x00)
		dwLoc08_225 = 0x0200;
	ui32 dwLoc08_230;
	if ((dwArg04 & 0x20000000) != 0x00)
	{
		if ((dwArg04 & 0x40000000) != 0x00)
		{
			if ((dwArg04 & 0x80000000) != 0x00)
				dwLoc08_230 = dwLoc08_225 | 0x40;
			else
				dwLoc08_230 = dwLoc08_225 | 0x20;
		}
		else if ((dwArg04 & 0x80000000) != 0x00)
			dwLoc08_230 = dwLoc08_225 | 0x80;
		else
			dwLoc08_230 = dwLoc08_225 | 0x10;
	}
	else if ((dwArg04 & 0x40000000) != 0x00)
	{
		if ((dwArg04 & 0x80000000) != 0x00)
			dwLoc08_230 = dwLoc08_225 | 0x04;
		else
			dwLoc08_230 = dwLoc08_225 | 0x02;
	}
	else if ((dwArg04 & 0x80000000) != 0x00)
		dwLoc08_230 = dwLoc08_225 | 0x08;
	else
		dwLoc08_230 = dwLoc08_225 | 0x01;
	return dwLoc08_230;
}

// 003E1778: void fn003E1778(Stack (ptr32 Eq_77) dwArg04, Stack Eq_3 dwArg08)
// Called from:
//      fn003E1432
void fn003E1778(struct Eq_77 * dwArg04, Eq_3 dwArg08)
{
	ptr32 fp;
	word16 ax_21 = dwArg04->w0006;
	word16 wLoc14_101;
	for (wLoc14_101 = 0x00; (word32) wLoc14_101 < (word32) ax_21; ++wLoc14_101)
		VirtualProtect(dwArg08 + Mem31[(CONVERT(wLoc14_101, word16, word32) *s 0x28 + 0x0C) + (dwArg04 + 0xF8):word32], Mem44[CONVERT(wLoc14_101, word16, word32) *s 0x28 + 8 + (dwArg04 + 0xF8):word32], fn003E16AE(Mem53[CONVERT(wLoc14_101, word16, word32) *s 0x28 + 36 + (dwArg04 + 0xF8):word32]), fp - 24);
}

// 003E1810: Register int32 fn003E1810(Stack int32 dwArg04)
// Called from:
//      fn003E1A34
int32 fn003E1810(int32 dwArg04)
{
	int32 eax_14;
	if (dwArg04 >= 0x41 && dwArg04 <= 0x5A)
		eax_14 = dwArg04 + 0x20;
	else
		eax_14 = dwArg04;
	return eax_14;
}

// 003E1944: void fn003E1944(Stack Eq_3 dwArg04, Stack (ptr32 byte) dwArg08, Stack Eq_11 dwArg0C)
// Called from:
//      fn003E101C
//      fn003E15E0
void fn003E1944(Eq_3 dwArg04, byte * dwArg08, Eq_11 dwArg0C)
{
	while (true)
	{
		--dwArg0C;
		if (dwArg0C == 0x00)
			break;
		dwArg04.u0->b0000 = *dwArg08;
		&dwArg04.u0->b0000 = (word32) dwArg04 + 1;
		++dwArg08;
	}
}

// 003E19B0: Register Eq_627 fn003E19B0(Stack Eq_34 dwArg04, Stack (ptr32 byte) dwArg08)
// Called from:
//      fn003E10B3
Eq_627 fn003E19B0(Eq_34 dwArg04, byte * dwArg08)
{
	while (true)
	{
		Eq_627 eax_27 = *dwArg04 - *dwArg08;
		Eq_627 dwLoc08_84 = eax_27;
		if (eax_27 != 0x00 || (int32) (*dwArg08) == 0x00)
			break;
		dwArg04 = (Eq_34) (dwArg04 + 1);
		++dwArg08;
	}
	if (eax_27 < 0x00)
		dwLoc08_84.u0 = ~0x00;
	else if (eax_27 > 0x00)
		dwLoc08_84.u0 = 0x01;
	return dwLoc08_84;
}

// 003E1A34: Register word32 fn003E1A34(Stack Eq_34 dwArg04, Stack (ptr32 byte) dwArg08)
// Called from:
//      fn003E10B3
word32 fn003E1A34(Eq_34 dwArg04, byte * dwArg08)
{
	do
	{
		word32 eax_23 = fn003E1810((word32) *dwArg04);
		dwArg04 = (Eq_34) (dwArg04 + 1);
		word32 eax_41 = fn003E1810((word32) *dwArg08);
		++dwArg08;
	} while (eax_23 != 0x00 && eax_23 == eax_41);
	return eax_23 - eax_41;
}

