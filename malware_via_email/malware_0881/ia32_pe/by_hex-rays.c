/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start();
void __noreturn sub_40109D();
// void __usercall sub_4041A9(int@<eax>, int _EDX@<edx>, double@<st6>, double@<st4>, double@<st0>);


//----- (00401073) --------------------------------------------------------
void __noreturn start()
{
  sub_40109D();
}

//----- (0040109D) --------------------------------------------------------
void __noreturn sub_40109D()
{
  struct _EXCEPTION_REGISTRATION_RECORD *ExceptionList; // [esp-4h] [ebp-4h] BYREF

  ExceptionList = NtCurrentTeb()->NtTib.ExceptionList;
  __writefsdword(0, (unsigned int)&ExceptionList);
  __halt();
}

//----- (004041A9) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4041A9(int a1@<eax>, int _EDX@<edx>, double a3@<st6>, double a4@<st4>, double a5@<st0>)
{
  int v7; // ebx
  int v8; // esi
  int v12; // ecx
  unsigned int v13; // edi
  int v15; // edx
  int savedregs; // [esp+0h] [ebp+0h]
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  while ( 1 )
  {
    v7 = -834774907;
    if ( _SF != _OF )
      v7 = (int)&retaddr;
    v8 = (unsigned __int16)(savedregs >> 11);
    __asm { rep sub dword ptr [edx], 5BF21DB6h }
    v12 = v7 ^ (savedregs >> 31);
    if ( __OFSUB__((_BYTE)_EDX, (_BYTE)v12) )
    {
      v8 = -1049905283;
      __asm
      {
        fsubr   st(2), st
        fsubr   st, st
      }
    }
    _BitScanReverse(&v13, v12);
    __asm { fsubr   st(6), st }
    _ESI = (v12 >> 20) & v13 & (1 - v8);
    v15 = _EDX + 4;
    __asm
    {
      rcr     esi, 42h
      fcom    st(4)
      repne cmc
    }
    if ( v15 >= a1 )
    {
      _ESI = 0;
      __asm
      {
        repne mov esi, [esi+12735A1Dh]
        bnd retn
      }
    }
    sub_4041A9(a1, v15, a3, a4, a5);
    _enable();
  }
}
// 404190: positive sp value 4 has been found
// 4041FD: inconsistent fpu stack
// 4042A9: unbalanced stack, ignored a potential tail call
// 4041D3: variable '_SF' is possibly undefined
// 4041D3: variable '_OF' is possibly undefined
// 4041DF: variable 'savedregs' is possibly undefined
// 4041F1: variable '_EDX' is possibly undefined
// 404270: variable 'a1' is possibly undefined

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
