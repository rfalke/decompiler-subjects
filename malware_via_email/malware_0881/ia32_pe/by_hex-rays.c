/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start();
void __noreturn sub_40109D();
// void __usercall sub_4041A9(int a1@<eax>, int _EDX@<edx>, double a3@<st6>, double a4@<st4>, double a5@<st0>);


//----- (00401073) --------------------------------------------------------
void __noreturn start()
{
  sub_40109D();
}

//----- (0040109D) --------------------------------------------------------
void __noreturn sub_40109D()
{
  struct _EXCEPTION_REGISTRATION_RECORD *v0; // [esp-4h] [ebp-4h] BYREF

  v0 = NtCurrentTeb()->NtTib.ExceptionList;
  __writefsdword(0, (unsigned int)&v0);
  __halt();
}

//----- (004041A9) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4041A9(int a1@<eax>, int _EDX@<edx>, double a3@<st6>, double a4@<st4>, double a5@<st0>)
{
  int v7; // ebx
  int v8; // esi
  int v11; // ecx
  unsigned int v12; // edi
  int savedregs; // [esp+0h] [ebp+0h]
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  while ( 1 )
  {
    v7 = -834774907;
    if ( _SF != _OF )
      v7 = (int)&retaddr;
    v8 = (unsigned __int16)(savedregs >> 11);
    __asm { rep sub dword ptr [edx], 5BF21DB6h }
    v11 = v7 ^ (savedregs >> 31);
    if ( __OFSUB__((_BYTE)_EDX, (_BYTE)v11) )
    {
      v8 = -1049905283;
      a4 = a3 - a4;
      a3 = a3 - a3;
    }
    _BitScanReverse(&v12, v11);
    a5 = a3 - a5;
    _ESI = (v11 >> 20) & v12 & (1 - v8);
    __asm
    {
      rcr     esi, 42h
      repne cmc
    }
    if ( _EDX + 4 >= a1 )
    {
      _ESI = 0;
      __asm
      {
        repne mov esi, [esi+12735A1Dh]
        bnd retn
      }
    }
    a1 = ((int (__thiscall *)(int))sub_4041A9)(-39205181);
    _enable();
  }
}
// 404190: positive sp value 4 has been found
// 4041D3: variable '_SF' is possibly undefined
// 4041D3: variable '_OF' is possibly undefined
// 4041DF: variable 'savedregs' is possibly undefined
// 4041F1: variable '_EDX' is possibly undefined

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
