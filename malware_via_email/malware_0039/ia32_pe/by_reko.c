// subject_idata.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw40602C = 24744; // 0040602C
word32 g_dw406030 = 0x60B8; // 00406030
word32 g_dw406034 = 0x60CC; // 00406034
word32 g_dw406038 = 0x60DC; // 00406038
word32 g_dw40603C = 24824; // 0040603C
word32 g_dw406040 = 0x6110; // 00406040
word32 g_dw406044 = 24868; // 00406044
word32 g_dw406048 = 24888; // 00406048
word32 g_dw40604C = 0x614C; // 0040604C
word32 g_dw406050 = 24924; // 00406050
word32 g_dw406054 = 24944; // 00406054
word32 g_dw406058 = 24964; // 00406058
word32 g_dw40605C = 24988; // 0040605C
word32 g_dw406060 = 25000; // 00406060
<anonymous> * __imp__CloseHandle = &g_t60A8; // 0040606C
<anonymous> * __imp__CreateProcessA = &g_t60B8; // 00406070
<anonymous> * __imp__ExitProcess = &g_t60CC; // 00406074
<anonymous> * __imp__GetEnvironmentVariableA = &g_t60DC; // 00406078
<anonymous> * __imp__GetModuleFileNameA = &g_t60F8; // 0040607C
<anonymous> * __imp__GetShortPathNameA = &g_t6110; // 00406080
<anonymous> * __imp__GetThreadContext = &g_t6124; // 00406084
<anonymous> * __imp__ReadProcessMemory = &g_t6138; // 00406088
<anonymous> * __imp__ResumeThread = &g_t614C; // 0040608C
<anonymous> * __imp__SetThreadContext = &g_t615C; // 00406090
<anonymous> * __imp__VirtualAllocEx = &g_t6170; // 00406094
<anonymous> * __imp__WriteProcessMemory = &g_t6184; // 00406098
<anonymous> * __imp__lstrcatA = &g_t619C; // 0040609C
<anonymous> * __imp__lstrcpyA = &g_t61A8; // 004060A0
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	ptr32 fp;
	word32 ebx;
	int32 edi;
	struct Eq_6 * ebp_18;
	word32 edx_19;
	fn00401133(fn00401078(fp - 4, out edx_19, out ebp_18), edx_19, ebx, ebp_18, edi);
	struct Eq_26 * esp_40 = (struct Eq_26 *) <invalid>;
	esp_40->dw0004 = 0x062E;
	esp_40->dw0000 = 0x00401133;
	word32 ebp_57;
	word32 edx_58;
	fn00401078(ebp_18, out edx_58, out ebp_57);
	return 0x00;
}

// 00401078: Register word32 fn00401078(Register (ptr32 Eq_6) ebp, Register out ptr32 edxOut, Register out ptr32 ebpOut)
// Called from:
//      Win32CrtStartup
word32 fn00401078(struct Eq_6 * ebp, ptr32 & edxOut, ptr32 & ebpOut)
{
	Eq_44 tLoc04;
	tLoc04.ptr0000 = ebp;
	ptr32 ebp_12;
	ptr32 edx_14;
	word32 eax_11 = fn00401127(&tLoc04, out edx_14, out ebp_12);
	edxOut = edx_14;
	ebpOut = ebp_12;
	return eax_11;
}

// 004010F1: Register word32 fn004010F1(Register out ptr32 edxOut)
// Called from:
//      fn00401127
//      fn00401133
word32 fn004010F1(ptr32 & edxOut)
{
	ptr32 edx_21;
	word32 ebp_35;
	word32 eax_20 = fn00401127(ebp, out edx_21, out ebp_35);
	edxOut = edx_21;
	return eax_20;
}

// 0040110D: void fn0040110D(Register (ptr32 Eq_6) ebp)
// Called from:
//      fn004010F1
//      fn00401133
void fn0040110D(struct Eq_6 * ebp)
{
	int32 eax;
	ebp->b0017 <<= 0x8B;
	fn00401111(eax, ebp);
}

// 00401111: void fn00401111(Register int32 eax, Register (ptr32 Eq_6) ebp)
// Called from:
//      fn0040110D
//      fn00401127
void fn00401111(int32 eax, struct Eq_6 * ebp)
{
	*((word32) ebp->t0009.u0 + eax) = (int32) (*((word32) ebp->ptrFFFFFFFD + (ebp->t0009).u0) - ebp->b0003);
	word32 edx_44;
	word32 ebp_45;
	fn00401127(&ebp->ptrFFFFFFFD + 1, out edx_44, out ebp_45);
}

// 00401127: Register Eq_111 fn00401127(Register (ptr32 Eq_54) ebp, Register out ptr32 edxOut, Register out (ptr32 Eq_54) ebpOut)
// Called from:
//      fn00401078
//      fn004010F1
//      fn00401111
Eq_111 fn00401127(struct Eq_54 * ebp, ptr32 & edxOut, struct Eq_54 & ebpOut)
{
	ptr32 edx;
	ebp->tFFFFFFFC.u0 = (int32) (ebp->tFFFFFFFC.u0 + 0x01);
	Eq_111 eax_10 = ebp->tFFFFFFFC.u0;
	if (eax_10 >= (ebp->t000C).u0)
	{
		struct Eq_54 * ebp_14 = ebp->ptr0000;
		edxOut = edx;
		ebpOut = ebp_14;
		return eax_10;
	}
	else
	{
		if (ebp->tFFFFFFFC.u0 > 0x01)
			*((word32) ebp->ptr0008 + (ebp->tFFFFFFFC).u0) = (ptr32) ~*((word32) ebp->ptr0008 + (ebp->tFFFFFFFC).u0);
		if (ebp->tFFFFFFFC.u0 > 0x01 && ((ebp->tFFFFFFFC).u0 - 0x01 & 0x03) == 0x00)
			*((word32) ebp->ptr0008 + (ebp->tFFFFFFFC).u0) = (ptr32) (*((word32) ebp->tFFFFFFFC.u0 + ebp->ptr0008) + 0x07);
		if (ebp->tFFFFFFFC.u0 <= 0x03)
		{
			ptr32 edx_65;
			Eq_111 eax_63 = fn004010F1(out edx_65);
			edxOut = edx_65;
			ebpOut = ebp;
			return eax_63;
		}
		else
		{
			Eq_111 edx_67 = ebp->tFFFFFFFC.u0;
			if ((int32) (SEQ(edx_67 - 0x03 >> 0x1F, edx_67 - 0x03) % 0x03) != 0x00)
			{
				ptr32 edx_85;
				Eq_111 eax_83 = fn004010F1(out edx_85);
				edxOut = edx_85;
				ebpOut = ebp;
				return eax_83;
			}
			else
			{
				ptr32 edx_91;
				Eq_111 eax_89 = fn004010F1(out edx_91);
				edxOut = edx_91;
				ebpOut = ebp;
				return eax_89;
			}
		}
	}
}

// 00401133: void fn00401133(Register (ptr32 word32) eax, Register word32 edx, Register word32 ebx, Register (ptr32 Eq_6) ebp, Register int32 edi)
// Called from:
//      Win32CrtStartup
void fn00401133(word32 * eax, word32 edx, word32 ebx, struct Eq_6 * ebp, int32 edi)
{
	Eq_223 SZO;
	bool P;
	byte dl_54 = (byte) edx;
	*eax = ebx;
	if (SZO)
	{
		if (!P)
			return;
		fn0040110D(ebp);
	}
	else if (SZO)
	{
		word32 edx_96;
		fn004010F1(out edx_96);
	}
	else
	{
		if (edi < ~0x00)
			return;
		__in<byte>(SEQ(0x87, dl_54));
	}
}

