/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start();
void __noreturn sub_4010A5();
void __fastcall sub_404238(int a1, int a2);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_404396; // weak


//----- (0040107B) --------------------------------------------------------
void __noreturn start()
{
  sub_4010A5();
}

//----- (004010A5) --------------------------------------------------------
void __noreturn sub_4010A5()
{
  struct _EXCEPTION_REGISTRATION_RECORD *v0; // [esp-4h] [ebp-4h] BYREF

  v0 = NtCurrentTeb()->NtTib.ExceptionList;
  __writefsdword(0, (unsigned int)&v0);
  __halt();
}

//----- (00404238) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_404238(int a1, int a2)
{
  int v2; // edx
  int v4; // ecx
  int v6; // edx
  bool v7; // sf
  int v8; // edi
  bool v10; // zf
  int v11; // esi
  unsigned int v12; // ecx
  int v17; // [esp-4h] [ebp-4h]

  v2 = -a2;
  _EBX = (_DWORD *)(v17 + 465);
  HIWORD(v4) = 24020;
  LOWORD(v4) = v2 & 0x4995;
  _ESI = 1559999151;
  v6 = v2 + 1940398782 - v4;
  v7 = v17 + 1431 < 0;
  v8 = v17 + 1431;
  while ( 1 )
  {
    if ( !v7 )
      _ESI = v17 + 1431;
    __asm
    {
      fcomp   st(4)
      repne neg esi
    }
    v10 = *_EBX == 0xDDB8F3FE;
    *_EBX ^= 0xDDB8F3FE;
    v11 = __ROR4__(_ESI, 217);
    if ( !v10 )
      JUMPOUT(0x4042FB);
    __asm
    {
      repne cmc
      fsub    st(1), st
    }
    v12 = v11 + 1905301162;
    __asm { fcom    st(7) }
    _AX = v6;
    __asm { repne movzx esi, ax }
    _BitScanReverse((unsigned int *)&_ESI, v12);
    ++_EBX;
    __asm { fsub    st(2), st }
    if ( !_ESI )
    {
      v6 = __ROR4__(-v6, 9);
      __asm { fsubr   st(7), st }
      _ESI = v17 + 1430;
    }
    __asm { repne cmc }
    _ESI = -_ESI;
    v7 = (int)_EBX - v8 < 0;
    if ( (int)_EBX >= v8 )
    {
      _AL = ((int (__thiscall *)(int))loc_404396)(-1409213224);
      __asm { xlat }
      JUMPOUT(0x404396);
    }
  }
}
// 404298: positive sp value 4 has been found
// 4042C0: inconsistent fpu stack
// 404395: control flows out of bounds to 404396
// 4042DB: control flows out of bounds to 4042FB
// 404299: variable 'v17' is possibly undefined

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
