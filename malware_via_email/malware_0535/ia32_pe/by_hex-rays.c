/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall sub_401058@<eax>(int a1@<eax>, int a2@<ecx>);
_DWORD sub_401119(); // weak
// void __usercall start(int a1@<eax>, int a2@<edx>, int a3@<edi>, int a4@<esi>);
// void __usercall sub_4020EB(char a1@<al>, int a2@<edx>, char a3@<ch>, int a4@<ebx>);
void sub_40216E();
// void __usercall sub_4021DA(int a1@<eax>, int a2@<edx>, int a3@<ebx>);
// int __usercall sub_402323@<eax>(int a1@<ebp>, __int128 a2@<xmm4>, char a3@<sil>);
void sub_402453();
_DWORD sub_4024C7(); // weak
void sub_4027F4();
void sub_402832();
_DWORD sub_402888(); // weak
// void __usercall sub_40296D(_DWORD *a1@<edi>);
// void __usercall sub_40298F(void *this@<ecx>, char a2@<dh>, char a3@<sil>);
void sub_4029AD();
void sub_4029F4();
// void __usercall sub_402A2D(char a1@<dh>, int a2@<ecx>, char a3@<bh>, char a4@<sil>);
void sub_402ACB();
void sub_402AF5();
// void __usercall sub_402B53(int a1@<ebp>, __int128 _XMM4@<xmm4>, char a3@<sil>);
// void __usercall sub_402BB0(char _CF@<cf>, int a2@<eax>, int a3@<edx>, __int16 a4@<cx>, int a5@<ebx>, int a6@<edi>);
_DWORD sub_402C85(); // weak
// void __usercall sub_402CDC(char a1@<dh>, char a2@<sil>);
void sub_402CF6();
// void __usercall sub_402D0E(int a1@<edi>);
void sub_402E62();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401171; // weak
_UNKNOWN loc_4011D7; // weak
_UNKNOWN loc_40126A; // weak
_UNKNOWN loc_4012A1; // weak
_UNKNOWN sub_40239F; // weak
_UNKNOWN loc_402434; // weak
_UNKNOWN loc_402660; // weak
_UNKNOWN loc_4028FB; // weak
_UNKNOWN loc_402C9F; // weak
_UNKNOWN loc_402DA6; // weak
_UNKNOWN loc_402E03; // weak


//----- (00401006) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_401006@<eax>(int a1@<eax>, int a2@<edx>, int a3@<esi>)
{
  volatile __int32 *v3; // edx
  bool v4; // pf
  __int32 v5; // esi
  void *retaddr[2]; // [esp+0h] [ebp+0h]

  v3 = (volatile __int32 *)(a2 - 1);
  v4 = __SETP__((char *)v3 + a3, 0);
  v5 = (__int32)v3 + a3;
  if ( __SETP__(v5, 0) || !v4 )
    JUMPOUT(0x4011BA);
  _InterlockedExchange(v3, v5);
  return MK_FP(retaddr[0], retaddr[0])(a1);
}
// 40100C: positive sp value 4 has been found
// 401015: control flows out of bounds to 4011BA

//----- (00401058) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_401058@<eax>(int a1@<eax>, int a2@<ecx>)
{
  int result; // eax
  char v3; // zf

  result = ((int (__thiscall *)(int))((char *)&loc_401171 + 3))(a1 + a2);
  _disable();
  if ( v3 )
    JUMPOUT(0x40113A);
  return result;
}
// 40105C: positive sp value 4 has been found
// 401081: control flows out of bounds to 40113A
// 401071: variable 'v3' is possibly undefined

//----- (00401119) --------------------------------------------------------
#error "40114E: cannot convert to microcode (funcsize=25)"

//----- (00401197) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401197(int a1@<eax>, int a2@<edx>, unsigned int a3@<ecx>, __int16 a4@<di>, unsigned int a5@<esi>, double a6@<st0>)
{
  int v7; // ebx
  bool v8; // cf
  unsigned int v9; // ecx
  unsigned int v11; // ecx
  int v12; // ebx
  int v14; // [esp-4h] [ebp-4h]

  _DI = a4 + 1;
  v7 = a3 | (a1 | a2) ^ a1;
  v8 = a3 < a5;
  v9 = a3 - a5;
  if ( !v8 )
  {
    __asm { repne mov di, di }
    if ( v8 )
    {
      v11 = v9 - 1;
      v12 = *(_DWORD *)(a5 - 2017742297) ^ v7;
      if ( v12 <= 0 )
      {
        *(_BYTE *)(v11 - 950867109) |= v11;
        while ( 1 )
        {
          v12 -= v11;
          _RAX = ((__int64 (__stdcall *)(int))((char *)&loc_4012A1 + 4))(v14);
          *(_DWORD *)(HIDWORD(_RAX) + 11) -= 913496910;
          __asm { aam     0Bh }
          a6 = a6 * *(float *)(v12 + 63474634);
          *(_DWORD *)(v12 - 796176647) = __ROR4__(*(_DWORD *)(v12 - 796176647), 1);
          a5 = 2 * a5 - (a5 - 1);
          v14 = 4198986;
        }
      }
      JUMPOUT(0x40131D);
    }
  }
  JUMPOUT(0x401231);
}
// 401229: positive sp value C has been found
// 401245: control flows out of bounds to 40124A
// 4011CC: control flows out of bounds to 40131D
// 4011A6: control flows out of bounds to 401231
// 401216: variable 'v11' is possibly undefined
// 401224: variable 'v14' is possibly undefined

//----- (004011FA) --------------------------------------------------------
void __usercall start(int a1@<eax>, int a2@<edx>, int a3@<edi>, int a4@<esi>)
{
  int v4; // esi
  int v5; // edi
  char v8; // zf
  int v9; // eax
  int v10; // ecx
  int v11; // ecx
  bool v12; // cf
  int v13; // edi
  int v14; // ecx

  v4 = a4 - 2;
  v14 = v4 - a1 - 1;
  _ESI = (a3 - 1 + v4 + a1 + a2 - 1) | -v4;
  LOBYTE(v14) = v14 - BYTE1(a1);
  v5 = _ESI | a1 ^ (a3 + 1);
  BYTE1(v14) = v14 + 57;
  _AL = ((int (__thiscall *)(int))loc_40126A)(v14 - 1);
  __asm
  {
    outsd
    das
  }
  v9 = MEMORY[0x8F539EA1]();
  v11 = v10 - 1;
  if ( v8 || !v11 )
  {
    MEMORY[0xFF] >>= 1;
    --MEMORY[0x4BD804C7];
    v12 = __CFADD__(v9, v5);
    v13 = v9 + v5;
    if ( v12 || !v12 )
      JUMPOUT(0x40102A);
    BYTE1(v11) &= *(_BYTE *)(v13 - 735820657);
  }
  ((void (__thiscall *)(int))loc_4011D7)(v11 + 1);
  __asm { lock wait }
  JUMPOUT(0x401056);
}
// 401054: control flows out of bounds to 401056
// 4012F7: control flows out of bounds to 4012FC
// 4010BC: control flows out of bounds to 40102A
// 4012A8: variable 'v10' is possibly undefined
// 4012A8: variable 'v8' is possibly undefined

//----- (004020EB) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4020EB(char a1@<al>, int a2@<edx>, char a3@<ch>, int a4@<ebx>)
{
  bool v4; // cf
  __int16 v5; // cx
  char v7; // dh
  int v9; // [esp-8028h] [ebp-8048h]
  int v10; // [esp-8024h] [ebp-8044h]

  *(&v10 - 9) = v9;
  BYTE1(a2) ^= a4;
  v4 = __CFADD__(a3, -14);
  HIBYTE(v5) = a3 - 14;
  LOBYTE(v5) = v4 + a1 - 74;
  _EAX = ((int (__fastcall *)(__int16, int, int))sub_40239F)(v5, a2, 64);
  *(_BYTE *)(a4 - 159504898) = v7;
  __asm { aam     0B7h ; '·' }
  JUMPOUT(0x402765);
}
// 402103: positive sp value 8048 has been found
// 4021CD: control flows out of bounds to 402765
// 4020FE: bad sp value at call
// 402105: variable 'v7' is possibly undefined

//----- (0040216E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40216E()
{
  JUMPOUT(0x40217E);
}
// 402172: positive sp value 4 has been found
// 40217C: control flows out of bounds to 40217E

//----- (004021DA) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4021DA(int a1@<eax>, int a2@<edx>, int a3@<ebx>)
{
  int v3; // edx

  v3 = a3 | a2;
  LOBYTE(a1) = BYTE1(a1) | a1;
  if ( !((v3 + a1 < 0) ^ __OFADD__(v3, a1) | (v3 + a1 == 0)) && (v3 + a1 < 0) ^ __OFADD__(v3, a1) | (v3 + a1 == 0) )
    JUMPOUT(0x402200);
  ((void (*)(void))((char *)&loc_402C9F + 3))();
  JUMPOUT(0x40201B);
}
// 402006: positive sp value 4 has been found
// 4021FC: control flows out of bounds to 402200
// 402016: control flows out of bounds to 40201B

//----- (00402323) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_402323@<eax>(int a1@<ebp>, __int128 a2@<xmm4>, char a3@<sil>)
{
  int v4; // [esp+0h] [ebp-8h]
  char v5; // [esp+4h] [ebp-4h]

  *((_DWORD *)&v5 - 3) = v4;
  sub_402B53(a1, a2, a3);
  return sub_4024C7();
}
// 40232F: positive sp value 8 has been found
// 4024C7: using guessed type _DWORD sub_4024C7();

//----- (0040239F) --------------------------------------------------------
#error "40208E: cannot convert to microcode (funcsize=20)"

//----- (00402453) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402453()
{
  int v0; // edx

  sub_402832();
  *(_WORD *)(v0 - 14) = __FS__;
  JUMPOUT(0x40271D);
}
// 40246D: positive sp value C has been found
// 402479: control flows out of bounds to 40271D
// 402469: variable 'v0' is possibly undefined

//----- (004024C7) --------------------------------------------------------
#error "40215F: cannot convert to microcode (funcsize=28)"

//----- (004026F6) --------------------------------------------------------
#error "4021B2: cannot convert to microcode (funcsize=76)"

//----- (004027F4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4027F4()
{
  int v0; // ebx
  int v1; // ebx
  int v2; // eax
  char v3; // ch
  char v4; // zf
  int v5; // ecx
  char v6; // pf

  sub_402ACB();
  if ( v6 )
    JUMPOUT(0x40278C);
  __asm { icebp }
  if ( v4 )
    JUMPOUT(0x4027A5);
  v0 = v5;
  ((void (*)(void))loc_402660)();
  MK_FP(MEMORY[0x5ABE32F6], MEMORY[0x5ABE32F2])();
  v1 = v0 + 1;
  v2 = sub_402888();
  if ( (v2 >> 31) + 1 < 0 == __OFADD__(1, v2 >> 31) )
    JUMPOUT(0x402095);
  sub_4020EB(v2, (v2 >> 31) + 1, v3, v1);
}
// 4020B5: positive sp value 4 has been found
// 40280A: control flows out of bounds to 40278C
// 40280D: control flows out of bounds to 4027A5
// 4020E8: control flows out of bounds to 402095
// 40280A: variable 'v6' is possibly undefined
// 40280D: variable 'v4' is possibly undefined
// 4020C4: variable 'v5' is possibly undefined
// 4020EA: variable 'v3' is possibly undefined
// 402888: using guessed type _DWORD sub_402888();

//----- (00402832) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
void sub_402832()
{
  int v0; // [esp-801Ch] [ebp-804Ch]
  int v1; // [esp-8018h] [ebp-8048h]

  *(&v1 - 13) = v0;
  JUMPOUT(0x402D2B);
}
// 40286C: positive sp value 804C has been found
// 402DDB: control flows out of bounds to 402D2B
// 40286E: control flows out of bounds to 402805
// 402867: bad sp value at call
// 402888: using guessed type _DWORD sub_402888();

//----- (00402888) --------------------------------------------------------
#error "4028A4: cannot convert to microcode (funcsize=12)"

//----- (0040296D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40296D(_DWORD *a1@<edi>)
{
  int v1; // eax
  void *v2; // [esp+Ch] [ebp-4h]
  void *retaddr; // [esp+10h] [ebp+0h]

  *(&retaddr - 5) = v2;
  sub_402CF6();
  *a1 = v1;
  JUMPOUT(0x40210B);
}
// 402034: positive sp value 4 has been found
// 40206E: control flows out of bounds to 40206F
// 402068: control flows out of bounds to 40210B
// 402051: variable 'v1' is possibly undefined

//----- (0040298F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40298F(void *this@<ecx>, char a2@<dh>, char a3@<sil>)
{
  __int32 v3; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v3, (__int32)this);
  sub_402CDC(a2, a3 - 1);
  JUMPOUT(0x402518);
}
// 402503: positive sp value 4 has been found
// 402516: control flows out of bounds to 402518

//----- (004029AD) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4029AD()
{
  void *v0; // [esp+Ch] [ebp-4h]
  void *retaddr; // [esp+10h] [ebp+0h]

  *(&retaddr - 5) = v0;
  JUMPOUT(0x402BF9);
}
// 402989: positive sp value 4 has been found
// 4029D7: control flows out of bounds to 4029D8
// 40298D: control flows out of bounds to 40298E
// 4029C3: control flows out of bounds to 402BF9
// 4029CD: conditional instruction was optimized away because of 'bl.1>=0'

//----- (004029F4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4029F4()
{
  void *v0; // [esp+18h] [ebp-4h]
  void *retaddr; // [esp+1Ch] [ebp+0h]

  *(&retaddr - 8) = v0;
  sub_402AF5();
}
// 4022CB: positive sp value 4 has been found

//----- (00402A2D) --------------------------------------------------------
void __usercall sub_402A2D(char a1@<dh>, int a2@<ecx>, char a3@<bh>, char a4@<sil>)
{
  __int16 v4; // dx
  int v5; // eax

  LOBYTE(v4) = a3;
  HIBYTE(v4) = a3 ^ a1;
  BYTE1(a2) -= 6;
  sub_4020EB(a4 + 121, v4, SBYTE1(a2), a2);
  --*(_BYTE *)((v5 | 0x3F7122B6) - 121);
  JUMPOUT(0x402A52);
}
// 402A4F: control flows out of bounds to 402A52
// 402A4A: variable 'v5' is possibly undefined

//----- (00402ACB) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402ACB()
{
  JUMPOUT(0x402855);
}
// 402AF3: positive sp value 8 has been found
// 402ADA: control flows out of bounds to 402855
// 402AF3: control flows out of bounds to 402ADD
// 402AE8: conditional instruction was optimized away because of 'ebx.4!=0'

//----- (00402AF5) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402AF5()
{
  JUMPOUT(0x402359);
}
// 402B33: positive sp value 24 has been found
// 40202B: control flows out of bounds to 402871
// 402B10: control flows out of bounds to 402359
// 402B35: control flows out of bounds to 402B85

//----- (00402B53) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402B53(int a1@<ebp>, __int128 _XMM4@<xmm4>, char a3@<sil>)
{
  char v5; // dh
  void *v6; // ecx
  int v10; // ecx
  void *v11; // [esp+18h] [ebp-4h]
  void *retaddr; // [esp+1Ch] [ebp+0h]

  *(&retaddr - 8) = v11;
  _EAX = ((int (*)(void))((char *)&loc_402434 + 1))();
  __asm { aas }
  sub_40298F(v6, v5, a3 - 1);
  __asm
  {
    insb
    vpor    xmm2, xmm4, xmmword ptr [ebx-7Bh]
  }
  *(_DWORD *)(a1 + 184820836) -= v10;
  JUMPOUT(0x402B97);
}
// 402B57: positive sp value 4 has been found
// 402B91: control flows out of bounds to 402B97
// 402B86: variable 'v6' is possibly undefined
// 402B86: variable 'v5' is possibly undefined
// 402B91: variable 'v10' is possibly undefined

//----- (00402BB0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402BB0(char _CF@<cf>, int a2@<eax>, int a3@<edx>, __int16 a4@<cx>, int a5@<ebx>, int a6@<edi>)
{
  int v7; // ebx
  bool v8; // cf
  int v9; // edx
  int v10; // ecx
  int v12; // eax
  _BYTE *v16; // [esp-4h] [ebp-4h]

  LOBYTE(a3) = a3 - (_CF + 67);
  v9 = a3 + 1;
  LOBYTE(v9) = -(char)v9;
  --HIBYTE(a4);
  v7 = a5 + 1;
  v8 = __CFADD__((_BYTE)a2, BYTE1(v9));
  BYTE1(v9) += a2;
  if ( !v8 && v8 )
  {
    v12 = MEMORY[0x7D0503F1](a4, v9);
    _ECX = v10 - 2449;
    BYTE1(v7) += v7;
    LOBYTE(v7) = BYTE1(_ECX) ^ v7;
    LOBYTE(v12) = BYTE1(v12) - 1;
    if ( __OFSUB__(v12, v7) || !__OFSUB__(v12, v7) )
    {
      ((void (*)(void))((char *)&loc_402DA6 + 3))();
      JUMPOUT(0x402214);
    }
    *(_DWORD *)a6 = *(_DWORD *)a2;
    *(_BYTE *)(a6 + 4) = *(_BYTE *)(a2 + 4);
    *v16 &= 0x3Au;
    __asm { repne dec ch }
    BYTE1(_ECX) = 120;
    ((void (__thiscall *)(int))((char *)&loc_4028FB + 1))(_ECX);
  }
  JUMPOUT(0x402AB4);
}
// 402BF6: positive sp value 8 has been found
// 40220F: control flows out of bounds to 402214
// 402C2A: control flows out of bounds to 402AB4
// 402BD3: variable 'v10' is possibly undefined
// 402BF8: variable 'v16' is possibly undefined

//----- (00402C85) --------------------------------------------------------
#error "402C95: cannot convert to microcode (funcsize=8)"

//----- (00402CDC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402CDC(char a1@<dh>, char a2@<sil>)
{
  __int16 v3; // dx
  int v4; // ecx

  ((void (*)(void))loc_402E03)();
  sub_402A2D((unsigned __int16)(v3 - 1) >> 8, v4, a1, a2 - 1);
}
// 401FE8: positive sp value 4 has been found
// 402A2C: variable 'v3' is possibly undefined
// 402A2C: variable 'v4' is possibly undefined

//----- (00402CF6) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402CF6()
{
  JUMPOUT(0x402B1C);
}
// 4022E3: positive sp value 4 has been found
// 40231A: control flows out of bounds to 402C37
// 4022F0: control flows out of bounds to 402B1C

//----- (00402D0E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402D0E(int a1@<edi>)
{
  unsigned int v3; // [esp+8h] [ebp-8h]
  unsigned int v4; // [esp+Ch] [ebp-4h]

  *(&v4 - 5) = v3;
  sub_4027F4();
  __writeeflags(v4);
  __asm
  {
    insb
    into
  }
  if ( !a1 )
    JUMPOUT(0x402951);
  JUMPOUT(0x402148);
}
// 40217E: positive sp value 8 has been found
// 402197: control flows out of bounds to 402198
// 40294F: control flows out of bounds to 402951
// 402E59: control flows out of bounds to 402148

//----- (00402E62) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402E62()
{
  JUMPOUT(0x4026C4);
}
// 402E66: positive sp value 4 has been found
// 402E79: control flows out of bounds to 4026C4

// nfuncs=30 queued=30 decompiled=30 lumina nreq=0 worse=0 better=0
#error "There were 6 decompilation failure(s) on 30 function(s)"
