/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int, int, int);
// int __usercall sub_401116@<eax>(int result@<eax>);
// void __usercall sub_4040C3(bool@<zf>, bool@<sf>, bool@<of>, int@<edx>, int _ECX@<ecx>, int@<edi>);

//-------------------------------------------------------------------------
// Data declarations

// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);
_UNKNOWN loc_404215; // weak


//----- (004010C1) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  sub_401116(0x10000);
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 3;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (00401116) --------------------------------------------------------
int __usercall sub_401116@<eax>(int result@<eax>)
{
  int v1; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v1);
  MEMORY[0] &= result;
  return result;
}

//----- (004040C3) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4040C3(bool a1@<zf>, bool a2@<sf>, bool a3@<of>, int a4@<edx>, int _ECX@<ecx>, int a6@<edi>)
{
  int v7; // eax
  int v8; // edi
  int v9; // ebx
  int v11; // eax
  int v12; // ebx
  int v13; // edi
  int v15; // eax
  __int16 v16; // dx
  int v19; // [esp-4h] [ebp-4h]
  int savedregs; // [esp+0h] [ebp+0h] BYREF
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  _ESI = a6;
  __asm { fsub    st(1), st }
  LOWORD(a4) = -16182;
  v7 = _ECX;
  v8 = v19;
  v9 = -871586714;
  if ( !a3 )
  {
    a3 = __OFADD__(1, v19);
    a1 = v19 == -1;
    a2 = v19 + 1 < 0;
    __asm
    {
      rcr     esi, 1Ch
      repne lea edi, [ecx]
    }
    v8 = 439062686;
    __asm { fsub    st(3), st }
    _ECX = __PAIR64__(_ECX, _ECX) >> _ECX;
  }
  if ( !(a2 ^ a3 | a1) )
    v9 = _ESI - 1;
  __asm { fsub    st(4), st }
  v11 = v7 >> 2;
  v12 = ~v9;
  if ( a4 >= v11 )
  {
    __asm { fsubr   st(4), st }
    v12 = 273476023;
    __asm
    {
      fmul    st(2), st
      fsub    st, st
    }
    v11 = -1299029489;
  }
  v13 = v8 + 1;
  _ESI = v13;
  __asm
  {
    fsubr   st(4), st
    rcl     esi, 0D4h
    fsubr   st(4), st
  }
  v15 = ((int (__thiscall *)(int, int, int, int, int, int, void **, int *, int, int))loc_404215)(
          v12,
          savedregs,
          v11,
          savedregs,
          _ECX - 216244585 + 1,
          v12,
          &retaddr,
          &savedregs,
          v13,
          v13);
  __asm { fsubr   st(4), st }
  v16 = _ESI;
  _ESI = -1082027237;
  if ( SHIBYTE(v16) > SBYTE1(v15) )
  {
    if ( __OFSUB__(HIBYTE(v16), BYTE1(v15)) )
      _ESI = v13;
    LOWORD(_ESI) = v16 + (HIBYTE(v16) < BYTE1(v15)) + (_WORD)_ESI;
  }
  __asm
  {
    rcl     esi, 70h
    fsub    st(1), st
  }
  JUMPOUT(0x404215);
}
// 404184: positive sp value 8 has been found
// 4040CA: inconsistent fpu stack
// 404213: control flows out of bounds to 404215
// 4040D3: variable 'v19' is possibly undefined

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
