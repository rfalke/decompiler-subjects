/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl sub_40A7F5(int, int, _DWORD *);
int __stdcall sub_40A822(_BYTE *);
void __stdcall sub_40A85C(void *, unsigned int);
// void __userpurge sub_40A87C(int a1@<ecx>, int a2@<edx>, int a3@<eax>, _BYTE *a4);
signed __int32 __stdcall StartAddress(LPVOID lpThreadParameter);
signed __int32 __stdcall sub_40A998(char **);
char *__stdcall sub_40AA43(char *, int);
int __stdcall sub_40AAD9(int a1, int a2);
int __stdcall sub_40AB12(int a1, int a2);
void __stdcall sub_40ABB4(const void *, void *, unsigned int);
int __stdcall sub_40ABCB(int);
_BYTE *__stdcall sub_40AC71(_BYTE *, int, _BYTE *, int);
char *__stdcall sub_40AD35(_BYTE *, int, char *, int);
void sub_40AD9C();
// __int64 __userpurge sub_40AF8A@<edx:eax>(int@<eax>, int@<edx>, int@<ecx>, int@<ebx>, int@<edi>, int@<esi>, int, int, int);
int __stdcall sub_40B1BC(int, int, int);
int __stdcall sub_40B242(int);
void __noreturn sub_40B341();
int sub_40B533();
int sub_40B8B8();
int __stdcall sub_40B986(int);
// int __usercall sub_40BA3F@<eax>(int@<ebx>, int@<edi>, int@<esi>);
int __stdcall sub_40BDE2(int);
int __stdcall sub_40BDFC(int, int);
// __int64 __userpurge sub_40BE57@<edx:eax>(int@<eax>, int@<edx>, int@<ecx>, int@<ebx>, unsigned int);
int __stdcall sub_40BED9(int, int, int);
int __stdcall sub_40BFEA(int *, int);
void __stdcall __noreturn sub_40C066(int, int, int);
int sub_40C125();
// void __usercall __noreturn start(int@<ebx>, int@<edi>, int@<esi>);
// BOOL __stdcall CloseHandle(HANDLE hObject);
// HANDLE __stdcall CreateThread(LPSECURITY_ATTRIBUTES lpThreadAttributes, SIZE_T dwStackSize, LPTHREAD_START_ROUTINE lpStartAddress, LPVOID lpParameter, DWORD dwCreationFlags, LPDWORD lpThreadId);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// void __stdcall Sleep(DWORD dwMilliseconds);
// DWORD __stdcall WaitForSingleObject(HANDLE hHandle, DWORD dwMilliseconds);
// void __usercall sub_40C2F0(unsigned int a1@<ebp>, char *a2, _BYTE *a3);

//-------------------------------------------------------------------------
// Data declarations

int dword_401000[16] =
{
  105307320,
  1879,
  -1622365485,
  59749,
  888367155,
  744645883,
  1745928174,
  1009694087,
  31,
  -2113929216,
  -167772056,
  35470,
  1949962691,
  330301440,
  5901339,
  0
}; // weak
int dword_403B70[9] =
{
  105307835,
  1883,
  -1622365465,
  3399941,
  26624,
  1694184691,
  744620032,
  1097710,
  0
}; // weak
int dword_4066BC[7] = { 105307039, 146, -1622362887, 3398157, 1037985792, -1806047975, 0 }; // weak
_UNKNOWN loc_40A8DB; // weak
int dword_40AC10[2] = { -1794572800, -1680761442 }; // weak
_UNKNOWN loc_40AC55; // weak
char byte_40ADD9[3] = { '=', '\x11', 'n' }; // weak
char byte_40AE75[3] = { 'k', ',', '8' }; // weak
__int16 word_40AEB6 = 27648; // weak
char byte_40AF05[3] = { '5', '\x10', 'q' }; // weak
__int16 word_40AFBA = 13312; // weak
char byte_40B349[3] = { '\b', '\r', 'L' }; // weak
char byte_40B543 = '\x13'; // weak
__int16 word_40B782 = 28672; // weak
char byte_40B8DD[3] = { 'ý', '\x10', '®' }; // weak
char byte_40BAA5[3] = { 'µ', '\r', 'é' }; // weak
int dword_40BAE8[4] = { -1284764368, -1453953179, -297571985, -297505433 }; // weak
char byte_40BCC5[3] = { '^', '\n', '\x1D' }; // weak
char byte_40BEE1[3] = { '\x8D', '\b', 'æ' }; // weak
char byte_40C1A3 = '}'; // weak
_UNKNOWN unk_40E000; // weak
int dword_40E004; // weak
int dword_40E008; // weak
int dword_40E00C; // weak
signed __int32 dword_40E010; // weak
int dword_40E014; // weak
int dword_40E018; // weak
_UNKNOWN unk_40E028; // weak
_UNKNOWN unk_40E435; // weak
int dword_40E838; // weak
int dword_40E83C; // weak
int dword_40E840; // weak
int dword_40E844; // weak
int dword_40E848; // weak
int dword_40E850; // weak
int dword_40E868; // weak
int dword_40E86C; // weak
_UNKNOWN unk_40E870; // weak
int dword_40E878; // weak
_UNKNOWN unk_40E87C; // weak
int dword_40E884; // weak
int dword_40E888; // weak
int dword_40E88C; // weak
_UNKNOWN unk_40E890; // weak
int dword_40E894; // weak
int dword_40E898; // weak
_DWORD dword_40E89C[65]; // weak
_UNKNOWN unk_40E9A1; // weak
_UNKNOWN unk_40E9A9; // weak
_UNKNOWN unk_40E9B1; // weak
int dword_40E9B9; // weak
int dword_40E9BD; // weak
int dword_40E9C1; // weak
int dword_40E9C5; // weak
int dword_40E9C9; // weak
int dword_40E9CD; // weak
int dword_40E9D1; // weak
int dword_40E9D5; // weak
int dword_40E9D9; // weak
int (__stdcall *dword_40E9DD)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__cdecl *dword_40E9E1)(_DWORD); // weak


//----- (0040A7F5) --------------------------------------------------------
int __cdecl sub_40A7F5(int a1, int a2, _DWORD *a3)
{
  int v4; // [esp-8h] [ebp-18h]
  int v5; // [esp-4h] [ebp-14h]

  v5 = dword_40E004;
  v4 = *(&dword_40E004 + 1);
  a3[45] = *(&dword_40E004 + 2);
  a3[49] = v4;
  a3[46] = v5;
  return 0;
}
// 40E004: using guessed type int dword_40E004;

//----- (0040A822) --------------------------------------------------------
int __stdcall sub_40A822(_BYTE *a1)
{
  int v2; // ebx
  char v3; // cl

  v2 = 0;
  v3 = 0;
  do
  {
    v3 ^= *a1;
    LOBYTE(v2) = *a1 ^ v2;
    while ( (unsigned __int8)v3 >= 0x20u )
      v3 -= 32;
    v2 = __ROL4__(v2, v3);
    ++a1;
  }
  while ( *a1 );
  return v2 ^ 0x6000;
}

//----- (0040A85C) --------------------------------------------------------
void __stdcall sub_40A85C(void *a1, unsigned int a2)
{
  memset(a1, 0, a2);
}

//----- (0040A87C) --------------------------------------------------------
void __userpurge sub_40A87C(int a1@<ecx>, int a2@<edx>, int a3@<eax>, _BYTE *a4)
{
  _DWORD v4[10]; // [esp-28h] [ebp-2Ch] BYREF
  HANDLE hHandle; // [esp+0h] [ebp-4h] BYREF
  int savedregs; // [esp+4h] [ebp+0h] BYREF

  if ( !dword_40E018 )
  {
    v4[7] = &savedregs;
    v4[6] = &hHandle;
    v4[4] = a1;
    v4[3] = a2;
    v4[2] = a3;
    *a4 = 0;
    hHandle = (HANDLE)*((_DWORD *)a4 - 1);
    if ( hHandle )
    {
      v4[1] = sub_40A7F5;
      v4[0] = NtCurrentTeb()->NtTib.ExceptionList;
      dword_40E004 = (int)&loc_40A8DB;
      dword_40E00C = (int)&savedregs;
      dword_40E008 = (int)v4;
      WaitForSingleObject(hHandle, 0xFFFFFFFF);
      CloseHandle(hHandle);
    }
  }
}
// 40E004: using guessed type int dword_40E004;
// 40E008: using guessed type int dword_40E008;
// 40E00C: using guessed type int dword_40E00C;
// 40E018: using guessed type int dword_40E018;

//----- (0040A8EA) --------------------------------------------------------
signed __int32 __stdcall StartAddress(LPVOID lpThreadParameter)
{
  char *v1; // esi
  char *v2; // edi
  char v3; // ah
  _BYTE *v4; // edi
  char v6[256]; // [esp+4h] [ebp-104h] BYREF
  int v7; // [esp+104h] [ebp-4h]

  _InterlockedIncrement(&dword_40E010);
  if ( dword_40E018 )
    v1 = (char *)&unk_40E028;
  else
    v1 = v6;
  sub_40A85C(v1, 0xC8u);
  v2 = *(char **)lpThreadParameter;
  v7 = *(unsigned __int8 *)(*(_DWORD *)lpThreadParameter + 1);
  v3 = *v2;
  v4 = v2 + 2;
  do
  {
    *v1 = v3 ^ *v4;
    v3 = __ROL1__(v3, 2);
    ++v1;
    ++v4;
    --v7;
  }
  while ( v7 );
  if ( !dword_40E018 )
  {
    *(_DWORD *)lpThreadParameter = v6;
    do
      Sleep(0xAu);
    while ( v6[0] && !dword_40E014 );
  }
  return _InterlockedDecrement(&dword_40E010);
}
// 40E010: using guessed type signed __int32 dword_40E010;
// 40E014: using guessed type int dword_40E014;
// 40E018: using guessed type int dword_40E018;

//----- (0040A998) --------------------------------------------------------
signed __int32 __stdcall sub_40A998(char **a1)
{
  char *v1; // esi
  char *v2; // edi
  char v3; // ah
  _BYTE *v4; // edi
  char v6[256]; // [esp+4h] [ebp-104h] BYREF
  int v7; // [esp+104h] [ebp-4h]

  _InterlockedIncrement(&dword_40E010);
  if ( dword_40E018 )
    v1 = (char *)&unk_40E435;
  else
    v1 = v6;
  sub_40A85C(v1, 0xC8u);
  v2 = *a1;
  v7 = (unsigned __int8)(*a1)[1];
  v3 = *v2;
  v4 = v2 + 2;
  do
  {
    *v1 = v3 ^ *v4;
    v3 = __ROL1__(v3, 2);
    ++v1;
    ++v4;
    --v7;
  }
  while ( v7 );
  if ( !dword_40E018 )
  {
    *a1 = v6;
    do
      Sleep(0xAu);
    while ( v6[0] && !dword_40E014 );
  }
  return _InterlockedDecrement(&dword_40E010);
}
// 40E010: using guessed type signed __int32 dword_40E010;
// 40E014: using guessed type int dword_40E014;
// 40E018: using guessed type int dword_40E018;

//----- (0040AA43) --------------------------------------------------------
char *__stdcall sub_40AA43(char *a1, int a2)
{
  HANDLE v3; // [esp+4h] [ebp-8h] BYREF
  char *Parameter; // [esp+8h] [ebp-4h] BYREF

  dword_40E014 = 0;
  Parameter = a1;
  v3 = 0;
  if ( dword_40E018 )
  {
    if ( a2 )
    {
      sub_40A998(&Parameter);
      Parameter = (char *)&unk_40E435;
    }
    else
    {
      StartAddress(&Parameter);
      Parameter = (char *)&unk_40E028;
    }
  }
  else
  {
    v3 = CreateThread(0, 0, (LPTHREAD_START_ROUTINE)StartAddress, &Parameter, 0, (LPDWORD)&v3);
    do
      Sleep(0);
    while ( Parameter == a1 );
  }
  *((_DWORD *)Parameter - 1) = v3;
  return Parameter;
}
// 40E014: using guessed type int dword_40E014;
// 40E018: using guessed type int dword_40E018;

//----- (0040AAD9) --------------------------------------------------------
int __stdcall sub_40AAD9(int a1, int a2)
{
  int v2; // edx
  int v3; // ecx
  int v5; // [esp-4h] [ebp-Ch]
  HMODULE LibraryA; // [esp+0h] [ebp-8h]
  char *v7; // [esp+4h] [ebp-4h]

  v7 = sub_40AA43((char *)(a1 + 1), 1);
  LibraryA = LoadLibraryA(v7);
  v5 = sub_40AB12((int)LibraryA, a2);
  sub_40A87C(v3, v2, (int)v7, v7);
  return v5;
}
// 40AB08: variable 'v3' is possibly undefined
// 40AB08: variable 'v2' is possibly undefined

//----- (0040AB12) --------------------------------------------------------
int __stdcall sub_40AB12(int a1, int a2)
{
  int v2; // eax
  int v3; // ecx
  _DWORD *v4; // ecx
  _DWORD *v5; // esi
  int v6; // edx
  int v8; // [esp+0h] [ebp-14h]
  int v9; // [esp+4h] [ebp-10h]
  int v10; // [esp+8h] [ebp-Ch]
  int v11; // [esp+Ch] [ebp-8h]
  int v12; // [esp+10h] [ebp-4h]

  v8 = 0;
  v2 = *(_DWORD *)(a1 + 60);
  if ( *(_WORD *)(v2 + a1) == 17744 )
  {
    v3 = *(_DWORD *)(v2 + a1 + 120);
    if ( v3 )
    {
      v4 = (_DWORD *)(a1 + v3);
      v11 = v4[6];
      v9 = a1 + v4[7];
      v10 = a1 + v4[9];
      v5 = (_DWORD *)(a1 + v4[8]);
      v12 = v11;
      while ( sub_40A822((_BYTE *)(a1 + *v5)) != a2 )
      {
        ++v5;
        if ( !--v12 )
          return v8;
      }
      v6 = a1 + *(_DWORD *)(v9 + 4 * (unsigned __int16)*(_DWORD *)(v10 + 2 * (v11 - v12)));
      if ( (*(unsigned __int8 *)v6 ^ 0x6000) == 24780 )
        return v6 ^ 0x60CC;
      return v6;
    }
  }
  return v8;
}

//----- (0040ABB4) --------------------------------------------------------
void __stdcall sub_40ABB4(const void *a1, void *a2, unsigned int a3)
{
  qmemcpy(a2, a1, a3);
}

//----- (0040ABCB) --------------------------------------------------------
int __stdcall sub_40ABCB(int a1)
{
  int (__stdcall *v1)(int, int, struct _EXCEPTION_REGISTRATION_RECORD *, int (__cdecl *)(int, int, _DWORD *)); // eax
  int v2; // eax
  int v4; // [esp-Ch] [ebp-18h]
  struct _EXCEPTION_REGISTRATION_RECORD *ExceptionList; // [esp-8h] [ebp-14h] BYREF
  int (__cdecl *v6)(int, int, _DWORD *); // [esp-4h] [ebp-10h]
  int v7; // [esp+0h] [ebp-Ch]
  int v8; // [esp+4h] [ebp-8h]
  int v9; // [esp+8h] [ebp-4h]
  int savedregs; // [esp+Ch] [ebp+0h] BYREF

  v7 = 0;
  v6 = sub_40A7F5;
  ExceptionList = NtCurrentTeb()->NtTib.ExceptionList;
  dword_40E004 = (int)&loc_40AC55;
  dword_40E00C = (int)&savedregs;
  dword_40E008 = (int)&ExceptionList;
  v8 = *(_DWORD *)a1;
  v4 = v8 + 1028;
  v1 = (int (__stdcall *)(int, int, struct _EXCEPTION_REGISTRATION_RECORD *, int (__cdecl *)(int, int, _DWORD *)))sub_40AAD9((int)dword_40AC10, 525453361);
  v2 = v1(64, v4, ExceptionList, v6);
  v9 = v2;
  *(_DWORD *)v2 = v8;
  sub_40C2F0((unsigned int)&savedregs, (char *)(a1 + 4), (_BYTE *)(v2 + 4));
  v7 = 1;
  return v9;
}
// 40AC63: conditional instruction was optimized away because %var_C.4==1
// 40AC10: using guessed type int dword_40AC10[2];
// 40E004: using guessed type int dword_40E004;
// 40E008: using guessed type int dword_40E008;
// 40E00C: using guessed type int dword_40E00C;

//----- (0040AC71) --------------------------------------------------------
_BYTE *__stdcall sub_40AC71(_BYTE *a1, int a2, _BYTE *a3, int a4)
{
  _BYTE *result; // eax
  _BYTE *v6; // esi
  _BYTE *v7; // edi
  char v8; // al
  _BYTE *v9; // [esp-4h] [ebp-1Ch]
  char v10; // [esp+Fh] [ebp-9h]
  _BYTE *v11; // [esp+10h] [ebp-8h]

  v11 = a3;
  result = &a3[a4];
  v10 = *a3;
  v6 = a1;
  v7 = a1;
  do
  {
    LOBYTE(result) = v10 ^ *v6;
    v9 = result;
    v8 = *++v11;
    if ( v11 == &a3[a4] )
    {
      v11 = a3;
      v8 = *a3;
    }
    v10 = v8;
    ++v6;
    result = v9;
    *v7++ = (_BYTE)v9;
    --a2;
  }
  while ( a2 );
  return result;
}

//----- (0040AD35) --------------------------------------------------------
char *__stdcall sub_40AD35(_BYTE *a1, int a2, char *a3, int a4)
{
  char *result; // eax
  _BYTE *v6; // esi
  _BYTE *v7; // edi
  char v8; // al
  char *v9; // [esp-4h] [ebp-1Ch]
  char v10; // [esp+Fh] [ebp-9h]
  char *v11; // [esp+10h] [ebp-8h]

  v11 = a3;
  result = &a3[a4];
  v10 = *a3;
  v6 = a1;
  v7 = a1;
  do
  {
    LOBYTE(result) = __ROL1__(*v6, v10);
    v9 = result;
    v8 = *++v11;
    if ( v11 == &a3[a4] )
    {
      v11 = a3;
      v8 = *a3;
    }
    v10 = v8;
    ++v6;
    result = v9;
    *v7++ = (_BYTE)v9;
    --a2;
  }
  while ( a2 );
  return result;
}

//----- (0040AD9C) --------------------------------------------------------
void sub_40AD9C()
{
  int (__stdcall *v0)(int, int); // eax
  void (__stdcall *v1)(int, char *); // eax
  int (__stdcall *v2)(int, int); // eax
  _BYTE *v3; // eax
  int i; // ecx
  int (__stdcall *v5)(int, int); // eax
  int (__stdcall *v6)(int, char *, _DWORD, int, int *); // eax
  int v7; // eax
  char *v8; // eax
  void (__stdcall *v9)(int, char *, _DWORD, _DWORD, int, int *); // eax
  void (__stdcall *v10)(int); // eax
  int v11; // [esp-18h] [ebp-20h]
  char *v12; // [esp-14h] [ebp-1Ch]
  char *v13; // [esp-10h] [ebp-18h]
  int v14; // [esp-8h] [ebp-10h]
  int v15; // [esp-8h] [ebp-10h]
  char *v16; // [esp-4h] [ebp-Ch]
  int v17; // [esp-4h] [ebp-Ch]
  int v18; // [esp+0h] [ebp-8h] BYREF
  int v19; // [esp+4h] [ebp-4h] BYREF

  if ( !dword_40E844 )
  {
    dword_40E848 = 1;
    v0 = (int (__stdcall *)(int, int))sub_40AAD9((int)dword_40AC10, 525453361);
    dword_40E850 = v0(64, 1024);
    v16 = sub_40AA43(byte_40ADD9, 0);
    v14 = dword_40E850;
    v1 = (void (__stdcall *)(int, char *))sub_40AAD9((int)dword_40AC10, 1832196328);
    v1(v14, v16);
    dword_40E014 = 1;
    v2 = (int (__stdcall *)(int, int))sub_40AAD9((int)dword_40AC10, 525453361);
    v3 = (_BYTE *)v2(64, 1024);
    dword_40E840 = (int)v3;
    for ( i = 1023; i; --i )
      *v3++ = i;
    v5 = (int (__stdcall *)(int, int))sub_40AAD9((int)dword_40AC10, 525453361);
    dword_40E838 = v5(64, 102400);
    v13 = sub_40AA43(byte_40AE75, 0);
    v6 = (int (__stdcall *)(int, char *, _DWORD, int, int *))sub_40AAD9((int)&word_40AEB6, -12426101);
    v7 = v6(-2147483646, v13, 0, 131097, &v19);
    dword_40E014 = 1;
    if ( !v7 )
    {
      v18 = 102400;
      v8 = sub_40AA43(byte_40AF05, 0);
      v15 = dword_40E838;
      v12 = v8;
      v11 = v19;
      v9 = (void (__stdcall *)(int, char *, _DWORD, _DWORD, int, int *))sub_40AAD9((int)&word_40AEB6, -1077614582);
      v9(v11, v12, 0, 0, v15, &v18);
      dword_40E014 = 1;
      v17 = v19;
      v10 = (void (__stdcall *)(int))sub_40AAD9((int)&word_40AEB6, 793438754);
      v10(v17);
      dword_40E83C = dword_40E838 + 8;
      dword_40E844 = 1;
    }
  }
}
// 40AC10: using guessed type int dword_40AC10[2];
// 40AEB6: using guessed type __int16 word_40AEB6;
// 40E014: using guessed type int dword_40E014;
// 40E838: using guessed type int dword_40E838;
// 40E83C: using guessed type int dword_40E83C;
// 40E840: using guessed type int dword_40E840;
// 40E844: using guessed type int dword_40E844;
// 40E848: using guessed type int dword_40E848;
// 40E850: using guessed type int dword_40E850;

//----- (0040AF8A) --------------------------------------------------------
__int64 __userpurge sub_40AF8A@<edx:eax>(
        int a1@<eax>,
        int a2@<edx>,
        int a3@<ecx>,
        int a4@<ebx>,
        int a5@<edi>,
        int a6@<esi>,
        int a7,
        int a8,
        int a9)
{
  int (__stdcall *v9)(int, int, int, int, int, int); // eax
  _BYTE *v10; // eax
  void (__stdcall *v11)(_BYTE *, int, int, char **, int *, int, int); // eax
  int (__cdecl *v12)(int, int, int *); // eax
  void (__stdcall *v13)(int, int, _DWORD, int, _BYTE *, int); // eax
  void (__stdcall *v14)(int); // eax
  void (__cdecl *v15)(_BYTE *); // eax
  int v17; // [esp-24h] [ebp-30h]
  _BYTE *v20; // [esp-1Ch] [ebp-28h]
  _BYTE *v22; // [esp-14h] [ebp-20h]
  __int64 v23; // [esp-10h] [ebp-1Ch]
  int v24; // [esp-10h] [ebp-1Ch]
  _BYTE *v25; // [esp-10h] [ebp-1Ch]
  int v26; // [esp-8h] [ebp-14h]
  char *v27; // [esp+0h] [ebp-Ch] BYREF
  int v28; // [esp+4h] [ebp-8h] BYREF
  _BYTE *v29; // [esp+8h] [ebp-4h]
  int savedregs; // [esp+Ch] [ebp+0h] BYREF

  HIDWORD(v23) = &savedregs;
  LODWORD(v23) = &v27;
  sub_40AD9C();
  v9 = (int (__stdcall *)(int, int, int, int, int, int))sub_40AAD9((int)dword_40AC10, 525453361);
  v10 = (_BYTE *)v9(64, a8, a1, a2, a3, a4);
  if ( v10 )
  {
    v29 = v10;
    v20 = v10;
    v11 = (void (__stdcall *)(_BYTE *, int, int, char **, int *, int, int))sub_40AAD9((int)&word_40AFBA, -1777646051);
    v11(v20, a7, a8, &v27, &savedregs, a5, a6);
    if ( dword_40E848 )
      v27 = (char *)dword_40E83C;
    else
      v27 = (char *)dword_40E840;
    sub_40AC71(v29, a8, v27, 23);
    sub_40AD35(v29, a8, v27, 12);
    v26 = dword_40E850;
    v12 = (int (__cdecl *)(int, int, int *))sub_40AAD9((int)&word_40AEB6, -436523417);
    if ( !v12(-2147483646, v26, &v28) )
    {
      v22 = v29;
      v17 = v28;
      v13 = (void (__stdcall *)(int, int, _DWORD, int, _BYTE *, int))sub_40AAD9((int)&word_40AEB6, -1482883737);
      v13(v17, a9, 0, 3, v22, a8);
      v24 = v28;
      v14 = (void (__stdcall *)(int))sub_40AAD9((int)&word_40AEB6, 793438754);
      v14(v24);
    }
    v25 = v29;
    v15 = (void (__cdecl *)(_BYTE *))sub_40AAD9((int)dword_40AC10, 1255319584);
    v15(v25);
  }
  return v23;
}
// 40AF8A: could not find valid save-restore pair for ebx
// 40AF8A: could not find valid save-restore pair for edi
// 40AF8A: could not find valid save-restore pair for esi
// 40B0A1: variable 'v23' is possibly undefined
// 40AC10: using guessed type int dword_40AC10[2];
// 40AEB6: using guessed type __int16 word_40AEB6;
// 40AFBA: using guessed type __int16 word_40AFBA;
// 40E83C: using guessed type int dword_40E83C;
// 40E840: using guessed type int dword_40E840;
// 40E848: using guessed type int dword_40E848;
// 40E850: using guessed type int dword_40E850;

//----- (0040B1BC) --------------------------------------------------------
int __stdcall sub_40B1BC(int a1, int a2, int a3)
{
  void (__stdcall *v3)(int, int, int *); // eax
  void (__stdcall *v4)(_DWORD, int, void *); // eax
  int (__stdcall *v5)(int, _DWORD, int *, _DWORD, _DWORD, _DWORD); // eax
  int v7; // [esp-18h] [ebp-18h]

  v3 = (void (__stdcall *)(int, int, int *))sub_40AAD9((int)&word_40AEB6, -150592851);
  v3(a1, 40, &dword_40E868);
  v4 = (void (__stdcall *)(_DWORD, int, void *))sub_40AAD9((int)&word_40AEB6, -752865846);
  v4(0, a2, &unk_40E870);
  dword_40E86C = 1;
  dword_40E878 = a3;
  v7 = dword_40E868;
  v5 = (int (__stdcall *)(int, _DWORD, int *, _DWORD, _DWORD, _DWORD))sub_40AAD9((int)&word_40AEB6, -881375972);
  return v5(v7, 0, &dword_40E86C, 0, 0, 0);
}
// 40AEB6: using guessed type __int16 word_40AEB6;
// 40E868: using guessed type int dword_40E868;
// 40E86C: using guessed type int dword_40E86C;
// 40E878: using guessed type int dword_40E878;

//----- (0040B242) --------------------------------------------------------
int __stdcall sub_40B242(int a1)
{
  int (__stdcall *v1)(int, int); // eax
  void (__stdcall *v2)(_DWORD *, int); // eax
  int (__stdcall *v3)(int, int); // eax
  void (__stdcall *v4)(int, _DWORD, _DWORD *, int, int, int); // eax
  void (__stdcall *v5)(void *, int); // eax
  void (__stdcall *v6)(int, void *, int); // eax
  void (__stdcall *v7)(int); // eax
  int (__stdcall *v8)(_DWORD *); // eax
  int v10; // [esp+0h] [ebp-14h]
  _DWORD *v11; // [esp+10h] [ebp-4h]

  v1 = (int (__stdcall *)(int, int))sub_40AAD9((int)dword_40AC10, 525453361);
  v11 = (_DWORD *)v1(64, 261);
  *v11 = 1547648860;
  v2 = (void (__stdcall *)(_DWORD *, int))sub_40AAD9((int)dword_40AC10, -201346858);
  v2(v11, a1);
  v3 = (int (__stdcall *)(int, int))sub_40AAD9((int)dword_40AC10, 525453361);
  v10 = v3(64, 10240);
  v4 = (void (__stdcall *)(int, _DWORD, _DWORD *, int, int, int))sub_40AAD9((int)dword_40AC10, 433196884);
  v4(1, 0, v11, -1, v10, 5120);
  v5 = (void (__stdcall *)(void *, int))sub_40AAD9((int)&word_40AFBA, 1586107008);
  v5(&unk_40E87C, v10);
  v6 = (void (__stdcall *)(int, void *, int))sub_40AAD9((int)&word_40AFBA, -1974150355);
  v6(38, &unk_40E87C, 8);
  v7 = (void (__stdcall *)(int))sub_40AAD9((int)dword_40AC10, 1255319584);
  v7(v10);
  v8 = (int (__stdcall *)(_DWORD *))sub_40AAD9((int)dword_40AC10, 1255319584);
  return v8(v11);
}
// 40AC10: using guessed type int dword_40AC10[2];
// 40AFBA: using guessed type __int16 word_40AFBA;

//----- (0040B341) --------------------------------------------------------
void __noreturn sub_40B341()
{
  char *v0; // eax

  v0 = sub_40AA43(byte_40B349, 0);
  sub_40C066((int)dword_401000, (int)v0, 11120);
}
// 401000: using guessed type int dword_401000[16];
// 40E9E5: using guessed type int dword_40E9E5;
// 40E9E9: using guessed type int dword_40E9E9;

//----- (0040B533) --------------------------------------------------------
int sub_40B533()
{
  char *v0; // eax
  int (__stdcall *v1)(int, _DWORD, int); // eax
  int result; // eax
  void (__stdcall *v3)(char *, int); // eax
  int (__stdcall *v4)(int, _DWORD, _DWORD, int *); // eax
  void (__stdcall *v5)(int, _DWORD, int); // eax
  int (__stdcall *v6)(_DWORD, int, int, int); // eax
  int (__stdcall *v7)(int, int, int, void *); // eax
  _DWORD *v8; // edi
  int (__stdcall *v9)(int, int, int, int *, _DWORD, _DWORD, int); // eax
  int (__stdcall *v10)(int, int, _DWORD *, int, _DWORD); // eax
  int (__stdcall *v11)(int, _DWORD, int, int, char *, int, _DWORD, _DWORD); // eax
  int (__stdcall *v12)(char *, _DWORD, _BYTE *); // eax
  int v13; // eax
  int (__stdcall *v14)(int, _BYTE *); // eax
  void (__stdcall *v15)(int); // eax
  void (__stdcall *v16)(int, int, int, int *, _DWORD, _DWORD, int); // eax
  void (__stdcall *v17)(int); // eax
  void (__stdcall *v18)(int); // eax
  void (__stdcall *v19)(int, _DWORD, int); // eax
  int (__stdcall *v20)(int); // eax
  int v21; // [esp-1Ch] [ebp-23Ch]
  int v22; // [esp-1Ch] [ebp-23Ch]
  int v23; // [esp-18h] [ebp-238h]
  int v24; // [esp-18h] [ebp-238h]
  int v25; // [esp-18h] [ebp-238h]
  int v26; // [esp-14h] [ebp-234h]
  int v27; // [esp-Ch] [ebp-22Ch]
  int v28; // [esp-Ch] [ebp-22Ch]
  int v29; // [esp-Ch] [ebp-22Ch]
  int v30; // [esp-Ch] [ebp-22Ch]
  int v31; // [esp-8h] [ebp-228h]
  int v32; // [esp-8h] [ebp-228h]
  int v33; // [esp-4h] [ebp-224h]
  int v34; // [esp-4h] [ebp-224h]
  int v35; // [esp-4h] [ebp-224h]
  int v36; // [esp-4h] [ebp-224h]
  int v37; // [esp-4h] [ebp-224h]
  int i; // [esp+0h] [ebp-220h]
  int v39; // [esp+4h] [ebp-21Ch]
  unsigned int v40; // [esp+8h] [ebp-218h]
  char v41[261]; // [esp+16h] [ebp-20Ah] BYREF
  char v42[2]; // [esp+11Bh] [ebp-105h] BYREF
  _BYTE v43[259]; // [esp+11Dh] [ebp-103h] BYREF

  sub_40B8B8();
  v0 = sub_40AA43(&byte_40B543, 0);
  dword_40E894 = sub_40B986((int)v0);
  v33 = dword_40E894;
  v1 = (int (__stdcall *)(int, _DWORD, int))sub_40AAD9((int)dword_40AC10, 1240011172);
  result = v1(64, 0, v33);
  if ( result )
  {
    dword_40E88C = result;
    v3 = (void (__stdcall *)(char *, int))sub_40AAD9((int)dword_40AC10, -459033583);
    v3(v42, 260);
    v4 = (int (__stdcall *)(int, _DWORD, _DWORD, int *))sub_40AAD9((int)&word_40AFBA, 1338234730);
    if ( v4(16, 0, 0, &dword_40E888) == -1073741820 )
    {
      dword_40E888 = 4096;
      do
      {
        dword_40E888 *= 2;
        if ( dword_40E884 )
        {
          v27 = dword_40E884;
          v5 = (void (__stdcall *)(int, _DWORD, int))sub_40AAD9((int)dword_40AC10, 2119232787);
          v5(v27, 0, 0x8000);
        }
        v28 = dword_40E888;
        v6 = (int (__stdcall *)(_DWORD, int, int, int))sub_40AAD9((int)dword_40AC10, -1541011154);
        dword_40E884 = v6(0, v28, 4096, 4);
        v31 = dword_40E888;
        v29 = dword_40E884;
        v7 = (int (__stdcall *)(int, int, int, void *))sub_40AAD9((int)&word_40AFBA, 1338234730);
      }
      while ( v7(16, v29, v31, &unk_40E890) == -1073741820 );
    }
    v40 = *(_DWORD *)dword_40E884;
    v8 = (_DWORD *)(dword_40E884 + 4);
    v39 = 0;
    for ( i = dword_40E884 + 4; ; i += 16 )
    {
      if ( *v8 == dword_40E894 )
      {
        v23 = *(unsigned __int16 *)(i + 6);
        v21 = dword_40E88C;
        v9 = (int (__stdcall *)(int, int, int, int *, _DWORD, _DWORD, int))sub_40AAD9((int)dword_40AC10, -780553209);
        if ( v9(v21, v23, -1, &dword_40E898, 0, 0, 2) )
        {
          v26 = dword_40E898;
          v10 = (int (__stdcall *)(int, int, _DWORD *, int, _DWORD))sub_40AAD9((int)&word_40AFBA, 386917375);
          if ( !v10(v26, 1, dword_40E89C, 532, 0) )
          {
            v24 = dword_40E89C[1];
            v11 = (int (__stdcall *)(int, _DWORD, int, int, char *, int, _DWORD, _DWORD))sub_40AAD9(
                                                                                           (int)dword_40AC10,
                                                                                           -1357538603);
            if ( v11(1, 0, v24, -1, v41, 260, 0, 0) )
            {
              v12 = (int (__stdcall *)(char *, _DWORD, _BYTE *))sub_40AAD9((int)&word_40B782, -1400479146);
              v13 = v12(v41, 0, v43);
              if ( v13 )
              {
                v32 = v13;
                v14 = (int (__stdcall *)(int, _BYTE *))sub_40AAD9((int)dword_40AC10, -547593778);
                if ( !v14(v32, v43) )
                {
                  v34 = dword_40E898;
                  v15 = (void (__stdcall *)(int))sub_40AAD9((int)dword_40AC10, -471027652);
                  v15(v34);
                  v25 = *(unsigned __int16 *)(i + 6);
                  v22 = dword_40E88C;
                  v16 = (void (__stdcall *)(int, int, int, int *, _DWORD, _DWORD, int))sub_40AAD9(
                                                                                         (int)dword_40AC10,
                                                                                         -780553209);
                  v16(v22, v25, -1, &dword_40E898, 0, 0, 3);
                  v35 = dword_40E898;
                  v17 = (void (__stdcall *)(int))sub_40AAD9((int)dword_40AC10, -471027652);
                  v17(v35);
                }
              }
            }
          }
        }
        v36 = dword_40E898;
        v18 = (void (__stdcall *)(int))sub_40AAD9((int)dword_40AC10, -471027652);
        v18(v36);
      }
      if ( ++v39 >= v40 )
        break;
      v8 = (_DWORD *)(i + 16);
    }
    v30 = dword_40E884;
    v19 = (void (__stdcall *)(int, _DWORD, int))sub_40AAD9((int)dword_40AC10, 2119232787);
    v19(v30, 0, 0x8000);
    v37 = dword_40E88C;
    v20 = (int (__stdcall *)(int))sub_40AAD9((int)dword_40AC10, -471027652);
    return v20(v37);
  }
  return result;
}
// 40AC10: using guessed type int dword_40AC10[2];
// 40AFBA: using guessed type __int16 word_40AFBA;
// 40B543: using guessed type char byte_40B543;
// 40B782: using guessed type __int16 word_40B782;
// 40E884: using guessed type int dword_40E884;
// 40E888: using guessed type int dword_40E888;
// 40E88C: using guessed type int dword_40E88C;
// 40E894: using guessed type int dword_40E894;
// 40E898: using guessed type int dword_40E898;
// 40E89C: using guessed type _DWORD dword_40E89C[65];
// 40B533: using guessed type char var_105[2];

//----- (0040B8B8) --------------------------------------------------------
int sub_40B8B8()
{
  void (__stdcall *v0)(int, int, int *); // eax
  int (__stdcall *v1)(_DWORD, char *, int *); // eax
  int (__stdcall *v2)(int); // eax
  void (__stdcall *v4)(int, _DWORD, int *, int, int *, char *); // eax
  int v5; // [esp-18h] [ebp-38h]
  char *v6; // [esp-8h] [ebp-28h]
  int v7; // [esp-4h] [ebp-24h]
  int v8[2]; // [esp+0h] [ebp-20h] BYREF
  char v9[4]; // [esp+8h] [ebp-18h] BYREF
  int v10[4]; // [esp+Ch] [ebp-14h] BYREF
  int v11; // [esp+1Ch] [ebp-4h] BYREF

  v0 = (void (__stdcall *)(int, int, int *))sub_40AAD9((int)&word_40AEB6, -150592851);
  v0(-1, 40, &v11);
  v6 = sub_40AA43(byte_40B8DD, 0);
  v1 = (int (__stdcall *)(_DWORD, char *, int *))sub_40AAD9((int)&word_40AEB6, -752865846);
  if ( v1(0, v6, v8) )
  {
    v10[0] = 1;
    v10[1] = v8[0];
    v10[2] = v8[1];
    v10[3] = 2;
    v5 = v11;
    v4 = (void (__stdcall *)(int, _DWORD, int *, int, int *, char *))sub_40AAD9((int)&word_40AEB6, -881375972);
    v4(v5, 0, v10, 16, v10, v9);
  }
  v7 = v11;
  v2 = (int (__stdcall *)(int))sub_40AAD9((int)dword_40AC10, -471027652);
  return v2(v7);
}
// 40AC10: using guessed type int dword_40AC10[2];
// 40AEB6: using guessed type __int16 word_40AEB6;
// 40B8B8: using guessed type char var_18[4];

//----- (0040B986) --------------------------------------------------------
int __stdcall sub_40B986(int a1)
{
  int (__stdcall *v1)(int, _DWORD); // eax
  int (__stdcall *v2)(int, int *); // eax
  int result; // eax
  int (__stdcall *v4)(int, int *); // eax
  int (__stdcall *v5)(char *, int); // eax
  int v6; // [esp+0h] [ebp-12Ch]
  int v7[9]; // [esp+4h] [ebp-128h] BYREF
  char v8[260]; // [esp+28h] [ebp-104h] BYREF

  v1 = (int (__stdcall *)(int, _DWORD))sub_40AAD9((int)dword_40AC10, -428946731);
  v6 = v1(2, 0);
  v7[0] = 296;
  v2 = (int (__stdcall *)(int, int *))sub_40AAD9((int)dword_40AC10, -1960273425);
  result = v2(v6, v7);
  if ( result )
  {
    while ( 1 )
    {
      v4 = (int (__stdcall *)(int, int *))sub_40AAD9((int)dword_40AC10, 888752771);
      result = v4(v6, v7);
      if ( !result )
        break;
      v5 = (int (__stdcall *)(char *, int))sub_40AAD9((int)dword_40AC10, -547593778);
      if ( !v5(v8, a1) )
        return v7[2];
    }
  }
  return result;
}
// 40AC10: using guessed type int dword_40AC10[2];
// 40B986: using guessed type char var_104[260];

//----- (0040BA3F) --------------------------------------------------------
int __usercall sub_40BA3F@<eax>(int a1@<ebx>, int a2@<edi>, int a3@<esi>)
{
  int (__stdcall *v3)(char *, int); // eax
  int result; // eax
  void (__stdcall *v5)(char *, char *); // eax
  void (__stdcall *v6)(char *, char *); // eax
  void (__stdcall *v7)(char *, char *); // eax
  int (__stdcall *v8)(char *, unsigned int, int, _DWORD, int, int, _DWORD); // eax
  void (__stdcall *v9)(int, void *, void *, void *); // eax
  void (__stdcall *v10)(int); // eax
  int (__stdcall *v11)(char *, char *); // eax
  int (__stdcall *v12)(char *, char *, int); // eax
  int (__stdcall *v13)(char *, unsigned int, int, _DWORD, int, int, _DWORD); // eax
  int v14; // eax
  int (__stdcall *v15)(int, void *); // eax
  int (__stdcall *v16)(int, int); // eax
  void (__stdcall *v17)(int, int, int, void *, _DWORD); // eax
  void (__stdcall *v18)(int); // eax
  char *v19; // eax
  int v20; // edx
  int v21; // ecx
  void (__stdcall *v22)(int); // eax
  void (__stdcall *v23)(char *, _DWORD, int); // eax
  int v24; // [esp-14h] [ebp-22Ch]
  int v25; // [esp-10h] [ebp-228h]
  int v26; // [esp-10h] [ebp-228h]
  int v27; // [esp-Ch] [ebp-224h]
  int v28; // [esp-8h] [ebp-220h]
  char *v29; // [esp-4h] [ebp-21Ch]
  char *v30; // [esp-4h] [ebp-21Ch]
  int v31; // [esp-4h] [ebp-21Ch]
  int v32; // [esp-4h] [ebp-21Ch]
  int v33; // [esp-4h] [ebp-21Ch]
  int v34; // [esp-4h] [ebp-21Ch]
  char v35[261]; // [esp+Eh] [ebp-20Ah] BYREF
  char v36[261]; // [esp+113h] [ebp-105h] BYREF

  v3 = (int (__stdcall *)(char *, int))sub_40AAD9((int)dword_40AC10, -459033583);
  result = v3(v36, 260);
  if ( result )
  {
    v5 = (void (__stdcall *)(char *, char *))sub_40AAD9((int)dword_40AC10, 1832196328);
    v5(v35, v36);
    v29 = sub_40AA43(byte_40BAA5, 0);
    v6 = (void (__stdcall *)(char *, char *))sub_40AAD9((int)dword_40AC10, -201346858);
    v6(v36, v29);
    dword_40E014 = 1;
    v30 = sub_40AA43((char *)dword_40BAE8, 0);
    v7 = (void (__stdcall *)(char *, char *))sub_40AAD9((int)dword_40AC10, -201346858);
    v7(v35, v30);
    dword_40E014 = 1;
    v8 = (int (__stdcall *)(char *, unsigned int, int, _DWORD, int, int, _DWORD))sub_40AAD9(
                                                                                   (int)dword_40AC10,
                                                                                   1905171515);
    result = v8(v36, 0x80000000, 3, 0, 3, 128, 0);
    if ( result != -1 )
    {
      dword_40E9B9 = result;
      v25 = result;
      v9 = (void (__stdcall *)(int, void *, void *, void *))sub_40AAD9((int)dword_40AC10, -231440868);
      v9(v25, &unk_40E9A1, &unk_40E9A9, &unk_40E9B1);
      v31 = dword_40E9B9;
      v10 = (void (__stdcall *)(int))sub_40AAD9((int)dword_40AC10, -471027652);
      v10(v31);
      v11 = (int (__stdcall *)(char *, char *))sub_40AAD9((int)dword_40AC10, -1607695976);
      result = v11(v36, v35);
      if ( result )
      {
        v12 = (int (__stdcall *)(char *, char *, int))sub_40AAD9((int)dword_40AC10, -1960623285);
        result = v12(v35, v36, 1);
        if ( result )
        {
          v13 = (int (__stdcall *)(char *, unsigned int, int, _DWORD, int, int, _DWORD))sub_40AAD9(
                                                                                          (int)dword_40AC10,
                                                                                          1905171515);
          v14 = v13(v35, 0x80000000, 3, 0, 3, 128, 0);
          if ( v14 != -1 )
          {
            dword_40E9B9 = v14;
            v28 = v14;
            v15 = (int (__stdcall *)(int, void *))sub_40AAD9((int)dword_40AC10, -1011749199);
            dword_40E9BD = v15(v28, &unk_40E000);
            v32 = dword_40E9BD;
            v16 = (int (__stdcall *)(int, int))sub_40AAD9((int)dword_40AC10, 525453361);
            dword_40E9C1 = v16(64, v32);
            v27 = dword_40E9BD;
            v26 = dword_40E9C1;
            v24 = dword_40E9B9;
            v17 = (void (__stdcall *)(int, int, int, void *, _DWORD))sub_40AAD9((int)dword_40AC10, 1534075196);
            v17(v24, v26, v27, &unk_40E000, 0);
            v33 = dword_40E9B9;
            v18 = (void (__stdcall *)(int))sub_40AAD9((int)dword_40AC10, -471027652);
            v18(v33);
            v19 = sub_40AA43(byte_40BCC5, 0);
            sub_40AF8A((int)v19, v20, v21, a1, a2, a3, dword_40E9C1, dword_40E9BD, (int)v19);
            v34 = dword_40E9C1;
            v22 = (void (__stdcall *)(int))sub_40AAD9((int)dword_40AC10, 1255319584);
            v22(v34);
            v23 = (void (__stdcall *)(char *, _DWORD, int))sub_40AAD9((int)dword_40AC10, -869062055);
            v23(v35, 0, 4);
          }
          sub_40C066((int)dword_403B70, 0, 11084);
        }
      }
    }
  }
  return result;
}
// 40BCEC: variable 'v20' is possibly undefined
// 40BCEC: variable 'v21' is possibly undefined
// 403B70: using guessed type int dword_403B70[9];
// 40AC10: using guessed type int dword_40AC10[2];
// 40BAE8: using guessed type int dword_40BAE8[4];
// 40E014: using guessed type int dword_40E014;
// 40E9B9: using guessed type int dword_40E9B9;
// 40E9BD: using guessed type int dword_40E9BD;
// 40E9C1: using guessed type int dword_40E9C1;
// 40E9E5: using guessed type int dword_40E9E5;
// 40E9E9: using guessed type int dword_40E9E9;

//----- (0040BDE2) --------------------------------------------------------
int __stdcall sub_40BDE2(int a1)
{
  int result; // eax

  result = __ROL4__(a1 ^ 0xC62E18, 4);
  dword_40E9C5 = result;
  return result;
}
// 40E9C5: using guessed type int dword_40E9C5;

//----- (0040BDFC) --------------------------------------------------------
int __stdcall sub_40BDFC(int a1, int a2)
{
  unsigned __int64 v2; // rax

  v2 = 16807 * (dword_40E9C5 % 0x1F31Du) - 2836 * (dword_40E9C5 / 0x1F31Du);
  dword_40E9C5 = v2;
  if ( a2 == a1 )
    return v2;
  else
    return a1 + v2 % (unsigned int)(a2 - a1);
}
// 40E9C5: using guessed type int dword_40E9C5;

//----- (0040BE57) --------------------------------------------------------
__int64 __userpurge sub_40BE57@<edx:eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, unsigned int a5)
{
  __int64 v6; // [esp-14h] [ebp-1Ch]
  int v7; // [esp+0h] [ebp-8h] BYREF
  char *v8; // [esp+4h] [ebp-4h]

  HIDWORD(v6) = &v7;
  v7 = dword_40E9D9 - 2;
  v8 = (char *)dword_40E9DD(64, dword_40E9D9 - 2, a1, a2, a3, a4);
  if ( a5 )
    sub_40ABB4((const void *)dword_40E9D5, v8, a5);
  sub_40ABB4((const void *)(a5 + dword_40E9D5 + 2), &v8[a5], dword_40E9D9 - a5 - 2);
  dword_40E9E1(dword_40E9D5);
  dword_40E9D5 = (int)v8;
  dword_40E9D9 = v7;
  return v6;
}
// 40BE57: could not find valid save-restore pair for edi
// 40BE57: could not find valid save-restore pair for esi
// 40BED4: variable 'v6' is possibly undefined
// 40E9D5: using guessed type int dword_40E9D5;
// 40E9D9: using guessed type int dword_40E9D9;
// 40E9DD: using guessed type int (__stdcall *dword_40E9DD)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40E9E1: using guessed type int (__cdecl *dword_40E9E1)(_DWORD);

//----- (0040BED9) --------------------------------------------------------
int __stdcall sub_40BED9(int a1, int a2, int a3)
{
  __int64 (__stdcall *v3)(char *); // eax
  __int64 v4; // rax
  int v5; // ecx
  int (__stdcall *v6)(int, int); // eax
  __int64 v7; // rax
  unsigned int v8; // ecx
  _DWORD *v9; // edi
  int *v10; // esi
  int i; // ecx
  int v12; // ecx
  int v14; // [esp+0h] [ebp-Ch]
  char *v15; // [esp+4h] [ebp-8h]
  unsigned int v16; // [esp+8h] [ebp-4h]

  v15 = sub_40AA43(byte_40BEE1, 0);
  v3 = (__int64 (__stdcall *)(char *))sub_40AAD9((int)dword_40AC10, -1465489461);
  v4 = v3(v15);
  v14 = v4;
  sub_40A87C(v5, SHIDWORD(v4), v4, v15);
  dword_40E9DD = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))sub_40AB12(v14, 525453361);
  dword_40E9E1 = (int (__cdecl *)(_DWORD))sub_40AB12(v14, 1255319584);
  dword_40E9CD = a2;
  dword_40E9D1 = 4 * a2;
  v6 = (int (__stdcall *)(int, int))sub_40AAD9((int)dword_40AC10, 525453361);
  dword_40E9C9 = v6(64, 4 * a2);
  v16 = a3 - 2 * a2 - 8;
  LODWORD(v7) = sub_40BDE2(a1);
  v8 = a3 - 8;
  v9 = (_DWORD *)dword_40E9C9;
  while ( v16 < v8 )
  {
    LODWORD(v7) = sub_40BDFC(0, v16);
    *v9++ = v7;
    v16 += 2;
  }
  v10 = (int *)(dword_40E9D1 + dword_40E9C9);
  for ( i = dword_40E9CD; i; i = v12 - 1 )
  {
    --v10;
    v7 = sub_40BE57(*v10, SHIDWORD(v7), i, a3 - 2 * a2 - 8, *v10);
  }
  return v7;
}
// 40BF1E: variable 'v5' is possibly undefined
// 40BFBD: variable 'v8' is possibly undefined
// 40BFDB: variable 'v7' is possibly undefined
// 40BFE0: variable 'v12' is possibly undefined
// 40AC10: using guessed type int dword_40AC10[2];
// 40E9C9: using guessed type int dword_40E9C9;
// 40E9CD: using guessed type int dword_40E9CD;
// 40E9D1: using guessed type int dword_40E9D1;
// 40E9DD: using guessed type int (__stdcall *dword_40E9DD)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40E9E1: using guessed type int (__cdecl *dword_40E9E1)(_DWORD);

//----- (0040BFEA) --------------------------------------------------------
int __stdcall sub_40BFEA(int *a1, int a2)
{
  int (__stdcall *v2)(int, int); // eax
  void (__stdcall *v3)(int, int *, int); // eax
  int v5; // [esp-Ch] [ebp-14h]
  int v6; // [esp-4h] [ebp-Ch]
  int v7; // [esp+0h] [ebp-8h]
  int v8; // [esp+4h] [ebp-4h]

  v8 = *a1;
  v7 = a1[1];
  dword_40E9D9 = a2 - 8;
  v2 = (int (__stdcall *)(int, int))sub_40AAD9((int)dword_40AC10, 525453361);
  dword_40E9D5 = v2(64, a2 - 8);
  v6 = dword_40E9D9;
  v5 = dword_40E9D5;
  v3 = (void (__stdcall *)(int, int *, int))sub_40AAD9((int)&word_40AFBA, -1777646051);
  v3(v5, a1 + 2, v6);
  return sub_40BED9(v8, v7, a2);
}
// 40AC10: using guessed type int dword_40AC10[2];
// 40AFBA: using guessed type __int16 word_40AFBA;
// 40E9D5: using guessed type int dword_40E9D5;
// 40E9D9: using guessed type int dword_40E9D9;

//----- (0040C066) --------------------------------------------------------
void __stdcall __noreturn sub_40C066(int a1, int a2, int a3)
{
  while ( 1 )
    ;
}
// 40E9D5: using guessed type int dword_40E9D5;
// 40E9D9: using guessed type int dword_40E9D9;
// 40E9E5: using guessed type int dword_40E9E5;
// 40E9E9: using guessed type int dword_40E9E9;

//----- (0040C125) --------------------------------------------------------
int sub_40C125()
{
  int (__stdcall *v0)(int *); // eax
  int result; // eax
  int (__stdcall *v2)(_DWORD); // eax
  int v3[37]; // [esp+0h] [ebp-94h] BYREF

  sub_40A85C(v3, 0x94u);
  v3[0] = 148;
  v0 = (int (__stdcall *)(int *))sub_40AAD9((int)dword_40AC10, 1958780349);
  result = v0(v3);
  if ( v3[1] >= 6u )
  {
    v2 = (int (__stdcall *)(_DWORD))sub_40AAD9((int)dword_40AC10, 278984095);
    return v2(0);
  }
  return result;
}
// 40AC10: using guessed type int dword_40AC10[2];

//----- (0040C18D) --------------------------------------------------------
void __usercall __noreturn start(int a1@<ebx>, int a2@<edi>, int a3@<esi>)
{
  char *v3; // eax

  sub_40AD9C();
  sub_40C125();
  sub_40B533();
  sub_40BA3F(a1, a2, a3);
  v3 = sub_40AA43(&byte_40C1A3, 0);
  sub_40C066((int)dword_4066BC, (int)v3, 956);
}
// 4066BC: using guessed type int dword_4066BC[7];
// 40C1A3: using guessed type char byte_40C1A3;
// 40E848: using guessed type int dword_40E848;

//----- (0040C2F0) --------------------------------------------------------
void __usercall sub_40C2F0(unsigned int a1@<ebp>, char *a2, _BYTE *a3)
{
  char v5; // dl
  char v6; // al
  int i; // ebx
  bool v8; // cf
  char v9; // dl
  char v10; // tt
  bool v11; // cf
  char v12; // dl
  char v13; // tt
  unsigned int v14; // eax
  bool v15; // cf
  char v16; // dl
  char v17; // tt
  bool v18; // cf
  char v19; // dl
  char v20; // dl
  char v21; // tt
  BOOL v22; // eax
  bool v23; // cf
  char v24; // dl
  char v25; // dl
  char v26; // tt
  int v27; // eax
  bool v28; // cf
  char v29; // dl
  char v30; // dl
  char v31; // tt
  int v32; // eax
  bool v33; // cf
  char v34; // dl
  char v35; // tt
  int v36; // eax
  int v37; // eax
  bool v38; // cf
  char v39; // dl
  char v40; // dl
  char v41; // tt
  bool v42; // cf
  char v43; // dl
  char v44; // tt
  int v45; // eax
  unsigned int v46; // ecx
  bool v47; // cf
  char v48; // dl
  char v49; // dl
  char v50; // tt
  bool v51; // cf
  char v52; // dl
  char v53; // tt
  unsigned int v54; // eax
  int v55; // ecx
  bool v56; // cf
  char v57; // dl
  char v58; // dl
  char v59; // tt
  bool v60; // cf
  char v61; // dl
  char v62; // tt
  unsigned int v63; // ecx
  unsigned __int8 v64; // al
  char v65; // cf
  unsigned int v66; // ecx

  v5 = 0x80;
LABEL_2:
  v6 = *a2++;
  *a3++ = v6;
  for ( i = 2; ; i = 1 )
  {
    while ( 1 )
    {
      while ( 1 )
      {
        v8 = __CFADD__(v5, v5);
        v5 *= 2;
        if ( !v5 )
        {
          v9 = *a2++;
          v10 = v8 + v9;
          v8 = __CFADD__(v8, v9) | __CFADD__(v9, v8 + v9);
          v5 = v9 + v10;
        }
        if ( !v8 )
          goto LABEL_2;
        v11 = __CFADD__(v5, v5);
        v5 *= 2;
        if ( !v5 )
        {
          v12 = *a2++;
          v13 = v11 + v12;
          v11 = __CFADD__(v11, v12) | __CFADD__(v12, v11 + v12);
          v5 = v12 + v13;
        }
        if ( v11 )
          break;
        v37 = 1;
        do
        {
          v38 = __CFADD__(v5, v5);
          v39 = 2 * v5;
          if ( !v39 )
          {
            v40 = *a2++;
            v41 = v38 + v40;
            v38 = __CFADD__(v38, v40) | __CFADD__(v40, v38 + v40);
            v39 = v40 + v41;
          }
          v37 += v38 + v37;
          v42 = __CFADD__(v39, v39);
          v5 = 2 * v39;
          if ( !v5 )
          {
            v43 = *a2++;
            v44 = v42 + v43;
            v42 = __CFADD__(v42, v43) | __CFADD__(v43, v42 + v43);
            v5 = v43 + v44;
          }
        }
        while ( v42 );
        v45 = v37 - i;
        i = 1;
        if ( v45 )
        {
          v54 = (v45 - 1) << 8;
          LOBYTE(v54) = *a2++;
          a1 = v54;
          v55 = 1;
          do
          {
            v56 = __CFADD__(v5, v5);
            v57 = 2 * v5;
            if ( !v57 )
            {
              v58 = *a2++;
              v59 = v56 + v58;
              v56 = __CFADD__(v56, v58) | __CFADD__(v58, v56 + v58);
              v57 = v58 + v59;
            }
            v55 += v56 + v55;
            v60 = __CFADD__(v57, v57);
            v5 = 2 * v57;
            if ( !v5 )
            {
              v61 = *a2++;
              v62 = v60 + v61;
              v60 = __CFADD__(v60, v61) | __CFADD__(v61, v60 + v61);
              v5 = v61 + v62;
            }
          }
          while ( v60 );
          v63 = (v54 < 0x80) + (v54 < 0x80) + v55 - ((v54 < 0x7D00) - 1) - ((v54 < 0x500) - 1);
          qmemcpy(a3, &a3[-v54], v63);
          a3 += v63;
        }
        else
        {
          v46 = 1;
          do
          {
            v47 = __CFADD__(v5, v5);
            v48 = 2 * v5;
            if ( !v48 )
            {
              v49 = *a2++;
              v50 = v47 + v49;
              v47 = __CFADD__(v47, v49) | __CFADD__(v49, v47 + v49);
              v48 = v49 + v50;
            }
            v46 += v47 + v46;
            v51 = __CFADD__(v48, v48);
            v5 = 2 * v48;
            if ( !v5 )
            {
              v52 = *a2++;
              v53 = v51 + v52;
              v51 = __CFADD__(v51, v52) | __CFADD__(v52, v51 + v52);
              v5 = v52 + v53;
            }
          }
          while ( v51 );
          qmemcpy(a3, &a3[-a1], v46);
          a3 += v46;
        }
      }
      v14 = 0;
      v15 = __CFADD__(v5, v5);
      v5 *= 2;
      if ( !v5 )
      {
        v16 = *a2++;
        v17 = v15 + v16;
        v15 = __CFADD__(v15, v16) | __CFADD__(v16, v15 + v16);
        v5 = v16 + v17;
      }
      if ( !v15 )
        break;
      v18 = __CFADD__(v5, v5);
      v19 = 2 * v5;
      if ( !v19 )
      {
        v20 = *a2++;
        v21 = v18 + v20;
        v18 = __CFADD__(v18, v20) | __CFADD__(v20, v18 + v20);
        v19 = v20 + v21;
      }
      v22 = v18;
      v23 = __CFADD__(v19, v19);
      v24 = 2 * v19;
      if ( !v24 )
      {
        v25 = *a2++;
        v26 = v23 + v25;
        v23 = __CFADD__(v23, v25) | __CFADD__(v25, v23 + v25);
        v24 = v25 + v26;
      }
      v27 = v22 + v23 + v22;
      v28 = __CFADD__(v24, v24);
      v29 = 2 * v24;
      if ( !v29 )
      {
        v30 = *a2++;
        v31 = v28 + v30;
        v28 = __CFADD__(v28, v30) | __CFADD__(v30, v28 + v30);
        v29 = v30 + v31;
      }
      v32 = v27 + v28 + v27;
      v33 = __CFADD__(v29, v29);
      v5 = 2 * v29;
      if ( !v5 )
      {
        v34 = *a2++;
        v35 = v33 + v34;
        v33 = __CFADD__(v33, v34) | __CFADD__(v34, v33 + v34);
        v5 = v34 + v35;
      }
      v36 = v32 + v33 + v32;
      if ( v36 )
        LOBYTE(v36) = a3[-v36];
      *a3++ = v36;
      i = 2;
    }
    v64 = *a2++;
    v65 = v64 & 1;
    LOBYTE(v14) = v64 >> 1;
    if ( !(_BYTE)v14 )
      break;
    v66 = v65 + 2;
    a1 = v14;
    qmemcpy(a3, &a3[-v14], v66);
    a3 += v66;
  }
}
// 40C2F0: could not find valid save-restore pair for esi

// nfuncs=78 queued=31 decompiled=31 lumina nreq=0 worse=0 better=0
// ALL OK, 31 function(s) have been successfully decompiled
