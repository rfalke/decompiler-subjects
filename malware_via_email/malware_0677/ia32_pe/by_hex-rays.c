/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

double sub_401005(); // weak
_DWORD start(); // weak
_DWORD sub_4011BF(); // weak
double __far sub_4011E4(); // weak
void sub_40138C();
// void __usercall sub_401430(int@<eax>, int@<ebx>);
void sub_401465();
// void __usercall sub_402173(int a1@<eax>, int a2@<edx>, int _ESI@<esi>);
// void __usercall sub_4022A6(int@<eax>, int@<edx>, __int32@<ecx>, int@<ebx>, int@<edi>, int@<esi>);
void sub_4023D9();
_DWORD __far sub_402433(); // weak
void __fastcall sub_402481(int, __int32);
void __noreturn sub_4024DA(); // weak
_DWORD sub_402511(); // weak
void sub_4026E7();
// void __userpurge sub_402706(int@<edx>, int@<ecx>, char@<bl>, int@<edi>, int@<esi>, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int);
_DWORD __far sub_402728(); // weak
void sub_402747();
// void __usercall sub_402765(int@<eax>);
void sub_402882();
_DWORD sub_402950(); // weak
// void __usercall sub_402A37(int@<eax>, char@<dh>, __int16@<cx>, unsigned int@<ebx>, int@<edi>, int@<esi>);
void sub_402A51();
// void __usercall sub_402A75(int@<eax>, int@<ecx>, __int16@<bx>, int@<edi>, __int32@<esi>);
// void __usercall sub_402ABC(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebp>, int a5@<edi>, int a6@<ebx>);
// void __usercall sub_402B1F(char@<dh>, int@<ecx>, char@<bl>, int _EDI@<edi>, int@<esi>);
void sub_402BD1();
void sub_402C0A();
// void __usercall __noreturn sub_402C7F(__int32@<edx>, int@<ecx>, int@<edi>);
double __thiscall sub_402D4F(_DWORD, _DWORD); // weak
// void __usercall sub_40305E(int@<ebx>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN sub_4021DA; // weak
_UNKNOWN loc_402285; // weak
_UNKNOWN loc_402411; // weak


//----- (00401005) --------------------------------------------------------
#error "40101D: cannot convert to microcode (funcsize=10)"

//----- (004011A4) --------------------------------------------------------
#error "40111A: cannot convert to microcode (funcsize=57)"

//----- (004011BF) --------------------------------------------------------
#error "4011D8: cannot convert to microcode (funcsize=11)"

//----- (004011E4) --------------------------------------------------------
#error "401379: cannot convert to microcode (funcsize=73)"

//----- (0040138C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40138C()
{
  int v0; // [esp+24h] [ebp-8h]
  int v1; // [esp+28h] [ebp-4h]

  *(&v1 - 12) = v0;
  JUMPOUT(0x40102A);
}
// 4012C3: positive sp value 8 has been found
// 4012D1: control flows out of bounds to 401106
// 4013AB: control flows out of bounds to 40102A

//----- (00401430) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401430(int a1@<eax>, int a2@<ebx>)
{
  unsigned __int16 v2; // dx

  if ( __OFSUB__(a2, a1) || !__OFSUB__(a2, a1) )
    JUMPOUT(0x4014A1);
  sub_401465();
  __inbyte(v2);
  sub_401465();
}
// 40143A: positive sp value 4 has been found
// 401495: control flows out of bounds to 4014A1
// 40145F: variable 'v2' is possibly undefined

//----- (00401465) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401465()
{
  JUMPOUT(0x401351);
}
// 401469: positive sp value 4 has been found
// 40147C: control flows out of bounds to 401351

//----- (00402173) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402173(int a1@<eax>, int a2@<edx>, int _ESI@<esi>)
{
  LOBYTE(a2) = ~(_BYTE)a2;
  if ( !__CFADD__(a1, a2) && __CFADD__(a1, a2) )
  {
    __asm { fadd    qword ptr [esi] }
    JUMPOUT(0x40219D);
  }
  JUMPOUT(0x4022DD);
}
// 402177: positive sp value 4 has been found
// 40219B: inconsistent fpu stack
// 40219B: control flows out of bounds to 40219D
// 402189: control flows out of bounds to 4022DD

//----- (004021DA) --------------------------------------------------------
#error "4021DA: function frame is wrong (funcsize=0)"

//----- (004022A6) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4022A6(int a1@<eax>, int a2@<edx>, __int32 a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  int v6; // ecx
  int v7; // eax
  int v8; // ecx
  int v9; // ecx
  int v10; // ecx
  __int32 v11[2]; // [esp-8h] [ebp-8h] BYREF

  _InterlockedExchange(v11, a3);
  v6 = a6 + v11[0];
  LOBYTE(a4) = a4 - 71;
  v7 = a5 + a1;
  BYTE1(v7) = __CFADD__(BYTE1(a4), BYTE1(a4)) + 2 * BYTE1(a4) - 56;
  LOBYTE(v6) = (__CFADD__(__CFADD__(BYTE1(a4), BYTE1(a4)), 2 * BYTE1(a4)) | __CFADD__(
                                                                              __CFADD__(BYTE1(a4), BYTE1(a4))
                                                                            + 2 * BYTE1(a4),
                                                                              -56))
             + a6
             + LOBYTE(v11[0])
             + 92
             + 102;
  LOBYTE(v7) = v7 - 1;
  --v7;
  BYTE1(v6) = __CFADD__(a6, v11[0]) + ((unsigned __int16)(a6 + LOWORD(v11[0])) >> 8) + 54;
  v8 = a4 ^ v6;
  LOBYTE(v8) = ~(_BYTE)v8;
  LOWORD(v7) = ~(_WORD)v7;
  v9 = v7 | (v8 - a2);
  LOBYTE(a4) = a4 - 8;
  BYTE1(v9) = -113;
  LOBYTE(v9) = ~(v9 + 1);
  v10 = a4 | v9;
  LOBYTE(v10) = v10 - v7;
  BYTE1(v10) -= __CFADD__(BYTE1(v10), BYTE1(v7)) + 32;
  ((void (__thiscall *)(int, __int32))((char *)&loc_402285 + 1))(v10, v11[1]);
  JUMPOUT(0x402EC5);
}
// 402EBD: positive sp value 8 has been found
// 402EBF: control flows out of bounds to 402EC5
// 402D43: conditional instruction was optimized away because ecx.4>=1

//----- (004023D9) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
void sub_4023D9()
{
  ((void (*)(void))sub_4021DA)();
  __asm { iret }
  JUMPOUT(0x40240E);
}
// 40240D: positive sp value 8049 has been found
// 40240D: control flows out of bounds to 40240E
// 402408: bad sp value at call

//----- (00402433) --------------------------------------------------------
#error "4026A0: cannot convert to microcode (funcsize=55)"

//----- (00402481) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_402481(int a1, __int32 a2)
{
  char v2; // sf
  char v3; // of
  unsigned int v4; // kr00_4
  unsigned int v5; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange((volatile __int32 *)&v5, a2);
  LOBYTE(a1) = a1 + 1;
  ((void (__thiscall *)(int))loc_402411)(a1);
  if ( v2 != v3 )
  {
    v4 = __readeflags();
    v5 = v4;
    JUMPOUT(0x4024A5);
  }
  JUMPOUT(0x4024AD);
}
// 402490: positive sp value 4 has been found
// 4024A4: control flows out of bounds to 4024A5
// 40249D: control flows out of bounds to 4024AD
// 40249D: variable 'v2' is possibly undefined
// 40249D: variable 'v3' is possibly undefined

//----- (004024DA) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn sub_4024DA()
{
  void *v0; // [esp+8h] [ebp-4h]
  void *retaddr; // [esp+Ch] [ebp+0h]

  *(&retaddr - 4) = v0;
  ((void (*)(void))sub_402433)();
  __debugbreak();
}
// 4024DE: positive sp value 4 has been found
// 402433: using guessed type _DWORD __far sub_402433();
// 4024DA: using guessed type void __noreturn sub_4024DA();

//----- (00402511) --------------------------------------------------------
#error "402E7C: cannot convert to microcode (funcsize=30)"

//----- (004026E7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4026E7()
{
  JUMPOUT(0x4024BD);
}
// 4026F1: positive sp value 4 has been found
// 4026FB: control flows out of bounds to 4024BD

//----- (00402706) --------------------------------------------------------
void __userpurge sub_402706(
        int a1@<edx>,
        int a2@<ecx>,
        char a3@<bl>,
        int a4@<edi>,
        int a5@<esi>,
        int a6,
        int a7,
        int a8,
        int a9,
        int a10,
        int a11,
        int a12,
        int a13,
        int a14,
        int a15,
        int a16,
        int a17,
        int a18,
        int a19,
        int a20,
        int a21,
        int a22,
        int a23,
        int a24,
        int a25,
        int a26,
        int a27,
        int a28,
        int a29,
        int a30,
        int a31,
        int a32,
        int a33,
        int a34,
        int a35,
        int a36,
        int a37,
        int a38,
        int a39,
        int a40,
        int a41,
        int a42,
        int a43,
        int a44,
        int a45,
        int a46,
        int a47,
        int a48,
        int a49,
        int a50,
        int a51,
        int a52,
        int a53,
        int a54,
        int a55,
        int a56,
        int a57,
        int a58,
        int a59,
        int a60,
        int a61,
        int a62,
        int a63)
{
  int v64; // edx
  bool v65; // cf
  int v66; // esi
  _BYTE *v67; // esi
  char v69; // dh

  ++BYTE1(a1);
  v64 = a1 + 1 - a4;
  BYTE1(a2) = ~BYTE1(a2);
  v65 = (unsigned __int8)a2 < (unsigned __int8)v64;
  LOBYTE(a2) = a2 - v64;
  v66 = a5 + 1;
  LOBYTE(v64) = v64 - (v65 + 83);
  BYTE1(v64) += __CFADD__(a3 - v66 - 1, -79) + 24;
  v67 = (_BYTE *)(v64 | v66);
  _ST7 = sub_402D4F(a2 - 1, 64);
  __asm { fst     st(7) }
  if ( *v67 == v69 )
    JUMPOUT(0x4023AF);
  JUMPOUT(0x402814);
}
// 403035: control flows out of bounds to 4023AF
// 402852: control flows out of bounds to 402814
// 402852: variable 'v69' is possibly undefined
// 402706: too many input arguments, some ignored
// 402D4F: using guessed type double __thiscall sub_402D4F(_DWORD, _DWORD);

//----- (00402728) --------------------------------------------------------
#error "402728: function frame is wrong (funcsize=0)"

//----- (00402747) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402747()
{
  JUMPOUT(0x402331);
}
// 40274B: positive sp value 4 has been found
// 40275B: control flows out of bounds to 402331

//----- (00402765) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402765(int a1@<eax>)
{
  void *v1; // [esp+18h] [ebp-4h]
  void *retaddr; // [esp+1Ch] [ebp+0h]

  *(&retaddr - 8) = v1;
  v1 = *(void **)(a1 + 16);
  JUMPOUT(0x402EC4);
}
// 402769: positive sp value 4 has been found
// 40277A: control flows out of bounds to 402EC4

//----- (004027AA) --------------------------------------------------------
#error "4027AA: function frame is wrong (funcsize=0)"

//----- (00402811) --------------------------------------------------------
#error "402811: function frame is wrong (funcsize=0)"

//----- (00402882) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402882()
{
  int v0; // [esp+4h] [ebp-8h]
  int v1; // [esp+8h] [ebp-4h]

  *(&v1 - 4) = v0;
  sub_402C0A();
  JUMPOUT(0x40305B);
}
// 403059: positive sp value 8 has been found
// 40305A: control flows out of bounds to 40305B

//----- (00402950) --------------------------------------------------------
#error "4025DB: cannot convert to microcode (funcsize=32)"

//----- (00402A37) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402A37(
        int a1@<eax>,
        char a2@<dh>,
        __int16 a3@<cx>,
        unsigned int a4@<ebx>,
        int a5@<edi>,
        int a6@<esi>)
{
  char v6; // bh
  int v7; // eax
  __int16 v8; // bx
  void *v9; // [esp+20h] [ebp-4h]
  void *retaddr; // [esp+24h] [ebp+0h]

  *(&retaddr - 10) = v9;
  BYTE1(a4) = a1 + (a3 ^ BYTE1(a4)) + 1;
  LOBYTE(a4) = 6 - HIBYTE(a3);
  v7 = *(_DWORD *)(a1 + 60) + a1;
  LOBYTE(v8) = v7 ^ (1 - (6 - HIBYTE(a3) - ((a5 - (a6 - 1) < a4) + 127)));
  HIBYTE(v8) = a3;
  v6 = v7 | (-(char)(a2 + ((unsigned __int16)(v8 + 1) >> 8)) - 1);
  if ( !__SETP__(v6, 0) && __SETP__(v6, 0) )
  {
    __asm { iret }
    JUMPOUT(0x402D23);
  }
  JUMPOUT(0x4027D3);
}
// 402466: positive sp value 4 has been found
// 402D22: control flows out of bounds to 402D23
// 402D13: control flows out of bounds to 4027D3

//----- (00402A51) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402A51()
{
  JUMPOUT(0x402938);
}
// 402A55: positive sp value 4 has been found
// 402A68: control flows out of bounds to 402938

//----- (00402A75) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402A75(int a1@<eax>, int a2@<ecx>, __int16 a3@<bx>, int a4@<edi>, __int32 a5@<esi>)
{
  unsigned __int32 v7; // ecx
  __int32 v8; // ecx
  __int16 v9; // bx
  int v10; // ecx
  __int32 v11[3]; // [esp-Ch] [ebp-Ch] BYREF

  _InterlockedExchange(v11, a5);
  v8 = v11[0] ^ a2;
  v9 = v8 + a3;
  v7 = v8 - a4;
  LOBYTE(v7) = v7 - HIBYTE(v9);
  LOBYTE(v7) = (v11[0] < v7) + v7 + 99;
  v10 = (a1 ^ v7) + 1;
  LOBYTE(v10) = ~(_BYTE)v10;
  _AL = ((int (__thiscall *)(int, __int32))sub_402728)(v10, v11[2]);
  __asm { daa }
  JUMPOUT(0x4023D6);
}
// 4023D5: positive sp value C has been found
// 402A95: control flows out of bounds to 402A97
// 4023D5: control flows out of bounds to 4023D6
// 40256E: control flows out of bounds to 40256F
// 402728: using guessed type _DWORD __far sub_402728();

//----- (00402ABC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402ABC(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebp>, int a5@<edi>, int a6@<ebx>)
{
  _DWORD *v6; // edx
  int v7; // ecx
  int v8; // ebx
  int v9; // ebx
  char v10; // cf
  int v11; // eax
  char v12; // dh
  int v13; // ecx
  int v14; // edi
  int v15; // edx
  int v16; // eax
  int v17; // ecx
  unsigned int v18; // [esp-4h] [ebp-4h]

  LOBYTE(a3) = a3 + 47;
  BYTE1(a3) = a1 ^ ~(BYTE1(a3) + 62);
  v8 = a6 + 1;
  LOBYTE(v8) = 30;
  v9 = a1 + v8;
  v11 = ((int (__fastcall *)(int, int))sub_402950)(a3, a2 + 48);
  if ( v18 < (unsigned int)v10 + a4 )
  {
    --BYTE1(v9);
    v14 = v11 | (v9 + (v11 ^ a5));
    v15 = (unsigned __int8)v11;
    if ( !__OFADD__(1, (_BYTE)v11) && __OFADD__(1, (_BYTE)v11) )
    {
      v16 = v11 - 716782722;
      __outbyte(v15, v16);
      HIWORD(v17) = HIWORD(v16);
      BYTE1(v17) = ~BYTE1(v16);
      LOBYTE(v17) = BYTE1(v16);
      sub_402ABC(v16, v15, v17, a4, v14);
      __halt();
    }
    sub_40305E(BYTE1(v11));
    *(v6 - 331940424) -= v7;
    *v6 += 56;
    JUMPOUT(0x402C47);
  }
  sub_402B1F(v12, v13, v9, a5, v18 - (v10 + a4));
}
// 4028C2: positive sp value 8 has been found
// 40291B: control flows out of bounds to 40291D
// 40290D: control flows out of bounds to 402C47
// 402AE0: variable 'v18' is possibly undefined
// 402ADE: variable 'v10' is possibly undefined
// 402B1E: variable 'v12' is possibly undefined
// 402B1E: variable 'v13' is possibly undefined
// 4028E2: variable 'v6' is possibly undefined
// 4028E2: variable 'v7' is possibly undefined
// 402950: using guessed type _DWORD sub_402950();

//----- (00402B1F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402B1F(char a1@<dh>, int a2@<ecx>, char a3@<bl>, int _EDI@<edi>, int a5@<esi>)
{
  __int16 v5; // bx
  unsigned int v6; // eax

  LOBYTE(v5) = ~a3;
  HIBYTE(v5) = 71;
  sub_402A37(a2, a1, a2, v5, _EDI, a5);
  __outdword(0xAu, v6);
  __asm { rep inc edi }
  JUMPOUT(0x402B47);
}
// 402B29: positive sp value 4 has been found
// 402B44: control flows out of bounds to 402B47
// 402B38: variable 'v6' is possibly undefined

//----- (00402BD1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402BD1()
{
  JUMPOUT(0x402451);
}
// 402BD5: positive sp value 4 has been found
// 402BE5: control flows out of bounds to 402451

//----- (00402C0A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402C0A()
{
  void *v0; // [esp+8h] [ebp-4h]
  void *retaddr[2]; // [esp+Ch] [ebp+0h]

  retaddr[-4] = v0;
  JUMPOUT(0x402389);
}
// 402C0E: positive sp value 4 has been found
// 402C1E: control flows out of bounds to 402389

//----- (00402C7F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_402C7F(__int32 a1@<edx>, int a2@<ecx>, int a3@<edi>)
{
  int v3; // ecx
  void *v4; // [esp+2Ch] [ebp-4h]
  void *retaddr; // [esp+30h] [ebp+0h]

  *(&retaddr - 13) = v4;
  BYTE1(a2) = 48;
  v3 = a3 ^ a2;
  BYTE1(v3) = a1 + 24 - BYTE1(v3);
  sub_402481(a1 + v3 + 1, a1);
  __halt();
}
// 402C66: positive sp value 4 has been found

//----- (00402D4F) --------------------------------------------------------
#error "402D4F: function frame is wrong (funcsize=0)"

//----- (00402FCF) --------------------------------------------------------
#error "402FCF: function frame is wrong (funcsize=0)"

//----- (0040305E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40305E(int a1@<ebx>)
{
  char v1; // cf

  sub_4023D9();
  *(_BYTE *)(a1 - 14) -= v1 + a1;
  JUMPOUT(0x402977);
}
// 403062: positive sp value 4 has been found
// 403084: control flows out of bounds to 402977
// 403071: variable 'v1' is possibly undefined

// nfuncs=35 queued=35 decompiled=35 lumina nreq=0 worse=0 better=0
#error "There were 13 decompilation failure(s) on 35 function(s)"
