/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int, int, int);
// int __usercall sub_4010B1@<eax>(int result@<eax>);
// void __usercall sub_404190(double@<st5>, double@<st2>, double@<st0>);
// void __usercall sub_40420B(int@<eax>, int@<edi>, int@<esi>, double@<st5>, double@<st0>);
void sub_404311();

//-------------------------------------------------------------------------
// Data declarations

// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);


//----- (0040105C) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  sub_4010B1(0x10000);
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 3;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (004010B1) --------------------------------------------------------
int __usercall sub_4010B1@<eax>(int result@<eax>)
{
  int v1; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v1);
  MEMORY[0] &= result;
  return result;
}

//----- (00404190) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_404190(double a1@<st5>, double a2@<st2>, double a3@<st0>)
{
  double v3; // st7
  int v4; // [esp-4h] [ebp-4h]

  v3 = a3 + a2;
  sub_40420B(17042166, -1192740101, v4, a1, v3);
  sub_40420B(1460838446, -1192740101, v4, a1, v3);
}
// 4041EB: positive sp value 4 has been found
// 404190: could not find valid save-restore pair for esi
// 4041FF: variable 'v4' is possibly undefined

//----- (0040420B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40420B(int a1@<eax>, int a2@<edi>, int a3@<esi>, double a4@<st5>, double a5@<st0>)
{
  int v5; // eax
  int v6; // ecx
  int v7; // eax
  int v8; // edi
  int v10; // eax
  int v12; // edx
  int v13; // edi
  int v14; // edx
  int v15; // ecx
  int v17; // edi
  int v18; // eax
  int v23; // edi
  __int16 v24; // ax
  char v25; // cc
  int savedregs; // [esp+0h] [ebp+0h]

  __asm { fmul    st(3), st }
  v5 = a1 ^ (1 << a2);
  v6 = __ROL4__(savedregs, 60);
  if ( !__CFSHL__(savedregs, 60) )
  {
    a2 &= v6;
    v6 = (char)v5 >> 8;
  }
  v7 = -v5;
  v8 = v7 + (v7 != 0) + a2 - 1;
  __asm { fsub    st, st }
  v10 = -1886357423 * v7;
  if ( _SF )
    v10 = -1886357423;
  _ESI = a3 + 525;
  v12 = __ROL4__(-1886357423, 15);
  v13 = v6 & (v8 + 1);
  if ( v13 )
  {
    v6 |= 1 << v13;
    v13 = v6;
    v10 = v12;
  }
  v14 = __ROL4__(v10, 60);
  v15 = v6 >> 16;
  if ( v13 >= 0 )
    v15 = _ESI;
  _EBX = _ESI + 964;
  while ( 1 )
  {
    HIWORD(v18) = -9449;
    v17 = _ESI;
    v15 >>= 31;
    __asm { fcom    st(1) }
    LOWORD(v18) = v14 ^ 0x92A;
    __asm { repne sub dword ptr [esi], 997355CDh }
    if ( _SF ^ _OF | _ZF )
    {
      v14 = v18;
      v17 = 593983491;
    }
    v23 = -v17;
    if ( v23 >= 1 && v23 != 0 )
    {
      __asm { fsubr   st(5), st }
      LOWORD(v18) = 28789;
      __asm { rep cld }
    }
    v24 = v18 - ((v23 != 0) + 10437);
    _ESI += 4;
    v14 = -v14;
    if ( (v15 & v24 & 0x80u) == 0 )
      break;
    __asm { fcom    st(1) }
    v25 = ((__int16)((v15 ^ v24) + v14) < 0) ^ __OFADD__(v15 ^ v24, (_WORD)v14);
    LOWORD(v14) = (v15 ^ v24) + v14;
    __asm { rep cmp esi, ebx }
    if ( !v25 )
    {
      __asm { fmul    st, st }
      JUMPOUT(0x404373);
    }
  }
  sub_404311();
  sub_404311();
}
// 40421C: positive sp value 4 has been found
// 40420E: inconsistent fpu stack
// 40436D: control flows out of bounds to 404373
// 40421C: variable 'savedregs' is possibly undefined
// 404246: variable '_SF' is possibly undefined

//----- (00404311) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_404311()
{
  __asm
  {
    fadd    st(2), st
    fadd    st(6), st
  }
  JUMPOUT(0x404337);
}
// 40432D: positive sp value 4 has been found
// 40431A: inconsistent fpu stack
// 404336: control flows out of bounds to 404337

// nfuncs=5 queued=5 decompiled=5 lumina nreq=0 worse=0 better=0
// ALL OK, 5 function(s) have been successfully decompiled
