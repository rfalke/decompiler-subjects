/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int a1, int a2, int a3);
// int __usercall sub_4010B1@<eax>(int result@<eax>);
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// void __usercall sub_404190(double a1@<st5>, double a2@<st2>, double a3@<st0>);
// void __usercall sub_40420B(int a1@<eax>, int a2@<edi>, int a3@<esi>, double a4@<st5>, double a5@<st0>);
void sub_404311();


//----- (0040105C) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  sub_4010B1(0x10000);
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 3;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (004010B1) --------------------------------------------------------
int __usercall sub_4010B1@<eax>(int result@<eax>)
{
  int v1; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v1);
  MEMORY[0] &= result;
  return result;
}

//----- (00404190) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_404190(double a1@<st5>, double a2@<st2>, double a3@<st0>)
{
  double v3; // st7
  int v4; // [esp-4h] [ebp-4h]

  v3 = a3 + a2;
  sub_40420B(17042166, -1192740101, v4, a1, v3);
  sub_40420B(1460838446, -1192740101, v4, a1, v3);
}
// 4041EB: positive sp value 4 has been found
// 404190: could not find valid save-restore pair for esi
// 4041FF: variable 'v4' is possibly undefined

//----- (0040420B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40420B(int a1@<eax>, int a2@<edi>, int a3@<esi>, double a4@<st5>, double a5@<st0>)
{
  int v5; // eax
  int v6; // ecx
  int v7; // eax
  int v8; // edi
  double v9; // st2
  int v11; // eax
  int v13; // edx
  int v14; // edi
  int v15; // edx
  int v16; // ecx
  int v18; // edi
  int v19; // eax
  int v23; // edi
  __int16 v24; // ax
  char v25; // cc
  int savedregs; // [esp+0h] [ebp+0h]

  v5 = a1 ^ (1 << a2);
  v6 = __ROL4__(savedregs, 60);
  if ( !__CFSHL__(savedregs, 60) )
  {
    a2 &= v6;
    v6 = (char)v5 >> 8;
  }
  v7 = -v5;
  v8 = v7 + (v7 != 0) + a2 - 1;
  v9 = a4 - a4;
  v11 = -1886357423 * v7;
  if ( _SF )
    v11 = -1886357423;
  _ESI = a3 + 525;
  v13 = __ROL4__(-1886357423, 15);
  v14 = v6 & (v8 + 1);
  if ( v14 )
  {
    v6 |= 1 << v14;
    v14 = v6;
    v11 = v13;
  }
  v15 = __ROL4__(v11, 60);
  v16 = v6 >> 16;
  if ( v14 >= 0 )
    v16 = _ESI;
  _EBX = _ESI + 964;
  while ( 1 )
  {
    HIWORD(v19) = -9449;
    v18 = _ESI;
    v16 >>= 31;
    LOWORD(v19) = v15 ^ 0x92A;
    __asm { repne sub dword ptr [esi], 997355CDh }
    if ( _SF ^ _OF | _ZF )
    {
      v15 = v19;
      v18 = 593983491;
    }
    v23 = -v18;
    if ( v23 >= 1 && v23 != 0 )
    {
      a5 = v9 - a5;
      LOWORD(v19) = 28789;
      __asm { rep cld }
    }
    v24 = v19 - ((v23 != 0) + 10437);
    _ESI += 4;
    v15 = -v15;
    if ( (v16 & v24 & 0x80u) == 0 )
      break;
    v25 = ((__int16)((v16 ^ v24) + v15) < 0) ^ __OFADD__(v16 ^ v24, (_WORD)v15);
    LOWORD(v15) = (v16 ^ v24) + v15;
    __asm { rep cmp esi, ebx }
    if ( !v25 )
      JUMPOUT(0x404373);
  }
  sub_404311();
  sub_404311();
}
// 40421C: positive sp value 4 has been found
// 40436D: control flows out of bounds to 404373
// 40421C: variable 'savedregs' is possibly undefined
// 404246: variable '_SF' is possibly undefined

//----- (00404311) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_404311()
{
  JUMPOUT(0x404337);
}
// 40432D: positive sp value 4 has been found
// 404336: control flows out of bounds to 404337

// nfuncs=5 queued=5 decompiled=5 lumina nreq=0 worse=0 better=0
// ALL OK, 5 function(s) have been successfully decompiled
