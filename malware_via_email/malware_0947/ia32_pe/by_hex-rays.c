/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// char __usercall start@<al>(unsigned int _EAX@<eax>, int@<edx>, unsigned int _ECX@<ecx>, int@<ebx>, int@<ebp>, unsigned int@<edi>, unsigned int@<esi>);


//----- (0040651A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
char __usercall start@<al>(
        unsigned int _EAX@<eax>,
        int a2@<edx>,
        unsigned int _ECX@<ecx>,
        int a4@<ebx>,
        int a5@<ebp>,
        unsigned int a6@<edi>,
        unsigned int a7@<esi>)
{
  int v8; // edx
  int v10; // edx
  int v13; // edi
  int v15; // edi
  char v18; // tt
  bool v20; // cf
  char v21; // cl
  int v26; // esi
  int v27; // ecx
  unsigned int v28; // ebx
  char v30; // cf
  char v31; // cl
  bool v32; // tt
  int v33; // edi
  int v37; // esi
  int v38; // edx
  char v39; // tt
  int v40; // edi
  int v41; // edx
  unsigned int v42; // esi
  int v43; // eax
  int v50; // edx
  signed int v51; // esi
  int v54; // esi
  int v55; // ebx
  int v56; // edx
  int v58; // edi
  unsigned int v60; // edi
  __int16 v61; // ax
  int v63; // ebx
  unsigned int v64; // eax
  int v65; // eax
  bool v67; // cf
  int v68; // edi
  bool v72; // tt
  char v74; // zf
  int v76; // ebx
  __int16 v77; // di
  unsigned int v83; // [esp-24h] [ebp-24h]
  char v84; // [esp-1Fh] [ebp-1Fh]
  int v85; // [esp-14h] [ebp-14h]
  void *retaddr[2]; // [esp+0h] [ebp+0h]

  __asm { rcr     al, cl }
  _EBX = a4 >> 23;
  LOBYTE(_EBX) = __ROL1__(_EBX, 14);
  __asm { rcl     bl, 1Eh }
  BYTE1(a2) = a2 + BYTE1(a2) - (__CFADD__((_BYTE)a2, BYTE1(a2)) - 126);
  LOWORD(a6) = (_WORD)a6 << _ECX << _ECX;
  v60 = a6 >> 15;
  LOWORD(v60) = _ECX & v60;
  v61 = _EAX - _ECX - _EBX;
  LOBYTE(a2) = 0;
  BYTE1(_EBX) |= 0x64u;
  LOWORD(v60) = v60 - v61;
  LOBYTE(_EBX) = _EBX - 9;
  v20 = __CFSHL__(v61, _ECX);
  LOWORD(_EAX) = v61 << _ECX;
  BYTE1(a2) = -__ROL1__(BYTE1(a2), _ECX);
  LOWORD(a2) = __ROL2__(a2, _ECX);
  v56 = v20 + a2 + 1330241244;
  BYTE1(_EAX) <<= _ECX;
  LOWORD(_EBX) = _EBX - _EAX;
  __asm { rcl     bl, 0Bh }
  v20 = __CFSHR__(_EBX, _ECX);
  LOBYTE(_EBX) = (char)_EBX >> _ECX;
  BYTE1(_EAX) -= v20 + 5;
  _EDX = v56 ^ 0x54EF80C9;
  if ( _EBX == -1309943901 )
  {
    v58 = v60 + 4;
    v83 = (unsigned __int16)__SS__;
    __asm { fcomp5  st(3), st }
    while ( 1 )
    {
      LOBYTE(_EAX) = *(_BYTE *)(_EDX - 1);
LABEL_16:
      if ( _EAX != -1073741778 )
      {
        _CL = _ECX - 1;
        __asm { rcl     al, cl }
        return _EAX;
      }
      v63 = 2 * _EBX;
      __asm { rcl     dl, 13h }
      LOBYTE(v63) = __ROL1__(0, _ECX);
      v39 = __CFSHR__(_EDX, _ECX);
      v38 = __ROR4__(_EDX, _ECX);
      v20 = __CFADD__(v39, BYTE1(_ECX));
      BYTE1(_ECX) += v39;
      v20 |= __CFADD__(BYTE1(_ECX), 62);
      BYTE1(_ECX) += 62;
      LOBYTE(_ECX) = v63 + v20 + _ECX;
      v40 = v58 >> 29;
      BYTE1(v38) &= BYTE1(_ECX);
      v51 = a7 - 807644244;
      LOWORD(v38) = v38 - 1;
      v41 = v38 - v40;
      BYTE1(v41) *= 2;
      _CX = -(__int16)_ECX;
      _EBX = __ROR4__((_CX != 0) + v63 - 1234514112, 28);
      __asm { rcr     cl, cl }
      _EAX = 3;
      __asm { rcr     cl, 4 }
      v8 = v41 ^ 0x2C3AB92D;
      __asm { rcr     bl, cl }
      LOWORD(_ECX) = v8 | _CX;
      LOBYTE(_EBX) = _EBX + 3;
      _EBX = 16 * _EBX;
      __asm { rcl     bl, 7 }
      BYTE1(_ECX) &= 0xBBu;
      _ECX = __ROL4__(_ECX + 578431161, 16);
      LOBYTE(v8) = -86;
      BYTE1(_EBX) *= 2;
      v50 = v8 + 1;
      LOWORD(v51) = (unsigned __int16)v51 >> _ECX;
      if ( v40 == 1298194113 )
        break;
      _EDI = v40 - 1;
      __asm
      {
        rcr     ecx, cl
        rcr     bh, cl
      }
      _ESI = v51 >> 1;
      v20 = __CFSHR__(BYTE1(_EBX), _ECX);
      SBYTE1(_EBX) >>= _ECX;
      _EDX = v20 + v50 + 3;
      LOWORD(_ECX) = __ROR2__(_ECX, _ECX);
      _EBX = _EBX << _ECX;
      if ( _EDI == 236505916 )
      {
        __asm
        {
          into
          rcl     edx, 1
        }
        JUMPOUT(0x406400);
      }
LABEL_46:
      BYTE1(_EBX) = (_EAX ^ BYTE1(_EBX)) + 1;
      __asm { rcr     esi, 6 }
      _EDX = 0;
      v76 = _EBX >> _ECX;
      v77 = __ROL4__(__ROR4__(_EDI, _ECX), _ECX);
      LOWORD(_ECX) = (_WORD)_ECX << _ECX;
      if ( _ECX == 17976311 )
      {
        LOBYTE(_EAX) = MEMORY[0x3C541492];
        __writeeflags(v83);
        return _EAX;
      }
      LOBYTE(v76) = v76 + 102;
      v20 = __CFSHR__(v76, 3);
      _EBX = v76 >> 3;
      BYTE1(_ECX) = v20 + (BYTE1(_ECX) << _ECX);
      v37 = __ROR4__(1207959552, 11);
      __GS__ = _EAX;
      __asm { rcl     bx, cl }
      LOBYTE(_EBX) = _EAX
                   + (__CFADD__(__CFSHR__(1207959552, 11), v77) | __CFADD__(
                                                                    (_WORD)_EAX,
                                                                    __CFSHR__(1207959552, 11) + v77))
                   + _EBX;
      if ( v37 != 42283116 )
        JUMPOUT(0x4063FA);
      v30 = 0;
      MEMORY[0xC2AEB034] = 0;
      _ECX = _ECX - 1;
      if ( !_ECX )
      {
        BYTE1(_ECX) = -19;
        v20 = 0;
        goto LABEL_37;
      }
      while ( 1 )
      {
        LOWORD(_ECX) = _EDX + v30 + (_WORD)_ECX;
        __asm { rcr     ebx, cl }
        BYTE1(_ECX) = ~BYTE1(_ECX);
        BYTE1(_EBX) = (unsigned __int8)(BYTE1(_EBX) + 1) >> _ECX;
        _ECX = _EDX ^ _ECX;
        __asm { rcr     bl, cl }
        HIWORD(v15) = 18377;
        _ESI = v37 + 117933120;
        LOBYTE(_ECX) = -(char)_ECX;
        BYTE1(_EBX) += _EAX + ((_BYTE)_ECX != 0);
        v18 = _EAX & 1;
        _EAX = __ROR4__(_EAX, 1);
        if ( !v18 )
        {
          __asm { rcr     esi, cl }
          LOBYTE(_EBX) = BYTE1(_EAX) + (_EBX ^ 0x78);
          goto LABEL_9;
        }
        LOBYTE(_ECX) = -(char)_ECX;
        LOWORD(v15) = 28470 >> _ECX;
        v58 = v15 - 618827535;
        if ( _EAX == -1646156194 )
          break;
        _ECX = _ECX >> _ECX;
        BYTE1(_ECX) += 127;
        v20 = __CFADD__((_WORD)_EAX, (_WORD)v58);
        LOWORD(v58) = _EAX + v58;
        LOWORD(_ECX) = v58 + v20 + (_WORD)_ECX + 1;
        __asm { rcl     ecx, cl }
        LOBYTE(_ECX) = _ECX & 0x60;
        v13 = __ROR4__(v58, _ECX);
        _ECX = _ECX + 1;
        LOBYTE(_ECX) = _EAX + _ECX;
        _EAX = __GS__;
        v28 = ((unsigned int)(-974230755 << _ECX) >> 1) | (__CFSHL__(-974230755, _ECX) << 31);
        _EDI = v13 - 733480312;
        if ( _EDI == 1021166334 )
        {
          __asm { iret }
          JUMPOUT(0x4064C4);
        }
        LOBYTE(_ECX) = _ECX ^ 0xE2;
        __asm { rcl     di, cl }
        LOWORD(_ESI) = _ESI - 1;
        LOBYTE(v28) = 122;
        BYTE1(_ECX) = BYTE1(v28);
        __asm { rcl     cl, 0Fh }
        LOWORD(v28) = ~(_WORD)v28;
        LOBYTE(v28) = (_BYTE)v28 << _ECX;
        _EBX = __ROL4__(v28, 23);
        _ECX = __ROL4__(_ECX, _ECX);
        BYTE1(_ECX) = __ROR1__(BYTE1(_ECX), _ECX);
        LOBYTE(_EBX) = __ROL1__(_EBX + 23, 15);
        BYTE1(_EBX) ^= _EDX++;
        _ESI = _EDI ^ _ESI;
        LOBYTE(_ECX) = _ECX | 8;
        __asm
        {
          rcr     si, cl
          rcl     bx, cl
        }
        LOBYTE(_ECX) = -(_ECX ^ 0xDE);
        v33 = _EDI - (((_BYTE)_ECX != 0) - 1574206798);
        BYTE1(_EBX) = ~BYTE1(_EBX);
        _EBX = _EBX | 0xD9CCF0F4;
        LOBYTE(_ECX) = BYTE1(_EDX) ^ _ECX;
        BYTE1(_ECX) = -BYTE1(_ECX);
        __asm { rcl     bl, cl }
        _EBX = __ROL4__(_EBX, 5);
        __asm { rcl     ecx, 1Eh }
        LOWORD(_EBX) = v33 ^ _EBX;
        BYTE1(_ECX) <<= _ECX;
        v37 = -(_ESI >> 1);
        if ( v33 == 593702359 )
          return _EAX;
        v20 = _EDX < 0x1CAFE4C;
        if ( _EDX == 30080588 )
        {
          v21 = __ROL4__(__CFADD__(__GS__, (_BYTE)_EBX) + _ECX + 502966841, 18);
          _DH = -2 << v21;
          LOBYTE(_EAX) = __ROR1__(__GS__, v21);
          __asm { rcr     dh, 18h }
          if ( _EAX == -1550854961 )
            JUMPOUT(0x4063D0);
          return _EAX;
        }
LABEL_37:
        v32 = v20;
        v20 = __CFADD__(v20, (_BYTE)_ECX);
        v31 = v32 + _ECX;
        v30 = v20 | __CFADD__(v31, -4);
        LOBYTE(_ECX) = v31 - 4;
      }
      v26 = *(_DWORD *)(_EDX - 18);
      LOWORD(v26) = v26 + 1;
      v27 = (*(_DWORD *)(a5 + 82) | _ECX) + 2088809834;
      BYTE1(v27) = __ROL1__(BYTE1(v27), 16);
      a7 = v26 & 0xE1E6ECCB;
      _ECX = _EDX + v27;
      LOWORD(v58) = ~(_WORD)v58;
      LOWORD(_ECX) = __ROL2__(_ECX, _ECX);
      BYTE1(_EBX) ^= 8u;
      if ( _EDX == -1 )
      {
        LOBYTE(_EAX) = 46;
        goto LABEL_16;
      }
    }
    __asm { aad     6Ch ; 'l' }
    __writeeflags(v83);
    BYTE1(_EAX) = v84;
    _EBX = v85;
LABEL_9:
    BYTE1(_EBX) = (char)(BYTE1(_EAX) & BYTE1(_EBX)) >> 7;
    if ( _EBX >> 19 != -1357933366 )
      JUMPOUT(0x4068C0);
    LOBYTE(_EAX) = MK_FP(retaddr[0], retaddr[0])();
  }
  else
  {
    __asm { rcl     bh, 8 }
    LOWORD(_EBX) = -(unsigned __int8)_EBX;
    BYTE1(_EBX) = ((_WORD)_EBX != 0) + BYTE1(_EBX) - 11;
    v10 = _EBX | _EDX;
    LOWORD(v10) = (_WORD)v10 << _ECX;
    LOWORD(v60) = (_WORD)v60 << _ECX;
    LOBYTE(v10) = v10 - 1;
    LOWORD(v10) = (unsigned __int16)v10 >> _ECX;
    BYTE1(_EBX) = v10 ^ (_ECX | BYTE1(_EBX));
    _EBX = _EBX ^ 0xCF9449ED;
    BYTE1(v10) = __ROL1__(BYTE1(v10), 18);
    v42 = -a7;
    v20 = v42 != 0;
    v54 = v42 + 1;
    __asm { rcr     bh, cl }
    _EBX = _EBX - (v20 - 1125355540);
    _EDX = __ROL4__(v10, _ECX);
    LOBYTE(_EBX) = _EBX - 99;
    BYTE1(_EBX) &= 0xF0u;
    BYTE1(_EDX) = BYTE1(_EBX);
    LOBYTE(_EDX) = BYTE1(_EBX) + _EBX;
    v43 = -104875841;
    BYTE1(v43) = __ROL1__(-72, 18);
    v43 <<= 17;
    LOWORD(_EBX) = v54;
    BYTE1(v43) &= 0x20u;
    _EDI = __ROL4__(v60, 10) << 28;
    LOBYTE(v43) = v43 - 1;
    _EAX = v54 & v43;
    __asm { rcl     edi, cl }
    BYTE1(_EDX) *= 32;
    if ( _EDX != 1075830543 )
    {
      while ( 1 )
      {
        BYTE1(_EAX) = __ROR1__(BYTE1(_EAX) & 0x62, _ECX);
        __asm { rcl     ax, cl }
        _ESI = -v54;
        BYTE1(_EDX) <<= _ECX;
        LOBYTE(_EDX) = _EDX - 1;
        _DX = _EDX ^ 0xE67B;
        HIBYTE(_DX) = __ROR1__(HIBYTE(_DX), _ECX);
        if ( _EBX == 1632255432 )
          break;
        v20 = __CFADD__((unsigned int)_EBX < 0x614A3DC8, (_BYTE)_DX);
        LOBYTE(_DX) = ((unsigned int)_EBX < 0x614A3DC8) + _DX;
        v20 |= __CFADD__(BYTE1(_ECX), (_BYTE)_DX);
        LOBYTE(_DX) = BYTE1(_ECX) + _DX;
        _AL = _DX + v20 + _EAX;
        __asm { rcl     al, 10h }
        v54 = __ROR4__(_ESI, 28);
        LOBYTE(_EBX) = BYTE1(_EBX) + 71;
        LOWORD(_EAX) = ~(_AL & 0x9B);
        __asm { rcr     bl, cl }
        v55 = -_EBX;
        LOBYTE(v55) = _ECX + v55;
        LOWORD(v55) = _ECX ^ v55;
        v20 = __CFSHR__(v55, 11);
        LOBYTE(v55) = 0;
        v72 = v20;
        v20 = __CFADD__(v20, (_BYTE)_EAX);
        LOBYTE(_EAX) = v72 + _EAX;
        v20 |= __CFADD__(BYTE1(v55), (_BYTE)_EAX);
        LOBYTE(_EAX) = BYTE1(v55) + _EAX;
        v20 = __CFSHR__(_EAX + v20 + BYTE1(_EAX), 11);
        BYTE1(_EAX) = 0;
        __asm { rcl     eax, cl }
        _EBX = v20 + v55 - 2123562466;
        __asm { rcl     edi, 0Bh }
        v20 = BYTE1(_EBX) < 0x82u;
        BYTE1(_EBX) += 126;
        LOBYTE(_EBX) = _EAX + v20 + _EBX;
        if ( _EAX != 1427671677 )
        {
          v64 = _EBX + (_EAX < 0x55188A7D) + _EAX;
          LOWORD(v54) = _EBX + v54;
          LOBYTE(_EBX) = __ROR1__(_EBX, _ECX);
          v65 = v64 | 0x6EE0AB34;
          v68 = _EDI | 0x2E5CEDFF;
          __asm { rcr     bx, cl }
          LOBYTE(_EBX) = _EBX + 44;
          v67 = (unsigned __int16)v68 < (unsigned __int16)v54;
          LOWORD(v68) = v68 - v54;
          _EBX = _EBX - ((__CFADD__(v67, v54) | __CFADD__(v67 + v54, -1134923268)) + _ECX);
          __asm { rcl     ebx, 0Ch }
          _EDI = __ROR4__(v68, 6);
          LOBYTE(v65) = __ROL1__(__ROR1__(v65, 25), 15);
          if ( v65 == -628685407 )
          {
            __asm
            {
              insd
              fisubr  dword ptr [edi-617F87Ah]
            }
            JUMPOUT(0x406971);
          }
          JUMPOUT(0x406628);
        }
        _EBX = -1116912787;
        __asm { insb }
        --_ECX;
        if ( !v74 && _ECX )
          JUMPOUT(0x4068E3);
        _EDI = _EDI - 1;
      }
      v83 = (unsigned __int16)__SS__;
      goto LABEL_46;
    }
    *(_BYTE *)v54 += _EAX;
  }
  return _EAX;
}
// 406679: positive sp value 20 has been found
// 4065C9: control flows out of bounds to 4065CB
// 4063CA: control flows out of bounds to 4063D0
// 4063FE: control flows out of bounds to 406400
// 4068E1: control flows out of bounds to 4068E3
// 40696A: inconsistent fpu stack
// 406970: control flows out of bounds to 406971
// 4064C2: control flows out of bounds to 4064C4
// 40669D: control flows out of bounds to 4068C0
// 4064EE: control flows out of bounds to 4063FA
// 406962: control flows out of bounds to 406628
// 406678: variable 'v84' is possibly undefined
// 406678: variable 'v85' is possibly undefined
// 406869: variable 'v74' is possibly undefined

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
