/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall sub_401025(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>);
// void __usercall sub_401045(__int32 a1@<esi>, int a2@<ebp>);
// void __usercall __noreturn sub_40107B(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<esi>);
// void __usercall __noreturn start(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>);
// void __usercall sub_401168(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>);
// void __usercall sub_401187(int a1@<ecx>, int a2@<edi>);
// void __usercall sub_4011A1(int a1@<edx>, int a2@<ecx>, int a3@<ebx>);
// void __usercall sub_4011D3(int a1@<edx>, __int32 a2@<ebx>, int a3@<edi>, int a4@<esi>);
// void __usercall sub_40120C(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, __int32 a4@<edi>, int a5@<esi>);
// void __usercall sub_401224(char a1@<al>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>);
// void __usercall sub_40123C(int a1@<ebp>);
// void __usercall sub_401254(char *this@<ecx>, int a2@<ebp>);
// void __usercall sub_40126E(char *a1@<ecx>, int a2@<ebp>);
// void __usercall sub_40129F(int a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<esi>);
void __fastcall sub_4012F0(int a1, int a2);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_40105F; // weak
_UNKNOWN loc_4010DF; // weak
_UNKNOWN loc_4010FB; // weak
_UNKNOWN loc_40114A; // weak
_UNKNOWN loc_4011B7; // weak
_UNKNOWN loc_401288; // weak
_UNKNOWN loc_4012B6; // weak
_UNKNOWN loc_4012D2; // weak


//----- (00401025) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401025(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>)
{
  int v5; // ebx
  __int32 v6; // esi
  int v7; // ecx
  int v8; // ebx
  int v9; // [esp+4h] [ebp-4h]
  int retaddr; // [esp+8h] [ebp+0h]

  *(&retaddr - 3) = v9;
  v5 = (a5 - a1) ^ a3;
  v6 = v5 + 1;
  v7 = v5 + a2;
  v8 = (v5 + 1) ^ v7 ^ (v5 - 1);
  sub_401187(a1 ^ v7, a4);
  *(_DWORD *)(v8 + 1290704788) += a4;
  sub_401045(v6, retaddr);
}
// 401029: positive sp value 4 has been found
// 401025: could not find valid save-restore pair for ebp

//----- (00401045) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401045(__int32 a1@<esi>, int a2@<ebp>)
{
  __int32 v2; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v2, a1);
  sub_40123C(a2);
  JUMPOUT(0x401064);
}
// 40104D: positive sp value 4 has been found
// 40105F: control flows out of bounds to 401064

//----- (0040107B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_40107B(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<esi>)
{
  sub_4011A1(a1, a3 - (a2 | a1 ^ a4), a1 | a3);
  JUMPOUT(0x8A1670FC);
}
// 40107F: positive sp value 4 has been found
// 401094: control flows out of bounds to 8A1670FC

//----- (004010BF) --------------------------------------------------------
void __usercall __noreturn start(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>)
{
  sub_40107B(a2 + a1 - a4 - (a4 | (a2 - a5)) - 1, a2 - a5 + (a4 | (a2 - a5)), a3, a2 - a5 + 1);
}

//----- (00401168) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401168(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  int v6; // ecx
  int v7; // edi
  int v8; // ecx

  v6 = a5 | a3;
  v7 = a5 ^ (a6 | a4);
  sub_401224(a1, v7 ^ a2, a1 ^ v6, v7, v7, a6);
  sub_401187(v8, v7);
}
// 40116E: positive sp value 4 has been found
// 401182: variable 'v8' is possibly undefined

//----- (00401187) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401187(int a1@<ecx>, int a2@<edi>)
{
  int v3; // edx
  int v4; // ecx
  char v5; // zf
  int v6; // [esp-4h] [ebp-4h]

  ((void (__fastcall *)(int, int))((char *)&loc_4012B6 + 6))(a1, a2 + 1);
  if ( !v5 )
  {
    __asm { smsw    eax }
    ((void (__usercall *)(int@<ecx>, double@<st0>))loc_4010FB)(v3 | v6, (double)*(int *)(a2 + 1399202828));
    JUMPOUT(0x401142);
  }
  sub_4011A1(v3, v4, 1631597733);
}
// 401136: positive sp value A has been found
// 40113D: control flows out of bounds to 401142
// 401199: variable 'v5' is possibly undefined
// 40119C: variable 'v3' is possibly undefined
// 40119C: variable 'v4' is possibly undefined
// 401138: variable 'v6' is possibly undefined

//----- (004011A1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4011A1(int a1@<edx>, int a2@<ecx>, int a3@<ebx>)
{
  unsigned __int16 v3; // dx
  unsigned __int8 v4; // al

  ((void (__fastcall *)(int, int))((char *)&loc_40105F + 1))(a2 - (a3 - a2), a2 - (a3 - a2) + a1 + 1);
  v4 = __inbyte(v3);
  JUMPOUT(0x4011BC);
}
// 4011A5: positive sp value 4 has been found
// 4011B7: control flows out of bounds to 4011BC
// 4011B6: variable 'v3' is possibly undefined

//----- (004011D3) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4011D3(int a1@<edx>, __int32 a2@<ebx>, int a3@<edi>, int a4@<esi>)
{
  __int32 v4; // [esp-24h] [ebp-24h] BYREF

  _InterlockedExchange(&v4, a2);
  sub_40129F(v4 - 1, v4 | a1, v4 - 1 - a3, (v4 - 1) | a4);
  JUMPOUT(0x4011F5);
}
// 4011F0: positive sp value 24 has been found
// 4011F0: control flows out of bounds to 4011F5

//----- (0040120C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40120C(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, __int32 a4@<edi>, int a5@<esi>)
{
  char v6; // al
  int v7; // edx
  int v8; // ecx
  __int32 v9; // [esp-8h] [ebp-8h] BYREF
  __int16 v10; // [esp-4h] [ebp-4h]

  _InterlockedExchange(&v9, a4);
  __asm { repne pop edi }
  v6 = ((int (__fastcall *)(int, int))((char *)&loc_401288 + 2))(a2, a2 ^ (a3 + (a5 ^ a1)));
  sub_401224(v6, v7, v8, *MK_FP(v10, v7 - 123) & (a3 - 1), _EDI, a5);
}
// 401221: positive sp value 8 has been found
// 401222: variable 'v7' is possibly undefined
// 401222: variable 'v8' is possibly undefined

//----- (00401224) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401224(char a1@<al>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  int v6; // ebp
  char v7; // ah
  int v8; // [esp+20h] [ebp-8h]
  int v9; // [esp+24h] [ebp-4h]

  *(&v9 - 11) = v8;
  if ( (a1 & 8) == 0 )
  {
    v6 = v9;
    sub_4011D3(a3 + a2, a4 + 1, a5, a6);
    if ( (v7 & 0x40) != 0 )
      JUMPOUT(0x401269);
    sub_40123C(v6);
  }
}
// 40122E: positive sp value 8 has been found
// 401239: control flows out of bounds to 401269
// 401224: could not find valid save-restore pair for ebp
// 401238: variable 'v7' is possibly undefined

//----- (0040123C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40123C(int a1@<ebp>)
{
  char *v1; // ecx
  char v2; // zf
  char v3; // sf
  char v4; // of
  unsigned int v5; // [esp-4h] [ebp-4h]

  ((void (*)(void))loc_40114A)();
  __writeeflags(v5);
  if ( !(v3 ^ v4 | v2) )
    JUMPOUT(0x401256);
  sub_401254(v1, a1);
}
// 401252: positive sp value 8 has been found
// 401252: control flows out of bounds to 401256
// 401251: variable 'v5' is possibly undefined
// 401252: variable 'v3' is possibly undefined
// 401252: variable 'v4' is possibly undefined
// 401252: variable 'v2' is possibly undefined
// 401253: variable 'v1' is possibly undefined

//----- (00401254) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401254(char *this@<ecx>, int a2@<ebp>)
{
  char *v2; // ecx
  void *v3; // [esp+8h] [ebp-4h]
  void *retaddr; // [esp+Ch] [ebp+0h]

  *(&retaddr - 4) = v3;
  ((void (__thiscall *)(char *))((char *)&loc_4012D2 + 2))(this - 2);
  sub_40126E(v2, a2);
}
// 401258: positive sp value 4 has been found
// 401269: variable 'v2' is possibly undefined

//----- (0040126E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40126E(char *a1@<ecx>, int a2@<ebp>)
{
  unsigned int v2; // ecx
  bool v3; // cf

  sub_401254(a1, a2);
  v3 = *(_DWORD *)(a2 + 11) < v2;
  *(_DWORD *)(a2 + 11) -= v2;
  *(_DWORD *)(5 * v2) += v2 + v3;
  JUMPOUT(0x40128B);
}
// 401277: positive sp value 4 has been found
// 401288: control flows out of bounds to 40128B
// 401285: variable 'v2' is possibly undefined

//----- (0040129F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40129F(int a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<esi>)
{
  ((void (__fastcall *)(int, int))((char *)&loc_4011B7 + 3))(a2, (a3 + a1) ^ (a4 | a2));
  MEMORY[0x9F090E68]();
  JUMPOUT(0x4012BD);
}
// 4012A3: positive sp value 4 has been found
// 4012B6: control flows out of bounds to 4012BD

//----- (004012F0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_4012F0(int a1, int a2)
{
  char v3; // cf
  int v4; // ecx
  int v5; // ebx
  __int16 v6; // [esp-24h] [ebp-24h]
  int v7; // [esp-20h] [ebp-20h]
  int v8; // [esp-18h] [ebp-18h]
  _DWORD v9[4]; // [esp-14h] [ebp-14h]
  int v10; // [esp-4h] [ebp-4h]

  _EAX = ((int (__fastcall *)(int, int))loc_4010DF)(a1 - 1, a2);
  v3 = __CFADD__(_EAX < 0xE8EA6012, _EAX + 387293166) | __CFADD__((_EAX < 0xE8EA6012) + _EAX + 387293166, 2004811776);
  v4 = *MK_FP(v6, &v8);
  v5 = *MK_FP(v6, v9);
  v10 = *MK_FP(v6, &v7);
  __asm { das }
  if ( !v3 )
  {
    v9[3] = (unsigned __int16)__DS__;
    __asm { int     2Eh; DOS 2+ internal - EXECUTE COMMAND }
    *(_DWORD *)(v5 + 21) = v4;
    JUMPOUT(0xBE642E72);
  }
  JUMPOUT(0x4012A7);
}
// 40130C: positive sp value 28 has been found
// 401332: control flows out of bounds to BE642E72
// 40130E: control flows out of bounds to 4012A7
// 40130B: variable 'v6' is possibly undefined

// nfuncs=15 queued=15 decompiled=15 lumina nreq=0 worse=0 better=0
// ALL OK, 15 function(s) have been successfully decompiled
