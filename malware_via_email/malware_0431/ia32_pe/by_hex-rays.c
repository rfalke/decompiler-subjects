/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int sub_4038B6();
int sub_4038C6(void); // weak
// int __usercall sub_403961@<eax>(char *@<ecx>, __int16@<bx>, int _EDI@<edi>);


//----- (004038B6) --------------------------------------------------------
int sub_4038B6()
{
  _AL = sub_4038C6();
  __asm { aaa }
  return sub_4038C6();
}
// 4038C6: using guessed type int sub_4038C6(void);

//----- (004038C6) --------------------------------------------------------
#error "4038C6: stack frame is too big (funcsize=0)"

//----- (00403961) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_403961@<eax>(char *a1@<ecx>, __int16 a2@<bx>, int _EDI@<edi>)
{
  int v4; // esi
  bool v5; // cf
  char *v6; // eax
  unsigned __int16 v8; // si
  char v9; // sf
  int v10; // edx
  int savedregs; // [esp+0h] [ebp+0h]
  void *retaddr[2]; // [esp+4h] [ebp+4h]

  v5 = __CFADD__(a2, a2);
  _EBX = savedregs;
  __asm
  {
    rcr     ebx, 0F4h
    rcr     ebx, 0C0h
  }
  LOWORD(v4) = v5 + 32236;
  v5 = __CFADD__(a1, 962);
  v6 = a1 + 962;
  do
  {
    *(_DWORD *)a1 ^= 0xA34BC970;
    _EDX = (_EDI >> 4) - 1775031620;
    __asm
    {
      rcl     edx, 88h
      rcl     edx, 54h
    }
    a1 += 4;
    v8 = (((unsigned __int16)(v4 + v5 + (_WORD)v4) ^ 0x6BD4) - 2) << 10;
    _BitScanReverse((unsigned int *)&_EDI, 0xFFFFFFB6);
    __asm
    {
      fcom    st(4)
      fcom    st(5)
      fcom    st(7)
    }
    v10 = ~_EDX;
    if ( !v9 )
    {
      __asm
      {
        fadd    st, st
        fadd    st(2), st
        fadd    st(4), st
        fadd    st(5), st
      }
    }
    v4 = v8 ^ (1 << v8);
    v5 = a1 < v6;
  }
  while ( (int)a1 < (int)v6 );
  __asm
  {
    fcomp   st(6)
    fcomp   st(7)
    fsubr   st(1), st
    rep not edi
    fmul    st(2), st
    fmul    st(4), st
    fmul    st(6), st
    fmul    st(7), st
  }
  return MK_FP(retaddr[0], retaddr[0])(0, ~(v10 * v10 * v10 * v10));
}
// 403970: positive sp value 4 has been found
// 4039D4: inconsistent fpu stack
// 40396F: variable 'savedregs' is possibly undefined
// 4039DF: variable 'v9' is possibly undefined

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 3 function(s)"
