/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall start(unsigned int a1@<ebx>, unsigned int a2@<ebp>, int a3@<edi>, _DWORD *a4@<esi>, double a5@<st4>, double _ST7@<st0>, __int128 _XMM0@<xmm0>);
// HANDLE __stdcall BeginUpdateResourceA(LPCSTR pFileName, BOOL bDeleteExistingResources);
// BOOL __stdcall VirtualProtect(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401000; // weak


//----- (0040329E) --------------------------------------------------------
void __usercall start(unsigned int a1@<ebx>, unsigned int a2@<ebp>, int a3@<edi>, _DWORD *a4@<esi>, double a5@<st4>, double _ST7@<st0>, __int128 _XMM0@<xmm0>)
{
  int *v9; // eax
  unsigned __int32 v10; // eax
  int **v11; // edi
  _DWORD *v12; // esi
  bool v13; // of
  _DWORD *v14; // edi
  double *v15; // eax
  bool v16; // cf
  int v17; // ebp
  unsigned int v18; // ett
  unsigned __int32 v19; // eax
  _BYTE *v20; // edi
  _DWORD *v23; // ecx
  unsigned int v24; // eax
  unsigned int v25; // ett
  DWORD v26; // edi
  int v32; // ebx
  char *v34; // ecx
  _DWORD *v35; // eax
  DWORD v36; // eax
  _DWORD *v37; // ett
  unsigned int v38; // eax
  int *v40; // esi
  unsigned int v41; // ecx
  int v42; // ebx
  int v43; // eax
  int *v44; // edx
  unsigned int v45; // eax
  _DWORD *v46; // esi
  int v47; // edi
  unsigned int v48; // eax
  unsigned int v49; // ebx
  bool v50; // cf
  bool v51; // zf
  int v52; // eax
  int v53; // [esp+4h] [ebp-1Ch]
  unsigned int v54; // [esp+8h] [ebp-18h] BYREF
  int v55; // [esp+Ch] [ebp-14h] BYREF
  DWORD v56; // [esp+10h] [ebp-10h] BYREF
  _DWORD *v57; // [esp+14h] [ebp-Ch]
  unsigned int *v58; // [esp+18h] [ebp-8h] BYREF
  unsigned int v59; // [esp+1Ch] [ebp-4h] BYREF
  void *retaddr; // [esp+20h] [ebp+0h] BYREF

  v59 = a1;
  v58 = (unsigned int *)a3;
  v57 = a4;
  v40 = (int *)((char *)&loc_401000 + (v53 ^ ((unsigned int)BeginUpdateResourceA(0, 1) + a2)));
  v56 = 0;
  VirtualProtect(v40, 0x229Eu, 0x40u, &v56);
  v42 = 2215;
  do
  {
    v43 = *v40++;
    v41 &= 0xFFFFFFAF;
    *(v40 - 1) = v43 ^ 0xDD2E7590;
    --v42;
    v44 = v40;
    v45 = (unsigned int)v40;
  }
  while ( v42 );
  v46 = v57;
  v47 = (int)v58;
  v48 = v45 & 0xADCF1285;
  v49 = v59;
  v50 = __CFADD__(v48, 494048930);
  v51 = v48 == -494048930;
  v52 = v48 + 494048930;
  if ( v52 >= 0 )
  {
    *(double *)(v52 - 1864627043) = _ST7;
    if ( v51 )
    {
      *(double *)(v52 - 1862432651) = _ST7;
      if ( v51 )
      {
        v59 = (unsigned int)v46;
        if ( v51 )
        {
          v58 = (unsigned int *)v52;
          __asm { int     62h; reserved for user interrupt }
          JUMPOUT(0x4C03D0D2);
        }
        JUMPOUT(0x400FB8);
      }
      _AL = v50 + v52 + 21;
      __asm { daa }
      v9 = v44;
      LOBYTE(v9) = -10;
      *((_BYTE *)v9 - 66) ^= BYTE1(v41);
      JUMPOUT(0x401056);
    }
    JUMPOUT(0x401039);
  }
  v59 = v52;
  v10 = __indword((unsigned __int16)v44);
  v15 = (double *)v44;
  *v58 = *v57;
  v12 = v46 + 1;
  v11 = (int **)(v47 + 4);
  v13 = __OFSUB__(*v11, v44);
  v51 = *v11 == v44;
  v14 = v11 + 1;
  LOBYTE(v15) = MEMORY[0x90DD23CC];
  if ( v51 )
  {
    if ( !v13 )
    {
      v16 = a2 < *(_DWORD *)v41;
      v17 = a2 - *(_DWORD *)v41;
      if ( v17 >= 0 )
      {
        v15[61295487] = _ST7;
        JUMPOUT(0x401045);
      }
      v18 = v16 + v49;
      v50 = *(_DWORD *)(v49 + 104) < v18;
      *(_DWORD *)(v49 + 104) -= v18;
      *(_BYTE *)v15 += v41 + v50;
      __asm { fstp    st(5) }
      v19 = __indword(0xDAu);
      *v14 = *v12;
      _ESI = v12 + 1;
      v20 = v14 + 1;
      *(_BYTE *)(v41 - 91) = __ROR1__(*(_BYTE *)(v41 - 91), 1);
      __writeeflags(v59);
      _EAX = (_DWORD *)MEMORY[0xE090FE4B]();
      v50 = (unsigned __int64)(-2089447203i64 * *(int *)(v49 + 768369824)) >> 32 != 0;
      __debugbreak();
      __asm { daa }
      v25 = v50 + *_EAX;
      v50 = (unsigned int)_EAX < v25;
      v24 = (unsigned int)_EAX - v25;
      LOBYTE(v24) = v50;
      __asm { outs    dx, dword ptr [si] }
      _EAX = v24 ^ 0x22D18ABE;
      v51 = (_EAX & 0x7FA82630) == 0;
      *v20 = *_ESI;
      _ESI = (unsigned int)(_ESI + 1);
      v26 = (DWORD)(v20 + 1);
      __debugbreak();
      *v23 = &retaddr;
      v59 = -110;
      BYTE1(_EAX) = -50;
      *(_WORD *)(v49 - 1873356240) = (__int16)a5;
      if ( !v51 )
      {
        v58 = &v59;
        __asm { aam     51h ; 'Q' }
        BYTE1(_EAX) &= BYTE1(v23);
        if ( (_EAX & 0x8000) != 0 )
        {
          if ( v23 )
          {
            v13 = __OFADD__(23, (_BYTE)_EAX);
            LOBYTE(_EAX) = _EAX + 23;
            if ( v13 )
            {
              __asm { aam     51h ; 'Q' }
              while ( 1 )
              {
                __asm { vcmpss  xmm3, xmm0, dword ptr [esi+54h], 8Dh }
                v58 = (unsigned int *)--_ESI;
                __asm { aad     7Dh ; '}' }
                v57 = (_DWORD *)_ESI;
                v56 = v26;
                v55 = v17;
                v54 = (unsigned int)&v58;
                v32 = -2023535343;
                LOBYTE(_RAX) = __inbyte(0x76u);
                __asm { popaw }
                WORD2(_RAX) = 120 * v17;
                if ( v51 )
                  break;
                while ( 1 )
                {
                  BYTE1(_RAX) = *(_BYTE *)(v26 + 1409182872);
                  MEMORY[0xD09FB1C6] &= v32;
                  if ( MEMORY[0xD09FB1C6] )
                    break;
                  WORD1(_RAX) &= 0x63DDu;
                  v51 = 2 * *(_DWORD *)(v17 + 1694406792) == 0;
                  *(_DWORD *)(v17 + 1694406792) *= 2;
                  v34 = (char *)v23 - 1;
                  if ( v51 && v34 )
                    JUMPOUT(0x4011B0);
                  v32 = v26 - 798970429;
                  WORD1(_RAX) ^= 0x876Au;
                  *(_BYTE *)(_ESI + 71) -= 8;
                  __writeeflags(_ESI);
                  __asm { arpl    ax, dx }
                  v35 = (_DWORD *)(_RAX ^ 0x72298C2E);
                  *(double *)((char *)v35 - 444299130) = a5;
                  v37 = v35;
                  v36 = v26;
                  *v37 = *(_DWORD *)_ESI;
                  v26 = (DWORD)(v37 + 1);
                  _ESI = v54;
                  v38 = v36 ^ 0x72A9DD6E;
                  _EDX = v17;
                  __asm { insb }
                  if ( v38 < 0x5F5A7DE5 && v38 != 1599765989 )
                  {
                    v54 = 1445869008;
                    __asm { outsb }
                    __writeeflags(v54);
                    *(_BYTE *)(_EDX + 1857819478) = (_BYTE)v34 - ((unsigned __int8)&v54 + __CFADD__(v38, -1599765989));
                    __writeeflags(v55);
                    JUMPOUT(0x4011D9);
                  }
                  v23 = (int *)((char *)&v55 + (_DWORD)&v34[__CFADD__(v38, -1599765989)]);
                  __asm { outsb }
                  __writeeflags(v55);
                  if ( !v51 )
                    JUMPOUT(0x401199);
                  _EAX = v17 + 8 * v32 - 8;
                  __asm { aas }
                  _RAX = (int)_RAX;
                  __writeeflags(v56);
                  LOBYTE(_RAX) = 34;
                  __asm { outsd }
                }
              }
              *(double *)(_RAX + 1694040820) = a5;
              __asm { fxch4   st(3) }
              JUMPOUT(0x401155);
            }
            JUMPOUT(0x401131);
          }
          JUMPOUT(0x401190);
        }
        JUMPOUT(0x4010E5);
      }
      JUMPOUT(0x4010FC);
    }
    JUMPOUT(0x4010BF);
  }
  JUMPOUT(0x4010CB);
}
// 401053: control flows out of bounds to 401056
// 4010A2: control flows out of bounds to 4010A4
// 401153: control flows out of bounds to 401155
// 4011D8: control flows out of bounds to 4011D9
// 40101A: control flows out of bounds to 4C03D0D2
// 401097: control flows out of bounds to 401045
// 401009: control flows out of bounds to 401039
// 401015: control flows out of bounds to 400FB8
// 401081: control flows out of bounds to 4010CB
// 401083: control flows out of bounds to 4010BF
// 40110D: control flows out of bounds to 4010FC
// 40111D: control flows out of bounds to 4010E5
// 40111F: control flows out of bounds to 401190
// 401125: control flows out of bounds to 401131
// 401169: control flows out of bounds to 401199
// 401193: control flows out of bounds to 4011B0
// 4032F7: variable 'v53' is possibly undefined
// 403338: variable 'v41' is possibly undefined
// 401101: variable 'v23' is possibly undefined
// 401149: variable 'v51' is possibly undefined

// nfuncs=3 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
