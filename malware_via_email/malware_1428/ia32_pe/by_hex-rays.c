/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall start(unsigned int a1@<ebx>, unsigned int a2@<ebp>, unsigned int *a3@<edi>, _DWORD *a4@<esi>, double a5@<st4>, double _ST7@<st0>, __int128 _XMM0@<xmm0>, double _ST6@<st1>);
// HANDLE __stdcall BeginUpdateResourceA(LPCSTR pFileName, BOOL bDeleteExistingResources);
// BOOL __stdcall VirtualProtect(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401000; // weak


//----- (0040329E) --------------------------------------------------------
void __usercall start(
        unsigned int a1@<ebx>,
        unsigned int a2@<ebp>,
        unsigned int *a3@<edi>,
        _DWORD *a4@<esi>,
        double a5@<st4>,
        double _ST7@<st0>,
        __int128 _XMM0@<xmm0>,
        double _ST6@<st1>)
{
  int *v10; // eax
  int **v11; // edi
  _DWORD *v12; // esi
  bool v13; // of
  _DWORD *v14; // edi
  double *v15; // eax
  bool v16; // cf
  signed int v17; // ebp
  unsigned int v18; // ett
  _BYTE *v19; // edi
  _DWORD *v22; // ecx
  unsigned int v23; // eax
  unsigned int v24; // ett
  DWORD v25; // edi
  int v31; // ebx
  char *v33; // ecx
  _DWORD *v34; // eax
  DWORD v35; // eax
  _DWORD *v36; // ett
  unsigned int v37; // eax
  int *v39; // esi
  unsigned int v40; // ecx
  int v41; // ebx
  int v42; // eax
  int *v43; // edx
  unsigned int v44; // eax
  _DWORD *v45; // esi
  int v46; // edi
  unsigned int v47; // eax
  unsigned int v48; // ebx
  bool v49; // cf
  bool v50; // zf
  int v51; // eax
  int v52; // [esp+4h] [ebp-1Ch]
  unsigned int v53; // [esp+8h] [ebp-18h] BYREF
  signed int v54; // [esp+Ch] [ebp-14h] BYREF
  DWORD v55; // [esp+10h] [ebp-10h] BYREF
  _DWORD *v56; // [esp+14h] [ebp-Ch]
  unsigned int *v57; // [esp+18h] [ebp-8h] BYREF
  unsigned int v58; // [esp+1Ch] [ebp-4h] BYREF
  void *retaddr; // [esp+20h] [ebp+0h] BYREF

  v58 = a1;
  v57 = a3;
  v56 = a4;
  v39 = (int *)((char *)&loc_401000 + (v52 ^ ((unsigned int)BeginUpdateResourceA(0, 1) + a2)));
  v55 = 0;
  VirtualProtect(v39, 0x229Eu, 0x40u, &v55);
  v41 = 2215;
  do
  {
    v42 = *v39++;
    v40 &= 0xFFFFFFAF;
    *(v39 - 1) = v42 ^ 0xDD2E7590;
    --v41;
    v43 = v39;
    v44 = (unsigned int)v39;
  }
  while ( v41 );
  v45 = v56;
  v46 = (int)v57;
  v47 = v44 & 0xADCF1285;
  v48 = v58;
  v49 = __CFADD__(v47, 494048930);
  v50 = v47 == -494048930;
  v51 = v47 + 494048930;
  if ( v51 >= 0 )
  {
    *(double *)(v51 - 1864627043) = _ST6;
    if ( v50 )
    {
      *(double *)(v51 - 1862432651) = _ST6;
      if ( v50 )
      {
        v58 = (unsigned int)v45;
        if ( v50 )
        {
          v57 = (unsigned int *)v51;
          __asm { int     62h; reserved for user interrupt }
          JUMPOUT(0x4C03D0D2);
        }
        JUMPOUT(0x400FB8);
      }
      _AL = v49 + v51 + 21;
      __asm { daa }
      v10 = v43;
      LOBYTE(v10) = -10;
      *((_BYTE *)v10 - 66) ^= BYTE1(v40);
      JUMPOUT(0x401056);
    }
    JUMPOUT(0x401039);
  }
  v58 = v51;
  __indword((unsigned __int16)v43);
  v15 = (double *)v43;
  *v57 = *v56;
  v12 = v45 + 1;
  v11 = (int **)(v46 + 4);
  v13 = __OFSUB__(*v11, v43);
  v50 = *v11 == v43;
  v14 = v11 + 1;
  LOBYTE(v15) = MEMORY[0x90DD23CC];
  if ( v50 )
  {
    if ( !v13 )
    {
      v16 = a2 < *(_DWORD *)v40;
      v17 = a2 - *(_DWORD *)v40;
      if ( v17 >= 0 )
      {
        v15[61295487] = _ST6;
        JUMPOUT(0x401045);
      }
      v18 = v16 + v48;
      v49 = *(_DWORD *)(v48 + 104) < v18;
      *(_DWORD *)(v48 + 104) -= v18;
      *(_BYTE *)v15 += v40 + v49;
      __asm { fstp    st(5) }
      __indword(0xDAu);
      *v14 = *v12;
      _ESI = v12 + 1;
      v19 = v14 + 1;
      *(_BYTE *)(v40 - 91) = __ROR1__(*(_BYTE *)(v40 - 91), 1);
      __writeeflags(v58);
      _EAX = (_DWORD *)MEMORY[0xE090FE4B]();
      v49 = (unsigned __int64)(-2089447203i64 * *(int *)(v48 + 768369824)) >> 32 != 0;
      __debugbreak();
      __asm { daa }
      v24 = v49 + *_EAX;
      v49 = (unsigned int)_EAX < v24;
      v23 = (unsigned int)_EAX - v24;
      LOBYTE(v23) = v49;
      __asm { outs    dx, dword ptr [si] }
      _EAX = v23 ^ 0x22D18ABE;
      v50 = (_EAX & 0x7FA82630) == 0;
      *v19 = *_ESI;
      _ESI = (unsigned int)(_ESI + 1);
      v25 = (DWORD)(v19 + 1);
      __debugbreak();
      *v22 = &retaddr;
      v58 = -110;
      BYTE1(_EAX) = -50;
      *(_WORD *)(v48 - 1873356240) = (__int16)a5;
      if ( !v50 )
      {
        v57 = &v58;
        __asm { aam     51h ; 'Q' }
        BYTE1(_EAX) &= BYTE1(v22);
        if ( (_EAX & 0x8000) != 0 )
        {
          if ( v22 )
          {
            v13 = __OFADD__(23, (_BYTE)_EAX);
            LOBYTE(_EAX) = _EAX + 23;
            if ( v13 )
            {
              __asm { aam     51h ; 'Q' }
              while ( 1 )
              {
                __asm { vcmpss  xmm3, xmm0, dword ptr [esi+54h], 8Dh }
                v57 = (unsigned int *)--_ESI;
                __asm { aad     7Dh ; '}' }
                v56 = (_DWORD *)_ESI;
                v55 = v25;
                v54 = v17;
                v53 = (unsigned int)&v57;
                v31 = -2023535343;
                LOBYTE(_RAX) = __inbyte(0x76u);
                __asm { popaw }
                WORD2(_RAX) = 120 * v17;
                if ( v50 )
                  break;
                while ( 1 )
                {
                  BYTE1(_RAX) = *(_BYTE *)(v25 + 1409182872);
                  MEMORY[0xD09FB1C6] &= v31;
                  if ( MEMORY[0xD09FB1C6] )
                    break;
                  WORD1(_RAX) &= 0x63DDu;
                  v50 = 2 * *(_DWORD *)(v17 + 1694406792) == 0;
                  *(_DWORD *)(v17 + 1694406792) *= 2;
                  v33 = (char *)v22 - 1;
                  if ( v50 && v33 )
                    JUMPOUT(0x4011B0);
                  v31 = v25 - 798970429;
                  WORD1(_RAX) ^= 0x876Au;
                  *(_BYTE *)(_ESI + 71) -= 8;
                  __writeeflags(_ESI);
                  __asm { arpl    ax, dx }
                  v34 = (_DWORD *)(_RAX ^ 0x72298C2E);
                  *(double *)((char *)v34 - 444299130) = a5;
                  v36 = v34;
                  v35 = v25;
                  *v36 = *(_DWORD *)_ESI;
                  v25 = (DWORD)(v36 + 1);
                  _ESI = v53;
                  v37 = v35 ^ 0x72A9DD6E;
                  _EDX = v17;
                  __asm { insb }
                  if ( v37 < 0x5F5A7DE5 && v37 != 1599765989 )
                  {
                    v53 = 1445869008;
                    __asm { outsb }
                    __writeeflags(v53);
                    *(_BYTE *)(_EDX + 1857819478) = (_BYTE)v33 - ((unsigned __int8)&v53 + __CFADD__(v37, -1599765989));
                    __writeeflags(v54);
                    JUMPOUT(0x4011D9);
                  }
                  v22 = (signed int *)((char *)&v54 + (_DWORD)&v33[__CFADD__(v37, -1599765989)]);
                  __asm { outsb }
                  __writeeflags(v54);
                  if ( !v50 )
                    JUMPOUT(0x401199);
                  _EAX = v17 + 8 * v31 - 8;
                  __asm { aas }
                  _RAX = (int)_RAX;
                  __writeeflags(v55);
                  LOBYTE(_RAX) = 34;
                  __asm { outsd }
                }
              }
              *(double *)(_RAX + 1694040820) = a5;
              __asm { fxch4   st(3) }
              JUMPOUT(0x401155);
            }
            JUMPOUT(0x401131);
          }
          JUMPOUT(0x401190);
        }
        JUMPOUT(0x4010E5);
      }
      JUMPOUT(0x4010FC);
    }
    JUMPOUT(0x4010BF);
  }
  JUMPOUT(0x4010CB);
}
// 401053: control flows out of bounds to 401056
// 4010A2: control flows out of bounds to 4010A4
// 401153: control flows out of bounds to 401155
// 4011D8: control flows out of bounds to 4011D9
// 40101A: control flows out of bounds to 4C03D0D2
// 401097: control flows out of bounds to 401045
// 401009: control flows out of bounds to 401039
// 401015: control flows out of bounds to 400FB8
// 401081: control flows out of bounds to 4010CB
// 401083: control flows out of bounds to 4010BF
// 40110D: control flows out of bounds to 4010FC
// 40111D: control flows out of bounds to 4010E5
// 40111F: control flows out of bounds to 401190
// 401125: control flows out of bounds to 401131
// 401169: control flows out of bounds to 401199
// 401193: control flows out of bounds to 4011B0
// 4032F7: variable 'v52' is possibly undefined
// 403338: variable 'v40' is possibly undefined
// 401101: variable 'v22' is possibly undefined
// 401149: variable 'v50' is possibly undefined

// nfuncs=3 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
