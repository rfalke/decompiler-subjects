/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// LPVOID __stdcall VirtualAllocEx(HANDLE hProcess, LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// HPEN __stdcall ExtCreatePen(DWORD iPenStyle, DWORD cWidth, const LOGBRUSH *plbrush, DWORD cStyle, const DWORD *pstyle);
// void __usercall __spoils<edx,ecx> sub_4011D4(char *a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<ebp>);
// void __usercall Ijcaakne(int a1@<ebp>, int a2@<edi>, int a3@<esi>);
// void __usercall BeginEtywyfievqe(char a1@<cf>, int a2@<eax>, int a3@<edx>, int a4@<ecx>, int a5@<ebp>, int a6@<edi>, char a7@<sil>, int a8, int a9, int a10, int a11, char a12);
// int __usercall bbpfamc_8@<eax>(char a1@<cf>, int a2@<eax>, int a3@<ebx>);
void __fastcall sub_401748(unsigned __int8 a1);
// void __usercall start(int a1@<eax>, int a2@<ecx>, int a3@<ebx>, int a4@<esi>, int a5, int a6, int a7, int a8, int a9);
// HPEN __usercall sub_401E83@<eax>(int a1@<ecx>, int a2@<ebx>, int a3@<edi>);
// HPEN __usercall sub_401E8C@<eax>(int a1@<ebx>, int a2@<edi>);
// void __usercall sub_401EB9(int a1@<ebp>, unsigned __int16 a2, int a3, unsigned int a4, int a5, int a6);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN sub_401599; // weak
int dword_4017D4 = 0; // weak
_UNKNOWN loc_401D73; // weak
_UNKNOWN sub_401E5E; // weak
void *off_405138 = (void *)0x411194; // weak
int dword_4090D9 = -1010580541; // weak
int dword_4092D4 = -1010580541; // weak
int dword_40937E = -1010580541; // weak
int dword_409408 = -1010580541; // weak
int dword_409434 = -1010580541; // weak
int dword_4094A4 = -1010580541; // weak
int dword_409538 = -1010580541; // weak
int dword_4096B1 = -1010580541; // weak
int dword_409807 = -1010580541; // weak
int dword_40987D = -1010580541; // weak
int dword_409972 = -1010580541; // weak
int dword_4099CB = -1010580541; // weak
int dword_4099FC = -1010580541; // weak
int dword_409BF9 = -1010580541; // weak
int dword_409CBC = -1010580541; // weak
int dword_409D15 = -1010580541; // weak
int dword_409D9C = -1010580541; // weak
int dword_409E18 = -1010580541; // weak
int dword_409E32 = -1010580541; // weak
int dword_409EB9 = -1010580541; // weak
int dword_409FCE = -1010580541; // weak
int dword_40A056 = -1010580541; // weak
int dword_40A089 = -1010580541; // weak
int dword_40A6A9 = -1010580541; // weak
int dword_40A70D = -1010580541; // weak
int dword_40A72A = -1010580541; // weak
int dword_40A741 = -1010580541; // weak
int dword_40A75F = -1010580541; // weak
int dword_40A78B = -1010580541; // weak
int dword_40A82A = -1010580541; // weak
int dword_40A856 = -1010580541; // weak
int dword_40A8AE = -1010580541; // weak
int dword_40A8FF = -1010580541; // weak
int dword_40A923 = -1010580541; // weak
int dword_40AA1E = -1010580541; // weak
int dword_40AA32 = -1010580541; // weak
int dword_40AA46 = -1010580541; // weak
int dword_40AB1C = -1010580541; // weak
int dword_40ABCC = -1010580541; // weak
int dword_40AD00 = -1010580541; // weak
int dword_40AEB1 = -1010580541; // weak
int dword_40AEC4 = -1010580541; // weak
int dword_40AF57 = -1010580541; // weak
int dword_40B13E = -1010580541; // weak
int dword_40B1C2 = -1010580541; // weak
int dword_40B1EA = -1010580541; // weak
int dword_40B28F = -1010580541; // weak
int dword_40B3CC = -1010580541; // weak
int dword_40B557 = -1010580541; // weak
int dword_40B65A = -1010580541; // weak
int dword_40B685 = -1010580541; // weak
int dword_40B698 = -1010580541; // weak
int dword_40B8A6 = -1010580541; // weak
int dword_40B8CA = -1010580541; // weak
int dword_40B937 = -1010580541; // weak
int dword_40BC4D = -1010580541; // weak
int dword_40BE2B = -1010580541; // weak
int dword_40BEB1 = -1010580541; // weak
int dword_40BFC8 = -1010580541; // weak
int dword_40C02C = -1010580541; // weak
int dword_40C107 = -1010580541; // weak
int dword_40C1DA = -1010580541; // weak
int dword_40C2F2 = -1010580541; // weak
int dword_40C5A0 = -1010580541; // weak
int dword_40C64C = -1010580541; // weak
int dword_40C829 = -1010580541; // weak
int dword_40C84C = -1010580541; // weak
int dword_40C896 = -1010580541; // weak
int dword_40C949 = -1010580541; // weak
int dword_40C98F = -1010580541; // weak
int dword_40CB6B = -1010580541; // weak
int dword_40CBE9 = -1010580541; // weak
int dword_40CCAC = -1010580541; // weak
int dword_40D004 = -1010580541; // weak
int dword_40D035 = -1010580541; // weak
int dword_40D349 = -1010580541; // weak
int dword_40D3C3 = -1010580541; // weak
int dword_40D468 = -1010580541; // weak
int dword_40D4F8 = -1010580541; // weak
int dword_40D53F = -1010580541; // weak
int dword_40D605 = -1010580541; // weak
int dword_40D618 = -1010580541; // weak


//----- (004011D4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __spoils<edx,ecx> sub_4011D4(char *a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<ebp>)
{
  int v4; // edx
  unsigned int *v5; // ecx
  int v6; // edx
  char *v7; // edi
  char *v8; // esi
  int v9; // ebx
  _BYTE *v10; // ebx
  int v11; // ebx
  unsigned int v12; // ecx
  int v13; // edx
  int v14; // edx
  int v15; // esi
  unsigned int *v16; // [esp-Ch] [ebp-10h]

  v4 = dword_40D468 + a2 - a3;
  dword_40C64C = v4;
  if ( &dword_4017D4 != (int *)-1 )
  {
    v5 = (unsigned int *)&dword_4017D4;
    v6 = dword_40C107 + v4;
    v7 = a1;
    v8 = a1;
    dword_40A70D = dword_40AA46 + (unsigned __int16)a1;
    v9 = dword_40A8FF;
    while ( 1 )
    {
      v10 = (_BYTE *)(a4 + v9);
      if ( a1 != v7 )
      {
        v11 = (char)v5;
        v16 = v5;
        v13 = v6 + 1;
        dword_409408 = (char)v5;
        v12 = *v5;
        LOBYTE(v13) = 100;
        if ( !v12 )
        {
          a3 = MEMORY[0x410CC3] + v11 - v13 - dword_409E32;
          dword_40C949 += a3;
          v15 = v8 - v7;
          do
          {
            *v7 = 0;
            a3 += MEMORY[0x410CAC] + MEMORY[0x41177C];
            ++v7;
            --v15;
          }
          while ( v15 );
          break;
        }
        dword_40A78B += (int)(v7 + 100);
        v10 = v7 + 101;
        v14 = dword_40AA32 + dword_40B1C2 + 1;
        qmemcpy(v7, v8, v12);
        v8 += v12;
        v7 += v12;
        dword_4092D4 += v14;
        v5 = v16;
      }
      v8 += 16;
      v9 = v10 - (_BYTE *)v5;
      dword_409807 = v9;
      ++v5;
      v6 = dword_40AA1E + dword_40B1C2;
      a1 = &v8[*v5];
    }
  }
  dword_40A741 -= a3;
}
// 4012D1: positive sp value 4 has been found
// 4017D4: using guessed type int dword_4017D4;
// 4092D4: using guessed type int dword_4092D4;
// 409408: using guessed type int dword_409408;
// 409807: using guessed type int dword_409807;
// 409E32: using guessed type int dword_409E32;
// 40A70D: using guessed type int dword_40A70D;
// 40A741: using guessed type int dword_40A741;
// 40A78B: using guessed type int dword_40A78B;
// 40A8FF: using guessed type int dword_40A8FF;
// 40AA1E: using guessed type int dword_40AA1E;
// 40AA32: using guessed type int dword_40AA32;
// 40AA46: using guessed type int dword_40AA46;
// 40B1C2: using guessed type int dword_40B1C2;
// 40C107: using guessed type int dword_40C107;
// 40C64C: using guessed type int dword_40C64C;
// 40C949: using guessed type int dword_40C949;
// 40D468: using guessed type int dword_40D468;

//----- (00401370) --------------------------------------------------------
void __usercall Ijcaakne(int a1@<ebp>, int a2@<edi>, int a3@<esi>)
{
  dword_40D004 -= a3;
  dword_40A78B = a1 - a2 - dword_40B557;
  JUMPOUT(0x40139F);
}
// 401399: control flows out of bounds to 40139F
// 40A70D: using guessed type int dword_40A70D;
// 40A78B: using guessed type int dword_40A78B;
// 40B557: using guessed type int dword_40B557;
// 40D004: using guessed type int dword_40D004;

//----- (00401475) --------------------------------------------------------
void __usercall BeginEtywyfievqe(char a1@<cf>, int a2@<eax>, int a3@<edx>, int a4@<ecx>, int a5@<ebp>, int a6@<edi>, char a7@<sil>, int a8, int a9, int a10, int a11, char a12)
{
  int v12; // eax
  int v13; // ebx
  int v14; // eax
  int v15; // ebx

  v12 = a2 - ((_DWORD)&dword_4096B1 + a1);
  dword_40B698 = (unsigned __int8)a3 - dword_40A6A9;
  dword_40BFC8 += dword_40D605 + a3 + a6 + v12 + 36;
  v13 = v12 + 1;
  v14 = (unsigned __int8)(v12 + 1);
  LOBYTE(a4) = *(&a12 + v14);
  v15 = v13 - a5 + 1 - a4;
  dword_40C2F2 -= v15;
  LOBYTE(v15) = 97;
  dword_4090D9 = dword_40B28F + MEMORY[0x411477] + dword_4099CB + v15;
  *(&a12 + v14) = *(&a12 + (unsigned __int8)(a7 + a4));
  JUMPOUT(0x4014E9);
}
// 4014E5: control flows out of bounds to 4014E9
// 4090D9: using guessed type int dword_4090D9;
// 4096B1: using guessed type int dword_4096B1;
// 4099CB: using guessed type int dword_4099CB;
// 40A6A9: using guessed type int dword_40A6A9;
// 40B28F: using guessed type int dword_40B28F;
// 40B698: using guessed type int dword_40B698;
// 40BFC8: using guessed type int dword_40BFC8;
// 40C2F2: using guessed type int dword_40C2F2;
// 40D605: using guessed type int dword_40D605;

//----- (00401735) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall bbpfamc_8@<eax>(char a1@<cf>, int a2@<eax>, int a3@<ebx>)
{
  int result; // eax

  result = a2 - ((_DWORD)&dword_40B8A6 + a1);
  dword_4099FC -= a3;
  return result;
}
// 401747: positive sp value 4 has been found
// 401735: could not find valid save-restore pair for ebp
// 4099FC: using guessed type int dword_4099FC;
// 40B8A6: using guessed type int dword_40B8A6;

//----- (00401748) --------------------------------------------------------
void __fastcall sub_401748(unsigned __int8 a1)
{
  int v1; // edx
  void **v2; // eax
  char *v3; // edi
  unsigned int v4; // edx
  char *v5; // [esp+0h] [ebp-8h]

  dword_40D618 -= a1;
  dword_40BEB1 = dword_40D349 - dword_40D468;
  v5 = (char *)VirtualAllocEx((HANDLE)0xFFFFFFFF, 0, 0x5510u, 0x1000u, 0x40u);
  dword_40BC4D = v1 - dword_409CBC + 1;
  v2 = &off_405138;
  dword_40AB1C += 115 * (_DWORD)v5;
  v3 = v5;
  dword_409BF9 -= dword_40CBE9 + dword_40C5A0 + 2;
  while ( 1 )
  {
    v4 = (unsigned int)v2[1];
    if ( !v4 )
      break;
    qmemcpy(v3, *v2, v4);
    v3 += v4;
    v2 += 2;
  }
  JUMPOUT(0x401EB8);
}
// 401E7E: control flows out of bounds to 401EB8
// 40178C: variable 'v1' is possibly undefined
// 405138: using guessed type void *off_405138;
// 409BF9: using guessed type int dword_409BF9;
// 409CBC: using guessed type int dword_409CBC;
// 40AB1C: using guessed type int dword_40AB1C;
// 40BC4D: using guessed type int dword_40BC4D;
// 40BEB1: using guessed type int dword_40BEB1;
// 40C5A0: using guessed type int dword_40C5A0;
// 40CBE9: using guessed type int dword_40CBE9;
// 40D349: using guessed type int dword_40D349;
// 40D468: using guessed type int dword_40D468;
// 40D618: using guessed type int dword_40D618;

//----- (00401C20) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall start(int a1@<eax>, int a2@<ecx>, int a3@<ebx>, int a4@<esi>, int a5, int a6, int a7, int a8, int a9)
{
  int v9; // eax
  int v10; // ecx
  int v11; // ebx
  char *v12; // ecx
  char *v13; // eax
  unsigned __int16 v14; // cx
  int v15; // edi
  int v16; // edx
  int v17; // ecx
  int v18; // ecx
  int v19; // edx
  int v20; // esi
  int v21; // ecx
  int v22; // edi
  int v23; // ecx
  char *v24; // [esp-18h] [ebp-18h]
  _DWORD v25[5]; // [esp-14h] [ebp-14h] BYREF
  int vars0; // [esp+0h] [ebp+0h]

  BYTE1(a1) = 90;
  dword_40A75F = dword_40B3CC + a2 - (dword_40AD00 + a1);
  dword_40937E += dword_40D004 + dword_40C829 + a3;
  v9 = ((int (__thiscall *)(_DWORD *))loc_401D73)(v25);
  v11 = a3 - (_DWORD)v25;
  dword_40AEB1 = v11;
  BYTE1(v9) = 75;
  dword_40CCAC += v9;
  v12 = (char *)v25 + v10 + dword_40ABCC + dword_40CBE9 + dword_40A72A;
  dword_40A056 += (int)v12;
  sub_401748((unsigned __int8)v12);
  v24 = v13;
  ((void (*)(void))sub_401E5E)();
  v15 = v14;
  sub_4011D4(v24, v16, v11, (int)v25);
  dword_40C1DA += a4;
  v18 = v17 - dword_40A8AE;
  dword_409D15 -= v19;
  v20 = v18 + v15 + a4;
  ((void (__thiscall *)(int, char *))sub_401599)(MEMORY[0x410E22] + v18, v24);
  dword_40A82A = v21;
  dword_40C84C -= v20 - dword_40C829;
  v22 = v25[0];
  dword_409972 = dword_40CB6B + v20 - dword_40C829;
  dword_40D3C3 -= MEMORY[0x411021] + v25[0] + MEMORY[0x41177C] - dword_40A923;
  v23 = vars0;
  dword_4099CB += vars0;
  LOBYTE(v23) = 44;
  ((void (__fastcall *)(int, _DWORD))v25[4])(v23, v25[3]);
  dword_40B13E = 41 * v22;
  JUMPOUT(0x401D73);
}
// 401D5B: positive sp value 14 has been found
// 401D6D: control flows out of bounds to 401D73
// 401C5D: variable 'v10' is possibly undefined
// 401CA3: variable 'v13' is possibly undefined
// 401CA9: variable 'v14' is possibly undefined
// 401CB5: variable 'v16' is possibly undefined
// 401CC4: variable 'v17' is possibly undefined
// 401CCE: variable 'v19' is possibly undefined
// 401CED: variable 'v21' is possibly undefined
// 40937E: using guessed type int dword_40937E;
// 409972: using guessed type int dword_409972;
// 4099CB: using guessed type int dword_4099CB;
// 409D15: using guessed type int dword_409D15;
// 40A056: using guessed type int dword_40A056;
// 40A72A: using guessed type int dword_40A72A;
// 40A75F: using guessed type int dword_40A75F;
// 40A82A: using guessed type int dword_40A82A;
// 40A8AE: using guessed type int dword_40A8AE;
// 40A923: using guessed type int dword_40A923;
// 40ABCC: using guessed type int dword_40ABCC;
// 40AD00: using guessed type int dword_40AD00;
// 40AEB1: using guessed type int dword_40AEB1;
// 40AF57: using guessed type int dword_40AF57;
// 40B13E: using guessed type int dword_40B13E;
// 40B3CC: using guessed type int dword_40B3CC;
// 40C1DA: using guessed type int dword_40C1DA;
// 40C829: using guessed type int dword_40C829;
// 40C84C: using guessed type int dword_40C84C;
// 40CB6B: using guessed type int dword_40CB6B;
// 40CBE9: using guessed type int dword_40CBE9;
// 40CCAC: using guessed type int dword_40CCAC;
// 40D004: using guessed type int dword_40D004;
// 40D3C3: using guessed type int dword_40D3C3;

//----- (00401E83) --------------------------------------------------------
HPEN __usercall sub_401E83@<eax>(int a1@<ecx>, int a2@<ebx>, int a3@<edi>)
{
  return sub_401E8C(a2, a1 + a3);
}

//----- (00401E8C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
HPEN __usercall sub_401E8C@<eax>(int a1@<ebx>, int a2@<edi>)
{
  int v3; // [esp-14h] [ebp-14h] BYREF
  int v4; // [esp-10h] [ebp-10h] BYREF
  LOGBRUSH v5; // [esp-Ch] [ebp-Ch] BYREF

  dword_409D9C = a1;
  dword_409E18 += MEMORY[0x410C65] + a2 - dword_4094A4;
  return ExtCreatePen((DWORD)&v3, (DWORD)&v4, &v5, (DWORD)&v5.lbColor, &v5.lbHatch);
}
// 401EB8: positive sp value 4 has been found
// 4094A4: using guessed type int dword_4094A4;
// 409D9C: using guessed type int dword_409D9C;
// 409E18: using guessed type int dword_409E18;

//----- (00401EB9) --------------------------------------------------------
void __usercall sub_401EB9(int a1@<ebp>, unsigned __int16 a2, int a3, unsigned int a4, int a5, int a6)
{
  int v6; // ecx
  int v7; // ebx
  unsigned int i; // eax
  unsigned int v9; // eax
  unsigned int v10; // ebp
  int v11; // esi
  int v12; // ebx
  char v13; // dl
  int v14; // ebx
  int v15; // edx
  int v16; // esi
  char v17[260]; // [esp+8h] [ebp-104h]

  v6 = a6;
  dword_40C896 += a2;
  v7 = a2 - dword_40B1EA;
  for ( i = 0; i < 0x100; ++i )
  {
    dword_40D618 -= v7;
    v17[i] = i;
    v7 += dword_40B685;
  }
  dword_40B557 = v7;
  dword_409434 += dword_40D035 + dword_40A856 + a1 - dword_40A089;
  v9 = 0;
  v10 = 0;
  v11 = dword_40B1EA + dword_409EB9;
  v12 = 0;
  while ( 1 )
  {
    dword_40BFC8 += v11;
    LOBYTE(v6) = v17[v10];
    v13 = *(_BYTE *)(a6 + v9);
    dword_40AF57 -= dword_40C84C + v11 + 1 - dword_409FCE;
    v14 = v6 + v12;
    dword_40B937 -= (char)v6;
    v15 = (unsigned __int8)(v14 + v13);
    dword_40AEC4 += v9 + dword_409538 + v14 - a4;
    ++v9;
    v12 = v15;
    v16 = (unsigned __int8)v9;
    if ( v9 >= a4 )
    {
      v16 = dword_40987D + (unsigned __int8)v9;
      v9 = 0;
    }
    dword_40A089 -= v16;
    LOBYTE(v15) = v17[v15];
    v17[v10] = v15;
    dword_40D4F8 = dword_40BE2B + (__int16)v6 - v12;
    ++v10;
    dword_40BEB1 -= dword_40BFC8 + dword_40D4F8 - v9 - dword_40C02C;
    v17[v12] = v6;
    v11 = dword_409D15;
    if ( v10 >= 0x100 )
    {
      dword_40C98F = dword_409D15 - dword_40D53F - v15 + 1;
      dword_40B65A -= MEMORY[0x410F3A] + dword_40CB6B + dword_40C98F + 1;
      dword_40B8CA += dword_40B8A6 - 1;
      dword_40A75F = dword_40B8A6 - 1;
      JUMPOUT(0x40140F);
    }
  }
}
// 401369: control flows out of bounds to 40136F
// 401409: control flows out of bounds to 40140F
// 409434: using guessed type int dword_409434;
// 409538: using guessed type int dword_409538;
// 40987D: using guessed type int dword_40987D;
// 409D15: using guessed type int dword_409D15;
// 409EB9: using guessed type int dword_409EB9;
// 409FCE: using guessed type int dword_409FCE;
// 40A089: using guessed type int dword_40A089;
// 40A6A9: using guessed type int dword_40A6A9;
// 40A75F: using guessed type int dword_40A75F;
// 40A856: using guessed type int dword_40A856;
// 40AEC4: using guessed type int dword_40AEC4;
// 40AF57: using guessed type int dword_40AF57;
// 40B1EA: using guessed type int dword_40B1EA;
// 40B557: using guessed type int dword_40B557;
// 40B65A: using guessed type int dword_40B65A;
// 40B685: using guessed type int dword_40B685;
// 40B8A6: using guessed type int dword_40B8A6;
// 40B8CA: using guessed type int dword_40B8CA;
// 40B937: using guessed type int dword_40B937;
// 40BE2B: using guessed type int dword_40BE2B;
// 40BEB1: using guessed type int dword_40BEB1;
// 40BFC8: using guessed type int dword_40BFC8;
// 40C02C: using guessed type int dword_40C02C;
// 40C84C: using guessed type int dword_40C84C;
// 40C896: using guessed type int dword_40C896;
// 40C98F: using guessed type int dword_40C98F;
// 40CB6B: using guessed type int dword_40CB6B;
// 40D035: using guessed type int dword_40D035;
// 40D4F8: using guessed type int dword_40D4F8;
// 40D53F: using guessed type int dword_40D53F;
// 40D618: using guessed type int dword_40D618;

// nfuncs=12 queued=9 decompiled=9 lumina nreq=0 worse=0 better=0
// ALL OK, 9 function(s) have been successfully decompiled
