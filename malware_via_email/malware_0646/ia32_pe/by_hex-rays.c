/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int, int, int);
// int __usercall sub_4010A7@<eax>(int result@<eax>);
// void __usercall __noreturn sub_40411F(unsigned int@<eax>, int@<ecx>);
// void __usercall __noreturn sub_404238(char@<al>, int@<edx>, int@<ebx>, int@<edi>);
// void __usercall __noreturn sub_40430E(char _SF@<sf>, char _OF@<of>, char _PF@<pf>, _DWORD *@<ecx>, int *_EBX@<ebx>);

//-------------------------------------------------------------------------
// Data declarations

// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);


//----- (00401052) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  sub_4010A7(0x10000);
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 3;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (004010A7) --------------------------------------------------------
int __usercall sub_4010A7@<eax>(int result@<eax>)
{
  int v1; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v1);
  MEMORY[0] &= result;
  return result;
}

//----- (0040411F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_40411F(unsigned int a1@<eax>, int a2@<ecx>)
{
  unsigned __int8 v2; // cf
  int v3; // eax
  int v4; // edi
  char v5; // dl
  int v6; // ecx
  unsigned int v8; // ebx
  int v9; // edi
  int v11; // eax
  int v12; // edi
  bool v13; // of
  int v14; // edi
  char v15; // al
  int v17; // edx
  int v18; // edi
  int v19; // [esp-4h] [ebp-4h]
  int savedregs; // [esp+0h] [ebp+0h]

  __asm { fsub    st(4), st }
  v2 = _bittestandreset(&a2, a1);
  __asm { fmul    st(4), st }
  if ( v2 )
    a2 = 1271590746;
  v3 = (int)(a1 << 21) >> 24;
  v4 = v19;
  v5 = 118;
  if ( (a2 & v3 & 0x80u) == 0 )
  {
    if ( (char)(a2 & v3) <= 0 )
      v4 = a2;
    a2 >>= 25;
  }
  v6 = __PAIR64__(v4, a2) >> a2;
  __asm { fadd    st(6), st }
  _ESI = v3;
  __asm
  {
    fcomp   st(2)
    fadd    st(1), st
  }
  v8 = __ROL4__(v6, 157);
  v9 = v3 + 1;
  __asm { rcr     esi, 89h }
  if ( v3 + 1 < 0 )
  {
    v11 = 1528381729;
    if ( !__CFSHL__(v6, -99) )
      v11 = 826159735;
    v12 = v11 + __CFSHL__(v6, -99) + 1549341623;
    _ESI = 13718888;
    v8 = -859663941;
    v13 = __OFADD__(__CFADD__(__CFSHL__(v6, -99), 1549341623) | __CFADD__(v11, __CFSHL__(v6, -99) + 1549341623), v12);
    v14 = (__CFADD__(__CFSHL__(v6, -99), 1549341623) | __CFADD__(v11, __CFSHL__(v6, -99) + 1549341623)) + v12;
    v13 |= __OFADD__(826159735, v14);
    v9 = v14 + 826159735;
    if ( v9 < 0 == v13 )
      v5 = -69;
  }
  __asm { fmul    st(5), st }
  v15 = v5;
  savedregs = _ESI;
  _ESI = -747096621;
  __asm
  {
    fcomp   st
    rcr     esi, 7Dh
  }
  v17 = -v9;
  _BitScanForward((unsigned int *)&v18, v8);
  sub_404238(v15, v17, ~v8, v18);
}
// 4041CD: positive sp value 8 has been found
// 404122: inconsistent fpu stack
// 40413F: variable 'v19' is possibly undefined

//----- (00404238) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_404238(char a1@<al>, int a2@<edx>, int a3@<ebx>, int a4@<edi>)
{
  bool v4; // cc
  int v5; // ebx
  int v7; // [esp-4h] [ebp-4h]

  v4 = a1 <= -12;
  if ( a1 != -12 )
  {
    __asm { fmul    st(2), st }
    v4 = (a4 ^ a2) <= 0;
    __asm { fmul    st(4), st }
  }
  if ( v4 )
  {
    __asm
    {
      fsubr   st(5), st
      fadd    st(2), st
      fadd    st(7), st
    }
    a3 = 561043324;
    __asm { fadd    st(7), st }
  }
  __asm { fcomp   st }
  v5 = a3 - 1;
  _EDI = -(v5 & 0x5D);
  __asm
  {
    fsubr   st(7), st
    rcr     edi, 0D8h
    fadd    st(6), st
    fsubr   st, st
  }
  sub_40430E(v7 + 510 < 0, __OFADD__(510, v7), __SETP__(v7 + 510, 0), (_DWORD *)(v7 + 510), (int *)(v5 + 1));
}
// 40428E: positive sp value 4 has been found
// 404246: inconsistent fpu stack
// 4042EA: variable 'v7' is possibly undefined

//----- (0040430E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_40430E(char _SF@<sf>, char _OF@<of>, char _PF@<pf>, _DWORD *a4@<ecx>, int *_EBX@<ebx>)
{
  int v5; // esi
  int v7; // edx
  int v8; // ebx
  _DWORD *v9; // eax
  int v12; // edi
  int v17; // [esp-4h] [ebp-4h] BYREF
  _DWORD *savedregs; // [esp+0h] [ebp+0h] BYREF

  v5 = -1087380119;
  if ( _PF )
  {
    __asm { fcomp   st(1) }
    v5 = (int)&savedregs;
    _OF = 0;
    _SF = 0;
    __asm { fmul    st(4), st }
  }
  if ( _SF != _OF )
    _EBX = &v17;
  __asm
  {
    rcl     ebx, 26h
    fcom    st
  }
  savedregs = (_DWORD *)v5;
  v7 = -40036;
  v8 = _EBX + 1;
  v9 = a4 + 241;
  do
  {
    _EDI = v7;
    *a4 ^= 0x7D2BF462u;
    __asm { rcr     edi, 4Eh }
    HIWORD(_ESI) = 32340;
    ++a4;
    v12 = ~(v7 - 994334813);
    LOWORD(_ESI) = v12 ^ 0x37B3;
    v8 = -(v8 + 1) - 1998838104;
    --_ESI;
    __asm { fsub    st(4), st }
    v7 = -1285742470;
    __asm { rep inc esi }
  }
  while ( (int)a4 < (int)v9 );
  if ( (char)a4 > SBYTE1(v8) )
    v8 = v12;
  savedregs = &savedregs;
  __asm { fcomp   st(5) }
  _EDI = v8 | 0xE3DF356;
  __asm { rcr     edi, 0ADh }
  __halt();
}
// 404343: positive sp value 4 has been found
// 40432C: inconsistent fpu stack
// 4043C0: conditional instruction was optimized away because edx.4==4CA2DF86
// 4043CE: conditional instruction was optimized away because ebx.4>=E3DF356u

// nfuncs=5 queued=5 decompiled=5 lumina nreq=0 worse=0 better=0
// ALL OK, 5 function(s) have been successfully decompiled
