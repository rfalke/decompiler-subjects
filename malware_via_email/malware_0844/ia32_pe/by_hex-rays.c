/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int a1, int a2, int a3);
void __fastcall sub_4010CE(int a1, int a2);
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// int __usercall sub_4040CD@<eax>(char a1@<sf>, char a2@<of>, int a3@<ebp>);
// int __usercall sub_4041E7@<eax>(char a1@<zf>, _DWORD *a2@<eax>, _DWORD *a3@<edx>, _DWORD *a4@<ecx>, int a5@<edi>);

//-------------------------------------------------------------------------
// Data declarations

int dword_401000 = 999995712; // weak


//----- (0040107D) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  HMODULE v3; // eax
  int v4; // edx
  int v5; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  v3 = GetModuleHandleA(0);
  sub_4010CE((int)v3, v4);
  v5 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 10;
  *(_DWORD *)(a3 + 176) = v5;
  return 0;
}
// 4010AC: variable 'v4' is possibly undefined

//----- (004010CE) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
void __fastcall sub_4010CE(int a1, int a2)
{
  int v2; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v2);
  dword_401000 = a2;
}
// 4010D6: write access to const memory at 401000 has been detected
// 401000: using guessed type int dword_401000;

//----- (004040CD) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4040CD@<eax>(char a1@<sf>, char a2@<of>, int a3@<ebp>)
{
  int v3; // eax
  int v4; // edx
  _DWORD *v9; // ecx
  char v10; // zf
  int v12; // [esp-4h] [ebp-4h]
  void *retaddr; // [esp+0h] [ebp+0h] BYREF

  if ( a1 != a2 )
    __asm { fcomp   st }
  __asm
  {
    fcom    st(7)
    fsub    st, st
    fcomp   st(6)
  }
  v3 = 2047953224;
  v4 = 229306331;
  _ESI = -533232255;
  if ( (int)&retaddr + 1 >= 0 )
  {
    _ESI = 229306331;
    _BitScanReverse((unsigned int *)&v4, 0xDAAEFDBu);
    v3 = -603979776;
  }
  __asm { rcr     esi, 0CAh }
  _EAX = (_DWORD *)sub_4041E7(v12 == -1472, (_DWORD *)v3, (_DWORD *)(-v4 - 1), (_DWORD *)(v12 + 507), v12 + 1472);
  *(_DWORD *)(a3 - 1038916046) = __ROR4__(*(_DWORD *)(a3 - 1038916046), 1);
  if ( a1 ^ a2 | v10 )
  {
    __asm
    {
      fcom    st(1)
      repne xadd edx, eax
    }
  }
  return sub_4041E7(_EDX == -1, _EAX, (_DWORD *)(_EDX + 1), v9, v12 + 1472);
}
// 404130: positive sp value 8 has been found
// 4040D5: inconsistent fpu stack
// 4041C1: variable 'v12' is possibly undefined
// 4041D7: variable 'a1' is possibly undefined
// 4041D7: variable 'a2' is possibly undefined
// 4041CC: variable 'v10' is possibly undefined
// 4041E3: variable '_EDX' is possibly undefined
// 4041E5: variable 'v9' is possibly undefined

//----- (004041E7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4041E7@<eax>(char a1@<zf>, _DWORD *a2@<eax>, _DWORD *a3@<edx>, _DWORD *a4@<ecx>, int a5@<edi>)
{
  _DWORD *v5; // ecx
  _DWORD *v6; // ebx
  int savedregs; // [esp+0h] [ebp+0h]

  if ( !a1 )
    a2 = a3;
  *a4 += 45634877;
  v5 = a4 + 1;
  v6 = (_DWORD *)(__ROL4__(savedregs + 1, 178) + 1);
  if ( (int)v5 < a5 )
    JUMPOUT(0x4041C7);
  if ( (int)v5 <= a5 )
    v6 = a2;
  *v6 &= 0xB8771D9B;
  return 1321693740;
}
// 4041EC: positive sp value 4 has been found
// 404237: control flows out of bounds to 4041C7
// 40422E: variable 'savedregs' is possibly undefined

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
