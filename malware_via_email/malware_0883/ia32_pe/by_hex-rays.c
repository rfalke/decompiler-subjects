/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __cdecl start(int a1, int a2, int a3, char a4);
// int __usercall sub_4010CC@<eax>(int a1@<ecx>, int a2@<ebx>, int a3@<ebp>, int a4@<edi>, int a5@<esi>);
void __cdecl sub_401696(int a1);


//----- (00401005) --------------------------------------------------------
void __cdecl start(int a1, int a2, int a3, char a4)
{
  JUMPOUT(0x4012C9);
}
// 40103F: control flows out of bounds to 4012C9

//----- (004010CC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4010CC@<eax>(int a1@<ecx>, int a2@<ebx>, int a3@<ebp>, int a4@<edi>, int a5@<esi>)
{
  __int64 v5; // rax
  int v6; // ebp
  int v7; // eax
  int v8; // ecx
  int v9; // eax
  unsigned int v10; // eax
  unsigned int i; // eax
  int v12; // edi
  int v13; // eax
  unsigned __int16 v14; // cx
  unsigned int v15; // edi
  unsigned int v16; // eax
  int v17; // esi
  int v18; // ebp
  int v19; // ebx
  int v20; // edx
  int v21; // eax
  int v22; // ebp
  int j; // edi
  unsigned __int8 v24; // cl
  int v25; // esi
  int v26; // ebx
  char v27; // dl
  _DWORD v29[2]; // [esp-Ah] [ebp-152h]
  int v30; // [esp-2h] [ebp-14Ah]
  int v31; // [esp+2h] [ebp-146h]
  int v32; // [esp+6h] [ebp-142h]
  _BYTE v33[2]; // [esp+Ah] [ebp-13Eh] BYREF
  int v34; // [esp+FEh] [ebp-4Ah]
  int v35; // [esp+102h] [ebp-46h]
  int *v36; // [esp+106h] [ebp-42h]
  int v37; // [esp+10Ah] [ebp-3Eh] BYREF
  int v38; // [esp+10Eh] [ebp-3Ah]
  int v39; // [esp+112h] [ebp-36h]
  int v40; // [esp+116h] [ebp-32h] BYREF
  int v41; // [esp+11Ah] [ebp-2Eh]
  int v42; // [esp+11Eh] [ebp-2Ah]
  int v43; // [esp+122h] [ebp-26h]
  int *v44; // [esp+126h] [ebp-22h]
  int v45; // [esp+12Ah] [ebp-1Eh]
  int v46; // [esp+12Eh] [ebp-1Ah]
  int v47; // [esp+132h] [ebp-16h]
  int v48; // [esp+136h] [ebp-12h]
  __int64 v49; // [esp+13Ah] [ebp-Eh]
  void *retaddr; // [esp+148h] [ebp+0h]

  LODWORD(v49) = a3;
  LOWORD(v5) = 0;
  WORD1(v5) = HIWORD(v49);
  LOWORD(a1) = *(_WORD *)v5;
  LOWORD(v5) = 0;
  HIDWORD(v5) = v5 + 24624;
  LODWORD(v5) = v5 + 27768;
  v49 = v5;
  v48 = HIDWORD(v5);
  v47 = a5;
  v46 = a2;
  v45 = a4;
  v44 = 0;
  v43 = 0;
  v42 = 16711681;
  v41 = a4 - (a1 + 42418) + 2;
  v40 = 16711686;
  v6 = a3 + 1;
  sub_401696((int)&v40);
  v44 = &v40;
  v43 = v7;
  v42 = v7;
  v41 = v7;
  (*(void (**)(void))(a2 + 24))();
  v40 = (*(int (**)(void))(a2 + 28))() + 6;
  v39 = v40;
  HIWORD(retaddr) = a2;
  v38 = (*(int (**)(void))a2)();
  v37 = v8;
  v36 = &v37;
  v35 = 64;
  v45 = 0;
  v9 = (*(int (__cdecl **)(int, int *, int))(a2 - 4 + 16))(-1, v44, v47);
  v10 = __readfsdword(v9 + 47) + v9;
  v44 = (int *)((char *)v44 + *(_DWORD *)(v10 + 3));
  v47 ^= *(_DWORD *)(v10 + 3);
  v31 = v39;
  v32 = v43;
  v30 = v34;
  for ( i = 0; i < 0x100; ++i )
    v33[i] = i;
  v12 = v30;
  if ( (_BYTE)v49 != 121 )
  {
    v12 = v48;
    do
    {
      (*(void (**)(void))(v12 + 24))();
      __debugbreak();
      (*(void (**)(void))(v12 + 24))();
      (*(void (**)(void))(v12 + 24))();
      (*(void (**)(void))(v12 + 24))();
      (*(void (**)(void))(v12 + 24))();
      (*(void (**)(void))(v12 + 24))();
      v13 = (*(int (**)(void))(v12 + 16))() + 1;
    }
    while ( (unsigned __int16)v13 < v14 );
  }
  v30 = v6;
  v29[1] = &v37;
  v29[0] = v12;
  v15 = v41;
  v16 = 0;
  v17 = 0;
  v18 = 0;
  do
  {
    v19 = (unsigned __int8)v33[v18];
    v20 = v17 + v19 + *(unsigned __int8 *)(v32 + v16);
    BYTE1(v20) = 0;
    ++v16;
    v17 = v20;
    if ( v16 >= v15 )
      v16 = 0;
    v33[v18++] = v33[v20];
    BYTE1(v19) = v33[v20 + 1];
    *(_WORD *)&v33[v20] = v19;
  }
  while ( BYTE1(v18) != 1 );
  v25 = 0;
  v21 = 0;
  v22 = v42;
  for ( j = v31; v22; --v22 )
  {
    ++v21;
    BYTE1(v21) = 0;
    v24 = v33[v21];
    v26 = v25 + v24;
    BYTE1(v26) = 0;
    v27 = *((_BYTE *)&v29[5] + v26);
    v33[v21] = v27;
    *((_BYTE *)&v29[5] + v26) = v24;
    v25 = v26;
    *(_WORD *)(j++ - 1) ^= *(_WORD *)((char *)&v29[5] + (unsigned __int8)(v24 + v27)) << 8;
  }
  return v38;
}
// 401775: positive sp value A has been found
// 4010CC: could not find valid save-restore pair for esi
// 40121B: variable 'v7' is possibly undefined
// 4012A4: variable 'v8' is possibly undefined
// 401434: variable 'v14' is possibly undefined

//----- (00401696) --------------------------------------------------------
void __cdecl sub_401696(int a1)
{
  JUMPOUT(0x4015DA);
}
// 4016B6: control flows out of bounds to 4015DA

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
