// subject_rsec.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw409078 = 37037; // 00409078
word32 g_dw40907C = 0x90BF; // 0040907C
word32 g_dw409080 = 37070; // 00409080
word32 g_dw409084 = 0x90E1; // 00409084
word32 g_dw409088 = 0x90F3; // 00409088
word32 g_dw40908C = 0x9106; // 0040908C
word32 g_dw409094 = 0x9121; // 00409094
word32 g_dw409098 = 0x9131; // 00409098
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401005: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	word32 ebp;
	word32 dwLoc2C;
	word32 ebp_108;
	fn004010CC(ebp, (word16) dwLoc2C, out ebp_108);
	word32 ebp_120;
	return fn004010CC(ebp_108, 0x00, out ebp_120);
}

// 004010CC: Register word32 fn004010CC(Register word32 ebp, Stack word16 wArg00, Register out ptr32 ebpOut)
// Called from:
//      Win32CrtStartup
word32 fn004010CC(word32 ebp, word16 wArg00, ptr32 & ebpOut)
{
	ptr32 fp;
	struct Eq_21 * fs;
	word32 dwArg00;
	word32 dwLoc30;
	ptr32 dwLoc0138;
	word16 eax_16_16_22 = SLICE(dwArg00, word16, 16);
	word32 eax_37 = SEQ(eax_16_16_22, 0x00);
	struct Eq_30 * ebx_113;
	word32 ecx_114;
	word32 eax_112 = fn00401696((word16) dwLoc30, out ecx_114, out ebx_113);
	word16 ecx_16_16_133 = SLICE(ecx_114, word16, 16);
	word32 eax_135;
	word32 ecx_137;
	ebx_113->ptr0018();
	struct Eq_49 * esp_142;
	<unknown> Eq_21::* eax_143;
	word32 ecx_145;
	ebx_113->ptr001C();
	word16 ecx_16_16_164 = SLICE(ecx_145, word16, 16);
	uint32 esi_156 = (uint32) ((&(fs->*((char *) eax_143 + 4)))[(char *) eax_143 + 6].w0000 + 0x02);
	esp_142->ptrFFFFFFFC = (<unknown> Eq_21::*) ((char *) eax_143 + 6);
	esp_142->ptrFFFFFFF8 = (<unknown> Eq_21::*) ((char *) eax_143 + 6);
	struct Eq_77 * esp_165;
	struct Eq_30 * eax_166;
	word32 ecx_168;
	ebx_113->ptr0000();
	esp_165->ptr0038 = ebx_113;
	esp_165->dw003C = esi_156 - 0x01;
	esp_165->ptrFFFFFFFC = ebx_113;
	word16 ecx_16_16_210 = SLICE(ecx_168, word16, 16);
	esp_165->ptrFFFFFFFC -= 0x04;
	struct Eq_30 * edi_183 = esp_165->ptrFFFFFFFC;
	esp_165->ptrFFFFFFFC = eax_166;
	esp_165->dwFFFFFFF8 = ecx_168;
	esp_165->ptrFFFFFFF4 = esp_165 - 8;
	esp_165->dwFFFFFFF0 = 0x40;
	esp_165->dwFFFFFFEC = esp_165->dw0020;
	esp_165->dwFFFFFFE8 = esp_165->dw0014;
	esp_165->dw0018 = 0x00;
	esp_165->dwFFFFFFE4 = ~0x00;
	struct Eq_143 * esp_211;
	struct Eq_144 Eq_21::* eax_212;
	edi_183->ptr0010();
	struct Eq_148 * eax_218 = eax_212 + (fs->*eax_212).dw002F / 0x0033;
	esp_211->dw0030 += eax_218->dw0003;
	esp_211->ptrFFFFFFFC = eax_218;
	esp_211->ptr0000 = esp_211->ptrFFFFFFFC;
	esp_211->ptr0004 = esp_211->ptr0000;
	struct Eq_148 * edi_244 = esp_211->ptr0008;
	esp_211->ptr0008 = esp_211->ptr0004;
	struct Eq_148 * ebx_251 = esp_211->ptr000C;
	esp_211->ptr000C = esp_211->ptr0008;
	struct Eq_148 * eax_256 = esp_211->ptr000C;
	struct Eq_148 * esi_258 = esp_211->ptr0010;
	esp_211->ptr0010 = (struct Eq_148 *) &eax_256->dw0003;
	struct Eq_148 * eax_265 = esp_211->ptr0010;
	word32 ecx_267 = eax_265->t0000;
	esp_211->ptr0010 = eax_265;
	struct Eq_148 * eax_271 = esp_211->ptr0010;
	esp_211->dw003C = esp_211->dw003C ^ ecx_267;
	esp_211->ptr0010 = eax_271;
	esp_211->ptr0010 = esp_211->ptr001C;
	word32 ecx_289 = esp_211->dw002C;
	struct Eq_148 * eax_287 = esp_211->ptr0010;
	word16 ecx_16_16_369 = SLICE(ecx_289, word16, 16);
	esp_211->ptrFFFFFF0C = eax_287;
	esp_211->ptrFFFFFF08 = eax_287;
	struct Eq_148 * eax_296 = esp_211->ptrFFFFFF08;
	esp_211->dwFFFFFF10 = ecx_289;
	esp_211->ptrFFFFFF08 = eax_296;
	esp_211->ptrFFFFFF08 = edi_244;
	struct Eq_148 * eax_306 = null;
	do
	{
		esp_211->ptrFFFFFF04 = eax_306;
		struct Eq_148 * eax_316 = esp_211->ptrFFFFFF04;
		eax_306[(esp_211 - 0xEC) / 304] = (struct Eq_148) (byte) eax_316;
		esp_211->ptrFFFFFF04 = eax_316;
		esp_211->ptrFFFFFF04 = (struct Eq_148 *) &esp_211->ptrFFFFFF04->a0001->u0;
		struct Eq_148 * eax_330 = esp_211->ptrFFFFFF04;
		esp_211->ptrFFFFFF04 = eax_330;
		eax_306 = esp_211->ptrFFFFFF04;
	} while (eax_330 < (struct Eq_148 *) 0x0100);
	esp_211->ptrFFFFFF04 = eax_306;
	struct Eq_148 * edi_344 = esp_211->ptrFFFFFF08;
	esp_211->ptrFFFFFF08 = esp_211->ptrFFFFFF04;
	esp_211->ptrFFFFFF08 = (struct Eq_148 *) (&esp_211->dw003C + 2);
	struct Eq_148 * eax_355 = esp_211->ptrFFFFFF08;
	esp_211->ptrFFFFFF08 = eax_355;
	struct Eq_148 * eax_361 = esp_211->ptrFFFFFF08;
	struct Eq_332 * esp_362 = esp_211 - 244;
	if (eax_355->t0000 != 121)
	{
		edi_344 = eax_361->ptrFFFFFFFC;
		do
		{
			struct Eq_371 * esp_375;
			word32 eax_376;
			word32 ecx_378;
			edi_344->a0018[0].u2();
			esp_375->dwFFFFFFFC = eax_376;
			word32 eax_384 = esp_375->dwFFFFFFFC;
			int3();
			word16 ecx_16_16_395 = SLICE(ecx_378, word16, 16);
			esp_375->dwFFFFFFFC = eax_384 + 0x02;
			struct Eq_435 * esp_396;
			word32 eax_397;
			word32 ecx_399;
			edi_344->a0018[0].u2();
			esp_396->dwFFFFFFFC = eax_397;
			struct Eq_444 * esp_408;
			word32 eax_409;
			word32 ecx_411;
			edi_344->a0018[0].u2();
			esp_408->dwFFFFFFFC = eax_409;
			struct Eq_453 * esp_420;
			word32 eax_421;
			word32 ecx_423;
			edi_344->a0018[0].u2();
			esp_420->dwFFFFFFFC = eax_421;
			struct Eq_462 * esp_432;
			word32 eax_433;
			word32 ecx_435;
			edi_344->a0018[0].u2();
			esp_432->dwFFFFFFFC = eax_433;
			word32 eax_445;
			word32 ecx_447;
			edi_344->a0018[0].u2();
			word16 ecx_16_16_450 = SLICE(ecx_447, word16, 16);
			struct Eq_332 * esp_451;
			word32 eax_452;
			word32 ecx_454;
			edi_344->ptr0010();
			word16 cx_466 = (word16) ecx_454;
			ecx_16_16_369 = SLICE(ecx_454, word16, 16);
			esp_451->ptrFFFFFFFC = eax_452 + 0x01;
			struct Eq_148 * eax_463 = esp_451->ptrFFFFFFFC;
			cup16 ax_467 = (word16) eax_463 - cx_466;
			esp_451->ptrFFFFFFFC = SEQ(SLICE(eax_463, word16, 16), ax_467);
			eax_361 = esp_451->ptrFFFFFFFC;
			esp_362 = esp_451;
		} while (ax_467 < 0x00);
	}
	struct Eq_343 * esp_480 = esp_362 - 4;
	esp_480->dw0000 = ebp + 0x01;
	esp_480->ptrFFFFFFFC = eax_361;
	struct Eq_148 * eax_487 = esp_480->ptrFFFFFFFC;
	esp_480->ptrFFFFFFFC = esi_258;
	esp_480->ptrFFFFFFF8 = eax_487;
	struct Eq_148 * eax_496 = esp_480->ptrFFFFFFF8;
	esp_480->ptrFFFFFFF8 = edi_344;
	struct Eq_148 * edi_502 = esp_480->ptr011C;
	esp_480->ptrFFFFFFF4 = eax_496;
	esp_480->ptrFFFFFFF4 = null;
	struct Eq_148 * eax_512 = esp_480->ptrFFFFFFF4;
	esp_480->ptrFFFFFFF4 = eax_512;
	esp_480->ptrFFFFFFF4 = esp_480->ptrFFFFFFF4;
	struct Eq_148 * eax_527 = esp_480->ptrFFFFFFF4;
	esp_480->ptrFFFFFFF4 = ebx_251;
	esp_480->ptrFFFFFFF0 = eax_527;
	struct Eq_148 * esi_514 = eax_512;
	struct Eq_424 * ebp_520 = null;
	struct Eq_148 * eax_536 = esp_480->ptrFFFFFFF0;
	do
	{
		struct Eq_479 * esp_538 = esp_362 - 16;
		word32 ebx_541 = CONVERT(Mem540[esp_538 + 24 + ebp_520:byte], byte, word32);
		byte bl_622 = (byte) ebx_541;
		ptr32 edx_542 = esp_538->ptr0014;
		word32 edx_544 = (word32) eax_536[edx_542 / 304];
		word32 ecx_547 = esi_514 + ebx_541 / 304;
		esp_538->ptrFFFFFFFC = eax_536;
		esp_538->ptrFFFFFFFC = esp_538->ptrFFFFFFFC;
		esp_538->ptrFFFFFFFC = (struct Eq_148 *) &esp_538->ptrFFFFFFFC->a0001->u0;
		word32 edx_549 = edx_544 + ecx_547;
		esp_538->ptrFFFFFFFC = esp_538->ptrFFFFFFFC;
		struct Eq_148 * eax_574 = esp_538->ptrFFFFFFFC;
		esp_538->ptrFFFFFFFC = eax_574;
		struct Eq_148 * edx_569 = SEQ(SLICE(edx_549, word16, 16), 0x00, (byte) edx_549);
		esi_514 = edx_569;
		struct Eq_148 * eax_581 = esp_538->ptrFFFFFFFC;
		if (eax_574 >= edi_502)
		{
			esp_538->ptrFFFFFFFC = eax_581;
			esp_538->ptrFFFFFFFC = null;
			eax_581 = esp_538->ptrFFFFFFFC;
		}
		byte dl_601 = Mem600[esp_538 + 24 + edx_569:byte];
		esp_538->ptrFFFFFFFC = eax_581;
		struct Eq_148 * eax_606 = esp_538->ptrFFFFFFFC;
		Mem609[esp_538 + 24 + ebp_520:byte] = dl_601;
		ebp_520 = (struct Eq_424 *) &ebp_520->a0001->u0;
		esp_538->ptrFFFFFFFC = eax_606;
		struct Eq_148 * eax_616 = esp_538->ptrFFFFFFFC;
		word32 edx_618 = esp_538 + 24 + edx_569 - eax_616;
		word16 bx_623 = SEQ(Mem614[eax_616 + 1 + edx_618:byte], bl_622);
		Mem624[eax_616 + edx_618:word16] = bx_623;
		esp_538->ptrFFFFFFFC = eax_616;
		esp_538->ptrFFFFFFFC = esp_538->ptrFFFFFFFC;
		esp_538->ptrFFFFFFFC = esp_538->ptrFFFFFFFC;
		eax_536 = esp_538->ptrFFFFFFFC;
	} while (SLICE(ebp_520, byte, 8) != 0x01);
	word32 esi_646 = 0x00;
	esp_538->a0000[0].u2 = (<anonymous> *) 0x00;
	up32 ebp_661 = esp_538->dw012C;
	esp_538->a0000[0].u2 = esp_538->a0000[0].u2;
	struct Eq_488 * edi_667 = esp_538->ptr0010;
	esp_538->a0000[0].u2 = esp_538->a0000[0].u2;
	esp_538->a0000[0].u2 = esp_538->a0000[0].u2;
	esp_538->a0000[0].u2 = esp_538->a0000[0].u2;
	Eq_376 eax_685 = esp_538->a0000[0].u2;
	if (ebp_661 > 0x00)
	{
		esp_538->a0000[0].u2 = (<anonymous> *) eax_685;
		Eq_376 eax_692 = esp_538->a0000[0].u2;
		do
		{
			struct Eq_693 * esp_696 = esp_362 - 0x0C;
			esp_696->tFFFFFFFC.u2 = (<anonymous> *) ((char *) eax_692.u2 + 1);
			Eq_376 eax_700 = esp_696->tFFFFFFFC.u2;
			esp_696->tFFFFFFFC.u2 = (<anonymous> *) SEQ(SLICE(eax_700, word16, 16), 0x00, (byte) eax_700);
			Eq_376 eax_710 = esp_696->tFFFFFFFC.u2;
			byte cl_712 = Mem708[esp_696 + 20 + eax_710:byte];
			esp_696->tFFFFFFFC.u2 = (<anonymous> *) eax_710;
			esp_696->tFFFFFFFC.u2 = esp_696->tFFFFFFFC.u2;
			esp_696->tFFFFFFFC.u2 = esp_696->tFFFFFFFC.u2;
			esp_696->tFFFFFFFC.u2 = esp_696->tFFFFFFFC.u2;
			uint32 ebx_726 = (uint32) cl_712 + esi_646;
			word32 ebx_743 = SEQ(SLICE(ebx_726, word16, 16), 0x00, (byte) ebx_726);
			byte dl_750 = esp_696[ebx_743 + 20];
			esp_696->tFFFFFFFC.u2 = esp_696->tFFFFFFFC.u2;
			Eq_376 eax_754 = esp_696->tFFFFFFFC.u2;
			Mem756[esp_696 + 20 + eax_754:byte] = dl_750;
			esp_696->tFFFFFFFC.u2 = (<anonymous> *) eax_754;
			Eq_376 eax_760 = esp_696->tFFFFFFFC.u2;
			esp_696->tFFFFFFFC.u2 = (<anonymous> *) eax_760;
			esp_696->tFFFFFFF8.u2 = (<anonymous> *) eax_760;
			esp_696->tFFFFFFF8.u2 = (<anonymous> *) (esp_696 + (ebx_743 + 20));
			*esp_696->tFFFFFFF8.u2 = (<anonymous> *) cl_712;
			Eq_376 eax_776 = esp_696->tFFFFFFFC.u2;
			esp_696->tFFFFFFFC.u2 = (<anonymous> *) eax_776;
			esp_696->tFFFFFFFC.u2 = esp_696->tFFFFFFFC.u2;
			esp_696->tFFFFFFFC.u2 = esp_696->tFFFFFFFC.u2;
			word32 edx_778 = (word32) dl_750;
			word32 ecx_799 = esp_696[SEQ(SLICE(edx_778, word24, 8), (byte) edx_778 + cl_712) + 0x14];
			esp_696->tFFFFFFFC.u2 = esp_696->tFFFFFFFC.u2;
			esp_696->tFFFFFFFC.u2 = esp_696->tFFFFFFFC.u2;
			esp_696->tFFFFFFFC.u2 = esp_696->tFFFFFFFC.u2;
			Eq_376 eax_815 = esp_696->tFFFFFFFC.u2;
			edi_667->wFFFFFFFF = edi_667->wFFFFFFFF ^ (word16) ecx_799 << 0x08;
			esp_696->tFFFFFFFC.u2 = (<anonymous> *) eax_815;
			esp_696->tFFFFFFFC.u2 = esp_696->tFFFFFFFC.u2;
			esi_646 = ebx_743;
			++edi_667;
			eax_692.u2 = esp_696->tFFFFFFFC.u2;
			--ebp_661;
		} while (ebp_661 != 0x00);
	}
	ebpOut = dwLoc0138;
	return 0x00FF0006;
}

// 00401696: Register ptr32 fn00401696(Stack word16 wArg00, Register out Eq_36 ecxOut, Register out ptr32 ebxOut)
// Called from:
//      fn004010CC
ptr32 fn00401696(word16 wArg00, union Eq_36 & ecxOut, ptr32 & ebxOut)
{
	word32 dwArg00;
	word32 eax_152 = dwArg00;
	while (true)
	{
		word16 eax_16_16_39 = SLICE(eax_152, word16, 16);
		word16 * eax_40 = SEQ(eax_16_16_39, 0x00);
		word16 ax_42 = *eax_40;
		word32 eax_54 = SEQ(eax_16_16_39, ax_42 + 42421);
		if (ax_42 == 23117)
			break;
		eax_152 = eax_54 - 0x00010000;
	}
	struct Eq_890 * eax_67;
	__btr<word32>(eax_54, 0x01, out eax_67);
	Eq_36 ecx_114 = eax_67[(&(eax_67 + eax_67->dw003C / 64)->dw003C)[0x0011] / 64];
	word32 eax_120 = eax_67 + ecx_114;
	ecxOut = ecx_114;
	ebxOut = eax_120 + 0x04;
	return eax_120 + 0x04;
}

