/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall start@<eax>(int@<edi>, int@<esi>);
// BOOL __usercall sub_401160@<eax>(void *@<eax>);
int __stdcall sub_401180(int);
// void __usercall sub_4011B0(int@<ecx>, int@<edi>);
// int __usercall sub_4011C0@<eax>(int@<ecx>, int@<edi>);
// int __usercall sub_4011E0@<eax>(int@<eax>, int@<ecx>);
int __stdcall sub_401260(int);
// int __usercall sub_401280@<eax>(int@<ebx>);

//-------------------------------------------------------------------------
// Data declarations

// extern BOOL (__stdcall *GetMailslotInfo)(HANDLE hMailslot, LPDWORD lpMaxMessageSize, LPDWORD lpNextSize, LPDWORD lpMessageCount, LPDWORD lpReadTimeout);


//----- (00401030) --------------------------------------------------------
int __usercall start@<eax>(int a1@<edi>, int a2@<esi>)
{
  int v2; // ecx
  unsigned int v3; // edx
  int v4; // eax
  _DWORD *v5; // ecx
  int v6; // ecx
  char v8[163002]; // [esp+0h] [ebp-27D26h] BYREF
  int v9; // [esp+27CBAh] [ebp-6Ch]
  int v10; // [esp+27CBEh] [ebp-68h]
  int v11; // [esp+27CC2h] [ebp-64h]
  int *v12; // [esp+27CC6h] [ebp-60h]
  int v13; // [esp+27CCAh] [ebp-5Ch]
  int v14; // [esp+27CCEh] [ebp-58h]
  int v15; // [esp+27CD2h] [ebp-54h]
  int v16; // [esp+27CD6h] [ebp-50h]
  int v17; // [esp+27CDAh] [ebp-4Ch]
  int v18; // [esp+27CDEh] [ebp-48h]
  int v19; // [esp+27CE2h] [ebp-44h]
  int v20; // [esp+27CE6h] [ebp-40h]
  int v21; // [esp+27CEAh] [ebp-3Ch]
  int v22; // [esp+27CEEh] [ebp-38h]
  int v23; // [esp+27CF2h] [ebp-34h]
  int v24; // [esp+27CF6h] [ebp-30h]
  int v25; // [esp+27CFAh] [ebp-2Ch]
  int v26; // [esp+27CFEh] [ebp-28h]
  int v27; // [esp+27D02h] [ebp-24h]
  int v28; // [esp+27D06h] [ebp-20h]
  int v29; // [esp+27D0Ah] [ebp-1Ch]
  int v30; // [esp+27D0Eh] [ebp-18h]
  int v31; // [esp+27D12h] [ebp-14h]
  int v32; // [esp+27D16h] [ebp-10h]
  int v33; // [esp+27D1Ah] [ebp-Ch]
  int v34; // [esp+27D1Eh] [ebp-8h]
  int v35; // [esp+27D22h] [ebp-4h] BYREF
  int savedregs; // [esp+27D26h] [ebp+0h]

  sub_401160(0);
  sub_401180(v2);
  *(unsigned int *)((char *)&STACK[0x4F9E4] - v3 + 48) = v3;
  v4 = (41683456 - (v3 << 8)) & ((v3 << 8) - 37550544);
  v5 = (_DWORD *)((v3 << 10) + v4 - 166987700);
  *(_DWORD *)&v8[v29 + 12] = *v5 - 40;
  v31 = *(v5 - 1) + v4 + 163122 - v29;
  sub_401280(*(_DWORD *)&v8[v29]);
  v12 = &v35;
  v11 = 4;
  v10 = v6;
  v9 = a2;
  sub_4011B0(*(_DWORD *)&v8[v29], a1);
  ((void (__stdcall *)(int, int, int, int, int, int, int *, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int))(v29 + 4035574))(
    v31,
    v32,
    v29,
    v9,
    v10,
    v11,
    v12,
    v13,
    v14,
    v15,
    v16,
    v17,
    v18,
    v19,
    v20,
    v21,
    v22,
    v23,
    v24,
    v25,
    v26,
    v27,
    v28,
    v29,
    v30,
    v31,
    v32,
    v33,
    v34,
    v35,
    savedregs);
  return ((int (__stdcall *)(int, _DWORD))(v31 + 163130 - v29))(v31 + 163130 - v29 + 3018, 0);
}
// 401047: variable 'v2' is possibly undefined
// 401054: variable 'v3' is possibly undefined
// 4010B2: variable 'v6' is possibly undefined

//----- (00401160) --------------------------------------------------------
BOOL __usercall sub_401160@<eax>(void *a1@<eax>)
{
  return GetMailslotInfo(a1, 0, (LPDWORD)a1, (LPDWORD)a1, (LPDWORD)a1);
}

//----- (00401180) --------------------------------------------------------
int __stdcall sub_401180(int a1)
{
  return sub_401260(23);
}

//----- (004011B0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4011B0(int a1@<ecx>, int a2@<edi>)
{
  int v2; // eax
  int v3; // ecx
  void (*v4)(void); // eax

  v2 = sub_4011C0(a1, a2);
  v4 = (void (*)(void))sub_4011E0(v2, v3);
  v4();
  __asm { retn }
}
// 4011BC: positive sp value 4 has been found
// 4011BF: unbalanced stack, ignored a potential tail call
// 4011B6: variable 'v3' is possibly undefined

//----- (004011C0) --------------------------------------------------------
int __usercall sub_4011C0@<eax>(int a1@<ecx>, int a2@<edi>)
{
  return *(_DWORD *)(**(_DWORD **)(*(_DWORD *)(*(_DWORD *)(a2 + 48 + a1) + 12) + 28) + 8);
}

//----- (004011E0) --------------------------------------------------------
int __usercall sub_4011E0@<eax>(int a1@<eax>, int a2@<ecx>)
{
  int v2; // esi
  int v3; // edi
  int i; // [esp+0h] [ebp-8h]
  int v6; // [esp+4h] [ebp-4h]

  v2 = a1 + *(_DWORD *)(a1 + *(_DWORD *)(a1 + *(_DWORD *)(a1 + 2 * a2 - 163022 - a2) + 120) + 32);
  v3 = a1 + *(_DWORD *)(a1 + *(_DWORD *)(a1 + *(_DWORD *)(a1 + 2 * a2 - 163022 - a2) + 120) + 28);
  *(unsigned int *)((char *)&STACK[0x27D0E] - a2) = 1443033453 - a2;
  for ( i = 0; v6 != *(_DWORD *)(a2 + a1 + *(_DWORD *)(v2 + i) - 163070); i += 4 )
    ;
  return a1 + *(_DWORD *)(i + v3);
}
// 401243: variable 'v6' is possibly undefined

//----- (00401260) --------------------------------------------------------
int __stdcall sub_401260(int a1)
{
  return -2;
}

//----- (00401280) --------------------------------------------------------
int __usercall sub_401280@<eax>(int a1@<ebx>)
{
  return 20874556 - (a1 << 7);
}

// nfuncs=8 queued=8 decompiled=8 lumina nreq=0 worse=0 better=0
// ALL OK, 8 function(s) have been successfully decompiled
