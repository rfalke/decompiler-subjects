// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401028: void fn00401028(Register word16 dx, Register word32 ebp, Register word32 esi, Register word32 edi, Register (ptr Eq_6) es)
void fn00401028(word16 dx, word32 ebp, word32 esi, word32 edi, Eq_6 * es)
{
l0040102A:
	byte al_28 = __inb(dx_85);
l0040102B:
	word32 esp_30;
	word32 ebx_32;
	byte SCZO_33;
	byte SZO_35;
	byte C_36;
	byte Z_37;
	word32 edi_38;
	byte CZ_39;
	byte al_40;
	struct Eq_73 * es_41;
	word32 eax_42;
	word16 dx_43;
	ptr32 ebp_31;
	Eq_7 esi_34;
	fnBC438550();
	do
	{
		*(ebp_31 - 0x15) = *(ebp_31 - 0x15) & esi_34;
		struct Eq_57 ** esp_51;
		word32 ebx_53;
		byte SCZO_54;
		Eq_7 esi_55;
		byte SZO_56;
		byte C_57;
		bool Z_58;
		cu8 * edi_59;
		byte CZ_60;
		byte al_61;
		struct Eq_53 * es_62;
		word32 eax_63;
		fn662B8558();
		struct Eq_57 * esp_65 = *esp_51;
		if (Z_58)
			goto l0040102B;
		esi_34 = esi_55;
		word16 dx_85 = dx;
		if (*(esi_55 - 0x01) >= *edi_59)
			goto l0040102A;
	} while (*(esi_55 - 0x01) > *edi_59);
	esp_65->ptr0006 = es_62;
}

// 00410A65: Register Eq_78 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetCommandLineA();
	GetOEMCP();
	GetACP();
	Eq_88 eax_14 = GetModuleHandleA(0x00433E06);
	SizeofResource(0x00, dwLoc20);
	GetACP();
	GetFileType(dwLoc20);
	Eq_107 eax_33 = GetProcAddress(dwLoc20, eax_14);
	GetVersion();
	GetACP();
	GetCurrentProcessId();
	GetCommandLineW();
	GetVersion();
	Eq_126 eax_49 = eax_33();
	ptr32 esp_113 = fp - 0x68;
	do
	{
		struct Eq_132 * esp_69 = esp_113 - 0x04;
		esp_69->t0000 = 0x40000000;
		*(esp_69 - 0x04) = 0x00433E34;
		<anonymous> * eax_77 = (eax_49 ^ 0xC0000005) + 0x00410B3F;
		ptr32 esp_79;
		word32 ebp_80;
		byte SCZO_81;
		word32 eax_82;
		byte SZO_83;
		byte C_84;
		byte Z_85;
		word16 dx_86;
		word32 esi_87;
		word32 edi_88;
		struct Eq_160 * es_89;
		eax_77();
		Eq_88 eax_73 = CreateFileA(*(esp_69 - 0x04), esp_69->t0000, esp_69->t0004, esp_69->t0008, esp_69->t000C, esp_69->t0010, esp_69->t0014);
		*(esp_79 - 0x04) = (FARPROC *) eax_33;
		GetFileType(*(esp_79 - 0x04));
		GetProcessHeap();
		GetCommandLineA();
		GetProcessHeap();
		*(esp_79 - 0x08) = fp - 0x08;
		*(esp_79 - 0x0C) = 0x00;
		*(esp_79 - 0x10) = 0x86;
		*(esp_79 - 0x14) = 0x03;
		*(esp_79 - 0x18) = 0x00;
		*(esp_79 - 0x1C) = 0x01;
		*(esp_79 - 0x20) = 0x80000000;
		*(esp_79 - 0x24) = 4406800;
		esp_113 = esp_79 - 0x24;
	} while (CreateFileA(*(esp_79 - 0x24), *(esp_79 - 0x20), *(esp_79 - 0x1C), *(esp_79 - 0x18), *(esp_79 - 0x14), *(esp_79 - 0x10), *(esp_79 - 0x0C)) != ~0x00);
	*(esp_79 - 0x28) = 0x40;
	GetVersion();
	GetCommandLineW();
	*(esp_79 - 44) = 63277;
	GetOEMCP();
	*(esp_79 - 0x30) = 0x00401000;
	GetCurrentProcessId();
	VirtualProtect(*(esp_79 - 0x30), *(esp_79 - 44), *(esp_79 - 0x28), *(esp_79 - 0x24));
	GetACP();
	*(esp_79 - 0x34) = (union Eq_126 *) eax_49;
	GetACP();
	*(esp_79 - 0x38) = 63277;
	*(esp_79 - 0x3C) = (union Eq_88 *) eax_73;
	GetFileType(*(esp_79 - 0x3C));
	GetCommandLineW();
	*(esp_79 - 0x40) = 0x00401000;
	GetACP();
	word32 esp_150;
	word32 ebp_151;
	byte SCZO_152;
	word32 eax_153;
	byte SZO_154;
	byte C_155;
	byte Z_156;
	word16 dx_157;
	word32 esi_158;
	word32 edi_159;
	struct Eq_6 * es_160;
	(eax_49 - ~0x40410A14)();
	Eq_78 eax_161 = GetVersion();
	fn00401028(dx_157, ebp_151, esi_158, edi_159, es_160);
	return eax_161;
}

