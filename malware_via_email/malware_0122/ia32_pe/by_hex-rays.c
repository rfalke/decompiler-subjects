/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

_DWORD __cdecl start(_DWORD, _DWORD); // weak
int __cdecl sub_403350(int, int, unsigned __int8 *);
int __cdecl sub_403420(int, unsigned __int8 *);
unsigned int __cdecl sub_4034A0(int, int, int);
int sub_4035B0();
// int __usercall sub_403640@<eax>(unsigned int@<eax>, int@<ecx>, int);

//-------------------------------------------------------------------------
// Data declarations

int (__stdcall *dword_406028)(_DWORD, _DWORD); // weak
int dword_40603C; // weak


//----- (00401000) --------------------------------------------------------
#error "40107C: call analysis failed (funcsize=691)"

//----- (00403350) --------------------------------------------------------
int __cdecl sub_403350(int a1, int a2, unsigned __int8 *a3)
{
  int v3; // edi
  unsigned __int8 v5; // [esp+1Bh] [ebp-1Dh]
  int v6; // [esp+27h] [ebp-11h] BYREF
  char v7; // [esp+2Bh] [ebp-Dh]

  v3 = a1;
  v5 = *a3;
  if ( *a3 )
  {
    v7 = 0;
    v6 = sub_403350(
           a1 * a2 + v5,
           a2
         * ((((_BYTE)dword_40603C - 1) & 0x33)
          + ((dword_40603C == 0 ? 100 : 200) * (37 << dword_40603C) + 85 * (dword_40603C + 1))
          * (0x64u % (dword_40603C - 1))),
           a3 + 1);
    if ( dword_406028 )
      dword_406028(&v6, &v6);
    return v6;
  }
  return v3;
}
// 406028: using guessed type int (__stdcall *dword_406028)(_DWORD, _DWORD);
// 40603C: using guessed type int dword_40603C;

//----- (00403420) --------------------------------------------------------
int __cdecl sub_403420(int a1, unsigned __int8 *a2)
{
  return sub_403350(0, (dword_40603C / 0x3Fu + 63) * (dword_40603C / 0x3E9u + 1000) + dword_40603C / 0x2B1u + 689, a2) ^ a1;
}
// 40603C: using guessed type int dword_40603C;

//----- (004034A0) --------------------------------------------------------
unsigned int __cdecl sub_4034A0(int a1, int a2, int a3)
{
  int v3; // ebx
  _DWORD *v4; // edi
  unsigned int v5; // eax
  unsigned int v6; // esi
  int v7; // esi
  int v8; // edx
  int v9; // eax
  int v11; // [esp+20h] [ebp-18h]
  unsigned int v12; // [esp+24h] [ebp-14h]

  v3 = dword_40603C;
  v4 = (_DWORD *)(*(_DWORD *)(dword_40603C / (a3 | 1u) + *(_DWORD *)(a3 + 60) + a3 + 120) + (dword_40603C + 1) * a3);
  v5 = v4[8];
  if ( v5 == -1 )
    v6 = -1;
  else
    v6 = v5 % (dword_40603C - 1);
  if ( ((dword_40603C - 1) & v4[6]) == 0 )
    return 0;
  v12 = a3 + v6;
  v7 = 0;
  v11 = v4[9] + (a3 << dword_40603C);
  while ( 1 )
  {
    v8 = a1;
    if ( v3 )
      v8 = 2 * a1;
    v9 = sub_403420(v8, (unsigned __int8 *)(a3 + *(_DWORD *)(v12 + 4 * v7)));
    v3 = dword_40603C;
    if ( v9 == a2 * (dword_40603C + 1) )
      break;
    if ( (v4[6] & (unsigned int)(dword_40603C - 1)) <= ++v7 )
      return 0;
  }
  return *(_DWORD *)(v4[7] + a3 + 4 * *(unsigned __int16 *)(v11 + 2 * v7) + (dword_40603C << (*((_BYTE *)v4 + 28) + a3)))
       + a3
       + dword_40603C
       / ((*(_DWORD *)(v4[7]
                     + a3
                     + 4 * *(unsigned __int16 *)(v11 + 2 * v7)
                     + (dword_40603C << (*((_BYTE *)v4 + 28) + a3)))
         + a3) | 1u);
}
// 40603C: using guessed type int dword_40603C;

//----- (004035B0) --------------------------------------------------------
int sub_4035B0()
{
  int v0; // edi
  unsigned int v1; // ebx
  unsigned int v3; // [esp+4h] [ebp-10h]

  v3 = *(_DWORD *)(*(_DWORD *)((dword_40603C ^ (int)NtCurrentTeb()->ProcessEnvironmentBlock) + 0xC) + dword_40603C + 28);
  v1 = v3 >> dword_40603C;
  do
  {
    v0 = dword_40603C - 1;
    if ( *(_BYTE *)((dword_40603C - 1) & *(_DWORD *)(v1 + 32)) == 0x6Bu % (dword_40603C - 1)
      && *(_BYTE *)((v0 & *(_DWORD *)(v1 + 32)) + 2) == 32 * (_BYTE)dword_40603C + 101
      && *(_BYTE *)((v0 & *(_DWORD *)(v1 + 32)) + 4) == ((unsigned __int8)dword_40603C ^ 0x72) )
    {
      return dword_40603C | *(_DWORD *)(v1 + 8);
    }
    v1 = *(_DWORD *)v1 >> dword_40603C;
  }
  while ( v3 != *(_DWORD *)v1 );
  return 0;
}
// 40603C: using guessed type int dword_40603C;

//----- (00403640) --------------------------------------------------------
int __usercall sub_403640@<eax>(unsigned int a1@<eax>, int a2@<ecx>, int a3)
{
  int *v3; // ecx
  int v5; // [esp-4h] [ebp-4h]
  int (__thiscall *retaddr)(int); // [esp+0h] [ebp+0h]

  v5 = a2;
  v3 = &a3;
  while ( a1 >= 0x1000 )
  {
    v3 -= 1024;
    *v3 = *v3;
    a1 -= 4096;
  }
  *(int *)((char *)v3 - a1) = *(int *)((char *)v3 - a1);
  return retaddr(v5);
}

// nfuncs=6 queued=6 decompiled=6 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 6 function(s)"
