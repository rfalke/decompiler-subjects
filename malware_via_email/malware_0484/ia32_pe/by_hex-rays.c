/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int, int, int);
// int __usercall sub_4010DC@<eax>(int result@<eax>);
// void __usercall sub_404256(int@<ebx>, int@<ebp>);

//-------------------------------------------------------------------------
// Data declarations

// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);
_UNKNOWN loc_4043D2; // weak


//----- (00401087) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  sub_4010DC(0x10000);
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 3;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (004010DC) --------------------------------------------------------
int __usercall sub_4010DC@<eax>(int result@<eax>)
{
  int v1; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v1);
  MEMORY[0] &= result;
  return result;
}

//----- (00404256) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_404256(int a1@<ebx>, int a2@<ebp>)
{
  int v2; // edx
  int v3; // ebx
  int v5; // ecx
  int v7; // ecx
  int v8; // esi
  int v9; // ecx
  int v12; // edi
  signed int v17; // edx
  bool v19; // cc
  unsigned int v23; // ecx
  int v24; // edx
  int v26; // [esp-8h] [ebp-8h]
  int v27; // [esp-4h] [ebp-4h] BYREF

  __asm
  {
    fsubr   st, st
    fsubr   st(7), st
  }
  v2 = a1 ^ 0x5B93C7FD;
  __asm { fcomp   st(6) }
  HIWORD(v5) = HIWORD(a1);
  LOWORD(v5) = (a1 ^ 0xC7FD) + a1;
  __asm
  {
    fadd    st(4), st
    fcomp   st(7)
  }
  v3 = __ROR4__(a1 + v5, 92);
  _EAX = v26 + 527;
  _ZF = !_BitScanReverse((unsigned int *)&v5, v2);
  if ( !_ZF )
    v3 = a2;
  _OF = __OFADD__(1, v5);
  v7 = v5 + 1;
  if ( !_OF )
    v7 = v3;
  v8 = v2 - 1;
  v9 = (v7 ^ 0x33843573) + 1;
  _PF = __SETP__(v26 + 1491, 0);
  _SF = v26 + 1491 < 0;
  v12 = v26 + 1491;
  while ( !_SF )
  {
    if ( _PF )
    {
      v3 = v9;
      _ECX = -14221;
      v8 = 1074387086;
      __asm { repne dec ecx }
    }
    __asm { rep lea ecx, ds:71A41B78h }
    _ESI = v8 - 1;
    __asm { rcl     esi, 99h }
    *(_DWORD *)_EAX -= 1256298772;
    v17 = -v3;
    __asm { fsub    st(1), st }
    _ESI = v3 & (_ESI + 1);
    _CF = 0;
    v19 = _ESI < 0;
    if ( _ESI >= 0 )
    {
      if ( __SETP__(_ESI, 0) )
      {
        __asm { rcl     esi, 0F8h }
        v17 = -1311581215;
        v3 = 1311589664;
      }
      v17 = -v17;
      _CF = v17 != 0;
      v19 = v17 < 1;
      _ESI = _EAX;
    }
    if ( !v19 )
      v17 = v3;
    LOWORD(v17) = _ESI + _CF + (_WORD)v17;
    __asm { repne add eax, 4 }
    if ( !_PF )
      v17 = (signed int)&v27;
    _ZF = !_BitScanReverse(&v23, v17);
    v24 = 2129287911;
    if ( _CF || _ZF )
      v23 = v3;
    if ( _ZF )
      v24 = (int)&v27;
    if ( !_ZF )
    {
      v3 |= 1 << _ESI;
      v24 = -_ESI;
      v23 = -(_ESI ^ 0xB3AD9634);
    }
    LOWORD(v24) = v23 & v24;
    _ECX = v23 & ~(1 << _ESI);
    __asm { rcl     ecx, 0A4h }
    v9 = v24;
    __asm { fadd    st(2), st }
    v8 = -274786235;
    __asm { fmul    st(3), st }
    _PF = __SETP__(_EAX, v12);
    _SF = _EAX - v12 < 0;
    if ( _EAX >= v12 )
    {
      if ( (_EAX & 0xEF9F1845) != 0 )
        v24 = -274786235;
      ((void (__fastcall *)(int, int))loc_4043D2)(v9, v24);
      JUMPOUT(0x4043D2);
    }
  }
  JUMPOUT(0x404313);
}
// 4043C8: positive sp value 8 has been found
// 404265: inconsistent fpu stack
// 4043CD: control flows out of bounds to 4043D2
// 4042E7: control flows out of bounds to 404313
// 4042BD: variable 'v26' is possibly undefined
// 40436F: variable '_CF' is possibly undefined

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
