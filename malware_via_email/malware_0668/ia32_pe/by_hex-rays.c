/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __cdecl start(int a1, int a2);
int __fastcall sub_4010D5(int a1, int a2);
// DWORD __stdcall GetVersion();
// void __usercall sub_4041ED(int a1@<ecx>, int a2@<ebx>, unsigned int a3@<ebp>, unsigned int a4@<edi>, unsigned int _ESI@<esi>);
// void __usercall sub_40431D(_DWORD *_EDX@<edx>, __int16 a2@<cx>, __int16 a3@<bx>, int _ESI@<esi>);


//----- (0040106A) --------------------------------------------------------
void __cdecl start(int a1, int a2)
{
  int v2; // ecx
  int v3; // edx
  unsigned int v4; // [esp-8h] [ebp-8h]

  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  sub_4010D5(v2 + 945169812, v3);
  __writefsdword(0, v4);
  JUMPOUT(0x4010E6);
}
// 4010F2: control flows out of bounds to 4010E6
// 4010BE: variable 'v2' is possibly undefined
// 4010C4: variable 'v3' is possibly undefined
// 4010CF: variable 'v4' is possibly undefined

//----- (004010D5) --------------------------------------------------------
int __fastcall sub_4010D5(int a1, int a2)
{
  int result; // eax
  int v3; // [esp-4h] [ebp-4h] BYREF

  result = 0;
  __writefsdword(0, (unsigned int)&v3);
  MEMORY[0] = a2;
  return result;
}

//----- (004041ED) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4041ED(int a1@<ecx>, int a2@<ebx>, unsigned int a3@<ebp>, unsigned int a4@<edi>, unsigned int _ESI@<esi>)
{
  int v5; // ebx
  bool v6; // of
  char v7; // cc
  unsigned int v8; // ebx
  unsigned int v10; // edx
  unsigned int v11; // edi
  bool v12; // cf
  bool v13; // zf
  unsigned int v14; // ecx
  unsigned int v15; // ebx
  int v16; // ebx
  _DWORD *v17; // edx
  unsigned int v18; // ecx
  int v21; // edi
  int v22; // esi
  bool v23; // pf
  int v24; // ebx
  int v25; // edi
  int v26; // ebx
  int v28; // ecx
  int v29; // edi
  int v30; // esi
  _DWORD *v31; // edx
  __int16 v32; // cx
  unsigned int v33; // [esp-4h] [ebp-4h]
  unsigned int v34; // [esp-4h] [ebp-4h]
  void *retaddr; // [esp+0h] [ebp+0h]

  v12 = __CFADD__(_ESI, a2);
  v5 = _ESI + a2;
  v6 = __OFADD__(v12, v5);
  v8 = v12 + v5;
  v7 = ((int)(v8 + 728262318) < 0) ^ (v6 | __OFADD__(728262318, v8)) | (v8 == -728262318);
  v8 += 728262318;
  if ( !v7 )
  {
    _ESI = -(a1 | 0xBFFB320D);
    a4 = (__PAIR64__(v8, a4) >> a1) - 2 + 1;
  }
  __asm { rcr     esi, 0BEh }
  v10 = v33;
  v11 = -(a4 + 1) & 0xFAE6FB4A;
  v13 = !_BitScanReverse(&v14, v8);
  if ( !v13 )
    v14 = v33;
  v15 = v11;
  if ( !v12 && !v13 )
    LOWORD(v11) = v14;
  v12 = _bittestandset((int *)&v15, v14);
  v34 = v14;
  if ( !((_WORD)v15 + v12 + (_WORD)v11) )
    v15 = a3;
  v16 = ~v15;
  v17 = (_DWORD *)(v10 + 634);
  v18 = (v14 ^ (1 << v14)) + 1933587338;
  _EDI = v34;
  if ( ((v34 & 0x40000000) != 0) != __OFADD__(v34, v34) )
    v18 ^= v16;
  __asm { rcr     edi, 0E1h }
  v21 = -593916867;
  _BitScanForward((unsigned int *)&v22, v18);
  v23 = __SETP__(v17, -593916867);
  if ( (unsigned int)v17 >= 0xDC998C3D )
  {
    LOWORD(v21) = v18 + ((unsigned int)v17 < 0xDC998C3D) - 29635;
    v23 = __SETP__(828461731, 0);
    v22 = v21;
  }
  LOWORD(v24) = v22;
  v25 = ~v21;
  if ( !v23 )
  {
    v26 = __ROR4__(v22, 116);
    __asm { repne pop esi }
    v24 = -v26;
  }
  v28 = v25 - 1;
  v29 = -v25;
  v30 = -v28;
  if ( __SETP__(-v28, 0) )
    v30 = (int)v17;
  if ( __SETP__(v17 + 241, 0) )
  {
    LOWORD(v24) = v29;
    LOWORD(v28) = v30 + 30100;
  }
  sub_40431D(v17, v28, v24, v30);
  sub_40431D(v31, v32, (__int16)retaddr, v30);
}
// 404221: positive sp value 4 has been found
// 404220: variable 'v33' is possibly undefined
// 404238: variable 'v12' is possibly undefined
// 40431C: variable 'v31' is possibly undefined
// 40431C: variable 'v32' is possibly undefined

//----- (0040431D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40431D(_DWORD *_EDX@<edx>, __int16 a2@<cx>, __int16 a3@<bx>, int _ESI@<esi>)
{
  int v5; // esi
  __int16 v8; // cx
  int v9; // edi
  int savedregs; // [esp+0h] [ebp+0h]
  int savedregsa; // [esp+0h] [ebp+0h]

  __asm { rcr     esi, 0A4h }
  v5 = savedregs;
  *_EDX ^= 0x3119AFDBu;
  _CF = __CFADD__(a3, a2);
  _OF = __OFADD__(a3, a2);
  v8 = a3 + a2;
  HIWORD(v9) = -16667;
  if ( _OF )
  {
    v5 = (unsigned __int8)v8;
    LOWORD(v9) = v8 & 0x44F;
    _CF = __CFSHL__(v9, -59);
  }
  _ESI = v5 - (_CF + 1583086354);
  __asm
  {
    rcr     esi, 31h
    repne add edx, 4
  }
  savedregsa = 4211621;
  JUMPOUT(0x4043A9);
}
// 404339: positive sp value 4 has been found
// 4043A8: control flows out of bounds to 4043AA
// 4043A0: control flows out of bounds to 4043A9
// 404338: variable 'savedregs' is possibly undefined

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
