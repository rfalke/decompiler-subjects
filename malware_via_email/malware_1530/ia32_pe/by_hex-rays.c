/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall start@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>);
// char __usercall sub_401F2B@<al>(int a1@<eax>, char a2@<dh>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>);


//----- (00401089) --------------------------------------------------------
int __usercall start@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  int v6; // eax
  int v7; // edx
  int v8; // ecx
  int v9; // edx
  int v10; // ecx
  int v11; // ebx
  int v12; // esi
  int v13; // ebx
  int v14; // ebx
  int v15; // edx
  int v16; // esi
  int v17; // ebx
  int v18; // edx
  int v19; // ecx
  int v20; // esi
  bool v21; // cf
  int v22; // ebx
  int result; // eax
  char v24; // tt
  int v25; // eax
  int v26; // ecx
  int v27; // edi
  int v28; // esi
  unsigned __int8 v30; // al
  int v31; // ecx
  unsigned int v32; // edx
  BOOL v33; // ett
  BOOL v34; // ett
  int v35; // ecx
  int v37; // ecx
  int v38; // edx
  int v39; // [esp+0h] [ebp-4h]
  int vars0; // [esp+4h] [ebp+0h]

  v15 = a6 ^ a2;
  v16 = a3 | a6;
  v17 = ((a1 | a5) ^ a4) - a1 - v16;
  v18 = v17 + v15;
  v19 = (v18 ^ ((v17 ^ a1) - a1)) - 1;
  v20 = v19 ^ v16;
  v11 = v20 | v19 ^ v18 ^ v19 ^ (v17 + 1);
  v12 = a1 + v20;
  ++v11;
  HIWORD(v18) = (v19 ^ (unsigned int)v18) >> 16;
  BYTE1(v11) -= 84;
  v13 = a1 + v11 - 1;
  BYTE1(v18) = BYTE1(v13) + (BYTE1(a1) ^ ((unsigned __int16)(v19 ^ v18) >> 8));
  v14 = v12 | v13;
  BYTE1(v18) |= a1 + v19 - 1 + 2;
  v21 = __CFADD__((_BYTE)v14, BYTE1(v14));
  BYTE1(v14) += v14;
  LOBYTE(v18) = (BYTE1(v18) | v19 ^ v18) + 14;
  BYTE1(v18) = BYTE1(v18) - (v21 + 15) - ((BYTE1(v18) < (unsigned __int8)(v21 + 15)) + 81) - 53;
  LOBYTE(v14) = v14 - 74;
  --v18;
  v8 = v14 + a1;
  BYTE1(v8) = ((unsigned __int16)(v14 + a1) >> 8) - 1;
  LOBYTE(v8) = v14 + a1 + 56;
  __asm { fnclex }
  v6 = v14 + a1 - 1;
  LOBYTE(v18) = BYTE1(v14) ^ 0x8A;
  v7 = v18 - v8;
  LOBYTE(v6) = -(char)v6;
  BYTE1(v6) = v6;
  v25 = v12 ^ v6;
  HIWORD(v39) = HIWORD(v25);
  BYTE1(v7) = ~BYTE1(v7);
  LOBYTE(v25) = -(char)v25 - (((_BYTE)v25 != 0) + 83);
  LOBYTE(v8) = v8 - 70;
  __asm { smsw    [esp+4+var_4] }
  BYTE1(v25) = -BYTE1(v25);
  v22 = v25 | v8;
  BYTE1(v22) ^= v22;
  LOBYTE(v7) = BYTE1(v25) | BYTE1(v8);
  v9 = v39 + v7;
  LOBYTE(v8) = v9 | 0x16;
  result = ~v39;
  v21 = __CFADD__(BYTE1(v9), 13);
  BYTE1(v9) += 13;
  v24 = v21 - 11;
  v21 = BYTE1(v9) < (unsigned __int8)(v21 - 11);
  BYTE1(v9) -= v24;
  BYTE1(v8) = BYTE1(v8) + 1 - (v21 - 51);
  LOBYTE(v9) = ~(_BYTE)v9;
  if ( (~(_BYTE)v39 & 8) != 0 )
  {
    v10 = result ^ v8;
    LOBYTE(v22) = v9 | 0x28;
    LOBYTE(v10) = -(char)v10;
    BYTE1(v22) = -BYTE1(v22);
    v26 = v22 | v10;
    _EBX = v22 - 1;
    v21 = __CFADD__(BYTE1(v9), 64);
    BYTE1(v9) += 64;
    v27 = v12 - 1;
    LOBYTE(v9) = v26 ^ (v21 + v9 + 93);
    v21 = (unsigned __int8)v9 < (unsigned __int8)v26;
    LOBYTE(v9) = v9 - v26;
    BYTE1(v26) = _EBX;
    BYTE1(_EBX) -= v21 + 26;
    LOBYTE(result) = -(char)v39 - 20;
    LOBYTE(v26) = v26 + 1;
    v28 = v9 ^ v12;
    v21 = __CFADD__((_BYTE)result, 95);
    LOBYTE(result) = result + 95;
    BYTE1(_EBX) -= v21 - 26;
    LOBYTE(_EBX) = -54;
    BYTE1(v26) |= BYTE1(_EBX);
    v30 = sub_401F2B(v28 | result, SBYTE1(v9), v26, _EBX, v27, v28);
    v33 = v30 < (unsigned __int8)(v21 + 32);
    v21 = __CFADD__(v33, __readfsdword(v32)) | __CFADD__(v28, v33 + __readfsdword(v32));
    __writefsdword(v32, v28 + v33 + __readfsdword(v32));
    v34 = v21;
    v21 = __CFADD__(v21, *(_DWORD *)(_EBX - 531636305)) | __CFADD__(_EBX, v21 + *(_DWORD *)(_EBX - 531636305));
    *(_DWORD *)(_EBX - 531636305) += _EBX + v34;
    if ( !v21 )
    {
      v35 = v31 - *(_DWORD *)(v27 - 127);
      __DS__ = vars0;
      _RAX = ((__int64 (__thiscall *)(int))*MK_FP(vars0, v27))(v35);
      __outbyte(WORD2(_RAX), _RAX);
      __asm { xlat    byte ptr cs:[ebx] }
      *(_BYTE *)_RAX <<= v37;
      vars0 = v37;
      __asm { aam     20h ; ' ' }
      HIDWORD(_RAX) = _InterlockedExchange((volatile __int32 *)(v37 + 309788516), SHIDWORD(_RAX));
      (*(void (__fastcall **)(int, _DWORD, int))(9 * v27 - 1359011920))(v37, HIDWORD(_RAX), vars0);
      *(_BYTE *)(v27 + 76) &= v38;
      *(int *)((char *)&vars0 + v38) += v38;
      JUMPOUT(0x4011CB);
    }
    JUMPOUT(0x4011AF);
  }
  return result;
}
// 4011C8: control flows out of bounds to 4011CB
// 401197: control flows out of bounds to 4011AF
// 40118C: variable 'v21' is possibly undefined
// 40118E: variable 'v32' is possibly undefined
// 40119C: variable 'v31' is possibly undefined
// 4011A7: variable 'v37' is possibly undefined
// 4011B9: variable 'v38' is possibly undefined

//----- (00401F2B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
char __usercall sub_401F2B@<al>(int a1@<eax>, char a2@<dh>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  __int16 v6; // bx
  __int16 v7; // bx
  int v8; // esi
  int v9; // ebx
  unsigned int v10; // ecx
  int v11; // edi
  int v12; // ebx
  int v14; // edi
  int v15; // esi
  int v16; // ecx
  int v17; // eax
  int v18; // esi
  int v19; // eax
  int v20; // ebx
  _BYTE *v21; // edi
  int v22; // edi
  _BYTE *v23; // edi
  int v24; // ecx
  _BYTE *v25; // edx
  int v26; // edi
  int v27; // [esp-4h] [ebp-4h]
  int v28; // [esp-4h] [ebp-4h]

  v22 = (a1 ^ a5) - 1;
  LOBYTE(a3) = -(char)a3;
  LOBYTE(a1) = ((_BYTE)a3 != 0) + a1 + 70;
  LOBYTE(a3) = a2 ^ a3;
  v15 = a6 - 1;
  BYTE1(a3) = ~BYTE1(a3);
  v16 = a1 | a3;
  v17 = a1 - v15;
  v18 = v22 + (v16 ^ v15);
  LOBYTE(v16) = (v28 + 88) ^ v16;
  BYTE1(a4) = BYTE1(v17) | ((BYTE1(v17) | ((a4 ^ BYTE1(a4)) + 1)) + 1);
  v11 = (v28 + 344) ^ v22;
  BYTE1(v16) = 1;
  v12 = a4 - 1;
  v27 = v28 + 344;
  v19 = v11 | v17;
  LOBYTE(v12) = v27 | (v12 - BYTE1(v12));
  v24 = v16 - v18;
  BYTE1(v24) = BYTE1(v12);
  v25 = (_BYTE *)(v27 - 344);
  --BYTE1(v12);
  LOBYTE(v12) = v19 ^ v12;
  v26 = v12 ^ v11;
  v8 = v18 - v24 - (v27 - 344);
  v9 = v8 ^ v12;
  BYTE1(v19) = -29;
  v10 = 3025;
  LOBYTE(v19) = BYTE1(v9) - 41;
  BYTE1(v9) -= 70;
  LOBYTE(v9) = v9 + 85;
  v20 = v9 + 3025;
  BYTE1(v20) = v27 - 88;
  LOBYTE(v20) = ((unsigned __int16)(v27 - 344) >> 8) ^ v20;
  v21 = (_BYTE *)(v20 + v26);
  do
  {
    BYTE1(v19) = BYTE1(v19) + 1 - v20;
    --v19;
    BYTE1(v19) = BYTE1(v10) ^ ~BYTE1(v19);
    LOBYTE(v19) = -*v25;
    v14 = ((v10 ^ v8) - v19) | (v21 - v25);
    LOBYTE(v19) = (*v25 - 1) ^ 0xA6;
    v23 = &v25[v14 - v19];
    LOBYTE(v19) = __ROL1__(v19 + 45, 10) + 117;
    BYTE1(v19) = v19;
    *v25++ = v19;
    --v10;
    HIBYTE(v6) = ((unsigned __int8)((_BYTE)v23 + 78) < BYTE1(v25)) + BYTE1(v23) - v19 - 53;
    LOBYTE(v6) = v10 | ((_BYTE)v23 + 78 - BYTE1(v25));
    v7 = v10 | v6;
    HIBYTE(v7) += 88;
    v8 = v10 + 1726723779;
    v21 = v23 - 1;
    ++v7;
    LOBYTE(v7) = (v10 < 0x9914493D) + v7 + 95;
    --v7;
    LOBYTE(v7) = v19 | v7;
    HIBYTE(v7) -= 27;
    LOWORD(v20) = v7 - (_WORD)v21;
  }
  while ( v10 );
  return (v19 ^ BYTE1(v20)) + ((v19 + 81) | 0x1A);
}
// 401E31: positive sp value 4 has been found
// 401EB6: variable 'v28' is possibly undefined

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
