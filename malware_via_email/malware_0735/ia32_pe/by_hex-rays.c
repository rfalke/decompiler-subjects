/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start(); // weak
// int __userpurge sub_401170@<eax>(int@<esi>, int);
// void __usercall sub_4011B0(int@<ecx>, int@<edi>);
// int __usercall sub_4011C0@<eax>(int@<ecx>, int@<edi>);
// int __usercall sub_4011E0@<eax>(int@<eax>);
int __stdcall sub_401220(int);

//-------------------------------------------------------------------------
// Data declarations

__int16 word_40142E = 0; // weak


//----- (00401050) --------------------------------------------------------
void __noreturn start()
{
  struct _TEB *v0; // ebx
  int v1; // edx
  int v2; // eax
  _DWORD *v3; // ecx
  int v4; // ecx
  char v5[7139]; // [esp+1h] [ebp-1C47h] BYREF
  wchar_t *StaticUnicodeBuffer; // [esp+1BE4h] [ebp-64h]
  int v7; // [esp+1BE8h] [ebp-60h]
  int v8; // [esp+1BECh] [ebp-5Ch]
  char *v9; // [esp+1BF0h] [ebp-58h]
  int v10; // [esp+1C2Ch] [ebp-1Ch] BYREF
  char *v11; // [esp+1C34h] [ebp-14h]
  int v12; // [esp+1C38h] [ebp-10h]
  char v13; // [esp+1C44h] [ebp-4h] BYREF

  v0 = NtCurrentTeb();
  sub_401170((int)v0->StaticUnicodeBuffer, (int)&v10);
  *(_DWORD *)&v5[v1] = v1;
  v2 = (14702592 - (v1 << 11)) & (18966608 - (v1 << 11));
  v3 = (_DWORD *)((v1 << 9) + v2 - 3683764);
  *(_DWORD *)&v5[v10 + 12] = *v3 - 40;
  v11 = (char *)(*(v3 - 1) + v2 + 7251 - v10);
  sub_401220(v10);
  v9 = &v13;
  v8 = 4;
  v7 = v4;
  StaticUnicodeBuffer = v0->StaticUnicodeBuffer;
  sub_4011B0(v10, (int)v0);
  ((void (__cdecl *)(char *, int, int))(v10 + 4191461))(v11, v12, v10);
  v11 += 7259;
  v11 -= v10;
  ((void (__cdecl *)(char *, _DWORD))v11)(v11 + 3018, 0);
}
// 401076: variable 'v1' is possibly undefined
// 4010CB: variable 'v4' is possibly undefined
// 401050: using guessed type void __noreturn start();

//----- (00401170) --------------------------------------------------------
int __userpurge sub_401170@<eax>(int a1@<esi>, int a2)
{
  int (__stdcall *v2)(int); // eax

  v2 = (int (__stdcall *)(int))(*(_DWORD *)(&word_40142E - 533) - 1);
  if ( *(_BYTE *)v2 != 0x90 )
    v2 = *(int (__stdcall **)(int))(&word_40142E - 533);
  return v2(a1);
}
// 40142E: using guessed type __int16 word_40142E;

//----- (004011B0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4011B0(int a1@<ecx>, int a2@<edi>)
{
  int v2; // eax
  void (*v3)(void); // eax

  v2 = sub_4011C0(a1, a2);
  v3 = (void (*)(void))sub_4011E0(v2);
  v3();
  __asm { retn }
}
// 4011BC: positive sp value 4 has been found
// 4011BF: unbalanced stack, ignored a potential tail call

//----- (004011C0) --------------------------------------------------------
int __usercall sub_4011C0@<eax>(int a1@<ecx>, int a2@<edi>)
{
  return *(_DWORD *)(**(_DWORD **)(*(_DWORD *)(*(_DWORD *)(2 * a1 + a2 - 14374) + 12) + 28) + 8);
}

//----- (004011E0) --------------------------------------------------------
int __usercall sub_4011E0@<eax>(int a1@<eax>)
{
  int i; // edx

  for ( i = 0;
        *(_DWORD *)(a1 + *(_DWORD *)(a1 + *(_DWORD *)(a1 + *(_DWORD *)(a1 + *(_DWORD *)(a1 + 60) + 120) + 32) + i) + 12) != 1442870371;
        i += 4 )
  {
    ;
  }
  return a1 + *(_DWORD *)(a1 + *(_DWORD *)(a1 + *(_DWORD *)(a1 + *(_DWORD *)(a1 + 60) + 120) + 28) + i);
}

//----- (00401220) --------------------------------------------------------
int __stdcall sub_401220(int a1)
{
  return ((7318528 - (a1 << 10)) & ((a1 << 11) - 10569184)) + 14768188 - (a1 << 11);
}

// nfuncs=6 queued=6 decompiled=6 lumina nreq=0 worse=0 better=0
// ALL OK, 6 function(s) have been successfully decompiled
