/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// BOOL __stdcall VirtualProtect(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);
// LPVOID __stdcall VirtualAlloc(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
char __cdecl start(int a1, int a2);
int __stdcall sub_401190(_DWORD *a1, int a2, int a3);
char __stdcall sub_4011D0(int a1, char *a2, _BYTE *a3);
unsigned int __stdcall sub_4011F0(unsigned int *a1);


//----- (00401010) --------------------------------------------------------
char __cdecl start(int a1, int a2)
{
  unsigned int v2; // eax
  unsigned int v3; // ecx
  char *v4; // ebx
  _DWORD *v5; // esi
  _BYTE *v6; // eax
  char v8[3]; // [esp+1h] [ebp-5Fh] BYREF
  int v9; // [esp+4h] [ebp-5Ch]
  DWORD v10; // [esp+8h] [ebp-58h]
  _DWORD v11[14]; // [esp+Ch] [ebp-54h] BYREF
  int v12; // [esp+44h] [ebp-1Ch] BYREF
  int v13; // [esp+48h] [ebp-18h]
  LPVOID lpAddress; // [esp+4Ch] [ebp-14h]
  SIZE_T dwSize; // [esp+50h] [ebp-10h]
  DWORD flOldProtect; // [esp+5Ch] [ebp-4h] BYREF

  sub_4011F0((unsigned int *)&v12);
  v2 = ((v12 - 10) << 13) + ((4558864 - (v12 << 15)) & 0xFFFF0000);
  v3 = (unsigned int)(v12 << 15) >> 2;
  *(int *)((char *)&v12 + v12 + 1) = *(_DWORD *)(v2 - 89996 + v3);
  lpAddress = (LPVOID)(v2 + 45192 - (v3 >> 1));
  VirtualProtect(lpAddress, dwSize, 4u, &flOldProtect);
  sub_401190(lpAddress, dwSize, v12);
  v4 = (char *)lpAddress + *(_DWORD *)((char *)lpAddress - v12 + 71);
  v13 = (unsigned __int8)v4[6];
  v10 = 64;
  v9 = 12288;
  flOldProtect = (DWORD)VirtualAlloc(*((LPVOID *)v4 + 13), *((_DWORD *)v4 + 20), 0x3000u, 0x40u);
  v10 = flOldProtect;
  v9 = (int)lpAddress;
  sub_4011D0(*(_DWORD *)&v4[-v12 + 95], (char *)lpAddress, (_BYTE *)flOldProtect);
  v5 = v4 + 248;
  do
  {
    sub_4011D0(v5[4], (char *)lpAddress + v5[5], (_BYTE *)(v5[3] + flOldProtect));
    v5 += 10;
    --v13;
  }
  while ( v13 );
  *(int *)((char *)&a2 - v12 + 3) = flOldProtect + *(_DWORD *)&v4[v12 + 29];
  sub_4011D0(56, (char *)(v12 + 4198730), v11);
  sub_401190(v11, 56, v12);
  v6 = (_BYTE *)flOldProtect;
  do
    v6 += 4;
  while ( *(_DWORD *)v6 != v12 - 1430532910 );
  return sub_4011D0(67 - v12, &v8[v12], v6);
}

//----- (00401190) --------------------------------------------------------
int __stdcall sub_401190(_DWORD *a1, int a2, int a3)
{
  int result; // eax
  bool v6; // cc
  int i; // [esp+4h] [ebp-4h]

  result = a3 + 249743815;
  for ( i = 1; ; i = -i )
  {
    *a1 ^= result;
    v6 = a2 <= 4;
    a2 -= 4;
    if ( v6 )
      break;
    result += i + 475489042;
    a1 = (_DWORD *)((char *)a1 - a3 + 15);
  }
  return result;
}

//----- (004011D0) --------------------------------------------------------
char __stdcall sub_4011D0(int a1, char *a2, _BYTE *a3)
{
  char result; // al

  do
  {
    result = *a2;
    *a3++ = *a2++;
    --a1;
  }
  while ( a1 );
  return result;
}

//----- (004011F0) --------------------------------------------------------
unsigned int __stdcall sub_4011F0(unsigned int *a1)
{
  unsigned int result; // eax

  result = ((MEMORY[0x7FFE0300]() & 0xF0000000) - 0x10000000) >> 28;
  *a1 = result;
  return result;
}
// 7FFE0300: using guessed type int (*)(void);

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
