/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// LONG __usercall Snrfmiy@<eax>(char@<cf>, int@<eax>, int@<edx>);
// void __usercall sub_40130C(int@<edx>, int@<ebp>, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int);
// void __usercall WriteArkmconqy(int@<eax>, int@<ebx>, int@<ebp>, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int);
// int __usercall cuyvyo_9@<eax>(int@<eax>, int@<edx>, int@<ecx>, int@<ebp>, int@<esi>, _BYTE *edi0@<edi>, int, int, int, int);
// int __usercall Yxjieier@<eax>(int result@<eax>, int@<edx>, int@<ecx>, int@<ebp>, _BYTE *@<edi>);
HANDLE sub_4016CB();
_DWORD __cdecl sub_4016DD(_DWORD); // weak
// void __usercall sub_401769(char *@<eax>);
// int __usercall start@<eax>(int@<edx>, int@<ebx>, int@<ebp>, int@<edi>, int@<esi>, int, int, int, int, int);
// HANDLE __usercall sub_40196A@<eax>(int@<edx>, int@<ecx>, int@<ebp>);
_DWORD sub_4019C5(); // weak

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401188; // weak
// extern HANDLE (__stdcall *GetCurrentProcess)();
// extern HANDLE (__stdcall *FindFirstChangeNotificationA)(LPCSTR lpPathName, BOOL bWatchSubtree, DWORD dwNotifyFilter);
// extern LONG (__stdcall *phoneDevSpecific)(HPHONE hPhone, LPVOID lpParams, DWORD dwSize);
int dword_406068 = 16843009; // weak
int dword_4060CA = 16843009; // weak
int dword_406159 = 16843009; // weak
int dword_4063C3 = 16843009; // weak
int dword_40647C = 16843009; // weak
int dword_4064BA = 16843009; // weak
int dword_4065A2 = 16843009; // weak
int dword_4066B3 = 16843009; // weak
int dword_4066F8 = 16843009; // weak
int dword_406963 = 16843009; // weak
int dword_4069CD = 16843009; // weak
int dword_406A51 = 16843009; // weak
int dword_406A70 = 16843009; // weak
int dword_406B08 = 16843009; // weak
int dword_406B7D = 16843009; // weak
int dword_406CA2 = 16843009; // weak
int dword_4070CA = 16843009; // weak
int dword_407189 = 16843009; // weak
int dword_407308 = 16843009; // weak
int dword_407433 = 16843009; // weak
int dword_407528 = 16843009; // weak
int dword_407670 = 16843009; // weak
int dword_4076A9 = 16843009; // weak
int dword_4076F2 = 16843009; // weak
int dword_407707 = 16843009; // weak
int dword_407D1B = 16843009; // weak
int dword_407DD2 = 16843009; // weak
int dword_407E31 = 16843009; // weak
int dword_408021 = 16843009; // weak
int dword_4082A9 = 16843009; // weak
int dword_4082EE = 16843009; // weak
int dword_408335 = 16843009; // weak
int dword_4083C3 = 16843009; // weak
int dword_408443 = 16843009; // weak
int dword_4084B9 = 16843009; // weak
int dword_40871C = 16843009; // weak
int dword_408796 = 16843009; // weak
int dword_408D68 = 16843009; // weak
int dword_408D8E = 16843009; // weak
int dword_408F76 = 16843009; // weak
_UNKNOWN unk_409219; // weak


//----- (004012DF) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
LONG __usercall Snrfmiy@<eax>(char a1@<cf>, int a2@<eax>, int a3@<edx>)
{
  void *v4; // [esp-Ch] [ebp-Ch]
  DWORD v5; // [esp-8h] [ebp-8h]

  dword_406159 -= a3 - dword_4060CA;
  return phoneDevSpecific(a2 - ((_DWORD)&dword_407189 + a1), v4, v5);
}
// 401309: positive sp value C has been found
// 4012DF: could not find valid save-restore pair for ebp
// 4012FD: variable 'v4' is possibly undefined
// 4012FD: variable 'v5' is possibly undefined
// 4060CA: using guessed type int dword_4060CA;
// 406159: using guessed type int dword_406159;
// 407189: using guessed type int dword_407189;

//----- (0040130C) --------------------------------------------------------
void __usercall sub_40130C(
        int a1@<edx>,
        int a2@<ebp>,
        int a3,
        int a4,
        int a5,
        int a6,
        int a7,
        int a8,
        int a9,
        int a10,
        int a11,
        int a12,
        int a13,
        int a14,
        int a15,
        int a16,
        int a17,
        int a18,
        int a19,
        int a20,
        int a21,
        int a22,
        int a23,
        int a24,
        int a25,
        int a26,
        int a27,
        int a28,
        int a29,
        int a30,
        int a31,
        int a32,
        int a33,
        int a34,
        int a35,
        int a36,
        int a37,
        int a38,
        int a39,
        int a40,
        int a41,
        int a42,
        int a43,
        int a44,
        int a45,
        int a46,
        int a47,
        int a48,
        int a49,
        int a50,
        int a51,
        int a52,
        int a53,
        int a54,
        int a55,
        int a56,
        int a57,
        int a58,
        int a59,
        int a60,
        int a61,
        int a62,
        int a63)
{
  dword_4082A9 = a1;
  dword_406CA2 += a1;
  dword_406B08 += 25 * a2;
  WriteArkmconqy(
    1,
    (25 * a2) ^ 0xFFFFFF8B,
    a2,
    a3,
    a4,
    a5,
    a6,
    a7,
    a8,
    a9,
    a10,
    a11,
    a12,
    a13,
    a14,
    a15,
    a16,
    a17,
    a18,
    a19,
    a20,
    a21,
    a22,
    a23,
    a24,
    a25,
    a26,
    a27,
    a28,
    a29,
    a30,
    a31,
    a32,
    a33,
    a34,
    a35,
    a36,
    a37,
    a38,
    a39,
    a40,
    a41,
    a42,
    a43,
    a44,
    a45,
    a46,
    a47,
    a48,
    a49,
    a50,
    a51,
    a52,
    a53,
    a54,
    a55,
    a56,
    a57,
    a58,
    a59,
    a60,
    a61,
    a62);
}
// 406B08: using guessed type int dword_406B08;
// 406CA2: using guessed type int dword_406CA2;
// 4082A9: using guessed type int dword_4082A9;

//----- (00401362) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall WriteArkmconqy(
        int a1@<eax>,
        int a2@<ebx>,
        int a3@<ebp>,
        int a4,
        int a5,
        int a6,
        int a7,
        int a8,
        int a9,
        int a10,
        int a11,
        int a12,
        int a13,
        int a14,
        int a15,
        int a16,
        int a17,
        int a18,
        int a19,
        int a20,
        int a21,
        int a22,
        int a23,
        int a24,
        int a25,
        int a26,
        int a27,
        int a28,
        int a29,
        int a30,
        int a31,
        int a32,
        int a33,
        int a34,
        int a35,
        int a36,
        int a37,
        int a38,
        int a39,
        int a40,
        int a41,
        int a42,
        int a43,
        int a44,
        int a45,
        int a46,
        int a47,
        int a48,
        int a49,
        int a50,
        int a51,
        int a52,
        int a53,
        int a54,
        int a55,
        int a56,
        int a57,
        int a58,
        int a59,
        int a60,
        int a61,
        int a62,
        int a63)
{
  unsigned int v63; // ebx
  int v64; // ebx

  dword_408D8E -= a2;
  v63 = a2 ^ 0xFFFFFF98;
  if ( BYTE1(a1) == 1 )
  {
    v64 = v63 - a3 - a1;
    dword_408796 = v64;
    LOBYTE(v64) = 0;
    dword_4070CA = (v64 - a1) ^ 0xFFFFFFC2;
    JUMPOUT(0x4013B4);
  }
  JUMPOUT(0x401346);
}
// 401370: positive sp value 8 has been found
// 4013B2: control flows out of bounds to 4013B4
// 401376: control flows out of bounds to 401346
// 406B08: using guessed type int dword_406B08;
// 4070CA: using guessed type int dword_4070CA;
// 408796: using guessed type int dword_408796;
// 408D8E: using guessed type int dword_408D8E;

//----- (004015D3) --------------------------------------------------------
int __usercall cuyvyo_9@<eax>(
        int a1@<eax>,
        int a2@<edx>,
        int a3@<ecx>,
        int a4@<ebp>,
        int a5@<esi>,
        _BYTE *edi0@<edi>,
        int a7,
        int a8,
        int a9,
        int a10)
{
  int v10; // esi
  char v11; // dl
  int v12; // edx

  a1 = (unsigned __int16)a1;
  dword_4083C3 = dword_407DD2 + a5 + a4 + 3 * a2;
  BYTE1(a1) = 0;
  LOBYTE(a3) = *((_BYTE *)&a10 + a1 + 2);
  dword_408021 = (87 * a3) | 0x4C;
  v10 = (unsigned __int8)(a5 + a3);
  v11 = *((_BYTE *)&a10 + v10 + 2);
  dword_4069CD = v11;
  *((_BYTE *)&a10 + a1 + 2) = v11;
  *((_BYTE *)&a10 + v10 + 2) = a3;
  v12 = *((unsigned __int8 *)&a10 + a1 + 2);
  dword_407528 -= 109 - a1 - a4;
  return Yxjieier(a1, v12, a3, a4, edi0);
}
// 4069CD: using guessed type int dword_4069CD;
// 407528: using guessed type int dword_407528;
// 407DD2: using guessed type int dword_407DD2;
// 408021: using guessed type int dword_408021;
// 4083C3: using guessed type int dword_4083C3;

//----- (00401645) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall Yxjieier@<eax>(int result@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebp>, _BYTE *a5@<edi>)
{
  int v5; // edx
  int v6; // ebx
  char v7; // cl
  int v8; // [esp-114h] [ebp-114h]
  int v9; // [esp-110h] [ebp-110h]
  _BYTE v10[260]; // [esp-104h] [ebp-104h]

  v5 = a3 + a2;
  v6 = a3 + v5 + 99;
  v7 = v10[(unsigned __int8)v5];
  dword_40647C -= v6 - (unsigned __int8)v5;
  *a5 ^= v7;
  dword_406A70 = (unsigned __int16)result;
  if ( a4 != 1 )
    JUMPOUT(0x4015B5);
  dword_407670 += 124 * (unsigned __int8)v5;
  dword_408796 -= result + dword_407DD2 + (unsigned __int8)v5 + 44 - 1;
  dword_4076A9 -= 103 * v8 - dword_406CA2 - v9;
  return result;
}
// 4016CA: positive sp value 118 has been found
// 40167F: control flows out of bounds to 4015B5
// 401645: could not find valid save-restore pair for esi
// 4016AC: variable 'v8' is possibly undefined
// 4016B5: variable 'v9' is possibly undefined
// 40647C: using guessed type int dword_40647C;
// 406A70: using guessed type int dword_406A70;
// 406CA2: using guessed type int dword_406CA2;
// 407670: using guessed type int dword_407670;
// 4076A9: using guessed type int dword_4076A9;
// 407DD2: using guessed type int dword_407DD2;
// 408796: using guessed type int dword_408796;

//----- (004016CB) --------------------------------------------------------
HANDLE sub_4016CB()
{
  CHAR v1; // [esp-8h] [ebp-Ch] BYREF
  int v2; // [esp-4h] [ebp-8h] BYREF
  int v3; // [esp+0h] [ebp-4h] BYREF

  GetCurrentProcess();
  return FindFirstChangeNotificationA(&v1, (BOOL)&v2, (DWORD)&v3);
}

//----- (004016DD) --------------------------------------------------------
#error "40174D: call analysis failed (funcsize=43)"

//----- (00401769) --------------------------------------------------------
void __usercall sub_401769(char *a1@<eax>)
{
  unsigned int *v1; // ecx
  char *v2; // edi
  char *v3; // esi
  unsigned int v4; // ebx
  int v5; // edx
  char *v6; // eax
  int i; // edx
  int v8; // edx
  unsigned int v9; // ecx
  int v10; // ebx
  int v11; // edx
  int v12; // ebx
  int v13; // esi
  int v14; // edx
  unsigned int *v15; // [esp-8h] [ebp-Ch]

  if ( &unk_409219 != (_UNKNOWN *)-1 )
  {
    v1 = (unsigned int *)&unk_409219;
    v2 = a1;
    v3 = a1;
    v4 = (((char)&unk_409219 - ((_DWORD)&unk_409219 + 1)) ^ 0xFFFFFF93) + 1;
    v5 = dword_4076A9 - 1;
    dword_407D1B -= v4;
    BYTE1(v5) = 65;
    v6 = &a1[unk_409219];
    for ( i = v5 - (_DWORD)v6; ; i = dword_4083C3 - (_DWORD)v2 + 1 )
    {
      v8 = i - 1;
      if ( v6 != v2 )
      {
        dword_406A51 = v8;
        v15 = v1;
        LOBYTE(v8) = 51;
        v9 = *v1;
        v10 = (unsigned __int16)v9;
        v11 = v8 - (_DWORD)v6;
        if ( !v9 )
        {
          dword_4066B3 = v11;
          v13 = v3 - v2;
          v14 = (char)v6 - (_DWORD)v2 - 1;
          do
          {
            dword_406B7D += v10;
            *v2++ = 0;
            v10 = 66 * (_DWORD)v6;
            --v14;
            --v13;
          }
          while ( v13 );
          break;
        }
        v12 = (unsigned __int16)v9 + 1;
        dword_4064BA -= v11;
        dword_406963 += v12;
        LOBYTE(v12) = 78;
        qmemcpy(v2, v3, v9);
        v3 += v9;
        v2 += v9;
        v1 = v15;
        v4 = v12 - (_DWORD)v2;
      }
      v3 += 16;
      dword_4066F8 -= v4;
      ++v1;
      v4 -= 16843009;
      v6 = &v3[*v1];
    }
  }
  JUMPOUT(0x4016CA);
}
// 401841: control flows out of bounds to 4016CA
// 4064BA: using guessed type int dword_4064BA;
// 4066B3: using guessed type int dword_4066B3;
// 4066F8: using guessed type int dword_4066F8;
// 406963: using guessed type int dword_406963;
// 406A51: using guessed type int dword_406A51;
// 406B7D: using guessed type int dword_406B7D;
// 4076A9: using guessed type int dword_4076A9;
// 407D1B: using guessed type int dword_407D1B;
// 4083C3: using guessed type int dword_4083C3;

//----- (00401847) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall start@<eax>(
        int a1@<edx>,
        int a2@<ebx>,
        int a3@<ebp>,
        int a4@<edi>,
        int a5@<esi>,
        int a6,
        int a7,
        int a8,
        int a9,
        int a10)
{
  int v10; // edx
  int v11; // ebx
  int v12; // ecx
  int v13; // edi
  int v14; // ecx
  int v15; // edi
  int v16; // edx
  unsigned int v17; // ebx
  int v18; // eax
  int v19; // ecx
  int result; // eax
  int v21; // edx
  char *v22; // [esp-14h] [ebp-18h]
  int v23; // [esp-14h] [ebp-18h]
  _DWORD v24[4]; // [esp-10h] [ebp-14h] BYREF

  dword_407189 += dword_4063C3;
  v24[0] = a3;
  dword_406A70 -= dword_4063C3 - a4;
  sub_40196A(a1, a1 + (((unsigned int)v24 + 1) ^ 0x4C), (int)v24);
  dword_408443 -= v10;
  v11 = a2 - dword_406B7D;
  dword_407189 = v12 - 1;
  LOBYTE(v11) = 97;
  dword_407E31 = dword_407433;
  v13 = a5 + a4 + 2;
  v22 = (char *)((int (__thiscall *)(int))loc_401188)(dword_4076F2);
  dword_4065A2 += v13 + v14;
  sub_4019C5();
  v15 = a5 - dword_407D1B + v13;
  sub_401769(v22);
  dword_406B08 = v15;
  v17 = v16 + 47 + (v11 ^ 0xFFFFFFC9);
  dword_4084B9 -= v17;
  dword_408335 += dword_406068;
  sub_4016DD(v18);
  dword_4063C3 = v19;
  result = v23 + 2798;
  dword_408F76 -= v21;
  dword_40871C = (unsigned __int8)(v17 - (_DWORD)v24 + (v23 ^ (unsigned __int8)v24 & v19));
  dword_408D68 -= dword_4082EE + 1;
  return result;
}
// 401946: positive sp value 10 has been found
// 40187F: variable 'v10' is possibly undefined
// 401895: variable 'v12' is possibly undefined
// 4018B6: variable 'v14' is possibly undefined
// 4018DC: variable 'v16' is possibly undefined
// 40190A: variable 'v18' is possibly undefined
// 40190F: variable 'v19' is possibly undefined
// 40191E: variable 'v23' is possibly undefined
// 401923: variable 'v21' is possibly undefined
// 4016DD: using guessed type _DWORD __cdecl sub_4016DD(_DWORD);
// 4019C5: using guessed type _DWORD sub_4019C5();
// 406068: using guessed type int dword_406068;
// 4063C3: using guessed type int dword_4063C3;
// 4065A2: using guessed type int dword_4065A2;
// 406A70: using guessed type int dword_406A70;
// 406B08: using guessed type int dword_406B08;
// 406B7D: using guessed type int dword_406B7D;
// 407189: using guessed type int dword_407189;
// 407433: using guessed type int dword_407433;
// 4076F2: using guessed type int dword_4076F2;
// 407D1B: using guessed type int dword_407D1B;
// 407E31: using guessed type int dword_407E31;
// 4082EE: using guessed type int dword_4082EE;
// 408335: using guessed type int dword_408335;
// 408443: using guessed type int dword_408443;
// 4084B9: using guessed type int dword_4084B9;
// 40871C: using guessed type int dword_40871C;
// 408D68: using guessed type int dword_408D68;
// 408D8E: using guessed type int dword_408D8E;
// 408F76: using guessed type int dword_408F76;

//----- (0040196A) --------------------------------------------------------
HANDLE __usercall sub_40196A@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<ebp>)
{
  int v3; // ecx

  v3 = a3 + a2 - 1;
  dword_407308 += v3;
  dword_407707 = v3;
  dword_407433 += a1 - 1 - v3;
  sub_4016CB();
  sub_4016CB();
  sub_4016CB();
  sub_4016CB();
  sub_4016CB();
  sub_4016CB();
  return sub_4016CB();
}
// 407308: using guessed type int dword_407308;
// 407433: using guessed type int dword_407433;
// 407707: using guessed type int dword_407707;

//----- (004019C5) --------------------------------------------------------
#error "401B4E: call analysis failed (funcsize=123)"

// nfuncs=11 queued=11 decompiled=11 lumina nreq=0 worse=0 better=0
#error "There were 2 decompilation failure(s) on 11 function(s)"
