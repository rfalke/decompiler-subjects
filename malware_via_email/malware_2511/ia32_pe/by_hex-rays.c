/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

void sub_40123F();
// void __usercall sub_401AEF(int a1@<eax>, int a2@<ecx>, int a3@<ebp>);
void sub_401C57();
void sub_402576();
// void __usercall sub_4028D0(int a1@<eax>, int a2@<ecx>);
// void __usercall start(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>);
void sub_402D9B();
void sub_4033FD();
void sub_403629();
void sub_404357();
// int __usercall sub_404DC9@<eax>(int a1@<edi>);
unsigned int __fastcall sub_4053A5(int a1, int a2);
// int __usercall sub_4053B4@<eax>(int a1@<eax>);
// int __usercall sub_40586D@<eax>(int a1@<edx>, int a2@<esi>);
// int __usercall sub_405D63@<eax>(int a1@<edx>, int a2@<ebx>, int a3@<esi>);
// int __usercall sub_405E8A@<eax>(int a1@<edi>);
unsigned __int8 __cdecl sub_406317(_BYTE *a1, unsigned int a2, int a3);
// int __userpurge sub_4068A7@<eax>(unsigned int a1@<eax>, int a2@<edx>, int a3@<ecx>, _DWORD *a4@<ebp>, int a5@<edi>, int a6@<esi>, int a7, int a8, int a9);
_BYTE *__cdecl sub_406990(_BYTE *a1, _BYTE *a2);
// int __usercall sub_40699C@<eax>(int a1@<ebp>, int a2@<edi>);
// void __usercall sub_406ABA(unsigned int a1@<ecx>, void *a2@<edi>, const void *a3@<esi>);
unsigned int __cdecl sub_406C65(_BYTE *a1);
// int __usercall sub_406E72@<eax>(_DWORD *a1@<ebp>);
int sub_407410();
// int __userpurge sub_40AC3D@<eax>(int a1@<ebp>, int a2@<edi>, _DWORD *a3@<esi>, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
// BOOL __stdcall CloseHandle(HANDLE hObject);
// HANDLE __stdcall CreateFileA(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// BOOL __stdcall FreeLibrary(HMODULE hLibModule);
// DWORD __stdcall GetCurrentProcessId();
// DWORD __stdcall GetCurrentThreadId();
// DWORD __stdcall GetLastError();
// HANDLE __stdcall GetProcessHeap();
// LONG __stdcall InterlockedExchange(volatile LONG *Target, LONG Value);
// void __stdcall SetLastError(DWORD dwErrCode);
// LONG __stdcall UnhandledExceptionFilter(struct _EXCEPTION_POINTERS *ExceptionInfo);
// int __stdcall lstrcmpiA(LPCSTR lpString1, LPCSTR lpString2);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN unk_41FA83; // weak
_UNKNOWN unk_41FB83; // weak
int dword_437004 = 0; // weak
int dword_437008 = 0; // weak
int dword_43700C = 0; // weak
int dword_437010 = 0; // weak
int dword_437014 = 0; // weak
int dword_437018 = 0; // weak
int dword_43701C = 0; // weak
int dword_437020 = 0; // weak
int dword_437024 = 0; // weak
int dword_437028 = 0; // weak
int dword_43702C = 0; // weak
int dword_437030 = 0; // weak
char byte_437034 = '\0'; // weak
int dword_437038 = 0; // weak
int dword_43703C = 0; // weak
int dword_437040 = 0; // weak
int dword_437044 = 0; // weak
int dword_437048 = 0; // weak
int dword_43704C = 0; // weak
int dword_437068 = 0; // weak
int dword_437070 = 0; // weak
int dword_4371B4 = 0; // weak
int dword_4371D0 = 0; // weak
char byte_437224 = '\0'; // weak
int dword_437284 = 495533120; // weak
int dword_43728C = 1883772297; // weak
int dword_4372F8 = 37644805; // weak
char byte_437318 = '\0'; // weak
int dword_437498 = -371785269; // weak
int dword_43754C = 1132896269; // weak
int dword_4376B0 = -696168369; // weak
int dword_437704 = -2063597568; // weak
int dword_437760 = 50348912; // weak
int dword_4377D4 = -1813085952; // weak
char byte_4377F4 = '\0'; // weak
int dword_437950 = 898301952; // weak
char byte_437978 = 'C'; // weak
char byte_437AFC = '\0'; // weak
int dword_437B48 = -645332925; // weak
int dword_437B84 = -1998741248; // weak
int dword_437BD4 = -136058601; // weak
int dword_437BF4 = -371588864; // weak
int dword_437D40 = -369943; // weak
int dword_4381BC = 4096; // weak
int dword_43824C = 1174405168; // weak
int dword_4382D8 = -1996488668; // weak
int dword_4383B8 = -873921344; // weak
int dword_4383C0 = -33659; // weak
int dword_438488 = 310; // weak
_UNKNOWN dword_43862C; // weak
_UNKNOWN dword_4386D8; // weak
int dword_438700 = 1131418669; // weak
int dword_43871C = 0; // weak
int dword_438720 = 88675123; // weak
int dword_438728 = 521288629; // weak
int dword_43872C = 0; // weak
int (__fastcall *dword_438748)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_438754)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int dword_438758 = 0; // weak
int dword_438768 = 0; // weak
int dword_43876C = 3683; // weak
int (__fastcall *dword_438774)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
_UNKNOWN dword_438778; // weak
int dword_438780 = 97; // weak
int dword_438786 = 0; // weak
int (__fastcall *dword_43878A)(_DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int dword_438792 = 0; // weak
_UNKNOWN unk_438796; // weak
int dword_43879C = 0; // weak
int dword_4387A2 = 1820562157; // weak
int (__thiscall *dword_4387BA)(_DWORD) = NULL; // weak
_UNKNOWN unk_4387CE; // weak
char byte_438840 = '\0'; // weak
int dword_438848 = 0; // weak
int dword_4388A0 = 0; // weak
_UNKNOWN unk_4388D9; // weak
int (__fastcall *dword_4388E1)(_DWORD, _DWORD, _DWORD) = NULL; // weak
int (__thiscall *dword_4388E5)(_DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
__int64 (__fastcall *dword_4388E9)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int dword_4388ED = 362436069; // weak
int dword_438A2C; // weak


//----- (0040123F) --------------------------------------------------------
void sub_40123F()
{
  JUMPOUT(0x403167);
}
// 401A0D: control flows out of bounds to 403167
// 40405C: control flows out of bounds to 402381

//----- (00401AEF) --------------------------------------------------------
void __usercall sub_401AEF(int a1@<eax>, int a2@<ecx>, int a3@<ebp>)
{
  unsigned int v3; // eax
  bool v4; // cf
  int v5; // eax
  unsigned int v6; // eax
  unsigned int v7; // eax

  v3 = 4 * (a1 - *(_DWORD *)(a3 - 448));
  v4 = v3 < 0x4E6;
  v3 -= 1254;
  *(_DWORD *)(a3 - 256) -= v4 + v3;
  v6 = v3 - *(_DWORD *)(a3 - 584);
  *(_DWORD *)(a3 - 120) &= v6;
  v7 = v6 - *(_DWORD *)(a3 - 164);
  if ( (a2 & 0x1182) == 0 && !a2 )
  {
    v5 = (v7 + 176) ^ 0x1B97;
    if ( (v5 & *(_DWORD *)(a3 - 496)) == 0 )
      *(_DWORD *)(a3 - 564) += v5 & 0x3B8F;
  }
  JUMPOUT(0x40228D);
}
// 4024A4: control flows out of bounds to 4018AB
// 402C30: control flows out of bounds to 40228D

//----- (00401C57) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401C57()
{
  DWORD v0; // eax
  unsigned int v1; // edx
  DWORD v2; // eax
  DWORD v3; // eax
  unsigned __int8 v4; // [esp+ECh] [ebp-230h]
  int v5; // [esp+114h] [ebp-208h]
  int v6; // [esp+134h] [ebp-1E8h]
  int v7; // [esp+138h] [ebp-1E4h]
  unsigned int v8; // [esp+150h] [ebp-1CCh]
  unsigned int v9; // [esp+188h] [ebp-194h]
  int v10; // [esp+1A4h] [ebp-178h]

  v0 = (GetCurrentProcessId() & 0xDC) - 8089;
  v2 = v0 - 3837;
  if ( v9 > v1
    || (v3 = v2 + 3739,
        v8 == v1
     && (((v8 < v1) + v3 + 13397 - ((__CFADD__(v8 < v1, v3) | __CFADD__((v8 < v1) + v3, 13397)) + 5583)) & v10 & 0x80000000) == 0
     && v1 != v5
     && v7 == v4 - v6) )
  {
    JUMPOUT(0x402F25);
  }
  GetCurrentThreadId();
  JUMPOUT(0x4012C6);
}
// 401E9E: positive sp value 264 has been found
// 402C8A: control flows out of bounds to 4012C6
// 403CB5: control flows out of bounds to 402F25
// 401E29: variable 'v8' is possibly undefined
// 401E29: variable 'v1' is possibly undefined
// 401E39: variable 'v10' is possibly undefined
// 401E60: variable 'v5' is possibly undefined
// 403384: variable 'v9' is possibly undefined
// 404579: variable 'v7' is possibly undefined
// 401E53: variable 'v4' is possibly undefined
// 401E66: variable 'v6' is possibly undefined

//----- (00402576) --------------------------------------------------------
void sub_402576()
{
  sub_401C57();
  JUMPOUT(0x401709);
}
// 4035FF: control flows out of bounds to 401709

//----- (004028D0) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
void __usercall sub_4028D0(int a1@<eax>, int a2@<ecx>)
{
  int savedregs; // [esp+0h] [ebp+0h] BYREF

  sub_401AEF(a1, a2, (int)&savedregs);
}
// 4028D3: bad sp value at call

//----- (00402A70) --------------------------------------------------------
void __usercall start(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>)
{
  int savedregs; // [esp+198h] [ebp+0h] BYREF

  unk_438796 = a3;
  unk_4388D9 = a5;
  dword_438758 = a4;
  LOBYTE(dword_437018) = dword_437018 - 114;
  dword_438792 = a1;
  *(int *)((char *)&dword_43879C + 2) = a2;
  dword_438768 = (int)&savedregs;
  sub_401C57();
  JUMPOUT(0x401662);
}
// 403FDF: control flows out of bounds to 401662
// 437018: using guessed type int dword_437018;
// 438758: using guessed type int dword_438758;
// 438768: using guessed type int dword_438768;
// 438792: using guessed type int dword_438792;
// 43879C: using guessed type int dword_43879C;

//----- (00402D9B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402D9B()
{
  sub_402576();
  JUMPOUT(0x401752);
}
// 406DFD: positive sp value 220 has been found
// 4044B0: control flows out of bounds to 401752

//----- (004033FD) --------------------------------------------------------
void sub_4033FD()
{
  JUMPOUT(0x402F18);
}
// 40340F: control flows out of bounds to 402F18
// 4029FD: control flows out of bounds to 406BC7

//----- (00403629) --------------------------------------------------------
void sub_403629()
{
  sub_4033FD();
}

//----- (00404357) --------------------------------------------------------
void sub_404357()
{
  sub_402576();
  sub_401C57();
  JUMPOUT(0x401567);
}
// 404234: control flows out of bounds to 401567

//----- (00404DC9) --------------------------------------------------------
int __usercall sub_404DC9@<eax>(int a1@<edi>)
{
  int savedregs; // [esp+18h] [ebp+0h] BYREF

  return sub_40699C((int)&savedregs, a1);
}

//----- (004053A5) --------------------------------------------------------
unsigned int __fastcall sub_4053A5(int a1, int a2)
{
  unsigned int result; // eax
  unsigned int retaddr; // [esp+0h] [ebp+0h]

  dword_437030 -= 24915;
  dword_4387A2 ^= a2 + 615;
  result = retaddr & 0xFFFF0000;
  dword_438786 = retaddr & 0xFFFF0000;
  return result;
}
// 437030: using guessed type int dword_437030;
// 438786: using guessed type int dword_438786;
// 4387A2: using guessed type int dword_4387A2;

//----- (004053B4) --------------------------------------------------------
int __usercall sub_4053B4@<eax>(int a1@<eax>)
{
  int v1; // edi
  int v2; // ett
  int v3; // ecx
  int v4; // edi
  int v5; // ecx
  int v6; // edx
  int v7; // ecx
  _BYTE *v8; // edi
  int v9; // ebx
  char v10; // al
  int v11; // edx
  int v12; // ebx
  _BYTE *v13; // esi
  unsigned int v14; // esi
  int v15; // ecx
  int v16; // edx
  int v17; // ebx
  int v18; // esi
  int result; // eax
  unsigned int v20; // ecx
  int v21; // esi
  __int16 v22; // bx
  int v23; // edx
  int v24; // ecx
  __int16 v25; // ax
  bool v26; // cf
  unsigned int v27; // esi
  int v28; // edx
  char *v29; // ebx
  int v30; // eax
  _BYTE *v31; // edi
  int v32; // ebx
  int v33; // ecx
  int v34; // ecx
  int v35; // esi
  _BYTE *v36; // edi
  int v37; // ecx
  __int16 v38; // bx
  __int16 v39; // bx
  int v40; // ebx
  int v41; // esi
  int v42; // edx
  int v43; // esi
  int v44; // edx
  __int16 v45; // dx
  int v46; // eax
  __int64 v47; // rax
  int v48; // [esp-8h] [ebp-8h]
  int v49; // [esp-4h] [ebp-4h]

  LOBYTE(dword_437020) = -61;
  v14 = a1;
  v15 = 0x2000;
  dword_437028 = a1;
  v8 = &unk_41FB83;
  byte_437034 = -88;
  do
  {
    v49 = v15;
    v17 = dword_4377D4;
    v25 = sub_405D63(v15, dword_4377D4, v14);
    v26 = v14 < (unsigned int)v8;
    v27 = v14 - (_DWORD)v8;
    *v8++ = v25;
    HIWORD(v16) = HIWORD(dword_43754C);
    v14 = v26 + v27 + 12451;
    BYTE1(v16) = 15;
    BYTE1(v17) += HIBYTE(v25);
    v15 = v49 - 1;
  }
  while ( v49 != 1 );
  dword_43701C = 28975;
  dword_43704C = dword_4371B4 + v17;
  v41 = __CFADD__((unsigned int)dword_4371B4 | 0x1BDE00000000i64, (unsigned int)v17) + v14 + 2261;
  LOBYTE(v16) = dword_43754C ^ 0x40;
  dword_43878A(
    (((unsigned int)dword_4371B4 | 0x1BDE00000000i64) + (unsigned __int64)(unsigned int)v17) >> 32,
    v16,
    255,
    &unk_41FA83);
  dword_437024 = 30411;
  v26 = __CFADD__((_BYTE)dword_43704C, -101);
  LOBYTE(dword_43704C) = dword_43704C - 101;
  v43 = v26 + v41 + 32219;
  LOBYTE(dword_437008) = dword_437008 - 81;
  dword_438774(
    dword_4386D8,
    (unsigned int)(v42 - dword_437B48 - dword_437704) >> 3,
    &unk_41FA83,
    &dword_438780,
    0,
    &unk_4387CE);
  LOBYTE(dword_437008) = 39;
  v46 = dword_4388E9(
          &FreeLibrary,
          v26
        + v44
        + 13835
        - ((__CFADD__((unsigned int)&CloseHandle < 0x4286, v26 + v44 + 13835) | __CFADD__(
                                                                                  ((unsigned int)&CloseHandle < 0x4286)
                                                                                + v26
                                                                                + v44
                                                                                + 13835,
                                                                                  10969))
         + v43
         - ((unsigned int)(__CFADD__(v26, v44) | __CFADD__(v26 + v44, 13835))
          + 15462)),
          &unk_4387CE,
          -1073741824,
          1,
          0,
          2,
          32,
          0);
  dword_437030 -= 22558;
  dword_437020 += 21871;
  LOBYTE(dword_437020) = -86;
  LOBYTE(dword_437010) = dword_437010 - 18;
  dword_437048 += ((_WORD)v46 + 14205) & 0x4572;
  dword_438754(v46, &unk_41FB83, 0x2000, &dword_438748, 0, v46);
  dword_4387BA(v34 - dword_4372F8);
  v11 = 1;
  dword_43703C += 10801;
  v33 = 0x2000;
  v31 = &unk_41FB83;
  v32 = 1;
  do
  {
    v9 = v32 - dword_437760;
    v48 = v33;
    v10 = sub_405D63(v11, v9, (int)&SetLastError);
    v12 = v9 - v11;
    dword_437020 = (int)&SetLastError;
    *v31++ = v10;
    BYTE1(v12) ^= 0xF1u;
    v32 = v12 + 2053;
    v33 = v48 - 1;
  }
  while ( v48 != 1 );
  dword_437024 -= (int)&SetLastError;
  LOBYTE(dword_43704C) = -113;
  dword_43702C += v32;
  HIBYTE(v45) = 0;
  LOBYTE(v45) = byte_437978;
  v38 = v45;
  result = sub_404DC9((int)&v31[-__CFADD__(dword_438A2C, 3739) - 24274]);
  v39 = v38 - dword_4371D0;
  if ( result )
  {
    dword_438748 = (int (__fastcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))result;
    v22 = v39 + 20660;
    result = sub_404DC9(29167);
    LOBYTE(v23) = 61;
    dword_437030 = dword_437D40;
    if ( result )
    {
      dword_4388E5 = (int (__thiscall *)(_DWORD, _DWORD, _DWORD, _DWORD))result;
      dword_43700C = v23;
      dword_437008 = 29042;
      v18 = dword_438848 + 29042;
      result = dword_438748(
                 24185,
                 (__CFADD__((unsigned __int8)((unsigned __int16)(v22 - 4655) >> 8) < (unsigned __int8)byte_437318, v23) | __CFADD__(((unsigned __int8)((unsigned __int16)(v22 - 4655) >> 8) < (unsigned __int8)byte_437318) + v23, 25128))
               + ((unsigned __int8)((unsigned __int16)(v22 - 4655) >> 8) < (unsigned __int8)byte_437318)
               + v23
               + 25128
               + 3319,
                 0,
                 0x2000,
                 12288,
                 64);
      v21 = v18 - 15796;
      if ( result )
      {
        BYTE1(v20) += byte_438840;
        dword_438778 = result;
        dword_437014 -= (int)&CreateFileA;
        LOBYTE(dword_437018) = -97;
        v24 = (__PAIR64__(v20, &CreateFileA) + ((unsigned int)dword_437004 | 0x68ED00000000i64)) >> 32;
        dword_43702C -= (int)&CreateFileA;
        BYTE1(v24) += result;
        dword_437004 += (int)&CreateFileA + v24;
        v47 = dword_4388E9(v24, dword_43862C, &unk_4387CE, -1073741824, 1, 0, 3, 0, 0);
        dword_437004 = 26469;
        dword_437030 += v21;
        v2 = (((unsigned int)dword_437024 | 0x71CF00000000ui64) + 10091) >> 32;
        dword_437024 += 10091;
        v1 = dword_437284 - v2;
        dword_437008 = 11510;
        dword_437020 -= 441;
        (*(void (__fastcall **)(unsigned int, int, _DWORD, int, int, void *, _DWORD, _DWORD))((char *)&dword_438780 + 2))(
          (unsigned int)&lstrcmpiA & 0x3C54,
          HIDWORD(v47) - dword_437BD4,
          v47,
          dword_438778,
          0x2000,
          &unk_41FA83,
          0,
          v47);
        dword_437024 += 11510;
        dword_4387BA(v3);
        v4 = dword_4381BC + v1;
        dword_4388E1(v5 - dword_4382D8, dword_43824C + v6, &unk_4387CE);
        dword_43702C += v4;
        v7 = 0x2000;
        dword_437010 += dword_4376B0;
        v13 = (_BYTE *)dword_438778;
        v28 = 0;
        v29 = (char *)&InterlockedExchange + 18429;
        v30 = 0;
        do
        {
          BYTE1(v29) = byte_4377F4;
          dword_43704C = (int)v29;
          LOBYTE(v30) = *v13++;
          v40 = (int)&v29[dword_4383B8];
          v28 += v30;
          dword_437014 += v40;
          v30 = 0;
          dword_437004 = v40;
          v29 = (char *)(dword_4388A0 + v40);
          --v7;
        }
        while ( v7 );
        dword_43871C = v28;
        dword_437030 = v28;
        dword_4388E5(16872, dword_438778, 0, 0x8000);
        result = 0;
        v37 = 0x2000;
        dword_437028 += 5496;
        LOBYTE(dword_437008) = -123;
        v36 = &unk_41FB83;
        v35 = (_DWORD)&GetCurrentThreadId << 6;
        do
        {
          v35 += dword_438488;
          *v36++ = 0;
          --v37;
        }
        while ( v37 );
        dword_437018 = (int)&UnhandledExceptionFilter;
      }
    }
  }
  return result;
}
// 406DA8: conditional instruction was optimized away because of '%0x18.4==1'
// 4052A2: variable 'v11' is possibly undefined
// 4054B3: variable 'v23' is possibly undefined
// 4055A2: variable 'v20' is possibly undefined
// 40493A: variable 'v3' is possibly undefined
// 40494B: variable 'v5' is possibly undefined
// 404951: variable 'v6' is possibly undefined
// 406A1C: variable 'v42' is possibly undefined
// 406A82: variable 'v26' is possibly undefined
// 406A82: variable 'v44' is possibly undefined
// 405E0E: variable 'v34' is possibly undefined
// 437004: using guessed type int dword_437004;
// 437008: using guessed type int dword_437008;
// 43700C: using guessed type int dword_43700C;
// 437010: using guessed type int dword_437010;
// 437014: using guessed type int dword_437014;
// 437018: using guessed type int dword_437018;
// 43701C: using guessed type int dword_43701C;
// 437020: using guessed type int dword_437020;
// 437024: using guessed type int dword_437024;
// 437028: using guessed type int dword_437028;
// 43702C: using guessed type int dword_43702C;
// 437030: using guessed type int dword_437030;
// 437034: using guessed type char byte_437034;
// 43703C: using guessed type int dword_43703C;
// 437048: using guessed type int dword_437048;
// 43704C: using guessed type int dword_43704C;
// 4371B4: using guessed type int dword_4371B4;
// 4371D0: using guessed type int dword_4371D0;
// 437284: using guessed type int dword_437284;
// 4372F8: using guessed type int dword_4372F8;
// 437318: using guessed type char byte_437318;
// 43754C: using guessed type int dword_43754C;
// 4376B0: using guessed type int dword_4376B0;
// 437704: using guessed type int dword_437704;
// 437760: using guessed type int dword_437760;
// 4377D4: using guessed type int dword_4377D4;
// 4377F4: using guessed type char byte_4377F4;
// 437978: using guessed type char byte_437978;
// 437B48: using guessed type int dword_437B48;
// 437BD4: using guessed type int dword_437BD4;
// 437D40: using guessed type int dword_437D40;
// 4381BC: using guessed type int dword_4381BC;
// 43824C: using guessed type int dword_43824C;
// 438274: using guessed type int dword_438274;
// 4382D8: using guessed type int dword_4382D8;
// 4383B8: using guessed type int dword_4383B8;
// 438488: using guessed type int dword_438488;
// 43862C: using guessed type int dword_43862C;
// 4386D8: using guessed type int dword_4386D8;
// 43871C: using guessed type int dword_43871C;
// 438748: using guessed type int (__fastcall *dword_438748)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 438754: using guessed type int (__stdcall *dword_438754)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 438774: using guessed type int (__fastcall *dword_438774)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 438778: using guessed type int dword_438778;
// 438780: using guessed type int dword_438780;
// 438782: using guessed type int (__fastcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 43878A: using guessed type int (__fastcall *dword_43878A)(_DWORD, _DWORD, _DWORD, _DWORD);
// 43879C: using guessed type int dword_43879C;
// 4387BA: using guessed type int (__thiscall *dword_4387BA)(_DWORD);
// 438840: using guessed type char byte_438840;
// 438848: using guessed type int dword_438848;
// 4388A0: using guessed type int dword_4388A0;
// 4388CD: using guessed type int dword_4388CD;
// 4388E1: using guessed type int (__fastcall *dword_4388E1)(_DWORD, _DWORD, _DWORD);
// 4388E5: using guessed type int (__thiscall *dword_4388E5)(_DWORD, _DWORD, _DWORD, _DWORD);
// 4388E9: using guessed type __int64 (__fastcall *dword_4388E9)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 438A2C: using guessed type int dword_438A2C;

//----- (0040586D) --------------------------------------------------------
int __usercall sub_40586D@<eax>(int a1@<edx>, int a2@<esi>)
{
  int v2; // edx
  int v3; // esi
  int result; // eax
  int v6; // esi
  int v7; // edi
  int v8; // eax
  int v9; // ebx
  int v10; // edx
  int v11; // eax
  BOOL v12; // ett
  int v13; // edi
  int v14; // esi
  int v15; // edi
  int v16; // edi
  bool v17; // cf
  int v18; // edi
  int v19; // edx

  v3 = a2 - dword_43728C;
  result = sub_404DC9(a1);
  v6 = v3 - dword_4383C0;
  if ( result )
  {
    dword_437008 -= a1;
    dword_438774 = (int (__fastcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))result;
    v7 = 8 * a1;
    dword_43702C = 31040;
    result = sub_404DC9(v7);
    v14 = v6 - dword_437950;
    if ( result )
    {
      dword_437044 = v14;
      v15 = v7 - 1;
      dword_43878A = (int (__fastcall *)(_DWORD, _DWORD, _DWORD, _DWORD))result;
      LOBYTE(dword_43702C) = dword_43702C - 84;
      result = sub_404DC9(v15);
      LOBYTE(dword_43700C) = -115;
      v18 = v15 - dword_437068;
      LOBYTE(dword_43702C) = dword_43702C - 26;
      if ( result )
      {
        dword_4388E9 = (__int64 (__fastcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))result;
        result = sub_404DC9(v18 - 1);
        v13 = dword_438700;
        if ( result )
        {
          LOBYTE(dword_437018) = dword_437018 + 47;
          dword_4387BA = (int (__thiscall *)(_DWORD))result;
          dword_437038 += 4658;
          dword_437040 += v19;
          result = sub_404DC9(dword_438700);
          dword_43700C = -2114916129;
          if ( result )
          {
            dword_4388E1 = (int (__fastcall *)(_DWORD, _DWORD, _DWORD))result;
            v16 = v13 - 21638;
            v17 = dword_43703C < (unsigned int)dword_437070;
            dword_43703C -= dword_437070;
            result = sub_404DC9(v16 - (v17 + 26012));
            dword_437008 -= v2;
            if ( result )
            {
              *(int *)((char *)&dword_438780 + 2) = result;
              dword_437048 = v2;
              result = sub_404DC9(20190);
              if ( result )
              {
                dword_438754 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))result;
                dword_43704C -= result;
                v8 = sub_4053B4(result);
                v9 = 1010362448 - (v17 + 11598);
                v12 = (unsigned int)v17 + 11598 > 0x3C38E850;
                v17 = __CFADD__(v12, v8);
                v11 = v12 + v8;
                dword_437018 += v10 + v11;
                dword_437028 -= (__PAIR64__(v9, &SetLastError)
                               - (((unsigned int)(v17 | __CFADD__(v10, v11)) + 13487) | 0x61E000000000i64)) >> 32;
                __asm { retn }
              }
            }
          }
        }
      }
    }
  }
  return result;
}
// 404B01: variable 'v2' is possibly undefined
// 4056EA: variable 'v17' is possibly undefined
// 4056F0: variable 'v10' is possibly undefined
// 406930: variable 'v19' is possibly undefined
// 437008: using guessed type int dword_437008;
// 43700C: using guessed type int dword_43700C;
// 437018: using guessed type int dword_437018;
// 437028: using guessed type int dword_437028;
// 43702C: using guessed type int dword_43702C;
// 437038: using guessed type int dword_437038;
// 43703C: using guessed type int dword_43703C;
// 437040: using guessed type int dword_437040;
// 437044: using guessed type int dword_437044;
// 437048: using guessed type int dword_437048;
// 43704C: using guessed type int dword_43704C;
// 437068: using guessed type int dword_437068;
// 437070: using guessed type int dword_437070;
// 43728C: using guessed type int dword_43728C;
// 437950: using guessed type int dword_437950;
// 4383C0: using guessed type int dword_4383C0;
// 438700: using guessed type int dword_438700;
// 43871C: using guessed type int dword_43871C;
// 438754: using guessed type int (__stdcall *dword_438754)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 438774: using guessed type int (__fastcall *dword_438774)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 438780: using guessed type int dword_438780;
// 438782: using guessed type int (__fastcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 438786: using guessed type int dword_438786;
// 43878A: using guessed type int (__fastcall *dword_43878A)(_DWORD, _DWORD, _DWORD, _DWORD);
// 4387BA: using guessed type int (__thiscall *dword_4387BA)(_DWORD);
// 4388E1: using guessed type int (__fastcall *dword_4388E1)(_DWORD, _DWORD, _DWORD);
// 4388E9: using guessed type __int64 (__fastcall *dword_4388E9)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00405D63) --------------------------------------------------------
int __usercall sub_405D63@<eax>(int a1@<edx>, int a2@<ebx>, int a3@<esi>)
{
  unsigned int v3; // eax
  unsigned int v4; // ebx
  int v5; // ebx
  int result; // eax
  int v7; // ebx

  v4 = a2 - dword_437498;
  dword_437038 += a3;
  dword_437018 = v4;
  BYTE1(v4) = byte_437AFC;
  dword_437008 = (v4 >> 6) - a1;
  v3 = dword_43876C ^ (dword_43876C << 11);
  dword_43876C = dword_4388ED;
  dword_4388ED = dword_438728;
  dword_437004 -= 9138;
  dword_438728 = dword_438720;
  v5 = dword_437B84 ^ 0x39D8;
  BYTE1(v5) = dword_438720 ^ ((unsigned __int16)(dword_437B84 ^ 0x39D8) >> 8);
  dword_437028 = v5;
  dword_437030 = v5;
  dword_438720 ^= (v3 >> 8) ^ v3 ^ ((unsigned int)dword_438720 >> 19);
  dword_43872C = dword_438720;
  result = dword_438720;
  v7 = 4417;
  dword_437014 = 28186;
  BYTE1(v7) = BYTE1(dword_438720);
  dword_43703C = v7;
  return result;
}
// 437004: using guessed type int dword_437004;
// 437008: using guessed type int dword_437008;
// 437014: using guessed type int dword_437014;
// 437018: using guessed type int dword_437018;
// 437028: using guessed type int dword_437028;
// 437030: using guessed type int dword_437030;
// 437038: using guessed type int dword_437038;
// 43703C: using guessed type int dword_43703C;
// 437498: using guessed type int dword_437498;
// 437AFC: using guessed type char byte_437AFC;
// 437B84: using guessed type int dword_437B84;
// 438720: using guessed type int dword_438720;
// 438728: using guessed type int dword_438728;
// 43872C: using guessed type int dword_43872C;
// 43876C: using guessed type int dword_43876C;
// 4388ED: using guessed type int dword_4388ED;

//----- (00405E8A) --------------------------------------------------------
int __usercall sub_405E8A@<eax>(int a1@<edi>)
{
  _DWORD *v1; // edx
  int v2; // ebx
  int v3; // ecx
  int result; // eax
  HANDLE (__stdcall **v5)(); // eax
  int v6; // eax
  struct _PEB *v7; // edx
  int v8; // ecx
  unsigned __int8 *v9; // esi
  int v10; // edi
  int v11; // [esp+0h] [ebp-8h]

  v5 = &GetProcessHeap;
  dword_43700C += a1;
  BYTE1(v5) = byte_437224;
  v7 = NtCurrentPeb();
  dword_437010 -= (int)v5;
  v1 = (_DWORD *)*((_DWORD *)v7->ImageBaseAddress + 5);
  do
  {
    v9 = (unsigned __int8 *)v1[10];
    v8 = 24;
    v10 = 0;
    do
    {
      dword_437038 = 31727;
      v6 = *v9++;
      if ( (char)v6 >= 97 )
      {
        dword_437010 += 23809;
        dword_437040 += (int)&GetLastError;
        LOBYTE(v6) = v6 - 32;
      }
      v10 = v6 + __ROR4__(v10, 13);
      --v8;
    }
    while ( v8 );
    v2 = v1[4];
    v3 = dword_437BF4;
    v1 = (_DWORD *)*v1;
    dword_437010 = (_DWORD)v9 << 6;
    BYTE1(v3) = -63;
    dword_437038 = v3;
  }
  while ( v10 != 1783282779 );
  dword_437040 = 1901;
  result = v2;
  dword_437048 = (int)v1 + 6858;
  dword_43701C += v11 ^ 0x75C9;
  return result;
}
// 406C9A: variable 'v11' is possibly undefined
// 43700C: using guessed type int dword_43700C;
// 437010: using guessed type int dword_437010;
// 43701C: using guessed type int dword_43701C;
// 437038: using guessed type int dword_437038;
// 437040: using guessed type int dword_437040;
// 437048: using guessed type int dword_437048;
// 437224: using guessed type char byte_437224;
// 437BF4: using guessed type int dword_437BF4;

//----- (00406317) --------------------------------------------------------
unsigned __int8 __cdecl sub_406317(_BYTE *a1, unsigned int a2, int a3)
{
  unsigned __int8 result; // al
  unsigned __int8 v4; // bl
  _BYTE *i; // [esp+4h] [ebp-Ch]
  unsigned int v6; // [esp+8h] [ebp-8h]
  unsigned __int8 v7; // [esp+Fh] [ebp-1h]

  v4 = *(_BYTE *)(a3 + 256);
  v7 = *(_BYTE *)(a3 + 257);
  v6 = 0;
  for ( i = a1; v6 < a2; ++i )
  {
    v7 += *(_BYTE *)(a3 + ++v4);
    sub_406990((_BYTE *)(a3 + v4), (_BYTE *)(a3 + v7));
    *i ^= *(_BYTE *)(a3 + (unsigned __int8)(*(_BYTE *)(a3 + v7) + *(_BYTE *)(a3 + v4)));
    ++v6;
  }
  *(_BYTE *)(a3 + 256) = v4;
  result = v7;
  *(_BYTE *)(a3 + 257) = v7;
  return result;
}

//----- (004068A7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __userpurge sub_4068A7@<eax>(unsigned int a1@<eax>, int a2@<edx>, int a3@<ecx>, _DWORD *a4@<ebp>, int a5@<edi>, int a6@<esi>, int a7, int a8, int a9)
{
  unsigned int v9; // ecx
  unsigned int v10; // ebx
  unsigned int v11; // esi
  int v12; // ecx
  int v13; // edx
  bool v14; // cc
  int v15; // ecx
  unsigned int *v16; // edi
  int v17; // esi
  unsigned int *v18; // edi
  int v19; // edx
  unsigned int v20; // eax
  int v21; // edx
  unsigned int *v22; // edx
  int v23; // edi
  int v24; // edi
  int v25; // ecx
  int v26; // ecx
  unsigned int v27; // ecx
  unsigned int v28; // esi
  int v29; // ecx
  unsigned int v30; // eax
  int v31; // ecx
  char *v32; // ecx
  char v33; // dl
  int v34; // edx
  unsigned int v35; // eax
  int v36; // ecx
  int v37; // ecx
  int v38; // ebx
  int v39; // edi
  int v40; // ebx
  unsigned int v41; // edx
  int v42; // ecx
  unsigned int v43; // edx
  unsigned int v44; // edi
  unsigned int v45; // edi
  unsigned int v46; // ecx
  int v47; // esi
  int v48; // ecx
  int v49; // edx
  int v50; // edx
  unsigned int v51; // ebx
  int v52; // ecx
  unsigned int v53; // ecx
  unsigned int v54; // edi
  int v56; // ecx
  unsigned int v57; // ecx
  unsigned int v58; // edi
  unsigned int v59; // edi
  int v60; // esi
  bool v61; // sf
  bool v62; // of
  int v63; // edx
  int v64; // ecx
  unsigned int v65; // eax
  unsigned int *v66; // edi
  int v67; // ecx
  unsigned int v68; // ecx
  unsigned int v69; // esi
  int v70; // ecx
  unsigned int v71; // eax
  unsigned int *v72; // edx
  bool v73; // zf
  int v74; // esi
  int v75; // edi
  int v76; // ebx
  unsigned int v77; // edi
  unsigned int v78; // edi
  bool v79; // cc
  unsigned int v80; // esi
  unsigned int *v81; // ecx
  int v82; // edx
  unsigned int v83; // edx
  int v84; // edx
  unsigned int v85; // eax
  unsigned int *v86; // edx
  int v87; // ecx
  int v88; // esi
  unsigned int *v89; // ecx
  int v90; // edi
  int v91; // ebx
  int v92; // edx
  unsigned int v93; // eax
  unsigned int *v94; // edi
  int v95; // ecx
  unsigned int v96; // edx
  unsigned int v97; // edx
  unsigned int v98; // edi
  int v99; // ecx
  int v100; // ecx
  unsigned int v101; // ecx
  unsigned int v102; // edi
  unsigned int v103; // esi
  unsigned int v104; // ecx
  unsigned int v105; // edx
  unsigned int v106; // ecx

LABEL_1:
  a1 <<= 8;
  ++*(a4 - 2);
  a4[3] = a6 | (a3 << 8);
  while ( 1 )
  {
    v68 = *(_DWORD *)(a5 + 4 * a2);
    v69 = v68 * (a1 >> 11);
    if ( a4[3] >= v69 )
    {
      a4[3] -= v69;
      a1 -= v69;
      *(_DWORD *)(a5 + 4 * a2) = v68 - (v68 >> 5);
      a2 = 2 * a2 + 1;
    }
    else
    {
      a1 = v68 * (a1 >> 11);
      *(_DWORD *)(a5 + 4 * a2) = v68 + ((2048 - v68) >> 5);
      a2 *= 2;
    }
    v73 = (*(a4 - 11))-- == 1;
    if ( v73 )
      break;
LABEL_33:
    if ( a1 < 0x1000000 )
    {
      a3 = a4[3];
      a6 = *(unsigned __int8 *)*(a4 - 2);
      goto LABEL_1;
    }
  }
  v92 = a2 - 64;
  v39 = v92;
  if ( v92 >= 4 )
  {
    v70 = (v92 >> 1) - 1;
    v24 = v92 & 1 | 2;
    *(a4 - 5) = v70;
    if ( v92 >= 14 )
    {
      v37 = (v92 >> 1) - 5;
      do
      {
        if ( a1 < 0x1000000 )
        {
          v19 = *(unsigned __int8 *)*(a4 - 2) | (a4[3] << 8);
          a1 <<= 8;
          ++*(a4 - 2);
          a4[3] = v19;
        }
        a1 >>= 1;
        v24 *= 2;
        if ( a4[3] >= a1 )
        {
          a4[3] -= a1;
          v24 |= 1u;
        }
        --v37;
      }
      while ( v37 );
      v38 = a4[4] + 3208;
      v39 = 16 * v24;
      *(a4 - 5) = 4;
    }
    else
    {
      v39 = v24 << v70;
      v38 = a4[4] + 4 * (v39 - v92) + 2748;
    }
    v31 = 1;
    *(a4 - 8) = v38;
    *(a4 - 9) = 1;
    do
    {
      if ( a1 < 0x1000000 )
      {
        v49 = *(unsigned __int8 *)*(a4 - 2) | (a4[3] << 8);
        a1 <<= 8;
        ++*(a4 - 2);
        a4[3] = v49;
      }
      v83 = *(_DWORD *)(v38 + 4 * v31);
      v103 = v83 * (a1 >> 11);
      if ( a4[3] >= v103 )
      {
        a4[3] -= v103;
        v38 = *(a4 - 8);
        a1 -= v103;
        v39 |= *(a4 - 9);
        *(_DWORD *)(v38 + 4 * v31) = v83 - (v83 >> 5);
        v31 = 2 * v31 + 1;
      }
      else
      {
        a1 = v83 * (a1 >> 11);
        *(_DWORD *)(v38 + 4 * v31) = v83 + ((2048 - v83) >> 5);
        v31 *= 2;
      }
      *(a4 - 9) *= 2;
      v73 = (*(a4 - 5))-- == 1;
    }
    while ( !v73 );
  }
  v90 = v39 + 1;
  *(a4 - 5) = v90;
  if ( v90 )
  {
    v91 = *(a4 - 12);
    while ( 2 )
    {
      v76 = v91 + 2;
      v32 = (char *)(a4[2] + *(a4 - 4) - v90);
      do
      {
        v33 = *v32;
        v74 = *(a4 - 4);
        v75 = a4[2];
        --v76;
        ++*(a4 - 4);
        ++v32;
        *((_BYTE *)a4 - 1) = v33;
        *(_BYTE *)(v74 + v75) = v33;
      }
      while ( v76 );
      while ( 1 )
      {
        while ( 1 )
        {
          v17 = *(a4 - 4) & 3;
          v18 = (unsigned int *)(a4[4] + 4 * (v17 + 16 * *(a4 - 3)));
          if ( a1 < 0x1000000 )
          {
            v36 = *(unsigned __int8 *)*(a4 - 2) | (a4[3] << 8);
            a1 <<= 8;
            ++*(a4 - 2);
            a4[3] = v36;
          }
          v9 = *v18;
          v10 = *v18 * (a1 >> 11);
          if ( a4[3] >= v10 )
            break;
          v11 = v9 + ((2048 - v9) >> 5);
          v12 = 3072 * *((unsigned __int8 *)a4 - 1);
          *v18 = v11;
          v13 = 1;
          v14 = *(a4 - 3) < 7;
          v15 = v12 + a4[4] + 7384;
          a1 = v10;
          *(a4 - 8) = v15;
          if ( !v14 )
          {
            *(a4 - 9) = *(unsigned __int8 *)(*(a4 - 4) - *(a4 - 5) + a4[2]);
            while ( 1 )
            {
              *(a4 - 9) *= 2;
              v88 = *(a4 - 9) & 0x100;
              v89 = (unsigned int *)(*(a4 - 8) + 4 * (v88 + v13) + 1024);
              *(a4 - 11) = v89;
              if ( a1 < 0x1000000 )
              {
                v23 = *(unsigned __int8 *)*(a4 - 2) | (a4[3] << 8);
                a1 <<= 8;
                ++*(a4 - 2);
                a4[3] = v23;
              }
              v53 = *v89;
              v54 = v53 * (a1 >> 11);
              if ( a4[3] >= v54 )
              {
                a4[3] -= v54;
                a1 -= v54;
                *(_DWORD *)*(a4 - 11) = v53 - (v53 >> 5);
                v13 = 2 * v13 + 1;
                if ( !v88 )
                  goto LABEL_98;
              }
              else
              {
                a1 = v53 * (a1 >> 11);
                v13 *= 2;
                *(_DWORD *)*(a4 - 11) = v53 + ((2048 - v53) >> 5);
                if ( v88 )
                  goto LABEL_98;
              }
              if ( v13 >= 256 )
                goto LABEL_46;
            }
          }
          do
          {
            v16 = (unsigned int *)(*(a4 - 8) + 4 * v13);
            if ( a1 < 0x1000000 )
            {
              v26 = *(unsigned __int8 *)*(a4 - 2) | (a4[3] << 8);
              a1 <<= 8;
              ++*(a4 - 2);
              a4[3] = v26;
            }
            v27 = *v16;
            v28 = *v16 * (a1 >> 11);
            if ( a4[3] >= v28 )
            {
              a4[3] -= v28;
              a1 -= v28;
              *v16 = v27 - (v27 >> 5);
              v13 = 2 * v13 + 1;
            }
            else
            {
              a1 = *v16 * (a1 >> 11);
              *v16 = v27 + ((2048 - v27) >> 5);
              v13 *= 2;
            }
LABEL_98:
            ;
          }
          while ( v13 < 256 );
LABEL_46:
          v47 = *(a4 - 4);
          v48 = a4[2];
          ++*(a4 - 4);
          v14 = *(a4 - 3) < 4;
          *((_BYTE *)a4 - 1) = v13;
          *(_BYTE *)(v47 + v48) = v13;
          if ( v14 )
          {
            *(a4 - 3) = 0;
          }
          else if ( (int)*(a4 - 3) >= 10 )
          {
            *(a4 - 3) -= 6;
          }
          else
          {
            *(a4 - 3) -= 3;
          }
        }
        a4[3] -= v10;
        v84 = *(a4 - 3);
        v85 = a1 - v10;
        *v18 = v9 - (v9 >> 5);
        v86 = (unsigned int *)(a4[4] + 4 * v84 + 768);
        if ( v85 < 0x1000000 )
        {
          v29 = *(unsigned __int8 *)*(a4 - 2) | (a4[3] << 8);
          v85 <<= 8;
          ++*(a4 - 2);
          a4[3] = v29;
        }
        v46 = *v86;
        v77 = v46 * (v85 >> 11);
        if ( a4[3] < v77 )
          break;
        a4[3] -= v77;
        v93 = v85 - v77;
        *v86 = v46 - (v46 >> 5);
        v94 = (unsigned int *)(a4[4] + 4 * *(a4 - 3) + 816);
        if ( v93 < 0x1000000 )
        {
          v95 = *(unsigned __int8 *)*(a4 - 2) | (a4[3] << 8);
          v93 <<= 8;
          ++*(a4 - 2);
          a4[3] = v95;
        }
        v106 = *v94;
        v97 = *v94 * (v93 >> 11);
        if ( a4[3] >= v97 )
        {
          a4[3] -= v97;
          v20 = v93 - v97;
          v21 = a4[4];
          *v94 = v106 - (v106 >> 5);
          v22 = (unsigned int *)(v21 + 4 * *(a4 - 3) + 864);
          if ( v20 < 0x1000000 )
          {
            v67 = *(unsigned __int8 *)*(a4 - 2) | (a4[3] << 8);
            v20 <<= 8;
            ++*(a4 - 2);
            a4[3] = v67;
          }
          v57 = *v22;
          v58 = *v22 * (v20 >> 11);
          if ( a4[3] >= v58 )
          {
            a4[3] -= v58;
            v71 = v20 - v58;
            *v22 = v57 - (v57 >> 5);
            v72 = (unsigned int *)(a4[4] + 4 * *(a4 - 3) + 912);
            if ( v71 < 0x1000000 )
            {
              v42 = *(unsigned __int8 *)*(a4 - 2) | (a4[3] << 8);
              v71 <<= 8;
              ++*(a4 - 2);
              a4[3] = v42;
            }
            v101 = *v72;
            v102 = *v72 * (v71 >> 11);
            if ( a4[3] >= v102 )
            {
              a4[3] -= v102;
              v35 = v71 - v102;
              *v72 = v101 - (v101 >> 5);
              v99 = *(a4 - 10);
              *(a4 - 10) = *(a4 - 6);
            }
            else
            {
              v35 = *v72 * (v71 >> 11);
              v98 = v101 + ((2048 - v101) >> 5);
              v99 = *(a4 - 6);
              *v72 = v98;
            }
            *(a4 - 6) = *(a4 - 7);
          }
          else
          {
            v35 = *v22 * (v20 >> 11);
            v59 = v57 + ((2048 - v57) >> 5);
            v99 = *(a4 - 7);
            *v22 = v59;
          }
          *(a4 - 7) = *(a4 - 5);
          *(a4 - 5) = v99;
          goto LABEL_44;
        }
        v51 = v106 + ((2048 - v106) >> 5);
        v52 = 16 * (*(a4 - 3) + 15);
        *v94 = v51;
        v65 = v97;
        v66 = (unsigned int *)(a4[4] + 4 * (v17 + v52));
        if ( v97 < 0x1000000 )
        {
          v65 = v97 << 8;
          v100 = *(unsigned __int8 *)(*(a4 - 2))++ | (a4[3] << 8);
          a4[3] = v100;
        }
        v104 = *v66;
        v105 = *v66 * (v65 >> 11);
        if ( a4[3] >= v105 )
        {
          a4[3] -= v105;
          v35 = v65 - v105;
          *v66 = v104 - (v104 >> 5);
LABEL_44:
          *(a4 - 3) = *(a4 - 3) >= 7 ? 11 : 8;
          v81 = (unsigned int *)(a4[4] + 5328);
          goto LABEL_2;
        }
        v60 = *(a4 - 4);
        a1 = *v66 * (v65 >> 11);
        v62 = __OFSUB__(*(a4 - 3), 7);
        v61 = *(a4 - 3) - 7 < 0;
        *v66 = v104 + ((2048 - v104) >> 5);
        v63 = a4[2];
        *(a4 - 3) = 2 * (v61 == v62) + 9;
        v64 = *(a4 - 4) - *(a4 - 5);
        ++*(a4 - 4);
        LOBYTE(v64) = *(_BYTE *)(v64 + v63);
        *((_BYTE *)a4 - 1) = v64;
        *(_BYTE *)(v60 + v63) = v64;
      }
      v35 = v46 * (v85 >> 11);
      v78 = v46 + ((2048 - v46) >> 5);
      v79 = *(a4 - 3) < 7;
      *(a4 - 10) = *(a4 - 6);
      *(a4 - 6) = *(a4 - 7);
      v25 = *(a4 - 5);
      *v86 = v78;
      *(a4 - 7) = v25;
      if ( v79 )
        *(a4 - 3) = 0;
      else
        *(a4 - 3) = 3;
      v81 = (unsigned int *)(a4[4] + 3272);
LABEL_2:
      if ( v35 < 0x1000000 )
      {
        v34 = *(unsigned __int8 *)*(a4 - 2) | (a4[3] << 8);
        v35 <<= 8;
        ++*(a4 - 2);
        a4[3] = v34;
      }
      v41 = *v81;
      v45 = v41 * (v35 >> 11);
      if ( a4[3] >= v45 )
      {
        a4[3] -= v45;
        v30 = v35 - v45;
        *v81 = v41 - (v41 >> 5);
        if ( v30 < 0x1000000 )
        {
          v82 = *(unsigned __int8 *)*(a4 - 2) | (a4[3] << 8);
          v30 <<= 8;
          ++*(a4 - 2);
          a4[3] = v82;
        }
        v96 = v81[1];
        v44 = v96 * (v30 >> 11);
        if ( a4[3] >= v44 )
        {
          a4[3] -= v44;
          a1 = v30 - v44;
          v81[1] = v96 - (v96 >> 5);
          v87 = (int)(v81 + 258);
          *(a4 - 9) = 16;
          *(a4 - 8) = 8;
LABEL_27:
          *(a4 - 11) = *(a4 - 8);
          v40 = 1;
          do
          {
            if ( a1 < 0x1000000 )
            {
              v50 = *(unsigned __int8 *)*(a4 - 2) | (a4[3] << 8);
              a1 <<= 8;
              ++*(a4 - 2);
              a4[3] = v50;
            }
            v43 = *(_DWORD *)(v87 + 4 * v40);
            v80 = v43 * (a1 >> 11);
            if ( a4[3] >= v80 )
            {
              a4[3] -= v80;
              a1 -= v80;
              *(_DWORD *)(v87 + 4 * v40) = v43 - (v43 >> 5);
              v40 = 2 * v40 + 1;
            }
            else
            {
              a1 = v43 * (a1 >> 11);
              *(_DWORD *)(v87 + 4 * v40) = v43 + ((2048 - v43) >> 5);
              v40 *= 2;
            }
            v73 = (*(a4 - 11))-- == 1;
          }
          while ( !v73 );
          a2 = 1;
          v91 = *(a4 - 9) - (1 << *(a4 - 8)) + v40;
          v14 = *(a4 - 3) < 4;
          *(a4 - 12) = v91;
          if ( !v14 )
          {
            v90 = *(a4 - 5);
            continue;
          }
          *(a4 - 3) += 7;
          if ( v91 >= 4 )
            v56 = 3;
          else
            v56 = v91;
          a5 = (v56 << 8) + a4[4] + 1728;
          *(a4 - 11) = 6;
          goto LABEL_33;
        }
        a1 = v96 * (v30 >> 11);
        v81[1] = v96 + ((2048 - v96) >> 5);
        v87 = (int)&v81[8 * v17 + 130];
        *(a4 - 9) = 8;
      }
      else
      {
        a1 = v41 * (v35 >> 11);
        *(a4 - 9) = 0;
        *v81 = v41 + ((2048 - v41) >> 5);
        v87 = (int)&v81[8 * v17 + 2];
      }
      break;
    }
    *(a4 - 8) = 3;
    goto LABEL_27;
  }
  return *(a4 - 4);
}
// 405BF5: positive sp value 4 has been found

//----- (00406990) --------------------------------------------------------
_BYTE *__cdecl sub_406990(_BYTE *a1, _BYTE *a2)
{
  _BYTE *result; // eax
  char v3; // cl

  result = a1;
  v3 = *a1;
  *a1 = *a2;
  *a2 = v3;
  return result;
}

//----- (0040699C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_40699C@<eax>(int a1@<ebp>, int a2@<edi>)
{
  int v3; // ebx
  unsigned int i; // esi
  _DWORD *v5; // edi

  v3 = sub_405E8A(a2);
  v5 = (_DWORD *)(v3 + *(_DWORD *)(v3 + *(_DWORD *)(v3 + 60) + 120));
  if ( HIWORD(*(_DWORD *)(a1 + 8)) )
  {
    *(_DWORD *)(a1 - 8) = v3 + v5[8];
    *(_DWORD *)(a1 - 12) = v3 + v5[9];
    for ( i = 0; v5[6] > i; ++i )
    {
      if ( sub_406C65((_BYTE *)(v3 + **(_DWORD **)(a1 - 8))) == *(_DWORD *)(a1 + 8) )
      {
        *(_DWORD *)(a1 - 4) = **(unsigned __int16 **)(a1 - 12);
        break;
      }
      *(_DWORD *)(a1 - 8) += 4;
      *(_DWORD *)(a1 - 12) += 2;
    }
    if ( v5[6] == i )
      return 0;
  }
  else
  {
    *(_DWORD *)(a1 - 4) = *(unsigned __int16 *)(a1 + 8) - v5[4];
  }
  return v3 + *(_DWORD *)(v3 + v5[7] + 4 * *(_DWORD *)(a1 - 4));
}
// 4049F6: positive sp value 4 has been found

//----- (00406ABA) --------------------------------------------------------
void __usercall sub_406ABA(unsigned int a1@<ecx>, void *a2@<edi>, const void *a3@<esi>)
{
  qmemcpy(a2, a3, a1);
  dword_437038 = 986;
}
// 437038: using guessed type int dword_437038;

//----- (00406C65) --------------------------------------------------------
unsigned int __cdecl sub_406C65(_BYTE *a1)
{
  unsigned int result; // eax

  result = 0;
  while ( *a1 )
    result = (char)*a1++ ^ ((result >> 25) | (result << 7));
  return result;
}

//----- (00406E72) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_406E72@<eax>(_DWORD *a1@<ebp>)
{
  unsigned __int8 v1; // bl
  unsigned int i; // esi
  int v3; // eax
  char v4; // cl
  _BYTE *v5; // edx
  _BYTE *v6; // edi
  unsigned int v7; // esi
  _BYTE *v8; // eax
  int result; // eax
  int v10; // et2

  v5 = (_BYTE *)a1[4];
  v6 = v5;
  v7 = 0;
  v8 = v5;
  do
  {
    v4 = v7++;
    *v8++ = v4;
  }
  while ( v7 < 0x100 );
  v5[256] = 0;
  v5[257] = 0;
  *((_BYTE *)a1 - 1) = 0;
  v1 = 0;
  *(a1 - 2) = v5;
  for ( i = 0; i < 0x100; ++i )
  {
    v1 = (v1 + *(unsigned __int8 *)*(a1 - 2) + *(unsigned __int8 *)(a1[2] + *((unsigned __int8 *)a1 - 1))) % 256;
    sub_406990(&v6[i], &v6[v1]);
    v3 = *((unsigned __int8 *)a1 - 1) + 1;
    v10 = v3 % a1[3];
    result = v3 / a1[3];
    *((_BYTE *)a1 - 1) = v10;
    ++*(a1 - 2);
  }
  return result;
}
// 405A21: positive sp value C has been found

//----- (00407410) --------------------------------------------------------
int sub_407410()
{
  int savedregs; // [esp+8h] [ebp+0h] BYREF

  return sub_406E72(&savedregs);
}

//----- (0040AC3D) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
int __userpurge sub_40AC3D@<eax>(int a1@<ebp>, int a2@<edi>, _DWORD *a3@<esi>, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  void *retaddr[2]; // [esp+0h] [ebp+0h]

  *MK_FP(*(_WORD *)(a1 + 51), a2) = *a3;
  _EDI = a2 + 4;
  __asm { rcr     byte ptr [edi+2Ch], 0E8h }
  MEMORY[0x80435D97]();
  return MK_FP(retaddr[0], retaddr[0])();
}
// 40AC6A: positive sp value 24 has been found
// 40AC6A: bad sp value at call
// 40AC3D: too many input arguments, some ignored

//----- (0040E185) --------------------------------------------------------
#error "40E188: cannot convert to microcode (funcsize=3)"

// nfuncs=26 queued=26 decompiled=26 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 26 function(s)"
