/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start(); // weak
void __noreturn sub_4010B2();
// void __usercall __noreturn sub_404077(unsigned int@<eax>, int@<ecx>, int _EBX@<ebx>, int@<edi>, int@<esi>);
// void __usercall __noreturn sub_404206(char@<ah>, int@<edx>, int@<ecx>, int@<ebx>);

//-------------------------------------------------------------------------
// Data declarations

// extern LPSTR (__stdcall *GetCommandLineA)();


//----- (00401081) --------------------------------------------------------
void __noreturn start()
{
  GetCommandLineA();
  sub_4010B2();
}
// 401081: using guessed type void __noreturn start();

//----- (004010B2) --------------------------------------------------------
void __noreturn sub_4010B2()
{
  struct _EXCEPTION_REGISTRATION_RECORD *ExceptionList; // [esp-4h] [ebp-4h] BYREF

  ExceptionList = NtCurrentTeb()->NtTib.ExceptionList;
  __writefsdword(0, (unsigned int)&ExceptionList);
  __halt();
}

//----- (00404077) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_404077(unsigned int a1@<eax>, int a2@<ecx>, int _EBX@<ebx>, int a4@<edi>, int a5@<esi>)
{
  bool v5; // pf
  char v7; // dl
  int v8; // edi
  unsigned __int8 v9; // cl
  unsigned int v10; // edi
  int v11; // esi
  unsigned int v12; // eax
  unsigned int v13; // edx
  int v14; // edi
  int v15; // eax
  int v17; // ebx
  char v18; // sf
  unsigned int v19; // ecx
  int v20; // edx
  unsigned int v22; // [esp-4h] [ebp-4h]
  int savedregs; // [esp+0h] [ebp+0h]
  unsigned int savedregsa; // [esp+0h] [ebp+0h]

  v5 = __SETP__(a5 + 1, 0);
  __asm { rcl     ebx, 0ACh }
  LOBYTE(a5) = a4;
  v7 = _EBX;
  if ( v5 )
  {
    HIWORD(_EBX) = ~HIWORD(_EBX);
    LOWORD(_EBX) = -21466;
    LOBYTE(a5) = 38;
  }
  __asm { fcom    st }
  v8 = a2 + a4 - 1;
  __asm { fadd    st, st }
  v9 = _EBX;
  v5 = __SETP__(v8 + 1, 0);
  __asm { fcom    st(4) }
  v10 = v22;
  if ( v5 )
    LOBYTE(a5) = v22;
  if ( (_BYTE)_EBX != v7 )
  {
    v11 = 1058922689;
    if ( (char)_EBX <= v7 )
    {
      __asm { fadd    st(4), st }
      _BitScanForward(&v10, a1);
      v11 = (__int16)a1;
    }
    a5 = -v11;
    v9 = _EBX;
  }
  v12 = ~a1;
  v13 = v10;
  v14 = 547177133;
  if ( (unsigned __int8)_EBX < v9 )
  {
    v14 = 547177134;
    __asm { fcomp   st(2) }
    LOWORD(_EBX) = -4786;
  }
  v15 = v12 ^ (1 << -(char)a5);
  __asm { fsubr   st(6), st }
  _EDI = 1 - v14;
  __asm
  {
    rcr     edi, 59h
    fsubr   st(7), st
  }
  v17 = __CFADD__(_EBX, 1224890591) - 170724994;
  _BitScanReverse(&v19, v13);
  if ( v18 )
    v19 = v13;
  v20 = savedregs;
  savedregsa = v15 & 0xFFFFFFB2;
  LOWORD(v20) = ~(_WORD)v17 & v20;
  _EDI = v19;
  __asm
  {
    fsub    st(6), st
    rcl     edi, 90h
  }
  sub_404206(SBYTE1(v15), -v20 - 2, -1613434058, -v17);
}
// 404179: positive sp value 8 has been found
// 40409A: inconsistent fpu stack
// 4040A7: variable 'v22' is possibly undefined
// 40415B: variable 'v18' is possibly undefined
// 404178: variable 'savedregs' is possibly undefined

//----- (00404206) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_404206(char a1@<ah>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>)
{
  char v4; // sf
  char v5; // of
  int v6; // ebx
  int v7; // ecx
  bool v8; // cf
  _DWORD *v10; // eax
  int v11; // ecx
  int v13; // ecx
  int v15; // edi
  int v17; // edx
  int v19; // ecx
  int v20; // edi
  int v21; // [esp-4h] [ebp-4h]

  v6 = a4 | (1 << a3);
  if ( v4 != v5 )
    a3 = a2;
  v7 = a3 >> 27;
  v8 = 0;
  if ( (BYTE1(v7) & a1 & 0x80u) != 0 )
  {
    __asm
    {
      fcom    st(5)
      fsub    st(5), st
    }
    v8 = __CFADD__(v6, 696144865);
    v6 += 696144865;
    v7 = v6;
  }
  _EBX = __PAIR64__(v7 - ((unsigned int)v8 + 282532502), v6) >> (v7 - (v8 - 106));
  __asm { repne not ebx }
  v10 = (_DWORD *)(v21 + 594);
  v11 = -1907366035;
  LOBYTE(_EBX) = 112;
  __asm { fsubr   st(6), st }
  while ( 1 )
  {
    v13 = ~v11;
    LOWORD(v13) = (unsigned __int8)(_EBX & v13);
    _ECX = ~v13;
    __asm { rcl     ecx, 0A2h }
    v15 = ((int)((-_ECX >> 25) ^ 0xBAC8FC4C) >> 28) - 2;
    *v10 += 497728974;
    _EDX = -1707640678;
    __asm
    {
      rcl     edx, 0BEh
      rcl     edx, 8Ah
      repne pop ebx
      fcomp   st
    }
    v17 = _EDX - 1;
    _ECX = 1518810764;
    __asm { rcr     ecx, 0EFh }
    v19 = _ECX & ~(1 << v17);
    v20 = v15 - 1;
    __asm { fcomp   st(1) }
    if ( v20 >= 0 )
      v20 = v17;
    ++v10;
    v11 = v19 + 1;
    if ( (int)v10 >= v21 + 1560 )
    {
      __asm { fadd    st(5), st }
      *(_BYTE *)(v20 - 1) = (_BYTE)v10;
      __halt();
    }
  }
}
// 404267: positive sp value 4 has been found
// 40421B: inconsistent fpu stack
// 404206: variable 'v4' is possibly undefined
// 404206: variable 'v5' is possibly undefined
// 40428D: variable 'v21' is possibly undefined

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
