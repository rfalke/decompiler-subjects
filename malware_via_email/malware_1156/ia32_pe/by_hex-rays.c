/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int start();
int __stdcall sub_131011DE(_DWORD *, unsigned int, int);

//-------------------------------------------------------------------------
// Data declarations

char byte_131010E3[] = { '\x90' }; // weak
// extern UINT (__stdcall *GetOEMCP)();
// extern DWORD (__stdcall *GetFileType)(HANDLE hFile);
// extern HANDLE (__stdcall *CreateFileA)(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// extern HANDLE (__stdcall *GetProcessHeap)();
// extern UINT (__stdcall *GetACP)();
// extern LPSTR (__stdcall *GetCommandLineA)();
// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
CHAR ProcName[] = "ZwOpenTimer"; // idb
CHAR FileName[] = "55zlDY8h3Eu8HA.K8Q"; // idb
CHAR ModuleName[] = "NTDLL.DLL"; // idb


//----- (13101007) --------------------------------------------------------
int start()
{
  int v1; // [esp+0h] [ebp-28h]
  HANDLE FileA; // [esp+4h] [ebp-24h]
  int v3; // [esp+8h] [ebp-20h]
  HMODULE hModule; // [esp+Ch] [ebp-1Ch]
  LPSTR CommandLineA; // [esp+10h] [ebp-18h]
  int v6; // [esp+14h] [ebp-14h]
  int v7; // [esp+14h] [ebp-14h]
  int v8; // [esp+18h] [ebp-10h]
  int v9; // [esp+1Ch] [ebp-Ch]
  FARPROC hFile; // [esp+20h] [ebp-8h]
  int v11; // [esp+24h] [ebp-4h]
  int savedregs; // [esp+28h] [ebp+0h]

  CommandLineA = GetCommandLineA();
  hModule = GetModuleHandleA(ModuleName);
  GetACP();
  GetACP();
  hFile = GetProcAddress(hModule, ProcName);
  GetACP();
  GetFileType(hFile);
  FileA = CreateFileA(FileName, 0xC0000000, 3u, 0, 3u, 0x105u, 0);
  GetProcessHeap();
  v7 = ((int (__stdcall *)(_DWORD, _DWORD, _DWORD, int, HANDLE, int, HMODULE, LPSTR, int, int, int, FARPROC, int, int))hFile)(
         0,
         0,
         0,
         v1,
         FileA,
         v3,
         hModule,
         CommandLineA,
         v6,
         v8,
         v9,
         hFile,
         v11,
         savedregs);
  GetOEMCP();
  return ((int (*)(void))&byte_131010E3[v7 ^ 0xC0000005])();
}
// 13101094: variable 'v1' is possibly undefined
// 13101094: variable 'v3' is possibly undefined
// 13101094: variable 'v6' is possibly undefined
// 13101094: variable 'v8' is possibly undefined
// 13101094: variable 'v9' is possibly undefined
// 13101094: variable 'v11' is possibly undefined
// 13101094: variable 'savedregs' is possibly undefined

//----- (131011DE) --------------------------------------------------------
int __stdcall sub_131011DE(_DWORD *a1, unsigned int a2, int a3)
{
  unsigned int v4; // edx
  int result; // eax

  v4 = a2 >> 2;
  result = a3;
  do
  {
    *a1 ^= a3;
    *a1 ^= a3;
    *a1 = -*a1;
    *a1 -= a3;
    *a1 -= a3;
    *a1 = __ROL4__(*a1, 109);
    *a1 = __ROR4__(*a1, 150);
    *a1 -= 1958524711;
    *a1 ^= 0xE73C03FE;
    *a1 = -*a1;
    ++a1;
    --v4;
  }
  while ( v4 );
  return result;
}

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
