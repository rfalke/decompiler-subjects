// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__GetCommandLineA = &g_t12EC; // 00401000
<anonymous> * __imp__CreateFileA = &g_t12FE; // 00401004
<anonymous> * __imp__VirtualAlloc = &g_t130C; // 00401008
<anonymous> * __imp__VirtualProtect = &g_t131C; // 0040100C
<anonymous> * __imp__GetModuleHandleA = &g_t12D8; // 00401010
// 00401020: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	ptr32 fp;
	Eq_4 tLoc20;
	Eq_2 dwLoc14;
	fn00401270(&tLoc20);
	ui32 ecx_21 = tLoc20;
	ui32 eax_25 = (ecx_21 << 0x0E) + 0x000BD020;
	Eq_430 ecx_28[] = (eax_25 & 0xFFFF0000) + ~0x000181B3;
	word32 * edx_33 = (word32) tLoc20 + (fp - 229);
	*edx_33 = ecx_28[ecx_21].dw0000 - 0x28;
	struct Eq_42 * ecx_30 = &(ecx_28 + (ecx_21 << 0x09) / 0x0200)->dw0000;
	Eq_2 eax_38 = (eax_25 & 0xFFFF0000) + ecx_30->dwFFFFFFFC + 0xF9 - tLoc20;
	<anonymous> ** eax_52 = 0x004010DD - tLoc20;
	struct Eq_66 * esp_54;
	(*eax_52)();
	esp_54->tFFFFFFFC.u0 = tLoc20.u0;
	esp_54->tFFFFFFF8.u0 = (DWORD) dwLoc14;
	esp_54->tFFFFFFF4.u0 = (DWORD) eax_38;
	fn00401200(esp_54->tFFFFFFF4.u0, esp_54->tFFFFFFF8.u0, esp_54->tFFFFFFFC.u0);
	struct Eq_98 * ebx_82 = (char *) eax_38.u1 + *(((word32) eax_38 + 269) - tLoc20.u0);
	ui32 ecx_88 = tLoc20;
	uint32 dwLoc1C_247 = (uint32) ebx_82->b0006;
	esp_54->tFFFFFFFC.u0 = (DWORD) ((ecx_88 << 0x05) + ~0x19DF);
	esp_54->tFFFFFFF8.u0 = 0x3000;
	esp_54->tFFFFFFF4.u0 = ((char *) &ebx_82->t0034 + 3372 - ((ecx_88 << 0x05) >> 0x01))->u0;
	esp_54->tFFFFFFF0.u0 = ebx_82->t0034.u0;
	Eq_2 eax_105 = VirtualAlloc(esp_54->tFFFFFFF0.u0, esp_54->tFFFFFFF4.u0, esp_54->tFFFFFFF8.u0, esp_54->tFFFFFFFC.u0);
	esp_54->tFFFFFFFC.u0 = (DWORD) eax_105;
	esp_54->tFFFFFFF8.u0 = (DWORD) eax_38;
	esp_54->tFFFFFFF4.u0 = ((char *) &ebx_82->t0034 + 0x00F1 - tLoc20)->u0;
	fn00401250(esp_54->tFFFFFFF4.u0, esp_54->tFFFFFFF8.u0, esp_54->tFFFFFFFC.u0);
	struct Eq_197 * esi_125 = (char *) &ebx_82->t0034 + 0x00C4;
	do
	{
		esp_54->tFFFFFFFC.u0 = (char *) eax_105.u1 + esi_125->dw000C;
		esp_54->tFFFFFFF8.u0 = (char *) eax_38.u1 + (esi_125->t0014).u0;
		esp_54->tFFFFFFF4.u0 = esi_125->dw0010;
		fn00401250(esp_54->tFFFFFFF4.u0, esp_54->tFFFFFFF8.u0, esp_54->tFFFFFFFC.u0);
		uint32 v25_151 = dwLoc1C_247 - 0x01;
		++esi_125;
		dwLoc1C_247 = v25_151;
	} while (v25_151 != 0x00);
	Mem162[fp + 0xD1 - Mem152[&tLoc20 + 0x00:word32]:word32] = Mem152[ebx_82 - 0xA9 + Mem152[&tLoc20 + 0x00:word32]:word32] + eax_105;
	int32 edx_163 = tLoc20;
	esp_54->tFFFFFFFC.u0 = (DWORD) (fp - 0x0129 + edx_163);
	esp_54->tFFFFFFF8.u0 = (DWORD) (1427582266 - edx_163 - 1423383235);
	esp_54->tFFFFFFF4.u0 = (DWORD) (edx_163 + ~0x98);
	ui32 ecx_177 = tLoc20;
	<anonymous> * eax_180 = (ecx_177 << 0x06) + 4185616;
	struct Eq_288 * esp_183;
	eax_180();
	esp_183->tFFFFFFFC.u0 = tLoc20.u0;
	esp_183->tFFFFFFF8.u0 = 0x38;
	esp_183->tFFFFFFF4.u0 = (DWORD) (fp - 88);
	fn00401200(esp_183->tFFFFFFF4.u0, esp_183->tFFFFFFF8.u0, esp_183->tFFFFFFFC.u0);
	word32 ecx_206 = tLoc20;
	Eq_2 eax_210 = eax_105;
	do
		eax_210.u1 = (word32) eax_210 + 1;
	while (*eax_210 != ecx_206 + 0xAABBCC0C);
	esp_183->tFFFFFFFC.u0 = (DWORD) eax_210;
	esp_183->tFFFFFFF8.u0 = (word32) tLoc20 + (fp - 0x0129);
	Eq_2 eax_226 = 0x0109 - tLoc20;
	esp_183->tFFFFFFF4.u0 = (DWORD) eax_226;
	return SEQ(SLICE(eax_226, word24, 8), fn00401250(esp_183->tFFFFFFF4.u0, esp_183->tFFFFFFF8.u0, esp_183->tFFFFFFFC.u0));
}

// 00401200: void fn00401200(Stack Eq_2 dwArg04, Stack Eq_2 dwArg08, Stack Eq_2 dwArg0C)
// Called from:
//      Win32CrtStartup
void fn00401200(Eq_2 dwArg04, Eq_2 dwArg08, Eq_2 dwArg0C)
{
	Eq_2 ebx_22 = dwArg04;
	Eq_2 ecx_10 = dwArg08;
	word32 eax_15 = (word32) dwArg0C + 0x37FA334C;
	word32 dwLoc08_52 = 0x01;
	while (true)
	{
		ebx_22->u1 = *ebx_22 ^ eax_15;
		ecx_10 -= 0x04;
		if (ecx_10 <= 0x00)
			break;
		eax_15 = eax_15 + 0x0BA9F4A6 + dwLoc08_52;
		ebx_22 = (word32) ebx_22 + 0x00D5 - dwArg0C;
		dwLoc08_52 = -dwLoc08_52;
	}
}

// 00401250: Register byte fn00401250(Stack Eq_2 dwArg04, Stack Eq_2 dwArg08, Stack Eq_2 dwArg0C)
// Called from:
//      Win32CrtStartup
byte fn00401250(Eq_2 dwArg04, Eq_2 dwArg08, Eq_2 dwArg0C)
{
	Eq_2 edi_14 = dwArg0C;
	Eq_2 esi_15 = dwArg08;
	Eq_2 ecx_16 = dwArg04;
	do
	{
		byte al_19 = *esi_15;
		edi_14->u1 = al_19;
		esi_15.u1 = (word32) esi_15 + 1;
		edi_14.u1 = (word32) edi_14 + 1;
		--ecx_16;
	} while (ecx_16 != 0x00);
	return al_19;
}

// 00401270: void fn00401270(Stack (ptr32 uint32) dwArg04)
// Called from:
//      Win32CrtStartup
void fn00401270(uint32 * dwArg04)
{
	uint32 eax_10;
	(*(<anonymous> **) 0x7FFE0300)();
	*dwArg04 = (eax_10 & 0x0F) + ((eax_10 >> 0x18) + 0x10) - 0x01;
}

word32 g_dw4012C0 = 4844; // 004012C0
word32 g_dw4012C4 = 0x12FE; // 004012C4
word32 g_dw4012C8 = 0x130C; // 004012C8
word32 g_dw4012CC = 0x131C; // 004012CC
word32 g_dw4012D0 = 4824; // 004012D0
