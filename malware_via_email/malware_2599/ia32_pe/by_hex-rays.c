/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __stdcall sub_40100D(_DWORD *a1, unsigned int a2, int a3);
int start();
// UINT __stdcall GetOEMCP();
// DWORD __stdcall GetCurrentThreadId();
// LPSTR __stdcall GetCommandLineA();
// LPWSTR __stdcall GetCommandLineW();
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);

//-------------------------------------------------------------------------
// Data declarations

int dword_4010EC[512] =
{
  -1241579414,
  -8,
  272635391,
  -7339967,
  -5963,
  -1072300033,
  -1929363184,
  -8059,
  -1241558785,
  -24,
  369033322,
  4264180,
  279975423,
  1080688705,
  271586815,
  -1402470335,
  -16776970,
  1091579925,
  300050432,
  369033280,
  4263972,
  284694015,
  369033281,
  4264072,
  271848959,
  -2054619071,
  -20,
  -1526273,
  7012351,
  284431871,
  -1241579455,
  -16,
  279975423,
  369033281,
  4264184,
  16165992,
  -16750080,
  -1867,
  1075183615,
  1744847120,
  4198882,
  286266879,
  -2054619071,
  -12,
  -1014389,
  -394133505,
  -1073741819,
  269336705,
  -788594624,
  271848959,
  -2054619071,
  -28,
  -1340735543,
  -385859312,
  63,
  1586480073,
  422412990,
  -525638768,
  -1060725071,
  1659720525,
  1763042732,
  -1033269143,
  -1344386040,
  -1917110679,
  -187355509,
  1402035235,
  1779768027,
  -128283181,
  -257843792,
  1444750005,
  -1792088039,
  -202295917,
  -202766033,
  -201968241,
  -136499825,
  -113869425,
  -58678897,
  -1577862851,
  1850922039,
  -1423997388,
  -1506768316,
  634970899,
  -1542378564,
  1374107066,
  1105668737,
  -202071759,
  -1485709937,
  300365242,
  31926913,
  -202055375,
  527551887,
  129579234,
  471447696,
  128202904,
  -197236680,
  -385459358,
  -1483322528,
  200553872,
  -144252654,
  -63323846,
  -1676785518,
  -956833726,
  -989518391,
  -198552135,
  70858127,
  -1566153669,
  -435497084,
  426419745,
  -201926501,
  -1430076270,
  1172398723,
  -1324976020,
  -423366816,
  365894275,
  1560689772,
  315441001,
  1260245561,
  -1049335875,
  358343824,
  -532354116,
  540806320,
  -371691142,
  -1557994801,
  -1086909256,
  383597976,
  164780244,
  -703416732,
  -885182138,
  -742112931,
  -2060985133,
  -16074240,
  559429042,
  -2027436734,
  1244808979,
  -201902512,
  541523899,
  1043392218,
  595733444,
  717911898,
  -1946929776,
  562847813,
  2082015376,
  -197517973,
  -902285937,
  -1845760723,
  -1125439421,
  -780261975,
  -1669937767,
  -370474726,
  -1114086099,
  -83031223,
  -1516608635,
  -304578979,
  -1348260970,
  -909875424,
  -1040697243,
  581044627,
  1446221466,
  553923999,
  1250962,
  679901127,
  46794630,
  -1477364336,
  2125513118,
  -707074693,
  -203213701,
  45859215,
  871784604,
  -203198159,
  354753935,
  2133554020,
  872843679,
  1995096172,
  -988102245,
  1259455,
  1688324023,
  119528212,
  -1506768496,
  -1810494065,
  -203410805,
  -2077764425,
  78104492,
  -1505915748,
  2010630047,
  -2012099651,
  -203393648,
  684997419,
  337446649,
  169180477,
  -201960015,
  -1510656625,
  -165433824,
  36741520,
  -185274938,
  740999579,
  168507026,
  -1795792527,
  -202082927,
  -1613296245,
  691950993,
  1872157896,
  467809678,
  -365943130,
  382987649,
  536229842,
  -164697154,
  581304720,
  506517222,
  960946817,
  46985936,
  -185143834,
  -1344725061,
  -1036479554,
  -185471510,
  -201188653,
  -1882180209,
  597560054,
  -164648034,
  -1006626416,
  599975153,
  -535812218,
  -185078330,
  -6909209,
  602027398,
  -164840546,
  -436477552,
  -69801025,
  280346934,
  603078732,
  1058470,
  -185078346,
  2015808435,
  -2069482315,
  -1463507580,
  1835332064,
  690774801,
  1760848620,
  1835815721,
  -456820867,
  -1464125727,
  -1428617783,
  347747728,
  -1418130049,
  -725991968,
  1832611853,
  -1982538528,
  1282798604,
  -1937566464,
  894921034,
  262134527,
  1945636104,
  -1972488728,
  -1788256092,
  1253031444,
  1468934518,
  1592506669,
  428401827,
  -1281277520,
  -1915273725,
  461913458,
  -695644317,
  -1464320480,
  -1938425844,
  -225841494,
  -1892076556,
  1986101034,
  549141984,
  -1925359499,
  815796448,
  -1468979941,
  1450655200,
  490141021,
  1908813939,
  1573727705,
  272289257,
  918845802,
  1896963421,
  -1480715399,
  -116303050,
  1095857708,
  52179942,
  1424715600,
  1831976981,
  -1910959645,
  -896753942,
  -1942667793,
  -1398006046,
  1957396471,
  -1369370826,
  -189121056,
  839858669,
  1230495051,
  1063005259,
  -1376503489,
  -389719828,
  1063152001,
  -1986648769,
  872704788,
  2134217199,
  734083100,
  1502689771,
  -1397964785,
  -1207250937,
  -1683954844,
  -91647520,
  144381246,
  1063201339,
  411618567,
  -1744252964,
  -91253524,
  2035407714,
  949695500,
  -865091541,
  145587283,
  -1464123529,
  -2073295060,
  -1464315517,
  1823111648,
  -1446420256,
  761871840,
  1774598188,
  -1449566814,
  -1461502496,
  1029049135,
  198532232,
  -1464189193,
  -380314996,
  -1464190592,
  -132490784,
  1967808677,
  -1156783699,
  734519204,
  -81433085,
  885341663,
  -1463471648,
  985192236,
  -1396868649,
  -1317262014,
  -1898462492,
  -523797290,
  1745816589,
  232608047,
  1474508795,
  -1594698283,
  1873606057,
  52151556,
  -279040705,
  1061118212,
  1902980415,
  422272239,
  422109824,
  -1281277520,
  -1915273725,
  1535851890,
  -1986929821,
  1064844884,
  1254377791,
  -1387620620,
  -2021565696,
  -1423581482,
  -1530577440,
  -1873195406,
  1170816738,
  -1464086594,
  -1980114452,
  1990475490,
  163928385,
  -1464304159,
  147150500,
  -2020347127,
  1062408576,
  966255935,
  -1983546377,
  915357410,
  1232526641,
  -1072715281,
  -1367912145,
  -1447372838,
  1853309244,
  -1447300930,
  -1980138180,
  166936290,
  1063204015,
  -1983301041,
  -1801896222,
  -1464125826,
  -1982235332,
  -1459470622,
  961151873,
  1111449406,
  -1767822017,
  2143673617,
  -1465649200,
  -480585248,
  1111449245,
  -1404097217,
  -1447305538,
  -1489907204,
  -570737184,
  1060563329,
  783031615,
  2092613633,
  -1463330860,
  1500830176,
  271114735,
  -1458729503,
  1040516413,
  -47849705,
  150718331,
  1063200455,
  -1993221437,
  -1890249716,
  965754106,
  1842078732,
  -1984635821,
  2083035628,
  2091965468,
  1960147996,
  -522475758,
  -1993221467,
  -1938479636,
  -1366499590,
  -2001805759,
  -2010218209,
  1822581991,
  -1911980832,
  1116733178,
  -646063631,
  -1353379348,
  460119860,
  -1565612346,
  1064023683,
  -1256714473,
  154098106,
  1063204119,
  -1433019377,
  321863136,
  -1429890035,
  -1263583776,
  2037373441,
  -782957044,
  -526904851,
  -1592361087,
  933191718,
  -1467404993,
  166783767,
  1069954037,
  1060225408,
  1539038527,
  -1878664687,
  1854930766,
  -1319696884,
  1420364812,
  -1993262591,
  1539693684,
  1782639025,
  -1399753281,
  -1447502124,
  166592169,
  -2060735171,
  1060434307,
  235903295,
  -609272641,
  -695226996,
  -1984636415,
  204118508,
  -380301652,
  776858457,
  -1990181479,
  -1441457171,
  1488666080,
  -1990731203,
  -1438287380,
  1116290528,
  -1935330836,
  112119546,
  791118339,
  569668191,
  -1440659339,
  346361376,
  -1463423684,
  811306468,
  -1986536069,
  -1438303764,
  -1398194720,
  -1464156078,
  -1855750580,
  -1416242161,
  -818987552,
  -1413121011,
  1420770784,
  -1717708287,
  -1498618228,
  -1459453485,
  961151873,
  996106046,
  -2104939201,
  -1936500271,
  1252486466,
  -1477067952,
  -493994528,
  -1465005567,
  -1933885984,
  -1435903462,
  -1396359709,
  1653202708,
  1534319089,
  -1467387479,
  288944915,
  1019303393,
  -346104041,
  454187879
}; // weak
CHAR ModuleName[] = "NTDLL.DLL"; // idb
CHAR ProcName[] = "ZwOpenJobObject"; // idb


//----- (0040100D) --------------------------------------------------------
int __stdcall sub_40100D(_DWORD *a1, unsigned int a2, int a3)
{
  unsigned int v4; // ecx
  int result; // eax

  v4 = a2 >> 2;
  result = a3;
  do
  {
    *a1 ^= a3;
    *a1 -= a3;
    *a1 = __ROL4__(*a1, 30);
    *a1 ^= a3;
    *a1 -= a3;
    *a1 -= 151232864;
    *a1 += 1000318060;
    *a1++ -= a3;
    --v4;
  }
  while ( v4 );
  return result;
}

//----- (0040105A) --------------------------------------------------------
int start()
{
  int v1; // [esp+0h] [ebp-20h]
  int v2; // [esp+4h] [ebp-1Ch]
  FARPROC ZwOpenJobObject; // [esp+8h] [ebp-18h]
  int v4; // [esp+Ch] [ebp-14h]
  int v5; // [esp+10h] [ebp-10h]
  int v6; // [esp+10h] [ebp-10h]
  int v7; // [esp+14h] [ebp-Ch]
  HMODULE hModule; // [esp+18h] [ebp-8h]
  LPSTR v9; // [esp+1Ch] [ebp-4h]
  int savedregs; // [esp+20h] [ebp+0h]

  GetCurrentThreadId();
  hModule = GetModuleHandleA(ModuleName);
  v9 = GetCommandLineA();
  GetCurrentThreadId();
  GetCommandLineW();
  ZwOpenJobObject = GetProcAddress(hModule, ProcName);
  GetOEMCP();
  GetOEMCP();
  GetCurrentThreadId();
  v6 = ((int (__stdcall *)(_DWORD, _DWORD, _DWORD, int, int, FARPROC, int, int, int, HMODULE, LPSTR, int))ZwOpenJobObject)(
         0,
         0,
         0,
         v1,
         v2,
         ZwOpenJobObject,
         v4,
         v5,
         v7,
         hModule,
         v9,
         savedregs);
  return ((int (*)(void))((char *)dword_4010EC + (v6 ^ 0xC0000005)))();
}
// 4010BE: variable 'v1' is possibly undefined
// 4010BE: variable 'v2' is possibly undefined
// 4010BE: variable 'v4' is possibly undefined
// 4010BE: variable 'v5' is possibly undefined
// 4010BE: variable 'v7' is possibly undefined
// 4010BE: variable 'savedregs' is possibly undefined
// 4010EC: using guessed type int dword_4010EC[512];

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
