// subject_PE_header.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

Eq_3 g_t400000 = // 00400000
	{
		
		{
			0x0000462A
		},
	};
// subject_data.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw402000 = 0x00; // 00402000
word32 g_dw4020B0 = 0x00; // 004020B0
byte g_b4022CC = 0x00; // 004022CC
byte g_b4022CD = 0x00; // 004022CD
struct Eq_3 * g_ptr4023C0 = null; // 004023C0
int32 g_dw4023C4 = 0; // 004023C4
Eq_18 g_t4023C8 = // 004023C8
	{
		null
	};
Eq_123 g_t4023CC = null; // 004023CC
Eq_20 g_t4023D0 = // 004023D0
	{
		0
	};
int32 g_dw4023D4 = 0; // 004023D4
Eq_18 g_t4023D8 = // 004023D8
	{
		null
	};
Eq_171 g_t4023DC = // 004023DC
	{
		0
	};
int32 g_dw4023E0 = 0; // 004023E0
Eq_18 g_t4023E8 = // 004023E8
	{
		null
	};
word32 g_dw4023EC = 0x00; // 004023EC
Eq_100 g_t4023F0 = // 004023F0
	{
		null
	};
Eq_100 g_t4023F4 = // 004023F4
	{
		null
	};
Eq_100 g_t4023F8 = // 004023F8
	{
		null
	};
Eq_100 g_t4023FC = // 004023FC
	{
		null
	};
Eq_100 g_t402400 = // 00402400
	{
		null
	};
Eq_365 g_t402404 = // 00402404
	{
		null
	};
Eq_295 g_t402408 = null; // 00402408
Eq_295 g_t40240C = null; // 0040240C
byte g_b402414 = 0x00; // 00402414
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__CreateThread = &g_t15A4; // 00401000
<anonymous> * __imp__GetProcAddress = &g_t15B4; // 00401004
<anonymous> * __imp__GetThreadContext = &g_t15C6; // 00401008
<anonymous> * __imp__HeapAlloc = &g_t15DA; // 0040100C
<anonymous> * __imp__HeapCreate = &g_t15E6; // 00401010
<anonymous> * __imp__HeapDestroy = &g_t15F4; // 00401014
<anonymous> * __imp__ResumeThread = &g_t1602; // 00401018
<anonymous> * __imp__SetThreadContext = &g_t1612; // 0040101C
<anonymous> * __imp__SuspendThread = &g_t1626; // 00401020
<anonymous> * __imp__VirtualAlloc = &g_t1636; // 00401024
// 00401030: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	g_ptr4023C0 = &g_t400000;
	fn004013DA();
	fn0040136C();
	fn00401164();
	return fn00401449();
}

// 00401084: void fn00401084(Stack Eq_18 dwArg04, Stack (ptr32 Eq_19) dwArg08, Stack Eq_20 dwArg0C)
// Called from:
//      fn00401164
void fn00401084(Eq_18 dwArg04, <unknown> * dwArg08, Eq_20 dwArg0C)
{
	memcpy(dwArg04, dwArg08, dwArg0C);
}

// 0040109A: Register word32 fn0040109A()
// Called from:
//      fn00401449
word32 fn0040109A()
{
	uint64 edx_eax_25 = (uint64) g_dw4023C4;
	int32 v18_32 = g_dw4023E0;
	uint32 edx_133 = (uint32) (edx_eax_25 % 0x20);
	word32 * ebx_30 = g_t4023C8.u0 + ((uint32) (edx_eax_25 /u 0x20) << 0x02);
	int32 edi_35 = v18_32;
	word32 eax_100 = 0x00;
	do
	{
		byte dl_46 = (byte) edx_133;
		--edi_35;
		uint32 esi_48 = __bswap<word32>(*ebx_30) << dl_46;
		if (esi_48 >> 0x1F != 0x00)
			eax_100 += esi_48 >> 0x1F << (byte) edi_35;
		edx_133 = SEQ(SLICE(edx_133 + 0x01, word24, 8), dl_46 + 0x01);
		if (edx_133 == 0x1F)
		{
			++ebx_30;
			edx_133 = 0x00;
		}
	} while (edi_35 != 0x00);
	g_dw4023C4 += v18_32;
	return eax_100;
}

// 00401164: void fn00401164()
// Called from:
//      Win32CrtStartup
void fn00401164()
{
	struct Eq_3 * eax_14 = g_ptr4023C0;
	Eq_20 ecx_17 = eax_14->t4074.u0;
	g_t4023D0.u0 = (int32) ecx_17;
	g_dw4023D4 = ecx_17 << 0x03;
	Eq_100 eax_28 = HeapCreate(0x01, 0x00, 0x00);
	g_t4023F0.u0 = (CONTEXT *) eax_28;
	Eq_18 eax_38 = HeapAlloc(eax_28, 0x08, g_t4023D0.u0);
	g_t4023C8.u0 = (byte *) eax_38;
	g_t4023CC = (Eq_123) (eax_38.u0 + g_t4023D0.u0);
	fn00401084(g_t4023C8.u0, (char *) &eax_14->t4074 + 20, g_t4023D0.u0);
	Eq_18 edi_54 = g_t4023C8.u0;
	Eq_20 ecx_55 = g_t4023D0.u0;
	do
	{
		*edi_54.u0 -= 0x33;
		edi_54.u0 = &edi_54.u1->b0001;
		--ecx_55;
	} while (ecx_55 != 0x00);
	++g_t4023C8.u0;
}

// 00401284: void fn00401284()
// Called from:
//      fn00401449
void fn00401284()
{
	Eq_18 ebx_14 = g_t4023D8.u0;
	byte cl_16 = 0x00;
	do
	{
		*ebx_14.u0 = 0x01;
		ebx_14.u1->b0001 = cl_16;
		++cl_16;
		ebx_14.u0 = (word32) ebx_14 + 0x00A0;
		Eq_171 ecx_27 = SEQ(0x00, 0x01, cl_16);
	} while (cl_16 != 0x00);
	g_t4023DC.u0 = (int32) ecx_27;
}

// 004012A7: void fn004012A7()
// Called from:
//      fn00401449
void fn004012A7()
{
	uint32 ecx_15 = (word32) g_b4022CC;
	byte * ebx_12 = g_t4023D8.u0 + g_t4023DC.u0 * 0xA0;
	*ebx_12 = (byte) ecx_15;
	memcpy(ebx_12 + 1, &g_b4022CD, ecx_15);
	g_t4023DC.u0 = (int32) (g_t4023DC.u0 + 0x01);
	fn004012D9();
}

// 004012D9: void fn004012D9()
// Called from:
//      fn004012A7
void fn004012D9()
{
	if (g_t4023DC.u0 == 0x0200)
	{
		g_t4023DC.u0 = 0x0100;
		g_dw4023E0 = 0x09;
	}
}

// 004012FC: Register byte fn004012FC()
// Called from:
//      fn00401449
byte fn004012FC()
{
	byte al_8 = g_b4022CD;
	g_b402414 = al_8;
	return al_8;
}

// 0040130A: void fn0040130A(Stack Eq_222 dwArg04)
// Called from:
//      fn00401449
void fn0040130A(Eq_222 dwArg04)
{
	word32 ebx_37 = Mem30[0x004023D8<p32>:word32] + dwArg04 *u 0xA0;
	memcpy(&g_b4022CC, ebx_37, (word32) *ebx_37 + 0x01);
}

// 00401332: void fn00401332()
// Called from:
//      fn00401449
void fn00401332()
{
	++g_b4022CC;
	(&g_b4022CC)[(word32) g_b4022CC] = g_b402414;
}

// 00401348: void fn00401348()
// Called from:
//      fn00401449
void fn00401348()
{
	uint32 ecx_34 = (word32) g_b4022CC;
	<unknown>* edi_32 = g_t4023E8.u0 + g_dw4023EC;
	g_dw4023EC += ecx_34;
	memcpy(edi_32, &g_b4022CD, ecx_34);
}

// 0040136C: void fn0040136C()
// Called from:
//      Win32CrtStartup
void fn0040136C()
{
	Eq_100 eax_16 = CreateThread(null, 0x00, &g_t4013D9, 0x00, 0x04, null);
	g_t4023FC.u0 = (CONTEXT *) eax_16;
	struct Eq_292 * esp_19;
	Eq_100 eax_20;
	g_t40240C();
	g_t4023F8.u0 = (CONTEXT *) eax_20;
	g_dw402000 = 0x00010002;
	esp_19->tFFFFFFFC.u0 = 0x00402000;
	esp_19->tFFFFFFF8.u0 = g_t4023FC.u0;
	GetThreadContext(esp_19->tFFFFFFF8, esp_19->tFFFFFFFC);
	g_dw4020B0 = 0x0040104C;
	esp_19->tFFFFFFFC.u0 = 0x00402000;
	esp_19->tFFFFFFF8.u0 = g_t4023FC.u0;
	SetThreadContext(esp_19->tFFFFFFF8, esp_19->tFFFFFFFC);
	esp_19->tFFFFFFFC.u0 = g_t4023FC.u0;
	ResumeThread(esp_19->tFFFFFFFC);
	esp_19->tFFFFFFFC.u0 = g_t4023F8.u0;
	SuspendThread(esp_19->tFFFFFFFC);
}

DWORD g_t4013D9(LPVOID lpThreadParameter) = ??/* Unexpected function type (fn DWORD (LPVOID)) */ ; // 004013D9
// 004013DA: void fn004013DA()
// Called from:
//      Win32CrtStartup
void fn004013DA()
{
	struct Eq_364 * fs;
	Eq_365 eax_11 = fs->ptr0000->dw0004 & 0xFFFF0000;
	do
		eax_11 -= 0x00010000;
	while (eax_11.u0->w0000 != 23117);
	g_t402404.u0 = (struct Eq_507 *) eax_11;
	g_t402408 = GetProcAddress(eax_11, "LoadLibraryA");
	g_t40240C = GetProcAddress(g_t402404.u0, "GetCurrentThread");
}

// 00401449: Register Eq_222 fn00401449()
// Called from:
//      Win32CrtStartup
Eq_222 fn00401449()
{
	Eq_100 eax_23 = HeapCreate(0x01, 0x00, 0x00);
	g_t4023F4.u0 = (CONTEXT *) eax_23;
	g_t4023E8.u0 = (byte *) HeapAlloc(eax_23, 0x08, 60000);
	Eq_100 eax_41 = HeapCreate(0x01, 0x00, 0x00);
	g_t402400.u0 = (CONTEXT *) eax_41;
	g_t4023D8.u0 = (byte *) HeapAlloc(eax_41, 0x08, 0x00C35000);
	fn00401284();
	g_dw4023E0 = 0x09;
	Eq_222 eax_62 = fn0040109A();
	fn0040130A(eax_62);
	fn00401348();
	Eq_222 dwLoc0C_185 = eax_62;
	Eq_222 eax_168 = SEQ(SLICE(eax_62, word24, 8), fn004012FC());
	while (g_dw4023D4 - g_dw4023C4 >= g_dw4023E0)
	{
		Eq_222 eax_98 = fn0040109A();
		if (eax_98 > g_t4023DC.u0 - 0x01)
		{
			fn0040130A(dwLoc0C_185);
			fn00401332();
		}
		else
			fn0040130A(eax_98);
		fn00401348();
		fn004012FC();
		fn0040130A(dwLoc0C_185);
		fn00401332();
		fn004012A7();
		eax_168 = eax_98;
		dwLoc0C_185 = eax_98;
	}
	return eax_168;
}

word32 g_dw401578 = 5540; // 00401578
word32 g_dw40157C = 5556; // 0040157C
word32 g_dw401580 = 5574; // 00401580
word32 g_dw401584 = 5594; // 00401584
word32 g_dw401588 = 5606; // 00401588
word32 g_dw40158C = 0x15F4; // 0040158C
word32 g_dw401590 = 0x1602; // 00401590
word32 g_dw401594 = 0x1612; // 00401594
word32 g_dw401598 = 0x1626; // 00401598
word32 g_dw40159C = 0x1636; // 0040159C
