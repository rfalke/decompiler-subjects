/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int start();

//-------------------------------------------------------------------------
// Data declarations

// extern DWORD (__stdcall *GetFileSize)(HANDLE hFile, LPDWORD lpFileSizeHigh);
// extern BOOL (__stdcall *CloseHandle)(HANDLE hObject);
// extern BOOL (__stdcall *VirtualProtect)(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);
// extern HANDLE (__stdcall *OpenMutexA)(DWORD dwDesiredAccess, BOOL bInheritHandle, LPCSTR lpName);
// extern DWORD (__stdcall *GetFileType)(HANDLE hFile);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);
_UNKNOWN unk_431000; // weak
CHAR aDxuyr[] = "DxUYr"; // idb
CHAR aL140un[] = "L140UN"; // idb
CHAR Name[] = "yoWmZEdQ"; // idb
CHAR aNviscmxuw[] = "nVIsCMxUW"; // idb
CHAR LibFileName[] = "ddraw.dll"; // idb
CHAR a441okdextqvw[] = "441OKdExTqVW"; // idb
CHAR aTsls7qy5[] = "tsLS7qY5"; // idb
CHAR aNjy9peulrsh[] = "NJy9PeULrsH"; // idb
CHAR a6rzewww9dq[] = "6RZewww9dq"; // idb
CHAR a8ib3oolm[] = "8iB3OoLM"; // idb
CHAR aZv5fvq9q[] = "zv5fVq9q"; // idb
CHAR aZ7tnef9fhze[] = "z7tnEF9FhZe"; // idb
CHAR aXneohu[] = "xneOhu"; // idb
CHAR a5pnpkg1oo[] = "5PNPkG1OO"; // idb
CHAR ProcName[] = "DirectDrawEnumerateExW"; // idb
CHAR aXhm36m6k9l9phx[] = "XhM36M6K9l9pHxmc"; // idb
CHAR aVl2haoqwpi0[] = "VL2haoqWPi0"; // idb
CHAR aSwmtdmbaj[] = "SWMtdMbaj"; // idb


//----- (0040108C) --------------------------------------------------------
int start()
{
  const CHAR *v1; // [esp-4h] [ebp-58h]
  DWORD *v2; // [esp-4h] [ebp-58h]
  HANDLE v3; // [esp+0h] [ebp-54h]
  HANDLE v4; // [esp+4h] [ebp-50h]
  HANDLE v5; // [esp+4h] [ebp-50h]
  DWORD v6; // [esp+8h] [ebp-4Ch]
  void (*v7)(void); // [esp+8h] [ebp-4Ch]
  char *v8; // [esp+8h] [ebp-4Ch]
  DWORD *v9; // [esp+Ch] [ebp-48h]
  HANDLE v10; // [esp+Ch] [ebp-48h]
  HANDLE v11; // [esp+18h] [ebp-3Ch]
  int v12; // [esp+1Ch] [ebp-38h]
  int v13; // [esp+1Ch] [ebp-38h]
  HRESULT (__stdcall *DirectDrawEnumerateExW)(LPDDENUMCALLBACKEXW, LPVOID, DWORD); // [esp+24h] [ebp-30h]
  HANDLE v15; // [esp+28h] [ebp-2Ch]
  HANDLE v16; // [esp+30h] [ebp-24h]
  HANDLE v17; // [esp+30h] [ebp-24h]
  HANDLE v18; // [esp+34h] [ebp-20h]
  HANDLE hFile; // [esp+38h] [ebp-1Ch]
  HANDLE v20; // [esp+3Ch] [ebp-18h]
  HANDLE v21; // [esp+3Ch] [ebp-18h]
  HANDLE v22; // [esp+44h] [ebp-10h]
  HANDLE v23; // [esp+48h] [ebp-Ch]
  HANDLE hObject; // [esp+4Ch] [ebp-8h]
  HMODULE hModule; // [esp+50h] [ebp-4h]

  v22 = OpenMutexA(0x1F0001u, 0, Name);
  if ( v22 )
  {
    GetFileType(v4);
    v3 = OpenMutexA(0x1F0001u, 1, aL140un);
    CloseHandle(v3);
    GetFileType(v16);
    OpenMutexA(0x1F0001u, 0, aTsls7qy5);
    goto LABEL_10;
  }
  hFile = OpenMutexA(0x1F0001u, 1, aXneohu);
  GetFileSize(hFile, 0);
  hObject = OpenMutexA(0x1F0001u, 0, aXhm36m6k9l9phx);
  if ( hObject )
  {
LABEL_10:
    GetFileSize(v4, 0);
    VirtualProtect(v3, (SIZE_T)v4, v6, v9);
    v15 = OpenMutexA(0x1F0001u, 0, aDxuyr);
    v10 = &unk_431000;
    if ( OpenMutexA(0x1F0001u, 1, a8ib3oolm) )
      goto LABEL_7;
    GetFileSize(v11, 0);
    v18 = OpenMutexA(0x1F0001u, 0, aNjy9peulrsh);
    CloseHandle(v18);
    GetFileSize(hObject, 0);
    CloseHandle(v16);
    v6 = v12 + 1856631165;
    CloseHandle(v20);
    goto LABEL_12;
  }
  CloseHandle(0);
  GetFileSize(0, 0);
  v10 = OpenMutexA(0x1F0001u, 0, a6rzewww9dq);
  if ( !v10 )
  {
    v1 = aNviscmxuw;
    while ( 1 )
    {
      v23 = OpenMutexA(0x1F0001u, 0, v1);
      GetFileSize(v22, 0);
LABEL_6:
      GetFileType(hObject);
      GetFileType(v23);
      CloseHandle(hObject);
      v2 = 0;
LABEL_7:
      GetFileSize(v10, v2);
      v21 = OpenMutexA(0x1F0001u, 0, aSwmtdmbaj);
      GetFileType(hObject);
      hModule = LoadLibraryA(LibFileName);
      CloseHandle(v23);
      CloseHandle(v21);
      GetFileSize(hObject, 0);
      GetFileSize(hObject, 0);
      DirectDrawEnumerateExW = (HRESULT (__stdcall *)(LPDDENUMCALLBACKEXW, LPVOID, DWORD))GetProcAddress(
                                                                                            hModule,
                                                                                            ProcName);
      CloseHandle(v22);
      OpenMutexA(0x1F0001u, 1, a5pnpkg1oo);
      GetFileType(hObject);
      GetFileSize(v21, 0);
      GetFileType(v23);
      v1 = 0;
      GetFileSize(v23, 0);
      GetFileSize(hObject, 0);
      GetFileType(v22);
      v13 = ((int (__cdecl *)(_DWORD))DirectDrawEnumerateExW)(0);
      v5 = OpenMutexA(0x1F0001u, 1, aZv5fvq9q);
      GetFileSize(v23, 0);
      if ( !OpenMutexA(0x1F0001u, 0, aVl2haoqwpi0) )
      {
        GetFileSize(v5, 0);
        v17 = OpenMutexA(0x1F0001u, 0, a441okdextqvw);
        GetFileType(v17);
        __asm { jmp     [ebp+var_4C] }
      }
    }
  }
LABEL_12:
  CloseHandle(v3);
  v7 = (void (*)(void))(v6 + 295034519);
  v7();
  v8 = (char *)v7 - 720879622;
  if ( OpenMutexA(0x1F0001u, 0, aZ7tnef9fhze) )
    goto LABEL_6;
  GetFileSize(v20, 0);
  CloseHandle(v15);
  return ((int (*)(void))(v8 + 721076244))();
}
// 401140: variable 'hObject' is possibly undefined
// 401149: variable 'v23' is possibly undefined
// 40115D: variable 'v2' is possibly undefined
// 4012F8: variable 'v4' is possibly undefined
// 401326: variable 'v16' is possibly undefined
// 401351: variable 'v3' is possibly undefined
// 401351: variable 'v6' is possibly undefined
// 401351: variable 'v9' is possibly undefined
// 401393: variable 'v11' is possibly undefined
// 4013D9: variable 'v12' is possibly undefined
// 4013E3: variable 'v20' is possibly undefined
// 401435: variable 'v15' is possibly undefined

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
