/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall start(int a1@<eax>, int a2@<ebx>, int a3@<esi>);
// __int32 __usercall sub_401037@<eax>(__int32 a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>, double a6@<st1>, double a7@<st0>);
// void __usercall sub_401077(int a1@<ecx>, int a2@<ebx>, int a3@<edi>, int a4@<esi>);
void sub_4010B1();
void __fastcall sub_4010DD(unsigned __int8 a1);
// void __usercall sub_40118E(int a1@<eax>, int a2@<edx>, int a3@<ecx>, _BYTE *a4@<edi>);
// void __usercall sub_4011C1(__int32 a1@<ebx>);
void sub_4012B6();
void sub_4012DD();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_40132C; // weak


//----- (00401005) --------------------------------------------------------
void __usercall start(int a1@<eax>, int a2@<ebx>, int a3@<esi>)
{
  _BYTE *v5; // eax
  unsigned __int8 v6; // cl

  _EBX = a3 + 1;
  sub_401077(a1 + 1, _EBX, a2, _EBX);
  __asm { bound   esp, [ebx] }
  *v5 &= (unsigned __int8)v5;
  sub_4010DD(v6);
}
// 4010DB: variable 'v5' is possibly undefined
// 4010DC: variable 'v6' is possibly undefined

//----- (00401037) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
__int32 __usercall sub_401037@<eax>(__int32 a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>, double a6@<st1>, double a7@<st0>)
{
  __int32 result; // eax
  int v8; // esi
  __int32 v10; // edi
  __int32 v11; // ebx
  bool v12; // cc
  int v13; // ebx
  int v14; // ebx
  int v15; // ecx
  int v16; // edi
  bool v17; // sf
  int v18; // edi
  __int32 v19; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v19, a1);
  result = v19;
  v8 = a2 ^ a5;
  v10 = v19 ^ a4;
  v11 = v19 ^ (v19 | a3);
  v12 = __CFADD__(v19, v11) || v19 + v11 == 0;
  v13 = v19 + v11;
  if ( v12 || !v12 )
  {
    v14 = v8 ^ (v13 - a2);
    v15 = a3 - 1;
    v16 = v15 ^ (v10 + 1);
    v17 = v15 + v16 < 0;
    v18 = v15 + v16;
    if ( v18 >= 0 && v17 )
    {
      BYTE1(a2) ^= *(_BYTE *)(v14 - 30732382);
      ((void (__usercall *)(__int32@<ecx>, int@<edx>, double@<st0>, double@<st1>))sub_401037)(
        v8 + v14 + v15 - ((v8 + v14) ^ (v19 + v18)),
        a2,
        a7,
        a6);
      JUMPOUT(0x40118D);
    }
    JUMPOUT(0x401109);
  }
  v19 = v8;
  *(_BYTE *)(v13 - 1) ^= BYTE1(a3);
  _enable();
  if ( !result )
    JUMPOUT(0x401250);
  return result;
}
// 40103D: positive sp value 4 has been found
// 40118C: control flows out of bounds to 40118D
// 401163: control flows out of bounds to 401109
// 401303: control flows out of bounds to 401250

//----- (00401077) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401077(int a1@<ecx>, int a2@<ebx>, int a3@<edi>, int a4@<esi>)
{
  sub_4011C1(a1 + a2);
  *(_BYTE *)(a3 + 1) = *(_BYTE *)(a4 - 1);
  JUMPOUT(0x401097);
}
// 40107B: positive sp value 4 has been found
// 401091: control flows out of bounds to 401097

//----- (004010B1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4010B1()
{
  void *v0; // [esp+4h] [ebp-4h]
  void *retaddr; // [esp+8h] [ebp+0h]

  *(&retaddr - 3) = v0;
  JUMPOUT(0x401361);
}
// 4010B5: positive sp value 4 has been found
// 4010BF: control flows out of bounds to 401361

//----- (004010DD) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_4010DD(unsigned __int8 a1)
{
  if ( __OFADD__(1, -23) && !__OFADD__(1, -23) )
  {
    if ( a1 | 0xEA )
      JUMPOUT(0x401298);
    JUMPOUT(0x4010C9);
  }
  JUMPOUT(0x40116F);
}
// 40101B: positive sp value 4 has been found
// 40112A: control flows out of bounds to 49DDAC12
// 401322: control flows out of bounds to 40116F
// 401107: control flows out of bounds to 4010C9
// 401124: control flows out of bounds to 401298

//----- (0040118E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40118E(int a1@<eax>, int a2@<edx>, int a3@<ecx>, _BYTE *a4@<edi>)
{
  char v5; // al

  _ESI = a4;
  v5 = ((int (__fastcall *)(int, int))loc_40132C)(a1 ^ a3, a1 ^ a3 | a2);
  __asm { outsb }
  *a4 = v5;
  JUMPOUT(0x4011A7);
}
// 401192: positive sp value 4 has been found
// 4011A5: control flows out of bounds to 4011A7

//----- (004011C1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4011C1(__int32 a1@<ebx>)
{
  __int32 v1; // [esp-Ch] [ebp-1Ch] BYREF

  _InterlockedExchange(&v1, a1);
  JUMPOUT(0x401349);
}
// 401275: positive sp value 1C has been found
// 401157: control flows out of bounds to 401159
// 4011D9: control flows out of bounds to 401349

//----- (004012B6) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4012B6()
{
  void *v0; // [esp+8h] [ebp-4h]
  void *retaddr[2]; // [esp+Ch] [ebp+0h]

  retaddr[-4] = v0;
  JUMPOUT(0x401219);
}
// 4012BA: positive sp value 4 has been found
// 4012CC: control flows out of bounds to 401219
// 4012D2: conditional instruction was optimized away because of 'ecx.4>=0'

//----- (004012DD) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4012DD()
{
  JUMPOUT(0x40105E);
}
// 4012E5: positive sp value 4 has been found
// 4012EF: control flows out of bounds to 40105E

// nfuncs=9 queued=9 decompiled=9 lumina nreq=0 worse=0 better=0
// ALL OK, 9 function(s) have been successfully decompiled
