/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

void sub_40168A();
void __fastcall sub_40174A(int, int);
void sub_40178D();
// void __usercall sub_401795(unsigned int@<ecx>, void *@<edi>, const void *@<esi>);
void sub_401951();
_BYTE *__cdecl sub_401BCF(_BYTE *);
int sub_40237A();
struct _LIST_ENTRY *sub_4026EF();
void __cdecl sub_402BAA(_BYTE *);
// void __usercall sub_403302(int@<eax>, int@<ebx>);
// unsigned int __usercall sub_405741@<eax>(int@<eax>);
// void __usercall sub_4062BE(char@<al>, int@<edx>, int@<ecx>, int@<ebx>, int@<edi>, int@<esi>, double@<st2>);
// int __userpurge sub_406463@<eax>(int@<eax>, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int);
// void __usercall __noreturn sub_40A4BB(int@<eax>, int@<ebp>, int@<edi>);
// int __userpurge sub_414F0D@<eax>(int@<eax>, int@<edx>, int@<ecx>, int, int);
void __thiscall sub_415277(void *this);
void __fastcall sub_4155E6(int, int);
// void __usercall start(int@<edx>, int@<ecx>, int@<ebx>, int@<edi>, int@<esi>);
int __fastcall sub_4158C7(int, int, int, int);
// int __usercall sub_415998@<eax>(int@<eax>, unsigned int@<edx>, unsigned int@<ecx>);
int __fastcall sub_415BB6(unsigned int, unsigned int, int, int, int, int);
void __fastcall sub_415DDE(int, int);
int __thiscall sub_415EA9(void *this, int, int, int);
// void __usercall sub_416440(int@<eax>, unsigned int@<edx>, unsigned int@<ecx>);
int __fastcall sub_416F11(int, int, int, int, int);
void __stdcall sub_4170FA(int, int, int);
// int __userpurge sub_41733A@<eax>(int result@<eax>, __int16@<dx>, int, int, int, int);
int __stdcall sub_417CE8(int, int);
// unsigned int __userpurge sub_417D39@<eax>(int a1@<eax>, int a2@<ecx>, int a3, int a4, int a5, int a6);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN unk_4230E5; // weak
_UNKNOWN unk_4231E5; // weak
int dword_443004 = 0; // weak
int dword_443008 = 0; // weak
int dword_443010 = 0; // weak
int dword_443014 = 0; // weak
int dword_443018 = 0; // weak
int dword_44301C = 0; // weak
int dword_443020 = 0; // weak
int dword_443028 = 0; // weak
int dword_44302C = 0; // weak
int dword_443030 = 0; // weak
int dword_44303C = 0; // weak
int dword_443040 = 0; // weak
int dword_443044 = 0; // weak
int dword_443048 = 0; // weak
int dword_44304C = 0; // weak
int dword_4431FC = 0; // weak
char byte_44361C = 'D'; // weak
int dword_443678 = -68560193; // weak
char byte_443A5C = '`'; // weak
char byte_443AB0 = 'Z'; // weak
int dword_444000 = -1962916793; // weak
char byte_4445E4 = 'T'; // weak
int (__stdcall *dword_444678)(_DWORD, _DWORD) = NULL; // weak
int dword_4446A4 = 521288629; // weak
_UNKNOWN unk_4446A8; // weak
int dword_4446AC = 0; // weak
int dword_4446D4 = 362436069; // weak
int dword_4446D8 = 0; // weak
int dword_4446E4 = -1247319706; // weak
int dword_4446E8 = 0; // weak
int dword_44471E = 88675123; // weak
int dword_44473A = 0; // weak
int dword_444742 = 53592; // weak
_DWORD dword_444746 = 0; // weak
int dword_444AEC; // weak
// extern HANDLE (__stdcall *GetCurrentProcess)();
// extern DWORD (__stdcall *GetCurrentThreadId)();
// extern DWORD (__stdcall *GetModuleFileNameA)(HMODULE hModule, LPSTR lpFilename, DWORD nSize);
// extern BOOL (__stdcall *GetVersionExA)(LPOSVERSIONINFOA lpVersionInformation);
// extern void (__stdcall *InitializeCriticalSection)(LPCRITICAL_SECTION lpCriticalSection);
// extern LONG (__stdcall *InterlockedCompareExchange)(volatile LONG *Destination, LONG Exchange, LONG Comperand);
// extern LONG (__stdcall *InterlockedExchange)(volatile LONG *Target, LONG Value);
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);


//----- (0040168A) --------------------------------------------------------
void sub_40168A()
{
  JUMPOUT(0x40204A);
}
// 401690: control flows out of bounds to 40204A

//----- (0040174A) --------------------------------------------------------
void __fastcall sub_40174A(int a1, int a2)
{
  dword_4446E4 ^= a2 + 731;
  JUMPOUT(0x402DC9);
}
// 40171E: control flows out of bounds to 402DC9
// 4446E4: using guessed type int dword_4446E4;

//----- (0040178D) --------------------------------------------------------
void sub_40178D()
{
  sub_40168A();
}

//----- (00401795) --------------------------------------------------------
void __usercall sub_401795(unsigned int a1@<ecx>, void *a2@<edi>, const void *a3@<esi>)
{
  LOBYTE(dword_44303C) = 0;
  qmemcpy(a2, a3, a1);
}
// 44303C: using guessed type int dword_44303C;

//----- (00401951) --------------------------------------------------------
void sub_401951()
{
  JUMPOUT(0x401E17);
}
// 403525: control flows out of bounds to 401E17

//----- (00401BCF) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
_BYTE *__cdecl sub_401BCF(_BYTE *a1)
{
  _BYTE *result; // eax
  char v2; // cl
  _BYTE *retaddr; // [esp+4h] [ebp+0h]

  result = retaddr;
  v2 = *retaddr;
  *retaddr = *a1;
  *a1 = v2;
  return result;
}
// 401CA1: positive sp value 4 has been found

//----- (0040237A) --------------------------------------------------------
int sub_40237A()
{
  unsigned int v0; // eax
  int v1; // ebx
  int result; // eax
  LONG (__stdcall **v3)(volatile LONG *, LONG, LONG); // ebx

  LOBYTE(dword_443030) = dword_443030 - 29;
  LOBYTE(dword_443028) = dword_443028 + 1;
  dword_44303C += 26099;
  v0 = dword_444742 ^ (dword_444742 << 11);
  dword_443010 += 16939;
  dword_444742 = dword_4446D4;
  dword_4446D4 = dword_4446A4;
  v3 = &InterlockedCompareExchange;
  dword_4446A4 = dword_44471E;
  dword_44301C = (int)&InterlockedExchange;
  LOBYTE(dword_443030) = dword_443030 + 64;
  LOBYTE(v3) = (unsigned __int8)&InterlockedCompareExchange - byte_443A5C;
  BYTE1(v3) = ((unsigned __int16)&InterlockedCompareExchange >> 8) - byte_4445E4;
  LOBYTE(dword_443040) = dword_443040 - 62;
  dword_443014 += 26835;
  dword_443040 += (int)v3 + v0 - 1;
  dword_44471E ^= (v0 >> 8) ^ v0 ^ ((unsigned int)dword_44471E >> 19);
  v1 = dword_444AEC;
  dword_4446AC = dword_44471E;
  BYTE1(v1) = BYTE1(dword_444AEC) - byte_44361C;
  result = dword_44471E;
  dword_44302C = 2725 - (__CFADD__(dword_444000, v1) + 19761);
  return result;
}
// 443010: using guessed type int dword_443010;
// 443014: using guessed type int dword_443014;
// 44301C: using guessed type int dword_44301C;
// 443028: using guessed type int dword_443028;
// 44302C: using guessed type int dword_44302C;
// 443030: using guessed type int dword_443030;
// 44303C: using guessed type int dword_44303C;
// 443040: using guessed type int dword_443040;
// 44361C: using guessed type char byte_44361C;
// 443A5C: using guessed type char byte_443A5C;
// 444000: using guessed type int dword_444000;
// 4445E4: using guessed type char byte_4445E4;
// 4446A4: using guessed type int dword_4446A4;
// 4446AC: using guessed type int dword_4446AC;
// 4446D4: using guessed type int dword_4446D4;
// 44471E: using guessed type int dword_44471E;
// 444742: using guessed type int dword_444742;
// 444AEC: using guessed type int dword_444AEC;

//----- (004026EF) --------------------------------------------------------
struct _LIST_ENTRY *sub_4026EF()
{
  int v0; // edi
  int v1; // ecx
  struct _LIST_ENTRY *v2; // ebx
  struct _PEB_LDR_DATA *Ldr; // edx
  struct _LIST_ENTRY *Flink; // edx
  int Flink_low; // eax
  struct _LIST_ENTRY *v6; // esi
  struct _LIST_ENTRY *result; // eax
  int v8; // [esp+4h] [ebp-4h]

  LOBYTE(dword_44304C) = dword_44304C + 42;
  Ldr = NtCurrentPeb()->Ldr;
  LOBYTE(dword_443044) = dword_443044 + 72;
  Flink = Ldr->InMemoryOrderModuleList.Flink;
  do
  {
    v6 = Flink[5].Flink;
    v1 = 24;
    LOBYTE(dword_443040) = dword_443040 + 24;
    v0 = 0;
    do
    {
      dword_44301C = 20293;
      Flink_low = LOBYTE(v6->Flink);
      v6 = (struct _LIST_ENTRY *)((char *)v6 + 1);
      dword_443018 = 226;
      if ( (char)Flink_low >= 97 )
        LOBYTE(Flink_low) = Flink_low - 32;
      v0 = Flink_low + __ROR4__(v0, 13);
      LOBYTE(dword_44301C) = dword_44301C + 82;
      --v1;
    }
    while ( v1 );
    v2 = Flink[2].Flink;
    Flink = Flink->Flink;
  }
  while ( v0 != 1783282779 );
  result = v2;
  dword_443008 -= 27125;
  dword_44301C = (int)v2 + dword_4431FC;
  dword_443020 = v8;
  return result;
}
// 4022AF: variable 'v8' is possibly undefined
// 443008: using guessed type int dword_443008;
// 443010: using guessed type int dword_443010;
// 443018: using guessed type int dword_443018;
// 44301C: using guessed type int dword_44301C;
// 443020: using guessed type int dword_443020;
// 443040: using guessed type int dword_443040;
// 443044: using guessed type int dword_443044;
// 44304C: using guessed type int dword_44304C;
// 4431FC: using guessed type int dword_4431FC;

//----- (00402BAA) --------------------------------------------------------
void __cdecl sub_402BAA(_BYTE *a1)
{
  unsigned int v1; // eax

  v1 = 0;
  while ( *a1 )
    v1 = (char)*a1++ ^ ((v1 >> 25) | (v1 << 7));
  JUMPOUT(0x401D2C);
}
// 40194C: control flows out of bounds to 401D2C

//----- (00403302) --------------------------------------------------------
void __usercall sub_403302(int a1@<eax>, int a2@<ebx>)
{
  char v2; // al
  int v3; // ecx
  _BYTE *v4; // edi
  int v5; // [esp-4h] [ebp-4h]

  v3 = 0x2000;
  dword_443010 = a1 ^ a2;
  v4 = &unk_4231E5;
  do
  {
    v5 = v3;
    v2 = sub_40237A();
    dword_44304C += 6784;
    *v4++ = v2;
    dword_443040 = (int)&LoadLibraryA;
    dword_443004 = (int)&GetModuleFileNameA;
    dword_44303C += 16261;
    v3 = v5 - 1;
  }
  while ( v5 != 1 );
  LOBYTE(dword_443020) = dword_443020 + 114;
  dword_443044 = 13704;
  dword_443040 -= 5220;
  dword_444678(255, &unk_4230E5);
  JUMPOUT(0x401E46);
}
// 4013B4: control flows out of bounds to 401E46
// 443004: using guessed type int dword_443004;
// 443010: using guessed type int dword_443010;
// 443020: using guessed type int dword_443020;
// 44303C: using guessed type int dword_44303C;
// 443040: using guessed type int dword_443040;
// 443044: using guessed type int dword_443044;
// 44304C: using guessed type int dword_44304C;
// 444678: using guessed type int (__stdcall *dword_444678)(_DWORD, _DWORD);

//----- (004036C7) --------------------------------------------------------
#error "4036C7: stack frame is too big (funcsize=0)"

//----- (00405741) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
unsigned int __usercall sub_405741@<eax>(int a1@<eax>)
{
  void *retaddr; // [esp+0h] [ebp+0h] BYREF

  return (unsigned int)&retaddr & a1;
}
// 405743: positive sp value 8 has been found
// 405743: returning address of temporary local variable '%" r"'

//----- (004062BE) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4062BE(
        char a1@<al>,
        int a2@<edx>,
        int a3@<ecx>,
        int a4@<ebx>,
        int a5@<edi>,
        int a6@<esi>,
        double a7@<st2>)
{
  int v7; // esi
  bool v8; // cf
  int v10; // ebx
  int v11; // edx
  __int16 v12; // [esp-Ch] [ebp-Ch]
  int v13; // [esp-8h] [ebp-8h]
  unsigned int v14; // [esp-4h] [ebp-4h]

  *(_DWORD *)(a5 - 1065215029) |= 0x4390BA44u;
  v7 = *MK_FP(v12, a4) & a6;
  v8 = __CFSHL__(*MK_FP(v12, a3 + 5), -43);
  *MK_FP(v12, a3 + 5) = 0;
  _ECX = a3 + 1;
  v10 = a5 + v8 + v13;
  LOBYTE(v10) = -24;
  if ( __SETP__(a5 + v8 + v13, 0) )
  {
    *MK_FP(v12, a2) = v7 ^ *MK_FP(v12, a2);
  }
  else
  {
    __writeeflags(v14);
    *MK_FP(v12, v10 - 926971594) = a1 & *MK_FP(v12, v10 - 926971594);
    v11 = a2 - 1;
    if ( __CFADD__(__CFSHL__(a1, _ECX), a1 << _ECX) | ((unsigned __int8)(__CFSHL__(a1, _ECX) + (a1 << _ECX)) >= 0xB0u) )
    {
      BYTE1(v11) ^= v11;
      *MK_FP(v12, v11) = *MK_FP(v12, v11) - 111;
      _enable();
      __asm
      {
        fmulp   st(2), st
        iret
      }
      JUMPOUT(0x406303);
    }
  }
  __asm
  {
    lock fist dword ptr [ecx+1Ah]
    fyl2xp1
  }
  JUMPOUT(0x148BB99B);
}
// 4062E7: positive sp value C has been found
// 406300: inconsistent fpu stack
// 406302: control flows out of bounds to 406303
// 40636C: control flows out of bounds to 148BB99B
// 4062D2: variable 'v12' is possibly undefined
// 4062E0: variable 'v13' is possibly undefined
// 4062E6: variable 'v14' is possibly undefined

//----- (00406463) --------------------------------------------------------
int __userpurge sub_406463@<eax>(
        int a1@<eax>,
        int a2,
        int a3,
        int a4,
        int a5,
        int a6,
        int a7,
        int a8,
        int a9,
        int a10,
        int a11,
        int a12,
        int a13,
        int a14,
        int a15,
        int a16,
        int a17,
        int a18,
        int a19,
        int a20,
        int a21,
        int a22,
        int a23,
        int a24,
        int a25,
        int a26,
        int a27,
        int a28,
        int a29,
        int a30,
        int a31,
        int a32,
        int a33,
        int a34,
        int a35,
        int a36,
        int a37,
        int a38,
        int a39,
        int a40,
        int a41,
        int a42,
        int a43,
        int a44,
        int a45,
        int a46,
        int a47,
        int a48,
        int a49,
        int a50,
        int a51,
        int a52,
        int a53,
        int a54,
        int a55,
        int a56,
        int a57,
        int a58,
        int a59,
        int a60,
        int a61,
        int a62,
        int a63)
{
  return a1 - 1;
}
// 406463: too many input arguments, some ignored

//----- (0040A4BB) --------------------------------------------------------
void __usercall __noreturn sub_40A4BB(int a1@<eax>, int a2@<ebp>, int a3@<edi>)
{
  *(_DWORD *)(a3 + 4 * a2 + 1802901961) -= a1;
  __asm { int     0DBh; used by BASIC while in interpreter }
  __halt();
}

//----- (00414F0D) --------------------------------------------------------
int __userpurge sub_414F0D@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4, int a5)
{
  int v5; // eax
  bool v6; // cf
  int v8; // eax
  int v9; // [esp+118h] [ebp-F8h]
  int v10; // [esp+17Ch] [ebp-94h]

  v8 = v10 + __CFADD__(a1 + 35633, a1 + 35633) + 2 * (a1 + 35633) + 4349;
  if ( !a3 )
  {
    v6 = 0;
    if ( (v8 & a2) != 0 )
      return (v8 - (v6 + 10039)) ^ 0x3FDF | 0x323C;
    v8 = -v9;
  }
  v5 = v8 & 0x3C2;
  v6 = __CFADD__(v5, 14781);
  v8 = v5 + 14781;
  return (v8 - (v6 + 10039)) ^ 0x3FDF | 0x323C;
}
// 416A18: variable 'v10' is possibly undefined
// 41656F: variable 'v9' is possibly undefined

//----- (00415277) --------------------------------------------------------
void __thiscall sub_415277(void *this)
{
  __int16 v1; // ax
  char v2; // cf
  int v3; // eax
  int v4; // eax
  __int16 v5; // dx
  int v6; // ecx
  char v7[12]; // [esp+24h] [ebp-1DCh] BYREF
  int v8; // [esp+84h] [ebp-17Ch]
  int v9; // [esp+9Ch] [ebp-164h]
  int v10; // [esp+118h] [ebp-E8h]
  char v11[16]; // [esp+174h] [ebp-8Ch] BYREF
  int v12; // [esp+198h] [ebp-68h]

  v4 = sub_4158C7((int)this, (int)v11, 24, (int)v11) & 0x1E50;
  v3 = ((v10 ^ (unsigned int)(v4 + 15102)) < 0xA73) + (v10 ^ (v4 + 15102)) - 2675 + 6407;
  if ( v6 || (v5 & 0x903) == 0 )
    v9 -= v3;
  v1 = sub_415BB6((unsigned int)v7, 0, 0, v8, (int)v7, 0);
  v12 += (v1 - (v2 + 11666)) & 0x26C | 0x25B6;
  JUMPOUT(0x415F14);
}
// 41720F: control flows out of bounds to 415F14
// 416DC9: variable 'v2' is possibly undefined
// 417458: variable 'v6' is possibly undefined
// 417466: variable 'v5' is possibly undefined

//----- (004155E6) --------------------------------------------------------
void __fastcall sub_4155E6(int a1, int a2)
{
  int v2; // ecx
  unsigned int v3; // ecx
  int v4; // ecx
  int v5; // eax
  unsigned int v6; // edx
  int v7; // ecx
  _BYTE v8[28]; // [esp-23Ch] [ebp-240h] BYREF
  _BYTE v9[84]; // [esp-220h] [ebp-224h] BYREF
  int v10; // [esp-1CCh] [ebp-1D0h]
  int v11; // [esp-170h] [ebp-174h]
  int v12[32]; // [esp-7Ch] [ebp-80h] BYREF

  sub_4158C7((int)v9, a2, 39, (int)v9);
  sub_417CE8(10, v11);
  sub_417CE8(1, v2);
  sub_415BB6(v3, 0, 0, (int)v12, (int)v12, 0);
  sub_4158C7(v4, (int)v12, 23, (int)v12);
  sub_417CE8(9, 2136167811);
  sub_40237A();
  v5 = (((sub_417CE8(57, 1203005452) | 0x32CE) + 8138) ^ 0x30CB) - 10514;
  if ( !v7 )
    v10 |= v5;
  sub_415BB6((unsigned int)v8, v6, 0, v12[27], (int)v8, 0);
  JUMPOUT(0x4162AB);
}
// 417039: control flows out of bounds to 4162AB
// 414E9E: variable 'v2' is possibly undefined
// 415559: variable 'v3' is possibly undefined
// 415564: variable 'v4' is possibly undefined
// 415C5A: variable 'v7' is possibly undefined
// 417940: variable 'v6' is possibly undefined

//----- (0041575A) --------------------------------------------------------
void __usercall start(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>)
{
  int v5; // edx
  int v6; // edx
  int v7; // ecx
  char v8[28]; // [esp+F0h] [ebp-180h] BYREF
  char v9[248]; // [esp+10Ch] [ebp-164h] BYREF

  LOBYTE(dword_44301C) = dword_44301C + 110;
  dword_4446E8 = a4;
  dword_4446D8 = a1;
  LOBYTE(dword_443048) = -15;
  dword_443008 -= (unsigned int)&InitializeCriticalSection ^ 0x3DAF;
  dword_44473A = a5;
  dword_443020 = a1;
  dword_443004 += a1;
  dword_44301C += (int)&GetVersionExA;
  unk_4446A8 = a2;
  dword_44304C = 10664;
  v5 = dword_443678;
  dword_444746 = a3;
  dword_443018 -= 10664;
  BYTE1(v5) = byte_443AB0;
  sub_415BB6((unsigned int)&dword_444746, v5, 0, v5, (int)v8, 0);
  sub_415DDE(v7, v6);
  sub_4170FA(39, (int)v9, 0);
  JUMPOUT(0x415F02);
}
// 415808: control flows out of bounds to 415F02
// 417188: variable 'v7' is possibly undefined
// 417188: variable 'v6' is possibly undefined
// 443004: using guessed type int dword_443004;
// 443008: using guessed type int dword_443008;
// 443018: using guessed type int dword_443018;
// 44301C: using guessed type int dword_44301C;
// 443020: using guessed type int dword_443020;
// 443030: using guessed type int dword_443030;
// 443048: using guessed type int dword_443048;
// 44304C: using guessed type int dword_44304C;
// 443678: using guessed type int dword_443678;
// 443AB0: using guessed type char byte_443AB0;
// 4446D8: using guessed type int dword_4446D8;
// 4446E8: using guessed type int dword_4446E8;
// 44473A: using guessed type int dword_44473A;
// 444746: using guessed type _DWORD dword_444746;
// 4447A4: using guessed type int dword_4447A4;
// 41575A: using guessed type char var_180[28];
// 41575A: using guessed type char var_164[248];

//----- (004158C7) --------------------------------------------------------
int __fastcall sub_4158C7(int a1, int a2, int a3, int a4)
{
  unsigned int v4; // edx
  int v5; // eax
  int v6; // ecx
  unsigned int v7; // edx
  int v8; // eax
  unsigned int v9; // edx
  unsigned int v10; // ecx
  int v11; // eax
  unsigned int v12; // edx
  unsigned int v13; // ecx
  int v14; // eax
  char v15; // cf
  char v17[52]; // [esp+84h] [ebp-348h] BYREF
  char v18[104]; // [esp+B8h] [ebp-314h] BYREF
  char v19[88]; // [esp+120h] [ebp-2ACh] BYREF
  char v20[16]; // [esp+178h] [ebp-254h] BYREF
  char v21[360]; // [esp+188h] [ebp-244h] BYREF
  int v22; // [esp+2F0h] [ebp-DCh]

  sub_414F0D((int)v18, a2, 0, (int)v18, 0);
  sub_415BB6((unsigned int)v20, v4, 0, 1669981493, (int)v20, 0);
  v5 = sub_415BB6(0, 0, 0, (int)v21, (int)v21, 0);
  sub_414F0D(v5 | 0x35, (int)v19, v6, (int)v19, 0);
  v8 = sub_415BB6(0, v7, 0, v22, (int)v17, 0);
  v11 = sub_415998(v8 ^ 0x3E25, v9, v10);
  v14 = sub_415998(v11 + 16133, v12, v13);
  return v14 + v15 + v14;
}
// 4168EA: variable 'v4' is possibly undefined
// 416913: variable 'v6' is possibly undefined
// 416965: variable 'v7' is possibly undefined
// 416974: variable 'v9' is possibly undefined
// 416974: variable 'v10' is possibly undefined
// 41697E: variable 'v12' is possibly undefined
// 41697E: variable 'v13' is possibly undefined
// 416983: variable 'v15' is possibly undefined
// 4158C7: using guessed type char var_348[52];

//----- (00415998) --------------------------------------------------------
int __usercall sub_415998@<eax>(int a1@<eax>, unsigned int a2@<edx>, unsigned int a3@<ecx>)
{
  int v3; // eax
  unsigned int v4; // eax
  int v6; // eax
  int v7; // [esp+154h] [ebp-194h]
  unsigned int v8; // [esp+160h] [ebp-188h]

  v4 = a1 ^ 0x1649;
  if ( v8 <= a3 )
    v4 = (v4 ^ 0x1CB9) + 8701;
  v3 = (__PAIR64__(v4 - 8098, v4) - 0x222600001FA2i64 - (((unsigned int)(v4 < 0x1FA2) + 8742) | 0x303000000000i64)) >> 32;
  v6 = ((2 * v3 - (__CFADD__(v3, v3) + v7)) ^ 0x3376 | 0x28CC) + 1779;
  if ( a2 < a3 )
    goto LABEL_7;
  if ( a2 )
  {
    v6 = 0;
LABEL_7:
    v6 += 7340;
  }
  return v6 | 0x3776;
}
// 4159AC: variable 'v8' is possibly undefined
// 417A1E: variable 'v7' is possibly undefined

//----- (00415BB6) --------------------------------------------------------
int __fastcall sub_415BB6(unsigned int a1, unsigned int a2, int a3, int a4, int a5, int a6)
{
  int v6; // eax
  char v7; // cf
  unsigned int v8; // edx
  unsigned int v9; // ecx
  unsigned int v10; // edx
  unsigned int v11; // ecx
  int v12; // eax
  unsigned int v13; // edx
  unsigned int v14; // ecx
  __int16 v16; // [esp+2DCh] [ebp-98h]

  if ( (v16 & 0x143E) != 0 || v16 )
    JUMPOUT(0x4160E4);
  v6 = sub_415998(0, a2, a1);
  sub_415998(v6 - (v7 + 2279), v8, v9);
  v12 = sub_415998(0, v10, v11);
  return sub_415998(v7 + v12 + 274, v13, v14);
}
// 415BEF: control flows out of bounds to 4160E4
// 415BD0: variable 'v16' is possibly undefined
// 4179AC: variable 'v7' is possibly undefined
// 4179B1: variable 'v8' is possibly undefined
// 4179B1: variable 'v9' is possibly undefined
// 4179B8: variable 'v10' is possibly undefined
// 4179B8: variable 'v11' is possibly undefined
// 4179C2: variable 'v13' is possibly undefined
// 4179C2: variable 'v14' is possibly undefined

//----- (00415DDE) --------------------------------------------------------
void __fastcall sub_415DDE(int a1, int a2)
{
  __int16 v2; // cx
  int v3; // eax
  char v4[76]; // [esp+18h] [ebp-100h] BYREF
  char v5[20]; // [esp+64h] [ebp-B4h] BYREF
  int v6; // [esp+78h] [ebp-A0h]

  sub_4158C7((int)v4, a2, 7, (int)v4);
  sub_4170FA(49, (int)v5, 0);
  v6 += ((2 * v3) ^ 0x24D7) - 10370 + 5749;
  if ( (v2 & 0x136B) == 0 )
    JUMPOUT(0x416284);
  JUMPOUT(0x41569F);
}
// 4179D1: control flows out of bounds to 41569F
// 417BE6: control flows out of bounds to 416284
// 416AA3: variable 'v3' is possibly undefined
// 416922: variable 'v2' is possibly undefined
// 415DDE: using guessed type char var_B4[20];

//----- (00415EA9) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __thiscall sub_415EA9(void *this, int a2, int a3, int a4)
{
  unsigned int v4; // edx
  int v5; // ecx
  unsigned int v6; // edx
  unsigned int v7; // ecx
  int v8; // ecx
  unsigned int v9; // eax
  int v10; // eax
  int v11; // edx
  __int16 v12; // dx
  __int16 v13; // ax
  int v14; // edx
  char v15; // cf
  __int16 v16; // ax
  int result; // eax
  int v18; // eax
  unsigned int v19; // edx
  unsigned int v20; // ecx
  unsigned __int16 v21; // [esp+178h] [ebp-218h]
  int v22[10]; // [esp+184h] [ebp-20Ch] BYREF
  char v23[4]; // [esp+218h] [ebp-178h] BYREF
  int v24; // [esp+21Ch] [ebp-174h] BYREF
  char v25[4]; // [esp+228h] [ebp-168h] BYREF
  int v26; // [esp+238h] [ebp-158h]
  int v27; // [esp+298h] [ebp-F8h]
  char v28[4]; // [esp+2B8h] [ebp-D8h] BYREF
  char v29[40]; // [esp+2F4h] [ebp-9Ch] BYREF
  int v30; // [esp+360h] [ebp-30h]
  int v31; // [esp+380h] [ebp-10h]

  sub_415277(this);
  sub_415BB6((unsigned int)&v24, 0, 0, v27, (int)&v24, 0);
  if ( v4 == v5 && !v4 )
    v26 ^= v29[36] & 0x70;
  v10 = sub_415BB6((unsigned int)&v24, v4, 0, -2084630040, (int)&v24, 0);
  sub_415998(v10 | 0x2161, v6, v7);
  v9 = sub_417CE8(30, v8);
  sub_416F11(0, v11, v11, 0, (v9 < 0x2F3B) + v9 - 12091 + 13517);
  sub_4170FA(30, (int)v22, 0);
  sub_4170FA(15, (int)v28, 0);
  v18 = sub_414F0D(19529, 0, (int)v25, (int)v25, 0);
  sub_415998(v18, v19, v20);
  sub_415BB6((unsigned int)v29, 0, 0, v30, (int)v29, 0);
  v13 = sub_41733A((int)v23, v12, v22[9], 1345616562, (int)v23, 0);
  v16 = 2 * (v13 - (v15 + 13628));
  result = v16 & 0x161D;
  if ( (v14 & v31) == 0 )
    return v21;
  return result;
}
// 40160B: positive sp value 254 has been found
// 415FA3: variable 'v4' is possibly undefined
// 4173A6: variable 'v6' is possibly undefined
// 4173A6: variable 'v7' is possibly undefined
// 4173AE: variable 'v8' is possibly undefined
// 417626: variable 'v11' is possibly undefined
// 417D24: variable 'v19' is possibly undefined
// 417D24: variable 'v20' is possibly undefined
// 417826: variable 'v12' is possibly undefined
// 41782B: variable 'v15' is possibly undefined
// 417022: variable 'v5' is possibly undefined
// 417843: variable 'v14' is possibly undefined
// 416D4E: variable 'v21' is possibly undefined
// 415EA9: using guessed type char var_D8[4];
// 415EA9: using guessed type char var_178[4];
// 415EA9: using guessed type char var_168[4];

//----- (00416440) --------------------------------------------------------
void __usercall sub_416440(int a1@<eax>, unsigned int a2@<edx>, unsigned int a3@<ecx>)
{
  int savedregs; // [esp+10Ch] [ebp+0h]

  sub_415998(a1, a2, a3);
  savedregs = 36;
  JUMPOUT(0x415FE3);
}
// 41645B: control flows out of bounds to 415FE3

//----- (00416F11) --------------------------------------------------------
int __fastcall sub_416F11(int a1, int a2, int a3, int a4, int a5)
{
  unsigned int v5; // eax
  int v6; // eax
  int v7; // eax
  bool v8; // cf
  __int16 v9; // ax
  int v10; // eax
  unsigned int v11; // eax
  int v12; // edx
  int v13; // ecx
  unsigned int v14; // edx
  unsigned int v15; // ecx
  int v16; // edx
  int v17; // ecx
  int v18; // ecx
  int v20; // [esp+44h] [ebp-250h]
  char v21[44]; // [esp+84h] [ebp-210h] BYREF
  char v22[4]; // [esp+B0h] [ebp-1E4h] BYREF
  char v23[52]; // [esp+B4h] [ebp-1E0h] BYREF
  char v24[172]; // [esp+E8h] [ebp-1ACh] BYREF
  char v25[16]; // [esp+194h] [ebp-100h] BYREF
  char v26[60]; // [esp+1A4h] [ebp-F0h] BYREF
  unsigned int v27; // [esp+1E0h] [ebp-B4h]
  int v28; // [esp+204h] [ebp-90h]
  unsigned __int8 v29; // [esp+25Ch] [ebp-38h]

  sub_415DDE(0, a2);
  sub_414F0D(0, v16, (int)v21, (int)v21, 0);
  sub_417D39(v29 ^ 0x3325, v17, (int)v22, 0, 24, 8);
  sub_414F0D((int)v24, v12, v13, (int)v24, 0);
  v9 = 5365;
  v8 = v15 < v14;
  if ( v15 < v14 )
    goto LABEL_8;
  LOWORD(v5) = 12701;
  if ( v15 != v27 )
  {
LABEL_11:
    LOWORD(v5) = v5 | 0x1AC1;
    goto LABEL_13;
  }
  v5 = (v15 < v27) + 14594;
  if ( v5 > v15 )
  {
LABEL_13:
    v6 = v5 & 0x33AB;
    goto LABEL_7;
  }
  v6 = 0;
  if ( (v15 & 0x3A19) != 0 )
  {
LABEL_7:
    v7 = ((v6 | 0x1E16) ^ 0x1422) - 7759;
    goto LABEL_12;
  }
  v7 = 8467;
  if ( v20 == v14 )
  {
    v9 = 7343;
    v8 = 0;
LABEL_8:
    v11 = ((((v9 + v8 + v9) & 0xAFE) + 16339) | 0x2896) - v28;
    v5 = ((__PAIR64__(v11 - 15369, v11) - 0xCB00003C09i64) >> 32) - 10806;
    goto LABEL_11;
  }
LABEL_12:
  v10 = sub_414F0D(v7, (int)v23, v15, (int)v23, 0);
  sub_417D39(v10, (int)v26, (int)v26, 0, 35, 53);
  return sub_4158C7(v18, (int)v25, 30, (int)v25);
}
// 4174F0: variable 'v16' is possibly undefined
// 415120: variable 'v15' is possibly undefined
// 41535C: variable 'v20' is possibly undefined
// 41535C: variable 'v14' is possibly undefined
// 415BFC: variable 'v17' is possibly undefined
// 416898: variable 'v12' is possibly undefined
// 416898: variable 'v13' is possibly undefined
// 417570: variable 'v18' is possibly undefined
// 416F11: using guessed type char var_1E4[4];

//----- (004170FA) --------------------------------------------------------
void __stdcall sub_4170FA(int a1, int a2, int a3)
{
  void *v3; // ecx
  int v4; // edx
  __int16 v5; // ax
  unsigned int v6; // ecx
  int v7; // edx
  void *v8; // ecx
  void *v9; // ecx
  int v10; // edx
  unsigned int v11; // ecx
  int v12; // ecx
  int v13; // ecx
  int v14; // eax
  unsigned int v15; // edx
  unsigned int v16; // ecx
  int v17; // eax
  void *v18; // ecx
  int v19; // ecx
  int v20; // ecx
  char v21[4]; // [esp+38h] [ebp-264h] BYREF
  unsigned int v22; // [esp+3Ch] [ebp-260h]
  int v23; // [esp+84h] [ebp-218h]
  char v24[36]; // [esp+A0h] [ebp-1FCh] BYREF
  int v25; // [esp+D4h] [ebp-1C8h]
  int v26; // [esp+ECh] [ebp-1B0h]
  char v27[28]; // [esp+118h] [ebp-184h] BYREF
  int v28; // [esp+134h] [ebp-168h]
  int v29; // [esp+198h] [ebp-104h]
  char v30[12]; // [esp+230h] [ebp-6Ch] BYREF
  char v31[12]; // [esp+23Ch] [ebp-60h] BYREF
  char v32[84]; // [esp+248h] [ebp-54h] BYREF

  sub_417CE8(57, v28);
  sub_415277(v18);
  GetCurrentProcess();
  sub_415277(v3);
  v5 = sub_417CE8(23, v25);
  sub_415BB6(v6, (unsigned int)v27, 0, (v5 & 0x695 ^ 0x1A26) - 15167, (int)v27, 0);
  GetCurrentThreadId();
  sub_414F0D(0, v7, (int)v21, (int)v21, 0);
  sub_415277(v8);
  sub_415277(v9);
  sub_4158C7((int)v31, v10, 13, (int)v31);
  GetCurrentProcess();
  sub_415BB6(v11, (unsigned int)v32, 0, (int)v32, (int)v32, 0);
  GetCurrentProcess();
  sub_417CE8(20, v12);
  v14 = sub_4158C7(v13, (int)v24, 56, (int)v24);
  v17 = sub_415998(v29 | v23 | v14, v15, v16);
  v28 |= v17;
  sub_417D39((int)v30, v19, (int)v30, 0, 41, 47);
  if ( v4 && v26 == v20 && v22 >= (unsigned int)(unsigned __int8)v31[4] - 6461 && (v20 & 0xDD6) == 0 )
    JUMPOUT(0x41636E);
  JUMPOUT(0x416273);
}
// 417994: control flows out of bounds to 416273
// 414FDC: control flows out of bounds to 41636E
// 417117: variable 'v18' is possibly undefined
// 414ED0: variable 'v3' is possibly undefined
// 416B1A: variable 'v6' is possibly undefined
// 416B3E: variable 'v7' is possibly undefined
// 416B54: variable 'v8' is possibly undefined
// 416B65: variable 'v9' is possibly undefined
// 416B75: variable 'v10' is possibly undefined
// 416E14: variable 'v11' is possibly undefined
// 416E22: variable 'v12' is possibly undefined
// 416E32: variable 'v13' is possibly undefined
// 416E43: variable 'v15' is possibly undefined
// 416E43: variable 'v16' is possibly undefined
// 41791E: variable 'v19' is possibly undefined
// 414F91: variable 'v4' is possibly undefined
// 414F9D: variable 'v20' is possibly undefined
// 4170FA: using guessed type char var_264[4];

//----- (0041733A) --------------------------------------------------------
int __userpurge sub_41733A@<eax>(int result@<eax>, __int16 a2@<dx>, int a3, int a4, int a5, int a6)
{
  if ( (a2 & 0x327B) == 0 )
    return (((_WORD)result + 2005) & 0x1E01)
         + 6363
         + __CFADD__(((_WORD)result + 2005) & 0x1E01, 6363)
         + (((_WORD)result + 2005) & 0x1E01)
         + 6363;
  return result;
}

//----- (00417CE8) --------------------------------------------------------
int __stdcall sub_417CE8(int a1, int a2)
{
  int v2; // edx
  int v3; // ecx
  _BYTE v5[156]; // [esp-13Ch] [ebp-140h] BYREF
  int v6[41]; // [esp-A0h] [ebp-A4h] BYREF

  sub_415BB6(0, 0, 0, v6[29], (int)v6, 0);
  return sub_414F0D((int)v5, v2, v3, (int)v5, 0);
}
// 4154B3: variable 'v2' is possibly undefined
// 4154B3: variable 'v3' is possibly undefined

//----- (00417D39) --------------------------------------------------------
unsigned int __userpurge sub_417D39@<eax>(int a1@<eax>, int a2@<ecx>, int a3, int a4, int a5, int a6)
{
  unsigned int v6; // eax
  unsigned int v7; // ett
  unsigned int result; // eax
  bool v9; // cf
  int v10; // eax
  int v11; // eax
  unsigned int v12; // edx
  unsigned int v13; // ecx
  __int16 v14; // ax
  int v15; // edx
  int v16; // ecx
  char v17[368]; // [esp+228h] [ebp-18Ch] BYREF

  v11 = sub_414F0D(a1, (int)v17, a2, (int)v17, 0);
  v14 = sub_415998(
          2 * ((v11 | 0x360F) - 20316) - (__CFADD__((v11 | 0x360F) - 20316, (v11 | 0x360F) - 20316) + 2507),
          v12,
          v13);
  v10 = (v14 + v9 + v14) & 0x303F;
  if ( (v16 & v10) != 0
    || (v6 = v10 + 9978,
        v9 = v6 < 0x1D33,
        v6 -= 7475,
        v7 = v9 + 4614,
        result = v6
               - v7
               + (v6 < v7)
               + v6
               - v7
               - ((__CFADD__(v6 < v7, v6 - v7) | __CFADD__(v6 - v7, (v6 < v7) + v6 - v7))
                + 15844),
        v15) )
  {
    JUMPOUT(0x4160F3);
  }
  return result;
}
// 4152B0: control flows out of bounds to 4160F3
// 417D66: variable 'v12' is possibly undefined
// 417D66: variable 'v13' is possibly undefined
// 416FB2: variable 'v9' is possibly undefined
// 416FC5: variable 'v16' is possibly undefined
// 416803: variable 'v15' is possibly undefined

// nfuncs=31 queued=30 decompiled=30 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 30 function(s)"
