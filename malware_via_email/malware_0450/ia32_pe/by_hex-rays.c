/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// BOOL __stdcall VirtualProtect(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);
int __fastcall sub_40B1A3(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
void __stdcall sub_40B1A9(int);
int __fastcall TlsCallback_1(int, DWORD, int, int, int);
_DWORD __stdcall TlsCallback_0(_DWORD, _DWORD, _DWORD); // weak

//-------------------------------------------------------------------------
// Data declarations

int dword_40B1C4[18] =
{
  38944945,
  81954626,
  2388992,
  1746858752,
  -132227542,
  234883054,
  369098772,
  -303748691,
  41660589,
  1766144,
  168720128,
  1611550398,
  -1895824214,
  -1241513983,
  -1637083858,
  139907038,
  158208,
  61440
}; // weak


//----- (0040B1A9) --------------------------------------------------------
void __stdcall sub_40B1A9(int a1)
{
  ;
}

//----- (0040B20D) --------------------------------------------------------
int __fastcall TlsCallback_1(int a1, DWORD a2, int a3, int a4, int a5)
{
  int v6; // edi
  int v7; // eax
  char v8; // cf
  int v9; // ecx
  int v10; // edx
  int *v11; // esi
  int v12; // ecx
  char v13; // al
  int *v14; // esi
  int v15; // eax
  int v16; // ebx
  int v17; // eax
  int v18; // ecx
  int v19; // edi
  char v20; // al
  _BYTE *v21; // ebx
  int i; // ecx
  int v23; // [esp+8h] [ebp-28h]
  _BYTE *v24; // [esp+8h] [ebp-28h]
  int v25; // [esp+Ch] [ebp-24h]
  DWORD v26; // [esp+10h] [ebp-20h] BYREF
  int v27; // [esp+14h] [ebp-1Ch]
  int v28; // [esp+18h] [ebp-18h]
  void **v29; // [esp+20h] [ebp-10h]
  void *retaddr; // [esp+30h] [ebp+0h] BYREF

  if ( a4 == 1 )
  {
    v29 = &retaddr;
    v28 = a1;
    v27 = 1;
    v26 = a2;
    v6 = 1944152289;
    v7 = a1;
    do
    {
      sub_40B1A9(v7 - 1350236161);
      v6 -= v8 - 1350236161;
    }
    while ( v9 != 1 );
    VirtualProtect((LPVOID)(v6 ^ 0x2C9D22FF), v6 ^ 0x2CDD92FF, 4u, &v26);
    v11 = dword_40B1C4;
    v12 = 5;
    do
    {
      v25 = v12;
      v13 = *(_BYTE *)v11;
      v14 = (int *)((char *)v11 + 1);
      LOBYTE(v10) = v13;
      v15 = *v14++;
      v16 = v15;
      v17 = *v14++;
      v18 = v17;
      v19 = *v14;
      v11 = (int *)((char *)v14 + 5);
      do
      {
        v23 = v18;
        sub_40B1A9(v10);
        LOBYTE(v10) = v20 ^ v10;
        v18 = v23 - 1;
      }
      while ( v23 != 1 );
      LOBYTE(v24) = v10 ^ v16;
      BYTE1(v24) = v10 ^ BYTE1(v16);
      BYTE2(v24) = v10 ^ BYTE2(v16);
      HIBYTE(v24) = v10 ^ HIBYTE(v16);
      v21 = v24;
      for ( i = v19; i; --i )
      {
        BYTE1(v10) = v10 ^ *v21;
        *v21++ = BYTE1(v10);
      }
      v12 = v25 - 1;
    }
    while ( v25 != 1 );
    sub_40B1A3(v12, v10 + 66, v26, v27, v28);
  }
  return TlsCallback_0(a3, a4, a5);
}
// 40B23A: variable 'v7' is possibly undefined
// 40B240: variable 'v8' is possibly undefined
// 40B242: variable 'v9' is possibly undefined
// 40B281: variable 'v10' is possibly undefined
// 40B286: variable 'v20' is possibly undefined
// 40B1A3: using guessed type int __fastcall sub_40B1A3(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40B1C4: using guessed type int dword_40B1C4[18];
// 40B2C8: using guessed type _DWORD __stdcall TlsCallback_0(_DWORD, _DWORD, _DWORD);

// nfuncs=5 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
