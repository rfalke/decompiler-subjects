/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

void sub_4010A9();
// void __usercall sub_40116D(char *this@<ecx>, int a2@<ebp>, __int32 a3@<edi>);
// void __usercall sub_40118E(int a1@<eax>, int a2@<ebp>, __int32 a3@<edi>);
void sub_4011CC();
int sub_401222();
// void __usercall sub_401290(int a1@<ecx>, int a2@<edi>, int a3@<esi>, __int32 a4@<edx>);
// void __usercall sub_4012B1(unsigned int a1@<eax>, __int32 a2@<ebx>);
// void __usercall sub_4012E6(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<esi>);
// void __usercall sub_401335(int a1@<edx>, int a2@<esi>);
void __thiscall sub_401355(char *this);
// void __usercall start(int a1@<edx>, int a2@<ecx>, int a3@<ebx>);
// int __usercall sub_40140A@<eax>(int a1@<edx>, int a2@<ebx>, int _EDI@<edi>, int a4@<esi>);
void sub_401495();
// void __usercall sub_40154B(int a1@<eax>);
// void __usercall sub_40157E(unsigned int a1@<eax>, __int32 a2@<ebx>);
void sub_4016C8();
// int __usercall sub_401704@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_40111A; // weak
_UNKNOWN loc_4011AD; // weak
_UNKNOWN loc_4011F8; // weak
_UNKNOWN loc_401259; // weak
_UNKNOWN loc_4012CB; // weak
_UNKNOWN loc_4012FF; // weak
_UNKNOWN loc_401461; // weak
_UNKNOWN loc_4014CD; // weak
_UNKNOWN loc_401567; // weak
_UNKNOWN loc_4015AE; // weak
_UNKNOWN loc_4016DF; // weak


//----- (004010A9) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4010A9()
{
  __asm { repne pop ebx }
  ((void (*)(void))((char *)&loc_4015AE + 2))();
  JUMPOUT(0x4010C2);
}
// 4010AE: positive sp value 4 has been found
// 4010BD: control flows out of bounds to 4010C2

//----- (0040116D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40116D(char *this@<ecx>, int a2@<ebp>, __int32 a3@<edi>)
{
  char v3; // zf
  int v4; // eax

  sub_401355(this);
  if ( v3 )
    JUMPOUT(0x4011AE);
  v4 = MEMORY[0x264010B3]();
  sub_40118E(v4, a2, a3);
}
// 401171: positive sp value 4 has been found
// 401187: control flows out of bounds to 4011AE
// 401187: variable 'v3' is possibly undefined

//----- (0040118E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40118E(int a1@<eax>, int a2@<ebp>, __int32 a3@<edi>)
{
  int v3; // eax
  char v4; // zf
  __int32 v5; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v5, a3);
  sub_40154B(a1);
  v5 = *(_DWORD *)(v3 + 8 * a2 - 1);
  if ( !v4 )
    JUMPOUT(0x4011AF);
  JUMPOUT(0x401195);
}
// 40119A: positive sp value 4 has been found
// 4011AD: control flows out of bounds to 4011AF
// 40113C: control flows out of bounds to 40113E
// 4011AB: control flows out of bounds to 401195
// 4011A7: variable 'v3' is possibly undefined
// 4011AB: variable 'v4' is possibly undefined

//----- (004011CC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4011CC()
{
  void *v1; // [esp+20h] [ebp-4h]
  void *retaddr; // [esp+24h] [ebp+0h]

  *(&retaddr - 10) = v1;
  __asm { smsw    eax }
  sub_4010A9();
  JUMPOUT(0x4011E7);
}
// 4011D0: positive sp value 4 has been found
// 4011E2: control flows out of bounds to 4011E7

//----- (00401222) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int sub_401222()
{
  ((void (*)(void))((char *)&loc_4012FF + 3))();
  return MEMORY[0x257425FF]();
}
// 401233: positive sp value 8 has been found

//----- (00401290) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401290(int a1@<ecx>, int a2@<edi>, int a3@<esi>, __int32 a4@<edx>)
{
  ((void (__thiscall *)(int))loc_401461)(a1 - (a3 ^ a2));
  sub_4012B1(0, a4);
}
// 401294: positive sp value 4 has been found

//----- (004012B1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4012B1(unsigned int a1@<eax>, __int32 a2@<ebx>)
{
  char v3; // zf
  unsigned int v4; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange((volatile __int32 *)&v4, a2);
  __asm { repne pop ebx }
  v4 = __readfsdword(a1);
  sub_401495();
  if ( !v3 )
  {
    MEMORY[0x2484A2CF]();
    JUMPOUT(0x4012D0);
  }
  JUMPOUT(0x4012B3);
}
// 4012B6: positive sp value 4 has been found
// 4012CB: control flows out of bounds to 4012D0
// 4012C9: control flows out of bounds to 4012B3
// 4012C9: variable 'v3' is possibly undefined

//----- (004012E6) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4012E6(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<esi>)
{
  void *v4; // [esp+24h] [ebp-4h]
  void *retaddr; // [esp+28h] [ebp+0h]

  *(&retaddr - 11) = v4;
  ((void (__fastcall *)(int, int))((char *)&loc_4012CB + 2))((a4 | a3) ^ a2, a1 + 1);
  MEMORY[0x262838E7]();
  MEMORY[0x4C7FB29]();
  JUMPOUT(0x401304);
}
// 4012EA: positive sp value 4 has been found
// 4012FF: control flows out of bounds to 401304

//----- (00401335) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401335(int a1@<edx>, int a2@<esi>)
{
  char v3; // zf
  char *v4; // ecx

  __asm { rep pop ecx }
  ((void (__fastcall *)(int, int))((char *)&loc_4011F8 + 5))(_ECX - 1, _ECX + (a2 ^ a1));
  if ( v3 )
    JUMPOUT(0x40134F);
  MEMORY[0x2566133D]();
  sub_401355(v4);
}
// 40133A: positive sp value 4 has been found
// 40134E: control flows out of bounds to 40134F
// 40134E: variable 'v3' is possibly undefined
// 401351: variable 'v4' is possibly undefined

//----- (00401355) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __thiscall sub_401355(char *this)
{
  __asm { rep pop edx }
  BYTE1(_EDX) = _EDX;
  ((void (__fastcall *)(char *, int))((char *)&loc_4011AD + 1))(this - 946326266, _EDX);
  MEMORY[0x2628FB9B]();
  JUMPOUT(0x401376);
}
// 40135C: positive sp value 4 has been found
// 401371: control flows out of bounds to 401376

//----- (00401390) --------------------------------------------------------
void __usercall start(int a1@<edx>, int a2@<ecx>, int a3@<ebx>)
{
  char v3; // zf

  ((void (__thiscall *)(int))((char *)&loc_401567 + 2))(a3 + (a1 ^ a2) - 1);
  if ( !v3 )
    JUMPOUT(0x4013AC);
  JUMPOUT(0x4013CC);
}
// 4013A7: control flows out of bounds to 4013AC
// 4013A5: control flows out of bounds to 4013CC
// 4013A5: variable 'v3' is possibly undefined

//----- (0040140A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_40140A@<eax>(int a1@<edx>, int a2@<ebx>, int _EDI@<edi>, int a4@<esi>)
{
  int v5; // edi
  int v6; // eax
  int v7; // ecx
  int v8; // edx
  int v9; // ebx
  int v10; // eax
  int v11; // edx
  int v12; // ecx
  char v13; // zf

  __asm { repne lea edi, [edi] }
  v5 = a1 ^ _EDI;
  sub_4016C8();
  v9 = (v6 & 0xE8FFFF25 ^ (a4 + a2 + 1)) - 1;
  sub_4012E6(v8, a4 ^ v7, v9, a4);
  if ( v13 )
  {
    do
    {
      v9 += v5;
      a4 ^= v9 ^ v11;
      v5 = (v10 | v12) ^ (v9 | (v5 - 1 - v10));
      v10 = ((int (*)(void))loc_401259)();
    }
    while ( v13 );
    JUMPOUT(0x4014B3);
  }
  return MEMORY[0x240C8974]();
}
// 40142D: positive sp value C has been found
// 4014B1: control flows out of bounds to 4014B3
// 40143D: control flows out of bounds to 401427
// 401424: variable 'v6' is possibly undefined
// 401436: variable 'v8' is possibly undefined
// 40142D: variable 'v7' is possibly undefined
// 40143B: variable 'v13' is possibly undefined
// 4014A6: variable 'v11' is possibly undefined
// 40149D: variable 'v10' is possibly undefined
// 40149D: variable 'v12' is possibly undefined

//----- (00401495) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401495()
{
  JUMPOUT(0x40149B);
}
// 401499: positive sp value 4 has been found
// 401499: control flows out of bounds to 40149B

//----- (0040154B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40154B(int a1@<eax>)
{
  ((void (__cdecl *)(_DWORD))loc_4014CD)(*(_DWORD *)(a1 + 8));
  JUMPOUT(0x40156C);
}
// 40154F: positive sp value 4 has been found
// 401567: control flows out of bounds to 40156C

//----- (0040157E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40157E(unsigned int a1@<eax>, __int32 a2@<ebx>)
{
  void *v2; // [esp+2Ch] [ebp-4h]
  void *retaddr; // [esp+30h] [ebp+0h]

  *(&retaddr - 13) = v2;
  sub_4012B1(a1, a2);
  MEMORY[0x8DB5157C]();
  JUMPOUT(0x401594);
}
// 401582: positive sp value 4 has been found
// 40158F: control flows out of bounds to 401594

//----- (004016C8) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4016C8()
{
  void *v0; // [esp+14h] [ebp-4h]
  void *retaddr; // [esp+18h] [ebp+0h]

  *(&retaddr - 7) = v0;
  v0 = &loc_4016DF;
  JUMPOUT(0x4016E6);
}
// 4016CC: positive sp value 4 has been found
// 4016E4: control flows out of bounds to 4016E9
// 4016DA: control flows out of bounds to 4016E6

//----- (00401704) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_401704@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>)
{
  void *v5; // [esp+28h] [ebp-4h]
  void *retaddr; // [esp+2Ch] [ebp+0h]

  *(&retaddr - 12) = v5;
  ((void (__thiscall *)(int))loc_40111A)((a2 + a4) ^ a4 ^ (a1 + a3 - (a2 + a4)));
  return MEMORY[0xCDE8FF74]();
}
// 401708: positive sp value 4 has been found

// nfuncs=17 queued=17 decompiled=17 lumina nreq=0 worse=0 better=0
// ALL OK, 17 function(s) have been successfully decompiled
