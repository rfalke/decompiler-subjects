/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __userpurge sub_401000(int@<eax>, int@<edx>, int@<ecx>, int@<ebx>, int, int);
// UINT __userpurge sub_401060@<eax>(int@<ebx>, int@<edi>, int, int, int, int);
// int __userpurge sub_401090@<eax>(int@<eax>, int@<ebx>, int@<edi>, int, int, int, int);
// int __userpurge sub_4010B8@<eax>(int@<ebx>, int@<edi>, int, int, int, int);
void start();
// void *__userpurge sub_401100@<eax>(int@<edx>, int@<ebx>, int@<edi>, int@<esi>, int, int, int, int);
// void __userpurge sub_401168(int@<ebx>, int@<edi>, int, int);
// DWORD __userpurge sub_40119C@<eax>(int@<eax>, int@<ecx>, int@<ebx>, int, int, int);
// DWORD __userpurge sub_4011F8@<eax>(int@<eax>, int@<ecx>, int@<edi>, int@<esi>, int, int, int, int);
// UINT __userpurge sub_401224@<eax>(int@<ebx>, int@<esi>, int, int, int, int);
// HANDLE __userpurge sub_401250@<eax>(int@<ebx>, int@<edi>, int, int, int);
// HWND __userpurge sub_40127C@<eax>(int@<ebx>, int@<edi>, int@<esi>, int, int, int, int);
// LANGID __userpurge sub_4012AC@<ax>(int@<eax>, int@<ebx>, int@<edi>, int, int);
// DWORD __userpurge sub_4012D8@<eax>(int@<ebx>, int, int, int);
// DWORD __userpurge sub_401300@<eax>(int@<ebx>, int@<edi>, int, int);
// UINT __userpurge sub_40132C@<eax>(int@<edi>, int, int, int, int);
// LANGID __userpurge sub_40135C@<ax>(int@<edi>, int@<esi>, int, int, int, int);
// HWND __userpurge sub_4013C0@<eax>(int@<edx>, int@<ecx>, int@<esi>, int, int, int);
// UINT __userpurge sub_4013F0@<eax>(int@<edx>, int@<ebx>, int@<edi>, int, int, int);
HMODULE __stdcall sub_401418(int, int, int);
// void *__userpurge sub_401498@<eax>(int@<ebx>, int@<edi>, int, int, int);
// HWND __userpurge sub_4014C8@<eax>(int@<ebx>, int, int, int, int);
// int __userpurge sub_4014F0@<eax>(int@<edx>, int@<ecx>, int@<ebx>, int@<esi>, int, int, int);
// UINT __userpurge sub_40151C@<eax>(int@<edi>, int, int);
// int __userpurge sub_40154C@<eax>(int@<edx>, int@<ecx>, int@<edi>, int, int, int, int);
// LPSTR __userpurge sub_40157C@<eax>(int@<ebx>, int@<edi>, int, int);
// UINT __userpurge sub_4015A4@<eax>(int@<ebx>, int@<edi>, int@<esi>, int, int, int);
// LPSTR __userpurge sub_4015D4@<eax>(int@<edx>, int@<ecx>, int@<ebx>, int@<edi>, int, int);
// UINT __userpurge sub_4015FC@<eax>(int@<eax>, int@<edx>, int@<ebx>, int, int, int, int);
// HANDLE __userpurge sub_40165C@<eax>(int@<edi>, int, int, int);
// void *__userpurge sub_401688@<eax>(int@<edx>, int@<ecx>, int@<ebx>, int, int, int, int);
// DWORD __userpurge sub_4016B4@<eax>(int@<edx>, int@<ecx>, int@<edi>, int@<esi>, int, int, int);
// DWORD __userpurge sub_4016E0@<eax>(int@<ebx>, int@<esi>, int, int, int);
// HWND __userpurge sub_40170C@<eax>(int@<ebx>, int@<edi>, int@<esi>, int, int, int);
// HWND __userpurge sub_401740@<eax>(int@<ebx>, int, int, int);
// HWND __userpurge sub_401768@<eax>(int@<ebx>, int@<esi>, int, int);
// UINT __stdcall GetACP();
// LPVOID __stdcall VirtualAlloc(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// DWORD __stdcall GetCurrentThreadId();
// UINT __stdcall GetDriveTypeA(LPCSTR lpRootPathName);
// HANDLE __stdcall GetCurrentProcess();
// LANGID __stdcall GetSystemDefaultLangID();
// DWORD __stdcall GetLogicalDrives();
// BOOL __stdcall IsValidCodePage(UINT CodePage);
// LPSTR __stdcall GetCommandLineA();
// void __stdcall Sleep(DWORD dwMilliseconds);
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// DWORD __stdcall GetCurrentProcessId();
// HANDLE __stdcall GetCurrentThread();
// HWND __stdcall GetActiveWindow();
// HWND __stdcall GetFocus();
// HWND __stdcall GetForegroundWindow();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401030; // weak
_UNKNOWN loc_401384; // weak
_UNKNOWN unk_40300C; // weak
_UNKNOWN unk_403068; // weak
_UNKNOWN unk_40311C; // weak
_UNKNOWN unk_403144; // weak
_UNKNOWN unk_40314C; // weak
_UNKNOWN unk_403160; // weak
_UNKNOWN unk_4031E4; // weak
_UNKNOWN unk_403214; // weak
_UNKNOWN unk_403218; // weak
_UNKNOWN unk_403254; // weak
_UNKNOWN unk_4032AC; // weak
_UNKNOWN unk_4032C8; // weak
_UNKNOWN unk_4032CC; // weak
_UNKNOWN unk_403310; // weak


//----- (00401000) --------------------------------------------------------
void __userpurge sub_401000(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5, int a6)
{
  sub_4015FC(a1, a2, a4, a3, a2, a3, a3);
  GetFocus();
  Sleep(0xCu);
}
// 401000: could not find valid save-restore pair for edi

//----- (00401060) --------------------------------------------------------
UINT __userpurge sub_401060@<eax>(int a1@<ebx>, int a2@<edi>, int a3, int a4, int a5, int a6)
{
  int v6; // edx
  int v7; // ecx

  GetACP();
  sub_401498(a1, a2, a1, v7, v6);
  return GetDriveTypeA(0);
}
// 401060: could not find valid save-restore pair for esi
// 401076: variable 'v7' is possibly undefined
// 401076: variable 'v6' is possibly undefined

//----- (00401090) --------------------------------------------------------
int __userpurge sub_401090@<eax>(int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4, int a5, int a6, int a7)
{
  int result; // eax

  sub_401300(a2, a3, a1, a2);
  GetACP();
  LOWORD(result) = GetSystemDefaultLangID();
  return result;
}

//----- (004010B8) --------------------------------------------------------
int __userpurge sub_4010B8@<eax>(int a1@<ebx>, int a2@<edi>, int a3, int a4, int a5, int a6)
{
  int v6; // edx

  GetSystemDefaultLangID();
  sub_401418(v6, v6, a2);
  GetCurrentProcess();
  return a1 + 208;
}
// 4010D1: variable 'v6' is possibly undefined

//----- (004010E4) --------------------------------------------------------
void start()
{
  if ( ((unsigned __int8)GetCommandLineA() & 3) == 0 )
    GetLogicalDrives();
  JUMPOUT(0x401A03);
}
// 4010FF: control flows out of bounds to 401A03

//----- (00401100) --------------------------------------------------------
void *__userpurge sub_401100@<eax>(
        int a1@<edx>,
        int a2@<ebx>,
        int a3@<edi>,
        int a4@<esi>,
        int a5,
        int a6,
        int a7,
        int a8)
{
  sub_40135C(a3, a4, a4, a2, a2, a1);
  IsValidCodePage(0x362u);
  GetCurrentThread();
  return &unk_4032C8;
}

//----- (00401168) --------------------------------------------------------
void __userpurge sub_401168(int a1@<ebx>, int a2@<edi>, int a3, int a4)
{
  LPSTR CommandLineA; // eax
  int v5; // edx

  CommandLineA = GetCommandLineA();
  sub_4015D4(v5, (int)&unk_4031E4, a1, a2, (int)CommandLineA, a2);
  Sleep(0x13u);
}
// 401180: variable 'v5' is possibly undefined

//----- (0040119C) --------------------------------------------------------
DWORD __userpurge sub_40119C@<eax>(int a1@<eax>, int a2@<ecx>, int a3@<ebx>, int a4, int a5, int a6)
{
  ((void (__stdcall *)(int, int, int))loc_401384)(a2, a1, a3);
  GetCurrentThreadId();
  return GetCurrentThreadId();
}

//----- (004011F8) --------------------------------------------------------
DWORD __userpurge sub_4011F8@<eax>(
        int a1@<eax>,
        int a2@<ecx>,
        int a3@<edi>,
        int a4@<esi>,
        int a5,
        int a6,
        int a7,
        int a8)
{
  sub_4013C0(a4 - 20, a2, a4, a1, a3, a2);
  GetCurrentThreadId();
  return GetCurrentProcessId();
}

//----- (00401224) --------------------------------------------------------
UINT __userpurge sub_401224@<eax>(int a1@<ebx>, int a2@<esi>, int a3, int a4, int a5, int a6)
{
  int v6; // edx

  GetFocus();
  sub_4014C8(a1, a2, v6, a1, a1);
  return GetACP();
}
// 40123D: variable 'v6' is possibly undefined

//----- (00401250) --------------------------------------------------------
HANDLE __userpurge sub_401250@<eax>(int a1@<ebx>, int a2@<edi>, int a3, int a4, int a5)
{
  int CurrentProcessId; // eax
  int v6; // edx
  int v7; // ecx

  CurrentProcessId = GetCurrentProcessId();
  sub_40127C(a1, a2, a1 + 388, a1, CurrentProcessId, v7, v6);
  return GetCurrentThread();
}
// 401250: could not find valid save-restore pair for esi
// 401268: variable 'v7' is possibly undefined
// 401268: variable 'v6' is possibly undefined

//----- (0040127C) --------------------------------------------------------
HWND __userpurge sub_40127C@<eax>(int a1@<ebx>, int a2@<edi>, int a3@<esi>, int a4, int a5, int a6, int a7)
{
  HANDLE CurrentProcess; // eax
  int v8; // edx

  CurrentProcess = GetCurrentProcess();
  sub_40154C(v8, a3 - 316, a2, (int)CurrentProcess, a3, a2, a1);
  return GetFocus();
}
// 401296: variable 'v8' is possibly undefined

//----- (004012AC) --------------------------------------------------------
LANGID __userpurge sub_4012AC@<ax>(int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4, int a5)
{
  sub_401740(a2, a1, a1, a3);
  GetLogicalDrives();
  return GetSystemDefaultLangID();
}

//----- (004012D8) --------------------------------------------------------
DWORD __userpurge sub_4012D8@<eax>(int a1@<ebx>, int a2, int a3, int a4)
{
  int v4; // edx
  int v5; // ecx

  GetSystemDefaultLangID();
  sub_401768(a1, (int)&unk_40300C, v4, v5);
  return GetCurrentThreadId();
}
// 4012D8: could not find valid save-restore pair for esi
// 4012ED: variable 'v4' is possibly undefined
// 4012ED: variable 'v5' is possibly undefined

//----- (00401300) --------------------------------------------------------
DWORD __userpurge sub_401300@<eax>(int a1@<ebx>, int a2@<edi>, int a3, int a4)
{
  int ACP; // eax

  ACP = GetACP();
  sub_401060(a1, a2, ACP, a2, a2, a1);
  return GetCurrentProcessId();
}

//----- (0040132C) --------------------------------------------------------
UINT __userpurge sub_40132C@<eax>(int a1@<edi>, int a2, int a3, int a4, int a5)
{
  int v5; // edx
  int v6; // ecx

  GetActiveWindow();
  sub_40151C(a1, v5, v6);
  return GetDriveTypeA(0);
}
// 40132C: could not find valid save-restore pair for esi
// 401342: variable 'v5' is possibly undefined
// 401342: variable 'v6' is possibly undefined

//----- (0040135C) --------------------------------------------------------
LANGID __userpurge sub_40135C@<ax>(int a1@<edi>, int a2@<esi>, int a3, int a4, int a5, int a6)
{
  HWND Focus; // eax

  Focus = GetFocus();
  sub_401250((int)&unk_403160, a1, (int)Focus, a2, a1);
  return GetSystemDefaultLangID();
}
// 40135C: could not find valid save-restore pair for ebx

//----- (004013C0) --------------------------------------------------------
HWND __userpurge sub_4013C0@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<esi>, int a4, int a5, int a6)
{
  sub_4016B4(a1, a2, a1 + 200, a3, a1, a1, a1);
  IsValidCodePage(0x362u);
  return GetFocus();
}
// 4013C0: could not find valid save-restore pair for edi

//----- (004013F0) --------------------------------------------------------
UINT __userpurge sub_4013F0@<eax>(int a1@<edx>, int a2@<ebx>, int a3@<edi>, int a4, int a5, int a6)
{
  sub_40157C(a2, a3, a1, a2);
  GetCurrentThread();
  return GetACP();
}

//----- (00401418) --------------------------------------------------------
HMODULE __stdcall sub_401418(int a1, int a2, int a3)
{
  char *v3; // eax
  const CHAR *v4; // edx
  char *v5; // edi
  _DWORD *v6; // esi
  int v7; // ebx
  HMODULE result; // eax

  v3 = (char *)VirtualAlloc(0, 0x5D0u, 0x1000u, 0x40u);
  v4 = (const CHAR *)&unk_403214;
  *((_DWORD *)&unk_403214 + 55) = v3;
  v5 = v3 - 416;
  v6 = &unk_403310;
  v7 = 1488;
  do
  {
    *((_DWORD *)v5 + 104) = *v6++;
    v5 += 4;
    *((_DWORD *)v5 + 103) ^= 0x7641AC31u;
    v7 -= 4;
  }
  while ( v7 );
  do
    result = GetModuleHandleA(v4 + 236);
  while ( result );
  return result;
}
// 401484: variable 'v4' is possibly undefined

//----- (00401498) --------------------------------------------------------
void *__userpurge sub_401498@<eax>(int a1@<ebx>, int a2@<edi>, int a3, int a4, int a5)
{
  int v5; // ecx

  GetDriveTypeA(0);
  sub_40165C(a2, a2, v5, a1);
  GetCurrentProcess();
  return &unk_4032CC;
}
// 4014B3: variable 'v5' is possibly undefined

//----- (004014C8) --------------------------------------------------------
HWND __userpurge sub_4014C8@<eax>(int a1@<ebx>, int a2, int a3, int a4, int a5)
{
  int v5; // edx
  int v6; // ecx

  GetCurrentThreadId();
  sub_4016E0(a1, (int)&unk_403254, a1, v5, v6);
  return GetActiveWindow();
}
// 4014C8: could not find valid save-restore pair for esi
// 4014DE: variable 'v5' is possibly undefined
// 4014DE: variable 'v6' is possibly undefined

//----- (004014F0) --------------------------------------------------------
int __userpurge sub_4014F0@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<esi>, int a5, int a6, int a7)
{
  sub_401000(a4 + 280, a1, a2, a3, a4, a1);
  GetActiveWindow();
  GetCurrentThread();
  return a4 + 280;
}

//----- (0040151C) --------------------------------------------------------
UINT __userpurge sub_40151C@<eax>(int a1@<edi>, int a2, int a3)
{
  IsValidCodePage(0x362u);
  ((void (__cdecl *)(int))loc_401030)(a1);
  return GetACP();
}

//----- (0040154C) --------------------------------------------------------
int __userpurge sub_40154C@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<edi>, int a4, int a5, int a6, int a7)
{
  int v8; // [esp-4h] [ebp-44h]

  v8 = a2 - 192;
  sub_40132C(a3, a3, a3, a3, a1);
  GetACP();
  GetForegroundWindow();
  return v8;
}

//----- (0040157C) --------------------------------------------------------
LPSTR __userpurge sub_40157C@<eax>(int a1@<ebx>, int a2@<edi>, int a3, int a4)
{
  HANDLE CurrentProcess; // eax
  int v5; // edx
  int v6; // ecx

  CurrentProcess = GetCurrentProcess();
  sub_4014F0(v5, v6, a1, (int)&unk_403144, a2, a1, (int)CurrentProcess);
  return GetCommandLineA();
}
// 40157C: could not find valid save-restore pair for esi
// 401593: variable 'v5' is possibly undefined
// 401593: variable 'v6' is possibly undefined

//----- (004015A4) --------------------------------------------------------
UINT __userpurge sub_4015A4@<eax>(int a1@<ebx>, int a2@<edi>, int a3@<esi>, int a4, int a5, int a6)
{
  int CurrentThreadId; // eax

  CurrentThreadId = GetCurrentThreadId();
  sub_40170C(a1, a2, a3, CurrentThreadId, a2, CurrentThreadId);
  return GetDriveTypeA(0);
}

//----- (004015D4) --------------------------------------------------------
LPSTR __userpurge sub_4015D4@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5, int a6)
{
  sub_4015A4(a3, a4, (int)&unk_4032C8, a3, a2, a1);
  GetLogicalDrives();
  return GetCommandLineA();
}
// 4015D4: could not find valid save-restore pair for esi

//----- (004015FC) --------------------------------------------------------
UINT __userpurge sub_4015FC@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4, int a5, int a6, int a7)
{
  sub_401224(a3, (int)&unk_40311C, a1, a1, a2, a1);
  GetCommandLineA();
  return GetACP();
}
// 4015FC: could not find valid save-restore pair for esi

//----- (0040165C) --------------------------------------------------------
HANDLE __userpurge sub_40165C@<eax>(int a1@<edi>, int a2, int a3, int a4)
{
  HWND ActiveWindow; // eax
  int v5; // edx
  int v6; // ecx

  ActiveWindow = GetActiveWindow();
  sub_4011F8((int)ActiveWindow, v6, a1, (int)&unk_403218, v5, v6, a1, (int)ActiveWindow);
  return GetCurrentThread();
}
// 40165C: could not find valid save-restore pair for esi
// 401674: variable 'v6' is possibly undefined
// 401674: variable 'v5' is possibly undefined

//----- (00401688) --------------------------------------------------------
void *__userpurge sub_401688@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4, int a5, int a6, int a7)
{
  sub_40119C((int)&unk_4032AC, a2, a3, a2, a3, a1);
  GetCommandLineA();
  GetCommandLineA();
  return &unk_4032AC;
}

//----- (004016B4) --------------------------------------------------------
DWORD __userpurge sub_4016B4@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<edi>, int a4@<esi>, int a5, int a6, int a7)
{
  sub_4010B8((int)&unk_403068, a3, a2, a2, a1, a4);
  GetSystemDefaultLangID();
  return GetLogicalDrives();
}
// 4016B4: could not find valid save-restore pair for ebx

//----- (004016E0) --------------------------------------------------------
DWORD __userpurge sub_4016E0@<eax>(int a1@<ebx>, int a2@<esi>, int a3, int a4, int a5)
{
  int v5; // eax
  int v6; // edx
  int v7; // ecx

  LOWORD(v5) = GetSystemDefaultLangID();
  sub_401688(v6, v7, a1, v6, v5, a2, v6);
  return GetLogicalDrives();
}
// 4016E0: could not find valid save-restore pair for edi
// 4016F8: variable 'v6' is possibly undefined
// 4016F8: variable 'v7' is possibly undefined
// 4016F8: variable 'v5' is possibly undefined

//----- (0040170C) --------------------------------------------------------
HWND __userpurge sub_40170C@<eax>(int a1@<ebx>, int a2@<edi>, int a3@<esi>, int a4, int a5, int a6)
{
  int v6; // ecx

  Sleep(0xBu);
  sub_4013F0((int)&unk_40314C, a1, a2, a1, v6, a3);
  return GetForegroundWindow();
}
// 40172B: variable 'v6' is possibly undefined

//----- (00401740) --------------------------------------------------------
HWND __userpurge sub_401740@<eax>(int a1@<ebx>, int a2, int a3, int a4)
{
  int CurrentProcessId; // eax
  int v5; // edx

  CurrentProcessId = GetCurrentProcessId();
  sub_4012D8(a1, CurrentProcessId, v5, CurrentProcessId);
  return GetActiveWindow();
}
// 401740: could not find valid save-restore pair for edi
// 401757: variable 'v5' is possibly undefined

//----- (00401768) --------------------------------------------------------
HWND __userpurge sub_401768@<eax>(int a1@<ebx>, int a2@<esi>, int a3, int a4)
{
  int CurrentThreadId; // eax

  CurrentThreadId = GetCurrentThreadId();
  sub_401090(CurrentThreadId, a1, a2 + 708, a2, a2, a1, a2);
  return GetForegroundWindow();
}
// 401768: could not find valid save-restore pair for edi

// nfuncs=52 queued=36 decompiled=36 lumina nreq=0 worse=0 better=0
// ALL OK, 36 function(s) have been successfully decompiled
