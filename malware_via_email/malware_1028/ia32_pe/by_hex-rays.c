/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// char __userpurge start@<al>(int _EAX@<eax>, int _EDX@<edx>, unsigned int _ECX@<ecx>, int _EBX@<ebx>, int a5@<ebp>, int a6@<edi>, int a7@<esi>, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);


//----- (004067FC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
char __userpurge start@<al>(int _EAX@<eax>, int _EDX@<edx>, unsigned int _ECX@<ecx>, int _EBX@<ebx>, int a5@<ebp>, int a6@<edi>, int a7@<esi>, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  signed int v64; // edi
  unsigned int v65; // ebx
  unsigned int v68; // ecx
  int v69; // ebx
  int v71; // ebx
  unsigned int v75; // ecx
  int v76; // ebx
  int v77; // edx
  int v78; // ebx
  int v81; // esi
  __int16 v82; // ax
  int v83; // edi
  unsigned int v85; // ecx
  __int16 v87; // di
  bool v88; // tt
  unsigned int v89; // ecx
  int v90; // ecx
  int v91; // ecx
  int v93; // edx
  int v94; // esi
  bool v96; // tt
  int v97; // esi
  unsigned int v98; // ebx
  int v103; // esi
  int v110; // esi
  int v112; // ebp
  _DWORD *v113; // edi
  int v115; // ecx
  __int16 v116; // dx
  int v118; // edi
  bool v121; // cc
  bool v122; // cf
  int v123; // esi
  int v124; // edi
  int v133; // edi
  int v136; // edi
  int v137; // esi
  int v138; // edx
  int v143; // edi
  int v146; // [esp-10h] [ebp-10h]
  int v147; // [esp-Ch] [ebp-Ch]
  _DWORD v148[2]; // [esp-8h] [ebp-8h] BYREF

  BYTE1(_EBX) = -112;
  _CL = ~__ROR1__(_ECX, _ECX);
  v122 = __CFADD__((_WORD)_EBX, (_WORD)a6);
  LOWORD(a6) = _EBX + a6;
  __asm { rcr     al, 2 }
  LOBYTE(_EDX) = _EBX + v122 + _EDX;
  LOWORD(_EAX) = a7 ^ _EAX;
  v133 = a6 & 0x23262560;
  _ESI = a7 + 1863576881;
  __asm
  {
    rcl     cl, cl
    rcr     esi, 0Dh
  }
  _ESI = _ESI ^ 0xA61E24D0;
  BYTE1(_EBX) = 111;
  __asm { rcl     cx, cl }
  _ECX = _ECX >> _ECX;
  __asm { rcl     dh, cl }
  if ( _ECX != -340594266 )
  {
LABEL_4:
    v68 = v133 + _ECX;
    BYTE1(_EDX) -= _EAX;
    BYTE1(v68) = __ROL1__(BYTE1(v68), v68);
    v69 = _EDX | _EBX;
    v122 = __CFSHL__(BYTE1(v69), 3);
    BYTE1(v69) *= 8;
    _ECX = v68 - (v122 + 251229118);
    v71 = v69 - 1;
    if ( _EDX == -964407151 )
    {
      __asm
      {
        outsd
        retf    0C096h
      }
    }
    BYTE1(_ECX) <<= _ECX;
    LOBYTE(_ECX) = __ROR1__(_ECX, _ECX);
    __asm
    {
      rcr     ecx, 19h
      rcl     edx, cl
    }
    LOWORD(v133) = v133 + 1;
    BYTE1(v71) = 124;
    _EBX = -v71;
    LOWORD(_EDX) = -(__int16)_EDX;
    v110 = ((_WORD)_EDX != 0) + _ESI - 179056147;
    LOBYTE(_EBX) = _EBX + 93;
    LOWORD(_EBX) = ~(_WORD)_EBX;
    __asm { rcl     ebx, 5 }
    _ECX = _EBX & _ECX;
    _EBX = -_EBX;
    LOWORD(_EBX) = v133 + (_EBX != 0) + (_WORD)_EBX;
    v118 = _EAX + v133;
    BYTE1(_EDX) = __ROL1__(0, _ECX);
    v116 = (_WORD)_EDX << _ECX;
    __asm { rcl     bh, cl }
    LOWORD(v118) = _ECX;
    LOWORD(_ECX) = (__int16)_ECX >> _ECX;
    LOBYTE(_EDX) = (_BYTE)v116 << _ECX;
    BYTE1(_EDX) = HIBYTE(v116) - 1;
    v121 = _EAX <= 1269392729;
    if ( _EAX != 1269392729 )
    {
      BYTE1(_ECX) += BYTE1(_EBX);
      _BL = __ROR4__(_EBX, _ECX);
      LOBYTE(_ECX) = _BL ^ _ECX;
      __asm { rcl     bl, 1 }
      v122 = __CFSHL__(_ECX - _EAX, 14);
      v115 = v118;
      LOBYTE(v115) = v118 - (v122 + _BL);
      if ( v115 == -1148083390 )
        JUMPOUT(0x406663);
      JUMPOUT(0x406687);
    }
    __asm { daa }
    if ( v121 )
      JUMPOUT(0x40665B);
    _enable();
    BYTE1(_EBX) -= BYTE1(_ECX);
    BYTE1(_EDX) ^= 0x65u;
    v122 = __CFSHL__(_EBX, 12);
    v76 = _EBX << 12;
    LOBYTE(_EDX) = __ROR1__(v122 + _EDX + 75, 4);
    BYTE1(_ECX) ^= 0x59u;
    __asm { rcl     edx, cl }
    v143 = -1392050134 << _ECX;
    v75 = _ECX & 0xDC3B4829;
    if ( v75 != 243794339 )
    {
      BYTE1(_EDX) &= v75;
      LOBYTE(v75) = v75 - 101;
      BYTE1(v75) -= 57;
      v77 = v75 + _EDX;
      LOBYTE(v76) = v76 - BYTE1(v76);
      LOBYTE(v77) = -(char)v77;
      if ( v143 == 30170773 )
      {
        __asm { into }
        v147 = _EAX;
        v146 = v143;
        v148[-3] = 867383469;
        v148[-4] = v148;
        v148[-5] = v76;
        v148[-6] = v75;
        v148[-7] = v77;
        v148[-8] = v110;
        JUMPOUT(0x406225);
      }
      JUMPOUT(0x4065B7);
    }
    return _EAX;
  }
  __DS__ = *(_WORD *)(a5 - 101 + 4);
  v112 = *(_DWORD *)(_EBX - 21);
  _ECX = *(_DWORD *)_EDX;
  __DS__ = *(_WORD *)(_EDX + 4);
  v113 = (_DWORD *)(v133 << 10);
  if ( _ECX == 1586779755 )
    JUMPOUT(0x4065D7);
  BYTE1(_EBX) = MEMORY[0xC0FD2A3C];
  __asm { rcl     dl, cl }
  LOBYTE(_ECX) = MEMORY[0xC0FD2A3B] ^ _ECX;
  _DL = BYTE1(_ECX) & _DL;
  _DH = __ROR1__(0, 9) >> _ECX;
  __asm
  {
    rcl     dl, 17h
    rcr     ch, cl
  }
  LOBYTE(_EBX) = 0;
  if ( MEMORY[0xC0FD2A3B] != 1534715476 )
  {
    __asm { rcl     dh, 13h }
    LOBYTE(_EBX) = __ROL1__(__ROR1__(0, 30) + 1, _DL);
    __asm { rcl     ebx, 1Dh }
    LOBYTE(_ECX) = MEMORY[0xC0FD2A3B] | _DH ^ _DL;
LABEL_36:
    __asm { rcl     bh, cl }
    LOBYTE(_ECX) = _ECX | 0xC0;
    __asm
    {
      rcr     ebx, 1Bh
      rcr     ch, 7
      rcl     bx, cl
    }
    JUMPOUT(0x4067D2);
  }
  _EAX = 1534715476;
  __asm
  {
    aas
    xlat
  }
  *v113 = MEMORY[0x5B79E654];
  HIWORD(v103) = 23417;
  _EDX = __ROR4__(521873544, 15);
  LOBYTE(_ECX) = BYTE1(_EDX) ^ _ECX;
  __asm { rcr     dl, 8 }
  _EDX = _ECX + _EDX;
  BYTE1(_EDX) <<= _ECX;
  _ECX = _ECX & 0x709CF2E3;
  _EBX = __ROL4__(164986989 * *_EAX, 9);
  __asm
  {
    rcr     edx, 0Eh
    rcl     ecx, 6
  }
  v82 = 3;
  BYTE1(_EDX) = BYTE1(_ECX) + (BYTE1(_ECX) & BYTE1(_EDX));
  v64 = (unsigned int)(v113 + 1) >> 14;
  v122 = __CFSHL__(_ECX, _ECX);
  LOBYTE(_ECX) = (_BYTE)_ECX << _ECX;
  LOWORD(_EDX) = v64 + v122 + (_WORD)_EDX;
  __asm { rcr     ecx, cl }
  LOBYTE(_ECX) = _ECX & 0xC5;
  BYTE1(_EBX) = __ROL1__(BYTE1(_EBX), _ECX);
  __asm { rcr     cl, 0Ah }
  v136 = v64 >> 6;
  __asm { rcr     cl, 0Ah }
  LOBYTE(_EDX) = _EBX & _EDX;
  v93 = _EDX >> _ECX;
  LOBYTE(_EBX) = (char)_EBX >> 7;
  LOBYTE(v93) = ~(_BYTE)v93;
  LOWORD(v103) = -6567;
  BYTE1(_ECX) = _ECX + __CFSHL__(_EBX, _ECX) + 2;
  LOWORD(v93) = (_WORD)v93 << _ECX;
  v94 = v103 & 0x48DDA92A;
  LOWORD(_EBX) = (unsigned __int8)((unsigned __int8)__ROL2__(_EBX, _ECX) << _ECX);
  if ( v136 == -1850222333 )
  {
    v147 = (unsigned __int16)__SS__;
    LOBYTE(v93) = v93 - 107;
    BYTE1(_ECX) = __ROR1__(BYTE1(_ECX), 13);
    v96 = __CFSHL__(v93, 29);
    LOBYTE(v93) = __ROL1__(v93, 29);
    LOWORD(v136) = v93 + v96 - 9981;
    BYTE1(_EBX) = -1;
    v98 = _EBX >> 23;
    LOBYTE(v93) = 0;
    LOBYTE(_ECX) = -9;
    v137 = _ECX + v94;
    v138 = v93 ^ 3;
    LOWORD(v137) = v137 - v136;
    BYTE1(_ECX) = ~BYTE1(_ECX);
    v97 = v137 << 23;
    BYTE1(v98) = __ROL1__(0, 247);
    v133 = v136 - 1776230842;
    LOBYTE(_ECX) = 0;
    LOBYTE(v98) = BYTE1(v98);
    LOWORD(v98) = -(__int16)v98;
    v65 = v98 ^ 0x9FFE5F76;
    _ESI = v97 + 1583342953;
    if ( v133 != -1425920780 )
    {
      __asm { int     2Eh; DOS 2+ internal - EXECUTE COMMAND }
      _CL = 0;
      _ESI = _ESI - 236695319;
      __asm { rcr     esi, cl }
      JUMPOUT(0x406276);
    }
    _EAX = v65;
    _EBX = 3;
    v146 = v112;
    __asm { int     18h; TRANSFER TO ROM BASIC }
    _EDX = v138 - 1;
    MEMORY[3] = _EAX;
    _ECX = _ECX - 1;
    goto LABEL_4;
  }
  v124 = v136 >> 19;
  LOWORD(_EBX) = _EBX - v93;
  LOBYTE(_ECX) = 0;
  BYTE1(_ECX) -= BYTE1(v93);
  _ECX = _ECX + 1;
  if ( _ECX == 1072700366 )
  {
    LOBYTE(_EBX) = 9;
    __asm { rep not dword ptr [ebx] }
    goto LABEL_36;
  }
  SBYTE1(_ECX) >>= _ECX;
  BYTE1(_EBX) = __ROR1__(BYTE1(_EBX), _ECX);
  v123 = v94 << 30;
  LOWORD(v124) = _ECX ^ v124;
  LOBYTE(_ECX) = 32 * _ECX;
  LOBYTE(_EBX) = BYTE1(_ECX) & _EBX;
  v78 = v123 & _EBX;
  _ECX = v123 & _ECX;
  BYTE1(v78) += BYTE1(_ECX);
  v122 = __CFSHL__(v78, 28);
  _EBX = v78 << 28;
  v81 = _EBX + v122 + v123;
  if ( _EBX == 1317517098 )
  {
    LOBYTE(v82) = 81;
    _ESI = v81 + 4;
    v83 = v124 + 4;
  }
  else
  {
    __asm { rcl     ebx, 0Bh }
    _ESI = __ROL4__(v81, _ECX);
    v83 = v124 - _ECX;
    _EBX >>= 11;
    __asm { rcl     bl, cl }
    _EBX = _EBX + 1642631734;
    _ECX = 552270308;
    BYTE1(_ECX) = __ROL1__(-7, 228);
    __asm { rcl     cl, cl }
    LOWORD(v83) = _ESI + v83;
  }
  LOBYTE(_ECX) = _ECX + 1;
  v85 = (unsigned int)(_ECX - 1) >> 9;
  __asm { rcl     esi, 1Bh }
  v122 = __CFADD__(v85, -1213456924);
  v89 = v85 - 1213456924;
  v87 = __ROL4__(v83 - (v122 - 958808652), 21);
  v122 = __CFSHR__(BYTE1(v89), v89);
  BYTE1(v89) >>= v89;
  v88 = v122;
  v122 = __CFADD__(v122, (_BYTE)v89);
  LOBYTE(v89) = v88 + v89;
  v122 |= __CFADD__((_BYTE)v89, 103);
  LOBYTE(v89) = v89 + 103;
  LOWORD(v89) = v89 - v122;
  if ( v89 != -1248843282 )
  {
    _ECX = v89 - ((v89 < 0xB59029EE) - 1634215450);
    __asm
    {
      rcl     ecx, cl
      rcr     ebx, 8
      rcr     esi, 12h
    }
    LOBYTE(_ECX) = (char)_ECX >> _ECX;
    __asm { rcl     ch, cl }
    LOBYTE(_ECX) = (_BYTE)_ECX << _ECX;
    HIWORD(_EDI) = 21511;
    LOWORD(_ECX) = (unsigned __int16)_ECX >> _ECX;
    LOWORD(_EDI) = 19789 - (__CFSHL__(BYTE1(_ECX), _ECX) + v82);
    _CL = v82 + ((unsigned __int16)(__CFSHL__(BYTE1(_ECX), _ECX) + v82) > 0x4D4Du) + _ECX;
    __asm { rcr     di, cl }
    if ( _EDI == 2090718425 )
      JUMPOUT(0x406558);
    JUMPOUT(0x4066FA);
  }
  LOBYTE(_EAX) = 113;
  BYTE1(_EBX) -= 7;
  HIWORD(v90) = -19056;
  LOWORD(v90) = v87 & 0x29EE;
  v91 = v90 >> 21;
  if ( _EBX == -1896076836 )
  {
    LOBYTE(_EAX) = 12;
  }
  else
  {
    _ECX = __ROR4__(v91, 28);
    __asm { rcr     ch, 0Ch }
  }
  return _EAX;
}
// 40629E: positive sp value 8 has been found
// 406224: control flows out of bounds to 406225
// 4063BE: control flows out of bounds to 4063C4
// 406552: control flows out of bounds to 406558
// 40660F: control flows out of bounds to 406615
// 40663A: control flows out of bounds to 40663C
// 406660: control flows out of bounds to 406663
// 4067A3: control flows out of bounds to 4067A4
// 4067F6: control flows out of bounds to 4067FA
// 406895: inconsistent fpu stack
// 4068B7: control flows out of bounds to 4068B8
// 40697F: control flows out of bounds to 406982
// 406AC8: control flows out of bounds to 406ACA
// 406462: control flows out of bounds to 406463
// 40614A: control flows out of bounds to 406894
// 406478: control flows out of bounds to 4066FA
// 4064D8: control flows out of bounds to 406276
// 40656F: control flows out of bounds to 406AC7
// 4069C5: control flows out of bounds to 406687
// 4069E4: control flows out of bounds to 4067D2
// 406A93: control flows out of bounds to 4062FA
// 40621C: control flows out of bounds to 4065B7
// 4065D9: control flows out of bounds to 4065D7
// 406686: control flows out of bounds to 40665B
// 4066CA: control flows out of bounds to 406381
// 4067CF: control flows out of bounds to 4067F3
// 4067EF: control flows out of bounds to 4065D8
// 406316: conditional instruction was optimized away because of 'esi.4<48DDA92Bu'
// 406502: conditional instruction was optimized away because of 'edx.4==0'
// 4067C7: conditional instruction was optimized away because of 'edx.4==0'
// 4067FC: too many input arguments, some ignored

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
