/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void sub_40104F();
void sub_40113E();
void __fastcall sub_40115A(int a1, int a2);
_DWORD start(); // weak
void sub_401341();
void sub_402107();
double sub_402146(); // weak
_DWORD sub_402162(); // weak
// void __usercall sub_4021FE(int a1@<eax>, int a2@<ecx>);
// double __userpurge sub_4022F0@<st0>(unsigned __int8 a1@<ah>, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
void sub_402376();
// void __usercall sub_40245A(char a1@<cf>, int a2@<eax>, int a3@<edx>, int a4@<ecx>, __int32 a5@<ebx>, int a6@<edi>, int a7@<esi>);
void sub_40260A();
void sub_402631();
// void __usercall sub_402679(char a1@<ah>, int a2@<edx>, int a3@<ecx>, __int32 a4@<ebx>, char a5@<dil>, int a6@<esi>);
// int __usercall sub_4028C0@<eax>(unsigned __int8 a1@<ah>);
void sub_4028DF();
_DWORD __far sub_402936(); // weak
// void __usercall sub_402AF9(int a1@<eax>, int a2@<edx>, int a3@<ecx>, __int32 a4@<ebx>, int a5@<edi>, int a6@<esi>);
void sub_402B3C();
// void __usercall sub_402B53(__int32 a1@<ebx>);
// void __usercall sub_402BC7(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int _EBX@<ebx>, int a5@<ebp>, int a6@<edi>, int a7@<esi>, double a8@<st1>, double a9@<st0>);
void sub_402D29();
// void __usercall sub_402D88(int a1@<eax>, int a2@<edx>, int a3@<ecx>, __int16 a4@<bx>, int a5@<edi>, int a6@<esi>);
// void __usercall sub_402DBE(int _EDX@<edx>, int a2@<esi>);
void sub_402F11();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_40111C; // weak
_UNKNOWN loc_401233; // weak
_UNKNOWN loc_402080; // weak
_UNKNOWN loc_40240E; // weak
_UNKNOWN loc_4025E9; // weak
_UNKNOWN loc_4029D7; // weak
_UNKNOWN loc_402DA0; // weak


//----- (0040104F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40104F()
{
  sub_402D29();
  JUMPOUT(0x4013B4);
}
// 401053: positive sp value 4 has been found
// 4013B2: control flows out of bounds to 4013B4

//----- (0040113E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40113E()
{
  int v2; // edx
  int v3; // ecx
  char v4; // zf

  _EAX = ((int (*)(void))loc_40111C)();
  if ( v4 )
    JUMPOUT(0x40112D);
  __asm { xlat }
  if ( v2 + _EAX >= 0 )
    JUMPOUT(0x4011C5);
  sub_40115A(v3, v2);
}
// 401142: positive sp value 4 has been found
// 401152: control flows out of bounds to 40112D
// 401157: control flows out of bounds to 4011C5
// 401152: variable 'v4' is possibly undefined
// 401155: variable 'v2' is possibly undefined
// 401159: variable 'v3' is possibly undefined

//----- (0040115A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_40115A(int a1, int a2)
{
  ((void (__fastcall *)(int, int))((char *)&loc_401233 + 2))(a1, a1 ^ a2);
  JUMPOUT(0x401176);
}
// 40115E: positive sp value 4 has been found
// 401171: control flows out of bounds to 401176

//----- (0040124D) --------------------------------------------------------
#error "4011BB: positive sp value has been found (funcsize=212)"

//----- (00401341) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401341()
{
  void *v0; // [esp+10h] [ebp-4h]
  void *retaddr; // [esp+14h] [ebp+0h]

  *(&retaddr - 6) = v0;
  JUMPOUT(0x401084);
}
// 401345: positive sp value 4 has been found
// 40134F: control flows out of bounds to 401084

//----- (00402107) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402107()
{
  int v0; // [esp+14h] [ebp-Ch]
  int v1; // [esp+18h] [ebp-8h]

  *(&v1 - 9) = v0;
  ((void (__stdcall *)(int))((char *)&loc_40240E + 2))(v1);
  JUMPOUT(0x402BE8);
}
// 402EDD: positive sp value C has been found
// 402EF3: control flows out of bounds to 402EF9
// 402EE5: control flows out of bounds to 402BE8

//----- (00402146) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402146(__int32 a1@<edi>)
{
  __int32 v1; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v1, a1);
  JUMPOUT(0x4020AE);
}
// 40214E: positive sp value 4 has been found
// 402156: control flows out of bounds to 4020AE

//----- (00402162) --------------------------------------------------------
#error "402174: cannot convert to microcode (funcsize=8)"

//----- (004021FE) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4021FE(int a1@<eax>, int a2@<ecx>)
{
  bool v2; // cf
  __int16 v3; // ax
  bool v4; // of
  char v5; // ah

  LOBYTE(a1) = 73;
  v2 = __CFADD__(a2, a1);
  v3 = a2 + a1;
  v4 = __OFADD__(v2, HIBYTE(v3));
  v5 = v2 + HIBYTE(v3);
  if ( (char)(v5 + 121) < 0 == (v4 | __OFADD__(121, v5)) && (char)(v5 + 121) < 0 != (v4 | __OFADD__(121, v5)) )
    JUMPOUT(0x402227);
  JUMPOUT(0x402494);
}
// 402202: positive sp value 4 has been found
// 402225: control flows out of bounds to 402227
// 402497: control flows out of bounds to 402499
// 402488: control flows out of bounds to 402494

//----- (004022F0) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
double __userpurge sub_4022F0@<st0>(unsigned __int8 a1@<ah>, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  double result; // st7
  void *v65; // [esp+18h] [ebp-4h]
  void *retaddr[2]; // [esp+1Ch] [ebp+0h]

  retaddr[-8] = v65;
  result = sub_402146() - (double)*(int *)(a1 + 0x6A);
  MK_FP(retaddr[0], retaddr[0])();
  return result;
}
// 4022F4: positive sp value 4 has been found
// 402866: bad sp value at call
// 4022F0: too many input arguments, some ignored
// 402146: using guessed type double sub_402146();

//----- (00402376) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402376()
{
  __asm { rep pop edx }
  JUMPOUT(0x4021C7);
}
// 40231B: positive sp value 4 has been found
// 4027DB: control flows out of bounds to 4021C7

//----- (0040245A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40245A(char a1@<cf>, int a2@<eax>, int a3@<edx>, int a4@<ecx>, __int32 a5@<ebx>, int a6@<edi>, int a7@<esi>)
{
  void *v7; // [esp+Ch] [ebp-4h]
  void *retaddr; // [esp+10h] [ebp+0h]

  *(&retaddr - 5) = v7;
  BYTE1(a5) += a1 + 102;
  LOBYTE(a5) = (BYTE1(a5) ^ a5) + 1;
  BYTE1(a5) = BYTE1(a5) - 89 - (__CFADD__(BYTE1(a5), -89) + 59);
  sub_402AF9(a2, a3, a4, a5, a6, a7);
  __asm { iret }
}
// 40245E: positive sp value 4 has been found
// 402472: control flows out of bounds to 402473

//----- (0040260A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40260A()
{
  JUMPOUT(0x402436);
}
// 40260E: positive sp value 4 has been found
// 402624: control flows out of bounds to 402436

//----- (00402631) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402631()
{
  int v0; // [esp+2Ch] [ebp-4h]
  void *retaddr[2]; // [esp+30h] [ebp+0h]

  retaddr[-13] = (void *)v0;
  v0 = 64;
  JUMPOUT(0x402D47);
}
// 402635: positive sp value 4 has been found
// 402649: control flows out of bounds to 402D47
// 402651: conditional instruction was optimized away because of 'ah.1!=0'

//----- (00402679) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402679(char a1@<ah>, int a2@<edx>, int a3@<ecx>, __int32 a4@<ebx>, char a5@<dil>, int a6@<esi>)
{
  int v6; // ecx
  int v7; // ecx
  __int32 v8; // [esp-8h] [ebp-8h] BYREF

  _InterlockedExchange(&v8, a4);
  LOBYTE(a3) = ~(_BYTE)a3 - a1;
  v6 = a6 | a3;
  if ( !__SETP__(v6, 32) && __SETP__(v6, 32) )
  {
    LOBYTE(v6) = a5 | (v8 + 1);
    ((void (__fastcall *)(int, int))((char *)&loc_402DA0 + 1))(v6, a2 - 2775);
    *(_DWORD *)(v7 - 1) <<= v7;
    JUMPOUT(0x402D26);
  }
  JUMPOUT(0x402F5A);
}
// 402D08: positive sp value 8 has been found
// 402D24: control flows out of bounds to 402D26
// 402CF4: control flows out of bounds to 402F5A
// 402D21: variable 'v7' is possibly undefined

//----- (004028C0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4028C0@<eax>(unsigned __int8 a1@<ah>)
{
  char v1; // sf
  char v2; // of
  int v4; // [esp-C18Bh] [ebp-C193h]
  int v5[12385]; // [esp-C187h] [ebp-C18Fh]
  void *retaddr[2]; // [esp+8h] [ebp+0h]

  v5[-3] = v4;
  sub_4022F0(
    a1,
    v5[0],
    v5[1],
    v5[2],
    v5[3],
    v5[4],
    v5[5],
    v5[6],
    v5[7],
    v5[8],
    v5[9],
    v5[10],
    v5[11],
    v5[12],
    v5[13],
    v5[14],
    v5[15],
    v5[16],
    v5[17],
    v5[18],
    v5[19],
    v5[20],
    v5[21],
    v5[22],
    v5[23],
    v5[24],
    v5[25],
    v5[26],
    v5[27],
    v5[28],
    v5[29],
    v5[30],
    v5[31],
    v5[32],
    v5[33],
    v5[34],
    v5[35],
    v5[36],
    v5[37],
    v5[38],
    v5[39],
    v5[40],
    v5[41],
    v5[42],
    v5[43],
    v5[44],
    v5[45],
    v5[46],
    v5[47],
    v5[48],
    v5[49],
    v5[50],
    v5[51],
    v5[52],
    v5[53],
    v5[54],
    v5[55],
    v5[56],
    v5[57],
    v5[58],
    v5[59],
    v5[60],
    v5[61]);
  if ( v1 == v2 )
    JUMPOUT(0x4023A4);
  return MK_FP(retaddr[0], retaddr[0])();
}
// 4023AA: positive sp value C193 has been found
// 4023AA: control flows out of bounds to 4023A4
// 4023AA: variable 'v1' is possibly undefined
// 4023AA: variable 'v2' is possibly undefined

//----- (004028DF) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4028DF()
{
  JUMPOUT(0x402888);
}
// 402881: positive sp value 4 has been found
// 402886: control flows out of bounds to 402888

//----- (00402936) --------------------------------------------------------
#error "402962: cannot convert to microcode (funcsize=20)"

//----- (00402AF9) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402AF9(int a1@<eax>, int a2@<edx>, int a3@<ecx>, __int32 a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  int v6; // eax
  bool v8; // cf
  char v9; // cc
  __int32 v10; // ebx
  _DWORD *v12; // esi
  int v13; // ecx
  int v14; // esi
  int v15; // esi
  int v16; // edi
  __int32 v17; // [esp-Ch] [ebp-Ch] BYREF

  _InterlockedExchange(&v17, a4);
  v14 = a5 + a6;
  HIWORD(v10) = HIWORD(a1);
  v6 = ~a1;
  BYTE1(v10) = (BYTE1(a3) ^ 0x81) - a3;
  _EDI = v14 | a5;
  v8 = __CFADD__(BYTE1(a2), BYTE1(v10));
  v9 = ((char)(BYTE1(a2) + BYTE1(v10)) < 0) ^ __OFADD__(BYTE1(a2), BYTE1(v10));
  BYTE1(v10) += BYTE1(a2);
  LOBYTE(v10) = v6;
  if ( v9 )
    goto LABEL_9;
  __asm { repne mov edi, edi }
  if ( !v9 )
  {
LABEL_9:
    v15 = _EDI | v14;
    v16 = a3 ^ _EDI;
    if ( !v6 )
      JUMPOUT(0x402C05);
    LOBYTE(a2) = -(char)a2;
    LOBYTE(a2) = a2 - 1;
    --BYTE1(a2);
    v12 = (_DWORD *)(a2 + v15);
    ((void (*)(void))((char *)&loc_4029D7 + 1))();
    v17 = v16;
    if ( v13 )
    {
      *(_DWORD *)(v16 - 1) = *v12;
      JUMPOUT(0x402769);
    }
    JUMPOUT(0x40271E);
  }
  *(_DWORD *)_EDI = v6 - 1;
  __asm { repne pop eax }
  LOBYTE(v10) = ((unsigned __int8)v10 < (unsigned __int8)(v8 + 39)) + v10 - (v8 + 39) - 17;
  sub_402B53(v10);
  sub_402376();
}
// 402375: positive sp value C has been found
// 402768: control flows out of bounds to 402769
// 402F56: control flows out of bounds to 402F5B
// 402A58: control flows out of bounds to 402C05
// 402765: control flows out of bounds to 40271E
// 402F2B: control flows out of bounds to 402EE9
// 402F42: control flows out of bounds to 402D6B
// 402F54: control flows out of bounds to 402F58
// 402AF9: could not find valid save-restore pair for ebp
// 402F24: conditional instruction was optimized away because of 'dl.1!=0'
// 402765: variable 'v13' is possibly undefined

//----- (00402B3C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402B3C()
{
  __asm { repne pop esi }
}
// 402B41: positive sp value 4 has been found

//----- (00402B53) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402B53(__int32 a1@<ebx>)
{
  __int32 v2; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v2, a1);
  __asm { rep pop ebx }
  JUMPOUT(0x4020E4);
}
// 40219C: positive sp value 4 has been found
// 4021DC: control flows out of bounds to 4021E1
// 4021AF: control flows out of bounds to 4020E4
// 4021BD: conditional instruction was optimized away because of 'bh.1==0'

//----- (00402BC7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402BC7(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int _EBX@<ebx>, int a5@<ebp>, int a6@<edi>, int a7@<esi>, double a8@<st1>, double a9@<st0>)
{
  int v9; // eax
  int v10; // ecx
  char v11; // zf
  int v16; // eax

  BYTE1(_EBX) = -BYTE1(_EBX) - 1;
  LOBYTE(_EBX) = (a3 | _EBX) - 1;
  sub_402D88(a1 ^ 0xFFFFFEC8, a2, a3, _EBX, (a2 | a7) ^ a6, a2 | a7);
  if ( !v11 )
    a8 = a9;
  __outbyte(0xE4u, v9);
  *(_DWORD *)(v9 - 114) ^= a5;
  BYTE1(_EBX) |= v9;
  LOBYTE(_EBX) = _EBX - 108;
  LOBYTE(v10) = ~(_BYTE)v10;
  _AL = ((int (__usercall *)@<eax>(int@<ecx>, double@<st0>, double@<st1>))loc_4025E9)(v10, a9, a8);
  _EBP = a5 + 1;
  __asm
  {
    rcr     dword ptr [ebp+ecx-9650298h], 1
    xlat
  }
  v16 = ((int (*)(void))((char *)&loc_402080 + 3))();
  *(_DWORD *)(v16 - 1529169572) &= 0x24448FFCu;
  JUMPOUT(0x402C24);
}
// 402BCB: positive sp value 4 has been found
// 402C1A: control flows out of bounds to 402C24
// 402BE1: variable 'v11' is possibly undefined
// 402BE3: variable 'v9' is possibly undefined
// 402BF2: variable 'v10' is possibly undefined

//----- (00402D29) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402D29()
{
  sub_402631();
  _ZF = *_EDX >> 1 == 0;
  *_EDX >>= 1;
  if ( !_ZF )
  {
    *_EAX ^= (unsigned __int8)_EDX;
    __asm { repne sub al, dl }
    JUMPOUT(0x402EF2);
  }
  JUMPOUT(0x402D26);
}
// 402D3F: positive sp value 4 has been found
// 4022E6: control flows out of bounds to 402E9E
// 402D42: control flows out of bounds to 402D26
// 402D56: control flows out of bounds to 402EF2
// 402D40: variable '_EDX' is possibly undefined
// 402D44: variable '_EAX' is possibly undefined

//----- (00402D88) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402D88(int a1@<eax>, int a2@<edx>, int a3@<ecx>, __int16 a4@<bx>, int a5@<edi>, int a6@<esi>)
{
  int v8; // [esp-4h] [ebp-4h]

  HIBYTE(a4) = BYTE1(a3) - a2;
  sub_40245A(BYTE1(a3) < (unsigned __int8)a2, a1, a2, a3, a4, a5 - 2, a2 | a6);
  _EAX = v8;
  __asm { aam     89h ; '‰' }
  JUMPOUT(0x402DA2);
}
// 402D9C: positive sp value 8 has been found
// 402DA0: control flows out of bounds to 402DA2
// 402D9B: variable 'v8' is possibly undefined

//----- (00402DBE) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402DBE(int _EDX@<edx>, int a2@<esi>)
{
  _EAX = a2;
  LOBYTE(_EAX) = -(char)a2;
  if ( (char)-(char)a2 >= 1 )
  {
    __asm { repne push edx }
    if ( (char)-(char)a2 < 1 )
    {
      __asm { rep cdq }
      JUMPOUT(0x402DF0);
    }
  }
  JUMPOUT(0x402DEE);
}
// 4022B5: positive sp value 4 has been found
// 402DEA: control flows out of bounds to 402DF0
// 402782: control flows out of bounds to 402DEE
// 40279F: control flows out of bounds to 402733

//----- (00402F11) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402F11()
{
  JUMPOUT(0x402F1A);
}
// 402F17: positive sp value 4 has been found
// 402F17: control flows out of bounds to 402F1A

// nfuncs=26 queued=26 decompiled=26 lumina nreq=0 worse=0 better=0
#error "There were 3 decompilation failure(s) on 26 function(s)"
