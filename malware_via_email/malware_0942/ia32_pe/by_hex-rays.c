/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// char __usercall sub_407565@<al>(int _ECX@<ecx>, int a2@<ebx>, int a3@<ebp>, int a4@<edi>, _BYTE *a5@<esi>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_407855; // weak
_UNKNOWN loc_4078D1; // weak


//----- (00407565) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
char __usercall sub_407565@<al>(int _ECX@<ecx>, int a2@<ebx>, int a3@<ebp>, int a4@<edi>, _BYTE *a5@<esi>)
{
  int v6; // ebx
  __int16 v10; // dx
  char *v11; // eax
  _DWORD *v12; // ecx
  char *v13; // eax
  _BYTE *v21; // esi
  unsigned int v22; // edx
  int v23; // eax
  unsigned int v24; // ebx
  int v26; // ecx
  int v28; // eax
  int v29; // ecx
  char v31; // bl
  unsigned __int8 v32; // bh
  int v33; // ecx
  unsigned int v37; // ett
  __int16 v38; // cx
  char v39; // al
  char v40; // cl
  int v42; // ebp
  int v45; // edi
  bool v46; // tt
  char result; // al
  __int16 v49; // dx
  int v50; // edx
  _DWORD *v51; // eax
  int v54; // ecx
  int v55; // edi
  int v56; // eax
  int v57; // et2
  bool v61; // cf
  unsigned int v62; // ecx
  int v63; // [esp-14h] [ebp-14h]
  int v64; // [esp-10h] [ebp-10h]
  _BYTE *v65; // [esp-Ch] [ebp-Ch]
  int *v66; // [esp-8h] [ebp-8h] BYREF
  int v67; // [esp-4h] [ebp-4h] BYREF

  LOBYTE(_ECX) = BYTE1(_ECX) & _ECX;
  __asm { rcr     cl, 0Ah }
  LOBYTE(_ECX) = 0;
  v67 = _ECX;
  v66 = &v67;
  v51 = (_DWORD *)&loc_407855;
  _DX = 23117;
  while ( *v51 != 9460301 )
    v51 = (_DWORD *)(((unsigned int)v51 - 1) >> 15 << 15);
  v12 = v51;
  v13 = (char *)v51 + v51[15];
  v64 = *((_DWORD *)v13 + 20);
  v11 = &v13[(_DWORD)&loc_4078D1 - 4225105];
  if ( a2 != 1112958602 )
  {
    _EAX = (*(int (__cdecl **)(_DWORD *))((char *)v12 + *(_DWORD *)((char *)v12 + *(_DWORD *)v11 + 16)))(v12);
    _ECX = v63;
    LOWORD(v50) = __ROL2__(v49, v63);
    LOBYTE(_ECX) = __ROR1__(_ECX, _ECX);
    if ( v50 != -43753118 )
      JUMPOUT(0x40780E);
    _EDX = -43753119;
    v42 = 64;
    __asm
    {
      rep cmp eax, 3CB43252h
      rcr     dx, cl
    }
    BYTE1(_ECX) = __ROR1__(BYTE1(v63), v63);
    LOBYTE(_EDX) = (_EDX & 0xA2) - 1;
    LOBYTE(_EDX) = __ROR2__(_EDX - v64, _ECX);
    BYTE1(_EDX) = 30;
    a5 = (_BYTE *)(v64 + 1804);
    LOBYTE(_EDX) = _EDX + 54;
    BYTE1(a2) = (__ROL1__(BYTE1(a2), 26) | 0x78) - 26;
    if ( a4 == -1582299547 )
    {
      MEMORY[0x237762FB](_ECX, _EDX);
      JUMPOUT(0x407849);
    }
    goto LABEL_13;
  }
  LOBYTE(a2) = *(_BYTE *)(a3 - 62) - 118;
  __asm { insb }
  v10 = _DX - 1;
  while ( 1 )
  {
    _DH = ~HIBYTE(v10);
    LOWORD(v11) = (_WORD)v11 - (__CFSHR__(3, 4) + (_WORD)a5);
    _AL = __ROL4__(v11, 30);
    _CL = 0;
    __asm { rcl     dh, cl }
    --a4;
    __asm { rcl     al, 0Eh }
    _EDX = a4 + 845246135;
    _EAX = -843838205;
    LOWORD(_ECX) = a4 + 28343;
    if ( a4 != 2019603352 )
      break;
    __asm { aad     0CBh ; 'Ë' }
    a4 = 2019603351;
    v42 = (int)&v66 + 3;
LABEL_13:
    _EDX += (unsigned int)a5;
    BYTE1(_EAX) = BYTE1(a2) + __CFADD__(BYTE1(_EAX), -67) + BYTE1(_EAX) - 67;
    LOWORD(_EDX) = (unsigned __int16)_EDX >> _ECX;
    __asm
    {
      rcl     eax, 11h
      rcl     ah, 0Bh
      rcl     dh, 3
    }
    v65 = a5;
    if ( a4 == 46057226 )
      JUMPOUT(0x4076AB);
    v55 = a4 >> 14;
    _ECX = 177099847;
    v56 = _EAX & 0x130B9A63;
    v24 = (a2 ^ 0x9A4E1DF2) & 0xFB86FA6B;
    LOBYTE(_EDX) = -39;
    LOBYTE(v24) = v24 & 0x67;
    if ( a5 == (_BYTE *)-1828690408 )
    {
      v57 = v56;
      LOWORD(v28) = v24;
      a2 = v57;
      v28 = (__int16)v28;
      *(_DWORD *)v55 = (__int16)v28;
      a4 = v55 + 4;
    }
    else
    {
      v61 = __CFADD__(a5, -1804);
      v21 = a5 - 1804;
      BYTE1(v56) = v61 + (BYTE1(v56) >> 7) - 39;
      v23 = v56 - 1599961136;
      v22 = _EDX >> 9;
      LOBYTE(_ECX) = 0x80;
      v61 = __CFADD__((_BYTE)v24, 114);
      LOBYTE(v24) = v24 + 114;
      LOBYTE(v23) = v23 - (v61 + BYTE1(v23));
      LOWORD(v24) = _ECX & v24;
      _EDI = 276228256;
      if ( v21 == (_BYTE *)-769314563 )
        JUMPOUT(0x4075C8);
      __asm { rcl     edi, 0Bh }
      v6 = __ROL4__(v24, 128);
      _EDX = v22 << 22;
      LOBYTE(_ECX) = 0;
      __asm { rcr     edx, cl }
      LOBYTE(v6) = (char)v6 >> 3;
      a2 = v6 >> 1;
      SBYTE1(v23) >>= 7;
      LOBYTE(a2) = BYTE1(_EDX) | a2;
      _ECX = _ECX - 520611107;
      __asm { rcr     ecx, 0Bh }
      _EDX = -_EDX ^ 0xEA2FDD75;
      a4 = 2736;
      v54 = -584900814;
      if ( v23 == -1149701144 )
        JUMPOUT(0x4078A1);
      BYTE1(v23) = __ROR1__(BYTE1(v23), 1);
      BYTE1(v54) = 63;
      v26 = __CFADD__((_WORD)v21, (_WORD)v23) + v54 - 837514422;
      LOWORD(_EDX) = (unsigned __int8)__ROR1__(_EDX, 9);
      if ( v21 != (_BYTE *)-553898775 )
        goto LABEL_40;
      a5 = v65;
      __asm { icebp }
      v28 = v42;
      _disable();
      v29 = -(v26 + 1);
      __asm { rcl     edx, 6 }
      BYTE1(a2) = (v29 != 0) + BYTE1(a2) - 59;
      BYTE1(v29) ^= a2;
      v31 = __ROL1__(a2, 13);
      v32 = v29 + ~BYTE1(a2);
      LOBYTE(v29) = BYTE1(v29) ^ v29;
      v33 = v29 + 1364287447;
      if ( v33 == -377569447 )
        JUMPOUT(0x407657);
      LOBYTE(v33) = v33 - (__CFSHL__(~(_BYTE)_EDX, v33) - 44);
      v62 = v33 | 0xCB21C988;
      BYTE1(v62) -= 12;
      _ECX = ~v62;
      BYTE1(v28) = BYTE1(v42) + 1;
      LOWORD(a2) = __PAIR16__(v32, __ROL1__(v31, _ECX)) - 27392;
      LOWORD(_ECX) = (unsigned __int8)_ECX - (_WORD)a2;
      _EDX = _ECX;
    }
    _DX = __ROL2__(_EDX, _ECX);
    _CX = (__int16)-(__int16)_ECX >> -(char)_ECX;
    BYTE1(a2) = BYTE1(v28);
    __asm { rcl     dh, 0Bh }
    LOBYTE(v28) = v28 & 0x89;
    _EAX = v28 >> 30;
    LOBYTE(_EAX) = _EAX - _DX;
    __asm { rcl     al, cl }
    ++BYTE1(_EAX);
    HIBYTE(_DX) ^= BYTE1(a2);
    LOBYTE(_DX) = (char)_DX >> 7;
    v61 = _DX < (unsigned __int16)_EAX;
    LOWORD(_EDX) = _DX - _EAX;
    LOWORD(_ECX) = _CX - (v61 - 25325);
    _EAX = __ROR4__(_EAX << _ECX, 10);
    __asm { rcr     ch, cl }
    *a5 = BYTE1(a2);
    LOBYTE(_EDX) = 112 << _ECX;
    LOWORD(_EAX) = (unsigned __int16)_EAX >> _ECX;
    BYTE1(_ECX) |= 0x88u;
    if ( _EDX == 1598633135 )
    {
      v37 = -90;
      v61 = MEMORY[0xD598F6E5] < v37;
      MEMORY[0xD598F6E5] -= v37;
      LOBYTE(_EAX) = v61;
      break;
    }
    v11 = (char *)((_EDX < 0x5F4934AF) + _EAX - 847418345);
    LOBYTE(v11) = (_BYTE)v11 - 51;
    __asm { rcr     dh, cl }
    ++a5;
    v10 = 4 * _EDX;
    BYTE1(v11) ^= 0x46u;
    if ( a4 == -1788172242 )
    {
      __debugbreak();
      __asm { retf }
    }
  }
  v38 = (_WORD)_ECX << _ECX;
  v39 = __ROL2__(_EAX, v38) + 103;
  v40 = v38 + 38;
  if ( _EDX != 845246135 )
LABEL_40:
    JUMPOUT(0x407799);
  LOBYTE(_EDX) = -73 << v40;
  _CL = v40 | 0x33;
  v45 = _EDX ^ a4;
  LOWORD(v45) = v45 - _EDX;
  _EDX = _EDX >> _CL;
  v46 = __CFSHR__(_EDX, _CL);
  LOWORD(_EDX) = __ROR2__(_EDX, _CL);
  result = BYTE1(_EDX) + v46 + v39 - 8;
  BYTE1(_EDX) = ~(a2 ^ BYTE1(_EDX));
  __asm
  {
    rcl     edx, 0Dh
    rcr     cl, cl
  }
  if ( v45 == -1268468332 )
    JUMPOUT(0x40750A);
  return result;
}
// 4075C7: control flows out of bounds to 4075C8
// 407651: control flows out of bounds to 407657
// 40776A: control flows out of bounds to 40776B
// 407844: control flows out of bounds to 407849
// 407509: control flows out of bounds to 40750A
// 40786C: control flows out of bounds to 40786D
// 4078A0: control flows out of bounds to 4078A1
// 407719: control flows out of bounds to 4076AB
// 4074DB: control flows out of bounds to 730D2904
// 407623: control flows out of bounds to 407799
// 407808: control flows out of bounds to 40780E
// 407536: control flows out of bounds to 407532
// 407844: bad sp value at call
// 40778F: conditional instruction was optimized away because of 'eax.4<30810FFEu'
// 407432: conditional instruction was optimized away because of 'ecx.4 in (A8E5400..A8E5418)'
// 4077F6: variable 'v63' is possibly undefined
// 4077FD: variable 'v49' is possibly undefined
// 407808: variable 'v50' is possibly undefined

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
