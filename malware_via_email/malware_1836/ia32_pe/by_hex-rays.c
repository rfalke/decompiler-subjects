/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall start(int a1@<eax>, char a2@<dh>, int a3@<ecx>, int a4@<ebx>, int a5@<ebp>, int a6@<edi>, int a7@<esi>);
// int __usercall sub_403935@<eax>(int a1@<ebx>);
// LPVOID __stdcall VirtualAlloc(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// HLOCAL __stdcall LocalFree(HLOCAL hMem);
// int __stdcall lstrcmpiW(LPCWSTR lpString1, LPCWSTR lpString2);
// HMODULE __stdcall GetModuleHandleW(LPCWSTR lpModuleName);
// BOOL __stdcall VirtualFree(LPVOID lpAddress, SIZE_T dwSize, DWORD dwFreeType);
// BOOL __stdcall QueryPerformanceCounter(LARGE_INTEGER *lpPerformanceCount);
// DWORD __stdcall FormatMessageW(DWORD dwFlags, LPCVOID lpSource, DWORD dwMessageId, DWORD dwLanguageId, LPWSTR lpBuffer, DWORD nSize, va_list *Arguments);
// BOOL __stdcall FreeLibrary(HMODULE hLibModule);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// BOOL __stdcall GetMessageW(LPMSG lpMsg, HWND hWnd, UINT wMsgFilterMin, UINT wMsgFilterMax);
// HICON __stdcall LoadIconW(HINSTANCE hInstance, LPCWSTR lpIconName);
// BOOL __stdcall DestroyWindow(HWND hWnd);
// int __stdcall ReleaseDC(HWND hWnd, HDC hDC);
// HWND __stdcall GetDlgItem(HWND hDlg, int nIDDlgItem);
// LRESULT __stdcall SendMessageW(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// BOOL __stdcall ShowWindow(HWND hWnd, int nCmdShow);
// LRESULT __stdcall DefWindowProcW(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// BOOL __stdcall UpdateLayeredWindow(HWND hWnd, HDC hdcDst, POINT *pptDst, SIZE *psize, HDC hdcSrc, POINT *pptSrc, COLORREF crKey, BLENDFUNCTION *pblend, DWORD dwFlags);
// int __stdcall LoadStringW(HINSTANCE hInstance, UINT uID, LPWSTR lpBuffer, int cchBufferMax);
// UINT_PTR __stdcall SetTimer(HWND hWnd, UINT_PTR nIDEvent, UINT uElapse, TIMERPROC lpTimerFunc);
// HDC __stdcall GetDC(HWND hWnd);
// int __stdcall GetSystemMetrics(int nIndex);


//----- (00401313) --------------------------------------------------------
void __usercall start(int a1@<eax>, char a2@<dh>, int a3@<ecx>, int a4@<ebx>, int a5@<ebp>, int a6@<edi>, int a7@<esi>)
{
  int v7; // eax
  int v8; // edx
  int v9; // ebx
  int v10; // edx
  int v11; // ecx
  DWORD v12; // ecx
  DWORD v13; // edi
  BOOL v14; // eax
  char v15; // cl
  int v16; // esi
  char v17; // dl
  int v18; // edx
  DWORD v19; // ebx
  int v20; // ecx
  int v21; // edi
  int v22; // esi
  int v23; // edx
  unsigned int v24; // ecx
  unsigned int v25; // esi
  int v26; // ecx
  int v27; // ebx
  int v28; // esi
  HICON v29; // eax
  char v30; // dl
  int v31; // edx
  char v32; // ch
  int v33; // esi
  BOOL v34; // eax
  int v35; // ecx
  DWORD v36; // ebx
  char v37; // dh
  char v38; // ch
  DWORD v39; // ecx
  int v40; // ebx
  int v41; // ecx
  int v42; // esi
  bool v43; // cf
  HICON v44; // eax
  unsigned int v45; // edi
  int v46; // kr10_4
  int v47; // ebx
  int v48; // ebx
  int v49; // ebx
  int v50; // esi
  int v51; // eax
  unsigned int v52; // esi
  UINT v53; // ebx
  __int16 v54; // ecx^2
  char v55; // dh
  int v56; // eax
  char v57; // dl
  char v58; // ch
  int v59; // ecx
  int v60; // ebx
  int v61; // edx
  int v62; // ebx
  int v63; // ett
  int v64; // edi
  unsigned int v65; // eax
  int v66; // ebx
  int v67; // edx
  unsigned int v68; // ecx
  int v69; // ebx
  int v70; // edi
  int v71; // ebx
  int v72; // edi
  WPARAM v73; // ecx
  int v74; // ebx
  int v75; // esi
  unsigned int v76; // ebx
  int v77; // edx
  int v78; // edi
  int v79; // ebx
  char v80; // cl
  int v81; // edi
  int v82; // ecx
  int v83; // esi
  int v84; // eax
  int v85; // edi
  int v86; // edx
  int v87; // esi
  int v88; // edi
  int v89; // esi
  unsigned __int16 v91; // dx
  int v93; // [esp-68h] [ebp-6Ch]
  unsigned __int64 v94; // [esp-60h] [ebp-64h]
  unsigned int v95; // [esp-58h] [ebp-5Ch]
  unsigned int v96; // [esp-54h] [ebp-58h]
  int v97; // [esp-3Ch] [ebp-40h]
  WPARAM v98; // [esp-1Ch] [ebp-20h]
  int v99; // [esp-18h] [ebp-1Ch]
  int v100; // [esp-4h] [ebp-8h]
  const CHAR *v101; // [esp+0h] [ebp-4h]

  v48 = a4 + 1;
  BYTE1(a3) = a3;
  LOBYTE(v48) = (v48 - a2) ^ 0xD0;
  LOBYTE(a3) = 0;
  v49 = v48 - a3;
  v50 = a6 & a7;
  v51 = (v50 | a1) + 1;
  v52 = v50 - a6;
  v77 = v52 | v49 & a3;
  v99 = v77;
  v78 = v52 - ((__PAIR64__(v77, v52) + (v52 | (a3 - v49))) >> 32);
  v79 = v78 + v77;
  v82 = (v52 | v51) - v52 + 1;
  v83 = v78 ^ v52;
  v84 = v77 - 1;
  --v82;
  v85 = (v77 - 1) ^ v78;
  v86 = v77 - 1 - v82;
  ++v84;
  v87 = v84 & ((v79 & v83) - (v86 & (v84 + v85)));
  v88 = v82 & v86 & (v84 + v85);
  v89 = v79 + v87;
  v40 = v79 - v82 - 1 - v84;
  v41 = (v88 | v82) - (v88 & v89);
  v42 = v41 & v88 & v89;
  v97 = v40;
  v43 = __CFADD__(v84 - 1, v41);
  v59 = (v84 - 1 - (v43 + v88)) & (v41 + v43 + v88);
  v60 = v40 + 1 - v42;
  v61 = v60 & (v84 - (v43 + v88));
  v63 = v61 & (v88 | v97);
  v62 = (v88 ^ v60) - v63;
  v64 = v42 | v62 ^ v88;
  v65 = (__PAIR64__(v63, v42) - __PAIR64__((v59 & (unsigned int)v61) + 1, v59 & (unsigned int)v61)) >> 32;
  v23 = v64;
  v96 = v65;
  v95 = v65;
  v24 = (__PAIR64__(v65, v65) - __PAIR64__(v64, v64)) >> 32;
  v94 = __PAIR64__(v24, v64);
  v46 = ((v65 - v64) & v64) + ((v65 - v64) | v65 ^ v62);
  v45 = ((unsigned int)(v23 + v46) - (unsigned __int64)(unsigned int)v23) >> 32;
  v93 = v23 | (v24 + 1);
  v47 = v46 - ((__PAIR64__(v45, v45) + (unsigned int)(v23 + v23 + 1)) >> 32);
  DestroyWindow((HWND)0x8202B161);
  BYTE1(v26) &= 0xCAu;
  v27 = v26 & v47;
  ReleaseDC((HWND)0xFD87E91A, (HDC)0xD90C8248);
  LOBYTE(v27) = v27 + 1;
  v44 = LoadIconW(0, (LPCWSTR)0xAAC);
  SetTimer((HWND)0xF6307F90, 0xA64F586A, (UINT)v44, (TIMERPROC)0xBD8C950B);
  GetModuleHandleW(0);
  v28 = v27;
  v29 = LoadIconW(0, (LPCWSTR)0x5F4);
  LOBYTE(v31) = v30 - (_BYTE)v29;
  BYTE1(v27) = v32;
  v33 = v31 | v28;
  v34 = GetMessageW(0, (HWND)v29, 0xCCCEC7D4, 0xAF000AEA);
  v36 = v35 + v27;
  LoadStringW((HINSTANCE)0xDBDDD7C2, 0xD4D2DDu, 0, v36 & v34);
  GetDlgItem((HWND)0xB06165CC, 195);
  v13 = v12;
  v14 = DestroyWindow((HWND)0xD879C314);
  BYTE1(v36) = -BYTE1(v36) - 2 - v15;
  v16 = v14 & v33;
  VirtualFree((LPVOID)0xF1B2C745, 0xC7C2u, v36);
  LOBYTE(v18) = BYTE1(v36) & v17;
  v19 = v36 - v16;
  FormatMessageW(v18 + v20, (LPCVOID)0x91244A7F, 0xD7D4C2D2, v19, 0, v13, (va_list *)0xCBDBDAD8);
  ReleaseDC((HWND)0xC1976D83, (HDC)0xCB3A94DE);
  LocalFree((HLOCAL)0xC38A83FD);
  BYTE1(v39) = BYTE1(v19) | v37 & v38;
  VirtualAlloc((LPVOID)0xD3D8C9D0, 0xB841CF96, v39, v39);
  GetDC((HWND)0xBA167C23);
  v7 = UpdateLayeredWindow(
         (HWND)0xF1E738F4,
         (HDC)0xC6D7D1C6,
         (POINT *)0xC5,
         (SIZE *)0xCCD6D9,
         (HDC)0xD5C7DA,
         (POINT *)0xD8C1,
         0xD3D1u,
         (BLENDFUNCTION *)0xC3C2CCDC,
         0xC5u);
  if ( v7 )
    LOBYTE(v7) = (*(int (**)(void))(a5 + 8))();
  BYTE1(v8) = v7 - BYTE1(v8);
  LOBYTE(v8) = BYTE1(v8);
  v9 = v8 + 1;
  LocalFree((HLOCAL)0xD1AD31D7);
  v76 = -774515506
      - (v96 ^ (v94 | v95))
      + ((((((v11 ^ v10) + v9) | HIDWORD(v94) | v93) ^ (195 - v96)) - ((HIDWORD(v94) | v93) + 1)) | v96)
      - 1;
  v25 = (((unsigned int)v99 | 0xC800000000i64) - __PAIR64__((v76 | 0xD7CACF) + 206, ((v76 | 0xD7CACF) < v76) + v76)) >> 32;
  v66 = 216;
  v101 = 0;
  do
    --BYTE1(v66);
  while ( LoadLibraryA(v101) );
  v69 = v66 - 1;
  v100 = v67;
  v70 = v69 + (v67 & 0x1BDB389);
  v71 = v70 | v69;
  v72 = v71 ^ v70;
  v73 = (((__PAIR64__(v25 - v68, v25) - (v68 | 0xFF21263C00000000ui64)) >> 32) | 0x1BDB389)
      - (__CFADD__(v72, -14604739)
       + v72
       - 14604739);
  v98 = v73;
  v53 = ((v72 - 14604739) ^ (v71 - 1 + 14604739))
      - ((__PAIR64__(-14604739 - ((v72 - 14604739) ^ (unsigned int)(v71 - 1 + 14604739)), (v72 - 14604739) ^ v73)
        + (((v72 - 14604739) ^ (v71 - 1 + 14604739)) & (unsigned int)(v72 - 14604739))) >> 32);
  DefWindowProcW((HWND)0x9A325241, v53, v73, 13096406);
  HIWORD(v53) |= v54;
  BYTE1(v53) = v55;
  v56 = GetSystemMetrics(-557464384);
  BYTE1(v53) &= v58;
  LOBYTE(v56) = ~(v56 - (v43 + v57));
  v21 = (v56 + v98) & 0xC0C6;
  v22 = v100;
  ReleaseDC((HWND)0xC357FE34, (HDC)0xC6268757);
  LOBYTE(v53) = -v80;
  ShowWindow(0, 56771);
  v81 = v53 ^ v21;
  lstrcmpiW(0, 0);
  v74 = v22 - v81;
  v75 = v22 + 1;
  _EAX = sub_403935(v74);
  __asm { aad     0EFh ; 'ï' }
  LOBYTE(_EAX) = *(_BYTE *)(v75 + 8 * _EAX - 94) + _EAX;
  if ( !__SETP__(v81 + 2, 0) )
    _EAX += 471637365;
  __outdword(v91, _EAX);
  JUMPOUT(0x4015D2);
}
// 4015D1: control flows out of bounds to 4015D2
// 401136: variable 'v26' is possibly undefined
// 401178: variable 'v30' is possibly undefined
// 40117A: variable 'v32' is possibly undefined
// 40117C: variable 'v31' is possibly undefined
// 401194: variable 'v35' is possibly undefined
// 401058: variable 'v12' is possibly undefined
// 40106B: variable 'v15' is possibly undefined
// 401082: variable 'v17' is possibly undefined
// 401086: variable 'v18' is possibly undefined
// 401086: variable 'v20' is possibly undefined
// 40123F: variable 'v37' is possibly undefined
// 40123F: variable 'v38' is possibly undefined
// 401395: variable 'v39' is possibly undefined
// 40144A: variable 'v101' is possibly undefined
// 401462: variable 'v67' is possibly undefined
// 401463: variable 'v68' is possibly undefined
// 401369: variable 'v54' is possibly undefined
// 401371: variable 'v55' is possibly undefined
// 401385: variable 'v58' is possibly undefined
// 401383: variable 'v43' is possibly undefined
// 401383: variable 'v57' is possibly undefined
// 401544: variable 'v80' is possibly undefined
// 401022: variable 'v8' is possibly undefined
// 401034: variable 'v11' is possibly undefined
// 401034: variable 'v10' is possibly undefined
// 4015D0: variable 'v91' is possibly undefined

//----- (00403935) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_403935@<eax>(int a1@<ebx>)
{
  LPARAM v1; // ecx
  _BYTE *v2; // esi
  unsigned int v3; // ebx
  _BYTE *v4; // edi
  int v5; // ecx
  int v6; // eax
  int result; // eax
  int v8; // ebx
  _BYTE *v9; // [esp+4h] [ebp-4h]

  LOBYTE(a1) = a1 & 0xD2;
  BYTE1(a1) += 59;
  v8 = a1 ^ 0xFFFFF9FD;
  FreeLibrary((HMODULE)0xE8104CC4);
  LOBYTE(v8) = v8 | 0xD6;
  v3 = (unsigned int)GetDlgItem((HWND)0x9F29A5C5, v8) & v8;
  BYTE1(v3) -= 16;
  v1 += 641148734;
  LOBYTE(v1) = v1 - BYTE1(v1);
  SendMessageW((HWND)0xAB10AA38, 0xD3D6DAC4, v3, v1);
  QueryPerformanceCounter((LARGE_INTEGER *)0xC3961A83);
  v2 = v9;
  v4 = VirtualAlloc(0, 0x1A214u, 0x3000u, 0x40u);
  HIWORD(v3) = 0;
  v5 = 6132;
  do
  {
    BYTE1(v3) = -55;
    LOBYTE(v3) = __ROL1__(-(char)(*v2 + 79) ^ 0x6A, 1);
    *v4 = v3;
    ++v2;
    ++v4;
    --v5;
  }
  while ( v5 );
  v6 = v3 & 0x2403EB7A;
  LOBYTE(v6) = v3 & 0x7A | 0xC9;
  result = (v3
          - (__CFADD__(((__PAIR64__((unsigned int)v4, v5) - 0xDBD8DBFC1486i64 + 0x100000000i64) >> 32) & 0xC3, -49)
           - 590036542)) & v6;
  BYTE1(result) += 48;
  return result;
}
// 402F12: positive sp value 4 has been found
// 402E1A: variable 'v1' is possibly undefined
// 402F11: variable 'v9' is possibly undefined

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
