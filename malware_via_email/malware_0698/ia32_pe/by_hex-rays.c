/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int a1, int a2, int a3);
// int __usercall sub_4010DA@<eax>(int result@<eax>);
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// void __usercall sub_404050(int a1@<eax>, int a2@<ecx>, int a3@<ebx>, __int16 a4@<di>, int a5@<esi>);
// void __usercall sub_4040E4(bool a1@<cf>, char a2@<zf>, char a3@<sf>, char a4@<of>, int a5@<eax>, int a6@<edx>, __int16 a7@<cx>, int a8@<esi>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_4041F8; // weak


//----- (00401085) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  sub_4010DA(0x10000);
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 3;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (004010DA) --------------------------------------------------------
int __usercall sub_4010DA@<eax>(int result@<eax>)
{
  int v1; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v1);
  MEMORY[0] &= result;
  return result;
}

//----- (00404050) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_404050(int a1@<eax>, int a2@<ecx>, int a3@<ebx>, __int16 a4@<di>, int a5@<esi>)
{
  __int16 v6; // cx
  int v8; // edx
  char v10; // bl
  char v12; // bl
  bool v14; // cf
  bool v15; // zf
  bool v16; // sf
  char v17; // of
  bool v18; // cc
  int v19; // edi
  int v20; // esi
  bool v23; // cf
  char v24; // zf
  char v25; // sf
  char v26; // of
  char v27; // pf
  int v29; // edx
  int v30; // ecx
  int v32; // [esp-4h] [ebp-4h]
  char savedregs; // [esp+0h] [ebp+0h]
  int savedregsa; // [esp+0h] [ebp+0h]

  _ESI = -a5;
  v6 = a2 + a4;
  v8 = a2;
  _EDI = a3;
  v10 = savedregs;
  if ( (_EDI & v32) != 0 )
  {
    __asm
    {
      rcr     esi, 0BFh
      rcr     esi, 0E3h
    }
    v10 = v6;
    v8 = 767517863;
    if ( _EDI )
      a1 = 767517863;
    if ( !_EDI )
      a1 = 767517863;
  }
  v12 = _ESI + v10;
  __asm { rcl     edi, 9Bh }
  v14 = BYTE1(v8) < HIBYTE(v6);
  if ( !__OFSUB__(BYTE1(v8), HIBYTE(v6)) )
  {
    _EDI = 721251132;
    a1 = ~a1;
  }
  v17 = __OFSUB__(_EDI, 1);
  v15 = _EDI == 1;
  v16 = _EDI - 1 < 0;
  v18 = _EDI <= 1;
  v19 = _EDI - 1;
  if ( !v18 )
  {
    if ( !v18 )
      JUMPOUT(0x4040B1);
    v20 = v19;
    __asm { rep lea ecx, ds:14FF9BCAh }
    savedregsa = 2096039149;
    __asm { repne pop edi }
    v17 = __OFSUB__(v20, 1);
    _ESI = v20 - 1;
    v15 = _ESI == 0;
    v16 = _ESI < 0;
  }
  sub_4040E4(v14, v15, v16, v17, a1, v8, v8, _ESI);
  if ( v25 ^ v26 | v24 )
    JUMPOUT(0x4040DD);
  if ( !v27 )
    _EAX = v30;
  __asm { repne not eax }
  sub_4040E4(v23, v24, v25, v26, _EAX, v29, v12, _ESI);
}
// 404071: positive sp value 4 has been found
// 4040A8: control flows out of bounds to 4040B1
// 4040D2: control flows out of bounds to 4040DD
// 404070: variable 'savedregs' is possibly undefined
// 404072: variable 'v32' is possibly undefined
// 4040D2: variable 'v25' is possibly undefined
// 4040D2: variable 'v26' is possibly undefined
// 4040D2: variable 'v24' is possibly undefined
// 4040D9: variable 'v27' is possibly undefined
// 4040D9: variable 'v30' is possibly undefined
// 4040E3: variable 'v23' is possibly undefined
// 4040E3: variable 'v29' is possibly undefined

//----- (004040E4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4040E4(bool a1@<cf>, char a2@<zf>, char a3@<sf>, char a4@<of>, int a5@<eax>, int a6@<edx>, __int16 a7@<cx>, int a8@<esi>)
{
  int v8; // ebx
  int v9; // edi
  int v10; // eax
  __int16 v11; // cx
  int v12; // esi
  bool v14; // of
  int v16; // ecx
  int v18; // [esp-4h] [ebp-4h] BYREF
  int savedregs; // [esp+0h] [ebp+0h] BYREF
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  v8 = a8;
  v9 = a5;
  if ( !a1 )
  {
    __asm { fsubr   st(1), st }
    a6 = 2022728316;
    if ( !(a3 ^ a4 | a2) )
    {
      a7 = a8;
      ++a5;
    }
    v9 = -1694477966;
    v8 = -1694477966;
  }
  v10 = a5 + 1;
  __asm { fmul    st(5), st }
  v11 = a7 + 1;
  v12 = v18;
  _EBX = __ROR4__(v8, 196);
  v14 = __OFSUB__(BYTE1(a6), HIBYTE(v11));
  if ( SBYTE1(a6) >= SHIBYTE(v11) )
  {
    v10 = 1738368776;
    __asm { rcl     ebx, 8Ch }
    a1 = __CFSHL__(v18 << 15, -101);
    v18 = 103;
    if ( a1 )
      a6 = (int)&v18;
    __asm { rcl     ebx, 0E8h }
    v14 = __OFADD__(1, v18);
    v12 = v18 + 1;
  }
  if ( !v14 )
  {
    a6 = _EBX;
    __asm
    {
      fcom    st(3)
      fcomp   st(7)
    }
  }
  v16 = a6;
  __asm { repne pop edx }
  ((void (__cdecl *)(int, int, int, int, int, void **, int *, int, int))loc_4041F8)(
    _EDX,
    v10,
    _EDX,
    v16,
    _EBX,
    &retaddr,
    &savedregs,
    v9,
    v12);
  if ( !(a3 ^ a4 | a2) )
    __asm { fcom    st(7) }
  __asm
  {
    fcom    st
    fcom    st(2)
  }
  JUMPOUT(0x4041F8);
}
// 404163: positive sp value 8 has been found
// 4040F1: inconsistent fpu stack
// 4041F6: control flows out of bounds to 4041F8
// 4041C9: variable 'a3' is possibly undefined
// 4041C9: variable 'a4' is possibly undefined
// 4041C9: variable 'a2' is possibly undefined

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
