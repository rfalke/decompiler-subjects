/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int, int, int);
// int __usercall sub_4010C8@<eax>(int result@<eax>);
// int __usercall sub_4040B6@<eax>(char@<cf>, int@<eax>, void **@<ebx>);
// int __usercall sub_4040C0@<eax>(int@<eax>, char@<bl>, int@<esi>);
int sub_4041F8();
int sub_404209(void); // weak

//-------------------------------------------------------------------------
// Data declarations

// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);


//----- (00401073) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  sub_4010C8(0x10000);
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 3;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (004010C8) --------------------------------------------------------
int __usercall sub_4010C8@<eax>(int result@<eax>)
{
  int v1; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v1);
  MEMORY[0] &= result;
  return result;
}

//----- (004040B6) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4040B6@<eax>(char a1@<cf>, int a2@<eax>, void **a3@<ebx>)
{
  int savedregs; // [esp+0h] [ebp+0h]
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  if ( !a1 )
    a3 = &retaddr;
  return sub_4040C0(a2, (char)a3, savedregs);
}
// 4040BB: positive sp value 4 has been found
// 4040B6: could not find valid save-restore pair for esi
// 4040BF: variable 'savedregs' is possibly undefined

//----- (004040C0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4040C0@<eax>(int a1@<eax>, char a2@<bl>, int a3@<esi>)
{
  char v3; // bl
  char v4; // dl
  bool v5; // of
  int v6; // esi
  unsigned int v9; // ebx
  char v12; // sf
  int v14; // [esp-8h] [ebp-8h]
  signed int savedregs; // [esp+0h] [ebp+0h]

  v3 = a2 + 1;
  __asm
  {
    fcom    st
    rep cld
    fmul    st(1), st
  }
  v4 = 40;
  if ( __OFADD__(1934748239, v14) )
    a3 = a1;
  v5 = __OFADD__(1, a3);
  v6 = a3 + 1;
  if ( v6 )
  {
    __asm { fcomp   st(4) }
    if ( !((v6 < 0) ^ v5 | (v6 == 0)) )
      a1 = ~a1;
    _EDI = -618151023;
    __asm { fcomp   st }
    v3 = -63;
    __asm { rcl     edi, 23h }
  }
  _ESI = -v6;
  if ( __SETP__(_ESI, 0) )
  {
    v4 = -86;
    if ( _ESI >= 1 )
      v4 = v3;
  }
  _BitScanForward(&v9, _ESI);
  savedregs = _ESI;
  _EBX = v9 ^ (1 << v4) ^ (1 << ((a1 >> 23) - 1));
  __asm
  {
    rcl     esi, 0A8h
    fmul    st(3), st
    rcl     ebx, 88h
    fsubr   st, st
    fsub    st(3), st
  }
  sub_4041F8();
  if ( v12 != v5 )
    __asm { fadd    st, st }
  return sub_4041F8();
}
// 404140: positive sp value C has been found
// 4040CB: inconsistent fpu stack
// 4040E4: variable 'v14' is possibly undefined
// 4041B0: variable 'v12' is possibly undefined
// 4041B0: variable 'v5' is possibly undefined

//----- (004041F8) --------------------------------------------------------
int sub_4041F8()
{
  sub_404209();
  return sub_404209();
}
// 404209: using guessed type int sub_404209(void);

//----- (00404209) --------------------------------------------------------
#error "404209: stack frame is too big (funcsize=0)"

// nfuncs=6 queued=6 decompiled=6 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 6 function(s)"
