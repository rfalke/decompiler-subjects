/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

unsigned int __stdcall sub_401006(_DWORD *, unsigned int, int);
void start();

//-------------------------------------------------------------------------
// Data declarations

// extern DWORD (__stdcall *GetTickCount)();
// extern DWORD (__stdcall *GetCurrentProcessId)();
// extern HANDLE (__stdcall *CreateFileA)(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// extern BOOL (__stdcall *CloseHandle)(HANDLE hObject);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);
// extern LPSTR (__stdcall *GetCommandLineA)();
// extern DWORD (__stdcall *GetCurrentThreadId)();
// extern DWORD (__stdcall *GetFileType)(HANDLE hFile);


//----- (00401006) --------------------------------------------------------
unsigned int __stdcall sub_401006(_DWORD *a1, unsigned int a2, int a3)
{
  unsigned int result; // eax

  result = a2 >> 2;
  do
  {
    *a1 -= a3;
    *a1 = __ROL4__(*a1, 106);
    *a1 = __ROL4__(*a1, 227);
    *a1 -= a3;
    *a1 -= a3;
    *a1 = -*a1;
    *a1 ^= a3;
    *a1++ += 1958684687;
    --result;
  }
  while ( result );
  return result;
}

//----- (0040104E) --------------------------------------------------------
void start()
{
  int v0; // [esp+Ch] [ebp-18h]
  FARPROC hFile; // [esp+18h] [ebp-Ch]
  HMODULE hModule; // [esp+20h] [ebp-4h]

  GetCurrentThreadId();
  GetCurrentThreadId();
  hModule = GetModuleHandleA("NTDLL.DLL");
  GetTickCount();
  GetCommandLineA();
  if ( CreateFileA("Jq.KIW", 0xA0000000, 2u, 0, 3u, 0x20u, 0) == (HANDLE)-1 )
  {
    GetCurrentProcessId();
    CloseHandle((HANDLE)0xFFFFFFFF);
    hFile = GetProcAddress(hModule, "ZwQueryIntervalProfile");
    GetFileType(hFile);
    GetCurrentThreadId();
    v0 = ((int (__stdcall *)(_DWORD))hFile)(0);
  }
  CreateFileA("B05dyP4CgMhmWd.fhA", 0x80000000, 4u, 0, 3u, 2u, 0);
  __asm { jmp     eax }
}
// 40113D: unbalanced stack, ignored a potential tail call
// 401131: variable 'v0' is possibly undefined

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
