/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall sub_4078B0(int@<eax>, __int32 _EDX@<edx>, int _ECX@<ecx>, int _EBX@<ebx>, char *@<ebp>, int@<edi>, int@<esi>, double@<st1>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_4077B1; // weak
_UNKNOWN loc_40782C; // weak


//----- (0040663B) --------------------------------------------------------
#error "40663B: function frame is wrong (funcsize=0)"

//----- (004078B0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4078B0(
        int a1@<eax>,
        __int32 _EDX@<edx>,
        int _ECX@<ecx>,
        int _EBX@<ebx>,
        char *a5@<ebp>,
        int a6@<edi>,
        int a7@<esi>,
        double a8@<st1>)
{
  int v8; // esi
  __int32 v13; // ebx
  unsigned int v15; // edi
  int v25; // esi
  int v27; // edx
  int v29; // ecx
  int v30; // esi
  bool v31; // tt
  __int16 v34; // cx
  int v35; // esi
  bool v36; // cf
  __int16 v43; // ax
  unsigned int v45; // esi
  char *v47; // et1
  int v48; // esi
  int v49; // ebx
  unsigned __int32 v50; // edi
  _DWORD *i; // eax
  char *v57; // eax
  _BYTE *v60; // esi
  int v62; // edi
  int v63; // esi
  _DWORD *v64; // esi
  unsigned int v65; // edi
  unsigned int v66; // edi
  __int16 v67; // cx
  int v69; // esi
  bool v74; // tt
  _DWORD *v76; // [esp-20h] [ebp-20h] BYREF
  _DWORD v77[2]; // [esp-1Ch] [ebp-1Ch] BYREF
  int v78; // [esp-14h] [ebp-14h]
  int v79; // [esp-10h] [ebp-10h]
  unsigned int *v80; // [esp-Ch] [ebp-Ch]
  unsigned int v81; // [esp-8h] [ebp-8h] BYREF

  LOBYTE(_EDX) = _EDX + 100;
  v30 = a6 + a7;
  LOBYTE(a1) = (char)(a1 + 1) >> 7;
  v31 = __CFSHL__(a6, _ECX);
  LOWORD(a6) = __ROL2__(a6, _ECX);
  BYTE1(a1) += v31 + 66;
  LOWORD(_EBX) = (unsigned __int8)((_BYTE)_EBX << _ECX);
  if ( _EDX != -286730786 )
  {
    v69 = __ROR4__(v30, 3);
    __asm
    {
      rcl     ecx, 14h
      rcl     bh, 12h
    }
    goto LABEL_39;
  }
  v76 = v77;
  a5 = (char *)v77;
  --BYTE1(_ECX);
  BYTE1(_EDX) = __CFSHL__(_ECX, 18);
  LOBYTE(_ECX) = 0;
  _ECX = _ECX + 154610288;
  v13 = _EDX;
  LOWORD(_ECX) = a1 ^ (_ECX + 1);
  LOBYTE(_ECX) = _ECX | 0x71;
  v15 = (((a6 - 1) | 0x187850C7) + 1) << 17;
  _EAX = (char *)(a1 - 2832);
  LOBYTE(_ECX) = (unsigned __int8)_ECX >> _ECX;
  _EDX |= _ECX;
  BYTE1(_EDX) = (char)(((_BYTE)_EAX + BYTE1(_EDX)) ^ 0xB1) >> 1;
  v64 = (_DWORD *)(v30 + 1);
  __asm { rcr     dh, cl }
  v36 = __CFSHR__(v15, 13);
  v65 = v15 >> 13;
  BYTE1(_EDX) -= v36 + 117;
  if ( _EAX == (char *)-771093549 )
    JUMPOUT(0x407CA3);
  v66 = __ROL4__(v65, 1);
  LOWORD(v13) = (unsigned __int8)((unsigned __int8)v13 >> _ECX);
  _EBX = v13 + 1;
  v67 = -(__int16)_ECX;
  LOBYTE(_EBX) = _EBX - 10;
  if ( v66 == 998505565 )
  {
    if ( !(_WORD)_EDX )
    {
      *v64 = __ROL4__(*v64, v67);
      JUMPOUT(0x407BAC);
    }
    JUMPOUT(0x407CB6);
  }
  BYTE1(_EBX) = BYTE1(_EDX);
  _CH = HIBYTE(v67) - ((v66 < 0x3B83FC5D) + 30);
  __asm { rcr     ch, 1Ch }
  _ECX = 1268482903;
  __asm { rcr     bx, cl }
  _EDI = (((_DWORD)v64 << 6) | ~v66) ^ 0x122F17F7;
  __asm { rcl     edi, cl }
  _EDI = (_DWORD *)(_EDI << 10);
  _EBX = __CFSHL__(BYTE1(_EDX), 14) + _EBX - 924412036;
  HIWORD(_EDX) ^= 0xEA0Du;
  LOBYTE(_EBX) = 0;
LABEL_20:
  BYTE1(_EBX) = 56;
  _ECX = _ECX ^ 0x4B9B8F5C;
  _ESI = (_BYTE *)_ECX;
  LOBYTE(_EBX) = BYTE1(_ECX) ^ BYTE1(_ECX) & _EBX | 0x13;
  LOWORD(_EDX) = (_WORD)_EAX;
  if ( _EAX == (char *)1560667453 )
  {
    *_EDI += _ECX;
    __asm { rcl     ah, 1 }
LABEL_22:
    __asm { rcl     bl, 0Fh }
    LOBYTE(_EBX) = (unsigned __int8)_EAX & _EBX;
    v36 = (unsigned __int8)_EBX < (unsigned __int8)(__CFSHL__(_EDI, 11) - 68);
    LOBYTE(_EBX) = _EBX - (__CFSHL__(_EDI, 11) - 68);
    LOWORD(_EBX) = _EBX - (v36 + (_WORD)_EAX);
    BYTE1(_EDX) = _EDX;
    _BL = __ROL4__(_EBX, 19);
    __asm { rcr     bl, 0Bh }
    if ( _EAX == (char *)-218952480 )
    {
      __asm { iret }
      JUMPOUT(0x407B62);
    }
    _ESI = _ECX ^ 0x256A650C;
    __asm { rcl     esi, cl }
    *_EAX = _EDX;
    v60 = (_BYTE *)((_ESI << 23) - 1);
    if ( _EDX != 177490588 )
      JUMPOUT(0x407A20);
    MEMORY[0xF996A324] = *v60;
    _EAX = (char *)MEMORY[0x81515F70]((unsigned __int16)__CS__);
    *((_DWORD *)a5 + 116159634) = (int)a8;
    _enable();
    v8 = (int)(v60 + 1) >> 30;
    _EDI = __ROL4__(-107568347, _ECX);
    goto LABEL_29;
  }
  while ( 1 )
  {
    BYTE1(_EBX) ^= 0xCFu;
    BYTE1(_EDX) >>= _ECX;
    _EBX = __ROL4__(_EBX, _ECX);
    BYTE1(_EBX) = __ROR1__(BYTE1(_EBX), 5);
    __asm { rcr     bh, cl }
    LOWORD(_EDI) = (_WORD)_EDI << _ECX;
    if ( _EDX != 1389066426 )
      JUMPOUT(0x407B60);
    v76 = (_DWORD *)(unsigned __int16)__ES__;
    _ECX = 249266218;
    _DI = (_WORD)_EDI - (_WORD)_EAX;
    __asm { rcr     di, cl }
    BYTE1(_EBX) = _EBX ^ __ROR1__(BYTE1(_EBX), 42);
    if ( _EDI == (_DWORD *)-707423882 )
    {
      v36 = _ESI[91] < 0x80u;
      _ESI[91] += 0x80;
      v43 = v36 + (_WORD)_EAX - 6196;
      LOBYTE(_EBX) = v43;
      BYTE1(_EBX) = __ROR1__(BYTE1(_EBX), 25);
      _BH = HIBYTE(v43) + ((unsigned __int16)__ROL4__(_EBX, 12) >> 8);
      __asm { rcl     bh, cl }
      _BL = 0;
      _BH = 0;
      __asm
      {
        rcr     bl, 7
        rcl     bh, 14h
      }
      JUMPOUT(0x407A55);
    }
    __asm { rcr     esi, 1Ch }
    LOWORD(_EBX) = -32726;
    LOBYTE(_EDX) = -31;
    _EBX = _EBX << 25;
    __asm { rcl     bh, cl }
    v45 = _ESI >> 10;
    if ( _EDI != (_DWORD *)-1158215488 )
      goto LABEL_22;
    LOBYTE(_EBX) = 80;
    MEMORY[0x65D1140] += &v76;
    v47 = _EAX;
    _EAX = a5;
    a5 = v47;
    LOBYTE(_EDX) = *(_BYTE *)(v45 + 50) & 0xE1;
    v48 = v45 | 0xEDB802A;
    v49 = __ROR4__(_EBX, 18);
    LOBYTE(v49) = 0;
    v50 = _EDX & 0xBB283B0D;
    _EBX = v49 + 622698807;
    LOBYTE(_EBX) = 0;
    if ( (_EDX & 0xBB283B0D) != 599827687 )
      JUMPOUT(0x407C86);
    __asm { arpl    [ecx+ecx*4], cx }
    LOBYTE(_EAX) = MEMORY[0x8030B1A6];
    if ( (_EDX & 0xBB283B0D) != 599827687 )
      JUMPOUT(0x407A5C);
    v36 = __CFSHR__(_EBX, 42);
    LOWORD(_EBX) = (unsigned __int16)_EBX >> 10;
    LOBYTE(_EBX) = (BYTE1(_EBX) + v36 + _EBX) | 6;
    __asm { rcl     bl, 19h }
    v25 = -1024 * v48;
    _EBX = _EBX - ((v25 != 0) + 249266218);
    LOBYTE(_EDX) = __ROR1__(_EDX, 1);
    BYTE1(_EBX) = 0;
    _EDI = __ROL4__(v50, 23);
    if ( _EDI == 1173165228 )
    {
      __asm { iret }
      JUMPOUT(0x407818);
    }
    LOBYTE(_EBX) = 82;
    LOWORD(_EBX) = (__int16)_EBX >> 10;
    BYTE1(_EBX) = -BYTE1(_EBX);
    v8 = v25 - ((BYTE1(_EBX) != 0) - 1557731531);
    BYTE1(_EBX) += 7;
    if ( _EAX != (char *)113351170 )
    {
      SBYTE1(_EBX) >>= 7;
      LOWORD(_EBX) = _EBX - v8;
      __asm
      {
        rcr     bl, cl
        rcl     ebx, 16h
      }
      JUMPOUT(0x40796D);
    }
    __asm
    {
      rcl     byte ptr [edi+4Bh], cl
      insb
    }
LABEL_29:
    v62 = _EDI >> 29;
    LOWORD(v8) = __ROR2__(v8, _ECX);
    v63 = v62 ^ v8;
    LOWORD(v63) = v63 - _ECX - _EDX;
    _ESI = (v63 | 0x69FD508B) + 1971398401;
    __asm { rcr     esi, 0Bh }
    _ESI = -_ESI;
    _EDI = (v62 ^ 0x63CE86D0) - 1316115455;
    _EBX = _ECX + 99783856;
    __asm
    {
      rcr     edi, 1Ch
      rcl     si, cl
    }
    v69 = _ESI << 13;
    if ( _ECX )
      JUMPOUT(0x40798B);
    _ECX = 0;
    if ( v69 != 439723019 )
      break;
    LOWORD(_EDX) = _InterlockedExchange((volatile __int32 *)0xFFFFFFB7, _EDX);
LABEL_39:
    LOBYTE(_EBX) = _EBX - BYTE1(_EBX);
    v81 = _ECX;
    v80 = &v81;
    v79 = 64;
    v78 = 4224945;
    for ( i = (_DWORD *)&loc_4077B1; *i != 9460301; i = (_DWORD *)(((unsigned int)i - 1) & 0xFFFFF000) )
      ;
    _ECX = (int)i;
    v57 = (char *)i + i[15];
    v78 = *((_DWORD *)v57 + 20);
    if ( v69 == -82549927 )
    {
      _EDI = (_DWORD *)v78;
      __SS__ = v79;
      _EAX = v57 - 1;
      __asm { insb }
      HIWORD(_EDX) = HIWORD(v80);
      goto LABEL_20;
    }
    (*(void (__cdecl **)(int))(_ECX + *(_DWORD *)(_ECX + *(_DWORD *)&v57[(_DWORD)&loc_40782C - 4224940] + 16)))(_ECX);
    _ECX = v36 + v77[1] - 527127475;
    LOBYTE(_ECX) = 0;
    BYTE1(_EBX) = __ROL1__(0, 13);
    __asm { rcl     ecx, cl }
    LOBYTE(_EBX) = 0;
    LOBYTE(_ECX) = (_ECX + 125) ^ 8;
    v29 = _ECX >> 25;
    LOBYTE(v29) = 0;
    _ECX = ~v29;
    BYTE1(_ECX) |= BYTE1(_EBX);
    v35 = _ECX;
    v36 = __CFADD__(_ECX, _EBX);
    _EBX += _ECX;
    LOBYTE(_ECX) = _ECX - (v36 + v27);
    _EDI = (_DWORD *)(v35 ^ 0x3C);
    _EDX = v27 - 1284079254;
    LOWORD(_EDX) = v35 | _EDX;
    if ( v78 != 593424645 )
      JUMPOUT(0x40769C);
    __asm { aam     0B5h ; 'µ' }
    LOBYTE(_EAX) = *(_BYTE *)v35;
    _ESI = (_BYTE *)(v35 + 1);
  }
  LOWORD(_ECX) = _EDX;
  BYTE1(_EDX) &= 0xCFu;
  BYTE1(_EAX) = 0;
  _EDI = __ROL4__(_EDI, 2);
  _BH = -43;
  LOBYTE(_ECX) = (unsigned __int8)_ECX >> _ECX;
  __asm { rcl     bh, 3 }
  if ( _EAX == (char *)-622909294 )
    JUMPOUT(0x4077EC);
  LOBYTE(_ECX) = ((char)_ECX >> 7) | 0x6B;
  BYTE1(_EAX) = _ECX;
  __asm { rcr     eax, 18h }
  v74 = __CFSHR__(_ECX, 14);
  LOBYTE(_ECX) = __ROR1__(_ECX, 14);
  _BL = -80 - BYTE1(_ECX) - (v74 + 32);
  __asm
  {
    rcl     edi, 0Dh
    rcr     cl, cl
  }
  HIBYTE(v34) = BYTE1(_ECX) - ((_ECX < 0x8ED29E9) + _BL);
  LOBYTE(v34) = __ROL1__(_CL, _CL);
  if ( _EDX == 279822986 )
    JUMPOUT(0x407922);
  _CL = __ROR2__(v34, v34);
  __asm { rcr     bl, cl }
}
// 407A78: positive sp value 1C has been found
// 407921: control flows out of bounds to 407922
// 4077E6: control flows out of bounds to 4077EC
// 407B61: control flows out of bounds to 407B62
// 407817: control flows out of bounds to 407818
// 4079D0: control flows out of bounds to 407C86
// 407B77: control flows out of bounds to 40798B
// 407C59: control flows out of bounds to 407CA3
// 407C96: control flows out of bounds to 407BAC
// 407642: control flows out of bounds to 40796D
// 40783A: control flows out of bounds to 407A55
// 407942: control flows out of bounds to 40769C
// 407963: control flows out of bounds to 407B60
// 407A56: control flows out of bounds to 407A5C
// 407BA2: control flows out of bounds to 407A20
// 407C80: control flows out of bounds to 407CB6
// 407919: variable '_EDX' is possibly undefined
// 40792C: variable 'v27' is possibly undefined
// 40761B: variable '_ECX' is possibly undefined
// 407707: variable 'v36' is possibly undefined

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 2 function(s)"
