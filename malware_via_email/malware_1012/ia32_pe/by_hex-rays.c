/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// __int16 __usercall start@<ax>(bool a1@<cf>, unsigned int _EAX@<eax>, int a3@<edx>, int _ECX@<ecx>, int _EBX@<ebx>, char *a6@<ebp>, int a7@<esi>, double a8@<st1>, char a9@<efl>);
// void __usercall sub_4078B0(int a1@<eax>, __int32 _EDX@<edx>, int _ECX@<ecx>, int _EBX@<ebx>, char *a5@<ebp>, int a6@<edi>, int a7@<esi>, double a8@<st1>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_4077B1; // weak
_UNKNOWN loc_40782C; // weak


//----- (0040663B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
__int16 __usercall start@<ax>(bool a1@<cf>, unsigned int _EAX@<eax>, int a3@<edx>, int _ECX@<ecx>, int _EBX@<ebx>, char *a6@<ebp>, int a7@<esi>, double a8@<st1>, char a9@<efl>)
{
  int v12; // eax
  int v15; // esi
  int v16; // edi
  int v20; // edi
  char v21; // dl
  int v22; // ebx
  __int16 v23; // cx
  int v27; // esi
  __int16 v29; // cx
  int v32; // esi
  int v35; // ebx
  __int16 v36; // dx
  int v39; // ecx
  bool v42; // tt
  int v43; // edi
  int v51; // edi
  int v53; // ecx
  int v54; // esi
  int v55; // edi
  int v56; // ebx
  bool v62; // cf
  int v67; // edx
  int v70; // ecx
  int v73; // eax
  unsigned int v75; // ecx
  unsigned int v77; // esi
  int v79; // eax
  unsigned int v81; // esi
  int v82; // eax
  bool v83; // cf
  __int16 v89; // dx
  int v91; // eax
  __int16 v92; // dx
  unsigned int v93; // edx
  char v96; // dh
  unsigned __int8 v98; // dl
  int v100; // esi
  int v101; // esi
  int v102; // ebx
  int v108; // edi
  _BYTE v111[2]; // [esp-2h] [ebp-2h]

  BYTE1(_ECX) = ~BYTE1(_ECX);
  __asm { rcr     ecx, cl }
  LOBYTE(_EAX) = BYTE1(_ECX) + a1 + _EAX;
  HIWORD(_EDI) = 26609;
  __asm { rcr     bl, cl }
  ++BYTE1(_ECX);
  __asm { rcl     ch, 1Eh }
  LOBYTE(_EBX) = _BL - 1;
  v67 = (a3 + 1) >> 17;
  LOWORD(_EDI) = 0xA555u >> _ECX;
  LOWORD(a7) = _EBX | a7;
  __asm { rcl     ebx, cl }
  _EDX = v67 >> _ECX << _ECX;
  if ( _EBX == -730080453 )
  {
    __outbyte(_EDX, _EAX);
    _BH = 102;
    _ESI = a7 + 1;
    __asm { rcr     si, cl }
    _ECX = (unsigned int)_ECX >> 25;
    v108 = __ROL4__(_EDI >> 11, _ECX);
    __asm { rcl     bh, cl }
    a1 = __CFSHL__(_ECX, 8);
    v75 = _ECX << 8;
    __asm { rcl     bh, 0Eh }
    BYTE1(_EBX) = v75 + a1 + _BH;
    v77 = (_ESI - 1) & 0xEB79D8B3;
    _EDI = v108 - 1551990463;
    if ( _EAX == 1715943256 )
    {
      __asm { fist    word ptr [eax-7Bh] }
      BYTE1(v75) = -109;
      v79 = _EAX << v75;
      LOBYTE(v75) = v75 ^ 0x7F;
      _EBX = _EBX - 858156880;
      v81 = (v77 - 1) & 0xD1411394;
      v82 = v81 | v79;
      v83 = __CFSHL__(v75, 28);
      _ECX = v75 << 28;
      BYTE1(_EBX) -= 60;
      __asm { rcl     ecx, 12h }
      LOBYTE(_EBX) = (v82 + v83 + _EBX) & 0x9E;
      __asm { rcr     bx, cl }
      v100 = v82 & v81;
      _AX = __CFSHL__(v82, 19) - 19539;
      if ( _EDI == 925332175 )
        JUMPOUT(0x4064D6);
      BYTE1(_ECX) = 0;
      __asm
      {
        rcl     bl, 1
        rcr     ah, cl
      }
      LOWORD(v100) = -(__int16)v100;
      BYTE1(_EBX) &= _ECX;
      LOBYTE(_EBX) = _EDX ^ ((char)_EBX >> _ECX);
      __asm
      {
        rcl     edi, 14h
        rcr     ecx, cl
      }
      v42 = __CFSHL__(_EDI, 6);
      v43 = __ROL4__(_EDI, 6);
      LOWORD(v43) = v43 - (v42 + (_WORD)_EBX);
      _EBX = _EDX ^ _EBX;
      LOBYTE(_ECX) = (_BYTE)_ECX << _ECX;
      v51 = v43 - (__CFADD__((_BYTE)_EDX, BYTE1(_ECX)) + 1422817959);
      _EDX = _EDX - 1124340579;
      if ( _EBX == 2006718025 )
      {
        *(_DWORD *)(v100 - 9) <<= 27;
        JUMPOUT(0x406556);
      }
      __asm { rcr     cl, 2 }
      LOWORD(v100) = __ROR2__(v100, _ECX);
      _ESI = v100 - 1397186575;
      __asm { rcr     edx, cl }
      v12 = 0;
      BYTE1(_ECX) = 1;
      if ( v51 == 1107266911 )
      {
        BYTE1(v12) = a9;
        v111[8 * v12] += _EDX;
        BYTE1(_EBX) -= _EBX;
        a1 = __CFSHL__(_ECX, 24);
        LOBYTE(_ECX) = 0;
        __asm
        {
          rcr     ebx, 16h
          rcr     ecx, cl
        }
        LOBYTE(_ECX) = _ECX + 1;
        LOWORD(_EBX) = _EBX - (a1 + (_WORD)_ECX);
        __asm
        {
          rcr     ebx, 2
          rcl     bl, 1Bh
        }
        JUMPOUT(0x406222);
      }
      __asm { rcr     esi, cl }
      _ESI = _ESI << _ECX;
      v96 = _EBX ^ BYTE1(_EDX);
      LOWORD(_ESI) = (_WORD)_ESI << _ECX;
      v98 = _EBX;
      BYTE1(_ECX) = __ROR1__(-89, 20);
      LOBYTE(_EBX) = (char)_EBX >> 7;
      _DH = __ROR1__(v96, 9) - 96;
      LOBYTE(_ECX) = v98 | _ECX;
      __asm { rcl     dh, 16h }
      _EBX = _EBX | 0xC9BB1461;
      v20 = _ECX;
      v21 = v98 >> 2;
      LOBYTE(_ECX) = __ROR1__(_ECX, _ECX);
      LOBYTE(_EBX) = 12;
      __asm { rcr     ebx, 1Eh }
      BYTE1(_EBX) ^= v21;
      __asm { rcl     esi, 8 }
      LOBYTE(_EBX) = __ROR1__(_EBX, _ECX);
      if ( _EBX == 124672277 )
      {
        MEMORY[0x4DBFA74C] = 0;
        JUMPOUT(0x4067B2);
      }
      _DI = __ROL4__(v20, _ECX);
      BYTE1(_EBX) >>= 1;
      __asm
      {
        rcr     bh, cl
        rcr     di, cl
        int     2Eh; DOS 2+ internal - EXECUTE COMMAND
      }
      BYTE1(_ECX) = 0;
      v35 = _EBX + 1;
      __asm { rcr     cl, cl }
      LOWORD(v35) = (unsigned __int8)__ROL1__(v35, _ECX);
      _ECX = v35 + _ECX;
      __asm { rcr     esi, 0Eh }
      BYTE1(v35) = 0;
      __asm { rcr     ecx, cl }
      BYTE1(_ECX) = 0;
      if ( v35 == 108116028 )
        JUMPOUT(0x4065E0);
      _DH = (_DH - ((unsigned __int16)((_WORD)v35 << _ECX) >> 8)) | 0xC3;
      __asm { rcl     dh, 0Bh }
      LOWORD(v73) = _ECX;
      BYTE1(_ECX) = __ROR1__(0, 14);
      __asm { rcr     cx, cl }
      return v73;
    }
LABEL_31:
    LOBYTE(_EBX) = (_EBX + 101) ^ 0xF9;
    __asm { rcl     bl, 6 }
    _EBX = (_EBX >> 30) + 1565520435;
    __asm { rcr     bl, 0Bh }
    JUMPOUT(0x4069D1);
  }
  BYTE1(_ECX) |= 0x4Au;
  a1 = __CFSHR__(BYTE1(_EDX), 16);
  BYTE1(_EDX) = 0;
  _ESI = (_DWORD *)(_ECX + a1 + a7);
  LOWORD(_EAX) = _EAX - 1 - _ECX;
  ++BYTE1(_EBX);
  __asm { rcr     ch, 0Eh }
  if ( _ECX == -1279051889 )
  {
    __asm
    {
      rcr     byte ptr ds:0D0FE465Eh, cl
      rcr     ebx, 10h
      rcl     edi, 1Ah
    }
    LOBYTE(_ECX) = -(char)_ECX;
    __asm { rcr     dl, cl }
    LOWORD(_ECX) = (unsigned __int8)_ECX;
    if ( _ESI != (_DWORD *)549008416 )
    {
      __asm { rcr     si, cl }
      LOWORD(_EDX) = (_WORD)_EDX << _ECX;
      LOWORD(_EDI) = (unsigned __int16)_EDI >> _ECX;
      if ( _EDI == 1609680100 )
      {
        v70 = _ECX - 1;
        if ( v70 )
        {
          MK_FP(*(_WORD *)(a6 - 67), *(_DWORD *)(a6 - 71))(v70, _EDX);
          JUMPOUT(0x4066D7);
        }
        JUMPOUT(0x406655);
      }
      JUMPOUT(0x4066D3);
    }
    __asm { fld     qword ptr [ecx-5E8F1D02h] }
    v73 = (__PAIR64__(_EAX, 549008416) - __PAIR64__(*(_DWORD *)(_ECX + 1494580987), 549008416)) >> 32;
    LOBYTE(_ECX) = _ECX ^ 0xBC;
    BYTE1(_ECX) = -80;
    v53 = _ECX >> _ECX;
    if ( _EDX != 30023679 )
      JUMPOUT(0x406158);
    _CX = v53 - 0x1FFF;
    __asm
    {
      rcl     dx, cl
      rcr     ch, cl
    }
    LOWORD(v73) = __ROL2__(v73, _CX) ^ 0x3420;
  }
  else
  {
    __asm { rcr     cl, cl }
    LOWORD(_EAX) = _EAX - 1;
    a1 = __CFSHR__(_EAX, 17);
    LOBYTE(_EAX) = 0;
    _KR00_8 = __PAIR64__(_ECX, _EBX - (a1 + 1771006725)) - ((unsigned int)_EDX | 0x6BD060E600000000i64);
    _ECX = _EDI | HIDWORD(_KR00_8) | 0x6BFFE6C9;
    __asm { rcl     ebx, cl }
    BYTE1(_EDX) = -1;
    _EBX = __ROL4__(_EBX, 19);
    _ECX = __ROR4__(_ECX, 1);
    __asm { rcl     al, cl }
    LOBYTE(_EBX) = 2 * (BYTE1(_ECX) & _EBX);
    if ( _EBX != -222472825 )
    {
      __asm { rcr     eax, 13h }
      LOBYTE(_EDX) = __ROL1__(_EDX, 19);
      LOWORD(_EBX) = __ROR2__(_EBX, _ECX);
      BYTE1(_ECX) >>= _ECX;
      __asm { rcl     ch, 13h }
      BYTE1(_EDX) = __CFSHR__(-1, _ECX) + (-1 >> _ECX) - 119;
      if ( _EDX == -908627616 )
        JUMPOUT(0x4069D2);
      v36 = -(__int16)_EDX;
      _EAX = _EDI ^ _EBX;
      LOBYTE(_EAX) = (unsigned __int8)(_EDI ^ _EBX) >> _ECX;
      BYTE1(_EDX) = HIBYTE(v36) | 0x58;
      LOWORD(_EBX) = __ROR2__(_EBX, _ECX);
      LOBYTE(_EDX) = __ROR1__(v36, 1);
      if ( _EBX == 1893835873 )
        JUMPOUT(0x406404);
      v93 = _EDX & 0xF5ED94DB;
      __asm { rcl     cl, cl }
      BYTE1(_EAX) = __ROR1__(BYTE1(_EAX), _CL) << _CL;
      BYTE1(_ECX) = BYTE1(v93) << _CL;
      LOBYTE(_EBX) = __ROR1__(_EBX, _CL);
      _EDX = _EAX + v93;
      LOBYTE(_ECX) = _CL + 77;
      BYTE1(_EDX) = __ROR1__(BYTE1(_EDX), _ECX);
      LOBYTE(_EDX) = _EDX | 0xDE;
      __asm { rcl     ah, 2 }
      HIWORD(v32) = -9941;
      LOBYTE(_ECX) = __ROL1__(_ECX, 6);
      _CX = __ROL4__(_ECX, _ECX);
      SBYTE1(_EAX) >>= 7;
      LOBYTE(_CX) = _EDX ^ _CX;
      if ( _EAX == -1680462164 )
      {
        *(a6 - 11) = -84;
        _disable();
        JUMPOUT(0x406719);
      }
      BYTE1(_EAX) &= _CX;
      __asm { rcr     eax, cl }
      BYTE1(_EBX) = 12;
      LOWORD(v32) = -4505;
      LOBYTE(_EAX) = __ROL1__(_EAX, 2);
      v29 = _CX ^ 0x9FC0;
      a1 = __CFADD__(v29, (_WORD)_EBX);
      LOWORD(_EBX) = v29 + _EBX;
      __asm { rcl     edx, 1Ah }
      v27 = v32 - (a1 - 827265155);
      SBYTE1(_EBX) >>= 7;
      HIBYTE(_CX) = BYTE1(_EAX);
      v89 = _EDX + 1;
      LOBYTE(_CX) = _EAX - 108;
      v91 = _EAX + 1361306141 - (((unsigned __int8)_EAX < 0x6Cu) - 1303243432);
      LOBYTE(v89) = v89 ^ 0xEA;
      v92 = -v89;
      if ( v27 == -2105547694 )
        JUMPOUT(0x406816);
      LOBYTE(_CX) = (unsigned __int8)_CX >> _CX;
      v102 = _EBX >> _CX;
      v101 = __ROR4__(v27 ^ 0x531B2964, _CX);
      LOBYTE(v102) = v92 ^ v102;
      LOBYTE(v91) = v91 - _CX;
      if ( v91 == 2104260130 )
      {
        __asm { arpl    di, cx }
        JUMPOUT(0x40693E);
      }
      LOBYTE(_CX) = BYTE1(v91) + _CX;
      v22 = v91 | v102;
      v23 = v101 + _CX;
      LOWORD(v91) = v23 | v91;
      _EAX = v91 & 0xE6C29294;
      __asm { rcr     al, 5 }
      LOWORD(v101) = __ROL2__(v101, v23);
      LOWORD(v22) = (unsigned __int16)v22 >> v23;
      _EBX = __ROR4__(v22, 4);
      if ( v101 == 1701510691 )
      {
        MK_FP(*(_WORD *)(_EAX + 8 * _EDI + 82), *(_DWORD *)(_EAX + 8 * _EDI + 78))();
      }
      else
      {
        LOBYTE(_EBX) = _EBX - 75;
        ++BYTE1(_EBX);
        if ( _EDI != -1462120034 )
          JUMPOUT(0x406766);
      }
      goto LABEL_31;
    }
    *_ESI += 251775169;
    *(_BYTE *)(_ECX + _EAX) = 0;
    LOBYTE(_ECX) = _EAX + _ECX;
    _enable();
    v73 = _EAX | 0xE7C1DF22;
    *(_DWORD *)(v73 - 189532691) += v73;
    BYTE1(_ECX) <<= _ECX;
    v62 = __CFSHL__(_ECX, 21);
    _ECX = _ECX << 21;
    __asm { rcl     bh, cl }
    LOBYTE(_EBX) = BYTE1(_EBX) + v62 - 121;
    v54 = __ROR4__(_ESI, 1);
    v55 = (unsigned int)_EDI >> 30;
    v56 = __ROL4__(_EBX, 27);
    LOWORD(v56) = __ROL2__(v56, _ECX);
    if ( v54 != -618325024 )
    {
      v15 = __ROR4__(v54, _ECX);
      v16 = v55 >> 1;
      LOBYTE(v56) = _EDX ^ v56;
      BYTE1(v56) = __ROL1__(BYTE1(v56), _ECX) - BYTE1(v73);
      LOWORD(v16) = v16 - _ECX;
      __asm { rcr     cx, cl }
      v39 = _ECX << 13 >> 8;
      BYTE1(v56) = (unsigned __int8)-BYTE1(v56) >> v39;
      sub_4078B0(v73, _EDX, v39, v56, a6, v16 ^ 0x31FAB94D, v15, a8);
      JUMPOUT(0x406A07);
    }
  }
  return v73;
}
// 406715: positive sp value 4 has been found
// 4066D1: control flows out of bounds to 4066D7
// 406718: control flows out of bounds to 406719
// 40675E: inconsistent fpu stack
// 4067B1: control flows out of bounds to 4067B2
// 406815: control flows out of bounds to 406816
// 4068A4: control flows out of bounds to 4068A5
// 40693C: control flows out of bounds to 40693E
// 406403: control flows out of bounds to 406404
// 4064D5: control flows out of bounds to 4064D6
// 406551: control flows out of bounds to 406556
// 4065DA: control flows out of bounds to 4065E0
// 4069CD: control flows out of bounds to 4069D2
// 406A02: control flows out of bounds to 406A07
// 406693: control flows out of bounds to 406655
// 4067BF: control flows out of bounds to 40698F
// 40682F: control flows out of bounds to 4069D1
// 406149: control flows out of bounds to 406222
// 406169: control flows out of bounds to 823AEC81
// 40630D: control flows out of bounds to 406692
// 406689: control flows out of bounds to 4066D3
// 40621E: control flows out of bounds to 4061EC
// 406223: control flows out of bounds to 406226
// 4062E1: control flows out of bounds to 406766
// 40640D: control flows out of bounds to 406158
// 4061F8: conditional instruction was optimized away because of 'eax.4>=E7C1DF22u'
// 406521: conditional instruction was optimized away because of 'esi.4==20B93420'

//----- (004078B0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4078B0(int a1@<eax>, __int32 _EDX@<edx>, int _ECX@<ecx>, int _EBX@<ebx>, char *a5@<ebp>, int a6@<edi>, int a7@<esi>, double a8@<st1>)
{
  int v8; // esi
  __int32 v13; // ebx
  unsigned int v15; // edi
  int v25; // esi
  int v27; // edx
  int v29; // ecx
  int v30; // esi
  bool v31; // tt
  __int16 v34; // cx
  int v35; // esi
  bool v36; // cf
  __int16 v43; // ax
  unsigned int v45; // esi
  char *v47; // et1
  int v48; // esi
  int v49; // ebx
  unsigned int v50; // edi
  _DWORD *i; // eax
  char *v57; // eax
  _BYTE *v60; // esi
  int v62; // edi
  int v63; // esi
  _DWORD *v64; // esi
  unsigned int v65; // edi
  unsigned int v66; // edi
  __int16 v67; // cx
  int v69; // esi
  bool v74; // tt
  _DWORD *v76; // [esp-20h] [ebp-20h] BYREF
  _DWORD v77[2]; // [esp-1Ch] [ebp-1Ch] BYREF
  int v78; // [esp-14h] [ebp-14h]
  int v79; // [esp-10h] [ebp-10h]
  unsigned int *v80; // [esp-Ch] [ebp-Ch]
  unsigned int v81; // [esp-8h] [ebp-8h] BYREF

  LOBYTE(_EDX) = _EDX + 100;
  v30 = a6 + a7;
  LOBYTE(a1) = (char)(a1 + 1) >> 7;
  v31 = __CFSHL__(a6, _ECX);
  LOWORD(a6) = __ROL2__(a6, _ECX);
  BYTE1(a1) += v31 + 66;
  LOWORD(_EBX) = (unsigned __int8)((_BYTE)_EBX << _ECX);
  if ( _EDX != -286730786 )
  {
    v69 = __ROR4__(v30, 3);
    __asm
    {
      rcl     ecx, 14h
      rcl     bh, 12h
    }
    goto LABEL_39;
  }
  v76 = v77;
  a5 = (char *)v77;
  --BYTE1(_ECX);
  BYTE1(_EDX) = __CFSHL__(_ECX, 18);
  LOBYTE(_ECX) = 0;
  _ECX = _ECX + 154610288;
  v13 = _EDX;
  LOWORD(_ECX) = a1 ^ (_ECX + 1);
  LOBYTE(_ECX) = _ECX | 0x71;
  v15 = (((a6 - 1) | 0x187850C7) + 1) << 17;
  _EAX = (char *)(a1 - 2832);
  LOBYTE(_ECX) = (unsigned __int8)_ECX >> _ECX;
  _EDX |= _ECX;
  BYTE1(_EDX) = (char)(((_BYTE)_EAX + BYTE1(_EDX)) ^ 0xB1) >> 1;
  v64 = (_DWORD *)(v30 + 1);
  __asm { rcr     dh, cl }
  v36 = __CFSHR__(v15, 13);
  v65 = v15 >> 13;
  BYTE1(_EDX) -= v36 + 117;
  if ( _EAX == (char *)-771093549 )
    JUMPOUT(0x407CA3);
  v66 = __ROL4__(v65, 1);
  LOWORD(v13) = (unsigned __int8)((unsigned __int8)v13 >> _ECX);
  _EBX = v13 + 1;
  v67 = -(__int16)_ECX;
  LOBYTE(_EBX) = _EBX - 10;
  if ( v66 == 998505565 )
  {
    if ( !(_WORD)_EDX )
    {
      *v64 = __ROL4__(*v64, v67);
      JUMPOUT(0x407BAC);
    }
    JUMPOUT(0x407CB6);
  }
  BYTE1(_EBX) = BYTE1(_EDX);
  _CH = HIBYTE(v67) - ((v66 < 0x3B83FC5D) + 30);
  __asm { rcr     ch, 1Ch }
  _ECX = 1268482903;
  __asm { rcr     bx, cl }
  _EDI = (((_DWORD)v64 << 6) | ~v66) ^ 0x122F17F7;
  __asm { rcl     edi, cl }
  _EDI = (_DWORD *)(_EDI << 10);
  _EBX = __CFSHL__(BYTE1(_EDX), 14) + _EBX - 924412036;
  HIWORD(_EDX) ^= 0xEA0Du;
  LOBYTE(_EBX) = 0;
LABEL_20:
  BYTE1(_EBX) = 56;
  _ECX = _ECX ^ 0x4B9B8F5C;
  _ESI = (_BYTE *)_ECX;
  LOBYTE(_EBX) = BYTE1(_ECX) ^ BYTE1(_ECX) & _EBX | 0x13;
  LOWORD(_EDX) = (_WORD)_EAX;
  if ( _EAX == (char *)1560667453 )
  {
    *_EDI += _ECX;
    __asm { rcl     ah, 1 }
LABEL_22:
    __asm { rcl     bl, 0Fh }
    LOBYTE(_EBX) = (unsigned __int8)_EAX & _EBX;
    v36 = (unsigned __int8)_EBX < (unsigned __int8)(__CFSHL__(_EDI, 11) - 68);
    LOBYTE(_EBX) = _EBX - (__CFSHL__(_EDI, 11) - 68);
    LOWORD(_EBX) = _EBX - (v36 + (_WORD)_EAX);
    BYTE1(_EDX) = _EDX;
    _BL = __ROL4__(_EBX, 19);
    __asm { rcr     bl, 0Bh }
    if ( _EAX == (char *)-218952480 )
    {
      __asm { iret }
      JUMPOUT(0x407B62);
    }
    _ESI = _ECX ^ 0x256A650C;
    __asm { rcl     esi, cl }
    *_EAX = _EDX;
    v60 = (_BYTE *)((_ESI << 23) - 1);
    if ( _EDX != 177490588 )
      JUMPOUT(0x407A20);
    MEMORY[0xF996A324] = *v60;
    _EAX = MEMORY[0x81515F70]((unsigned __int16)__CS__);
    *((_DWORD *)a5 + 116159634) = (int)a8;
    _enable();
    v8 = (int)(v60 + 1) >> 30;
    _EDI = __ROL4__(-107568347, _ECX);
    goto LABEL_29;
  }
  while ( 1 )
  {
    BYTE1(_EBX) ^= 0xCFu;
    BYTE1(_EDX) >>= _ECX;
    _EBX = __ROL4__(_EBX, _ECX);
    BYTE1(_EBX) = __ROR1__(BYTE1(_EBX), 5);
    __asm { rcr     bh, cl }
    LOWORD(_EDI) = (_WORD)_EDI << _ECX;
    if ( _EDX != 1389066426 )
      JUMPOUT(0x407B60);
    v76 = (_DWORD *)(unsigned __int16)__ES__;
    _ECX = 249266218;
    _DI = (_WORD)_EDI - (_WORD)_EAX;
    __asm { rcr     di, cl }
    BYTE1(_EBX) = _EBX ^ __ROR1__(BYTE1(_EBX), 42);
    if ( _EDI == (_DWORD *)-707423882 )
    {
      v36 = _ESI[91] < 0x80u;
      _ESI[91] += 0x80;
      v43 = v36 + (_WORD)_EAX - 6196;
      LOBYTE(_EBX) = v43;
      BYTE1(_EBX) = __ROR1__(BYTE1(_EBX), 25);
      _BH = HIBYTE(v43) + ((unsigned __int16)__ROL4__(_EBX, 12) >> 8);
      __asm { rcl     bh, cl }
      _BL = 0;
      _BH = 0;
      __asm
      {
        rcr     bl, 7
        rcl     bh, 14h
      }
      JUMPOUT(0x407A55);
    }
    __asm { rcr     esi, 1Ch }
    LOWORD(_EBX) = -32726;
    LOBYTE(_EDX) = -31;
    _EBX = _EBX << 25;
    __asm { rcl     bh, cl }
    v45 = _ESI >> 10;
    if ( _EDI != (_DWORD *)-1158215488 )
      goto LABEL_22;
    LOBYTE(_EBX) = 80;
    MEMORY[0x65D1140] += &v76;
    v47 = _EAX;
    _EAX = (int)a5;
    a5 = v47;
    LOBYTE(_EDX) = *(_BYTE *)(v45 + 50) & 0xE1;
    v48 = v45 | 0xEDB802A;
    v49 = __ROR4__(_EBX, 18);
    LOBYTE(v49) = 0;
    v50 = _EDX & 0xBB283B0D;
    _EBX = v49 + 622698807;
    LOBYTE(_EBX) = 0;
    if ( (_EDX & 0xBB283B0D) != 599827687 )
      JUMPOUT(0x407C86);
    __asm { arpl    [ecx+ecx*4], cx }
    LOBYTE(_EAX) = MEMORY[0x8030B1A6];
    if ( (_EDX & 0xBB283B0D) != 599827687 )
      JUMPOUT(0x407A5C);
    v36 = __CFSHR__(_EBX, 42);
    LOWORD(_EBX) = (unsigned __int16)_EBX >> 10;
    LOBYTE(_EBX) = (BYTE1(_EBX) + v36 + _EBX) | 6;
    __asm { rcl     bl, 19h }
    v25 = -1024 * v48;
    _EBX = _EBX - ((v25 != 0) + 249266218);
    LOBYTE(_EDX) = __ROR1__(_EDX, 1);
    BYTE1(_EBX) = 0;
    _EDI = __ROL4__(v50, 23);
    if ( _EDI == 1173165228 )
    {
      __asm { iret }
      JUMPOUT(0x407818);
    }
    LOBYTE(_EBX) = 82;
    LOWORD(_EBX) = (__int16)_EBX >> 10;
    BYTE1(_EBX) = -BYTE1(_EBX);
    v8 = v25 - ((BYTE1(_EBX) != 0) - 1557731531);
    BYTE1(_EBX) += 7;
    if ( _EAX != 113351170 )
    {
      SBYTE1(_EBX) >>= 7;
      LOWORD(_EBX) = _EBX - v8;
      __asm
      {
        rcr     bl, cl
        rcl     ebx, 16h
      }
      JUMPOUT(0x40796D);
    }
    __asm
    {
      rcl     byte ptr [edi+4Bh], cl
      insb
    }
LABEL_29:
    v62 = _EDI >> 29;
    LOWORD(v8) = __ROR2__(v8, _ECX);
    v63 = v62 ^ v8;
    LOWORD(v63) = v63 - _ECX - _EDX;
    _ESI = (v63 | 0x69FD508B) + 1971398401;
    __asm { rcr     esi, 0Bh }
    _ESI = -_ESI;
    _EDI = (v62 ^ 0x63CE86D0) - 1316115455;
    _EBX = _ECX + 99783856;
    __asm
    {
      rcr     edi, 1Ch
      rcl     si, cl
    }
    v69 = _ESI << 13;
    if ( _ECX )
      JUMPOUT(0x40798B);
    _ECX = 0;
    if ( v69 != 439723019 )
      break;
    LOWORD(_EDX) = _InterlockedExchange((volatile __int32 *)0xFFFFFFB7, _EDX);
LABEL_39:
    LOBYTE(_EBX) = _EBX - BYTE1(_EBX);
    v81 = _ECX;
    v80 = &v81;
    v79 = 64;
    v78 = 4224945;
    for ( i = (_DWORD *)&loc_4077B1; *i != 9460301; i = (_DWORD *)(((unsigned int)i - 1) & 0xFFFFF000) )
      ;
    _ECX = (int)i;
    v57 = (char *)i + i[15];
    v78 = *((_DWORD *)v57 + 20);
    if ( v69 == -82549927 )
    {
      _EDI = (_DWORD *)v78;
      __SS__ = v79;
      _EAX = v57 - 1;
      __asm { insb }
      HIWORD(_EDX) = HIWORD(v80);
      goto LABEL_20;
    }
    (*(void (__cdecl **)(int))(_ECX + *(_DWORD *)(_ECX + *(_DWORD *)&v57[(_DWORD)&loc_40782C - 4224940] + 16)))(_ECX);
    _ECX = v36 + v77[1] - 527127475;
    LOBYTE(_ECX) = 0;
    BYTE1(_EBX) = __ROL1__(0, 13);
    __asm { rcl     ecx, cl }
    LOBYTE(_EBX) = 0;
    LOBYTE(_ECX) = (_ECX + 125) ^ 8;
    v29 = _ECX >> 25;
    LOBYTE(v29) = 0;
    _ECX = ~v29;
    BYTE1(_ECX) |= BYTE1(_EBX);
    v35 = _ECX;
    v36 = __CFADD__(_ECX, _EBX);
    _EBX += _ECX;
    LOBYTE(_ECX) = _ECX - (v36 + v27);
    _EDI = (_DWORD *)(v35 ^ 0x3C);
    _EDX = v27 - 1284079254;
    LOWORD(_EDX) = v35 | _EDX;
    if ( v78 != 593424645 )
      JUMPOUT(0x40769C);
    __asm { aam     0B5h ; 'µ' }
    LOBYTE(_EAX) = *(_BYTE *)v35;
    _ESI = (_BYTE *)(v35 + 1);
  }
  LOWORD(_ECX) = _EDX;
  BYTE1(_EDX) &= 0xCFu;
  BYTE1(_EAX) = 0;
  _EDI = __ROL4__(_EDI, 2);
  _BH = -43;
  LOBYTE(_ECX) = (unsigned __int8)_ECX >> _ECX;
  __asm { rcl     bh, 3 }
  if ( _EAX == -622909294 )
    JUMPOUT(0x4077EC);
  LOBYTE(_ECX) = ((char)_ECX >> 7) | 0x6B;
  BYTE1(_EAX) = _ECX;
  __asm { rcr     eax, 18h }
  v74 = __CFSHR__(_ECX, 14);
  LOBYTE(_ECX) = __ROR1__(_ECX, 14);
  _BL = -80 - BYTE1(_ECX) - (v74 + 32);
  __asm
  {
    rcl     edi, 0Dh
    rcr     cl, cl
  }
  HIBYTE(v34) = BYTE1(_ECX) - ((_ECX < 0x8ED29E9) + _BL);
  LOBYTE(v34) = __ROL1__(_CL, _CL);
  if ( _EDX == 279822986 )
    JUMPOUT(0x407922);
  _CL = __ROR2__(v34, v34);
  __asm { rcr     bl, cl }
}
// 407A78: positive sp value 1C has been found
// 407921: control flows out of bounds to 407922
// 4077E6: control flows out of bounds to 4077EC
// 407B61: control flows out of bounds to 407B62
// 407817: control flows out of bounds to 407818
// 4079D0: control flows out of bounds to 407C86
// 407B77: control flows out of bounds to 40798B
// 407C59: control flows out of bounds to 407CA3
// 407C96: control flows out of bounds to 407BAC
// 407642: control flows out of bounds to 40796D
// 40783A: control flows out of bounds to 407A55
// 407942: control flows out of bounds to 40769C
// 407963: control flows out of bounds to 407B60
// 407A56: control flows out of bounds to 407A5C
// 407BA2: control flows out of bounds to 407A20
// 407C80: control flows out of bounds to 407CB6
// 407919: variable '_EDX' is possibly undefined
// 40792C: variable 'v27' is possibly undefined
// 40761B: variable '_ECX' is possibly undefined
// 407707: variable 'v36' is possibly undefined

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
