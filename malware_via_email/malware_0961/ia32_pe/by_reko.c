// subject_rsec.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw40A078 = 0xA0AD; // 0040A078
word32 g_dw40A07C = 41151; // 0040A07C
word32 g_dw40A080 = 41166; // 0040A080
word32 g_dw40A084 = 0xA0E1; // 0040A084
word32 g_dw40A088 = 0xA0F3; // 0040A088
word32 g_dw40A08C = 41222; // 0040A08C
word32 g_dw40A094 = 0xA120; // 0040A094
word32 g_dw40A098 = 0xA134; // 0040A098
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401004: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	word32 ebp;
	word32 dwLoc2C;
	word32 ebp_108;
	fn004010D0(ebp, (word16) dwLoc2C, out ebp_108);
	word32 ebp_120;
	return fn004010D0(ebp_108, 0x00, out ebp_120);
}

// 004010D0: Register word32 fn004010D0(Register word32 ebp, Stack word16 wArg00, Register out ptr32 ebpOut)
// Called from:
//      Win32CrtStartup
word32 fn004010D0(word32 ebp, word16 wArg00, ptr32 & ebpOut)
{
	ptr32 fp;
	struct Eq_21 * fs;
	word32 dwArg00;
	word32 dwLoc30;
	int32 dwLoc0130;
	word16 eax_16_16_22 = SLICE(dwArg00, word16, 16);
	word32 eax_36 = SEQ(eax_16_16_22, 0x00);
	struct Eq_30 * ebx_113;
	word32 ecx_114;
	word32 eax_112 = fn0040169E((word16) dwLoc30, out ecx_114, out ebx_113);
	word16 ecx_16_16_137 = SLICE(ecx_114, word16, 16);
	word32 eax_139;
	word32 ecx_141;
	ebx_113->ptr0018();
	struct Eq_49 * esp_146;
	<unknown> Eq_21::* eax_147;
	word32 ecx_149;
	ebx_113->ptr001C();
	word16 ecx_16_16_169 = SLICE(ecx_149, word16, 16);
	uint32 esi_160 = (uint32) ((&(fs->*((char *) eax_147 + 4)))[(char *) eax_147 + 6].w0000 + 0x02);
	esp_146->ptrFFFFFFFC = (<unknown> Eq_21::*) ((char *) eax_147 + 6);
	esp_146->ptrFFFFFFF8 = (<unknown> Eq_21::*) ((char *) eax_147 + 6);
	struct Eq_77 * esp_170;
	struct Eq_30 * eax_171;
	word32 ecx_173;
	ebx_113->ptr0000();
	word16 ecx_16_16_214 = SLICE(ecx_173, word16, 16);
	esp_170->ptr0038 = ebx_113;
	esp_170->dw003C = esi_160 - 0x01;
	esp_170->ptrFFFFFFFC = ebx_113;
	esp_170->ptrFFFFFFFC -= 0x04;
	struct Eq_30 * edi_186 = esp_170->ptrFFFFFFFC;
	esp_170->ptrFFFFFFFC = eax_171;
	esp_170->dwFFFFFFF8 = ecx_173;
	esp_170->ptrFFFFFFF4 = esp_170 - 8;
	esp_170->dwFFFFFFF0 = 0x40;
	esp_170->dwFFFFFFEC = esp_170->dw0020;
	esp_170->dwFFFFFFE8 = esp_170->dw0014;
	esp_170->dw0018 = 0x00;
	esp_170->dwFFFFFFE4 = ~0x00;
	struct Eq_143 * esp_215;
	struct Eq_144 Eq_21::* eax_216;
	edi_186->ptr0010();
	struct Eq_148 * eax_222 = eax_216 + (fs->*eax_216).dw002F / 0x0033;
	word32 ecx_225 = eax_222->dw0003;
	esp_215->dw0030 += ecx_225;
	esp_215->ptr0000 = eax_222;
	esp_215->ptr0004 = esp_215->ptr0000;
	struct Eq_148 * eax_241 = esp_215->ptr0004;
	struct Eq_177 * edi_243 = esp_215->ptr0008;
	esp_215->ptr0010 = (struct Eq_177 *) ((char *) eax_241 + 2);
	esp_215->ptr0010 = (struct Eq_177 *) ((char *) &esp_215->ptr0010->t0000 + 1);
	struct Eq_177 * eax_259 = esp_215->ptr0010;
	Eq_196 ecx_261 = eax_259->t0000.u1;
	esp_215->ptr0010 = eax_259;
	struct Eq_177 * eax_265 = esp_215->ptr0010;
	esp_215->dw003C = esp_215->dw003C ^ ecx_261;
	esp_215->ptr0010 = eax_265;
	esp_215->ptr0010 = esp_215->ptr001C;
	word32 ecx_283 = esp_215->dw002C;
	struct Eq_177 * eax_281 = esp_215->ptr0010;
	word16 ecx_16_16_354 = SLICE(ecx_283, word16, 16);
	esp_215->ptrFFFFFF0C = eax_281;
	esp_215->ptrFFFFFF08 = eax_281;
	esp_215->dwFFFFFF10 = ecx_283;
	esp_215->ptrFFFFFF08 = edi_243;
	esp_215->ptrFFFFFF04 = null;
	struct Eq_177 * eax_302 = esp_215->ptrFFFFFF04;
	do
	{
		esp_215->ptrFFFFFF04 = eax_302;
		struct Eq_177 * eax_310 = esp_215->ptrFFFFFF04;
		eax_302[(esp_215 - 0xEC) / 4] = (struct Eq_177) (byte) eax_310;
		esp_215->ptrFFFFFF04 = eax_310;
		struct Eq_177 * eax_318 = esp_215->ptrFFFFFF04;
		eax_302 = (struct Eq_177 *) ((char *) &eax_318->t0000 + 1);
	} while (eax_318 < (struct Eq_177 *) 0xFF);
	esp_215->ptrFFFFFF04 = (struct Eq_177 *) ((char *) &eax_318->t0000 + 1);
	esp_215->ptrFFFFFF08 = esp_215->ptrFFFFFF04;
	esp_215->ptrFFFFFF08 = (struct Eq_177 *) (&esp_215->dw003C + 2);
	struct Eq_177 * eax_340 = esp_215->ptrFFFFFF08;
	if (eax_340->t0000.u0 != 121)
	{
		struct Eq_298 * edi_344 = eax_340->ptrFFFFFFFC;
		esp_215->ptrFFFFFF08 = eax_340;
		struct Eq_177 * eax_348 = esp_215->ptrFFFFFF08;
		do
		{
			struct Eq_387 * esp_360;
			word32 eax_361;
			word32 ecx_363;
			edi_344->ptr001C();
			esp_360->dwFFFFFFFC = eax_361;
			struct Eq_396 * esp_372;
			word32 eax_373;
			word32 ecx_375;
			edi_344->ptr001C();
			esp_372->dwFFFFFFFC = eax_373;
			struct Eq_405 * esp_384;
			word32 eax_385;
			word32 ecx_387;
			edi_344->ptr001C();
			esp_384->dwFFFFFFFC = eax_385;
			word32 eax_397;
			word32 ecx_399;
			edi_344->ptr001C();
			word16 ecx_16_16_402 = SLICE(ecx_399, word16, 16);
			word32 eax_404;
			word32 ecx_406;
			edi_344->ptr001C();
			word16 ecx_16_16_409 = SLICE(ecx_406, word16, 16);
			word32 eax_411;
			word32 ecx_413;
			edi_344->ptr001C();
			word16 ecx_16_16_416 = SLICE(ecx_413, word16, 16);
			struct Eq_323 * esp_417;
			struct Eq_177 * eax_418;
			word32 ecx_420;
			edi_344->ptr001C();
			word16 cx_434 = (word16) ecx_420;
			ecx_16_16_354 = SLICE(ecx_420, word16, 16);
			int3();
			esp_417->ptrFFFFFFFC = eax_418;
			struct Eq_177 * eax_428 = esp_417->ptrFFFFFFFC;
			word16 ax_433 = (word16) eax_428 + 0x01;
			word16 eax_16_16_438 = SLICE((char *) &eax_428->t0000 + 1, word16, 16);
			cup16 ax_435 = ax_433 - cx_434;
			esp_417->ptrFFFFFFFC = SEQ(eax_16_16_438, ax_435);
			eax_348 = esp_417->ptrFFFFFFFC;
		} while (ax_435 < 0x00);
		esp_417->ptrFFFFFFFC = eax_348;
	}
	int32 esi_485 = 0x00;
	int32 ebp_486 = 0x00;
	Eq_339 eax_502 = 0x00;
	do
	{
		word32 ebx_507 = (word32) (fp - 300)[ebp_486];
		byte bl_607 = (byte) ebx_507;
		word32 edx_520 = (word32) *((word32) eax_502 + dwLoc0130);
		word32 ecx_528 = ebx_507 + esi_485;
		word32 edx_530 = edx_520 + ecx_528;
		byte dl_542 = (byte) edx_530;
		word16 edx_16_16_543 = SLICE(edx_530, word16, 16);
		int32 edx_544 = SEQ(edx_16_16_543, 0x00, dl_542);
		esi_485 = edx_544;
		Eq_339 eax_556 = (word32) eax_502 + 1;
		if ((word32) eax_502 + 1 >= fp - 40)
			eax_556.u0 = 0x00;
		*((word32) (fp - 300) + ebp_486) = *((word32) (fp - 300) + edx_544);
		++ebp_486;
		ptr32 edx_593 = fp - 300 + edx_544 - eax_556;
		*((word32) eax_556.u0 + edx_593) = SEQ(*((word32) ((word32) eax_556.u0 + 1) + edx_593), bl_607);
		eax_502 = eax_556;
	} while (SLICE(ebp_486, byte, 8) != 0x01);
	ebpOut = ebp + 0x01;
	return eax_112;
}

// 0040169E: Register ptr32 fn0040169E(Stack word16 wArg00, Register out Eq_36 ecxOut, Register out ptr32 ebxOut)
// Called from:
//      fn004010D0
ptr32 fn0040169E(word16 wArg00, union Eq_36 & ecxOut, ptr32 & ebxOut)
{
	word32 dwArg00;
	word32 eax_158 = dwArg00;
	while (true)
	{
		word16 eax_16_16_28 = SLICE(eax_158, word16, 16);
		cup16 * eax_36 = SEQ(eax_16_16_28, 0x00);
		cup16 ax_38 = *eax_36;
		word32 eax_50 = SEQ(eax_16_16_28, ax_38 + 42421);
		word24 eax_24_8_66 = SLICE(eax_50, word24, 8);
		if (ax_38 == 23117)
			break;
		eax_158 = eax_50 - 0x00010000;
	}
	struct Eq_482 * eax_67 = SEQ(eax_24_8_66, (int8) (ax_38 > 23117));
	Eq_36 ecx_120 = eax_67[(&(eax_67 + eax_67->dw003C / 64)->dw003C)[0x0011] / 64];
	word32 eax_126 = eax_67 + ecx_120;
	ecxOut = ecx_120;
	ebxOut = eax_126 + 0x04;
	return eax_126 + 0x04;
}

