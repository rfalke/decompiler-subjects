/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int, int, int);
void __fastcall sub_4010DC(int, int);
// void __usercall sub_404102(int@<edx>, int _ECX@<ecx>, int _EBX@<ebx>);
// void __usercall sub_40415E(char@<zf>, char@<sf>, char@<of>, char@<dh>, char@<bl>);

//-------------------------------------------------------------------------
// Data declarations

int dword_401000 = 625491341; // weak
// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);


//----- (00401073) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  HMODULE ModuleHandleA; // eax
  int v4; // edx
  int v5; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  ModuleHandleA = GetModuleHandleA(0);
  sub_4010DC((int)ModuleHandleA, v4);
  v5 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 10;
  *(_DWORD *)(a3 + 176) = v5;
  return 0;
}
// 4010BA: variable 'v4' is possibly undefined

//----- (004010DC) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_4010DC(int a1, int a2)
{
  int v2; // [esp-10h] [ebp-10h] BYREF

  __writefsdword(0, (unsigned int)&v2);
  dword_401000 = a2;
}
// 4010ED: positive sp value C has been found
// 4010E4: write access to const memory at 401000 has been detected
// 401000: using guessed type int dword_401000;

//----- (00404102) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_404102(int a1@<edx>, int _ECX@<ecx>, int _EBX@<ebx>)
{
  __int16 v8; // bx
  __int16 v9; // dx
  int v10; // ecx
  int v11; // edx
  int v12; // edx
  unsigned int v13; // eax
  int v14; // ecx

  __asm { repne bt ebx, ecx }
  v8 = _EBX + 1;
  v9 = v8 & __ROL4__(__ROL4__(a1, 197), 184);
  sub_40415E(v9 == 0, v9 < 0, 0, SHIBYTE(v9), v8);
  v10 = -323849555;
  v12 = __ROR4__(v11, 17);
  _CF = _bittestandset(&v10, v13);
  v14 = 1957940404;
  if ( !_CF )
  {
    v14 = -457294401;
    LOBYTE(v8) = v8 + 1;
  }
  sub_40415E((v14 & 0x13860904) == 0, 0, 0, SBYTE1(v12), v8);
}
// 404119: positive sp value 4 has been found
// 404137: variable 'v11' is possibly undefined
// 40413A: variable 'v13' is possibly undefined

//----- (0040415E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40415E(char a1@<zf>, char a2@<sf>, char a3@<of>, char a4@<dh>, char a5@<bl>)
{
  char v5; // ah
  _DWORD *v7; // edi
  bool v9; // cf
  int v12; // [esp-4h] [ebp-4h]

  v5 = 74;
  if ( a2 ^ a3 | a1 )
    v5 = a4;
  __asm { fcomp   st(7) }
  if ( v5 == a5 )
  {
    __asm
    {
      fmul    st(5), st
      rep lea eax, ds:0DFDBDD3Ch
    }
  }
  __asm
  {
    fsubr   st(3), st
    fsubr   st(5), st
    fsubr   st(7), st
  }
  v7 = (_DWORD *)(v12 + 361);
  _EBX = -87027298;
  __asm
  {
    fsub    st(5), st
    fadd    st, st
    fadd    st(1), st
  }
  do
  {
    LOWORD(_EBX) = 2 * _EBX;
    v9 = __CFADD__((_WORD)_EBX, (_WORD)_EBX);
    LOWORD(_EBX) = 2 * _EBX;
    _EBX = _EBX - (v9 - 1296597983) - ((_EBX < (unsigned int)v9 - 1296597983) - 1303256083);
    __asm
    {
      rcr     ebx, 0B9h
      rcr     ebx, 85h
    }
    *v7 ^= 0x9C4B64A7;
    _EDX = 515633080;
    __asm { rcl     edx, 4Dh }
    ++v7;
  }
  while ( (int)v7 < v12 + 1326 );
  __readeflags();
  __asm { iret }
}
// 4041BD: positive sp value 4 has been found
// 404172: inconsistent fpu stack
// 4042A3: control flows out of bounds to 4042A4
// 4041BD: variable 'v12' is possibly undefined

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
