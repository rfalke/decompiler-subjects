/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

// void __usercall __noreturn sub_401004(char@<al>, __int16@<dx>, int@<ecx>, int@<ebx>);
// void __usercall __noreturn sub_401048(__int16@<dx>, int@<ecx>, int@<ebx>);
// void __usercall __noreturn sub_401073(int@<edx>, int@<ecx>, int@<ebx>);
_DWORD sub_40110A(); // weak
// void __usercall start(int@<edx>, int@<ecx>, int@<ebx>, int@<edi>, int@<esi>);
void __fastcall sub_4011BE(int, __int32);
// void __usercall sub_401E9E(char@<ah>, char@<dl>, int@<ecx>, int@<ebx>, int@<edi>, int@<esi>);
// void __usercall sub_401EDA(__int16@<ax>, int@<edx>, int@<ecx>, char@<bl>, int@<edi>);
void sub_401F6D();
void __thiscall sub_401FB4(void **this);
void sub_40204E();
_DWORD sub_402100(); // weak
void sub_4021A5();
void sub_402365();
// void __usercall sub_402383(char@<al>, int@<ecx>, int@<edi>);
void sub_4023F3();
// void __usercall sub_402438(int _EAX@<eax>, void **@<ecx>, __int32@<ebx>, double@<st0>);
_DWORD sub_4024EC(); // weak
void sub_402534();
void sub_402551();
// void __usercall sub_4025C9(int@<eax>, __int16@<dx>, int@<edi>, int@<esi>);
void sub_4028DA();
// unsigned int __usercall sub_40292E@<eax>(_DWORD *@<eax>, int@<edx>, int@<ecx>, int@<ebx>);
void __fastcall sub_4029B2(int, __int32);
// void __usercall sub_402A02(char@<al>, int@<edx>, int@<ecx>);
void sub_402B03();
void __thiscall sub_402B70(void **this);
// void __usercall sub_402C34(int@<edx>, __int32@<ecx>, unsigned __int8@<bl>, _BYTE *@<edi>, int@<esi>);
int __thiscall sub_402CEC(_DWORD); // weak
void sub_402D3E();
// void __usercall sub_402D8E(int@<edx>, int@<ecx>, int@<ebx>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_4022E4; // weak
_UNKNOWN loc_4024AE; // weak
_UNKNOWN loc_4027A6; // weak
_UNKNOWN loc_402826; // weak
_UNKNOWN loc_402CB0; // weak


//----- (00401004) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_401004(char a1@<al>, __int16 a2@<dx>, int a3@<ecx>, int a4@<ebx>)
{
  void *v4; // [esp+18h] [ebp-4h]
  void *retaddr; // [esp+1Ch] [ebp+0h]

  *(&retaddr - 8) = v4;
  HIBYTE(a2) |= a4;
  LOBYTE(a2) = HIBYTE(a2) + a2;
  LOBYTE(a4) = -(char)a4;
  HIBYTE(a2) -= a2;
  LOBYTE(a2) = a2 - a1;
  sub_401048(a2, a3, a4);
}
// 401008: positive sp value 4 has been found

//----- (00401048) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_401048(__int16 a1@<dx>, int a2@<ecx>, int a3@<ebx>)
{
  void *v3; // [esp+18h] [ebp-4h]
  void *retaddr; // [esp+1Ch] [ebp+0h]

  *(&retaddr - 8) = v3;
  LOBYTE(a1) = HIBYTE(a1);
  BYTE1(a3) -= HIBYTE(a1);
  sub_401073(a1, a2, a3);
}
// 40104C: positive sp value 4 has been found

//----- (00401073) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_401073(int a1@<edx>, int a2@<ecx>, int a3@<ebx>)
{
  void *v3; // [esp+20h] [ebp-4h]
  void *retaddr; // [esp+24h] [ebp+0h]

  *(&retaddr - 10) = v3;
  ((void (__fastcall *)(int, int))sub_40110A)(a2, a2 + a1 - a3);
  JUMPOUT(0x401063);
}
// 401077: positive sp value 4 has been found
// 4010DA: control flows out of bounds to 401063
// 40110A: using guessed type _DWORD sub_40110A();

//----- (00401129) --------------------------------------------------------
void __usercall start(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>)
{
  int v5; // ebx
  int v6; // ebx
  _DWORD *v7; // edi
  int v8; // ebx
  int v9; // eax
  _BYTE *v10; // edx
  int v11; // ecx
  char *v12; // edi
  unsigned int v13; // edi
  unsigned int v14; // esi
  int v15; // edi
  int v16; // ebx
  int v17; // esi
  _BYTE *v18; // edx

  v7 = (_DWORD *)(a5 ^ a4);
  v8 = a2 | a3;
  sub_4011BE(a2, a1 - 1);
  BYTE1(v11) += *v10;
  *v7 = v9;
  v12 = (char *)v7 + (_DWORD)v10++ + 4;
  v13 = (unsigned int)&v12[(_DWORD)v10];
  v18 = v10 + 1;
  v14 = v13;
  v15 = v8 ^ v13;
  v16 = v9 | v8;
  v17 = v16 ^ v14;
  LOBYTE(v18) = BYTE1(v11) ^ (unsigned __int8)v18;
  if ( !__SETP__((_BYTE)v18, 0) && __SETP__((_BYTE)v18, 0) )
  {
    LOBYTE(v11) = -106;
    v6 = v15 | v16;
    if ( !__OFSUB__(v17, v15 - (_DWORD)v18) && __OFSUB__(v17, v15 - (_DWORD)v18) )
      JUMPOUT(0x401124);
    v5 = v11 ^ v6;
    if ( !__SETP__(v9 | v5, 0) && __SETP__(v9 | v5, 0) )
      JUMPOUT(0x401106);
    JUMPOUT(0x40119B);
  }
  JUMPOUT(0x4010A9);
}
// 401162: control flows out of bounds to 401167
// 401102: control flows out of bounds to 401106
// 401122: control flows out of bounds to 401124
// 40114F: control flows out of bounds to 4010A9
// 4010F1: control flows out of bounds to 40119B
// 40113C: variable 'v10' is possibly undefined
// 40113C: variable 'v11' is possibly undefined
// 40113E: variable 'v9' is possibly undefined

//----- (004011BE) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_4011BE(int a1, __int32 a2)
{
  __int32 v2; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v2, a2);
  JUMPOUT(0x40113F);
}
// 401024: positive sp value 4 has been found
// 401033: control flows out of bounds to 40113F

//----- (00401E9E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401E9E(char a1@<ah>, char a2@<dl>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  int v6; // ebx
  int v7; // ebx
  bool v8; // cc
  int v9; // ecx
  int v10; // ecx
  __int64 v11; // rax
  int v12; // ecx

  LOBYTE(a4) = -(char)a4;
  v6 = a4 + 1;
  v9 = a6 + a3;
  LOBYTE(v9) = v6 | v9;
  v7 = a5 ^ v6;
  LOBYTE(v7) = a1 | v7;
  v8 = __CFADD__(a2, (_BYTE)v9) || a2 + (_BYTE)v9 == 0;
  LOBYTE(v9) = a2 + v9;
  if ( !v8 && v8 )
    __asm { retn }
  LOBYTE(v7) = -(char)v7;
  LOBYTE(v9) = a2 ^ v9;
  v10 = v9 - v7 - (v7 - 1);
  LOBYTE(v10) = v10 - a2;
  v11 = ((__int64 (__thiscall *)(int))loc_4027A6)(v10);
  sub_4029B2(v12, SHIDWORD(v11));
}
// 401EA2: positive sp value 4 has been found
// 401EBE: unbalanced stack, ignored a potential tail call
// 4029AD: variable 'v12' is possibly undefined

//----- (00401EDA) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401EDA(__int16 a1@<ax>, int a2@<edx>, int a3@<ecx>, char a4@<bl>, int a5@<edi>)
{
  int v5; // edi
  int v6; // ecx
  __int16 v7; // bx

  v5 = a2 | a5;
  LOBYTE(a3) = 92;
  v6 = v5 | a3;
  BYTE1(v6) |= HIBYTE(a1);
  HIBYTE(v7) = a4 ^ 0x34;
  LOBYTE(v7) = a1 | a4;
  sub_40292E((_DWORD *)v5, a1, v6, v7);
  JUMPOUT(0x402662);
}
// 402697: positive sp value 28CA has been found
// 40265D: control flows out of bounds to 402662
// 401EF9: conditional instruction was optimized away because ch.1!=0

//----- (00401F6D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401F6D()
{
  void *v0; // [esp+4h] [ebp-4h]
  void *retaddr; // [esp+8h] [ebp+0h]

  *(&retaddr - 3) = v0;
  JUMPOUT(0x402877);
}
// 401F71: positive sp value 4 has been found
// 401F7E: control flows out of bounds to 402877

//----- (00401FB4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __thiscall sub_401FB4(void **this)
{
  sub_402B70(this);
  JUMPOUT(0x401FCE);
}
// 401FB8: positive sp value 4 has been found
// 401FC9: control flows out of bounds to 401FCE

//----- (0040204E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40204E()
{
  JUMPOUT(0x402A21);
}
// 402052: positive sp value 4 has been found
// 40205B: control flows out of bounds to 402A21

//----- (00402100) --------------------------------------------------------
#error "402135: cannot convert to microcode (funcsize=27)"

//----- (004021A5) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4021A5()
{
  JUMPOUT(0x4029E9);
}
// 4021AD: positive sp value 4 has been found
// 4021B7: control flows out of bounds to 4029E9

//----- (00402365) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402365()
{
  __asm { repne pop eax }
  if ( !_EAX )
    JUMPOUT(0x4024C9);
  JUMPOUT(0x401F10);
}
// 40236A: positive sp value 4 has been found
// 402B42: control flows out of bounds to 4024C9
// 402374: control flows out of bounds to 401F10
// 402AAC: conditional instruction was optimized away because bl.1!=0

//----- (00402383) --------------------------------------------------------
void __usercall sub_402383(char a1@<al>, int a2@<ecx>, int a3@<edi>)
{
  int v3; // ecx

  v3 = a3 | a2;
  LOBYTE(v3) = v3 - (a1 | 0x96);
  sub_402CEC(v3);
  JUMPOUT(0x402B95);
}
// 402DC7: control flows out of bounds to 402B95
// 402CEC: using guessed type int __thiscall sub_402CEC(_DWORD);

//----- (004023F3) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4023F3()
{
  JUMPOUT(0x402D76);
}
// 402016: positive sp value 4 has been found
// 40202A: control flows out of bounds to 402D76

//----- (00402438) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402438(int _EAX@<eax>, void **a2@<ecx>, __int32 a3@<ebx>, double a4@<st0>)
{
  int v5; // eax
  int v6; // ecx
  __int32 v7; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v7, a3);
  __asm { rep mov eax, eax }
  sub_401FB4(a2);
  *(_QWORD *)(v5 + 83) = (__int64)a4;
  v7 = *(_DWORD *)(v6 + 16);
  JUMPOUT(0x402AD4);
}
// 40243F: positive sp value 4 has been found
// 402463: control flows out of bounds to 402AD4
// 40244F: variable 'v5' is possibly undefined
// 402459: variable 'v6' is possibly undefined

//----- (004024EC) --------------------------------------------------------
#error "402DF3: cannot convert to microcode (funcsize=50)"

//----- (00402534) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402534()
{
  JUMPOUT(0x402766);
}
// 401FEB: positive sp value 4 has been found
// 4022DF: control flows out of bounds to 4022E4
// 401FF9: control flows out of bounds to 402766

//----- (00402551) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402551()
{
  void *v0; // [esp+4h] [ebp-4h]
  void *retaddr; // [esp+8h] [ebp+0h]

  *(&retaddr - 3) = v0;
  JUMPOUT(0x40211F);
}
// 402555: positive sp value 4 has been found
// 402562: control flows out of bounds to 40211F

//----- (004025C9) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4025C9(int a1@<eax>, __int16 a2@<dx>, int a3@<edi>, int a4@<esi>)
{
  int v4; // ecx
  void *v5; // [esp+8h] [ebp-4h]
  void *retaddr; // [esp+Ch] [ebp+0h]

  *(&retaddr - 4) = v5;
  if ( !((a3 - a4 + 1 < 0) ^ __OFADD__(1, a3 - a4) | (a3 - a4 == -1))
    && (a3 - a4 + 1 < 0) ^ __OFADD__(1, a3 - a4) | (a3 - a4 == -1) )
  {
    __outbyte(a2 + 1, a1);
    JUMPOUT(0x4025EE);
  }
  v4 = a1;
  LOBYTE(v4) = a1 - a2;
  ((void (__thiscall *)(int))loc_402CB0)(v4);
  __halt();
}
// 40227F: positive sp value 4 has been found
// 4025E9: control flows out of bounds to 4025EE

//----- (004028DA) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4028DA()
{
  __int16 v0; // dx

  ((void (*)(void))loc_4024AE)();
  __inbyte(v0 + 1);
  JUMPOUT(0x4028F5);
}
// 4028DE: positive sp value 4 has been found
// 4028F0: control flows out of bounds to 4028F5
// 4028EE: variable 'v0' is possibly undefined

//----- (0040292E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
unsigned int __usercall sub_40292E@<eax>(_DWORD *a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>)
{
  int v4; // ebx
  int v5; // ecx
  int v7; // ebx
  __int64 v9; // rax
  int v10; // ecx
  int v11; // esi
  unsigned int v12; // edi
  _DWORD *v13; // [esp+14h] [ebp-4h]

  v7 = a4 + 1 - a2;
  LOBYTE(a3) = (unsigned __int8)a1 ^ a3;
  v9 = ((__int64 (__thiscall *)(int))sub_402100)(a3);
  *v13 = *a1;
  HIDWORD(v9) -= v7;
  v11 = v7 - 1;
  BYTE1(v9) |= BYTE1(v10);
  BYTE4(v9) = BYTE5(v9);
  v12 = (unsigned int)v13 + v9 + 4;
  LOBYTE(v7) = -(char)v7;
  v4 = v12 ^ v7;
  v5 = HIDWORD(v9) + v4 + v10;
  BYTE1(v5) = -85;
  --v4;
  BYTE1(v4) = (v9 - 85) ^ -BYTE1(v4);
  return HIDWORD(v9) + (v4 ^ v5 ^ (v9 + v12) ^ v11);
}
// 402936: positive sp value 8 has been found
// 4025C7: control flows out of bounds to 4025C8
// 402944: variable 'v13' is possibly undefined
// 40294B: variable 'v10' is possibly undefined
// 402100: using guessed type _DWORD sub_402100();

//----- (004029B2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_4029B2(int a1, __int32 a2)
{
  __int32 v2; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v2, a2);
  JUMPOUT(0x4029C4);
}
// 4029B9: positive sp value 4 has been found
// 4029C2: control flows out of bounds to 4029C4

//----- (00402A02) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402A02(char a1@<al>, int a2@<edx>, int a3@<ecx>)
{
  int v3; // ecx
  int v4; // eax

  v3 = a2 | a3;
  LOBYTE(v3) = a1 | a2;
  v4 = ((int (__thiscall *)(int))((char *)&loc_402826 + 4))(v3);
  *(_DWORD *)(v4 - 1965388837) <<= 7;
  JUMPOUT(0x402BF5);
}
// 402A06: positive sp value 4 has been found
// 402A30: control flows out of bounds to 402BF5

//----- (00402B03) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402B03()
{
  JUMPOUT(0x402C18);
}
// 402B12: positive sp value 8 has been found
// 402B16: control flows out of bounds to 402C18

//----- (00402B70) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __thiscall sub_402B70(void **this)
{
  void *v1; // [esp+24h] [ebp-4h]
  void *retaddr; // [esp+28h] [ebp+0h]

  *(&retaddr - 11) = v1;
  v1 = *this;
  JUMPOUT(0x402C5B);
}
// 402B74: positive sp value 4 has been found
// 402BA8: control flows out of bounds to 402BAA
// 402B80: control flows out of bounds to 402C5B
// 402B8A: conditional instruction was optimized away because ebx.4!=0

//----- (00402C34) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402C34(int a1@<edx>, __int32 a2@<ecx>, unsigned __int8 a3@<bl>, _BYTE *a4@<edi>, int a5@<esi>)
{
  int v6; // esi
  bool v7; // zf
  __int32 v8; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v8, a2);
  __asm { rep pop ecx }
  v6 = a5 - 1;
  if ( a1 + v6 < 0 == __OFADD__(a1, v6) && a1 + v6 < 0 != __OFADD__(a1, v6) )
  {
    do
    {
      if ( !_ECX )
        break;
      v7 = *a4++ == a3;
      --_ECX;
    }
    while ( v7 );
    sub_402B03();
    JUMPOUT(0x401F05);
  }
  JUMPOUT(0x402CD5);
}
// 402C39: positive sp value 4 has been found
// 402C7E: control flows out of bounds to 401F05
// 402C45: control flows out of bounds to 402CD5

//----- (00402CEC) --------------------------------------------------------
#error "4020F1: cannot convert to microcode (funcsize=49)"

//----- (00402D3E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402D3E()
{
  JUMPOUT(0x402C73);
}
// 402D4D: positive sp value 8 has been found
// 402D4D: control flows out of bounds to 402C73

//----- (00402D8E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402D8E(int a1@<edx>, int a2@<ecx>, int a3@<ebx>)
{
  int v3; // ecx

  v3 = a2 - a1;
  if ( a3 != -239548853 )
  {
    LOBYTE(v3) = a1 + v3;
    ((void (__thiscall *)(int))loc_4022E4)(v3);
    JUMPOUT(0x402155);
  }
  JUMPOUT(0x402946);
}
// 402147: positive sp value 4 has been found
// 402150: control flows out of bounds to 402155
// 402DAA: control flows out of bounds to 402946

// nfuncs=31 queued=30 decompiled=30 lumina nreq=0 worse=0 better=0
#error "There were 3 decompilation failure(s) on 30 function(s)"
