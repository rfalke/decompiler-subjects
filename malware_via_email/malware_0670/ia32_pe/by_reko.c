// subject_rsec.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw40A078 = 0xA0AD; // 0040A078
word32 g_dw40A07C = 41151; // 0040A07C
word32 g_dw40A080 = 41166; // 0040A080
word32 g_dw40A084 = 0xA0E1; // 0040A084
word32 g_dw40A088 = 0xA0F3; // 0040A088
word32 g_dw40A08C = 0xA104; // 0040A08C
word32 g_dw40A094 = 0xA11F; // 0040A094
word32 g_dw40A098 = 41262; // 0040A098
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401005: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	word32 ebp;
	word32 dwLoc2C;
	word32 ebp_129;
	fn004010D0(ebp, (word16) dwLoc2C, out ebp_129);
	word32 ebp_141;
	return fn004010D0(ebp_129, 0x00, out ebp_141);
}

// 004010D0: Register word32 fn004010D0(Register word32 ebp, Stack word16 wArg00, Register out ptr32 ebpOut)
// Called from:
//      Win32CrtStartup
word32 fn004010D0(word32 ebp, word16 wArg00, ptr32 & ebpOut)
{
	ptr32 fp;
	struct Eq_21 * fs;
	word32 dwArg00;
	word32 dwLoc30;
	struct Eq_24 * dwLoc0134;
	int32 dwLoc0130;
	word16 eax_16_16_27 = SLICE(dwArg00, word16, 16);
	word32 eax_42 = SEQ(eax_16_16_27, 0x00);
	struct Eq_31 * ebx_141;
	word32 ecx_142;
	up32 eax_140 = fn0040168E((word16) dwLoc30, out ecx_142, out ebx_141);
	word32 eax_171;
	word32 ecx_173;
	ebx_141->ptr0018();
	struct Eq_48 * esp_180;
	<unknown> Eq_21::* eax_181;
	word32 ecx_183;
	ebx_141->ptr001C();
	word16 ecx_16_16_209 = SLICE(ecx_183, word16, 16);
	uint32 esi_198 = (uint32) ((&(fs->*((char *) eax_181 + 4)))[(char *) eax_181 + 6].w0000 + 0x02);
	esp_180->ptrFFFFFFFC = (<unknown> Eq_21::*) ((char *) eax_181 + 6);
	esp_180->ptrFFFFFFF8 = (<unknown> Eq_21::*) ((char *) eax_181 + 6);
	struct Eq_76 * esp_210;
	struct Eq_31 * eax_211;
	word32 ecx_213;
	ebx_141->ptr0000();
	esp_210->ptr0038 = ebx_141;
	esp_210->dw003C = esi_198 - 0x01;
	esp_210->ptrFFFFFFFC = ebx_141;
	esp_210->ptrFFFFFFFC -= 0x04;
	word16 ecx_16_16_274 = SLICE(ecx_213, word16, 16);
	struct Eq_31 * edi_235 = esp_210->ptrFFFFFFFC;
	esp_210->ptrFFFFFFFC = eax_211;
	esp_210->dwFFFFFFF8 = ecx_213;
	esp_210->ptrFFFFFFF4 = esp_210 - 8;
	esp_210->dwFFFFFFF0 = 0x40;
	esp_210->dwFFFFFFEC = esp_210->dw0020;
	esp_210->dwFFFFFFE8 = esp_210->dw0014;
	esp_210->dw0018 = 0x00;
	struct Eq_138 * esp_275;
	struct Eq_139 Eq_21::* eax_276;
	edi_235->ptr0010();
	struct Eq_143 * eax_284 = eax_276 + (fs->*eax_276).dw002F / 0x0033;
	word32 ecx_289 = eax_284->dw0003;
	esp_275->dw0030 += ecx_289;
	esp_275->ptr0000 = eax_284;
	esp_275->ptr0004 = esp_275->ptr0000;
	struct Eq_143 * edi_307 = esp_275->ptr0008;
	esp_275->ptr0008 = esp_275->ptr0004;
	esp_275->ptr000C = esp_275->ptr0008;
	struct Eq_143 * eax_319 = esp_275->ptr000C;
	esp_275->ptr0010 = (struct Eq_143 *) &eax_319->dw0003;
	struct Eq_143 * eax_328 = esp_275->ptr0010;
	Eq_194 ecx_330 = eax_328->t0000.u1;
	esp_275->ptr0010 = eax_328;
	struct Eq_143 * eax_334 = esp_275->ptr0010;
	esp_275->dw003C = esp_275->dw003C ^ ecx_330;
	esp_275->ptr0010 = eax_334;
	esp_275->ptr0010 = esp_275->ptr001C;
	word32 ecx_352 = esp_275->dw002C;
	struct Eq_143 * eax_350 = esp_275->ptr0010;
	word16 ecx_16_16_432 = SLICE(ecx_352, word16, 16);
	esp_275->ptrFFFFFF0C = eax_350;
	esp_275->ptrFFFFFF08 = eax_350;
	struct Eq_143 * eax_359 = esp_275->ptrFFFFFF08;
	esp_275->dwFFFFFF10 = ecx_352;
	esp_275->ptrFFFFFF08 = eax_359;
	esp_275->ptrFFFFFF08 = edi_307;
	struct Eq_143 * eax_369 = null;
	do
	{
		esp_275->ptrFFFFFF04 = eax_369;
		struct Eq_143 * eax_379 = esp_275->ptrFFFFFF04;
		eax_369[(esp_275 - 0xEC) / 7] = (struct Eq_143) (byte) eax_379;
		esp_275->ptrFFFFFF04 = eax_379;
		esp_275->ptrFFFFFF04 = (struct Eq_143 *) ((char *) &esp_275->ptrFFFFFF04->t0000 + 1);
		struct Eq_143 * eax_393 = esp_275->ptrFFFFFF04;
		esp_275->ptrFFFFFF04 = eax_393;
		eax_369 = esp_275->ptrFFFFFF04;
	} while (eax_393 < (struct Eq_143 *) 0x0100);
	esp_275->ptrFFFFFF04 = eax_369;
	esp_275->ptrFFFFFF08 = esp_275->ptrFFFFFF04;
	esp_275->ptrFFFFFF08 = (struct Eq_143 *) (&esp_275->dw003C + 2);
	struct Eq_143 * eax_418 = esp_275->ptrFFFFFF08;
	esp_275->ptrFFFFFF08 = eax_418;
	struct Eq_143 * eax_424 = esp_275->ptrFFFFFF08;
	if (eax_418->t0000.u0 != 121)
	{
		struct Eq_315 * edi_427 = eax_424->ptrFFFFFFFC;
		do
		{
			word32 eax_439;
			word32 ecx_441;
			edi_427->ptr0018();
			word16 ecx_16_16_444 = SLICE(ecx_441, word16, 16);
			struct Eq_326 * esp_445;
			word32 eax_446;
			word32 ecx_448;
			edi_427->ptr0018();
			esp_445->dwFFFFFFFC = eax_446;
			struct Eq_335 * esp_457;
			word32 eax_458;
			word32 ecx_460;
			edi_427->ptr0018();
			esp_457->dwFFFFFFFC = eax_458;
			struct Eq_344 * esp_469;
			word32 eax_470;
			word32 ecx_472;
			edi_427->ptr0018();
			esp_469->dwFFFFFFFC = eax_470;
			struct Eq_353 * esp_481;
			word32 eax_482;
			word32 ecx_484;
			edi_427->ptr0018();
			esp_481->dwFFFFFFFC = eax_482;
			struct Eq_362 * esp_493;
			word32 eax_494;
			word32 ecx_496;
			edi_427->ptr0018();
			esp_493->dwFFFFFFFC = eax_494;
			struct Eq_371 * esp_505;
			word32 eax_506;
			word32 ecx_508;
			edi_427->ptr0018();
			esp_505->dwFFFFFFFC = eax_506;
			struct Eq_380 * esp_517;
			word32 eax_518;
			word32 ecx_520;
			edi_427->ptr0010();
			esp_517->dwFFFFFFFC = eax_518;
			word16 cx_533 = (word16) ecx_520;
			ecx_16_16_432 = SLICE(ecx_520, word16, 16);
			word32 eax_526 = esp_517->dwFFFFFFFC;
			word16 ax_532 = (word16) eax_526 + 0x01;
			word16 eax_16_16_538 = SLICE(eax_526 + 0x01, word16, 16);
			cup16 ax_534 = ax_532 - cx_533;
			eax_424 = SEQ(eax_16_16_538, ax_534);
		} while (ax_534 < 0x00);
	}
	int32 esi_574 = 0x00;
	int32 ebp_580 = 0x00;
	Eq_400 eax_596 = 0x00;
	do
	{
		word32 ebx_601 = (word32) (fp - 300)[ebp_580];
		word32 edx_633 = (word32) *((word32) eax_596 + dwLoc0130) + (ebx_601 + esi_574);
		byte bl_696 = (byte) ebx_601;
		byte dl_641 = (byte) edx_633;
		word16 edx_16_16_642 = SLICE(edx_633, word16, 16);
		int32 edx_643 = SEQ(edx_16_16_642, 0x00, dl_641);
		esi_574 = edx_643;
		Eq_400 eax_650 = (word32) eax_596 + 1;
		if ((word32) eax_596 + 1 >= eax_140)
			eax_650.u0 = 0x00;
		*((word32) (fp - 300) + ebp_580) = *((word32) (fp - 300) + edx_643);
		++ebp_580;
		ptr32 edx_686 = fp - 300 + edx_643;
		ptr32 edx_687 = edx_686 - eax_650;
		*((word32) eax_650.u0 + edx_687) = SEQ(*((word32) ((word32) eax_650.u0 + 1) + edx_687), bl_696);
		eax_596 = eax_650;
	} while (SLICE(ebp_580, byte, 8) != 0x01);
	word32 esi_725 = 0x00;
	ptr32 ebp_740 = fp - 40;
	struct Eq_24 * edi_741 = dwLoc0134;
	int32 eax_751 = 0x00;
	if (fp > 0x28)
	{
		do
		{
			word32 eax_759 = eax_751 + 0x01;
			int32 eax_770 = SEQ(SLICE(eax_759, word16, 16), 0x00, (byte) eax_759);
			byte cl_771 = *((word32) (fp - 300) + eax_770);
			uint32 ebx_783 = (uint32) cl_771;
			uint32 ebx_785 = ebx_783 + esi_725;
			byte bl_791 = (byte) ebx_785;
			word16 ebx_16_16_792 = SLICE(ebx_785, word16, 16);
			word32 ebx_793 = SEQ(ebx_16_16_792, 0x00, bl_791);
			byte dl_795 = *((word32) (fp - 320) + (ebx_793 + 20));
			(fp - 300)[eax_770] = dl_795;
			*((word32) (fp - 320) + (ebx_793 + 20)) = (ptr32) cl_771;
			word32 edx_828 = (word32) dl_795;
			byte dl_829 = (byte) edx_828;
			word24 edx_24_8_832 = SLICE(edx_828, word24, 8);
			word32 edx_833 = SEQ(edx_24_8_832, dl_829 + cl_771);
			edi_741->wFFFFFFFF = edi_741->wFFFFFFFF ^ *((word32) (fp - 320) + (edx_833 + 0x14)) << 0x08;
			esi_725 = ebx_793;
			++edi_741;
			--ebp_740;
			eax_751 = eax_770;
		} while (ebp_740 != 0x00);
	}
	ebpOut = ebp + 0x01;
	return 0x00FF0006;
}

// 0040168E: Register ptr32 fn0040168E(Stack word16 wArg00, Register out Eq_37 ecxOut, Register out ptr32 ebxOut)
// Called from:
//      fn004010D0
ptr32 fn0040168E(word16 wArg00, union Eq_37 & ecxOut, ptr32 & ebxOut)
{
	word32 dwArg00;
	word32 eax_160 = dwArg00;
	while (true)
	{
		word16 eax_16_16_38 = SLICE(eax_160, word16, 16);
		word16 ax_58 = *SEQ(eax_16_16_38, 0x00);
		word32 eax_64 = SEQ(eax_16_16_38, ax_58 + 42421);
		word24 eax_24_8_73 = SLICE(eax_64, word24, 8);
		if (ax_58 == 23117)
			break;
		eax_160 = eax_64 - 0x00010000;
	}
	struct Eq_564 * eax_85 = SEQ(SLICE(eax_24_8_73, word16, 8), 0x00, 0x00);
	Eq_37 ecx_131 = eax_85[(&(eax_85 + eax_85->dw003C / 64)->dw003C)[0x0011] / 64];
	word32 eax_137 = eax_85 + ecx_131;
	ecxOut = ecx_131;
	ebxOut = eax_137 + 0x04;
	return eax_137 + 0x04;
}

