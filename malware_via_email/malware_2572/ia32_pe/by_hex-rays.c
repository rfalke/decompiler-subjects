/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// BOOL __stdcall WriteFile(HANDLE hFile, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite, LPDWORD lpNumberOfBytesWritten, LPOVERLAPPED lpOverlapped);
// int __stdcall SetConsolePalette(_DWORD, _DWORD, _DWORD); weak
// DWORD __stdcall GetFileSize_0(HANDLE hFile, LPDWORD lpFileSizeHigh);
// int __usercall start@<eax>(int a1@<edx>, int a2);
// int __usercall sub_4011A8@<eax>(_DWORD *a1@<ebp>, int a2@<edi>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_4012B0; // weak
char byte_4023F7 = 'D'; // weak
int dword_403AD1 = 1481986816; // weak
_UNKNOWN unk_403CD8; // weak
int dword_403DF0 = 1649762913; // weak
int (*off_404602)(void) = &sub_4011A8; // weak
int dword_4047F8 = 1358954496; // weak
_UNKNOWN unk_404D86; // weak
_UNKNOWN unk_404FCF; // weak
int dword_40FB90; // weak
int dword_40FE16; // weak
int dword_40FF2A; // weak
int dword_40FF9D; // weak
int dword_40FFC0; // weak


//----- (00401138) --------------------------------------------------------
int __usercall start@<eax>(int a1@<edx>, int a2)
{
  int v2; // ebx
  int v3; // ecx
  int result; // eax
  DWORD *v5; // [esp+Ch] [ebp-2Ch]
  struct _OVERLAPPED *v6; // [esp+10h] [ebp-28h]
  int v7; // [esp+14h] [ebp-24h]

  v2 = a2;
  if ( dword_4047F8 + a1 == a2 )
    v2 = (int)v6 + a2;
  dword_40FE16 = (int)v6;
  off_404602();
  dword_40FF2A = v3;
  WriteFile(&byte_4023F7, &byte_4023F7, (DWORD)&byte_4023F7, v5, v6);
  result = v7;
  dword_40FFC0 = v2;
  return result;
}
// 401138: could not find valid save-restore pair for ebx
// 401164: variable 'v6' is possibly undefined
// 401189: variable 'v3' is possibly undefined
// 401193: variable 'v5' is possibly undefined
// 40119D: variable 'v7' is possibly undefined
// 4023F7: using guessed type char byte_4023F7;
// 404602: using guessed type int (*off_404602)(void);
// 4047F8: using guessed type int dword_4047F8;
// 40FE16: using guessed type int dword_40FE16;
// 40FF2A: using guessed type int dword_40FF2A;
// 40FFC0: using guessed type int dword_40FFC0;

//----- (004011A8) --------------------------------------------------------
int __usercall sub_4011A8@<eax>(_DWORD *a1@<ebp>, int a2@<edi>)
{
  int v2; // edx
  LPDWORD v3; // ecx

  SetConsolePalette(&unk_404FCF, &unk_404D86, &unk_403CD8);
  dword_40FF9D = dword_403DF0;
  if ( (v2 & a2) == 0 )
    a1[3] -= a2;
  *a1 = ((int (*)(void))loc_4012B0)();
  GetFileSize_0("54CF0", v3);
  ++dword_40FB90;
  return dword_403AD1;
}
// 4011FE: variable 'v2' is possibly undefined
// 40122A: variable 'v3' is possibly undefined
// 401058: using guessed type int __stdcall SetConsolePalette(_DWORD, _DWORD, _DWORD);
// 403AD1: using guessed type int dword_403AD1;
// 403DF0: using guessed type int dword_403DF0;
// 40FB90: using guessed type int dword_40FB90;
// 40FF9D: using guessed type int dword_40FF9D;

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
