/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __stdcall start(int a1, int a2, int a3, int a4, int a5, int a6);
int sub_401D25();
// LPVOID __stdcall MapViewOfFileEx(HANDLE hFileMappingObject, DWORD dwDesiredAccess, DWORD dwFileOffsetHigh, DWORD dwFileOffsetLow, SIZE_T dwNumberOfBytesToMap, LPVOID lpBaseAddress);
// LPVOID __stdcall MapViewOfFile(HANDLE hFileMappingObject, DWORD dwDesiredAccess, DWORD dwFileOffsetHigh, DWORD dwFileOffsetLow, SIZE_T dwNumberOfBytesToMap);
// LPVOID __stdcall VirtualAlloc(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);


//----- (00401D12) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __stdcall start(int a1, int a2, int a3, int a4, int a5, int a6)
{
  return sub_401D25();
}
// 401D22: positive sp value 4 has been found

//----- (00401D25) --------------------------------------------------------
int sub_401D25()
{
  int v0; // esi
  unsigned int v1; // eax
  char v2; // bl
  int (*v3)(void); // edi
  char *v4; // esi
  int v5; // ecx
  int v6; // edx
  int v7; // ebp
  char v8; // bh
  char *v9; // eax
  int v11; // [esp+8h] [ebp-Ch]
  DWORD flProtect; // [esp+Ch] [ebp-8h]
  char v13; // [esp+10h] [ebp-4h]
  int (*v14)(void); // [esp+10h] [ebp-4h]
  char *retaddr; // [esp+14h] [ebp+0h]

  v0 = 0;
  do
  {
    v1 = (unsigned int)MapViewOfFileEx(0, 0x269F48u, 0x1Au, 0xFFFF81u, 0xA17063u, (LPVOID)0x1C);
    v0 += v1 | 0xA5;
    v13 = v1 | 0xA5;
    MapViewOfFile(0, 0x871B8Au, 0x19u, 0xFFF24Eu, 0xDA8AF4u);
  }
  while ( v0 < 178282385 );
  v2 = v13;
  v3 = (int (*)(void))VirtualAlloc(0, 0x12D07u, 0x3000u, 0x40u);
  v4 = retaddr + 283;
  v14 = v3;
  v5 = 486;
  v6 = 2085284988;
  v7 = 0;
  do
  {
    v8 = *v4++ + v6;
    *(_BYTE *)v3 = v8;
    *(_BYTE *)v3 += v2;
    v3 = (int (*)(void))((char *)v3 + 1);
    flProtect = v6;
    v11 = v5;
    v9 = (char *)MapViewOfFileEx(0, 0x58A1FCu, 0x14u, 0xFFF228u, 4u, (LPVOID)0x11);
    v6 = flProtect >> 8;
    if ( (char *)++v7 == v9 + 4 )
    {
      v6 = 2085284988;
      v7 = 0;
    }
    v5 = v11 - 1;
  }
  while ( v11 != 1 );
  return v14();
}

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
