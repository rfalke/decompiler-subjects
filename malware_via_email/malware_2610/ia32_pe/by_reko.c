// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401024: Register word32 fn00401024(Register byte al, Register (ptr Eq_4) ecx, Register byte dh, Register byte dl, Register (ptr Eq_7) ebx, Register ui32 ebp, Register (ptr Eq_9) esi, Register (ptr byte) edi, Stack word32 dwArg00, Stack word32 dwArg02, Stack word32 dwArg04, Stack word32 dwArg0C, Stack word32 dwArg10, Stack word32 dwArg14, Stack word32 dwArg18, Stack word32 dwArg1C, Stack word32 dwArg20, Stack word32 dwArg24, Stack word32 dwArg2C, Stack ptr32 dwArg30, Stack word32 dwArg34, Stack word32 dwArg38, Register out ptr32 ebpOut)
word32 fn00401024(byte al, Eq_4 * ecx, byte dh, byte dl, Eq_7 * ebx, ui32 ebp, Eq_9 * esi, byte * edi, word32 dwArg00, word32 dwArg02, word32 dwArg04, word32 dwArg0C, word32 dwArg10, word32 dwArg14, word32 dwArg18, word32 dwArg1C, word32 dwArg20, word32 dwArg24, word32 dwArg2C, ptr32 dwArg30, word32 dwArg34, word32 dwArg38, ptr32 & ebpOut)
{
	*edi = esi->b0000;
	byte dh_8 = dh - al - C;
	byte al_28 = __inb(~0x34);
	struct Eq_42 * edx_10 = DPB(edx, dh_8, 8);
	word16 ax_32 = DPB(ax, al_28, 0);
	if (dh_8 == 0x00)
	{
		struct Eq_50 * edi_106 = edx_10->dw0000 *s 122;
		if (P)
		{
			byte al_192 = (byte) ebx;
			byte ah_195 = SLICE(ebx, byte, 8);
			struct Eq_265 ** esp_199 = (char *) fp + 0x04;
			if (esi + 0x01 + Mem23[esi + 1430344103:word32] >u 0x00)
			{
				ebx->a0028[ebx].w0000 = __fstcw();
				ui32 ecx_270 = ecx | ecx->dw2B150162;
				word32 eax_274 = (word32) (ebx[ebp * 0x08 / 0x0028] *s ebx);
				byte cl_271 = (byte) ecx_270;
				struct Eq_265 ** esp_284 = (char *) fp + 0x02;
				byte dh_287 = SLICE(eax_274 + 0x01, byte, 8);
				if (((byte) (eax_274 + 0x01) | 0x0F) < 0x00)
				{
					struct Eq_334 * ecx_329 = DPB(ecx_270, cl_271 - SLICE(dwArg00, byte, 8), 0);
					uint32 v49_333 = ecx_329 + ecx_329->dw61DFB0D2 / 0x61DFB0D6;
					ecx_329->dw61DFB0D2 = v49_333;
					esp_284 = fp;
					if (dh_287 - ~0x02 - (v49_333 < 0x00) == 0x00)
						;
				}
				*(esp_284 - 0x04) = 0x04;
			}
			else
			{
				struct Eq_226 * ebp_202 = ebp - ((ebx->aB980B8BD))[ebx].dw0000;
				ebp_202->b0027 = ebp_202->b0027 & ~0x25;
				__cli();
				struct Eq_244 * ecx_201 = DPB(ecx, 0x41, 0);
				struct Eq_247 * edx_206 = DPB(edx_10, dl - ch, 0);
				struct Eq_251 * ebx_212 = DPB(ebx, ~0x62, 8);
				struct Eq_254 * eax_214 = DPB(ebx, ah_195 ^ 0x38, 8);
				if (!P)
				{
					esp_199 = fp;
					eax_214 = ecx_201 - 0x5A;
					al_192 = (byte) (ecx_201 - 0x5A);
				}
				edi_106->dw0000 = edx_206 + edi_106->dw0000 / 0x0068;
				struct Eq_265 * edx_233 = *esp_199;
				ebx_212->a0000[0x00].b0000 = (byte) (ebx_212->a0000[0x00].b0000 - 0x40);
				ptr32 esp_238 = (char *) esp_199 + 0x04;
				*(esp_238 - 0x04) = esp_238;
				word16 dx_237 = (word16) edx_233;
				if ((eax_214 & 1421994796) >= 0x00)
				{
					edx_233->dw0017 = edx_233->dw0017 ^ ebp_202;
					__outb(~0x0E, al_192);
				}
				else
				{
					struct Eq_308 * edx_248 = DPB(edx_233, 151, 0);
					edx_248->b0000 = edx_248->b0000 | ~0x62;
					edi_106->dw0000 = __in(DPB(dx_237, 151, 0));
				}
			}
		}
		else
		{
			edi_106->dw95E37419 = edi_106->dw95E37419 ^ ebp;
			word16 ax_114 = __aad(ax_32);
			struct Eq_112 * esp_121;
			word32 ebx_122;
			byte C_123;
			byte dh_124;
			byte al_125;
			byte SCZO_126;
			word32 esi_127;
			word32 edi_128;
			byte Z_129;
			word32 ebp_130;
			word32 edx_131;
			word32 ecx_132;
			word32 eax_133;
			struct Eq_125 * ds_134;
			byte SZO_135;
			byte P_136;
			word16 ax_137;
			struct Eq_129 * cs_138;
			byte cl_139;
			byte CZ_140;
			byte dl_141;
			byte ch_142;
			byte bh_143;
			byte ah_144;
			byte SO_145;
			word16 dx_146;
			struct Eq_138 * ss_147;
			byte S_148;
			word16 si_149;
			fn00400FFB();
			return eax_133;
		}
	}
	else
	{
		(word32 *) 3832116346 = dwArg38;
		*(dwArg30 - 0x6C) = __rcr(*(dwArg30 - 0x6C), 0x53, false);
		__lock();
	}
}

// 00415F31: Register Eq_353 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetCommandLineA();
	GetLastError();
	Eq_360 eax_23 = CreateFileW(&globals->t43393D, 0x00, 0x00, null, 0x03, 0x0185, null);
	if (eax_23 == (void *) ~0x00)
	{
		CloseHandle(eax_23);
		struct Eq_418 * esp_115 = fp + ~0x67;
		Eq_360 eax_117 = CreateFileW(&globals->t433971, 0x20000000, 0x00, null, 0x03, 0xA5, null);
		if (eax_117 == (void *) ~0x00)
		{
			GetFileSize(eax_23, null);
			GetLastError();
			ptr32 esp_328 = fp + ~0x6F;
			do
			{
				GetCommandLineA();
				HANDLE * esp_335 = esp_328 - 0x04;
				*esp_335 = (HANDLE *) eax_117;
				GetFileType(*esp_335);
				GetLastError();
				GetLastError();
				*(esp_335 - 0x04) = (HANDLE *) eax_117;
				GetFileType(*(esp_335 - 0x04));
				*(esp_335 - 0x08) = 0x00;
				*(esp_335 - 0x0C) = 0x01A3;
				*(esp_335 - 0x10) = 0x03;
				*(esp_335 - 0x14) = 0x00;
				*(esp_335 - 0x18) = 0x01;
				*(esp_335 - 0x1C) = 0x60000000;
				*(esp_335 - 0x20) = 4405492;
				Eq_360 eax_358 = CreateFileA(*(esp_335 - 0x20), *(esp_335 - 0x1C), *(esp_335 - 0x18), *(esp_335 - 0x14), *(esp_335 - 0x10), *(esp_335 - 0x0C), *(esp_335 - 0x08));
				esp_328 = esp_335 - 0x20;
				dwLoc28 = eax_358;
			} while (eax_358 != (void *) ~0x00);
			*(esp_335 - 0x24) = 0x00;
			*(esp_335 - 0x28) = (HANDLE *) eax_358;
			GetFileSize(*(esp_335 - 0x28), *(esp_335 - 0x24));
			*(esp_335 - 44) = 0x00433904;
			*(esp_335 - 0x30) = 0x00;
			*(esp_335 - 0x34) = (HANDLE *) eax_117;
			GetFileSize(*(esp_335 - 0x34), *(esp_335 - 0x30));
			Eq_439 eax_376 = GetModuleHandleA(*(esp_335 - 0x34));
			*(esp_335 - 0x38) = 0x00433955;
			*(esp_335 - 0x3C) = (HMODULE *) eax_376;
			GetLastError();
			esp_115 = esp_335 - 0x3C;
		}
		GetCommandLineA();
		Eq_436 eax_127 = GetProcAddress(esp_115->t0000, esp_115->t0004);
		HANDLE * esp_130 = esp_115 - 0x04;
		*esp_130 = (HANDLE *) eax_23;
		CloseHandle(*esp_130);
		GetLastError();
		*(esp_130 - 0x04) = (HANDLE *) eax_117;
		GetFileType(*(esp_130 - 0x04));
		*(esp_130 - 0x08) = (HANDLE *) eax_23;
		GetFileType(*(esp_130 - 0x08));
		*(esp_130 - 0x0C) = 0x00;
		*(esp_130 - 0x10) = (HANDLE *) eax_23;
		GetFileSize(*(esp_130 - 0x10), *(esp_130 - 0x0C));
		GetCommandLineA();
		GetCommandLineA();
		*(esp_130 - 0x14) = 0x00;
		*(esp_130 - 0x18) = 0x00;
		*(esp_130 - 0x1C) = 0x00;
		*(esp_130 - 0x20) = (HANDLE *) dwLoc28;
		GetFileSize(*(esp_130 - 0x20), *(esp_130 - 0x1C));
		*(esp_130 - 0x24) = 0x00;
		*(esp_130 - 0x28) = (HANDLE *) dwLoc28;
		GetFileType(*(esp_130 - 0x28));
		*(esp_130 - 44) = 0x00;
		*(esp_130 - 0x30) = (HANDLE *) eax_23;
		GetFileSize(*(esp_130 - 0x30), *(esp_130 - 44));
		int32 eax_181 = eax_127();
		GetCommandLineA();
		*(esp_130 - 0x34) = (HANDLE *) eax_23;
		CloseHandle(*(esp_130 - 0x34));
		GetCommandLineA();
		*(esp_130 - 0x38) = 0x00;
		*(esp_130 - 0x3C) = 0x00;
		*(esp_130 - 0x40) = 0x03;
		*(esp_130 - 0x44) = 0x00;
		*(esp_130 - 0x48) = 0x07;
		*(esp_130 - 0x4C) = 0xA0000000;
		*(esp_130 - 0x50) = 4405549;
		Eq_360 eax_221 = CreateFileA(*(esp_130 - 0x50), *(esp_130 - 0x4C), *(esp_130 - 0x48), *(esp_130 - 0x44), *(esp_130 - 0x40), *(esp_130 - 0x3C), *(esp_130 - 0x38));
		ptr32 esp_223;
		word32 ebp_224;
		byte SCZO_225;
		word32 eax_226;
		byte Z_227;
		byte SZO_228;
		byte C_229;
		byte al_230;
		word32 ecx_231;
		byte dh_232;
		byte dl_233;
		word32 ebx_234;
		word32 esi_235;
		word32 edi_236;
		(*((word32) (eax_181 ^ 0xC0000005) + 0x00416164))();
		GetLastError();
		*(esp_223 - 0x04) = 0x00;
		*(esp_223 - 0x08) = (HANDLE *) dwLoc28;
		GetFileSize(*(esp_223 - 0x08), *(esp_223 - 0x04));
		*(esp_223 - 0x0C) = fp - 0x24;
		*(esp_223 - 0x10) = 0x00;
		*(esp_223 - 0x14) = (HANDLE *) eax_117;
		GetFileSize(*(esp_223 - 0x14), *(esp_223 - 0x10));
		*(esp_223 - 0x18) = 0x40;
		ptr32 esp_253 = esp_223 - 0x18;
		do
		{
			HANDLE * esp_257 = esp_253 - 0x04;
			*esp_257 = (HANDLE *) eax_221;
			CloseHandle(*esp_257);
			*(esp_257 - 0x04) = 0x00014EE4;
			*(esp_257 - 0x08) = (HANDLE *) eax_23;
			GetFileType(*(esp_257 - 0x08));
			*(esp_257 - 0x0C) = 0x00401000;
			*(esp_257 - 0x10) = 0x00;
			*(esp_257 - 0x14) = (HANDLE *) eax_117;
			GetFileSize(*(esp_257 - 0x14), *(esp_257 - 0x10));
			VirtualProtect(*(esp_257 - 0x14), *(esp_257 - 0x10), *(esp_257 - 0x0C), *(esp_257 - 0x08));
			*(esp_257 - 0x18) = 0x00;
			*(esp_257 - 0x1C) = 0x23;
			*(esp_257 - 0x20) = 0x03;
			*(esp_257 - 0x24) = 0x00;
			*(esp_257 - 0x28) = 0x06;
			*(esp_257 - 44) = 0xE0000000;
			*(esp_257 - 0x30) = 0x0043390E;
			esp_253 = esp_257 - 0x30;
		} while (CreateFileW(*(esp_257 - 0x30), *(esp_257 - 44), *(esp_257 - 0x28), *(esp_257 - 0x24), *(esp_257 - 0x20), *(esp_257 - 0x1C), *(esp_257 - 0x18)) != (void *) ~0x00);
		*(esp_257 - 0x34) = 0x00401000;
		*(esp_257 - 0x38) = (HANDLE *) eax_23;
		GetFileType(*(esp_257 - 0x38));
		*(esp_257 - 0x3C) = eax_181;
		*(esp_257 - 0x40) = 0x00014EE4;
		*(esp_257 - 0x44) = 0x00;
		*(esp_257 - 0x48) = (HANDLE *) eax_221;
		GetFileSize(*(esp_257 - 0x48), *(esp_257 - 0x44));
		*(esp_257 - 0x4C) = (HANDLE *) eax_117;
		GetFileType(*(esp_257 - 0x4C));
		dwLoc2C = eax_181 - ~0x40415EE4;
	}
	word32 esp_66;
	ui32 ebp_67;
	byte SCZO_68;
	word32 eax_69;
	byte Z_70;
	byte SZO_71;
	byte C_72;
	byte al_73;
	struct Eq_4 * ecx_74;
	byte dh_75;
	byte dl_76;
	struct Eq_7 * ebx_77;
	struct Eq_9 * esi_78;
	byte * edi_79;
	dwLoc2C();
	word32 ebp_93;
	return fn00401024(al_73, ecx_74, dh_75, dl_76, ebx_77, ebp_67, esi_78, edi_79, ebp, dwLoc02, dwArg00, dwArg08, dwArg0C, dwArg10, dwArg14, dwArg18, dwArg1C, dwArg20, dwArg28, dwArg2C, dwArg30, dwArg34, out ebp_93);
}

