/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

// void __usercall sub_401007(__int32 a1@<edi>);
// int __usercall sub_401024@<eax>(int a1@<eax>, char a2@<dl>, int a3@<ecx>, int a4@<ebx>);
// void __usercall __noreturn sub_401045(int a1@<eax>, __int32 a2@<edx>);
// void __usercall sub_40106C(int a1@<eax>, char a2@<dl>, int a3@<ecx>, int a4@<esi>);
// void __usercall __noreturn sub_401148(__int32 a1@<eax>);
// void __usercall sub_40119A(int a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<edi>);
void sub_40120C();
// void __usercall start(int a1@<eax>, int a2@<ebp>, int a3@<edi>);
// void __usercall __noreturn sub_401308(int a1@<eax>);
// void __usercall sub_401330(int a1@<eax>, _DWORD *a2@<ecx>, int a3@<ebx>, int a4@<esi>);
// void __usercall __noreturn sub_4013A7(int a1@<eax>);
// void __usercall sub_4013FC(char a1@<al>, char a2@<dl>, int a3@<ecx>, int a4@<esi>);
// void __usercall sub_401FE8(__int32 a1@<eax>);
void sub_40203B();
// void __usercall sub_40207A(int a1@<ecx>, int a2@<ebp>, char a3@<dil>);
// void __usercall sub_4020F7(char a1@<ah>, _BYTE *a2@<edx>, int a3@<ecx>, __int16 a4@<bx>, int a5@<edi>);
// void __usercall sub_402120(__int16 a1@<ax>, int a2@<edx>, int a3@<ecx>, char a4@<bl>, int a5@<edi>);
// void __usercall sub_40219E(int a1@<eax>, char a2@<dl>, int a3@<ecx>, int a4@<edi>, int a5@<esi>, int a6);
// void __usercall sub_40228A(char a1@<ah>, _BYTE *a2@<edx>, int a3@<ecx>, int a4@<ebx>);
void sub_4022E2();
// void __usercall sub_402363(__int16 a1@<ax>, int a2@<edx>, int a3@<ebx>, int a4@<ebp>, int a5@<edi>, char a6@<sil>);
// void __usercall sub_4023BC(char a1@<ah>, char a2@<dl>, char a3@<ch>, char a4@<bl>);
void sub_402429();
int sub_40249C();
int __fastcall sub_4024CE(int a1, __int16 a2);
// void __usercall sub_402526(__int16 a1@<bx>, __int16 a2@<di>);
// void __usercall sub_402551(char a1@<al>, int a2@<edx>, char a3@<bl>, int a4@<edi>);
void sub_40257E();
// int __usercall sub_4025C4@<eax>(int a1@<ebx>);
// int __usercall sub_402619@<eax>(unsigned int a1@<ecx>, char a2@<bl>);
// int __usercall sub_40264A@<eax>(int a1@<edx>, char a2@<bl>);
void sub_4026F8();
// int __usercall sub_402747@<eax>(char a1@<al>, int a2@<edx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>);
_DWORD nullsub_1(); // weak
void __thiscall sub_40286C(char *this);
// void __usercall sub_4028C0(char a1@<al>, int a2@<edx>, int a3@<ecx>, char a4@<bl>);
int sub_402917();
void sub_402971();
// void __usercall sub_4029EE(__int16 a1@<ax>, char a2@<cl>, __int16 a3@<di>, int a4@<esi>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401123; // weak
_UNKNOWN sub_40125E; // weak
_UNKNOWN loc_4012AE; // weak
_UNKNOWN loc_401356; // weak
_UNKNOWN loc_401448; // weak
_UNKNOWN loc_40146B; // weak
_UNKNOWN loc_40149B; // weak
_UNKNOWN loc_401FC0; // weak
_UNKNOWN loc_40204C; // weak
_UNKNOWN loc_4020CB; // weak
_UNKNOWN loc_40214D; // weak
_UNKNOWN loc_402176; // weak
_UNKNOWN loc_402237; // weak
_UNKNOWN loc_402264; // weak
_UNKNOWN loc_4022B4; // weak
_UNKNOWN loc_402305; // weak
_UNKNOWN loc_40232A; // weak
_UNKNOWN loc_40238F; // weak
_UNKNOWN loc_4023E0; // weak
_UNKNOWN loc_402475; // weak
_UNKNOWN loc_40259D; // weak
_UNKNOWN loc_4025E2; // weak
_UNKNOWN loc_402667; // weak
_UNKNOWN loc_4026CC; // weak
_UNKNOWN loc_402797; // weak
_UNKNOWN loc_4027BD; // weak
_UNKNOWN loc_40283C; // weak
_UNKNOWN loc_4029C4; // weak


//----- (00401007) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401007(__int32 a1@<edi>)
{
  __int32 v1; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v1, a1);
  JUMPOUT(0x4014BC);
}
// 40100D: positive sp value 4 has been found
// 40101F: control flows out of bounds to 4014BC

//----- (00401024) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_401024@<eax>(int a1@<eax>, char a2@<dl>, int a3@<ecx>, int a4@<ebx>)
{
  void *v5; // [esp+4h] [ebp-4h]
  void *retaddr; // [esp+8h] [ebp+0h]

  *(&retaddr - 3) = v5;
  sub_40106C(a1, a2, a3, a4 - 1);
  return MEMORY[0x7474E8E8]();
}
// 401028: positive sp value 4 has been found

//----- (00401045) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_401045(int a1@<eax>, __int32 a2@<edx>)
{
  __int32 v2; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v2, a2);
  sub_4013A7(8 * a1);
}
// 40104B: positive sp value 4 has been found

//----- (0040106C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40106C(int a1@<eax>, char a2@<dl>, int a3@<ecx>, int a4@<esi>)
{
  int v4; // ecx

  v4 = a3 + 1;
  BYTE1(v4) = v4;
  sub_4013FC(a1, a2, v4, (a1 | a4) + 1);
  MEMORY[0x24849FB9]();
  JUMPOUT(0x401094);
}
// 401070: positive sp value 4 has been found
// 40108F: control flows out of bounds to 401094

//----- (004010B1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4010B1@<eax>(unsigned int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<edi>, int a5@<esi>)
{
  void *v6; // [esp+10h] [ebp-4h]
  void *retaddr; // [esp+14h] [ebp+0h]

  *(&retaddr - 6) = v6;
  ((void (__fastcall *)(int, unsigned int, unsigned int))sub_40125E)(
    ((a3 - 2 + 1) | (a3 - 2)) + 1,
    a1 | a1 | a5 | a4 | a2,
    __readfsdword(a1));
  return MEMORY[0xFF25E825]();
}
// 4010B5: positive sp value 4 has been found
// 40125E: using guessed type int sub_40125E();

//----- (00401148) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_401148(__int32 a1@<eax>)
{
  __int32 v1; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v1, a1);
  ((void (*)(void))loc_401123)();
  MEMORY[0xFF65FA5F]();
  MEMORY[0x2484A0F0]();
  JUMPOUT(0x40117C);
}
// 401153: positive sp value 4 has been found
// 401177: control flows out of bounds to 40117C

//----- (0040119A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40119A(int a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<edi>)
{
  void *v4; // [esp+28h] [ebp-4h]
  void *retaddr; // [esp+2Ch] [ebp+0h]

  *(&retaddr - 12) = v4;
  ((void (__fastcall *)(int, int))((char *)&loc_401448 + 4))(
    a4 | (a3 + 1) | (a2 + 1) | (a4 - 1),
    ~a1 & 3 | ~a1 | (a2 - 2));
  JUMPOUT(0x4011C3);
}
// 40119E: positive sp value 4 has been found
// 4011BE: control flows out of bounds to 4011C3

//----- (0040120C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40120C()
{
  void *v0; // [esp+14h] [ebp-4h]
  void *retaddr; // [esp+18h] [ebp+0h]

  *(&retaddr - 7) = v0;
  JUMPOUT(0x40121C);
}
// 401210: positive sp value 4 has been found
// 40121B: control flows out of bounds to 40121C

//----- (00401285) --------------------------------------------------------
void __usercall start(int a1@<eax>, int a2@<ebp>, int a3@<edi>)
{
  char v3; // zf
  int v4; // [esp-4h] [ebp-4h]

  v4 = *(_DWORD *)(((int (__thiscall *)(int))loc_40149B)((a3 - 1) | (a1 + 1)) + 8 * a2 - 1);
  if ( !v3 )
  {
    MEMORY[0x4647740](v4);
    JUMPOUT(0x4012B3);
  }
  JUMPOUT(0x401296);
}
// 4012AE: control flows out of bounds to 4012B3
// 4012AC: control flows out of bounds to 401296
// 4012AC: variable 'v3' is possibly undefined

//----- (00401308) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_401308(int a1@<eax>)
{
  int v1; // [esp+24h] [ebp-8h]
  __int32 v2; // [esp+28h] [ebp-4h]

  *(&v2 - 12) = v1;
  sub_401045(a1, v2);
}
// 40131C: positive sp value 8 has been found

//----- (00401330) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401330(int a1@<eax>, _DWORD *a2@<ecx>, int a3@<ebx>, int a4@<esi>)
{
  int v4; // esi
  unsigned int v5; // edi
  int v6; // edx
  char v7; // zf
  int v8; // eax

  v4 = a1 | (a4 + 1);
  v5 = (unsigned int)a2;
  do
  {
    a3 = (a1 | (a3 - 1)) + 1;
    v6 = v4;
    v5 |= a3;
    ++v4;
    a1 = ((int (__fastcall *)(_DWORD, int))((char *)&loc_40146B + 5))(*a2, v6);
  }
  while ( v7 );
  sub_40120C();
  v8 = ((int (*)(void))((char *)&loc_4012AE + 1))();
  sub_4013A7(v8 & 0x74E825E8);
}
// 401336: positive sp value 4 has been found
// 401354: control flows out of bounds to 401355
// 401344: variable 'a2' is possibly undefined
// 401352: variable 'v7' is possibly undefined

//----- (004013A7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_4013A7(int a1@<eax>)
{
  __asm { repne pop edx }
  sub_401148(a1 | 0x10);
}
// 4013AC: positive sp value 4 has been found

//----- (004013FC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4013FC(char a1@<al>, char a2@<dl>, int a3@<ecx>, int a4@<esi>)
{
  int v4; // ecx
  char v5; // zf

  v4 = a3 | a4;
  LOBYTE(v4) = a1 ^ v4;
  BYTE1(v4) = a2 | 0x4A;
  ((void (__thiscall *)(int))((char *)&loc_401356 + 1))(v4);
  if ( !v5 )
    JUMPOUT(0x401427);
  JUMPOUT(0x401421);
}
// 401400: positive sp value 4 has been found
// 401422: control flows out of bounds to 401427
// 401420: control flows out of bounds to 401421
// 401420: variable 'v5' is possibly undefined

//----- (00401FE8) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401FE8(__int32 a1@<eax>)
{
  __int32 v1; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v1, a1);
  sub_4022E2();
  JUMPOUT(0x402013);
}
// 401FEF: positive sp value 4 has been found
// 40200E: control flows out of bounds to 402013

//----- (0040203B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40203B()
{
  JUMPOUT(0x40204C);
}
// 40203F: positive sp value 4 has been found
// 40204A: control flows out of bounds to 40204C

//----- (0040207A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40207A(int a1@<ecx>, int a2@<ebp>, char a3@<dil>)
{
  int v3; // [esp+14h] [ebp-8h]
  void *v4; // [esp+18h] [ebp-4h]
  void *retaddr; // [esp+1Ch] [ebp+0h]

  *(&retaddr - 8) = v4;
  BYTE1(a1) += a3;
  v4 = *(void **)(((int (__thiscall *)(int))loc_402475)(a1) + 8 * a2 - 1);
  v3 = *(_DWORD *)(a2 - 115);
  JUMPOUT(0x4020A7);
}
// 40207E: positive sp value 4 has been found
// 4020A3: control flows out of bounds to 4020A7

//----- (004020F7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4020F7(char a1@<ah>, _BYTE *a2@<edx>, int a3@<ecx>, __int16 a4@<bx>, int a5@<edi>)
{
  __int16 v5; // ax
  int v6; // edx
  int v7; // ecx
  char v8; // zf

  LOBYTE(a3) = ((unsigned __int8)a2 | (((unsigned __int8)a2 | BYTE1(a3)) + a3)) - HIBYTE(a4) - a1;
  BYTE1(a3) = BYTE1(a2) ^ HIBYTE(a4);
  sub_40228A(a1, a2, a3 + 1, a4);
  if ( v8 )
    JUMPOUT(0x40211A);
  sub_402120(v5 & 0x2574, v6, v7, a4, a5);
}
// 4020FD: positive sp value 4 has been found
// 402119: control flows out of bounds to 40211A
// 402119: variable 'v8' is possibly undefined
// 40211B: variable 'v5' is possibly undefined
// 40211C: variable 'v6' is possibly undefined
// 40211C: variable 'v7' is possibly undefined

//----- (00402120) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402120(__int16 a1@<ax>, int a2@<edx>, int a3@<ecx>, char a4@<bl>, int a5@<edi>)
{
  int v5; // ecx
  int v6; // ecx
  int v7; // ecx
  void *v8; // [esp+18h] [ebp-4h]
  void *retaddr; // [esp+1Ch] [ebp+0h]

  *(&retaddr - 8) = v8;
  v5 = a3 + 1;
  LOBYTE(v5) = BYTE1(a2);
  v6 = a5 | v5;
  LOBYTE(v6) = -107;
  ++v6;
  BYTE1(v6) |= a1 | a4;
  LOBYTE(v6) = BYTE1(a2) ^ v6;
  v7 = a2 | v6;
  BYTE1(v7) = __ROL1__(HIBYTE(a1), 3) + (v7 | BYTE1(v7));
  ((void (__thiscall *)(int))((char *)&loc_402305 + 4))(v7);
  JUMPOUT(0x402152);
}
// 402124: positive sp value 4 has been found
// 40214D: control flows out of bounds to 402152

//----- (0040219E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40219E(int a1@<eax>, char a2@<dl>, int a3@<ecx>, int a4@<edi>, int a5@<esi>, int a6)
{
  int v6; // ecx
  int v7; // ebx
  int v8; // esi
  char v9; // dh
  int v10; // edx
  char v11; // cl
  char v12; // al
  int v13; // edx
  int v14; // [esp-4h] [ebp-4h]

  BYTE1(a3) |= BYTE1(a1);
  LOBYTE(a1) = BYTE1(a3) + a1;
  v6 = a3 + 1;
  v7 = a1 + 1;
  LOBYTE(a1) = 5 - ((unsigned __int16)(a1 + 1) >> 8);
  v8 = a1 | (a5 - 1);
  LOBYTE(v6) = BYTE1(v6) | (v6 - a2);
  BYTE1(v6) -= v7;
  ((void (__thiscall *)(int))loc_4022B4)(v6);
  MEMORY[0xD3CB47B3]();
  LOBYTE(v7) = BYTE1(v7) ^ v7;
  BYTE1(v10) = v9 - v7;
  LOBYTE(v7) = v11 | v7;
  v12 = BYTE1(v7) + v11;
  ++v7;
  LOBYTE(v7) = v12 ^ v7;
  sub_402747(v12, v10, v7, a4, v8);
  MEMORY[0xFFB50AEB]();
  v14 = *(_DWORD *)(v13 + 8);
  sub_4026F8();
  MEMORY[0x88290B15](v14);
  JUMPOUT(0x402216);
}
// 4021F2: positive sp value 8 has been found
// 402211: control flows out of bounds to 402216
// 4021D9: variable 'v9' is possibly undefined
// 4021DB: variable 'v11' is possibly undefined
// 4021E2: variable 'v10' is possibly undefined
// 402201: variable 'v13' is possibly undefined

//----- (0040228A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40228A(char a1@<ah>, _BYTE *a2@<edx>, int a3@<ecx>, int a4@<ebx>)
{
  int v4; // ecx

  BYTE1(a3) = a4;
  LOBYTE(a3) = 89;
  *a2 = a1;
  v4 = a4 | a3;
  BYTE1(v4) = v4 - BYTE1(a4);
  LOBYTE(v4) = a4;
  ((void (__thiscall *)(int))((char *)&loc_402237 + 2))(v4);
  JUMPOUT(0x4022B4);
}
// 40228E: positive sp value 4 has been found
// 4022AF: control flows out of bounds to 4022B4

//----- (004022E2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4022E2()
{
  void *v0; // [esp+10h] [ebp-4h]
  void *retaddr; // [esp+14h] [ebp+0h]

  *(&retaddr - 6) = v0;
  ((void (*)(void))((char *)&loc_4023E0 + 1))();
  JUMPOUT(0x40230A);
}
// 4022E6: positive sp value 4 has been found
// 402305: control flows out of bounds to 40230A

//----- (00402363) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402363(__int16 a1@<ax>, int a2@<edx>, int a3@<ebx>, int a4@<ebp>, int a5@<edi>, char a6@<sil>)
{
  int v6; // ecx
  int v7; // ecx
  char v8; // zf

  v6 = a3;
  LOBYTE(v6) = BYTE1(a2);
  v7 = a3 | v6;
  LOBYTE(v7) = v7 - HIBYTE(a1);
  BYTE1(v7) = v7 ^ (BYTE1(v7) - ((a6 - 1) | BYTE1(a3) | a1));
  sub_40207A(v7, a4, a5);
  MEMORY[0xE9290C75](a2);
  if ( !v8 )
  {
    ++*(_DWORD *)(a5 + 1525883924);
    JUMPOUT(0x402395);
  }
  JUMPOUT(0x402377);
}
// 402368: positive sp value 4 has been found
// 40238F: control flows out of bounds to 402395
// 40238D: control flows out of bounds to 402377
// 40238D: variable 'v8' is possibly undefined

//----- (004023BC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4023BC(char a1@<ah>, char a2@<dl>, char a3@<ch>, char a4@<bl>)
{
  __int16 v4; // cx
  void *v5; // [esp+Ch] [ebp-4h]
  void *retaddr; // [esp+10h] [ebp+0h]

  *(&retaddr - 5) = v5;
  LOBYTE(v4) = a4 | a4 | a2;
  HIBYTE(v4) = a2 ^ (a4 + (a1 | a3) - a2);
  ((void (__thiscall *)(__int16))((char *)&loc_40283C + 1))(v4);
  MEMORY[0x4648872]();
  JUMPOUT(0x4023E5);
}
// 4023C0: positive sp value 4 has been found
// 4023E0: control flows out of bounds to 4023E5

//----- (00402429) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402429()
{
  char v0; // zf

  ((void (*)(void))((char *)&loc_401FC0 + 3))();
  if ( !v0 )
  {
    MEMORY[0xE8659879]();
    JUMPOUT(0x402454);
  }
  JUMPOUT(0x402474);
}
// 402442: positive sp value 8 has been found
// 40244F: control flows out of bounds to 402454
// 40244D: control flows out of bounds to 402474
// 40244D: variable 'v0' is possibly undefined

//----- (0040249C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int sub_40249C()
{
  char v0; // zf
  __int16 v1; // dx
  int v2; // ecx
  void *v4; // [esp+24h] [ebp-4h]
  void *retaddr; // [esp+28h] [ebp+0h]

  *(&retaddr - 11) = v4;
  ((void (*)(void))((char *)&loc_4027BD + 1))();
  if ( v0 )
    JUMPOUT(0x4024C8);
  MEMORY[0xE8B449F3]();
  return sub_4024CE(v2, v1);
}
// 4024A0: positive sp value 4 has been found
// 4024C7: control flows out of bounds to 4024C8
// 4024C7: variable 'v0' is possibly undefined
// 4024CA: variable 'v2' is possibly undefined
// 4024CA: variable 'v1' is possibly undefined

//----- (004024CE) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __fastcall sub_4024CE(int a1, __int16 a2)
{
  int v2; // edi
  void *v4; // [esp+20h] [ebp-4h]
  void *retaddr; // [esp+24h] [ebp+0h]

  *(&retaddr - 10) = v4;
  v2 = a1;
  LOBYTE(a1) = 125 - ((unsigned __int16)(a1 + a2) >> 8);
  ((void (__thiscall *)(int))((char *)&loc_4029C4 + 3))(v2 | a1);
  return MEMORY[0x1487E825]();
}
// 4024D2: positive sp value 4 has been found

//----- (00402526) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402526(__int16 a1@<bx>, __int16 a2@<di>)
{
  char v2; // bl
  char v3; // ch
  __int16 v4; // bx
  char v5; // al
  int v6; // edx
  char v7; // zf
  int v8; // [esp-4h] [ebp-4h]

  v2 = HIBYTE(a1) + a1;
  v3 = 85;
  v8 = 0;
  do
  {
    HIBYTE(v4) = -92;
    LOBYTE(v4) = v3 ^ v2;
    v2 = ((unsigned __int16)(a2 | (v4 + 1)) >> 8) + 56;
    v5 = ((int (__cdecl *)(int))loc_402176)(v8);
  }
  while ( v7 );
  sub_402551(v5, v6, v2, a2);
}
// 40252A: positive sp value 4 has been found
// 40254D: control flows out of bounds to 402574
// 40254F: control flows out of bounds to 402576
// 402539: variable 'v3' is possibly undefined
// 402546: variable 'v8' is possibly undefined
// 40254B: variable 'v7' is possibly undefined
// 402550: variable 'v6' is possibly undefined

//----- (00402551) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402551(char a1@<al>, int a2@<edx>, char a3@<bl>, int a4@<edi>)
{
  __int16 v4; // ax
  int v5; // ecx
  int v6; // ecx
  void *v7; // [esp+28h] [ebp-4h]
  void *retaddr; // [esp+2Ch] [ebp+0h]

  *(&retaddr - 12) = v7;
  LOBYTE(v4) = a1 - 2;
  v5 = a4;
  LOBYTE(v5) = a4 - a2;
  v6 = a4 | a2 | v5;
  HIBYTE(v4) = *(_BYTE *)a4;
  LOBYTE(v6) = 88;
  --v6;
  LOBYTE(v6) = *(_BYTE *)a4 + a3;
  sub_402120(v4, a2, v6, a3, a4);
  sub_40257E();
}
// 402555: positive sp value 4 has been found

//----- (0040257E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40257E()
{
  ((void (*)(void))((char *)&loc_4025E2 + 5))();
  JUMPOUT(0x4025A2);
}
// 402584: positive sp value 4 has been found
// 40259D: control flows out of bounds to 4025A2

//----- (004025C4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4025C4@<eax>(int a1@<ebx>)
{
  void *v2; // [esp+4h] [ebp-4h]
  void *retaddr; // [esp+8h] [ebp+0h]

  *(&retaddr - 3) = v2;
  ((void (__thiscall *)(int))((char *)&loc_40232A + 4))(a1);
  return MEMORY[0x8D252525]();
}
// 4025C8: positive sp value 4 has been found

//----- (00402619) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_402619@<eax>(unsigned int a1@<ecx>, char a2@<bl>)
{
  char v2; // bl
  int v3; // edx
  char v4; // zf

  v2 = a2 + 39 - (a1 >> 15) - 2;
  ((void (*)(void))loc_402264)();
  if ( v4 )
    JUMPOUT(0x402669);
  return sub_40264A(v3, v2);
}
// 40261F: positive sp value 4 has been found
// 402642: control flows out of bounds to 402669
// 402644: control flows out of bounds to 402645
// 402642: variable 'v4' is possibly undefined
// 402649: variable 'v3' is possibly undefined

//----- (0040264A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_40264A@<eax>(int a1@<edx>, char a2@<bl>)
{
  char v2; // ah
  int v3; // edx
  int v5; // [esp+4h] [ebp-8h]
  int v6; // [esp+8h] [ebp-4h]

  *(&v6 - 4) = v5;
  v2 = BYTE1(a1);
  v3 = a1 + 1;
  BYTE1(v3) = a2;
  LOBYTE(v3) = v2 + v3;
  ((void (__fastcall *)(int, int))((char *)&loc_40259D + 4))(v6, v3);
  return MEMORY[0x448FFFE8]();
}
// 40265E: positive sp value 8 has been found

//----- (004026F8) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4026F8()
{
  char v0; // zf
  void *v1; // [esp+Ch] [ebp-4h]
  void *retaddr; // [esp+10h] [ebp+0h]

  *(&retaddr - 5) = v1;
  ((void (*)(void))((char *)&loc_40214D + 3))();
  if ( !v0 )
    JUMPOUT(0x402722);
  JUMPOUT(0x402791);
}
// 4026FC: positive sp value 4 has been found
// 40271D: control flows out of bounds to 402722
// 40271B: control flows out of bounds to 402791
// 40271B: variable 'v0' is possibly undefined

//----- (00402747) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_402747@<eax>(char a1@<al>, int a2@<edx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>)
{
  int v5; // ecx
  int v6; // ebx
  int v7; // eax
  unsigned __int16 v8; // dx
  char v9; // zf
  int v10; // eax
  int v11; // ebx
  int v12; // ecx
  __int16 v13; // bx
  char v14; // dl
  char v15; // dh
  char v16; // cl
  char *v17; // ecx
  __int16 v18; // bx
  char v19; // dh
  int v20; // ecx

  BYTE1(a3) -= a1;
  BYTE1(a2) = a5;
  v5 = a2;
  LOBYTE(a2) = a5 + a2;
  v6 = a3 - 2;
  ((void (__fastcall *)(int, int, int))((char *)&loc_4020CB + 1))(v5, a2, 64);
  v7 = MEMORY[0x2640106B]();
  if ( !v9 )
    JUMPOUT(0x402770);
  v10 = v7 & 0x1C877474;
  LOBYTE(v10) = v10 & 0x8D;
  v11 = v6 - *(_DWORD *)(v6 - 118);
  __asm { int     0Ah;  - IRQ2 - EGA VERTICAL RETRACE }
  __outbyte(v8, v10);
  v12 = a4 | a5;
  BYTE1(v12) = BYTE1(v11) + ((unsigned __int16)(a4 | a5) >> 8);
  LOBYTE(v11) = BYTE1(v10) | v11;
  v13 = a4 | v11;
  ((void (__fastcall *)(int, int))((char *)&loc_402797 + 2))(a4 | (a5 - 1) | v12, v10);
  if ( v9 )
    JUMPOUT(0x40280E);
  MEMORY[0x8F659C3B]();
  LOBYTE(v13) = v13 - v14;
  LOBYTE(v17) = v15 ^ v16;
  v18 = v13 - 1;
  BYTE1(v17) = HIBYTE(v18);
  sub_40286C(v17);
  MEMORY[0x25B51124]();
  if ( !v9 )
  {
    LOBYTE(v20) = -81;
    BYTE1(v20) = HIBYTE(v18) + (HIBYTE(v18) | v19);
    ((void (__thiscall *)(int))((char *)&loc_402667 + 4))(v20 + 2);
    MEMORY[0xE8654E69]();
    JUMPOUT(0x40286A);
  }
  return nullsub_1();
}
// 40274D: positive sp value 4 has been found
// 40276E: control flows out of bounds to 402770
// 402865: control flows out of bounds to 40286A
// 40276E: control flows out of bounds to 4026F7
// 40280D: control flows out of bounds to 40280E
// 40276C: variable 'v9' is possibly undefined
// 4027EE: variable 'v8' is possibly undefined
// 40281B: variable 'v14' is possibly undefined
// 40281F: variable 'v15' is possibly undefined
// 40281F: variable 'v16' is possibly undefined
// 402832: variable 'v17' is possibly undefined
// 402852: variable 'v19' is possibly undefined
// 40285E: variable 'v20' is possibly undefined
// 4027CD: using guessed type _DWORD nullsub_1();

//----- (0040286C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __thiscall sub_40286C(char *this)
{
  char *v1; // ecx
  char v2; // al
  int v3; // edx
  int v4; // ecx
  int v5; // [esp+24h] [ebp-8h]
  int v6; // [esp+28h] [ebp-4h]

  *(&v6 - 12) = v5;
  v1 = this + 2;
  BYTE1(v1) = 79;
  ((void (__thiscall *)(char *))loc_4026CC)(v1);
  MEMORY[0x264010BF]();
  sub_40257E();
  sub_4028C0(v2 & 0x74, v3, v4, 68);
}
// 40289E: positive sp value 8 has been found
// 4028BB: variable 'v2' is possibly undefined
// 4028BC: variable 'v3' is possibly undefined
// 4028BC: variable 'v4' is possibly undefined

//----- (004028C0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4028C0(char a1@<al>, int a2@<edx>, int a3@<ecx>, char a4@<bl>)
{
  int v4; // edx

  v4 = a2 + 1;
  BYTE1(v4) ^= a3;
  BYTE1(a3) -= a1;
  sub_40264A(a3 | v4, a4 - 1);
  MEMORY[0x89B52814](4204757);
  JUMPOUT(0x4028EF);
}
// 4028C4: positive sp value 4 has been found
// 4028EA: control flows out of bounds to 4028EF

//----- (00402917) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int sub_402917()
{
  ((void (*)(void))((char *)&loc_40238F + 1))();
  return MEMORY[0xE874FFFF]();
}
// 40291B: positive sp value 4 has been found

//----- (00402971) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402971()
{
  void *v0; // [esp+4h] [ebp-4h]
  void *retaddr; // [esp+8h] [ebp+0h]

  *(&retaddr - 3) = v0;
  ((void (*)(void))loc_40204C)();
  JUMPOUT(0x40299D);
}
// 402975: positive sp value 4 has been found
// 402998: control flows out of bounds to 40299D

//----- (004029EE) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4029EE(__int16 a1@<ax>, char a2@<cl>, __int16 a3@<di>, int a4@<esi>)
{
  __int16 v4; // di
  __int16 v5; // bx
  void *v6; // [esp+Ch] [ebp-4h]
  void *retaddr; // [esp+10h] [ebp+0h]

  *(&retaddr - 5) = v6;
  v4 = a1 | a3;
  HIBYTE(v5) = a2 | HIBYTE(v4);
  LOBYTE(v5) = a2 | HIBYTE(v4);
  sub_402526(v5, v4 - 1);
  v6 = *(void **)((char *)&v6 + 2 * a4 + 3);
  JUMPOUT(0x402A14);
}
// 4029F2: positive sp value 4 has been found
// 402A10: control flows out of bounds to 402A14

// nfuncs=41 queued=39 decompiled=39 lumina nreq=0 worse=0 better=0
// ALL OK, 39 function(s) have been successfully decompiled
