// subject_data.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

Eq_2 g_t402001 = // 00402001
	{
		&g_a41E2
	};
Eq_2 g_t402005 = // 00402005
	{
		&g_a5600
	};
Eq_1075 g_a402009[] = // 00402009
	{
	};
Eq_2 g_t4062E8 = // 004062E8
	{
		null
	};
word32 g_dw4062EC = 0x00; // 004062EC
Eq_2 g_t4062F0 = // 004062F0
	{
		null
	};
word32 g_dw4062F4 = 0x00; // 004062F4
Eq_2 g_t4062F8 = // 004062F8
	{
		null
	};
ptr32 g_ptr4062FC = 0x00; // 004062FC
word32 g_dw406300 = 0x00; // 00406300
Eq_2 g_t406304 = // 00406304
	{
		null
	};
word32 g_dw406308 = 0x00; // 00406308
struct Eq_155 * g_ptr40630C = null; // 0040630C
<anonymous> * g_ptr406310 = null; // 00406310
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__GetModuleHandleA = &g_t1CCC; // 00401000
<anonymous> * __imp__CreateFileA = &g_t1CE0; // 00401004
<anonymous> * __imp__lstrcatA = &g_t1CEE; // 00401008
<anonymous> * __imp__GetProcAddress = &g_t1CFA; // 0040100C
<anonymous> * __imp__LoadLibraryA = &g_t1D0C; // 00401010
<anonymous> * __imp__CloseHandle = &g_t1D1C; // 00401014
<anonymous> * __imp__VirtualAlloc = &g_t1D2A; // 00401018
<anonymous> * __imp__lstrcpyA = &g_t1D3A; // 0040101C
// 00401030: void fn00401030(Stack Eq_2 dwArg04, Stack Eq_2 dwArg08, Stack Eq_2 dwArg0C)
// Called from:
//      fn00401340
//      fn00401980
void fn00401030(Eq_2 dwArg04, Eq_2 dwArg08, Eq_2 dwArg0C)
{
	g_t4062F0.u0 = 0x00;
	while (g_t4062F0.u0 < dwArg0C)
	{
		Mem23[dwArg04 + Mem9[0x004062F0<p32>:word32]:byte] = Mem9[dwArg08 + Mem9[0x004062F0<p32>:word32]:byte];
		g_t4062F0.u0 = (Eq_931 (*)[]) ((char *) g_t4062F0.u0 + 1);
	}
}

// 004010C0: Register Eq_20 Win32CrtStartup()
Eq_20 Win32CrtStartup()
{
	ptr32 fp;
	word32 ebx;
	word32 esi;
	word32 edi;
	struct Eq_25 * fs;
	Eq_26 tLoc74;
	Eq_2 dwArg04;
	Eq_28 eax_31 = GetProcAddress(LoadLibraryA(0x00406204), 0x004061EC);
	eax_31();
	lstrcatA(&tLoc74, 4219412);
	if (CreateFileA(&tLoc74, 0x01, 0x00, null, 0x03, 0x80, 0x00) == ~0x00)
		return 0x00;
	eax_31();
	lstrcatA(&tLoc74, 0x00406224);
	if (CreateFileA(&tLoc74, 0x01, 0x00, null, 0x03, 0x80, 0x00) != ~0x00)
		return 0x00;
	Eq_2 eax_110 = GetModuleHandleA(0x00);
	if ((dwArg04 & 0xFFFF) != 0x00)
		g_dw406308 = 0x00;
	else
		g_dw406308 = 0x01;
	if (dwArg04 == 0x00)
	{
		g_dw406308 = 0x01;
		--g_dw406308;
	}
	if (g_dw406308 != 0x00)
		g_t4062F8.u0 = (Eq_931 (*)[]) dwArg04;
	Eq_2 eax_145 = g_t402001.u0;
	Eq_2 edx_148 = g_t402005.u0;
	Eq_2 dwLoc08_342 = 0x00;
	eax_165 = eax_145;
	while (true)
	{
		Eq_2 eax_165;
		if (dwLoc08_342 >= eax_145)
			break;
		dwLoc08_342.u9->dw402009 = dwLoc08_342.u9->dw402009 ^ 11152423;
		&eax_165.u0->u0 = (word32) dwLoc08_342 + 8;
		&dwLoc08_342.u0->u0 = (word32) dwLoc08_342 + 8;
	}
	fn00401950(edx_148);
	g_t406304.u0 = (Eq_931 (*)[]) eax_165;
	fn00401B20(g_a402009, g_t406304.u0, eax_145);
	g_dw4062F4 = edi;
	g_dw4062EC = esi;
	g_dw406300 = ebx;
	g_ptr40630C = fs->ptr0018;
	g_ptr4062FC = fp - 4;
	if (g_dw406308 != 0x00)
		fn00401980(4199139 - dwArg04, dwArg04);
	else
		fn00401980(4199139 - eax_110, eax_110);
	fn00401340(g_t406304.u0);
	Eq_20 eax_262;
	g_ptr406310();
	return eax_262;
}

// 00401320: void fn00401320(Stack Eq_2 dwArg04, Stack Eq_32 dwArg08)
// Called from:
//      fn00401340
void fn00401320(Eq_2 dwArg04, Eq_32 dwArg08)
{
	GetProcAddress(dwArg04, dwArg08);
}

// 00401340: void fn00401340(Stack Eq_2 dwArg04)
// Called from:
//      Win32CrtStartup
void fn00401340(Eq_2 dwArg04)
{
	ptr32 fp;
	Eq_26 tLocB4;
	lstrcpyA(&tLocB4, 4219444);
	word32 eax_23 = dwArg04 + Mem20[dwArg04 + 60:word32];
	struct Eq_216 * dwLoc2C_721 = &eax_23->w0014 + 2 + (word32) eax_23->w0014 / 84;
	Eq_2 eax_40 = VirtualAlloc(0x00, eax_23->t0050.u0, 0x3000, 0x40);
	if (eax_40 == 0x00)
		return;
	fn00401030(eax_40, dwArg04, (word32) dwArg04.u6[0x0F].dw003C + 252 + (word32) eax_23->w0006 *s 0x28);
	Eq_28 eax_75 = GetProcAddress(GetModuleHandleA(0x00406258), 4219464);
	Eq_28 eax_86 = GetProcAddress(GetModuleHandleA(0x0040627C), 0x00406268);
	up32 dwLoc10_738;
	for (dwLoc10_738 = 0x00; dwLoc10_738 < (word32) eax_23->w0006; ++dwLoc10_738)
	{
		if (dwLoc2C_721->dw0014 != 0x00 && dwLoc2C_721->dw0010 != 0x00)
			fn00401030(eax_40 + Mem657[dwLoc2C_721 + 0x0C:word32], dwArg04 + Mem652[dwLoc2C_721 + 20:word32], CONVERT(CONVERT(Mem91[dwLoc2C_721 + 16:word32] - 1 + Mem91[eax_23 + 60:word32], word32, uint64) /u Mem91[eax_23 + 60:word32], word32, uint32) *s Mem91[eax_23 + 60:word32]);
		++dwLoc2C_721;
	}
	word32 ecx_100 = eax_40 + Mem97[eax_40 + 60:word32];
	Eq_2 eax_121 = eax_86();
	if (eax_121 == 0x00)
		return;
	Eq_2 eax_133 = GetModuleHandleA(4219544);
	fn00401320(eax_133, 0x0040628C);
	word32 dwLocC0_755 = eax_40 + Mem139[ecx_100 + 0x80:word32];
	while (dwLocC0_755.u0[4] != 0x00)
	{
		Eq_354 dwLoc38_812;
		Eq_355 dwLoc28_811;
		word32 eax_524 = LoadLibraryA(eax_40 + Mem146[dwLocC0_755 + 0x0C:word32]);
		if (dwLocC0_755.u1->t0000.u0 != 0x00)
		{
			dwLoc28_811 = eax_40 + Mem526[dwLocC0_755 + 0x00:word32];
			dwLoc38_812 = eax_40 + Mem542[dwLocC0_755 + 16:word32];
		}
		else
		{
			dwLoc28_811 = eax_40 + Mem526[dwLocC0_755 + 16:word32];
			dwLoc38_812 = eax_40 + Mem533[dwLocC0_755 + 0x00:word32];
		}
		word32 dwLoc1C_815 = 0x00;
		if (dwLocC0_755.u0[4] != 0x00 && ((dwLocC0_755.u1)->t0000).u0 != 0x00)
			dwLoc1C_815 = 0x01;
		while (dwLoc28_811.u1->t0000.u0 != 0x00)
		{
			if ((dwLoc28_811.u1->t0000.u0 & 0x80000000) != 0x00)
			{
				ui32 eax_589 = dwLoc28_811.u1->t0000.u0;
				fn00401320(eax_524, eax_589 & 0x7FFFFFFF);
				dwLoc28_811.u1->t0000.u0 = eax_589 & 0x7FFFFFFF;
			}
			else
			{
				word32 eax_576 = Mem558[dwLoc28_811 + 0x00:word32] + 2 + eax_40;
				fn00401320(eax_524, eax_576);
				dwLoc28_811.u1->t0000.u0 = (struct Eq_1128 *) eax_576;
			}
			if (dwLoc28_811.u1->t0000.u0 == 0x00)
				return;
			if (dwLoc1C_815 != 0x00)
				dwLoc38_812.u1->t0000.u0 = dwLoc28_811.u1->t0000.u0;
			dwLoc28_811 += 0x04;
			dwLoc38_812 += 0x04;
		}
		dwLocC0_755 += 0x14;
	}
	if (g_dw406308 != 0x00)
	{
		word32 edx_154 = g_t4062F8.u0 - ((ecx_100.u0)->t0034).u0;
		if (ecx_100.u0->dw00A4 != 0x00)
		{
			word32 dwLoc24_760 = eax_40 + Mem155[ecx_100 + 0xA0:word32];
			while (dwLoc24_760.u0[1] != 0x00)
			{
				uint32 edx_472 = dwLoc24_760.u0[1] - 0x08 >> 0x01;
				word32 dwLocB8_799 = dwLoc24_760 + 0x08;
				uint32 dwLoc10_800;
				for (dwLoc10_800 = 0x00; dwLoc10_800 < edx_472; ++dwLoc10_800)
				{
					if ((word32) *((word32) dwLocB8_799 + dwLoc10_800 * 0x02) >> 0x0C == 0x03)
						Mem512[eax_40 + Mem480[dwLoc24_760 + 0x00:word32] + (CONVERT(dwLocB8_799[dwLoc10_800 * 0x02], word16, word32) & 0x0FFF):word32] = Mem480[eax_40 + Mem480[dwLoc24_760 + 0x00:word32] + (CONVERT(dwLocB8_799[dwLoc10_800 * 0x02], word16, word32) & 0x0FFF):word32] + edx_154;
				}
				dwLoc24_760 += Mem480[dwLoc24_760 + 4:word32];
			}
		}
	}
	Eq_28 eax_180 = GetProcAddress(GetModuleHandleA(0x004062B8), 0x004062A8);
	if (g_dw406308 != 0x00)
		g_t4062E8.u0 = (Eq_931 (*)[]) eax_180();
	else
		g_t4062E8.u0 = (Eq_931 (*)[]) eax_180();
	struct Eq_555 * esp_243 = fp - 244;
	if (g_t4062E8.u0 == 0x00)
	{
		ptr32 esp_248;
		if (g_dw406308 != 0x00)
		{
			esp_248 = fp - 0xF8;
			if (eax_75() == 0x00)
			{
				Eq_2 edx_297 = g_t4062F8.u0;
				word32 eax_301;
				eax_133();
				if (eax_301 == 0x00)
					return;
			}
		}
		else
		{
			esp_248 = fp - 0xF8;
			if (eax_75() == 0x00)
			{
				Eq_2 eax_263 = ecx_100.u0->t0034.u0;
				word32 eax_267;
				eax_133();
				if (eax_267 == 0x00)
					return;
			}
		}
		if (g_dw406308 != 0x00)
		{
			struct Eq_704 * esp_345 = esp_248 - 4;
			esp_345->t0000.u0 = g_t4062F8.u0;
			esp_345->dwFFFFFFFC = 0x00;
			esp_345->dwFFFFFFF8 = 0x00;
			esp_345->dwFFFFFFF4 = 0x00;
			esp_345->dwFFFFFFF0 = 0x22;
			esp_345->tFFFFFFEC.u0 = (Eq_931 (*)[]) eax_121;
			g_t4062E8.u0 = (Eq_931 (*)[]) eax_180();
		}
		else
		{
			struct Eq_674 * esp_320 = esp_248 - 4;
			esp_320->t0000.u0 = ecx_100.u0->t0034.u0;
			esp_320->dwFFFFFFFC = 0x00;
			esp_320->dwFFFFFFF8 = 0x00;
			esp_320->dwFFFFFFF4 = 0x00;
			esp_320->dwFFFFFFF0 = 0x22;
			esp_320->tFFFFFFEC.u0 = (Eq_931 (*)[]) eax_121;
			g_t4062E8.u0 = (Eq_931 (*)[]) eax_180();
		}
		esp_243 = esp_248 - 24;
		if (g_t4062E8.u0 == 0x00)
		{
			if (g_dw406308 == 0x00)
			{
				esp_243->tFFFFFFFC = 0x40;
				esp_243->tFFFFFFF8 = 0x3000;
				esp_243->tFFFFFFF4.u0 = ecx_100.u0->t0050.u0;
				esp_243->tFFFFFFF0.u0 = ecx_100.u0->t0034.u0;
				g_t4062E8.u0 = (Eq_931 (*)[]) VirtualAlloc(esp_243->tFFFFFFF0, esp_243->tFFFFFFF4.u0, esp_243->tFFFFFFF8, esp_243->tFFFFFFFC);
			}
			else
			{
				esp_243->tFFFFFFFC = 0x40;
				esp_243->tFFFFFFF8 = 0x3000;
				esp_243->tFFFFFFF4.u0 = ecx_100.u0->t0050.u0;
				esp_243->tFFFFFFF0.u0 = g_t4062F8.u0;
				g_t4062E8.u0 = (Eq_931 (*)[]) VirtualAlloc(esp_243->tFFFFFFF0, esp_243->tFFFFFFF4.u0, esp_243->tFFFFFFF8, esp_243->tFFFFFFFC);
			}
		}
	}
	struct Eq_561 * esp_405 = esp_243 - 4;
	esp_405->t0000.u0 = (Eq_931 (*)[]) eax_121;
	CloseHandle(esp_405->t0000);
	esp_405->t0000.u0 = ecx_100.u0->t0050.u0;
	esp_405->tFFFFFFFC.u0 = (Eq_931 (*)[]) eax_40;
	esp_405->tFFFFFFF8.u0 = g_t4062E8.u0;
	fn00401030(esp_405->tFFFFFFF8.u0, esp_405->tFFFFFFFC.u0, esp_405->t0000.u0);
	if (g_dw406308 != 0x00)
	{
		Mem440[esp_405 + 0x00:word32] = Mem418[0x004062E8<p32>:word32] + Mem418[ecx_100 + 40:word32];
		esp_405->tFFFFFFFC.u0 = g_t4062F8.u0;
		fn004018E0(esp_405->tFFFFFFFC.u0, esp_405->t0000.u0);
	}
	else
	{
		esp_405->t0000.u0 = g_t4062E8.u0;
		fn00401AF0(esp_405->t0000.u0);
	}
	Mem460[0x00406310<p32>:word32] = Mem455[0x004062E8<p32>:word32] + Mem455[ecx_100 + 40:word32];
	ecx_100.u0->ptr0028 = g_ptr406310;
}

// 004018E0: void fn004018E0(Stack Eq_2 dwArg04, Stack Eq_2 dwArg08)
// Called from:
//      fn00401340
void fn004018E0(Eq_2 dwArg04, Eq_2 dwArg08)
{
	struct Eq_818 * ecx_15 = g_ptr40630C->ptr0030->ptr000C->ptr000C;
	struct Eq_818 * dwLoc0C_61 = ecx_15;
	while (dwLoc0C_61 != null)
	{
		if (dwLoc0C_61->t0018.u0 == dwArg04)
		{
			dwLoc0C_61->t001C.u0 = (Eq_931 (*)[]) dwArg08;
			return;
		}
		struct Eq_818 * eax_37 = dwLoc0C_61->ptr0000;
		dwLoc0C_61 = eax_37;
		if (eax_37 == ecx_15)
			return;
	}
}

// 00401950: void fn00401950(Stack Eq_2 dwArg04)
// Called from:
//      Win32CrtStartup
void fn00401950(Eq_2 dwArg04)
{
	VirtualAlloc(0x00, dwArg04, 0x3000, 0x04);
}

// 00401980: void fn00401980(Stack ptr32 dwArg04, Stack Eq_2 dwArg08)
// Called from:
//      Win32CrtStartup
void fn00401980(ptr32 dwArg04, Eq_2 dwArg08)
{
	Eq_2 dwLoc28_173;
	if (g_dw406308 != 0x00)
		&dwLoc28_173.u0->u0 = g_t4062F8.u0;
	else
		dwLoc28_173 = dwArg08;
	struct Eq_859 * ecx_24 = &(dwLoc28_173.u0 + ((dwLoc28_173.u0))[0x0F].u0 / 4)->u0;
	g_t4062E8.u0 = (Eq_931 (*)[]) GetProcAddress(GetModuleHandleA(0x004062D8), 4219592)();
	if (g_t4062E8.u0 == 0x00)
		return;
	fn00401030(g_t4062E8.u0, dwLoc28_173, ecx_24->t0050.u0);
	int32 edx_77 = g_t4062E8.u0 - dwLoc28_173;
	if (ecx_24->dw00A4 != 0x00)
	{
		word32 dwLoc0C_188 = dwLoc28_173 + Mem78[ecx_24 + 0xA0:word32];
		while (dwLoc0C_188.u1->t0004.u0 != 0x00)
		{
			uint32 edx_112 = dwLoc0C_188.u1->t0004.u0 - 0x08 >> 0x01;
			word32 dwLoc20_195 = dwLoc0C_188 + 0x08;
			uint32 dwLoc08_196;
			for (dwLoc08_196 = 0x00; dwLoc08_196 < edx_112; ++dwLoc08_196)
			{
				if ((word32) *((word32) dwLoc20_195 + dwLoc08_196 * 0x02) >> 0x0C == 0x03)
					Mem152[Mem120[0x004062E8<p32>:word32] + Mem120[dwLoc0C_188 + 0x00:word32] + (CONVERT(dwLoc20_195[dwLoc08_196 * 0x02], word16, word32) & 0x0FFF):word32] = Mem120[Mem120[0x004062E8<p32>:word32] + Mem120[dwLoc0C_188 + 0x00:word32] + (CONVERT(dwLoc20_195[dwLoc08_196 * 0x02], word16, word32) & 0x0FFF):word32] + edx_77;
			}
			dwLoc0C_188 += Mem120[dwLoc0C_188 + 4:word32];
		}
	}
	<anonymous> * ecx_95 = &(g_t4062E8.u0 + dwArg04 / 4)->u0;
	ecx_95();
}

// 00401AF0: void fn00401AF0(Stack Eq_2 dwArg04)
// Called from:
//      fn00401340
void fn00401AF0(Eq_2 dwArg04)
{
	g_ptr40630C->ptr0030->t0008.u0 = (Eq_931 (*)[]) dwArg04;
}

// 00401B20: void fn00401B20(Stack (ptr32 byte) dwArg04, Stack Eq_2 dwArg08, Stack Eq_2 dwArg0C)
// Called from:
//      Win32CrtStartup
void fn00401B20(byte * dwArg04, Eq_2 dwArg08, Eq_2 dwArg0C)
{
	Eq_969 tLoc20;
	Eq_970 tLoc10;
	Eq_2 dwLoc0C_129 = 0x01;
	byte cl_12 = *dwArg04;
	int32 dwLoc18_132 = 0x00;
	do
	{
		byte al_19 = Mem16[dwArg04 + dwLoc0C_129:byte];
		&dwLoc0C_129.u0->u0 = (word32) dwLoc0C_129 + 1;
		if ((word32) al_19 == (word32) cl_12)
		{
			if ((word32) dwArg04[(word32) dwLoc0C_129 + 1] == 0x00)
			{
				dwArg08.u7[dwLoc18_132] = cl_12;
				++dwLoc18_132;
				&dwLoc0C_129.u0->u0 = (word32) dwLoc0C_129 + 2;
			}
			else
			{
				int32 eax_60 = fn00401C20(&tLoc10, dwArg04 + ((word32) dwLoc0C_129 + 1)) + ((word32) dwLoc0C_129 + 1);
				dwLoc0C_129 = fn00401C20(&tLoc20, dwArg04 + eax_60) + eax_60;
				up32 dwLoc1C_147;
				for (dwLoc1C_147 = 0x00; dwLoc1C_147 < tLoc10; ++dwLoc1C_147)
				{
					dwArg08.u7[dwLoc18_132] = dwArg08.u7[dwLoc18_132 - tLoc20];
					++dwLoc18_132;
				}
			}
		}
		else
		{
			dwArg08.u7[dwLoc18_132] = al_19;
			++dwLoc18_132;
		}
	} while (dwLoc0C_129 < dwArg0C);
}

// 00401C20: Register word32 fn00401C20(Stack (ptr32 ui32) dwArg04, Stack (ptr32 byte) dwArg08)
// Called from:
//      fn00401B20
word32 fn00401C20(ui32 * dwArg04, byte * dwArg08)
{
	ui32 dwLoc08_44 = 0x00;
	word32 dwLoc10_45 = 0x00;
	do
	{
		ui32 ecx_15 = (word32) *dwArg08;
		ui32 ecx_25 = ecx_15 & 0x7F | dwLoc08_44 << 0x07;
		++dwArg08;
		dwLoc08_44 = ecx_25;
		++dwLoc10_45;
	} while ((ecx_15 & 0x80) != 0x00);
	*dwArg04 = ecx_25;
	return dwLoc10_45;
}

word32 g_dw401CA8 = 0x1CCC; // 00401CA8
word32 g_dw401CAC = 0x1CE0; // 00401CAC
word32 g_dw401CB0 = 0x1CEE; // 00401CB0
word32 g_dw401CB4 = 0x1CFA; // 00401CB4
word32 g_dw401CB8 = 0x1D0C; // 00401CB8
word32 g_dw401CBC = 0x1D1C; // 00401CBC
word32 g_dw401CC0 = 7466; // 00401CC0
word32 g_dw401CC4 = 0x1D3A; // 00401CC4
