/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// BOOL __stdcall VirtualProtect(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);
void __stdcall sub_409100(int);
// int __userpurge TlsCallback_1@<eax>(DWORD@<edx>, int@<ecx>, int@<ebx>, int@<ebp>, int@<edi>, int@<esi>, int, int, int);
_DWORD __stdcall TlsCallback_0(_DWORD, _DWORD, _DWORD); // weak

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN j_nullsub_1; // weak
char byte_40911B = '\x90'; // weak


//----- (00409100) --------------------------------------------------------
void __stdcall sub_409100(int a1)
{
  ;
}

//----- (00409164) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
int __userpurge TlsCallback_1@<eax>(
        DWORD a1@<edx>,
        int a2@<ecx>,
        int a3@<ebx>,
        int a4@<ebp>,
        int a5@<edi>,
        int a6@<esi>,
        int a7,
        int a8,
        int a9)
{
  int v10; // edi
  int v11; // eax
  char v12; // cf
  int v13; // ecx
  int v14; // edx
  char *v15; // esi
  int v16; // ecx
  char v17; // al
  int *v18; // esi
  int v19; // eax
  int v20; // ebx
  int v21; // eax
  int v22; // ecx
  int v23; // edi
  char v24; // al
  _BYTE *v25; // ebx
  int i; // ecx
  int v27; // [esp-C9E7h] [ebp-CA17h]
  _BYTE *v28; // [esp-C9E7h] [ebp-CA17h]
  int v29; // [esp-C9E3h] [ebp-CA13h]
  DWORD v30; // [esp-C9DFh] [ebp-CA0Fh] BYREF
  int v31; // [esp-C9DBh] [ebp-CA0Bh]
  int v32; // [esp-C9D7h] [ebp-CA07h]
  int v33; // [esp-C9D3h] [ebp-CA03h]
  _DWORD *v34; // [esp-C9CFh] [ebp-C9FFh]
  int v35; // [esp-C9CBh] [ebp-C9FBh]
  int v36; // [esp-C9C7h] [ebp-C9F7h]
  int v37; // [esp-C9C3h] [ebp-C9F3h]
  _DWORD v38[12911]; // [esp-C9BFh] [ebp-C9EFh] BYREF

  if ( v38[2] == 1 )
  {
    v37 = a6;
    v36 = a5;
    v35 = a4;
    v34 = v38;
    v33 = a3;
    v32 = a2;
    v31 = 1;
    v30 = a1;
    v10 = -932808800;
    v11 = a2;
    do
    {
      sub_409100(v11 - 40753441);
      v10 -= v12 - 40753441;
    }
    while ( v13 != 1 );
    VirtualProtect((LPVOID)(v10 ^ 0xED4D3F3F), v10 ^ 0xED0DAF3F, 4u, &v30);
    v15 = &byte_40911B;
    v16 = 5;
    do
    {
      v29 = v16;
      v17 = *v15;
      v18 = (int *)(v15 + 1);
      LOBYTE(v14) = v17;
      v19 = *v18++;
      v20 = v19;
      v21 = *v18++;
      v22 = v21;
      v23 = *v18;
      v15 = (char *)v18 + 5;
      do
      {
        v27 = v22;
        sub_409100(v14);
        LOBYTE(v14) = v24 ^ v14;
        v22 = v27 - 1;
      }
      while ( v27 != 1 );
      LOBYTE(v28) = v14 ^ v20;
      BYTE1(v28) = v14 ^ BYTE1(v20);
      BYTE2(v28) = v14 ^ BYTE2(v20);
      HIBYTE(v28) = v14 ^ HIBYTE(v20);
      v25 = v28;
      for ( i = v23; i; --i )
      {
        BYTE1(v14) = v14 ^ *v25;
        *v25++ = BYTE1(v14);
      }
      v16 = v29 - 1;
    }
    while ( v29 != 1 );
    ((void (__fastcall *)(int, int, DWORD, int, int, int, _DWORD *, int, int, int))j_nullsub_1)(
      v16,
      v14 + 66,
      v30,
      v31,
      v32,
      v33,
      v34,
      v35,
      v36,
      v37);
  }
  return TlsCallback_0(a7, a8, a9);
}
// 409219: positive sp value C9EF has been found
// 409214: bad sp value at call
// 409191: variable 'v11' is possibly undefined
// 409197: variable 'v12' is possibly undefined
// 409199: variable 'v13' is possibly undefined
// 4091D8: variable 'v14' is possibly undefined
// 4091DD: variable 'v24' is possibly undefined
// 40911B: using guessed type char byte_40911B;
// 40921F: using guessed type _DWORD __stdcall TlsCallback_0(_DWORD, _DWORD, _DWORD);

// nfuncs=6 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
