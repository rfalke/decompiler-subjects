/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int a1, int a2, int a3);
void __fastcall sub_4010D8(int a1, int a2);
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// void __usercall sub_4040AD(int a1@<edx>, unsigned int a2@<ecx>, int a3@<ebx>, int a4@<esi>, double a5@<st7>, double a6@<st3>, double a7@<st2>, double a8@<st1>, double a9@<st0>);
// void __usercall sub_4040F6(char a1@<zf>, char a2@<sf>, bool a3@<of>, int _EAX@<eax>, unsigned int a5@<ecx>, double a6@<st7>, double a7@<st3>, double a8@<st2>, double a9@<st1>, double a10@<st0>);

//-------------------------------------------------------------------------
// Data declarations

int dword_401000 = 1208998647; // weak
_UNKNOWN loc_404251; // weak


//----- (0040106F) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  HMODULE v3; // eax
  int v4; // edx
  int v5; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  v3 = GetModuleHandleA(0);
  sub_4010D8((int)v3, v4);
  v5 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 10;
  *(_DWORD *)(a3 + 176) = v5;
  return 0;
}
// 4010B6: variable 'v4' is possibly undefined

//----- (004010D8) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_4010D8(int a1, int a2)
{
  int v2; // [esp-10h] [ebp-10h] BYREF

  __writefsdword(0, (unsigned int)&v2);
  dword_401000 = a2;
}
// 4010E9: positive sp value C has been found
// 4010E0: write access to const memory at 401000 has been detected
// 401000: using guessed type int dword_401000;

//----- (004040AD) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4040AD(int a1@<edx>, unsigned int a2@<ecx>, int a3@<ebx>, int a4@<esi>, double a5@<st7>, double a6@<st3>, double a7@<st2>, double a8@<st1>, double a9@<st0>)
{
  int v9; // eax
  char v10; // zf
  char v11; // sf
  char v12; // of
  int v13; // ecx
  char v16; // cf
  int savedregs; // [esp+0h] [ebp+0h]

  do
  {
    v9 = a4;
    v13 = a2 & ~(1 << a4);
    if ( v11 ^ v12 | v10 )
    {
      if ( v12 )
        a4 = -a4;
      v9 = ~a1;
    }
    sub_4040F6(0, a1 < 0, 0, savedregs, __PAIR64__(v9, v13) >> v13, a5, a6, a7, a8, a9);
    __asm { aad     0BFh ; '¿' }
  }
  while ( !(v16 | v10) );
  sub_4040F6(a3 == 1033604214, a3 - 1033604214 < 0, __OFSUB__(a3, 1033604214), _EAX, a2, a5, a6, a7 - a5, a8, a9);
}
// 4040E0: positive sp value 4 has been found
// 4040B3: variable 'a2' is possibly undefined
// 4040B6: variable 'v11' is possibly undefined
// 4040B6: variable 'v12' is possibly undefined
// 4040B3: variable 'v10' is possibly undefined
// 4040C8: variable 'a1' is possibly undefined
// 4040E0: variable 'savedregs' is possibly undefined
// 4040E7: variable 'v16' is possibly undefined

//----- (004040F6) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4040F6(char a1@<zf>, char a2@<sf>, bool a3@<of>, int _EAX@<eax>, unsigned int a5@<ecx>, double a6@<st7>, double a7@<st3>, double a8@<st2>, double a9@<st1>, double a10@<st0>)
{
  __int16 v10; // dx
  double v11; // st7
  int v12; // esi
  unsigned __int8 v13; // cf
  char v14; // sf
  char v15; // of
  bool v16; // pf
  char v17; // cc
  int v18; // edi
  int v20; // esi
  int v21; // et0
  int v23; // edi
  int v24; // edi
  int v25; // edx
  int v27; // [esp-14h] [ebp-14h]
  int v28; // [esp-10h] [ebp-10h]
  int v29; // [esp-4h] [ebp-4h]
  int savedregs; // [esp+0h] [ebp+0h] BYREF
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  v10 = a5;
  if ( !(a2 ^ a3 | a1) )
    _EAX = 1289272941;
  v11 = a10 + a6;
  v18 = -(_EAX + v29);
  v12 = 4985464;
  v13 = _bittestandreset(&v18, 0x4C1278u);
  v17 = v14 ^ v15;
  if ( v14 == v15 )
  {
    if ( !v13 )
    {
      if ( v14 != v15 )
        v18 = a5;
      v12 = 4985465;
    }
    _EAX = a5;
    v18 = ~v18;
    _BitScanReverse(&a5, a5);
    if ( !a3 )
      LOWORD(a5) = v10;
    v16 = __SETP__(v12 + 1, 0);
    v17 = (v12 + 1 < 0) ^ __OFADD__(1, v12) | (v12 == -1);
  }
  if ( !v16 )
  {
    _EDI = v12;
    v13 = 0;
    v21 = (_EAX & -v12) + 1;
    v20 = _EAX;
    _EAX = v21;
    v12 = v20 + 1;
    v16 = __SETP__(++_EDI, 0);
    __asm { rcr     edi, 0A7h }
    if ( v16 )
      v13 = 0;
    a3 = __OFADD__(1, _EDI);
    v18 = _EDI + 1;
    v17 = (v18 < 0) ^ a3 | (v18 == 0);
  }
  if ( v17 )
    LOWORD(v18) = a5 + v13 + (_WORD)v18;
  v23 = v18 + 1;
  LOWORD(v23) = -26535;
  v24 = v23 - 1;
  v25 = savedregs;
  savedregs = 1610612736;
  v28 = v12;
  v27 = v12;
  if ( -698912221 - v25 < 0 )
  {
    __asm { repne cmova esi, eax }
    a7 = a7 * a6;
  }
  ((void (__usercall *)(int, int, int, int, int, void **, int *, int, int, double@<st0>, double@<st1>, double@<st2>, double@<st3>))loc_404251)(
    v25,
    _EAX,
    v25,
    v27,
    v28,
    &retaddr,
    &savedregs,
    v24,
    savedregs,
    v11,
    a9,
    a8,
    a7);
  JUMPOUT(0x404251);
}
// 4041BF: positive sp value 8 has been found
// 40424F: control flows out of bounds to 404251
// 40412C: variable 'v29' is possibly undefined
// 404136: variable 'v14' is possibly undefined
// 404136: variable 'v15' is possibly undefined
// 404152: variable 'a3' is possibly undefined
// 404158: variable 'v16' is possibly undefined
// 404194: variable 'v13' is possibly undefined

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
