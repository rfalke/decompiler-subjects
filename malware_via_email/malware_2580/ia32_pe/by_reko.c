// subject_data_0002.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

struct Eq_149 * g_ptr424222 = &g_t4277; // 00424222
Eq_2 g_t424226 = // 00424226
	{
		&g_a5600
	};
Eq_1028 g_a42422A[] = // 0042422A
	{
	};
Eq_2 g_t428620 = // 00428620
	{
		null
	};
word32 g_dw428624 = 0x00; // 00428624
Eq_2 g_t428628 = // 00428628
	{
		null
	};
word32 g_dw42862C = 0x00; // 0042862C
ptr32 g_ptr428630 = 0x00; // 00428630
word32 g_dw428634 = 0x00; // 00428634
Eq_2 g_t428638 = // 00428638
	{
		null
	};
struct Eq_194 * g_ptr42863C = null; // 0042863C
<anonymous> * g_ptr428640 = null; // 00428640
CHAR g_t428660 = '\0'; // 00428660
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__CreateFileA = &g_t1B70; // 00401000
<anonymous> * __imp__lstrcatA = &g_t1B7E; // 00401004
<anonymous> * __imp__GetWindowsDirectoryA = &g_t1B8A; // 00401008
<anonymous> * __imp__GetModuleHandleA = &g_t1BA2; // 0040100C
<anonymous> * __imp__lstrcpyA = &g_t1BB6; // 00401010
<anonymous> * __imp__GetProcAddress = &g_t1BC2; // 00401014
<anonymous> * __imp__CloseHandle = &g_t1BD4; // 00401018
<anonymous> * __imp__VirtualAlloc = &g_t1BE2; // 0040101C
<anonymous> * __imp__MapViewOfFileEx = &g_t1BF2; // 00401020
<anonymous> * __imp__VirtualFree = &g_t1C04; // 00401024
<anonymous> * __imp__LoadIconA = &g_t1C20; // 0040102C
// 00401040: void fn00401040(Stack Eq_2 dwArg04, Stack Eq_2 dwArg08, Stack Eq_2 dwArg0C)
// Called from:
//      fn00401370
//      fn004017E0
void fn00401040(Eq_2 dwArg04, Eq_2 dwArg08, Eq_2 dwArg0C)
{
	g_t428628.u0 = 0x00;
	while (g_t428628.u0 < dwArg0C)
	{
		Mem23[dwArg04 + Mem9[0x00428628<p32>:word32]:byte] = Mem9[dwArg08 + Mem9[0x00428628<p32>:word32]:byte];
		g_t428628.u0 = (DWORD) &(g_t428628.u0 + 1)->a0000->b0000;
	}
}

// 004010E0: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	ptr32 fp;
	word32 ebx;
	word32 esi;
	word32 edi;
	struct Eq_25 * fs;
	Eq_26 tLoc014C;
	byte bLoc014B;
	lstrcpyA(&g_t428660, 0x004284A4);
	Eq_2 eax_26 = GetModuleHandleA(0x00);
	LoadIconA(null, 0x7F00);
	GetWindowsDirectoryA(&tLoc014C, 300);
	if ((word32) bLoc014B != 0x3A)
		return 0x00;
	lstrcatA(&tLoc014C, 4359336);
	lstrcatA(&tLoc014C, 4359344);
	if (CreateFileA(&tLoc014C, 0x01, 0x03, null, 0x03, 0x80, 0x00) != ~0x00)
	{
		lstrcpyA(&g_t428660, 0x004284C4);
		GetWindowsDirectoryA(&tLoc014C, 300);
		if ((word32) bLoc014B == 0x3A)
		{
			lstrcatA(&tLoc014C, 0x004284E0);
			if (CreateFileA(&tLoc014C, 0x01, 0x03, null, 0x03, 0x80, 0x00) == ~0x00)
			{
				struct Eq_149 * ecx_124 = g_ptr424222;
				Eq_2 eax_127 = g_t424226.u0;
				lstrcpyA(&g_t428660, 4359436);
				struct Eq_149 * dwLoc08_330;
				for (dwLoc08_330 = null; dwLoc08_330 < ecx_124; ++dwLoc08_330)
				{
					GetModuleHandleA(0x00);
					dwLoc08_330->dw42422A = dwLoc08_330->dw42422A ^ 44444;
				}
				fn004017B0(eax_127);
				g_t428638.u0 = (DWORD) eax_127;
				fn00401970(g_a42422A, g_t428638.u0, ecx_124);
				g_dw42862C = edi;
				g_dw428624 = esi;
				g_dw428634 = ebx;
				g_ptr42863C = fs->ptr0018;
				g_ptr428630 = fp - 4;
				fn004017E0(0x00401310 - eax_26, eax_26);
				fn00401370(g_t428638.u0);
				Eq_2 eax_218;
				word32 edx_220;
				g_ptr428640();
				return eax_218;
			}
			else
			{
				lstrcpyA(&g_t428660, 0x004284F4);
				return 0x00;
			}
		}
		else
		{
			lstrcpyA(&g_t428660, 0x004284D4);
			return 0x00;
		}
	}
	else
	{
		lstrcpyA(&g_t428660, 0x004284B4);
		return 0x00;
	}
}

// 00401350: void fn00401350(Stack Eq_2 dwArg04, Stack Eq_31 dwArg08)
// Called from:
//      fn00401370
void fn00401350(Eq_2 dwArg04, Eq_31 dwArg08)
{
	GetProcAddress(dwArg04, dwArg08);
}

// 00401370: void fn00401370(Stack Eq_2 dwArg04)
// Called from:
//      Win32CrtStartup
void fn00401370(Eq_2 dwArg04)
{
	ptr32 fp;
	Eq_26 tLocBC;
	Eq_2 eax_11 = GetModuleHandleA(4359444);
	lstrcpyA(&tLocBC, 0x00428524);
	GetProcAddress(eax_11, 0x00428538);
	Eq_238 eax_36 = GetProcAddress(eax_11, 0x00428548);
	Eq_238 eax_45 = GetProcAddress(eax_11, 0x0042855C);
	lstrcpyA(&tLocBC, 4359532);
	Eq_238 eax_60 = GetProcAddress(eax_11, 4359544);
	lstrcpyA(&tLocBC, 0x00428588);
	Eq_238 eax_75 = GetProcAddress(eax_11, 0x00428590);
	lstrcpyA(&tLocBC, 4359584);
	GetProcAddress(eax_11, 4359596);
	Eq_238 eax_99 = GetProcAddress(eax_11, 0x004285B8);
	word32 ecx_106 = dwArg04 + Mem103[dwArg04 + 60:word32];
	struct Eq_327 * dwLoc30_547 = &ecx_106->w0014 + 2 + (word32) ecx_106->w0014 / 64;
	Eq_2 eax_125 = eax_45();
	fn00401040(eax_125, dwArg04, (word32) *((word32) dwArg04 + 60) + 312 + (word32) ecx_106->w0006 *s 0x28);
	up32 dwLoc10_553;
	for (dwLoc10_553 = 0x00; dwLoc10_553 < (word32) ecx_106->w0006; ++dwLoc10_553)
	{
		if (dwLoc30_547->dw0014 != 0x00 && dwLoc30_547->dw0010 != 0x00)
			fn00401040(&(eax_125.u0 + dwLoc30_547->dw000C)->a0000->b0000, &(dwArg04.u0 + dwLoc30_547->dw0014)->a0000->b0000, (uint32) ((uint64) (dwLoc30_547->dw0010 - 1 + (ecx_106->t003C).u0) /u (ecx_106->t003C).u0) *s (ecx_106->t003C).u0);
		++dwLoc30_547;
	}
	word32 ecx_164 = eax_125 + Mem161[eax_125 + 60:word32];
	Eq_2 eax_184 = eax_36();
	struct Eq_366 * esp_183 = fp - 244;
	struct Eq_369 * dwLocCC_561 = &(eax_125.u0 + ecx_164->dw0080)->a0000->b0000;
	while (dwLocCC_561->dw0010 != 0x00)
	{
		word32 * dwLoc3C_581;
		ui32 * dwLoc2C_580;
		struct Eq_366 * esp_346 = esp_183 - 4;
		esp_346->ptr0000 = &(eax_125.u0 + dwLocCC_561->dw000C)->a0000->b0000;
		Eq_2 eax_349 = eax_60();
		if (dwLocCC_561->dw0000 != 0x00)
		{
			dwLoc2C_580 = (ui32 *) &(eax_125.u0 + dwLocCC_561->dw0000)->a0000->b0000;
			dwLoc3C_581 = (word32 *) &(eax_125.u0 + dwLocCC_561->dw0010)->a0000->b0000;
		}
		else
		{
			dwLoc2C_580 = (ui32 *) &(eax_125.u0 + dwLocCC_561->dw0010)->a0000->b0000;
			dwLoc3C_581 = (word32 *) &(eax_125.u0 + dwLocCC_561->dw0000)->a0000->b0000;
		}
		word32 dwLoc1C_584 = 0x00;
		if (dwLocCC_561->dw0010 != 0x00 && dwLocCC_561->dw0000 != 0x00)
			dwLoc1C_584 = 0x01;
		while (true)
		{
			esp_183 = esp_346;
			if (*dwLoc2C_580 == 0x00)
				break;
			if ((*dwLoc2C_580 & 0x80000000) != 0x00)
			{
				ui32 eax_417 = *dwLoc2C_580;
				esp_346->tFFFFFFFC.u0 = (CHAR *) (eax_417 & 0x7FFFFFFF);
				esp_346->tFFFFFFF8.u0 = (DWORD) eax_349;
				fn00401350(esp_346->tFFFFFFF8.u0, esp_346->tFFFFFFFC.u0);
				*dwLoc2C_580 = eax_417 & 0x7FFFFFFF;
			}
			else
			{
				Eq_31 eax_404 = &(eax_125.u0 + (*dwLoc2C_580 + 2))->a0000->b0000;
				esp_346->tFFFFFFFC.u0 = (CHAR *) eax_404;
				esp_346->tFFFFFFF8.u0 = (DWORD) eax_349;
				fn00401350(esp_346->tFFFFFFF8.u0, esp_346->tFFFFFFFC.u0);
				*dwLoc2C_580 = (ui32) eax_404;
			}
			if (dwLoc1C_584 != 0x00)
				*dwLoc3C_581 = *dwLoc2C_580;
			++dwLoc2C_580;
			++dwLoc3C_581;
		}
		++dwLocCC_561;
	}
	struct Eq_415 * esp_203 = esp_183 - 4;
	esp_203->t0000.u0 = ecx_164->t0034.u0;
	esp_203->dwFFFFFFFC = 0x00;
	esp_203->dwFFFFFFF8 = 0x00;
	esp_203->dwFFFFFFF4 = 0x00;
	esp_203->dwFFFFFFF0 = 0x22;
	esp_203->tFFFFFFEC.u0 = (DWORD) eax_184;
	g_t428620.u0 = (DWORD) eax_75();
	ptr32 esp_217 = esp_203 - 20;
	if (g_t428620.u0 == 0x00)
	{
		esp_203->tFFFFFFE8.u0 = ecx_164->t0034.u0;
		if (eax_99() == 0x00)
		{
			esp_203->tFFFFFFE4.u0 = 0x8000;
			esp_203->tFFFFFFE0.u0 = 0x00;
			esp_203->tFFFFFFDC.u0 = ecx_164->t0034.u0;
			if (VirtualFree(esp_203->tFFFFFFDC, esp_203->tFFFFFFE0.u0, esp_203->tFFFFFFE4.u0) == 0x00)
				return;
		}
		esp_203->tFFFFFFE4.u0 = ecx_164->t0034.u0;
		esp_203->tFFFFFFE0.u0 = 0x00;
		esp_203->tFFFFFFDC.u0 = 0x00;
		esp_203->tFFFFFFD8.u0 = 0x00;
		esp_203->tFFFFFFD4.u0 = 0x22;
		esp_203->tFFFFFFD0.u0 = (DWORD) eax_184;
		g_t428620.u0 = (DWORD) MapViewOfFileEx(esp_203->tFFFFFFD0, esp_203->tFFFFFFD4.u0, esp_203->tFFFFFFD8.u0, esp_203->tFFFFFFDC.u0, esp_203->tFFFFFFE0.u0, esp_203->tFFFFFFE4);
		esp_217 = esp_203 - 24;
		if (g_t428620.u0 == 0x00)
		{
			esp_203->tFFFFFFE4.u0 = 0x40;
			esp_203->tFFFFFFE0.u0 = 0x3000;
			esp_203->tFFFFFFDC.u0 = ecx_164->t0050.u0;
			esp_203->tFFFFFFD8.u0 = ecx_164->t0034.u0;
			g_t428620.u0 = (DWORD) VirtualAlloc(esp_203->tFFFFFFD8, esp_203->tFFFFFFDC.u0, esp_203->tFFFFFFE0.u0, esp_203->tFFFFFFE4.u0);
			esp_217 = esp_203 - 24;
		}
	}
	struct Eq_505 * esp_296 = esp_217 - 4;
	esp_296->t0000.u0 = (DWORD) eax_184;
	CloseHandle(esp_296->t0000);
	esp_296->t0000.u0 = ecx_164->t0050.u0;
	esp_296->tFFFFFFFC.u0 = (DWORD) eax_125;
	esp_296->tFFFFFFF8.u0 = g_t428620.u0;
	fn00401040(esp_296->tFFFFFFF8.u0, esp_296->tFFFFFFFC.u0, esp_296->t0000.u0);
	esp_296->t0000.u0 = g_t428620.u0;
	fn00401940(esp_296->t0000.u0);
	Mem328[0x00428640<p32>:word32] = Mem319[0x00428620<p32>:word32] + Mem319[ecx_164 + 40:word32];
	ecx_164->ptr0028 = g_ptr428640;
}

// 004017B0: void fn004017B0(Stack Eq_2 dwArg04)
// Called from:
//      Win32CrtStartup
void fn004017B0(Eq_2 dwArg04)
{
	VirtualAlloc(0x00, dwArg04, 0x3000, 0x04);
}

// 004017E0: void fn004017E0(Stack word32 dwArg04, Stack Eq_2 dwArg08)
// Called from:
//      Win32CrtStartup
void fn004017E0(word32 dwArg04, Eq_2 dwArg08)
{
	word32 edx_16 = dwArg08 + Mem13[dwArg08 + 60:word32];
	g_t428620.u0 = (DWORD) GetProcAddress(GetModuleHandleA(0x004285D8), 0x004285C8)();
	if (g_t428620.u0 == 0x00)
		return;
	fn00401040(g_t428620.u0, dwArg08, edx_16->t0050.u0);
	int32 eax_66 = g_t428620.u0 - dwArg08;
	if (edx_16->dw00A4 != 0x00)
	{
		struct Eq_827 * dwLoc0C_175 = &(dwArg08.u0 + edx_16->dw00A0)->a0000->b0000;
		while (dwLoc0C_175->t0004.u0 != 0x00)
		{
			uint32 eax_103 = dwLoc0C_175->t0004.u0 - 0x08 >> 0x01;
			word16 dwLoc20_181[] = (char *) &dwLoc0C_175->t0004 + 4;
			uint32 dwLoc08_182;
			for (dwLoc08_182 = 0x00; dwLoc08_182 < eax_103; ++dwLoc08_182)
			{
				if ((word32) dwLoc20_181[dwLoc08_182] >> 0x0C == 0x03)
					(&(g_t428620.u0 + dwLoc0C_175->dw0000)->a0000->b0000)[(word32) dwLoc20_181[dwLoc08_182] & 0x0FFF] = (byte) ((&(g_t428620.u0 + dwLoc0C_175->dw0000)->a0000->b0000)[(word32) dwLoc20_181[dwLoc08_182] & 0x0FFF] + eax_66);
			}
			dwLoc0C_175 += dwLoc0C_175->t0004.u0 / 8;
		}
	}
	<anonymous> * edx_86 = &(g_t428620.u0 + dwArg04)->a0000->b0000;
	edx_86();
}

// 00401940: void fn00401940(Stack Eq_2 dwArg04)
// Called from:
//      fn00401370
void fn00401940(Eq_2 dwArg04)
{
	g_ptr42863C->ptr0030->t0008.u0 = (DWORD) dwArg04;
}

// 00401970: void fn00401970(Stack (ptr32 Eq_12) dwArg04, Stack Eq_2 dwArg08, Stack (ptr32 Eq_149) dwArg0C)
// Called from:
//      Win32CrtStartup
void fn00401970(struct Eq_12 * dwArg04, Eq_2 dwArg08, struct Eq_149 * dwArg0C)
{
	Eq_26 tLoc94;
	Eq_900 tLoc20;
	Eq_901 tLoc10;
	Eq_12 cl_12 = dwArg04->b0000;
	lstrcpyA(&tLoc94, 4359676);
	struct Eq_149 * dwLoc0C_137 = (struct Eq_149 *) 0x01;
	int32 dwLoc18_142 = 0x00;
	do
	{
		byte cl_26 = Mem23[dwArg04 + dwLoc0C_137:byte];
		dwLoc0C_137 = (struct Eq_149 *) ((char *) dwLoc0C_137 + 1);
		if ((word32) cl_26 == (word32) cl_12)
		{
			if (CONVERT(Mem30[dwArg04 + (dwLoc0C_137 + 0x01):byte], byte, word32) == 0x00)
			{
				&((word32) dwArg08 + dwLoc18_142)->u0->a0000->b0000 = cl_12;
				++dwLoc18_142;
				dwLoc0C_137 = (struct Eq_149 *) ((char *) dwLoc0C_137 + 2);
			}
			else
			{
				word32 eax_67 = fn00401A90(&tLoc10, dwArg04 + (dwLoc0C_137 + 0x01)) + (dwLoc0C_137 + 0x01);
				dwLoc0C_137 = fn00401A90(&tLoc20, dwArg04 + eax_67 / 4) + eax_67;
				up32 dwLoc1C_157;
				for (dwLoc1C_157 = 0x00; dwLoc1C_157 < tLoc10; ++dwLoc1C_157)
				{
					*((word32) dwArg08 + dwLoc18_142) = *((word32) dwArg08 + (dwLoc18_142 - tLoc20));
					++dwLoc18_142;
				}
			}
		}
		else
		{
			&((word32) dwArg08 + dwLoc18_142)->u0->a0000->b0000 = cl_26;
			++dwLoc18_142;
		}
	} while (dwLoc0C_137 < dwArg0C);
}

// 00401A90: Register word32 fn00401A90(Stack (ptr32 ui32) dwArg04, Stack (ptr32 byte) dwArg08)
// Called from:
//      fn00401970
word32 fn00401A90(ui32 * dwArg04, byte * dwArg08)
{
	Eq_26 tLoc84;
	lstrcpyA(&tLoc84, 4359656);
	ui32 dwLoc08_52 = 0x00;
	word32 dwLoc10_53 = 0x00;
	do
	{
		ui32 edx_22 = (word32) *dwArg08;
		ui32 edx_32 = edx_22 & 0x7F | dwLoc08_52 << 0x07;
		++dwArg08;
		dwLoc08_52 = edx_32;
		++dwLoc10_53;
	} while ((edx_22 & 0x80) != 0x00);
	*dwArg04 = edx_32;
	return dwLoc10_53;
}

word32 g_dw401B3C = 0x1B70; // 00401B3C
word32 g_dw401B40 = 0x1B7E; // 00401B40
word32 g_dw401B44 = 7050; // 00401B44
word32 g_dw401B48 = 7074; // 00401B48
word32 g_dw401B4C = 0x1BB6; // 00401B4C
word32 g_dw401B50 = 0x1BC2; // 00401B50
word32 g_dw401B54 = 0x1BD4; // 00401B54
word32 g_dw401B58 = 0x1BE2; // 00401B58
word32 g_dw401B5C = 0x1BF2; // 00401B5C
word32 g_dw401B60 = 7172; // 00401B60
word32 g_dw401B68 = 7200; // 00401B68
