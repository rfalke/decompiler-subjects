// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__VirtualAlloc = &g_t11F4; // 00401000
<anonymous> * __imp__VirtualProtect = &g_t1204; // 00401004
<anonymous> * __imp__CreateJobSet = &g_t11E4; // 00401008
// 00401010: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	ptr32 fp;
	Eq_2 tLoc08;
	Eq_2 tLoc24;
	Eq_6 tLoc20;
	Eq_2 tLoc1C;
	fn0040115C(fp - 4, tLoc24, tLoc20, tLoc1C);
	Eq_17 eax_36 = (tLoc20 << 0x08) + 0x003FA900;
	Eq_22 v11_40 = ((char *) &eax_36->Flags + 8387 - tLoc20)->u0;
	word32 eax_46 = eax_36 + 0x20DF - tLoc20;
	VirtualProtect(eax_46, v11_40, 0x04, &tLoc08);
	tLoc08.u1 = 0x01;
	Eq_22 ecx_61 = v11_40;
	Eq_27 ebx_185 = eax_46;
	Eq_47 eax_183 = (word32) tLoc20 + 0x10E3F1CF;
	while (true)
	{
		ebx_185.u1->JobHandle = ebx_185.u1->JobHandle ^ eax_183;
		ecx_61 = ecx_61 - ~0x52 - tLoc20;
		if (ecx_61 < 0x00)
			break;
		eax_183.u0 = (char *) tLoc08.u1 + ((word32) eax_183 + 263671972);
		tLoc08.u1 = -tLoc08;
		ebx_185 = ebx_185 + 0x5B - tLoc20;
	}
	word32 ebx_84 = Mem71[eax_46 + 0x93 - tLoc20:word32] + eax_46;
	Eq_2 tLoc1C_211 = (uint32) ebx_84->b0006;
	Eq_27 eax_104 = VirtualAlloc(ebx_84->t0034.u0, ebx_84->t0050.u0, 0x3000, 0x40);
	tLoc08.u1 = eax_104;
	fn0040113F(ebx_84->dw0054, eax_46, eax_104);
	struct Eq_90 * esi_121 = &ebx_84->dw0054 + 41;
	do
	{
		fn0040113F(esi_121->dw0010, eax_46 + Mem129[esi_121 + 0x14:word32], Mem123[&tLoc08 + 0x00:word32] + Mem123[esi_121 + 0x0C:word32]);
		Eq_2 v29_147 = tLoc1C_211 - 0x01;
		++esi_121;
		tLoc1C_211 = v29_147;
	} while (v29_147 != 0x00);
	Eq_27 eax_158 = tLoc08;
	do
		eax_158.u0 = &eax_158.u1->MemberLevel;
	while (eax_158.u1->JobHandle != ~0x55443322);
	return SEQ(0x4011, fn0040113F(0x38, 0x00401174, eax_158));
}

// 0040113F: Register byte fn0040113F(Stack word32 dwArg04, Stack Eq_27 dwArg08, Stack Eq_27 dwArg0C)
// Called from:
//      Win32CrtStartup
byte fn0040113F(word32 dwArg04, Eq_27 dwArg08, Eq_27 dwArg0C)
{
	Eq_27 esi_14 = dwArg08;
	Eq_27 edi_15 = dwArg0C;
	word32 ecx_16 = dwArg04;
	do
	{
		byte al_19 = *esi_14.u3;
		*edi_15.u3 = al_19;
		esi_14.u0 = (word32) esi_14 + 1;
		edi_15.u0 = (word32) edi_15 + 1;
		--ecx_16;
	} while (ecx_16 != 0x00);
	return al_19;
}

// 0040115C: void fn0040115C(Register (ptr32 Eq_10) ebp, Stack Eq_2 tArg00, Stack Eq_6 tArg04, Stack Eq_2 tArg08)
// Called from:
//      Win32CrtStartup
void fn0040115C(struct Eq_10 * ebp, Eq_2 tArg00, Eq_6 tArg04, Eq_2 tArg08)
{
	struct Eq_185 * fs;
	CreateJobSet(tArg00, tArg04, tArg08);
	ebp->dwFFFFFFE4 = fs->ptr0018->dw0034;
}

word32 g_dw4011D4 = 0x11F4; // 004011D4
word32 g_dw4011D8 = 0x1204; // 004011D8
word32 g_dw4011DC = 0x11E4; // 004011DC
