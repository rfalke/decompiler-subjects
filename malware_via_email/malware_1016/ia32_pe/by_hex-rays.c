/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall sub_4070F0(int@<eax>, int _ECX@<ecx>, int@<ebx>, int@<ebp>, int@<edi>, int@<esi>);
void sub_407317();


//----- (004070F0) --------------------------------------------------------
void __usercall sub_4070F0(int a1@<eax>, int _ECX@<ecx>, int a3@<ebx>, int a4@<ebp>, int a5@<edi>, int a6@<esi>)
{
  bool v9; // cf
  int v11; // ecx
  __int16 v14; // di
  unsigned int v15; // edi
  bool v17; // zf
  int v19; // eax
  int v20; // ecx
  int v22; // eax
  int v24; // edx
  int v25; // edx
  int v29; // esi
  int v30; // ebx
  int v32; // eax
  unsigned int v34; // eax
  int v35; // edi
  unsigned int v37; // eax
  int v38; // edi
  int v41; // eax
  bool v42; // tt
  int v43; // edi
  int v44; // ecx
  unsigned int v48; // eax
  unsigned __int16 v50; // dx
  unsigned int v51; // eax
  bool v52; // tt
  int v57; // [esp-8h] [ebp-8h]
  int v58; // [esp-4h] [ebp-4h]

  v29 = a1 ^ a6;
  BYTE1(a3) = __ROL1__(BYTE1(a3) << _ECX, _ECX);
  BYTE1(_ECX) = 2;
  v30 = __ROL4__(a3, 9);
  __asm { rcr     ch, cl }
  LOBYTE(_ECX) = __ROR1__(_ECX, _ECX);
  if ( a5 == 1619697393 )
  {
    *(_DWORD *)(_ECX - 1023176606) &= v30;
    if ( ~(a1 ^ 0xFFFFFEC8) )
    {
      if ( v30 == 889281254 )
      {
        _disable();
        __asm { rcl     eax, 10h }
        JUMPOUT(0x4071A2);
      }
      JUMPOUT(0x406E6C);
    }
    v32 = *(_DWORD *)(_ECX + 60) + _ECX;
    v58 = *(_DWORD *)(v32 + 80);
    v57 = _ECX;
    _EAX = v32 + 128;
    do
    {
LABEL_19:
      v19 = (*(int (__cdecl **)(int))(_ECX + *(_DWORD *)(_ECX + *(_DWORD *)_EAX + 16)))(v57);
      v20 = v57;
      BYTE1(_EDX) = (__ROR1__(BYTE1(_EDX), v57) >> 1) | (__CFSHR__(BYTE1(_EDX), v57) << 7);
      if ( v19 != -1952407297 )
        JUMPOUT(0x40733F);
      __outdword(_EDX, 0x8BA0A0FF);
      __debugbreak();
      _EBX = v58 + 8 * v29 + 442103425;
      ++a5;
      _EAX = MEMORY[0x57733EDE];
      __DS__ = MEMORY[0x57733EE2];
      LOBYTE(v20) = __ROR1__(v57, v57);
      BYTE1(_EDX) = (BYTE1(_EDX) >> v57) - 119;
      if ( v29 != -630611802 )
      {
        if ( v29 == 336326594 )
          JUMPOUT(0x4070EE);
        JUMPOUT(0x407280);
      }
      LOBYTE(_EBX) = -13;
      _ECX = v20 - 1;
    }
    while ( _ECX );
    v17 = a5 + *(_DWORD *)(a4 - 127) == 0;
    *(_DWORD *)(a4 - 127) += a5;
    while ( 1 )
    {
      __asm { icebp }
      if ( v17 )
        JUMPOUT(0x406FCB);
      v29 += 4;
      v58 = 1747896193;
      MEMORY[0x2AFDD240] = _EAX;
      __outdword(_EDX, _EAX);
      _EDI = _EDX + a5 + 4;
      LOWORD(_EAX) = (__int16)_EAX >> _ECX;
      __asm { rcr     di, cl }
      v43 = __ROR4__(_EDI, _ECX);
      v22 = _EAX << 16;
      v42 = __CFSHL__(v22, _ECX);
      LOWORD(v22) = __ROL2__(v22, _ECX);
      BYTE1(v22) -= v42 + BYTE1(_EDX);
      _EAX = v22 >> _ECX;
      LOWORD(v43) = _ECX & ((unsigned __int16)v43 >> _ECX);
      v44 = _ECX - 215458245;
      LOWORD(v44) = (unsigned __int8)v44 | 0xF3;
      LOWORD(_EAX) = (unsigned __int8)(_EAX - 1) | 0x62;
      LOWORD(v44) = (_WORD)v44 << v44;
      LOBYTE(_EAX) = _EAX + 1;
      LOBYTE(_EDX) = ~__ROR1__(-(char)_EDX, 28);
      LOWORD(_EAX) = -(__int16)_EAX;
      LOBYTE(v44) = v44 | 0xF3;
      v35 = v43 << 6;
      BYTE1(v44) = __ROL1__(BYTE1(v44), v44);
      _ECX = _EAX ^ v44;
      __asm { rcl     cl, 0Fh }
      if ( _ECX != -205572641 )
        break;
      v37 = _EAX ^ 0xE9C1A278;
      MEMORY[0xD027B5B9] += v37;
      MEMORY[0xF3BE63CA] ^= v37;
      _EAX = ((int (*)(void))_EDX)();
      *(_DWORD *)_EBX *= 2;
      BYTE1(_ECX) |= 0x19u;
      __asm { rcr     cx, cl }
      v38 = v35 - 646132750;
      if ( _EDX == 506770718 )
      {
        LOBYTE(_EAX) = *(_BYTE *)_ECX ^ _EAX;
        _EDX = -540953614;
        _CL = _EAX | (_ECX + 1);
        __asm
        {
          xlat
          rcr     al, cl
        }
        BYTE1(_EAX) -= 108;
        _CL = v29;
        __asm { rcr     al, cl }
        v9 = __CFSHL__(_EAX, v29);
        v41 = _EAX << v29;
        LOBYTE(v41) = ((_BYTE)v41 - (v9 + BYTE1(v41))) << v29;
        LOWORD(v41) = _EBX + v41;
        BYTE1(v41) = -(BYTE1(v41) ^ 0x84);
        v34 = v29 & v41 | 0xDFC1B3F2;
        _ECX = v29 + 673958793;
        ++BYTE1(v34);
        _EAX = _EBX ^ v34;
        BYTE1(_EAX) = (((unsigned __int16)(((v29 - 13431) ^ _EAX) - 19470) >> 8) & 0xAA) + 1;
        _EDI = v38 << 29 << (v29 - 119);
        __asm { rcr     edi, 3 }
        v14 = ~(_WORD)_EDI;
        LOBYTE(_EAX) = 64;
        if ( _EBX == 107475485 )
          goto LABEL_36;
        BYTE1(_EAX) -= (_EBX < 0x667F21D) - 93;
        if ( !v29 )
        {
          BYTE1(_EAX) = __ROR1__(BYTE1(_EAX), 137);
          LOBYTE(_ECX) = -125;
          __asm { rcl     eax, cl }
          BYTE1(_EAX) |= 0xF2u;
          if ( _EAX != 1415492686 )
            JUMPOUT(0x406F82);
          *(_BYTE *)_EBX = -14;
          _EBX = 1384550479;
          goto LABEL_30;
        }
LABEL_39:
        BYTE1(_ECX) ^= _ECX;
        v9 = __CFADD__(BYTE1(_EBX), BYTE1(_EDX));
        BYTE1(_EDX) += BYTE1(_EBX);
        _CX = v29 + v9 + (_WORD)_ECX;
        v9 = __CFSHL__(_CX, _CX);
        LOBYTE(_CX) = (_BYTE)_CX << _CX;
        LOBYTE(_EAX) = _EAX - (v9 + HIBYTE(_CX));
        v24 = __ROR4__(_EDX, 17);
        v9 = BYTE1(v24) < (unsigned __int8)_EAX;
        BYTE1(v24) -= _EAX;
        v25 = v24 - (v9 - 30860601);
        LOBYTE(v25) = *(_BYTE *)_EBX;
        __asm { rcl     ah, cl }
        if ( v25 != -1185256221 )
          JUMPOUT(0x406FAA);
LABEL_26:
        _CX = _CX - 1;
        __asm { rcr     ch, 1Eh }
        JUMPOUT(0x4071D6);
      }
      BYTE1(_EAX) |= 0xA9u;
      __asm { rcr     cl, cl }
      a5 = -2068187504;
      LOBYTE(_EAX) = _EAX + 45;
      LOWORD(_EDX) = -(__int16)_EDX;
      BYTE1(_ECX) += 13;
      v57 = _EBX;
      LOBYTE(_EDX) = __ROR1__(_EDX, 16);
      v17 = _ECX == 1243445264;
      if ( _ECX != 1243445264 )
      {
        LOBYTE(_EDX) = 0;
        BYTE1(_EDX) -= BYTE1(_EBX);
        LOWORD(_EDX) = __ROL2__(_EDX, _ECX);
        BYTE1(_EAX) = (char)((unsigned __int16)((unsigned __int16)_EAX >> _ECX) >> 8) >> _ECX;
        BYTE1(_EDX) |= 0xDAu;
        v15 = -966635524 - _EBX;
        _EBX -= 211;
        if ( v15 == 1138615450 )
        {
          (*(void (__cdecl **)(int))(v29 - 74))(v57);
          JUMPOUT(0x406F16);
        }
        LOBYTE(_ECX) = -(char)_ECX;
        LOBYTE(_EAX) = 0;
        v9 = __CFADD__(_EAX, _EDX);
        _EDX += _EAX;
        LOBYTE(_EDX) = _ECX + v9 + _EDX;
        LOWORD(_EAX) = _EBX + _EAX;
        v14 = _EAX + v15;
        if ( _EBX == 1396957336 )
          JUMPOUT(0x406EE3);
LABEL_36:
        BYTE1(_ECX) >>= _ECX;
        _DI = ~v14;
        __asm { rcr     di, cl }
        v48 = __ROR4__(_EAX, 19);
        __asm { rcr     di, cl }
        LOWORD(_ECX) = _ECX + 1;
        LOBYTE(_ECX) = (_ECX | 0x49) - 104;
        LOBYTE(_EDX) = (unsigned __int8)(v48 & _EDX) >> _ECX;
        if ( _ECX != -459287033 )
        {
          BYTE1(_EDX) = 0;
          LOWORD(v29) = 2865;
          v9 = __CFSHR__(v48, _ECX);
          _EAX = v48 >> _ECX;
          v11 = v9 + _ECX - 1129519196;
          v9 = __CFSHL__(v11, 24);
          _ECX = v11 << 24;
          __asm { rcr     eax, 7 }
          LOBYTE(_ECX) = BYTE1(_ECX) + v9 + _ECX;
          if ( _EAX == 5105200 )
          {
            __asm { insb }
            *(_BYTE *)_ECX = _EAX;
            JUMPOUT(0x406EBB);
          }
          v51 = _EAX & 0xDED45B21;
          LOWORD(_ECX) = _ECX & 0x8B0;
          BYTE1(v51) = -BYTE1(v51);
          _EAX = v51 >> _ECX;
          __asm { rcl     al, 0Eh }
          LOWORD(_EAX) = __ROR4__(_EAX, _ECX);
          LOWORD(_EDX) = __ROR2__(_EDX, _ECX);
          goto LABEL_39;
        }
        MEMORY[0xF7CD8491](-459287033, _EDX);
        __indword(v50);
        return;
      }
      if ( __SETP__(1243445264, 1243445264) )
      {
        __writegsdword(0x4A1D7810u, __readgsdword(0x4A1D7810u) | 0x4A1D7810);
        LOWORD(_ECX) = -32384;
        LOWORD(a5) = -2416;
        _BH = ~BYTE1(_EBX) | 0xA2;
        __asm { rcr     bh, 18h }
        goto LABEL_19;
      }
    }
    __asm { rcl     al, cl }
    BYTE1(_ECX) |= BYTE1(_EBX);
    BYTE1(_EAX) += 17;
    LOBYTE(_ECX) = __ROL1__((_BYTE)_ECX << _ECX, 24);
    BYTE1(_EDX) = _EDX;
    __asm
    {
      rcl     ax, cl
      rcr     ecx, 1Ch
    }
    LOBYTE(_ECX) = _ECX - 38;
    if ( _EAX == 414881719 )
      JUMPOUT(0x407113);
    v52 = __CFSHL__(_ECX, 12);
    LOBYTE(_ECX) = __ROL1__(_ECX, 12);
    LOWORD(_EAX) = _EAX - (v52 + (_WORD)_EDX);
    _ECX = _ECX - v29;
    BYTE1(_ECX) = __ROR1__(BYTE1(_ECX), _ECX);
    v9 = __CFSHR__(_EAX, 13);
    _EAX = _EAX >> 13;
    LOBYTE(_ECX) = BYTE1(_EBX);
    BYTE1(_ECX) -= v9 + _EAX;
    LOWORD(_ECX) = _ECX - _EAX;
    if ( _ECX != -1449633735 )
    {
LABEL_30:
      *(_BYTE *)_EBX = BYTE1(_EDX);
      HIBYTE(_CX) = -BYTE1(_ECX);
      LOBYTE(_CX) = BYTE1(_EDX) | (_ECX - 28);
      goto LABEL_26;
    }
    __DS__ = -14463;
    __asm
    {
      insd
      xlat
    }
  }
  else
  {
    sub_407317();
  }
  sub_407317();
}
// 406EB9: control flows out of bounds to 406EBB
// 406EE2: control flows out of bounds to 406EE3
// 406F13: control flows out of bounds to 406F16
// 4070C1: control flows out of bounds to 4070C4
// 4070ED: control flows out of bounds to 4070EE
// 406E7F: control flows out of bounds to 407113
// 407007: control flows out of bounds to 4071D6
// 40734E: control flows out of bounds to 4071A2
// 406F77: control flows out of bounds to 40733F
// 406FAC: control flows out of bounds to 406FCB
// 407031: control flows out of bounds to 406FAA
// 407091: control flows out of bounds to 406F82
// 4070E4: control flows out of bounds to 407280
// 407335: control flows out of bounds to 406E6C
// 40713D: conditional instruction was optimized away because edi.4==608A9EF1
// 406E96: variable '_ECX' is possibly undefined
// 406EC1: variable '_EDX' is possibly undefined
// 406F61: variable 'v57' is possibly undefined
// 407284: variable 'v50' is possibly undefined

//----- (00407317) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_407317()
{
  JUMPOUT(0x40711E);
}
// 407318: positive sp value 4 has been found
// 40731D: control flows out of bounds to 40711E

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
