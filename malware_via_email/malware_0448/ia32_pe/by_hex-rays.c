/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start(); // weak
void __noreturn sub_4010D3();
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// LPSTR __stdcall GetCommandLineA();
// double __usercall sub_405081@<st0>(unsigned int a1@<eax>, unsigned int a2@<ecx>, double a3@<st5>, double a4@<st4>, double a5@<st3>, double a6@<st2>, double a7@<st1>, double a8@<st0>);
double sub_40516B(); // weak

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_405185; // weak


//----- (0040108A) --------------------------------------------------------
void __noreturn start()
{
  LoadLibraryA(0);
  GetCommandLineA();
  sub_4010D3();
}
// 40108A: using guessed type void __noreturn start();

//----- (004010D3) --------------------------------------------------------
void __noreturn sub_4010D3()
{
  struct _EXCEPTION_REGISTRATION_RECORD *v0; // [esp-4h] [ebp-4h] BYREF

  v0 = NtCurrentTeb()->NtTib.ExceptionList;
  __writefsdword(0, (unsigned int)&v0);
  __halt();
}

//----- (00405081) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
double __usercall sub_405081@<st0>(unsigned int a1@<eax>, unsigned int a2@<ecx>, double a3@<st5>, double a4@<st4>, double a5@<st3>, double a6@<st2>, double a7@<st1>, double a8@<st0>)
{
  int v8; // ebx
  unsigned __int8 v9; // cf
  char v10; // zf
  int v11; // edx
  int v14; // ecx
  double v15; // st7
  unsigned int v16; // edi
  unsigned int v17; // ecx
  double v18; // st7
  double result; // st7
  unsigned int v20; // edi
  unsigned int v22; // [esp-14h] [ebp-14h]
  int v23; // [esp-10h] [ebp-10h]
  int *v24; // [esp-8h] [ebp-8h] BYREF
  unsigned int v25; // [esp-4h] [ebp-4h]
  int savedregs; // [esp+0h] [ebp+0h] BYREF
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  v8 = -827213047;
  if ( !__SETP__(-1635855801, 0) )
    v8 = (int)&v24;
  v9 = _bittestandreset((int *)&a2, a1);
  if ( v9 | v10 )
    a1 = a2;
  v11 = savedregs;
  savedregs = 1635855801;
  v25 = a1 + 1;
  v24 = &savedregs;
  v23 = v8;
  v22 = a2;
  _CL = v8 + a2 + 1;
  __asm { repne movsx ebx, cl }
  v14 = _EBX;
  v15 = a3 - a8;
  v16 = a1 + 2;
  if ( (int)(a1 + 2) < 0 != __OFADD__(1, a1 + 1) )
    v14 = _EBX;
  LOWORD(v14) = _EBX + v14;
  ((void (__usercall *)(int@<ecx>, int@<edx>, int, unsigned int, int, unsigned int, int, void **, int *, unsigned int, int, double@<st0>, double@<st1>, double@<st2>, double@<st3>, double@<st4>, double@<st5>))loc_405185)(
    v14,
    _EBX,
    v11,
    a1,
    v11,
    v22,
    v23,
    &retaddr,
    v24,
    v25,
    savedregs,
    v15,
    a7,
    a6,
    a5,
    a4,
    a3);
  v18 = sub_40516B();
  result = v18 - v18;
  v20 = v17 + v16 + 1;
  if ( !__SETP__(v20, 0) )
    v20 = v17;
  v9 = _bittestandreset((int *)&v17, v20);
  __asm { repne pop edi }
  ((void (__thiscall *)(unsigned int))sub_40516B)(v17 + 1 - (v9 - 1847447033));
  return result;
}
// 4050F9: positive sp value 8 has been found
// 4050E1: variable 'v10' is possibly undefined
// 40514C: variable 'v17' is possibly undefined
// 40516B: using guessed type double sub_40516B();

//----- (0040516B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40516B()
{
  JUMPOUT(0x405185);
}
// 405177: positive sp value 4 has been found
// 405183: control flows out of bounds to 405185

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
