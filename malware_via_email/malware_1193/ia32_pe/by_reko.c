// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401030: Register (ptr byte) fn00401030(Stack Eq_3 dwArg04, Stack Eq_3 dwArg08, Stack Eq_3 dwArg0C)
byte * fn00401030(Eq_3 dwArg04, Eq_3 dwArg08, Eq_3 dwArg0C)
{
	&globals->t4072E8.u0->unused = 0x00;
	while (globals->t4072E8 < dwArg0C)
	{
		edx = dwArg04 + Mem6[4223720:word32];
		Mem25[edx + 0x00:byte] = Mem6[dwArg08 + Mem6[4223720:word32]:byte];
		globals->t4072E8 = (word32) globals->t4072E8 + 0x01;
	}
	return edx;
}

// 004010C0: Register Eq_28 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	Eq_3 dwLoc18_19 = GetModuleHandleA(0x00);
	LoadIconA(null, 0x7F00);
	&globals->t4072E8.u0->unused = 1169;
	globals->t4072F0 = dwArg04;
	if ((globals->t4072F0 & 0xFFFF) != 0x00)
		globals->dw407300 = 0x00;
	else
		globals->dw407300 = 0x01;
	if (globals->t4072F0 == 0x00)
		globals->dw407300 = 0x00;
	if (globals->dw407300 != 0x00)
		dwLoc18_19 = globals->t4072F0;
	GetWindowsDirectoryA(fp - 332, 0xE6);
	lstrcatA(fp - 332, 4223632);
	if (CreateFileA(fp - 332, 0x80, 0x03, null, 0x03, 0x80, null) != (void *) ~0x00)
	{
		lstrcatA(fp - 332, 4223652);
		word32 * esp_154 = fp - 0x01B4;
		if (CreateFileA(fp - 332, 0x80, 0x03, null, 0x03, 0x80, null) == (void *) ~0x00)
		{
			&globals->t4072E8.u0->unused = 0x0222;
			&globals->t4072E8.u0->unused = 6846;
			struct Eq_137 * dwLoc08_166 = null;
			while (dwLoc08_166 < (struct Eq_137 *) 0x5200)
			{
				esp_154 = esp_154 - 0x04;
				*esp_154 = 0x00;
				GetModuleHandleA(*esp_154);
				dwLoc08_166->dw402001 = dwLoc08_166 + dwLoc08_166->dw402001 / 0x08;
				dwLoc08_166->dw402001 = (char *) &dwLoc08_166->dw402001 + 41364171 ^ dwLoc08_166->dw402001;
				dwLoc08_166 = dwLoc08_166 + 0x01;
			}
			union Eq_3 * esp_197 = esp_154 - 0x04;
			*esp_197 = (union Eq_3 *) 0x5200;
			globals->ptr4072FC = fn004019B0(dwArg00);
			*esp_197 = (union Eq_3 *) 0x5200;
			*(esp_197 - 0x04) = 0x00402001;
			*(esp_197 - 0x08) = (struct Eq_152 **) globals->ptr4072FC;
			fn00401030(dwArg00, dwArg04, dwArg08);
			globals->dw4072EC = edi;
			globals->dw4072E4 = esi;
			globals->dw4072F8 = ebx;
			globals->ptr407308 = fs->ptr0018;
			globals->ptr4072F4 = fp - 0x04;
			*esp_197 = (union Eq_3 *) 0x004072C0;
			globals->t407304 = GetModuleHandleA(*esp_197);
			Eq_205 dwLoc08_229 = 0x00;
			while (dwLoc08_229 < 0x07)
			{
				*(esp_197 - 0x04) = dwLoc08_229 *s 0x13 + 0x00407208;
				*(esp_197 - 0x08) = (union Eq_3 *) globals->t407304;
				(&globals->ptr407320)[dwLoc08_229] = fn00401350(dwArg00, dwArg04);
				dwLoc08_229 = (word32) dwLoc08_229 + 0x01;
			}
			*(esp_197 - 0x04) = (union Eq_3 *) dwLoc18_19;
			Mem264[esp_197 - 0x08 + 0x00:word32] = 4199163 - dwLoc18_19;
			word32 ebp_265 = fn004019E0(fp - 0x04, dwArg00, dwArg04);
			struct Eq_152 * ecx_268 = globals->ptr4072FC;
			*(esp_197 - 0x04) = (struct Eq_152 **) ecx_268;
			word32 eax_271 = fn004013A0(ebp_265, dwArg00);
			struct Eq_191 * esp_275 = globals->ptr4072F4;
			if (globals->dw407300 != 0x00)
				esp_275->ptr0008 = globals->ptr4072FC;
			word32 esp_279;
			word32 ebp_280;
			byte SCZO_281;
			word32 ebx_282;
			word32 esi_283;
			word32 edi_284;
			Eq_28 eax_285;
			byte SZO_286;
			byte C_287;
			byte Z_288;
			word32 ecx_289;
			word32 edx_290;
			struct Eq_317 * fs_291;
			globals->ptr40733C();
			return eax_285;
		}
	}
	return 0x00;
}

// 00401350: Register Eq_325 fn00401350(Stack Eq_3 dwArg04, Stack Eq_3 dwArg08)
FARPROC fn00401350(Eq_3 dwArg04, Eq_3 dwArg08)
{
	return GetProcAddress(dwArg04, dwArg08);
}

// 00401370: Register word32 fn00401370(Stack Eq_3 dwArg04)
word32 fn00401370(Eq_3 dwArg04)
{
	&globals->t4072E8.u0->unused = 0x01;
	word32 * edx_13 = (word32) dwArg04 + 0x0078 + globals->t4072E8 * 0x08;
	GetCommandLineA();
	return *edx_13;
}

// 004013A0: Register word32 fn004013A0(Register word32 ebp, Stack Eq_3 dwArg04)
word32 fn004013A0(word32 ebp, Eq_3 dwArg04)
{
	if (globals->dw407300 != 0x00)
	{
		Eq_3 eax_756 = globals->t4072F0;
		dwLoc08 = (word32) *((word32) *((word32) eax_756 + 0x003C) + ((word32) eax_756 + 0x0050));
	}
	word32 ecx_20 = dwArg04 + Mem0[dwArg04 + 0x3C:word32];
	struct Eq_360 * edx_26 = &ecx_20->w0014 + 0x02 + (word32) ecx_20->w0014 / 0x0040;
	struct Eq_360 * dwLoc28_27 = edx_26;
	ptr32 esp_38;
	word32 ebp_39;
	byte SCZO_40;
	word32 esi_41;
	byte Z_42;
	struct Eq_152 * eax_43;
	word32 ecx_44;
	word32 edx_45;
	byte C_46;
	byte SZO_47;
	word16 cx_48;
	globals->ptr40732C();
	*(esp_38 - 0x04) = (word32) *((word32) dwArg04 + 0x003C) + 0x0138 + (word32) ecx_20->w0006 *s 0x28;
	*(esp_38 - 0x08) = (union Eq_3 *) dwArg04;
	*(esp_38 - 0x0C) = (struct Eq_152 **) eax_43;
	fn00401030(dwArg00, dwArg04, dwArg08);
	uint32 dwLoc14_70 = 0x00;
	while (dwLoc14_70 < (word32) ecx_20->w0006)
	{
		if (dwLoc28_27->dw0014 != 0x00 && dwLoc28_27->dw0010 != 0x00)
		{
			*(esp_38 - 0x04) = (uint32) ((uint64) (uint32) ((word32) ecx_20->t003C + (dwLoc28_27->dw0010 - 0x01)) /u ecx_20->t003C) *s ecx_20->t003C;
			*(esp_38 - 0x08) = (word32) dwArg04 + dwLoc28_27->dw0014;
			*(esp_38 - 0x0C) = eax_43 + dwLoc28_27->dw000C / 0x0040;
			fn00401030(dwArg00, dwArg04, dwArg08);
		}
		dwLoc28_27 = dwLoc28_27 + 0x01;
		dwLoc14_70 = dwLoc14_70 + 0x01;
	}
	word32 dwLoc10_147;
	struct Eq_432 * ecx_134 = eax_43 + eax_43->dw003C / 0x0040;
	*(esp_38 - 0x04) = (struct Eq_432 **) ecx_134;
	ptr32 esp_141 = esp_38;
	struct Eq_443 * dwLocB8_144 = eax_43 + fn00401370(dwArg00) / 0x0040;
	if (globals->dw407300 == 0x00)
	{
		*(esp_38 - 0x04) = 0x00;
		word32 ecx_727 = ecx_134->dw0050;
		*(esp_38 - 0x08) = ecx_727;
		*(esp_38 - 0x0C) = 0x00;
		*(esp_38 - 0x10) = 0x04;
		*(esp_38 - 0x14) = 0x00;
		*(esp_38 - 0x18) = ~0x00;
		word32 ebp_744;
		byte SCZO_745;
		word32 esi_746;
		byte Z_747;
		word32 eax_748;
		word32 ecx_749;
		word32 edx_750;
		byte C_751;
		byte SZO_752;
		word16 cx_753;
		globals->ptr407324();
		dwLoc10_147 = eax_748;
	}
	else
		dwLoc10_147 = 0x00;
	while (dwLocB8_144->dw0010 != 0x00)
	{
		word32 * dwLoc34_188;
		ui32 * dwLoc24_187;
		ptr32 ecx_167 = eax_43 + dwLocB8_144->dw000C / 0x0040;
		ptr32 * esp_169 = esp_141 - 0x04;
		*esp_169 = ecx_167;
		ptr32 esp_171;
		word32 ebp_172;
		byte SCZO_173;
		word32 esi_174;
		byte Z_175;
		word32 eax_176;
		word32 ecx_177;
		word32 edx_178;
		byte C_179;
		byte SZO_180;
		word16 cx_181;
		globals->ptr407338();
		GetCommandLineA();
		if (dwLocB8_144->dw0000 != 0x00)
		{
			dwLoc24_187 = (ui32 *) (eax_43 + dwLocB8_144->dw0000 / 0x0040);
			GetCommandLineA();
			dwLoc34_188 = (word32 *) (eax_43 + dwLocB8_144->dw0010 / 0x0040);
		}
		else
		{
			dwLoc24_187 = (ui32 *) (eax_43 + dwLocB8_144->dw0010 / 0x0040);
			GetCommandLineA();
			dwLoc34_188 = (word32 *) (eax_43 + dwLocB8_144->dw0000 / 0x0040);
		}
		word32 dwLoc18_191 = 0x00;
		if (dwLocB8_144->dw0010 != 0x00 && dwLocB8_144->dw0000 != 0x00)
			dwLoc18_191 = 0x01;
		while (true)
		{
			esp_141 = esp_171;
			if (*dwLoc24_187 == 0x00)
				break;
			if ((*dwLoc24_187 & 0x80000000) != 0x00)
			{
				*(esp_171 - 0x04) = *dwLoc24_187 & 0x7FFFFFFF;
				*(esp_171 - 0x08) = eax_176;
				*dwLoc24_187 = fn00401350(dwArg00, dwArg04);
			}
			else
			{
				*(esp_171 - 0x04) = eax_43 + (*dwLoc24_187 + 0x02) / 0x0040;
				*(esp_171 - 0x08) = eax_176;
				*dwLoc24_187 = fn00401350(dwArg00, dwArg04);
			}
			if (dwLoc18_191 != 0x00)
				*dwLoc34_188 = *dwLoc24_187;
			GetCommandLineA();
			dwLoc24_187 = dwLoc24_187 + 0x01;
			dwLoc34_188 = dwLoc34_188 + 0x01;
		}
		GetCommandLineA();
		dwLocB8_144 = dwLocB8_144 + 0x01;
	}
	if (globals->dw407300 == 0x00)
	{
		Eq_3 eax_695 = ecx_134->t0034;
		union Eq_3 * esp_697 = esp_141 - 0x04;
		*esp_697 = (union Eq_3 *) eax_695;
		*(esp_697 - 0x04) = 0x00;
		*(esp_697 - 0x08) = 0x00;
		*(esp_697 - 0x0C) = 0x00;
		*(esp_697 - 0x10) = 0x22;
		*(esp_697 - 0x14) = dwLoc10_147;
		word32 ebp_711;
		byte SCZO_712;
		word32 esi_713;
		byte Z_714;
		struct Eq_152 * eax_715;
		word32 ecx_716;
		word32 edx_717;
		byte C_718;
		byte SZO_719;
		word16 cx_720;
		globals->ptr407334();
		globals->ptr4072E0 = eax_715;
	}
	else
		globals->ptr4072E0 = null;
	word32 eax_324;
	if (globals->ptr4072E0 == null)
	{
		if (globals->dw407300 != 0x00)
			dwLoc0C = globals->t4072F0;
		else
			dwLoc0C = ecx_134->t0034;
		union Eq_3 * esp_550 = esp_141 - 0x04;
		*esp_550 = (union Eq_3 *) dwLoc0C;
		word32 ebp_553;
		byte SCZO_554;
		word32 esi_555;
		byte Z_556;
		word32 eax_557;
		word32 ecx_558;
		word32 edx_559;
		byte C_560;
		byte SZO_561;
		word16 cx_562;
		ptr32 esp_552;
		globals->ptr407320();
		if (eax_557 == 0x00)
		{
			*(esp_552 - 0x04) = 0x8000;
			*(esp_552 - 0x08) = 0x00;
			*(esp_552 - 0x0C) = (union Eq_3 *) dwLoc0C;
			word32 ebp_670;
			byte SCZO_671;
			word32 esi_672;
			byte Z_673;
			word32 eax_674;
			word32 ecx_675;
			word32 edx_676;
			byte C_677;
			byte SZO_678;
			word16 cx_679;
			globals->ptr407330();
			if (eax_674 == 0x00)
			{
				eax_324 = 0x00;
				return eax_324;
			}
		}
		if (globals->dw407300 == 0x00)
		{
			Eq_3 edx_578 = ecx_134->t0034;
			union Eq_3 * esp_579 = esp_552 - 0x04;
			*esp_579 = (union Eq_3 *) edx_578;
			*(esp_579 - 0x04) = 0x00;
			*(esp_579 - 0x08) = 0x00;
			*(esp_579 - 0x0C) = 0x00;
			*(esp_579 - 0x10) = 0x22;
			*(esp_579 - 0x14) = dwLoc10_147;
			word32 ebp_593;
			byte SCZO_594;
			word32 esi_595;
			byte Z_596;
			struct Eq_152 * eax_597;
			word32 ecx_598;
			word32 edx_599;
			byte C_600;
			byte SZO_601;
			word16 cx_602;
			globals->ptr407334();
			globals->ptr4072E0 = eax_597;
			if (globals->ptr4072E0 == null)
			{
				*(esp_141 - 0x04) = 0x40;
				*(esp_141 - 0x08) = 0x3000;
				word32 edx_622 = ecx_134->dw0050;
				*(esp_141 - 0x0C) = edx_622;
				Eq_3 ecx_626 = ecx_134->t0034;
				*(esp_141 - 0x10) = (union Eq_3 *) ecx_626;
				word32 ebp_630;
				byte SCZO_631;
				word32 esi_632;
				byte Z_633;
				struct Eq_152 * eax_634;
				word32 ecx_635;
				word32 edx_636;
				byte C_637;
				byte SZO_638;
				word16 cx_639;
				globals->ptr40732C();
				globals->ptr4072E0 = eax_634;
			}
		}
		else
		{
			word32 * esp_641 = esp_552 - 0x04;
			*esp_641 = 0x40;
			*(esp_641 - 0x04) = 0x3000;
			*(esp_641 - 0x08) = dwLoc08;
			*(esp_641 - 0x0C) = (union Eq_3 *) dwLoc0C;
			word32 ebp_652;
			byte SCZO_653;
			word32 esi_654;
			byte Z_655;
			word32 eax_656;
			word32 ecx_657;
			word32 edx_658;
			byte C_659;
			byte SZO_660;
			word16 cx_661;
			globals->ptr40732C();
		}
	}
	if (globals->dw407300 == 0x00)
	{
		word32 * esp_366 = esp_141 - 0x04;
		*esp_366 = ecx_134->dw0050;
		*(esp_366 - 0x04) = (struct Eq_152 **) eax_43;
		struct Eq_152 * ecx_371 = globals->ptr4072E0;
		*(esp_366 - 0x08) = (struct Eq_152 **) ecx_371;
		fn00401030(dwArg00, dwArg04, dwArg08);
		*esp_366 = dwLoc10_147;
		ptr32 esp_385;
		word32 ebp_386;
		byte SCZO_387;
		word32 esi_388;
		byte Z_389;
		word32 eax_390;
		word32 ecx_391;
		word32 edx_392;
		byte C_393;
		byte SZO_394;
		word16 cx_395;
		globals->ptr407328();
		*(esp_385 - 0x04) = (struct Eq_152 **) globals->ptr4072E0;
		fn00401B30(dwArg00);
		Mem404[0x0040733C:word32] = Mem398[0x004072E0:word32] + Mem398[ecx_134 + 0x28:word32];
		ecx_134->ptr0028 = globals->ptr40733C;
	}
	else
	{
		globals->ptr4072E0 = eax_43;
		ptr32 ecx_412 = eax_43 - ecx_134->t0034;
		if (ecx_134->dw00A4 != 0x00)
		{
			struct Eq_1172 * dwLoc20_476 = eax_43 + ecx_134->dw00A0 / 0x0040;
			while (dwLoc20_476->t0004 != 0x00)
			{
				uint32 ecx_491 = dwLoc20_476->t0004 - 0x08 >> 0x01;
				word16 edx_494[] = (char *) &dwLoc20_476->t0004 + 0x04;
				uint32 dwLoc14_497 = 0x00;
				while (dwLoc14_497 < ecx_491)
				{
					if ((word32) edx_494[dwLoc14_497] >> 0x0C == 0x03)
						(eax_43 + dwLoc20_476->dw0000 / 0x0040)[((word32) edx_494[dwLoc14_497] & 0x0FFF) / 0x0040] = (struct Eq_152) ((eax_43 + dwLoc20_476->dw0000 / 0x0040)[((word32) edx_494[dwLoc14_497] & 0x0FFF) / 0x0040].a0000 + ecx_412).a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000;
					dwLoc14_497 = dwLoc14_497 + 0x01;
				}
				dwLoc20_476 = dwLoc20_476 + Mem409[dwLoc20_476 + 0x04:word32];
			}
		}
		Mem427[0x0040733C:word32] = Mem409[0x004072E0:word32] + Mem409[ecx_134 + 0x28:word32];
		word32 ecx_430 = dwLoc0C + Mem427[ecx_134 + 0x28:word32];
		ecx_134->w0016 = (word16) ((word32) ecx_134->w0016 | 0x2000);
		PDWORD * esp_441 = esp_141 - 0x04;
		*esp_441 = (PDWORD *) (fp - 0xC0);
		*(esp_441 - 0x04) = 0x40;
		*(esp_441 - 0x08) = 0x06;
		*(esp_441 - 0x0C) = (struct Eq_1059 **) ecx_430;
		VirtualProtect(*(esp_441 - 0x0C), *(esp_441 - 0x08), *(esp_441 - 0x04), *esp_441);
		ecx_430->b0000 = 0x68;
		ecx_430->ptr0001 = globals->ptr40733C;
		ecx_430->b0005 = 0xC3;
		globals->ptr4072FC = globals->ptr4072E0;
		*(esp_441 - 0x10) = (struct Eq_152 **) globals->ptr4072E0;
		Mem466[esp_441 - 0x14 + 0x00:word32] = Mem460[0x004072E0:word32] + Mem460[ecx_134 + 0x28:word32];
		*(esp_441 - 0x18) = (union Eq_3 *) globals->t4072F0;
		fn00401930(dwArg00, dwArg04, dwArg08);
	}
	eax_324 = 0x01;
	return eax_324;
}

// 00401930: void fn00401930(Stack Eq_3 dwArg04, Stack Eq_3 dwArg08, Stack Eq_3 dwArg0C)
void fn00401930(Eq_3 dwArg04, Eq_3 dwArg08, Eq_3 dwArg0C)
{
	struct Eq_1237 * ecx_14 = globals->ptr407308->ptr0030->ptr000C->ptr000C;
	struct Eq_1237 * dwLoc0C_15 = ecx_14;
	while (0x01 != 0x00 && dwLoc0C_15 != null)
	{
		if (dwLoc0C_15->t0018 == dwArg04)
		{
			dwLoc0C_15->t001C = dwArg08;
			dwLoc0C_15->t0018 = dwArg0C;
			return;
		}
		struct Eq_1237 * edx_57 = dwLoc0C_15->ptr0000;
		dwLoc0C_15 = edx_57;
		if (edx_57 == ecx_14)
			return;
	}
}

// 004019B0: Register Eq_1102 fn004019B0(Stack Eq_3 dwArg04)
LPVOID fn004019B0(Eq_3 dwArg04)
{
	GetCommandLineA();
	return HeapAlloc(GetProcessHeap(), 0x00, dwArg04);
}

// 004019E0: Register ptr32 fn004019E0(Register ptr32 ebp, Stack Eq_3 dwArg04, Stack Eq_3 dwArg08)
ptr32 fn004019E0(ptr32 ebp, Eq_3 dwArg04, Eq_3 dwArg08)
{
	word32 edx_16 = dwArg08 + Mem0[dwArg08 + 0x3C:word32];
	ptr32 esp_29;
	ptr32 ebp_30;
	byte SCZO_31;
	word32 esi_32;
	struct Eq_152 * eax_33;
	word32 ecx_34;
	word32 edx_35;
	byte Z_36;
	byte C_37;
	byte SZO_38;
	globals->ptr40732C();
	globals->ptr4072E0 = eax_33;
	if (globals->ptr4072E0 != null)
	{
		*(esp_29 - 0x04) = edx_16->dw0050;
		*(esp_29 - 0x08) = (union Eq_3 *) dwArg08;
		*(esp_29 - 0x0C) = (struct Eq_152 **) globals->ptr4072E0;
		fn00401030(dwArg00, dwArg04, dwArg08);
		ui32 eax_82 = globals->ptr4072E0 - dwArg08;
		if (edx_16->dw00A4 != 0x00)
		{
			struct Eq_1346 * dwLoc0C_109 = (word32) dwArg08 + edx_16->dw00A0;
			while (dwLoc0C_109->t0004 != 0x00)
			{
				uint32 eax_124 = dwLoc0C_109->t0004 - 0x08 >> 0x01;
				word16 ecx_127[] = (char *) &dwLoc0C_109->t0004 + 0x04;
				uint32 dwLoc08_130 = 0x00;
				while (dwLoc08_130 < eax_124)
				{
					if ((word32) ecx_127[dwLoc08_130] >> 0x0C == 0x03)
						(globals->ptr4072E0 + dwLoc0C_109->dw0000 / 0x0040)[((word32) ecx_127[dwLoc08_130] & 0x0FFF) / 0x0040] = (struct Eq_152) ((globals->ptr4072E0 + dwLoc0C_109->dw0000 / 0x0040)[((word32) ecx_127[dwLoc08_130] & 0x0FFF) / 0x0040].a0000 + eax_82).a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000.a0000;
					dwLoc08_130 = dwLoc08_130 + 0x01;
				}
				dwLoc0C_109 = dwLoc0C_109 + Mem76[dwLoc0C_109 + 0x04:word32];
			}
		}
		Mem101[esp_29 - 0x04 + 0x00:word32] = dwArg04 + Mem76[0x004072E0:word32];
		return ebp_30;
	}
	else
		return ebp;
}

// 00401B30: void fn00401B30(Stack Eq_3 dwArg04)
void fn00401B30(Eq_3 dwArg04)
{
	globals->ptr407308->ptr0030->t0008 = dwArg04;
}

