/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// unsigned int __usercall sub_401023@<eax>(int a1@<eax>, int a2@<ebx>, char *a3@<edi>);
// void __usercall sub_401982(int a1@<eax>);
// void __usercall __spoils<ecx> sub_4019B1(int a1@<ebx>, int a2@<edi>);
// unsigned int __usercall sub_401AA6@<eax>(__m128i a1@<xmm2>);


//----- (00401000) --------------------------------------------------------
#error "401000: stack frame is too big (funcsize=0)"

//----- (00401023) --------------------------------------------------------
unsigned int __usercall sub_401023@<eax>(int a1@<eax>, int a2@<ebx>, char *a3@<edi>)
{
  int v3; // ecx
  int v4; // edx
  unsigned int result; // eax

  v3 = MEMORY[0x7FFE02D0];
  if ( MEMORY[0x7FFE02D0] == 274 )
    v3 = MEMORY[0x7FFE02D0] - 2;
  if ( !v3 )
    v3 = 272;
  if ( v3 > 512 )
    v3 -= 512;
  v4 = -10691665 * v3;
  sub_4019B1(a2, (int)a3);
  result = a1 - v4;
  _mm_maskmoveu_si128(_mm_cvtsi32_si128(result), _mm_cvtsi32_si128(0xFFFFFFFF), a3);
  return result;
}

//----- (00401982) --------------------------------------------------------
void __usercall sub_401982(int a1@<eax>)
{
  int v1; // ecx
  int i; // edx

  v1 = a1 + _mm_cvtsi128_si32(_mm_cvtsi32_si128(0xFCB2D082));
  for ( i = 0; i != 55391318; ++i )
    ++v1;
}

//----- (004019B1) --------------------------------------------------------
void __usercall __spoils<ecx> sub_4019B1(int a1@<ebx>, int a2@<edi>)
{
  int v2; // edx
  int v3; // ecx
  int (__cdecl *v4)(int, int, int, int, int *, _DWORD); // eax
  unsigned int v5; // eax
  void (__stdcall *v6)(int, int, int, unsigned int, int *, int, int, int, int, int); // [esp-38h] [ebp-68h]
  int v7; // [esp-34h] [ebp-64h]
  int v8; // [esp-30h] [ebp-60h]
  int v9; // [esp-2Ch] [ebp-5Ch]
  int v10; // [esp-28h] [ebp-58h]
  int v11; // [esp-28h] [ebp-58h]
  int v12; // [esp-24h] [ebp-54h]
  char v13[34]; // [esp+4h] [ebp-2Ch] BYREF
  int v14; // [esp+26h] [ebp-Ah] BYREF
  int v15; // [esp+2Ah] [ebp-6h]

  strcpy(v13, "VirtualProtectEx");
  v13[17] = 75;
  v13[18] = 0;
  v13[19] = 101;
  v13[20] = 0;
  v13[21] = 82;
  v13[22] = 0;
  v13[23] = 110;
  v13[24] = 0;
  v13[25] = 69;
  v13[26] = 0;
  v13[27] = 108;
  v13[28] = 0;
  v13[29] = 51;
  v13[30] = 0;
  v13[31] = 50;
  v13[32] = 0;
  v13[33] = 0;
  v14 = 0;
  v15 = 0;
  v2 = 0;
  v3 = 9080;
  do
  {
    v10 = v2;
    v3 += (*(int (**)(void))(a1 + 9096))();
    v2 = v10 + 1;
  }
  while ( v10 + 1 <= 584 );
  v15 = (*(int (__stdcall **)(char *))(v3 + a1 - 585))(&v13[17]);
  v4 = (int (__cdecl *)(int, int, int, int, int *, _DWORD))(*(int (__stdcall **)(int, char *))(a1 + 9076))(v15, v13);
  v5 = v4(-1, a2, 16, 4, &v14, v4);
  v6(
    -1,
    a2,
    16,
    (unsigned int)_mm_cvtsi128_si32(_mm_shuffle_epi32(_mm_shufflelo_epi16(_mm_cvtsi32_si128(v5), 64), 68)) >> 16 << 6,
    &v14,
    v7,
    v8,
    v9,
    v11,
    v12);
}
// 401AA1: variable 'v6' is possibly undefined
// 401AA1: variable 'v7' is possibly undefined
// 401AA1: variable 'v8' is possibly undefined
// 401AA1: variable 'v9' is possibly undefined
// 401AA1: variable 'v11' is possibly undefined
// 401AA1: variable 'v12' is possibly undefined

//----- (00401AA6) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
unsigned int __usercall sub_401AA6@<eax>(__m128i a1@<xmm2>)
{
  int v1; // edx
  int v2; // ebx
  double *v3; // eax
  char *v4; // esi
  char *v5; // edi
  unsigned int result; // eax
  int v7; // ecx
  int v8; // eax
  int v9; // [esp-8h] [ebp-8h]

  v1 = v9;
  LOBYTE(v1) = 0;
  while ( (*(_BYTE *)(v1 + 1) ^ 0x78) != 34 )
    v1 -= 4096;
  v2 = v1;
  sub_401982(0);
  a1.m128i_i64[0] = *(__int64 *)v3;
  v4 = (char *)(v2 - _mm_cvtsi128_si32(a1));
  v5 = v4;
  do
  {
    v8 = *(_DWORD *)v4;
    v4 += 4;
    result = sub_401023(v8 - 4491470, v2, v5);
  }
  while ( v7 != 1 );
  return result;
}
// 401AC4: positive sp value 8 has been found
// 401AA8: variable 'v9' is possibly undefined
// 401AD0: variable 'v3' is possibly undefined
// 401AFB: variable 'v7' is possibly undefined

// nfuncs=5 queued=5 decompiled=5 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 5 function(s)"
