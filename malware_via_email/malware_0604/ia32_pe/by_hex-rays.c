/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <math.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

_DWORD sub_40103C(); // weak
_DWORD __far sub_401078(); // weak
void sub_401186();
_DWORD start(); // weak
void sub_4012FC();
_DWORD sub_401339(); // weak
void __fastcall sub_402121(int a1, int a2);
// void __userpurge __noreturn sub_4021A4(char a1@<dh>, int a2@<ecx>, int a3@<ebx>, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
_DWORD sub_4021C1(); // weak
void sub_4021E2();
// __int16 __usercall sub_4021FB@<ax>(__int16 result@<ax>, __int16 a2@<dx>, __int16 a3@<di>);
// void __userpurge sub_402218(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int edi0@<edi>, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62);
void __noreturn sub_4023D9(); // weak
// void __usercall sub_402411(int a1@<eax>, __int16 a2@<dx>, __int16 a3@<cx>, __int16 a4@<bx>, int *a5@<edi>);
// double __userpurge sub_4024B5@<st0>(__int16 a1@<ax>, int _EDX@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<ebp>, int a6@<edi>, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
double sub_402658(); // weak
int sub_402697();
_DWORD __far sub_4026B0(); // weak
void sub_4026D0();
// int __usercall sub_40278B@<eax>(__int16 a1@<ax>, int a2@<edx>, char a3@<bh>);
void sub_40280E();
void sub_402869();
void sub_4028C7();
void sub_402982();
_DWORD __far sub_402A9D(); // weak
// void __usercall sub_402B71(int a1@<ebp>);
double sub_402C30(); // weak
// void __usercall sub_402CD1(char a1@<cf>, int a2@<edx>, int a3@<ecx>, char a4@<ah>, char a5@<bl>);
// void __usercall __noreturn sub_402CE1(char a1@<cf>, char a2@<ah>, int a3@<ecx>);
// void __userpurge sub_402D45(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>, double a7@<st0>, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
void sub_402D84();
// void __userpurge sub_402D9B(int a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
// void __usercall sub_402F77(int a1@<eax>, char a2@<dh>, __int16 a3@<cx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>);
void sub_402FF2();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401285; // weak
_UNKNOWN loc_4020E7; // weak
_UNKNOWN loc_402310; // weak
_UNKNOWN loc_402389; // weak
_UNKNOWN loc_40258E; // weak
_UNKNOWN loc_402B4E; // weak
_UNKNOWN sub_402BE0; // weak
_UNKNOWN loc_402BF8; // weak
_UNKNOWN loc_403012; // weak


//----- (0040103C) --------------------------------------------------------
#error "4012CA: cannot convert to microcode (funcsize=15)"

//----- (00401078) --------------------------------------------------------
#error "401078: function frame is wrong (funcsize=0)"

//----- (00401186) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401186()
{
  int v1; // [esp+8h] [ebp-8h]
  int v2; // [esp+Ch] [ebp-4h]

  *(&v2 - 5) = v1;
  _RAX = ((__int64 (*)(void))((char *)&loc_401285 + 3))();
  LODWORD(_RAX) = *(_DWORD *)(HIDWORD(_RAX) - 66) | _RAX;
  __asm { daa }
  JUMPOUT(0x4011A7);
}
// 4011A5: positive sp value 8 has been found
// 4011A5: control flows out of bounds to 4011A7

//----- (004011D0) --------------------------------------------------------
#error "40106B: cannot convert to microcode (funcsize=25)"

//----- (004012FC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4012FC()
{
  JUMPOUT(0x40108F);
}
// 401300: positive sp value 4 has been found
// 401311: control flows out of bounds to 40108F

//----- (00401339) --------------------------------------------------------
#error "401354: cannot convert to microcode (funcsize=12)"

//----- (00402121) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_402121(int a1, int a2)
{
  __asm { rep pop ebx }
  _EAX = ((int (__fastcall *)(_BYTE, int, _DWORD))((char *)&loc_402389 + 2))(BYTE1(_EBX) + 1, a2 - 1, 0);
  __asm { rcr     byte ptr [eax+21h], 1 }
  JUMPOUT(0x40230C);
}
// 402126: positive sp value 4 has been found
// 402309: control flows out of bounds to 40230C

//----- (004021A4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __userpurge __noreturn sub_4021A4(char a1@<dh>, int a2@<ecx>, int a3@<ebx>, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  int v64; // ecx
  bool v65; // cf
  void *v66; // [esp+18h] [ebp-4h]
  void *retaddr; // [esp+1Ch] [ebp+0h]

  *(&retaddr - 8) = v66;
  v64 = a2 - a3;
  LOBYTE(v64) = -(char)v64;
  v65 = (unsigned __int8)v64 < (unsigned __int8)(((_BYTE)v64 != 0) - 23);
  LOBYTE(v64) = v64 - (((_BYTE)v64 != 0) - 23);
  sub_402CE1(v65, a1, v64);
}
// 4021A8: positive sp value 4 has been found
// 4021A4: too many input arguments, some ignored

//----- (004021C1) --------------------------------------------------------
#error "4021D5: cannot convert to microcode (funcsize=8)"

//----- (004021E2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4021E2()
{
  void *v0; // [esp+14h] [ebp-4h]
  void *retaddr; // [esp+18h] [ebp+0h]

  *(&retaddr - 7) = v0;
  JUMPOUT(0x4024D9);
}
// 4021E6: positive sp value 4 has been found
// 4021F0: control flows out of bounds to 4024D9

//----- (004021FB) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
__int16 __usercall sub_4021FB@<ax>(__int16 result@<ax>, __int16 a2@<dx>, __int16 a3@<di>)
{
  HIBYTE(result) = ((result + a3) ^ a2) + ((unsigned __int16)((result + a3) ^ a2) >> 8);
  return result;
}
// 402202: positive sp value 4 has been found

//----- (00402218) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __userpurge sub_402218(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int edi0@<edi>, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62)
{
  int v64; // eax
  int v65; // eax
  int v66; // ebx
  bool v67; // cf
  int v68; // ecx
  char v69; // tt
  int v70; // eax
  int v71; // esi
  double v72; // st7
  int v73; // eax
  int v74; // edx
  int v75; // ecx
  int v76; // [esp+1Ch] [ebp-Ch]
  int v77; // [esp+20h] [ebp-8h]
  int v78; // [esp+24h] [ebp-4h]

  *(&v77 - 11) = v76;
  BYTE1(a3) = -BYTE1(a3);
  LOBYTE(a4) = BYTE1(a3) ^ a4;
  BYTE1(a1) += 56;
  v64 = a4 ^ a1;
  BYTE1(v64) = 82;
  BYTE1(a3) = -BYTE1(a3) - 1;
  v65 = a2 - 2858 + a4 + v64;
  v66 = a4 + 1;
  v67 = __CFADD__(v65, a3);
  v68 = v65 + a3 + 1;
  v69 = v67 + 116;
  v67 = BYTE1(v68) < (unsigned __int8)(v67 + 116);
  BYTE1(v68) -= v69;
  LOBYTE(v66) = v66 - (v67 + 20);
  v70 = ((int (__thiscall *)(int, int))((char *)&loc_4020E7 + 3))(v68, v77);
  LOBYTE(v70) = v70 | 0x54;
  v71 = *(_DWORD *)((v70 >> 31) + v70 - 639860703);
  v72 = ((double (*)(void))loc_403012)();
  v73 = v78;
  LOBYTE(v73) = v78 | 0x78;
  sub_402D45(
    v73 ^ 0xE9C4C631,
    v74,
    v75,
    v66,
    edi0,
    v71,
    v72,
    a5,
    a6,
    a7,
    a8,
    a9,
    a10,
    a11,
    a12,
    a13,
    a14,
    a15,
    a16,
    a17,
    a18,
    a19,
    a20,
    a21,
    a22,
    a23,
    a24,
    a25,
    a26,
    a27,
    a28,
    a29,
    a30,
    a31,
    a32,
    a33,
    a34,
    a35,
    a36,
    a37,
    a38,
    a39,
    a40,
    a41,
    a42,
    a43,
    a44,
    a45,
    a46,
    a47,
    a48,
    a49,
    a50,
    a51,
    a52,
    a53,
    a54,
    a55,
    a56,
    a57,
    a58,
    a59,
    a60);
}
// 402D3E: positive sp value C has been found
// 402D41: variable 'v74' is possibly undefined
// 402D41: variable 'v75' is possibly undefined
// 402218: too many input arguments, some ignored

//----- (004023D9) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn sub_4023D9()
{
  int v0; // [esp-FE8Fh] [ebp-FEAFh]
  int v1[16290]; // [esp-FE8Bh] [ebp-FEABh]

  v1[-9] = v0;
  sub_402D9B(
    v1[0],
    v1[1],
    v1[2],
    v1[3],
    v1[4],
    v1[5],
    v1[6],
    v1[7],
    v1[8],
    v1[9],
    v1[10],
    v1[11],
    v1[12],
    v1[13],
    v1[14],
    v1[15],
    v1[16],
    v1[17],
    v1[18],
    v1[19],
    v1[20],
    v1[21],
    v1[22],
    v1[23],
    v1[24],
    v1[25],
    v1[26],
    v1[27],
    v1[28],
    v1[29],
    v1[30],
    v1[31],
    v1[32],
    v1[33],
    v1[34],
    v1[35],
    v1[36],
    v1[37],
    v1[38],
    v1[39],
    v1[40],
    v1[41],
    v1[42],
    v1[43],
    v1[44],
    v1[45],
    v1[46],
    v1[47],
    v1[48],
    v1[49],
    v1[50],
    v1[51],
    v1[52],
    v1[53],
    v1[54],
    v1[55],
    v1[56],
    v1[57],
    v1[58],
    v1[59],
    v1[60],
    v1[61],
    v1[62]);
  __debugbreak();
}
// 4023F6: positive sp value FEAF has been found
// 4023D9: using guessed type void __noreturn sub_4023D9();

//----- (00402411) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402411(int a1@<eax>, __int16 a2@<dx>, __int16 a3@<cx>, __int16 a4@<bx>, int *a5@<edi>)
{
  __int16 v5; // ax
  char v6; // zf
  char v7; // sf
  char v8; // of
  __int16 v9; // bx
  int v10; // edx
  int v11; // [esp+4h] [ebp-8h]
  int v12; // [esp+8h] [ebp-4h]

  *(&v12 - 4) = v11;
  v9 = a2 ^ a4;
  v10 = a1;
  LOBYTE(v9) = ~(v9 - 2);
  LOBYTE(a1) = HIBYTE(a3) - (__CFADD__(BYTE1(a1), ~(21 - a3)) + 9);
  v5 = a1 - v9;
  HIBYTE(v5) ^= 3u;
  *a5 = sub_40278B(v5, v10, SHIBYTE(v9));
  if ( !(v7 ^ v8 | v6) )
    JUMPOUT(0x4022F7);
  JUMPOUT(0x402353);
}
// 4022F1: positive sp value 8 has been found
// 4022F6: control flows out of bounds to 4022F7
// 4022F4: control flows out of bounds to 402353
// 4022F4: variable 'v7' is possibly undefined
// 4022F4: variable 'v8' is possibly undefined
// 4022F4: variable 'v6' is possibly undefined

//----- (0040248F) --------------------------------------------------------
#error "40248F: function frame is wrong (funcsize=0)"

//----- (004024B5) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
double __userpurge sub_4024B5@<st0>(__int16 a1@<ax>, int _EDX@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<ebp>, int a6@<edi>, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  int v64; // ecx
  int v65; // ecx
  bool v66; // cf
  char v67; // al
  int v68; // ecx
  int v69; // ecx
  char v70; // al
  int v71; // ecx
  int v72; // edx
  int v73; // esi
  unsigned int v74; // edi
  char v75; // sf
  char v76; // of
  int v77; // ecx
  char v78; // bl
  char v79; // bh
  int v80; // esi
  int v81; // ecx
  _BYTE *v83; // edx
  int v84; // edi
  int v85; // ecx
  int v86; // ebx
  int v87; // eax
  unsigned int v88; // ecx
  char v89; // dh
  _BYTE *v90; // ecx
  char v91; // di
  int v92; // esi
  char v93; // al
  char v94; // al
  char v96; // dl
  char v97; // cl
  __int16 v99; // ax
  bool v100; // cc
  int v101; // ecx
  int v102; // ecx
  int v103; // edx
  int v104; // ecx
  double v105; // st7
  long double v106; // st7
  int v107; // eax
  int v108; // ecx
  bool v109; // zf
  char v110; // cc
  double result; // st7
  int v112; // ecx
  __int16 v113; // ax
  int v114; // ecx
  int v116; // edx
  int v117; // ecx
  bool v118; // zf
  char v119; // al
  char v120; // cc
  int v121; // ebx
  int v122; // eax
  char v123; // cl
  char v124; // dh
  char v125; // cl
  char v126; // cf
  char v127; // pf
  int v128; // eax
  int v129; // [esp-FEABh] [ebp-FEBBh]

  LOBYTE(a4) = HIBYTE(a1) + a4 - 1;
  LOBYTE(a1) = -(char)a1;
  v79 = ~BYTE1(a4);
  LOBYTE(a3) = -96;
  v80 = a3;
  if ( !(((char)(BYTE1(_EDX) + v79) < 0) ^ __OFADD__(BYTE1(_EDX), v79) | (BYTE1(_EDX) + v79 == 0))
    && ((char)(BYTE1(_EDX) + v79) < 0) ^ __OFADD__(BYTE1(_EDX), v79) | (BYTE1(_EDX) + v79 == 0) )
  {
    v81 = a3 - 1;
    if ( !(BYTE1(_EDX) + v79) || !v81 )
    {
      __asm { insb }
      JUMPOUT(0x402283);
    }
    sub_4026D0();
    *(_BYTE *)(v122 - 636777275) = __ROL1__(*(_BYTE *)(v122 - 636777275), v123);
    JUMPOUT(0x402831);
  }
  v114 = (_EDX | a3) - 1;
  v72 = _EDX - 1;
  v73 = a6 ^ v80;
  v74 = a6 - 1;
  LOBYTE(v72) = BYTE1(v114);
  LOBYTE(v114) = -(char)v114;
  _ESI = v73 - v72;
  LOBYTE(a1) = __CFADD__(v78, -16) + ~(_BYTE)a1 - 96 - HIBYTE(a1);
  v116 = _ESI;
  while ( 1 )
  {
    BYTE1(a4) = v114;
    v119 = HIBYTE(a1) + a1;
    BYTE1(v116) = 67;
    BYTE1(v114) = v114 + (v114 | BYTE1(v114));
    v120 = ((char)(BYTE1(v114) + v114) < 0) ^ __OFADD__(BYTE1(v114), (_BYTE)v114);
    LOBYTE(v114) = BYTE1(v114) + v114;
    LOBYTE(a4) = 54;
    if ( !v120 && v120 )
    {
      v121 = a4 - 1;
      LOBYTE(v121) = 11;
      BYTE1(v121) = ~(((unsigned __int16)(v116 + 12) >> 8)
                    + BYTE1(v121)
                    + 1
                    - (__CFADD__((unsigned __int16)(v116 + 12) >> 8, BYTE1(v121))
                     + 63));
      v91 = v74 - v114 - (v119 - 17);
      LOWORD(v114) = -3018;
      v92 = v114;
      ((void (__cdecl *)(int))sub_402C30)(12288);
      v94 = v93 - (v66 + v91);
      ++v92;
      BYTE1(v121) -= 10;
      v66 = __CFADD__(v92, v121);
      _EBX = v92 + v121;
      LOBYTE(_EBX) = (v94 | (_EBX - (v66 + 119))) - v96;
      BYTE1(_EBX) ^= v97;
      __asm { rep mov ebx, ebx }
      sub_402B71(a5);
      if ( v75 ^ v76 | v109 )
        JUMPOUT(0x402A79);
      JUMPOUT(0x402341);
    }
    BYTE1(v114) += v119;
    BYTE1(v116) = -68;
    v102 = v114 + 1;
    v103 = v74 ^ v116;
    BYTE1(v102) = -126;
    BYTE1(a4) ^= 0x36u;
    LOBYTE(a4) = v103-- + 54;
    v74 = (v102 ^ v74) + 1;
    v104 = v103 | v102;
    LOBYTE(v104) = ~(_BYTE)v104;
    v105 = ((double (__fastcall *)(int, unsigned int, int))sub_402658)(v104, a4 | (unsigned int)v103, 4205161);
    v106 = v105 + *(float *)(v107 + 210338379);
    LOBYTE(v107) = v107 & 0x8D;
    v108 = v129;
    BYTE1(v108) = BYTE1(v129) + 1;
    BYTE1(v116) = v116 + BYTE1(v116) - 117;
    v109 = v116 + a4 == 0;
    v110 = (v116 + a4 < 0) ^ __OFADD__(v116, a4) | v109;
    a4 += v116;
    if ( !a4 || !v109 )
    {
      v83 = (_BYTE *)(v116 - 1);
      ++BYTE1(v83);
      v84 = (int)&v83[v74 + v74];
      BYTE1(a4) = BYTE1(v107);
      v86 = v108 | a4;
      BYTE1(v86) += 124;
      v87 = ((int (__usercall *)@<eax>(int, double@<st0>))v107)(12288, v106);
      sub_402F77(v87, (_ESI + v86 < v88) - v89 - 113, v88, _ESI + v86 - v88, v84, _ESI);
      *v90 = BYTE1(v90);
      JUMPOUT(0x402851);
    }
    if ( v110 )
      break;
    LOBYTE(v107) = v107 - BYTE1(a4);
    v112 = v108 + 1;
    BYTE1(v107) = BYTE1(v112) + (BYTE1(v116) | ~BYTE1(v107));
    v113 = v112 | v107;
    BYTE1(v112) = v116;
    v65 = v112 - 1;
    LOBYTE(v65) = a4;
    LOBYTE(a4) = BYTE1(a4);
    v66 = __CFADD__((_BYTE)v113, 91);
    v67 = v113 + 91;
    v68 = v65 + 1;
    if ( !(__OFADD__(
             __CFADD__(v66, HIBYTE(v113)) || (unsigned __int8)(v66 + HIBYTE(v113)) >= 0x3Du,
             v66 + HIBYTE(v113) - 61) | __OFADD__(
                                          -72,
                                          (__CFADD__(v66, HIBYTE(v113)) || (unsigned __int8)(v66 + HIBYTE(v113)) >= 0x3Du)
                                        + v66
                                        + HIBYTE(v113)
                                        - 61))
      && __OFADD__(
           __CFADD__(v66, HIBYTE(v113)) || (unsigned __int8)(v66 + HIBYTE(v113)) >= 0x3Du,
           v66 + HIBYTE(v113) - 61) | __OFADD__(
                                        -72,
                                        (__CFADD__(v66, HIBYTE(v113)) || (unsigned __int8)(v66 + HIBYTE(v113)) >= 0x3Du)
                                      + v66
                                      + HIBYTE(v113)
                                      - 61) )
    {
      JUMPOUT(0x40219F);
    }
    BYTE1(v68) -= 125;
    LOBYTE(v68) = v67 ^ v68;
    v64 = v68 + 1;
    LOBYTE(v64) = v64 - 1;
    BYTE1(v64) = BYTE1(a4) - 116;
    v69 = v64 - v74;
    v70 = v67 - 1 - v69;
    v71 = a4 + v69 + 1;
    *(_BYTE *)v116 = BYTE1(a4);
    LOBYTE(v71) = v71 - 26;
    v85 = a4 + v71;
    BYTE1(v85) |= (BYTE1(a4) ^ ((_ESI ^ v70) - 1)) - 1;
    LOBYTE(v85) = v85 + 10;
    BYTE1(v85) -= BYTE1(v116);
    ++_ESI;
    v101 = v85 - v116;
    v99 = v116 + v101;
    v100 = SBYTE1(v101) < (unsigned __int8)(__CFADD__(v116, v101) + 9);
    BYTE1(v101) -= __CFADD__(v116, v101) + 9;
    if ( !v100 )
    {
      __asm { repne push si }
      LOWORD(_ESI) = HIWORD(v129);
      if ( v100 )
        __asm { retf    0FEA7h }
    }
    v117 = _ESI + v101;
    BYTE1(v117) ^= BYTE1(a4);
    v114 = v117 + 1;
    LOBYTE(v99) = v99 - 1;
    BYTE1(v114) = ~(BYTE1(v114) - 1);
    v118 = HIBYTE(v99) + (_BYTE)v114 == 0;
    LOBYTE(v114) = HIBYTE(v99) + v114;
    if ( !(_BYTE)v114 || !v118 )
    {
      sub_402869();
      __writeeflags(0x3000u);
      _disable();
      if ( v127 )
      {
        v128 = (v74 >> 1) | (v126 << 31);
        BYTE1(v128) = (v125 - 1) ^ v124 ^ ((unsigned __int16)(v74 >> 1) >> 8);
        LOBYTE(v128) = ~(unsigned __int8)(v74 >> 1);
        v77 = v128 - 1;
        BYTE1(v77) = v77 ^ (BYTE1(v77) - BYTE1(a4));
        LOBYTE(v77) = -(char)(v74 >> 1) - 3;
        ((void (__thiscall *)(int))sub_4023D9)(v77);
      }
      JUMPOUT(0x402F37);
    }
    a1 = v99 - 31621;
  }
  result = __FBSTP__(v106);
  *(double *)(a5 + 26) = result;
  ((void (*)(void))sub_402A9D)();
  return result;
}
// 4023A3: positive sp value FEAF has been found
// 402180: control flows out of bounds to 402181
// 40219D: control flows out of bounds to 40219F
// 402340: control flows out of bounds to 402341
// 40255D: control flows out of bounds to 402563
// 40282F: control flows out of bounds to 402831
// 40284F: control flows out of bounds to 402851
// 402930: control flows out of bounds to 402936
// 4024ED: control flows out of bounds to 402283
// 4022D7: control flows out of bounds to 4027EE
// 40239E: control flows out of bounds to 402A79
// 40255B: control flows out of bounds to 402588
// 402771: control flows out of bounds to 402855
// 402EFF: control flows out of bounds to 402F37
// 402A9C: bad sp value at call
// 40214E: conditional instruction was optimized away because of 'ah.1>=0'
// 402254: conditional instruction was optimized away because of 'eax.4>=0'
// 402279: conditional instruction was optimized away because of 'bl.1>=0'
// 402736: conditional instruction was optimized away because of 'cl.1!=0'
// 402244: variable 'v116' is possibly undefined
// 402386: variable 'v75' is possibly undefined
// 402386: variable 'v76' is possibly undefined
// 402386: variable 'v109' is possibly undefined
// 402EC9: variable 'v122' is possibly undefined
// 402EC9: variable 'v123' is possibly undefined
// 402636: variable 'v107' is possibly undefined
// 402845: variable 'v88' is possibly undefined
// 402847: variable 'v89' is possibly undefined
// 40284F: variable 'v90' is possibly undefined
// 402956: variable 'v129' is possibly undefined
// 402915: variable 'v93' is possibly undefined
// 402915: variable 'v66' is possibly undefined
// 402923: variable 'v96' is possibly undefined
// 402925: variable 'v97' is possibly undefined
// 402EFF: variable 'v127' is possibly undefined
// 402F01: variable 'v126' is possibly undefined
// 402F0C: variable 'v125' is possibly undefined
// 402F09: variable 'v124' is possibly undefined
// 4024B5: too many input arguments, some ignored
// 4023D9: using guessed type void __noreturn sub_4023D9();
// 402658: using guessed type double sub_402658();
// 402A9D: using guessed type _DWORD __far sub_402A9D();
// 402C30: using guessed type double sub_402C30();

//----- (0040251B) --------------------------------------------------------
#error "40251B: function frame is wrong (funcsize=0)"

//----- (00402658) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
void sub_402658()
{
  JUMPOUT(0x4025D3);
}
// 402FCF: positive sp value FEAF has been found
// 402FA7: control flows out of bounds to 4025D3
// 402FCF: control flows out of bounds to 403009
// 402FD1: control flows out of bounds to 402F53
// 402FCA: bad sp value at call
// 402FAF: conditional instruction was optimized away because of 'ecx.4>=0'

//----- (00402697) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int sub_402697()
{
  void *v1; // [esp+Ch] [ebp-4h]
  void *retaddr; // [esp+10h] [ebp+0h]

  *(&retaddr - 5) = v1;
  sub_402982();
  __asm { int     74h; IRQ12 - PS50+ - MOUSE INTERRUPT }
  return ((int (*)(void))sub_4026B0)();
}
// 40269B: positive sp value 4 has been found
// 4026B0: using guessed type _DWORD __far sub_4026B0();

//----- (004026B0) --------------------------------------------------------
#error "402462: cannot convert to microcode (funcsize=23)"

//----- (004026D0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4026D0()
{
  JUMPOUT(0x4020CD);
}
// 4026D4: positive sp value 4 has been found
// 4026F3: control flows out of bounds to 4026F4
// 4026DF: control flows out of bounds to 4020CD
// 4026ED: control flows out of bounds to 40274A
// 4026E7: conditional instruction was optimized away because of 'al.1>=0'

//----- (0040278B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_40278B@<eax>(__int16 a1@<ax>, int a2@<edx>, char a3@<bh>)
{
  char v3; // ah
  unsigned __int8 v4; // al
  void *retaddr[2]; // [esp+0h] [ebp+0h]

  LOBYTE(a1) = a1 + 1;
  v3 = a3 ^ ((unsigned __int16)(a1 + 1) >> 8);
  if ( __SETP__(v3, 0) || !__SETP__(v3, 0) )
    JUMPOUT(0x40254A);
  v4 = __inbyte(0x90u);
  return MK_FP(retaddr[0], retaddr[0])(-104, a2);
}
// 402430: positive sp value 8 has been found
// 402548: control flows out of bounds to 40254A
// 40278B: could not find valid save-restore pair for esi

//----- (0040280E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40280E()
{
  sub_402FF2();
}
// 402816: positive sp value 4 has been found

//----- (00402869) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402869()
{
  void *v0; // [esp+1Ch] [ebp-4h]
  void *retaddr; // [esp+20h] [ebp+0h]

  *(&retaddr - 9) = v0;
  JUMPOUT(0x402F05);
}
// 40286D: positive sp value 4 has been found
// 40287D: control flows out of bounds to 402F05

//----- (004028C7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4028C7()
{
  int v0; // [esp-4h] [ebp-4h]

  ((void (__stdcall *)(int))sub_4026B0)(v0);
  JUMPOUT(0x40262A);
}
// 402628: positive sp value C has been found
// 402628: control flows out of bounds to 40262A
// 402623: variable 'v0' is possibly undefined
// 4026B0: using guessed type _DWORD __far sub_4026B0();

//----- (00402982) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402982()
{
  int v0; // [esp+Ch] [ebp-8h]
  int v1; // [esp+10h] [ebp-4h]

  *(&v1 - 6) = v0;
  sub_4021E2();
}
// 40299F: positive sp value 8 has been found

//----- (00402A9D) --------------------------------------------------------
#error "402A9D: function frame is wrong (funcsize=0)"

//----- (00402B71) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402B71(int a1@<ebp>)
{
  void *v1; // ecx
  _DWORD *v2; // edx
  void **v5; // [esp+20h] [ebp-8h]
  void *v6; // [esp+24h] [ebp-4h] BYREF
  void *retaddr; // [esp+28h] [ebp+0h]

  *(&retaddr - 11) = v6;
  ((void (*)(void))loc_402310)();
  v6 = v1;
  *(_BYTE *)(a1 + 58823352) -= BYTE1(v1);
  *v2 <<= 30;
  _AL = ((int (__cdecl *)(void *))sub_402A9D)(v6);
  __asm { aaa }
  v5 = &v6;
  JUMPOUT(0x402BAE);
}
// 402B75: positive sp value 4 has been found
// 402BA8: control flows out of bounds to 402BAE
// 402B87: variable 'v1' is possibly undefined
// 402B8E: variable 'v2' is possibly undefined
// 402A9D: using guessed type _DWORD __far sub_402A9D();

//----- (00402BE0) --------------------------------------------------------
#error "402BE0: stack frame is too big (funcsize=0)"

//----- (00402C30) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402C30(_DWORD *a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>)
{
  int v4; // ecx
  int v5; // eax
  int v6; // ecx
  char v7; // al
  char v8; // cf
  int v9; // edi
  int v10; // ecx
  unsigned __int16 v11; // dx
  int v12; // eax
  __int16 v13; // cx
  int v14; // eax

  BYTE1(a3) = ~BYTE1(a3);
  v9 = a2 ^ a4;
  LOBYTE(a3) = -(char)a3 - 75;
  v10 = *a1 ^ a2;
  LOBYTE(v10) = v10 + 27;
  LOBYTE(a1) = -112;
  sub_402121(a3 | v10, (int)a1);
  LOBYTE(v12) = HIBYTE(v13) ^ v12 & 0xF4;
  HIBYTE(v13) |= BYTE1(v12);
  v14 = v9 ^ v12;
  LOBYTE(v13) = -(char)v13;
  LOBYTE(v14) = -(char)v14;
  BYTE1(a3) = ~BYTE1(a3);
  BYTE1(v14) = v14;
  if ( __OFSUB__((_BYTE)v14, 1) || !__OFSUB__((_BYTE)v14, 1) )
  {
    HIWORD(v4) = HIWORD(v9);
    LOBYTE(v14) = BYTE1(a3) | v14;
    v5 = v9 | v14;
    BYTE1(v5) = v11 ^ (BYTE1(v5) - 23);
    BYTE1(v4) = BYTE1(v9) - v11;
    LOBYTE(v4) = HIBYTE(v11) ^ v9;
    v6 = (v9 + (v9 ^ v5)) ^ (v4 - 1);
    BYTE1(v6) = (HIBYTE(v11) | (BYTE1(v6) - v6)) - 22;
    LOBYTE(v6) = v6 - 1;
    v7 = ((int (__thiscall *)(int))loc_402B4E)(v9 ^ v6);
    if ( __OFADD__(v8, v7) | __OFADD__(-91, v8 + v7) )
      JUMPOUT(0x4028A4);
    JUMPOUT(0x402834);
  }
  LOBYTE(v14) = __inbyte(0xAAu);
  __outbyte(v11, v14);
  LOBYTE(v14) = *(_BYTE *)v9;
  sub_402F77(v14, SHIBYTE(v11), v13, a3, v9, v9 + 1);
}
// 402349: positive sp value 4 has been found
// 402832: control flows out of bounds to 402834
// 4028A3: control flows out of bounds to 4028A4
// 40236D: control flows out of bounds to 40236E
// 402363: conditional instruction was optimized away because of 'ah.1>=1'
// 402F4F: variable 'v13' is possibly undefined
// 402F4D: variable 'v12' is possibly undefined
// 402359: variable 'v11' is possibly undefined
// 40289F: variable 'v8' is possibly undefined
// 4023D9: using guessed type void __noreturn sub_4023D9();

//----- (00402CD1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402CD1(char a1@<cf>, int a2@<edx>, int a3@<ecx>, char a4@<ah>, char a5@<bl>)
{
  __asm { repne pop edi }
  sub_402CE1(__CFADD__(a5, -119), a4, a3 + 1);
}
// 402CD6: positive sp value 4 has been found

//----- (00402CE1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_402CE1(char a1@<cf>, char a2@<ah>, int a3@<ecx>)
{
  LOBYTE(a3) = (a1 + a2 + 40) ^ a3;
  ((void (__thiscall *)(int))((char *)&loc_40258E + 4))(a3);
}
// 402CED: positive sp value 4 has been found

//----- (00402D45) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __userpurge sub_402D45(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>, double a7@<st0>, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  int v64; // eax
  bool v66; // pf
  double v67; // st7
  int v68; // ecx
  bool v69; // cf
  int v70; // ecx
  int v71; // [esp+4h] [ebp-8h]
  int v72; // [esp+8h] [ebp-4h]

  *(&v72 - 4) = v71;
  v68 = a3 - 1;
  v69 = BYTE1(v68) < (unsigned __int8)a4;
  BYTE1(v68) -= a4;
  LOBYTE(a1) = a1 - (v69 - 31);
  LOBYTE(v68) = -127;
  v70 = a2 | v68;
  BYTE1(a1) = -115;
  BYTE1(v70) += 38;
  v64 = a1 - a5;
  BYTE1(v64) = ~BYTE1(v64);
  LOBYTE(v70) = __CFADD__(a5, v64) + v70 + 40;
  _ECX = (_DWORD *)((a6 | v70) - a5);
  BYTE1(a4) = (BYTE1(a4) + 5) ^ 0xD7;
  v66 = __SETP__((char *)_ECX + (a2 ^ a4), 0);
  if ( !v66 )
  {
    __asm { repne mov ch, ch }
    if ( v66 )
    {
      v67 = *(float *)(a4 - 96) / a7;
      __writeeflags((unsigned __int16)__SS__);
      ((void (__usercall *)(_DWORD, double@<st0>))sub_402BE0)(*_ECX, v67);
    }
  }
  JUMPOUT(0x402188);
}
// 402852: positive sp value 8 has been found
// 402AF0: control flows out of bounds to 402188
// 402D45: too many input arguments, some ignored

//----- (00402D84) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402D84()
{
  __asm { rep pop edx }
  JUMPOUT(0x402B8D);
}
// 402C5E: positive sp value 4 has been found
// 402C6E: control flows out of bounds to 402B8D

//----- (00402D9B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __userpurge sub_402D9B(int a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  void *v64; // [esp+4h] [ebp-4h]
  void *retaddr[2]; // [esp+8h] [ebp+0h]

  retaddr[-3] = v64;
  JUMPOUT(0x402D23);
}
// 402D9F: positive sp value 4 has been found
// 402DB6: control flows out of bounds to 402D23
// 402D9B: too many input arguments, some ignored

//----- (00402F77) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402F77(int a1@<eax>, char a2@<dh>, __int16 a3@<cx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  char v6; // dh
  __int16 v7; // cx
  __int16 v8; // dx
  int v9; // ebx
  int v10; // ecx
  int v11; // ebx
  int v12; // [esp+0h] [ebp-8h]

  BYTE1(a4) = -45;
  v11 = a1 | a4;
  BYTE1(v11) = BYTE1(v11) + 18 - a1;
  --v11;
  v7 = (a6 | a3) - 1;
  *(&v12 - 2) = a1;
  HIBYTE(v8) = BYTE1(a1) | BYTE1(v11) ^ a2;
  BYTE1(v11) = -(char)(HIBYTE(v7) + BYTE1(v11));
  LOBYTE(v8) = a1;
  sub_402411(a1, v8, v7, v11, (int *)(a5 - a6));
  v10 = (unsigned __int16)__CS__ - 1;
  LOBYTE(v11) = BYTE1(v10) | v6;
  BYTE1(v11) = -106;
  v9 = v10 | v11;
  ((void (*)(void))loc_402BF8)();
  *(_WORD *)(v9 - 104) = __DS__;
  _disable();
  JUMPOUT(0x4028FF);
}
// 402A53: positive sp value C has been found
// 4025F7: control flows out of bounds to 4025F8
// 4028FE: control flows out of bounds to 4028FF
// 402A53: control flows out of bounds to 402A59
// 4025ED: conditional instruction was optimized away because of 'esi.4>=0'
// 402111: variable 'v6' is possibly undefined

//----- (00402FF2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402FF2()
{
  JUMPOUT(0x402FBA);
}
// 402643: positive sp value 4 has been found
// 40264F: control flows out of bounds to 402FBA

// nfuncs=37 queued=37 decompiled=37 lumina nreq=0 worse=0 better=0
#error "There were 10 decompilation failure(s) on 37 function(s)"
