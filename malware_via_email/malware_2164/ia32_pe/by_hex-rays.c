/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// LRESULT __stdcall SendMessageW(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// int __stdcall GetDeviceCaps(HDC hdc, int index);
// HMODULE __stdcall GetModuleHandleW(LPCWSTR lpModuleName);
// int __stdcall SetBkMode(HDC hdc, int mode);
// DWORD __stdcall GetCurrentThreadId();
// BOOL __stdcall BitBlt(HDC hdc, int x, int y, int cx, int cy, HDC hdcSrc, int x1, int y1, DWORD rop);
// LRESULT __stdcall SendMessageW_1(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// BOOL __stdcall DeleteDC(HDC hdc);
// BOOL __stdcall BitBlt_1(HDC hdc, int x, int y, int cx, int cy, HDC hdcSrc, int x1, int y1, DWORD rop);
// int __stdcall GetObjectW(HANDLE h, int c, LPVOID pv);
// HBITMAP __stdcall CreateCompatibleBitmap(HDC hdc, int cx, int cy);
// BOOL __stdcall ShowWindow(HWND hWnd, int nCmdShow);
// BOOL __stdcall DeleteObject(HGDIOBJ ho);
// BOOL __stdcall PatBlt(HDC hdc, int x, int y, int w, int h, DWORD rop);
// HANDLE __stdcall GetProcessHeap();
// BOOL __stdcall DeleteObject_1(HGDIOBJ ho);
// BOOL __stdcall TextOutW(HDC hdc, int x, int y, LPCWSTR lpString, int c);
// HICON __stdcall LoadIconW(HINSTANCE hInstance, LPCWSTR lpIconName);
// HLOCAL __stdcall LocalFree(HLOCAL hMem);
// LPTOP_LEVEL_EXCEPTION_FILTER __stdcall SetUnhandledExceptionFilter(LPTOP_LEVEL_EXCEPTION_FILTER lpTopLevelExceptionFilter);
// DWORD __stdcall FormatMessageW(DWORD dwFlags, LPCVOID lpSource, DWORD dwMessageId, DWORD dwLanguageId, LPWSTR lpBuffer, DWORD nSize, va_list *Arguments);
// BOOL __stdcall GetWindowRect(HWND hWnd, LPRECT lpRect);
// int __stdcall LoadStringW(HINSTANCE hInstance, UINT uID, LPWSTR lpBuffer, int cchBufferMax);
// BOOL __stdcall PostMessageW(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// BOOL __stdcall PatBlt_1(HDC hdc, int x, int y, int w, int h, DWORD rop);
// BOOL __stdcall UpdateLayeredWindow(HWND hWnd, HDC hdcDst, POINT *pptDst, SIZE *psize, HDC hdcSrc, POINT *pptSrc, COLORREF crKey, BLENDFUNCTION *pblend, DWORD dwFlags);
// HWND __stdcall GetDlgItem(HWND hDlg, int nIDDlgItem);
// UINT_PTR __stdcall SetTimer(HWND hWnd, UINT_PTR nIDEvent, UINT uElapse, TIMERPROC lpTimerFunc);
// HWND __stdcall CreateWindowExW(DWORD dwExStyle, LPCWSTR lpClassName, LPCWSTR lpWindowName, DWORD dwStyle, int X, int Y, int nWidth, int nHeight, HWND hWndParent, HMENU hMenu, HINSTANCE hInstance, LPVOID lpParam);
// unsigned int __usercall start@<eax>(char a1@<ah>, __int16 a2@<dx>, void *a3@<ecx>, char a4@<bl>, int a5@<esi>);
// LPVOID __stdcall VirtualAlloc(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// HLOCAL __stdcall LocalAlloc(UINT uFlags, SIZE_T uBytes);
// LPTOP_LEVEL_EXCEPTION_FILTER __stdcall SetUnhandledExceptionFilter_1(LPTOP_LEVEL_EXCEPTION_FILTER lpTopLevelExceptionFilter);
// unsigned int __usercall sub_405CEA@<eax>(__int16 a1@<ax>, char a2@<dil>);
// int __stdcall GetSystemMetrics(int nIndex);


//----- (004013C8) --------------------------------------------------------
unsigned int __usercall start@<eax>(char a1@<ah>, __int16 a2@<dx>, void *a3@<ecx>, char a4@<bl>, int a5@<esi>)
{
  DWORD v5; // eax
  DWORD v6; // esi
  char v7; // dl
  unsigned __int8 v8; // cl
  char v9; // dl
  int v10; // ecx
  int v11; // edi
  int j; // eax
  int v13; // ecx
  int StringW; // eax
  char v15; // dl
  char v16; // cl
  int v17; // ecx
  char v18; // ch
  int v19; // edx
  HWND DeviceCaps; // eax
  char v21; // dl
  int v22; // edx
  void *v23; // esi
  int i; // ebx
  UINT v25; // esi
  HLOCAL v26; // eax
  char v27; // dl
  char v28; // cl
  HANDLE ProcessHeap; // eax
  char v30; // cl
  char v31; // ch
  char v32; // dh
  char v33; // dl
  DWORD v34; // eax
  DWORD v35; // ebx
  int v36; // edi
  _BOOL2 v37; // ax
  char v38; // dh
  char v39; // ch
  char v40; // cl
  int v41; // ecx
  int v42; // edx
  char v43; // ch
  unsigned int result; // eax
  char v45; // dl
  char v46; // dh
  int v47; // ecx
  bool v48; // zf
  int v49; // ecx
  int v50; // ecx
  int v51; // ecx
  int v52; // ecx
  int v53; // ecx
  int v54; // ecx
  int v55; // ecx
  int v56; // ecx
  int v57; // ecx
  int v58; // ecx
  int v59; // ecx
  int v60; // ecx
  int v61; // ecx
  int v62; // ecx
  int v63; // ecx
  int v64; // [esp-64h] [ebp-64h]
  void *v65; // [esp-44h] [ebp-44h]
  char v67; // [esp-20h] [ebp-20h]
  unsigned __int8 v68; // [esp-18h] [ebp-18h]
  void *v69; // [esp-Ch] [ebp-Ch]
  const CHAR *v70; // [esp-4h] [ebp-4h]

  BYTE1(a3) = HIBYTE(a2) | a2 ^ BYTE1(a3);
  LOBYTE(a3) = HIBYTE(a2) + a4;
  v69 = a3;
  v65 = a3;
  BYTE1(a3) = a1;
  v23 = a3;
  for ( i = 34196; i != 636769571; BYTE1(a3) -= BYTE1(i) )
    i += 47965;
  StringW = LoadStringW((HINSTANCE)0xDED1, (UINT)v23, 0, 636769571);
  LOBYTE(v17) = v15 + v16;
  LOBYTE(v19) = BYTE1(StringW) ^ (v15 - 85);
  BYTE1(v17) = v18 ^ 0x23 | 0x23;
  v64 = v19;
  PatBlt((HDC)0xA0797D04, 53978, v17, -657991470, 13685707, 0xC6CDu);
  DeleteObject((HGDIOBJ)0xA57B8B63);
  ShowWindow(0, (int)v23);
  SendMessageW((HWND)0xCC965819, 0xDDu, 0xD4C1u, 636769571);
  DeviceCaps = (HWND)GetDeviceCaps((HDC)0xFE9CA06F, 636769571);
  LOBYTE(v22) = BYTE1(v22) + v21;
  CreateWindowExW(
    0x25F45523u,
    0,
    0,
    0xC0D3u,
    v22,
    13812422,
    55237,
    203,
    DeviceCaps,
    (HMENU)0xC6C8DCCF,
    (HINSTANCE)0xC7F47C5D,
    DeviceCaps);
  TextOutW((HDC)0xF587A2D3, -657080118, 218, 0, v64);
  SetTimer((HWND)0xF65865D6, 0xF3B1A444, 0xC9D7DEC4, (TIMERPROC)0xA28A8AEB);
  GetModuleHandleW(0);
  CreateCompatibleBitmap((HDC)0xE55EF48C, 213, -943536677);
  GetDlgItem((HWND)0x90CAB6AA, 56542);
  LOBYTE(v10) = BYTE1(v10) + v9;
  v11 = v10;
  for ( j = UpdateLayeredWindow(
              (HWND)0xE7399040,
              (HDC)0xD5C2C9,
              (POINT *)0xD8D8,
              (SIZE *)0xD0,
              (HDC)0xCFD7CA,
              (POINT *)0xC1,
              0xC6C6C0u,
              (BLENDFUNCTION *)0xD1DE,
              0xC7D7DCCE); j; --j )
    ;
  LOBYTE(v13) = 85;
  v25 = v13;
  PatBlt_1((HDC)0xBA4D3EAA, 54738, v13, 14539719, v13, 0x5555u);
  SetBkMode((HDC)0xE98D4D76, 13420752);
  GetCurrentThreadId();
  SetUnhandledExceptionFilter((LPTOP_LEVEL_EXCEPTION_FILTER)0xC5E97A0C);
  v26 = LocalFree((HLOCAL)0xD2536051);
  BYTE1(v26) += v27;
  LOBYTE(v26) = v27 ^ v28;
  BitBlt((HDC)0xBDE02281, (int)v26, v11, 12831198, 14212058, (HDC)0xE4ECD5DB, -706815266, -624108849, 0xC1DDCDC2);
  DeleteObject_1((HGDIOBJ)0xA0B85755);
  ProcessHeap = GetProcessHeap();
  SendMessageW_1((HWND)0xD16C7DFC, v25, v25, (LPARAM)ProcessHeap);
  HIWORD(v5) = HIWORD(a5);
  LOBYTE(v5) = ((v33 - (v31 - v30 - v33)) | v32 | v30) ^ a5;
  BYTE1(v5) = BYTE1(a5) - v5;
  v6 = v5;
  HIWORD(v35) = HIWORD(v69);
  BYTE1(v35) = (_BYTE)v65 + BYTE1(v69);
  LOBYTE(v35) = (_BYTE)v69 - (_BYTE)v65;
  v70 = 0;
  while ( LoadLibraryA(v70) )
    ;
  v68 = v8;
  v67 = v8 | (v8 + v7);
  PostMessageW((HWND)0xABBC1BA6, v8, (WPARAM)v65, -977089829);
  GetObjectW((HANDLE)0x9579AAC4, 49619, v65);
  LoadIconW(0, (LPCWSTR)0x317);
  GetWindowRect((HWND)0xC9CDC767, (LPRECT)0xC6D7);
  v34 = v35;
  BYTE1(v35) += v67;
  LOBYTE(v35) = v68 ^ v35;
  LOBYTE(v34) = v35 + v34;
  FormatMessageW(v34, (LPCVOID)0xBA63C222, v6, v35, 0, 0xCED6u, (va_list *)0xD1C7);
  v36 = 51395;
  v37 = DeleteDC((HDC)0xBED2D8D6);
  LOBYTE(v41) = (v38 + v37 - v35) ^ v40;
  BYTE1(v42) = v39 + HIBYTE(v37) + v38;
  BYTE1(v41) = BYTE1(v35) ^ v39;
  BitBlt_1((HDC)0x95E5752E, -742139196, 200, -824980544, 202, (HDC)0x82334A3A, v41, v42, 0xDDu);
  LOBYTE(result) = -61;
  BYTE1(result) = -56 - ((BYTE1(v35) | v43) + 56);
  v46 = (BYTE1(result) | v45) - BYTE1(v35);
LABEL_9:
  LOBYTE(v47) = -61;
LABEL_10:
  BYTE1(v35) |= v47;
LABEL_11:
  LOBYTE(v35) = v46 ^ v35;
LABEL_12:
  LOBYTE(v35) = v46 + v35;
  do
  {
    do
    {
LABEL_13:
      BYTE1(v35) ^= BYTE1(result);
LABEL_14:
      result = sub_405CEA(result, v36);
LABEL_15:
      v50 = v49 - 1;
      if ( !v48 && v50 )
        goto LABEL_9;
LABEL_17:
      v47 = v50 - 1;
      if ( !v48 && v47 )
        goto LABEL_10;
LABEL_19:
      v51 = v47 - 1;
      if ( !v48 && v51 )
        goto LABEL_11;
LABEL_21:
      v52 = v51 - 1;
      if ( !v48 && v52 )
        goto LABEL_12;
LABEL_23:
      v53 = v52 - 1;
      if ( !v48 && v53 )
        goto LABEL_12;
LABEL_25:
      v54 = v53 - 1;
      if ( !v48 && v54 )
        goto LABEL_12;
      v55 = v54 - 1;
      if ( !v48 )
      {
        if ( v55 )
          goto LABEL_12;
      }
      v56 = v55 - 1;
    }
    while ( !v48 && v56 );
LABEL_31:
    v57 = v56 - 1;
  }
  while ( !v48 && v57 );
  do
  {
    v58 = v57 - 1;
    if ( !v48 && v58 )
      goto LABEL_13;
    v59 = v58 - 1;
    if ( !v48 && v59 )
      goto LABEL_14;
    v60 = v59 - 1;
    if ( !v48 && v60 )
      JUMPOUT(0x401649);
    v61 = v60 - 1;
    if ( !v48 && v61 )
      JUMPOUT(0x40164B);
    v62 = v61 - 1;
    if ( !v48 && v62 )
      JUMPOUT(0x40164D);
    v63 = v62 - 1;
    if ( !v48 && v63 )
      JUMPOUT(0x40164F);
    v49 = v63 - 1;
    if ( !v48 && v49 )
      goto LABEL_15;
    v50 = v49 - 1;
    if ( !v48 && v50 )
      goto LABEL_17;
    v47 = v50 - 1;
    if ( !v48 && v47 )
      goto LABEL_19;
    v51 = v47 - 1;
    if ( !v48 && v51 )
      goto LABEL_21;
    v52 = v51 - 1;
    if ( !v48 && v52 )
      goto LABEL_23;
    v53 = v52 - 1;
    if ( !v48 && v53 )
      goto LABEL_25;
    v48 = (_BYTE)result == 0xD0;
    *(_BYTE *)v36++ = result;
    v56 = v53 - 1;
    if ( (_BYTE)result != 0xD0 && v56 )
      goto LABEL_31;
    v57 = v56 - 1;
  }
  while ( (_BYTE)result != 0xD0 && v57 );
  return result;
}
// 401667: control flows out of bounds to 401649
// 401669: control flows out of bounds to 40164B
// 40166B: control flows out of bounds to 40164D
// 40166D: control flows out of bounds to 40164F
// 4013C8: could not find valid save-restore pair for esi
// 4012D2: variable 'v15' is possibly undefined
// 4012D2: variable 'v16' is possibly undefined
// 4012D4: variable 'v18' is possibly undefined
// 4012E4: variable 'v19' is possibly undefined
// 40130B: variable 'v17' is possibly undefined
// 401361: variable 'v22' is possibly undefined
// 401361: variable 'v21' is possibly undefined
// 401222: variable 'v10' is possibly undefined
// 401222: variable 'v9' is possibly undefined
// 4010B7: variable 'v70' is possibly undefined
// 4010D9: variable 'v8' is possibly undefined
// 4010C2: variable 'v7' is possibly undefined
// 4015EB: variable 'v38' is possibly undefined
// 4015EF: variable 'v40' is possibly undefined
// 4015ED: variable 'v39' is possibly undefined
// 40161A: variable 'v41' is possibly undefined
// 40161A: variable 'v42' is possibly undefined
// 401623: variable 'v43' is possibly undefined
// 40162B: variable 'v45' is possibly undefined
// 401474: variable 'v13' is possibly undefined
// 4014D4: variable 'v27' is possibly undefined
// 4014D6: variable 'v28' is possibly undefined
// 401546: variable 'v33' is possibly undefined
// 40152C: variable 'v31' is possibly undefined
// 40152C: variable 'v30' is possibly undefined
// 401536: variable 'v32' is possibly undefined
// 401637: variable 'v46' is possibly undefined
// 401651: variable 'v49' is possibly undefined
// 401651: variable 'v48' is possibly undefined

//----- (00405CEA) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
unsigned int __usercall sub_405CEA@<eax>(__int16 a1@<ax>, char a2@<dil>)
{
  _BYTE *v2; // esi
  unsigned int v3; // eax
  int v5; // ecx
  UINT v6; // ecx
  _BYTE *v7; // [esp+4h] [ebp-4h]

  BYTE2(v6) = 0;
  LOBYTE(v6) = ((unsigned __int8)a1 > 0x3Au) - 102;
  BYTE1(v6) = (58 - a1) | 0xD0;
  v6 &= 0xD5CDC4u;
  LOBYTE(v6) = v6 ^ 0xDD | 0xC0 | HIBYTE(a1) | a2 | v6;
  v6 -= 51920;
  BYTE1(v6) += 59;
  LocalAlloc(v6, 0xD247A826);
  GetSystemMetrics(-674636842);
  SetUnhandledExceptionFilter_1((LPTOP_LEVEL_EXCEPTION_FILTER)0x9E745A83);
  v2 = v7;
  v3 = (unsigned int)VirtualAlloc(0, 0x11A78u, 0x3000u, 0x40u);
  v5 = 16033;
  do
  {
    *(_BYTE *)v3++ = __ROR1__(__ROL1__(*v2++ + 30, 11) + 9, 11);
    --v5;
  }
  while ( v5 );
  LOBYTE(v3) = v3 + 63;
  return v3 | 0xC5D0D8;
}
// 4055A5: positive sp value 4 has been found
// 4055A4: variable 'v7' is possibly undefined

// nfuncs=36 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
