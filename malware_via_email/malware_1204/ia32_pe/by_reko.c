// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__VirtualProtect = &g_t1202; // 00401000
<anonymous> * __imp__GetTickCount = &g_t1214; // 00401004
<anonymous> * __imp__RequestDeviceWakeup = &g_t1224; // 00401008
<anonymous> * __imp__GetCommandLineW = &g_t11F0; // 0040100C
// 00401020: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	ptr32 fp;
	Eq_4 dwLoc20;
	word32 dwLoc14;
	ui32 edx_17 = fn00401130();
	struct Eq_10 * eax_29 = 206336032 - (edx_17 << 11) & 0x0C0B6000 - (edx_17 << 11);
	*((word32) dwLoc20 + (fp + ~0x0001819F)) = eax_29->aFCFD084C[edx_17].dw0000 - 0x28;
	<anonymous> ** eax_67 = 0x0041918C - dwLoc20;
	word32 esi_51;
	struct Eq_34 * esp_69;
	(*eax_67)();
	ptr32 eax_42 = &((eax_29 + (&(eax_29->aFCFD084C)->dw0000 + (edx_17 << 0x09))[-1])->aFCFD084C + 98876)->dw0000 + 90 - dwLoc20;
	esp_69->tFFFFFFFC.u0 = (int32) dwLoc20;
	esp_69->dwFFFFFFF8 = dwLoc14;
	esp_69->ptrFFFFFFF4 = eax_42;
	struct Eq_59 * esp_87;
	(*((word32) dwLoc20 + 4099908))();
	esp_87->dwFFFFFFFC = 0x00;
	<anonymous> * v19_97 = eax_42 + 0x000181BC - dwLoc20;
	esp_87->dwFFFFFFF8 = (char *) v19_97 + 1164;
	struct Eq_75 * esp_106;
	v19_97();
	int3();
	int3();
	int3();
	int3();
	int3();
	int3();
	int3();
	int3();
	int3();
	int3();
	int3();
	esp_106->ptrFFFFFFFC = fp - 4;
	int32 edx_116 = esp_106->dw000C;
	int32 ecx_119 = *((char *) &(esp_106->aFFFCFCEC + 0x0000C0C8)->ptr0000 + edx_116);
	ui32 * ebx_121 = esp_106->aFFFCFCEC[edx_116].ptr0000;
	esp_106->dwFFFFFFF0 = 0x181900A0;
	DWORD eax_126 = esp_106->dwFFFFFFF0 - (edx_116 << 0x01);
	esp_106->dwFFFFFFF0 = 158735475;
	esp_106->dwFFFFFFF8 = 0x01;
	esp_106->dwFFFFFFF4 = esp_106->dwFFFFFFF0;
	esp_106->dwFFFFFFF4 += edx_116 << 0x01;
	while (true)
	{
		*ebx_121 = *ebx_121 ^ eax_126;
		ecx_119 -= 0x04;
		if (ecx_119 <= 0x00)
			break;
		eax_126 = (word32) eax_126 + esp_106->dwFFFFFFF4 + esp_106->dwFFFFFFF8;
		ebx_121 = ebx_121 + 0x00006064 - esp_106->dw000C;
		esp_106->dwFFFFFFF8 = -esp_106->dwFFFFFFF8;
	}
	return eax_126;
}

// 00401130: Register word32 fn00401130()
// Called from:
//      Win32CrtStartup
word32 fn00401130()
{
	struct Eq_185 * fp;
	struct Eq_186 * fs;
	struct Eq_187 * ebx_9 = fs->ptr0018;
	RequestDeviceWakeup->bFFFFFFFF == 0x90;
	fn00001223();
	ui32 eax_33 = ((ebx_9->dw0BF4 >> 0x10 | 0x24) ^ 0x55) << 0x01;
	*fp->aFFFE7E78[(eax_33 + 0xAA) / 4] = eax_33 + 0xAA;
	return eax_33 + 0xAA;
}

// 00401180: Register word32 fn00401180(Stack ui32 dwArg04, Register out Eq_227 esiOut)
// Called from:
//      Win32CrtStartup
word32 fn00401180(ui32 dwArg04, union Eq_227 & esiOut)
{
	Eq_227 eax_15 = (dwArg04 << 11) + 4097028480 & 0x06053000 - (dwArg04 << 0x0A);
	struct Eq_246 ** eax_19 = (word32) eax_15.u0 + 0x0C0C603C - (dwArg04 << 11);
	word32 ecx_22 = Mem6[Mem6[eax_19 + 0x00:word32] + 20 + eax_19:word32];
	esiOut = eax_15;
	return ecx_22;
}

word32 g_dw4011DC = 0x1202; // 004011DC
word32 g_dw4011E0 = 0x1214; // 004011E0
word32 g_dw4011E4 = 4644; // 004011E4
word32 g_dw4011E8 = 0x11F0; // 004011E8
