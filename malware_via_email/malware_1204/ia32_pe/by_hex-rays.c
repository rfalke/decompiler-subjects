/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __userpurge start@<eax>(int a1@<esi>, int a2, int a3, int a4);
int *__stdcall sub_401130(int a1);
int __stdcall sub_401180(int a1);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401056; // weak


//----- (00401020) --------------------------------------------------------
int __userpurge start@<eax>(int a1@<esi>, int a2, int a3, int a4)
{
  int v4; // edx
  int v5; // eax
  _DWORD *v6; // ecx
  int v7; // ecx
  int v8; // ecx
  _DWORD *v9; // ebx
  int result; // eax
  bool v11; // cc
  _WORD v12[98654]; // [esp+0h] [ebp-30310h] BYREF
  int v13; // [esp+302BCh] [ebp-54h]
  int v14; // [esp+302C0h] [ebp-50h]
  int *v15; // [esp+302C4h] [ebp-4Ch]
  int v16; // [esp+302F4h] [ebp-1Ch] BYREF
  char *v17; // [esp+302FCh] [ebp-14h]
  int v18; // [esp+30300h] [ebp-10h]
  int v19; // [esp+30308h] [ebp-8h]
  int v20; // [esp+3030Ch] [ebp-4h] BYREF
  int savedregs; // [esp+30310h] [ebp+0h] BYREF

  sub_401130((int)&v16);
  v5 = (202072064 - (v4 << 11)) & (206336032 - (v4 << 11));
  v6 = (_DWORD *)((v4 << 9) + v5 - 50526132);
  *(_DWORD *)((char *)&v12[49338] + v16) = *v6 - 40;
  v17 = (char *)(*(v6 - 1) + v5 + 98740 - v16);
  sub_401180(v16);
  (*(void (__stdcall **)(int, int, int, int *, int, int, int *))(4297100 - v16))(a1, v7, 4, &v20, v13, v14, v15);
  ((void (__stdcall *)(char *, int, int))(v16 + 4099908))(v17, v18, v16);
  v17 += 98748;
  v17 -= v16;
  ((void (__stdcall *)(char *, _DWORD))v17)(v17 + 1164, 0);
  __debugbreak();
  __debugbreak();
  __debugbreak();
  __debugbreak();
  __debugbreak();
  __debugbreak();
  __debugbreak();
  __debugbreak();
  __debugbreak();
  __debugbreak();
  __debugbreak();
  v15 = &savedregs;
  v8 = *(_DWORD *)((char *)&v12[49352] + a4);
  v9 = *(_DWORD **)&v12[a4];
  result = 404291744 - 2 * a4;
  v20 = 1;
  v19 = 2 * a4 + 158735475;
  while ( 1 )
  {
    *v9 ^= result;
    v11 = v8 <= 4;
    v8 -= 4;
    if ( v11 )
      break;
    result += v20 + v19;
    v9 = (_DWORD *)((char *)v9 - a4 + 98704);
    v20 = -v20;
  }
  return result;
}
// 401037: variable 'v4' is possibly undefined
// 40108D: variable 'v7' is possibly undefined

//----- (00401130) --------------------------------------------------------
int *__stdcall sub_401130(int a1)
{
  struct _TEB *v1; // ebx
  void (__stdcall *v2)(int); // eax
  int v3; // edx
  int *result; // eax
  char v5[98692]; // [esp+4h] [ebp-18188h] BYREF
  int v6; // [esp+18188h] [ebp-4h]

  v1 = NtCurrentTeb();
  v2 = (void (__stdcall *)(int))(*(_DWORD *)((char *)&loc_401056 - 78) - 1);
  if ( *(_BYTE *)v2 != 0x90 )
    v2 = *(void (__stdcall **)(int))((char *)&loc_401056 - 78);
  v2(v6);
  v3 = 2 * ((HIWORD(v1->LastStatusValue) | 0x24) ^ 0x55) + 170;
  result = *(int **)&v5[v3];
  *result = v3;
  return result;
}

//----- (00401180) --------------------------------------------------------
int __stdcall sub_401180(int a1)
{
  return ((101003264 - (a1 << 10)) & ((a1 << 11) - 197938816)) + 202137660 - (a1 << 11);
}

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
