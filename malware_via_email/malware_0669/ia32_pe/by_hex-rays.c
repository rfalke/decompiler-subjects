/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __cdecl start(int, int);
int __fastcall sub_4010CC(int, int);
// void __usercall __noreturn sub_40409A(unsigned int@<eax>, unsigned int@<ecx>, int@<ebx>, unsigned int@<edi>, int@<esi>);
// void __usercall __noreturn sub_404108(int@<eax>, __int16@<dx>, int@<ebx>, int@<ebp>);

//-------------------------------------------------------------------------
// Data declarations

// extern DWORD (__stdcall *GetVersion)();


//----- (00401061) --------------------------------------------------------
void __cdecl start(int a1, int a2)
{
  int v2; // ecx
  int v3; // edx
  unsigned int v4; // [esp-8h] [ebp-8h]

  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  sub_4010CC(v2 + 945169812, v3);
  __writefsdword(0, v4);
  JUMPOUT(0x4010DD);
}
// 4010E9: control flows out of bounds to 4010DD
// 4010B5: variable 'v2' is possibly undefined
// 4010BB: variable 'v3' is possibly undefined
// 4010C6: variable 'v4' is possibly undefined

//----- (004010CC) --------------------------------------------------------
int __fastcall sub_4010CC(int a1, int a2)
{
  int result; // eax
  int v3; // [esp-4h] [ebp-4h] BYREF

  result = 0;
  __writefsdword(0, (unsigned int)&v3);
  MEMORY[0] = a2;
  return result;
}

//----- (0040409A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_40409A(
        unsigned int a1@<eax>,
        unsigned int a2@<ecx>,
        int a3@<ebx>,
        unsigned int a4@<edi>,
        int a5@<esi>)
{
  int v5; // ebx
  unsigned int v6; // ecx
  bool v7; // cc
  unsigned int v8; // esi
  __int16 v9; // dx
  int v10; // [esp-4h] [ebp-8h]
  int v11; // [esp+0h] [ebp-4h]
  __int16 savedregs; // [esp+4h] [ebp+0h]
  unsigned int savedregsa; // [esp+4h] [ebp+0h]

  v5 = a4 + a3;
  v6 = __PAIR64__(a4, a2) >> a2;
  if ( (a5 + 1 < 0) ^ __OFADD__(1, a5) | (a5 == -1) )
    a1 = v6 ^ 0xE10A054A;
  v8 = a1 & v5;
  v7 = (int)(a1 & v5) <= 0;
  if ( (a1 & v5 & 0x80000000) != 0 )
  {
    v8 = -2146553685;
    __asm { fsub    st(2), st }
    v7 = v11 < 0 || v11 == 0x1D1E11D8;
  }
  if ( v7 )
    a1 = v6;
  v9 = savedregs;
  savedregsa = v8;
  sub_404108(840260543, v9, a1 << 17, v10);
}
// 4040E9: positive sp value 8 has been found
// 4040D8: inconsistent fpu stack
// 4040DA: variable 'v11' is possibly undefined
// 4040E8: variable 'savedregs' is possibly undefined
// 4040FB: variable 'v10' is possibly undefined

//----- (00404108) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_404108(int a1@<eax>, __int16 a2@<dx>, int a3@<ebx>, int a4@<ebp>)
{
  int v6; // eax
  int v7; // ecx
  unsigned __int16 v8; // ax
  unsigned int v9; // esi
  int v10; // ecx
  _DWORD *v11; // edi
  __int16 v12; // ax
  int v14; // esi
  int v18; // eax
  char v19; // cc
  int v20; // eax
  int v25; // [esp-8h] [ebp-8h]

  _EBX = __ROL4__(a3, 182);
  __asm { fadd    st(7), st }
  v6 = a1 & ~(1 << a1);
  v7 = -181713608;
  if ( _PF )
    v7 = _EBX;
  v8 = ~(_WORD)v6;
  v9 = v8;
  v10 = -v7;
  v11 = (_DWORD *)(v25 + 355);
  v12 = ~v8;
  _CF = v25 + 355 < v9;
  if ( (int)(v25 + 355 - v9) < 0 )
  {
    LOWORD(v10) = _EBX ^ v10;
    if ( !(_WORD)v10 )
      v12 = a2;
    v14 = (unsigned __int8)__ROL4__(v10, 109);
    __asm { fmul    st(2), st }
    LOWORD(v14) = (v12 ^ 0xE7D5) & v14;
    v10 = v14;
    __asm { repne inc ebx }
  }
  HIWORD(v18) = -2092;
  __asm { fcomp   st(3) }
  LOWORD(v18) = _EBX + _CF + 1804;
  if ( !__CFADD__((_WORD)_EBX, _CF + 1804) && (_WORD)v18 != 0 )
    v18 = v10;
  v19 = _SF ^ ((unsigned __int64)(_EBX * (__int64)v10) >> 32 != 0);
  if ( v19 | _ZF )
  {
    _OF = __OFADD__(1, v18);
    v20 = v18 + 1;
    v19 = (v20 < 0) ^ _OF;
  }
  if ( v19 )
  {
    __asm { fadd    st(1), st }
    _EBX += (int)v11 + 1;
  }
  __asm { fmul    st(4), st }
  if ( _SF != _OF )
    _EBX = a4;
  __asm { repne inc ebx }
  do
  {
    __asm
    {
      fsub    st(2), st
      fcomp   st(3)
    }
    *v11++ += 1927843544;
    _ECX = -1247791948;
    __asm { rcr     ecx, 7Eh }
  }
  while ( (int)v11 < v25 + 1319 );
  __asm
  {
    rcr     ecx, 0CFh
    fsub    st(1), st
  }
  MEMORY[0x52F1C590] = -1242484679;
  JUMPOUT(0x9091EE84);
}
// 404266: positive sp value 8 has been found
// 404110: inconsistent fpu stack
// 40426F: control flows out of bounds to 9091EE84
// 404121: variable '_PF' is possibly undefined
// 40412D: variable 'v25' is possibly undefined
// 404177: variable '_SF' is possibly undefined
// 404182: variable '_ZF' is possibly undefined
// 4041A2: variable '_OF' is possibly undefined

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
