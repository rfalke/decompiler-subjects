/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

HMODULE __stdcall start(const CHAR *a1);
// int __usercall sub_40040D@<eax>(int a1@<eax>);
// char __usercall sub_40041A@<al>(char *a1@<eax>, int a2@<ecx>, _BYTE *a3@<edi>);
char *sub_400423();
char sub_40047B();
// void __usercall __noreturn sub_4004B8(char _AL@<al>, _BYTE *a2@<edx>, int a3@<edi>);
// BOOL __stdcall EnumTimeFormatsA(TIMEFMT_ENUMPROCA lpTimeFmtEnumProc, LCID Locale, DWORD dwFlags);
// DWORD __stdcall GetCurrentThreadId();
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);

//-------------------------------------------------------------------------
// Data declarations

__int16 word_400492 = -17310; // weak
_UNKNOWN unk_400712; // weak
CHAR aUe9u[4] = "µÊ9Ü"; // idb
int dword_400734 = -5633; // weak


//----- (00400300) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
HMODULE __stdcall start(const CHAR *a1)
{
  GetCurrentThreadId();
  return GetModuleHandleA(a1);
}
// 4003ED: positive sp value 14 has been found

//----- (0040040D) --------------------------------------------------------
int __usercall sub_40040D@<eax>(int a1@<eax>)
{
  return dword_400734 + a1;
}
// 400734: using guessed type int dword_400734;

//----- (0040041A) --------------------------------------------------------
char __usercall sub_40041A@<al>(char *a1@<eax>, int a2@<ecx>, _BYTE *a3@<edi>)
{
  char result; // al

  do
  {
    result = *a1++;
    *a3++ = result;
    --a2;
  }
  while ( a2 );
  return result;
}

//----- (00400423) --------------------------------------------------------
char *sub_400423()
{
  int v0; // ecx
  _BYTE *v1; // eax
  _BYTE *v2; // eax
  HMODULE v3; // ebx
  _DWORD *v4; // edx
  int v5; // ebp

  v0 = 13;
  v1 = &unk_400712;
  do
  {
    *v1 = __ROR1__(*v1, 1);
    v2 = v1 + 1;
    *v2 = __ROL1__(*v2, 1);
    v1 = v2 + 1;
    --v0;
  }
  while ( v0 );
  v3 = GetModuleHandleA(aUe9u);
  v4 = (_DWORD *)((char *)v3 + *(_DWORD *)((char *)v3 + *((_DWORD *)v3 + 15) + 120));
  v5 = 0;
  do
  {
    if ( !memcmp((char *)v3 + *(_DWORD *)((char *)v3 + 4 * v5 + v4[8]), &unk_400712, 0xDu) )
      break;
    ++v5;
  }
  while ( v5 != v4[6] );
  return (char *)v3 + *(_DWORD *)((char *)v3 + 4 * v5 + v4[7]);
}

//----- (0040047B) --------------------------------------------------------
char sub_40047B()
{
  __int16 *v0; // esi
  char result; // al

  v0 = (__int16 *)((char *)EnumTimeFormatsA - 1);
  do
  {
    result = *(_BYTE *)v0 ^ 0x37;
    *(_BYTE *)v0 = result;
    v0 = (__int16 *)((char *)v0 - 1);
  }
  while ( v0 >= &word_400492 );
  return result;
}
// 400492: using guessed type __int16 word_400492;

//----- (004004B8) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_4004B8(char _AL@<al>, _BYTE *a2@<edx>, int a3@<edi>)
{
  _BYTE *v8; // [esp-8h] [ebp-8h]

  *a2 = 0;
  *(_BYTE *)(a3 + 55) ^= BYTE1(a2);
  *a2 <<= 7;
  *(_BYTE *)(a3 + 55) ^= BYTE1(a2);
  *a2 *= 8;
  *(_BYTE *)(a3 + 55) ^= BYTE1(a2);
  __asm { aaa }
  *v8 ^= BYTE1(a2);
  __asm
  {
    aaa
    aaa
    aaa
    aaa
  }
  JUMPOUT(0xDE777C0D);
}
// 4004D5: positive sp value 8 has been found
// 4004D5: control flows out of bounds to DE777C0D
// 4004CC: variable 'v8' is possibly undefined

// nfuncs=13 queued=6 decompiled=6 lumina nreq=0 worse=0 better=0
// ALL OK, 6 function(s) have been successfully decompiled
