/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// __int16 __usercall start@<ax>(int _EAX@<eax>, int a2@<edx>, int _ECX@<ecx>, int a4@<ebx>, int a5@<ebp>, int _EDI@<edi>, int a7@<esi>, double a8@<st0>);
// double __userpurge sub_407AFC@<st0>(char a1@<al>, __int16 a2@<dx>, int _ECX@<ecx>, int a4@<ebx>, int _EBP@<ebp>, int a6@<edi>, double result@<st0>, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_407CBE; // weak
_UNKNOWN loc_407D3C; // weak


//----- (004061CA) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
__int16 __usercall start@<ax>(int _EAX@<eax>, int a2@<edx>, int _ECX@<ecx>, int a4@<ebx>, int a5@<ebp>, int _EDI@<edi>, int a7@<esi>, double a8@<st0>)
{
  char v11; // ah
  bool v12; // tt
  unsigned int v13; // edi
  int v15; // edi
  bool v16; // cf
  int v17; // esi
  unsigned int v19; // edi
  int v21; // ecx
  char v24; // al
  unsigned __int32 v26; // et0
  _DWORD *v28; // esi
  char v30; // cl
  char v31; // bh
  unsigned int v32; // esi
  unsigned int v35; // esi
  int v36; // esi
  int v37; // ebx
  unsigned int v39; // esi
  char v46; // al
  int v47; // esi
  int v54; // edx
  char v55; // cl
  int v56; // ecx
  unsigned int v57; // ebx
  __int16 v58; // cx
  int v59; // ecx
  unsigned int v61; // edi
  char v64; // tt
  unsigned int v65; // ebx
  int v67; // edx
  int v70; // esi
  int v72; // edi
  int v81; // edx
  int v84; // esi
  __int16 v87; // ax
  int v90; // esi
  int v91; // ebx
  int v93; // edi
  __int16 v95; // bx
  int v96; // edx
  _DWORD *v99; // edi
  unsigned int v101; // esi
  unsigned int v107; // esi
  unsigned int v108; // edi
  unsigned int v109; // eax
  bool v111; // tt
  int v114; // edx
  unsigned int v115; // esi
  unsigned int v116; // ebx
  int v118; // edx
  BOOL v119; // ett
  int v120; // edi
  int v122; // ecx
  unsigned int v123; // ett
  unsigned __int32 v124; // eax
  int v125; // ebx
  int v127; // [esp-6D42h] [ebp-6D42h] BYREF
  int v128; // [esp-6D3Eh] [ebp-6D3Eh]
  int v129; // [esp-6D3Ah] [ebp-6D3Ah]
  int v130; // [esp-6D36h] [ebp-6D36h]
  int v131; // [esp-6D32h] [ebp-6D32h]
  int v132; // [esp-6D2Eh] [ebp-6D2Eh]
  int v133; // [esp-6D2Ah] [ebp-6D2Ah]
  int v134; // [esp-6D26h] [ebp-6D26h]
  int v135; // [esp-6D22h] [ebp-6D22h]
  int v136; // [esp-6D1Eh] [ebp-6D1Eh]
  int v137; // [esp-6D1Ah] [ebp-6D1Ah]
  int v138; // [esp-6D16h] [ebp-6D16h]
  int v139; // [esp-6D12h] [ebp-6D12h]
  int v140; // [esp-6D0Eh] [ebp-6D0Eh]
  int v141; // [esp-6D0Ah] [ebp-6D0Ah]
  int v142; // [esp-6D06h] [ebp-6D06h]
  int v143; // [esp-6D02h] [ebp-6D02h]
  int v144; // [esp-6CFEh] [ebp-6CFEh]
  int v145; // [esp-6CFAh] [ebp-6CFAh]
  int v146; // [esp-6CF6h] [ebp-6CF6h]
  int v147; // [esp-6CF2h] [ebp-6CF2h]
  int v148; // [esp-6CEEh] [ebp-6CEEh]
  int v149; // [esp-6CEAh] [ebp-6CEAh]
  int v150; // [esp-6CE6h] [ebp-6CE6h]
  int v151; // [esp-6CE2h] [ebp-6CE2h]
  int v152; // [esp-6CDEh] [ebp-6CDEh]
  int v153; // [esp-6CDAh] [ebp-6CDAh]
  int v154; // [esp-6CD6h] [ebp-6CD6h]
  int v155; // [esp-6CD2h] [ebp-6CD2h]
  int v156; // [esp-6CCEh] [ebp-6CCEh]
  int v157; // [esp-6CCAh] [ebp-6CCAh]
  int v158; // [esp-6CC6h] [ebp-6CC6h]
  int v159; // [esp-6CC2h] [ebp-6CC2h]
  int v160; // [esp-6CBEh] [ebp-6CBEh]
  int v161; // [esp-6CBAh] [ebp-6CBAh]
  int v162; // [esp-6CB6h] [ebp-6CB6h]
  int v163; // [esp-6CB2h] [ebp-6CB2h]
  int v164; // [esp-6CAEh] [ebp-6CAEh]
  int v165; // [esp-6CAAh] [ebp-6CAAh]
  int v166; // [esp-6CA6h] [ebp-6CA6h]
  int v167; // [esp-6CA2h] [ebp-6CA2h]
  int v168; // [esp-6C9Eh] [ebp-6C9Eh]
  int v169; // [esp-6C9Ah] [ebp-6C9Ah]
  int v170; // [esp-6C96h] [ebp-6C96h]
  int v171; // [esp-6C92h] [ebp-6C92h]
  int v172; // [esp-6C8Eh] [ebp-6C8Eh]
  int v173; // [esp-6C8Ah] [ebp-6C8Ah]
  int v174; // [esp-6C86h] [ebp-6C86h]
  int v175; // [esp-6C82h] [ebp-6C82h]
  int v176; // [esp-6C7Eh] [ebp-6C7Eh]
  int v177; // [esp-6C7Ah] [ebp-6C7Ah]
  int v178; // [esp-6C76h] [ebp-6C76h]
  int v179; // [esp-6C72h] [ebp-6C72h]
  int v180; // [esp-6C6Eh] [ebp-6C6Eh]
  int v181; // [esp-6C6Ah] [ebp-6C6Ah]
  int v182; // [esp-6C66h] [ebp-6C66h]
  int v183; // [esp-20h] [ebp-20h]
  _DWORD *v184; // [esp-1Ch] [ebp-1Ch]
  int v185; // [esp-14h] [ebp-14h]
  _DWORD *v186; // [esp-4h] [ebp-4h]

  v16 = __CFADD__(__CFSHL__(BYTE1(_EAX), 17), BYTE1(a4));
  BYTE1(a4) += __CFSHL__(BYTE1(_EAX), 17);
  v16 |= __CFADD__((_BYTE)_ECX, BYTE1(a4));
  BYTE1(a4) += _ECX;
  v17 = a7 - (v16 - 1358614813);
  BYTE1(_EAX) = 0;
  _EDX = a2 << 7 << _ECX;
  BYTE1(_EDX) <<= _ECX;
  __asm
  {
    rcr     dh, 16h
    rcl     di, cl
  }
  _EBX = _EAX ^ a4;
  _AL = __ROR1__(_EAX, 27);
  __asm { rcl     al, cl }
  ++BYTE1(_ECX);
  _EDI = __ROL4__(-_EDI, _ECX);
  BYTE1(_EAX) = __ROR1__(0, _ECX);
  BYTE1(_EDX) >>= _ECX;
LABEL_42:
  LOBYTE(_EAX) = BYTE1(_EDX) + _EAX;
  _ESI = __ROR4__(v17, _ECX);
  v16 = __CFSHR__(_ECX, _ECX);
  LOWORD(_ECX) = (__int16)_ECX >> _ECX;
  BYTE1(_EAX) -= v16 - 14;
  BYTE1(_EDX) &= BYTE1(_EAX);
  v59 = _EAX | _ECX;
  LOWORD(v59) = v59 - 1;
  __asm { rcl     edi, 8 }
  _ECX = __CFSHL__(_EDX, 11) + v59 - 1550206638;
  LOWORD(_ESI) = ~(_WORD)_ESI;
  LOWORD(_ECX) = (__int16)_ECX >> _ECX;
  __asm { rcr     ah, cl }
  LOBYTE(_EAX) = 13;
  LOWORD(_ECX) = _ECX - 1;
  BYTE1(_ECX) <<= _ECX;
  _ECX = _ECX & 0x346AFBC3;
  __asm { rcl     ah, 0Ah }
  LOWORD(_EDI) = -(__int16)_EDI;
  v19 = HIBYTE(_EDI);
  HIWORD(_EDX) = HIWORD(_EBX);
  LOBYTE(_ECX) = BYTE1(_ECX) + _ECX;
  if ( _EAX == -957168620 )
  {
    v127 = _EBX;
    _disable();
  }
  else
  {
    _ECX &= 0xBD84DABA;
    v90 = __ROR4__(~_ESI, _ECX);
    LOBYTE(_EAX) = 24;
    LOWORD(v90) = (unsigned __int16)v90 >> _ECX;
    BYTE1(_EAX) = BYTE1(_ECX) & (BYTE1(_EAX) + 13);
    __asm { rcl     ch, cl }
    _ESI = v90 + 504642153;
    LOWORD(_ESI) = _EAX ^ _ESI;
    BYTE1(_ECX) = _EBX;
    v19 >>= _ECX;
  }
  LOBYTE(_ECX) = _ECX + 1;
  LOWORD(_EDX) = v19;
  LOWORD(_EAX) = v19;
  v21 = _ECX << 14;
  BYTE1(v21) = BYTE1(v19);
  LOWORD(v19) = (__int16)v19 >> v21;
  LOBYTE(_EAX) = (char)_EAX >> v21;
  LOWORD(_ESI) = __ROR2__(_ESI, v21);
  if ( _EBX == -311827786 )
  {
    __asm { icebp }
    _EAX = __indword(_EDX);
    __asm { xlat }
    v26 = _EAX;
    v24 = v21;
    _ECX = v26;
LABEL_6:
    __asm { rcr     esi, 1Ah }
    v28 = (_DWORD *)__ROR4__(_ESI, 24);
    LOBYTE(_ECX) = ((unsigned __int8)_EDX & (unsigned __int8)_ECX) << (_EDX & _ECX);
    ++BYTE1(_ECX);
    LOBYTE(_EAX) = v24 >> _ECX;
    __asm { rcr     ch, 11h }
    v16 = __CFSHR__(_ECX, 23);
    _ECX = _ECX >> 23;
    __asm { rcr     dl, cl }
    v99 = (_DWORD *)(v19 - (v16 - 1313954740));
    BYTE1(_ECX) = __ROR1__(BYTE1(_ECX), _ECX);
    if ( _ECX == 1448342781 )
    {
      *v99 = *v28;
      JUMPOUT(0x4068BE);
    }
    BYTE1(_EAX) = __ROR1__(0, 11);
    if ( _EBX != -1648686475 )
      JUMPOUT(0x406411);
    return _EAX;
  }
  LOWORD(v21) = v21 - 1;
  LOBYTE(_EAX) = __ROL1__(_EAX, v21);
  _ECX = _EDX + v21;
  _ESI = _ESI >> 13;
  SBYTE1(_EAX) >>= _ECX;
  _EAX = -_EAX;
  __asm { rcr     esi, 13h }
  BYTE1(_EAX) = -BYTE1(_EAX);
  if ( _EAX != 144886001 )
  {
    ++BYTE1(_EDX);
    v11 = BYTE1(_EAX) << _ECX;
    v12 = __CFSHR__(v11, _ECX);
    BYTE1(_EAX) = __ROR1__(v11, _ECX);
    v13 = _EDX + v12 + v19;
    LOBYTE(_ECX) = -(char)_ECX;
    LOBYTE(_EDX) = __ROR1__(_EDX, 2);
    if ( v13 != 143334644 )
      JUMPOUT(0x406378);
    BYTE1(_ECX) = _ECX + BYTE1(_EBX);
    _ECX = (__PAIR64__(_ECX, &v127) - __PAIR64__(*(_DWORD *)(_EDX - 1044260842), a5)) >> 32;
    __asm { rep shr si, cl }
    v15 = -749106042 << _ECX;
    LOWORD(v15) = __ROR2__(-749106042 << _ECX, _ECX);
    BYTE1(_ECX) += BYTE1(_EAX) + __CFSHR__(-749106042 << _ECX, _ECX);
    __asm { rcr     ecx, cl }
    LOBYTE(_ECX) = _ECX + 1;
    _EDI = v15 << 11;
    while ( 1 )
    {
      BYTE1(_EBX) = 0;
      __asm { rcr     edi, 2 }
      v19 = _EDI << 25;
      LOWORD(_ECX) = __ROR2__(_ECX, _ECX);
      if ( _EDX == -2042369920 )
        break;
LABEL_73:
      BYTE1(_EBX) -= 81;
      v116 = __ROL4__(_EBX, _ECX);
      __asm { rcl     ch, 19h }
      LOBYTE(_ECX) = _ECX - 1;
      v115 = _ESI >> _ECX;
      BYTE1(v116) = __ROR1__(BYTE1(v116), 23);
      _EDI = v19 - 915490754;
      LOBYTE(_ECX) = __ROL1__(_ECX, 26);
      if ( _EAX == -1841576590 )
        JUMPOUT(0x2B5C641F);
      _ECX = v116 ^ _ECX;
      _EBX = v116 >> 7;
      LOBYTE(_EBX) = _ECX + __CFSHR__(BYTE1(_ECX), _ECX) + _EBX;
      _ESI = ~((_EAX < 0x923BC572) + v115 - 1148857156) << 9;
      BYTE1(_EBX) |= 5u;
      BYTE1(_ECX) = (SBYTE1(_ECX) >> _ECX) - 48;
      if ( _ESI == 1946499492 )
      {
        _EAX = MEMORY[0x740539A4];
        v17 = 1946499496;
        __asm
        {
          aam     95h ; '•'
          rcr     dword ptr [edx+61h], 5
        }
        goto LABEL_42;
      }
      LOBYTE(_ECX) = _ECX ^ 0x8E;
      _EBX -= 564015741;
      BYTE1(_EBX) = __ROR1__(BYTE1(_EBX), _ECX);
      LOWORD(_ECX) = __ROR2__(_ECX, _ECX);
      LOBYTE(_ECX) = _ECX + 86;
      LOBYTE(_EBX) = _EBX - 1;
      v19 = _EDI << 17;
      if ( _ESI == 1847888591 )
        goto LABEL_22;
      _EAX = __GS__;
      LOWORD(_ESI) = _ESI + 1;
      BYTE1(_EBX) = (BYTE1(_EBX) & 0x42) << _ECX;
      __asm { rcl     esi, cl }
      LOBYTE(_ECX) = __ROL1__(_ECX, 21);
      BYTE1(_EBX) = BYTE1(_EDX) & BYTE1(_EBX) | 0x67;
      BYTE1(_ECX) = 0;
      __asm { rcr     ch, cl }
      v91 = ~_EBX;
      LOWORD(_ESI) = _EDX;
      LOBYTE(v91) = 4 * v91;
      _ECX = (_ECX + 682873493) | 0xCB858A14;
      BYTE1(_ECX) |= 0x94u;
      if ( _ESI != -999543737 )
      {
        v57 = _ESI + (_ESI < 0xC46C2C47) + v91;
        v58 = v57;
        _EBX = v57 << v57;
        HIBYTE(v58) = (SHIBYTE(v58) >> 1) ^ 0xB9;
        LOWORD(_ECX) = __ROR2__(v58, v58);
        LOWORD(v19) = _EDX;
        v54 = _EDX + 1;
        v61 = v19 + 221611069;
        LOBYTE(_EBX) = _EBX - 123;
        __asm { rcr     bl, cl }
        BYTE1(_ECX) = ~(BYTE1(_ECX) - 67);
        if ( v61 == 963794528 )
        {
          __asm { aam     27h ; ''' }
          *(_BYTE *)(_EAX + a5) = __ROL1__(*(_BYTE *)(_EAX + a5), 186);
          v64 = BYTE1(v54);
          BYTE1(v54) = *(_BYTE *)(v61 + 232505530);
          *(_BYTE *)(v61 + 232505530) = v64;
          BYTE1(_EBX) = _EBX & (__GS^1__ << _ECX);
          v65 = _EBX + 1662723545;
          LOBYTE(v65) = v65 - v54;
          BYTE1(_ECX) = __ROR1__(BYTE1(_ECX), _ECX);
          SBYTE1(v65) >>= _ECX;
          __asm { rcr     ecx, 6 }
          _ECX = __ROL4__(_ECX, _ECX);
          __asm { rcr     cl, cl }
          v35 = __ROL4__(-493908042, _ECX);
          v16 = v35 < 0x39725660;
          v36 = v35 - 963794528 + 1;
          v37 = v16 + v65 + 2082195957;
          if ( _EAX == 1282658499 )
            JUMPOUT(0x4062F5);
          LOBYTE(v37) = __ROR1__(v37, 3);
          LOWORD(v37) = v36 | v37;
          BYTE1(v37) -= BYTE1(_ECX);
          BYTE1(_ECX) += _EAX;
          LOWORD(v36) = v36 - 1;
          sub_407AFC(
            _EAX,
            v54,
            _ECX,
            v37,
            a5,
            963794528,
            a8,
            v127,
            v128,
            v129,
            v130,
            v131,
            v132,
            v133,
            v134,
            v135,
            v136,
            v137,
            v138,
            v139,
            v140,
            v141,
            v142,
            v143,
            v144,
            v145,
            v146,
            v147,
            v148,
            v149,
            v150,
            v151,
            v152,
            v153,
            v154,
            v155,
            v156,
            v157,
            v158,
            v159,
            v160,
            v161,
            v162,
            v163,
            v164,
            v165,
            v166,
            v167,
            v168,
            v169,
            v170,
            v171,
            v172,
            v173,
            v174,
            v175,
            v176,
            v177,
            v178,
            v179,
            v180,
            v181,
            v182);
          _EAX = MEMORY[0xACCE2EE3];
          LOBYTE(_EAX) = __inbyte(0xCAu);
          v16 = __CFSHL__(*(_BYTE *)(_EAX + 67), 26);
          *(_BYTE *)(_EAX + 67) = __ROL1__(*(_BYTE *)(_EAX + 67), 26);
          v119 = v16;
          v16 = __CFADD__(v16, *(_DWORD *)(v118 - 69942562)) | __CFADD__(
                                                                 v16 + *(_DWORD *)(v118 - 69942562),
                                                                 -1802201332);
          *(_DWORD *)(v118 - 69942562) = v119 + *(_DWORD *)(v118 - 69942562) - 1802201332;
          v120 = v183;
          LOBYTE(_EAX) = __inbyte(v118);
          LOBYTE(_EAX) = *(_BYTE *)v36;
          __asm { aam     51h ; 'Q' }
          v123 = v16 + v118;
          v16 = *(_DWORD *)(v122 - 96) < v123;
          *(_DWORD *)(v122 - 96) -= v123;
          v183 = v120;
          v124 = __indword(v118);
          v125 = v185;
          v186 = v184;
          _enable();
          *v186 -= v16 + v125;
          JUMPOUT(0x406ABC);
        }
        v16 = __CFSHR__(_ECX, 27);
        _ECX = _ECX >> 27;
        BYTE1(_EBX) = _EBX;
        __asm { rcr     ch, 2 }
        LOBYTE(_EBX) = __GS__ + v16 + _EBX;
        __asm
        {
          rcr     ch, cl
          rcl     bx, cl
        }
        if ( _ECX != -476751825 )
        {
          v30 = __ROL1__(BYTE1(_ECX), _ECX) ^ 0x4F;
          v31 = HIBYTE(_BX) | 0x1D;
          v32 = _ESI << v30;
          if ( v54 != 30008921 )
            JUMPOUT(0x406836);
          _EAX = __GS__ & 0x1C9E659;
          v55 = __ROL1__(v30, v30) - 81;
          LOBYTE(_EAX) = 32 * v31;
          if ( v32 == 1083239930 )
          {
            __outdword(6u, _EAX);
            JUMPOUT(0x40647D);
          }
          LOWORD(_EAX) = __ROR4__(_EAX, v55);
        }
        return _EAX;
      }
      a5 = 377305982;
      _EBX = -908924646;
      _EDI = v19 - 678759994;
      _EAX = __ROR4__(__GS__, 1);
      if ( !(__GS__ & 1) )
      {
        __asm { rcl     edi, cl }
        v93 = _EDI >> _ECX;
        _ECX = HIWORD(_ECX);
        if ( v93 == 348533483 )
          JUMPOUT(0x4061A5);
        __asm { rcr     cl, cl }
        JUMPOUT(0x406535);
      }
    }
    __ES__ = v127;
    v46 = (_EAX + 0x80) & 0xB2 ^ 0x84;
    v47 = -306154058 >> _ECX;
    BYTE1(_EDX) = 23;
    LOBYTE(_EDX) = _ECX + __CFSHR__(v46, 4) + 127;
    v24 = v46 >> 7;
    if ( _EDX == 1502387289 )
      __asm { retn    213h }
    _ECX = __ROL4__(_ECX, 9);
    LOWORD(v47) = v47 - _EDX;
    _ESI = v47 - 884438451;
    LOWORD(_EDX) = (_WORD)_EDX << _ECX;
    __asm { rcr     cl, cl }
    if ( _ESI == 654003125 )
    {
      __asm
      {
        arpl    bx, sp
        lock and bh, bl
        rcl     ecx, 11h
      }
      v39 = _ESI << 30;
      BYTE1(_EDX) += _EBX;
      _AH = 0;
      __asm { rcr     ah, cl }
      LOBYTE(_ECX) = -43;
      LOBYTE(_EDX) = _AH ^ _EDX;
      LOWORD(v19) = _EDX + v19;
      BYTE1(_EBX) ^= v24;
      _ECX = _EBX + _ECX;
      v16 = __CFSHR__(_AH, _ECX);
      HIBYTE(v87) = _AH >> _ECX;
      LOBYTE(v87) = HIBYTE(v87) + v16 + v24;
      if ( v39 == 1492777821 )
      {
        __asm
        {
          int     0D5h; used by BASIC while in interpreter
          retf
        }
      }
      BYTE1(_ECX) ^= 0x1Fu;
      __asm { rcr     ecx, 13h }
      LOBYTE(v87) = (char)v87 >> _ECX << _ECX;
      LOWORD(_EAX) = ~v87;
      if ( v19 != -410274544 )
      {
        __asm { rcl     ecx, cl }
        v101 = v19 + v39;
        v16 = __CFSHR__(v101, _ECX);
        LOWORD(v101) = (__int16)v101 >> _ECX;
        LOBYTE(_ECX) = BYTE1(_EBX) + v16 + _ECX;
        LOWORD(v19) = -(__int16)v19;
        v16 = _ECX < 3;
        _ECX = _ECX - 3;
        LOBYTE(_ECX) = v16 + _ECX + 85;
        _DX = _EDX & 0x9222;
        if ( v19 == 978712629 )
          JUMPOUT(0x4063D5);
        __asm { rcl     dx, cl }
        _ECX = _ECX ^ 0x57F4B7B2;
        __asm { rcr     ecx, 6 }
        if ( __ROL4__(~v101, _ECX) == 480438574 )
        {
          _enable();
          JUMPOUT(0x406576);
        }
        JUMPOUT(0x4063A4);
      }
      return _EAX;
    }
    goto LABEL_6;
  }
  _enable();
  LOBYTE(_EDX) = _EDX - 9;
  _EAX = -570015;
  _ESI = __ROR4__(_ESI + 1, _ECX);
  BYTE1(_EDX) = 2 * BYTE1(_EDX) - (__CFSHL__(BYTE1(_EDX), 1) + 86);
LABEL_22:
  LOBYTE(_EDX) = __ROR1__(_EDX, 5);
  BYTE1(_EDX) ^= _EBX ^ 0x31;
  v67 = _EDX << _ECX;
  LOBYTE(_EAX) = __ROR1__(_EAX + 1, 9);
  v109 = _EAX + 1;
  BYTE1(v67) = (SBYTE1(v67) >> 7) - (__CFSHR__(BYTE1(v67), 7) + _ECX);
  v107 = (_ESI << 12) - v109;
  LOWORD(v19) = v107 + v19;
  v108 = v19 + 1197633265;
  LOWORD(v109) = __ROL2__(v109, _ECX);
  if ( _EBX == 1459301360 )
    JUMPOUT(0x4069A4);
  v16 = __CFSHL__(v109, _ECX);
  LOBYTE(v109) = (_BYTE)v109 << _ECX;
  _ESI = v107 - (v16 - 367790631);
  v16 = __CFADD__(BYTE1(v109), (_BYTE)v109);
  LOBYTE(v109) = BYTE1(v109) + v109;
  BYTE1(v67) ^= BYTE1(v109);
  BYTE1(v109) = (v67 + v16 + BYTE1(v109)) ^ 0x82;
  if ( _ECX == -2012550003 )
  {
    BYTE1(_EBX) = -68;
    MEMORY[0xA0145013] = v109;
  }
  BYTE1(v109) ^= BYTE1(_ECX);
  v111 = __CFSHR__(v109, 25);
  LOBYTE(v109) = __ROR1__(v109, 25);
  _EAX = v109 - (v111 - 1669340948);
  LOBYTE(_EAX) = _EAX - v67;
  __asm { rcr     si, cl }
  LOWORD(v67) = v67 + 1;
  _EDI = __ROR4__(v108, 18);
  v114 = -v67;
  if ( _EDI == 1621050983 )
    JUMPOUT(0x40699B);
  _EDX = v114 | 0x4796B41D;
  LOBYTE(_ECX) = ~(_BYTE)_ECX;
  _BX = _EDI | _EBX;
  __asm
  {
    rcr     eax, cl
    rcl     bh, 1Bh
  }
  _ECX = _ECX - 1;
  v16 = (unsigned __int16)_EDX < (unsigned __int16)_ECX;
  BYTE1(_EDX) = BYTE1(_EDI);
  LOBYTE(_ECX) = v16 + _ECX + 3;
  __asm { rcl     ecx, 0Bh }
  LOBYTE(_EDX) = 0;
  _EAX = 0;
  _ESI = ((int)__ROL4__(_ESI, 7) >> _ECX) + 1880841700;
  __asm
  {
    rcr     edi, cl
    rcl     dh, 17h
  }
  v72 = __ROR4__(_EDI, 20);
  LOWORD(_ESI) = _BX + _ESI;
  __asm { rcr     bl, cl }
  BYTE1(_ECX) = 0;
  LOBYTE(_BX) = _BL >> _ECX;
  _ECX = _ECX << _ECX;
  if ( _ESI == -2019075655 )
  {
    __outbyte(_EDX, 0);
    JUMPOUT(0x406682);
  }
  __asm { rcr     si, cl }
  BYTE1(_ECX) -= 12;
  v56 = _ECX ^ 0x61A454A4;
  HIBYTE(_BX) = __ROL1__(HIBYTE(_BX), v56);
  LOWORD(v56) = (unsigned __int16)v56 >> v56;
  LOBYTE(v56) = (_BYTE)v56 << v56;
  _ECX = __ROR4__(v56, v56);
  _EDI = (v72 - 1243778928) | 0xBE7FDE77;
  v84 = _ECX & _ESI;
  __asm { rcr     bx, cl }
  BYTE1(_ECX) -= _BX;
  v84 -= 371240278;
  LOWORD(v84) = __ROL2__(v84, _ECX);
  __asm
  {
    rcl     edi, cl
    int     2Eh; DOS 2+ internal - EXECUTE COMMAND
  }
  v16 = __CFADD__(__CFSHL__(HIBYTE(_BX), _ECX), v84);
  v70 = __CFSHL__(HIBYTE(_BX), _ECX) + v84;
  v16 |= __CFADD__(v70, 116095897);
  v70 += 116095897;
  LOWORD(_EDX) = _EDX + 1;
  LOBYTE(_EDX) = v16 + _EDX - 40;
  __asm { rcr     edi, 0Dh }
  v81 = v70 ^ _EDX;
  LOBYTE(v81) = BYTE1(_ECX) + __CFSHL__(HIBYTE(_BX) << _ECX, 26) + v81;
  LOWORD(v70) = (_WORD)v70 << _ECX;
  _ESI = v70 + 1;
  v19 = -_EDI;
  v95 = (unsigned __int8)__ROR1__(_BX, _ECX);
  v16 = __CFADD__(__CFSHR__(v95, _ECX), v81);
  v96 = __CFSHR__(v95, _ECX) + v81;
  v16 |= __CFADD__(v96, -538330077);
  _EDX = v96 - 538330077;
  BYTE1(_EDX) -= v16 - 27;
  __asm
  {
    rcl     ecx, 16h
    rcr     al, 18h
  }
  LOBYTE(_EDX) = __ROL1__(_EDX, _ECX) - 1;
  BYTE1(_EBX) = HIBYTE(v95) >> _ECX;
  BYTE1(_EDX) = (BYTE1(_EDX) >> _ECX) ^ 0xAD;
  LOBYTE(_EBX) = v95 & 0xC1;
  BYTE1(_EAX) = 80;
  __asm { rcl     si, cl }
  if ( v19 == -745542422 )
  {
    *(_DWORD *)(_EAX - 1958581018) += _EDX;
    LOBYTE(_EAX) = _EAX + 6;
    goto LABEL_73;
  }
  LOWORD(_EAX) = 20807;
  return _EAX;
}
// 406AAB: positive sp value 6D3E has been found
// 4062F3: control flows out of bounds to 4062F5
// 40647C: control flows out of bounds to 40647D
// 4064A3: control flows out of bounds to 4064A4
// 406575: control flows out of bounds to 406576
// 406680: control flows out of bounds to 406682
// 4069A2: control flows out of bounds to 4069A4
// 406A76: control flows out of bounds to 406A7C
// 406ABA: control flows out of bounds to 406ABC
// 406A81: inconsistent fpu stack
// 4063EA: control flows out of bounds to 4063D5
// 4065A6: control flows out of bounds to 406535
// 40662D: control flows out of bounds to 406322
// 4067AC: control flows out of bounds to 406836
// 4067F5: control flows out of bounds to 406378
// 40687E: control flows out of bounds to 4061A5
// 4068D5: control flows out of bounds to 4068BE
// 406A59: control flows out of bounds to 2B5C641F
// 40656D: control flows out of bounds to 4063A4
// 406680: control flows out of bounds to 40667D
// 406916: control flows out of bounds to 406411
// 4069F4: control flows out of bounds to 40699B
// 406A94: variable 'v118' is possibly undefined
// 406AA3: variable 'v122' is possibly undefined

//----- (00407AFC) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
double __userpurge sub_407AFC@<st0>(char a1@<al>, __int16 a2@<dx>, int _ECX@<ecx>, int a4@<ebx>, int _EBP@<ebp>, int a6@<edi>, double result@<st0>, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  int v64; // edi
  unsigned __int32 v68; // eax
  _BYTE *v71; // edx
  int v72; // eax
  int v73; // ecx
  char v74; // bh
  unsigned int v75; // eax
  char v77; // pf
  unsigned int v78; // eax
  bool v81; // tt
  int v82; // eax
  int v84; // ecx
  int v87; // edi
  int v88; // ebx
  char v91; // bl
  int v92; // edi
  unsigned int v93; // eax
  char v94; // tt
  int v95; // ebx
  int v96; // edi
  bool v97; // cf
  char v98; // al
  int v99; // edi
  char v102; // tt
  unsigned int v105; // eax
  unsigned int v106; // edx
  int v107; // eax
  int v109; // eax
  __int16 v113; // bx
  char v114; // bh
  char v115; // bl
  int v118; // edi
  int v120; // [esp-8h] [ebp-8h]
  unsigned int v121; // [esp-4h] [ebp-4h]
  unsigned int v122; // [esp-4h] [ebp-4h]

  v98 = a2 | a1;
  v99 = a4 + a6;
  BYTE1(_ECX) &= HIBYTE(a2);
  BYTE1(a4) += 73;
  v113 = -(__int16)a4;
  v114 = HIBYTE(v113) << _ECX;
  v115 = __ROR1__(v113, _ECX);
  LOBYTE(_ECX) = v114 + _ECX;
  if ( _ECX == 233165481 )
  {
    _AL = ~v98;
    __asm { rcr     al, cl }
    JUMPOUT(0x4076A2);
  }
  _EDI = __ROR4__(v99, _ECX);
  for ( _EAX = (_DWORD *)&loc_407CBE; *_EAX != 9460301; _EAX = (_DWORD *)(((unsigned int)_EAX - 1) & 0xFFFFF000) )
    ;
  if ( _EAX == (_DWORD *)195215312 )
  {
    __asm { rcl     ah, 3 }
    BYTE1(_EAX) -= (unsigned __int16)(MEMORY[0xDF5D898B] & 0x6826) >> 8;
    v97 = (unsigned int)_EAX < (unsigned int)__CFSHR__(100, 20) - 455216258;
    v107 = (int)_EAX - __CFSHR__(100, 20) + 455216258;
    BYTE1(v107) = v115 - (v97 - 48);
    _EAX = -v107;
    __asm { rcr     al, 4 }
    *(_BYTE *)(MEMORY[0xDF5D898B] & 0xDAE6826) = v114;
    JUMPOUT(0x4079BB);
  }
  v72 = (*(int (__cdecl **)(_DWORD *))((char *)_EAX
                                     + *(_DWORD *)((char *)_EAX
                                                 + *(_DWORD *)((char *)_EAX + _EAX[15] + (_DWORD)&loc_407D3C - 4226236)
                                                 + 16)))(_EAX);
  v73 = v120;
  LOBYTE(v72) = v72 - 1;
  v74 = __ROL1__(v114, v115 ^ v120);
  if ( v72 != -756558241 )
  {
    LOBYTE(v73) = v121 | v115 ^ v120;
    _ECX = v73 << 30;
    v105 = v72 << 17;
    __asm { rcr     di, cl }
    v106 = v121 + 706;
    BYTE1(v105) = -(char)_ECX;
    LOBYTE(v105) = v74 + ((_BYTE)_ECX != 0) + v121 - 62 + (v121 < 0xFFFFFD3E) + v105;
    LOBYTE(_ECX) = _ECX | 0xEB;
    v87 = __ROR4__(_EDI, 17) - 1;
    v105 >>= 23;
    LOWORD(v87) = -(__int16)v87;
    LOBYTE(v105) = __ROR1__(v105, 19)
                 - ((__CFADD__(__CFSHR__(v105, 19), _ECX & v74) | __CFADD__(__CFSHR__(v105, 19) + (_ECX & v74), 22))
                  + __CFSHR__(v105, 19)
                  + (_ECX & v74)
                  + 22);
    __asm { rcl     ecx, cl }
    _EBX = -688501511;
    v122 = v106;
    v97 = __CFADD__(BYTE1(_ECX), (_BYTE)v105);
    LOBYTE(v105) = BYTE1(_ECX) + v105;
    v102 = v97;
    v97 = __CFADD__(v97, BYTE1(_ECX));
    BYTE1(_ECX) += v102;
    v97 |= __CFADD__((_BYTE)v106, BYTE1(_ECX));
    BYTE1(_ECX) += v106;
    _EDI = v97 + v87 + 1158122119;
    LOWORD(_EDI) = v106;
    BYTE1(v105) -= 56;
    _EAX = v105 << 25;
    BYTE1(_EAX) = __ROR1__(BYTE1(_EAX), 20);
    LOBYTE(_ECX) = (_BYTE)v106 << 7;
    BYTE1(_EBX) = 0;
    v71 = (_BYTE *)(v106 - 706);
    if ( _ECX == -475547264 )
    {
      *(_DWORD *)_EBX &= 0x13u;
      __asm { aad     0E6h ; 'æ' }
      BYTE1(_EBX) = *(_BYTE *)(_EBP - 947858186);
      *(float *)_EBX = result;
      LOWORD(_EDI) = (__int16)_EDI >> 15;
      BYTE1(_EAX) = 0;
      LOWORD(_EDI) = _EDI - 1;
      v64 = 32 * _EDI;
      BYTE1(_ECX) = BYTE1(v71) + __CFSHR__(0x80, 3) - 71;
      LOBYTE(_ECX) = -17;
      __asm
      {
        rcl     ecx, cl
        rcr     ah, cl
      }
      LOBYTE(_ECX) = BYTE1(_EAX) + (BYTE1(_ECX) | _ECX);
      LOBYTE(_EAX) = 0;
      LOWORD(v64) = (unsigned __int16)v64 >> _ECX;
      if ( v64 == 307028920 )
        __asm { retf    6D1Eh }
      LOBYTE(_ECX) = _ECX - 1;
      BYTE1(_ECX) = BYTE1(v71) ^ (BYTE1(_EAX) | BYTE1(_ECX));
      __asm { rcr     ah, 6 }
      v109 = (_EAX >> _ECX) - (__CFSHR__(_EAX, _ECX) + 981837574);
      _ECX = __ROR4__(_ECX, _ECX);
      if ( v109 == -754536798 )
      {
        __asm { bound   ebp, [ecx-66h] }
        JUMPOUT(0x407CA8);
      }
      _CL = BYTE1(v71) | _ECX;
      __asm { rcl     cl, cl }
      JUMPOUT(0x407DEE);
    }
    BYTE1(_ECX) = (~BYTE1(_ECX) - BYTE1(v71)) ^ 0xD;
    LOBYTE(_ECX) = _ECX & 2;
    LOBYTE(_EBX) = __ROL1__(-7, _ECX);
    LOBYTE(_EAX) = _EAX + 1;
    __asm { rcr     di, cl }
    v97 = __CFADD__(_EDI, 2057951290);
    v118 = _EDI + 2057951290;
    BYTE1(_EAX) = __ROL1__(BYTE1(_EAX), 28);
    BYTE1(_EAX) = BYTE1(_EAX) - 68 - ((BYTE1(_EAX) < 0x44u) + BYTE1(v71)) - (v97 - 113);
    if ( _ECX == -1511839185 )
    {
      __asm { aaa }
      MEMORY[0x31CFE8E] &= 0xFFFFFFC9;
      JUMPOUT(0x407CFD);
    }
    _ECX = _ECX - 926613278;
    v78 = _EAX << _ECX;
    BYTE1(v78) = ~BYTE1(v78);
    __asm { rcr     bl, 1Dh }
    _EDI = __ROL4__(v118, 15) ^ 0xFAA84E43;
    LOBYTE(v78) = __ROL1__(BYTE1(v71) | v78, 25);
    LOBYTE(_ECX) = __ROL1__(_ECX, 5);
    LOWORD(_EDI) = (_WORD)_EDI << _ECX;
    v75 = __ROL4__(v78 - 558458246, _ECX);
    __asm { rcr     edi, 1Ah }
    LOWORD(_EDI) = _ECX & _EDI;
    BYTE1(_EBX) = BYTE1(_EDI);
    __asm { rcr     bh, 0Ch }
    LOBYTE(_EBX) = 0;
    v97 = __CFSHR__(BYTE1(_EBX), 122);
    SBYTE1(_EBX) >>= 7;
    v94 = v97 - 89;
    v97 = BYTE1(_EBX) < (unsigned __int8)(v97 - 89);
    BYTE1(_EBX) -= v94;
    v95 = _EBX - (v97 + 1359185706);
    v91 = __ROR1__(v95, 122);
    LOBYTE(_ECX) = 122 - BYTE1(v75);
    v92 = _EDI + 705595336;
    __asm { rcl     ch, cl }
    BYTE1(_ECX) &= 0xA9u;
    v97 = v75 < 0xBED;
    v93 = v75 - 3053;
    BYTE1(v93) -= v97 + 84;
    if ( v92 == 1288270858 )
      JUMPOUT(0x407A6C);
    BYTE1(v93) = __ROR1__(BYTE1(v93) | 0xB4, _ECX);
    v82 = _ECX & v93;
    BYTE1(_ECX) = __ROL1__(BYTE1(_ECX), _ECX);
    v96 = -v92;
    v97 = __CFSHR__(_ECX, 27);
    _ECX = _ECX >> 27;
    v81 = v97;
    v97 = __CFADD__(v97, (_BYTE)v82);
    LOBYTE(v82) = v81 + v82;
    v97 |= __CFADD__(v91, (_BYTE)v82);
    LOBYTE(v82) = (v91 + v82) ^ 0xAE;
    BYTE1(v82) = v91 ^ (v97 - 11 - BYTE1(v82));
    __asm { rcr     ch, cl }
    LOBYTE(v95) = -v91 ^ 0x67;
    LOWORD(v96) = v96 + 1;
    if ( v96 == 1592213372 )
    {
      __writeeflags(v122);
      if ( v77 )
      {
        LOWORD(_ECX) = __ROL2__(_ECX, _ECX);
        LOBYTE(_ECX) = v95 ^ _ECX;
        v84 = __ROL4__(_ECX, 29);
        LOWORD(v84) = (unsigned __int16)v84 >> v84;
        if ( v84 == 9221020 )
        {
          MEMORY[0xBF8] = 0;
          JUMPOUT(0x407957);
        }
        JUMPOUT(0x4077C9);
      }
      _disable();
      __outdword((unsigned __int16)v71, v82);
      JUMPOUT(0x407861);
    }
    v88 = v95 << 27;
    BYTE1(v88) = *v71;
    _CX = _ECX ^ 0xC14A;
    __asm { rcr     cx, cl }
    _AH = 0;
    if ( v88 == -1827062854 )
      JUMPOUT(0x407B6A);
    __asm { rcr     ah, 11h }
    BYTE1(v88) = -BYTE1(v88);
    if ( v88 == -1444798098 )
    {
      v68 = __indword(0xCFu);
      JUMPOUT(0xF001E879);
    }
    JUMPOUT(0x4078C0);
  }
  return result;
}
// 407859: positive sp value 6D16 has been found
// 407B68: control flows out of bounds to 407B6A
// 407CA5: control flows out of bounds to 407CA8
// 407CFA: control flows out of bounds to 407CFD
// 407D75: control flows out of bounds to 407D77
// 4076A3: control flows out of bounds to 4076A5
// 407853: control flows out of bounds to 407858
// 40785C: control flows out of bounds to 407861
// 4078BD: control flows out of bounds to 4078C0
// 407955: control flows out of bounds to 407957
// 407A6B: control flows out of bounds to 407A6C
// 407C19: control flows out of bounds to 40794D
// 407C3A: control flows out of bounds to 4079BB
// 407DB3: control flows out of bounds to 4076A2
// 407735: control flows out of bounds to F001E879
// 4079F7: control flows out of bounds to 407DEE
// 407AD6: control flows out of bounds to 4077C9
// 407BF4: control flows out of bounds to 407C07
// 407D0E: control flows out of bounds to 407D5B
// 40782B: bad sp value at call
// 407874: variable 'v121' is possibly undefined
// 407870: variable 'v120' is possibly undefined
// 4078C4: variable 'v77' is possibly undefined
// 407AFC: too many input arguments, some ignored

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
