/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// double __usercall start@<st0>(int _EAX@<eax>, int a2@<edx>, int _ECX@<ecx>, int a4@<ebx>, unsigned int a5@<ebp>, int _EDI@<edi>, int a7@<esi>, double result@<st0>);
// double __userpurge sub_407AFC@<st0>(char@<al>, __int16@<dx>, int _ECX@<ecx>, int@<ebx>, int _EBP@<ebp>, int@<edi>, double result@<st0>, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_407CBE; // weak
_UNKNOWN loc_407D3C; // weak


//----- (004061CA) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
double __usercall start@<st0>(
        int _EAX@<eax>,
        int a2@<edx>,
        int _ECX@<ecx>,
        int a4@<ebx>,
        unsigned int a5@<ebp>,
        int _EDI@<edi>,
        int a7@<esi>,
        double result@<st0>)
{
  char v11; // ah
  bool v12; // tt
  unsigned int v13; // edi
  int v15; // edi
  bool v16; // cf
  int v17; // esi
  unsigned int v19; // edi
  int v21; // ecx
  _DWORD *v26; // esi
  char v27; // bh
  unsigned int v28; // esi
  unsigned int v31; // esi
  int v32; // esi
  int v33; // ebx
  unsigned int v35; // esi
  char v42; // al
  int v43; // esi
  char v44; // al
  int v51; // edx
  int v52; // eax
  int v53; // ecx
  unsigned int v54; // ebx
  __int16 v55; // cx
  int v56; // ecx
  unsigned int v58; // edi
  char v61; // tt
  unsigned int v62; // ebx
  int v64; // edx
  int v67; // esi
  int v69; // edi
  int v78; // edx
  int v82; // esi
  int v87; // esi
  int v88; // ebx
  int v90; // edi
  __int16 v92; // bx
  int v93; // edx
  _DWORD *v96; // edi
  unsigned int v98; // esi
  unsigned int v104; // esi
  unsigned int v105; // edi
  unsigned int v106; // eax
  bool v108; // tt
  int v111; // edx
  unsigned int v112; // esi
  unsigned int v113; // ebx
  int v115; // edx
  BOOL v116; // ett
  int v117; // edi
  int v119; // ecx
  unsigned int v120; // ett
  int v121; // ebx
  int v122; // [esp-6D42h] [ebp-6D42h] BYREF
  int v123; // [esp-6D3Eh] [ebp-6D3Eh]
  int v124; // [esp-6D3Ah] [ebp-6D3Ah]
  int v125; // [esp-6D36h] [ebp-6D36h]
  int v126; // [esp-6D32h] [ebp-6D32h]
  int v127; // [esp-6D2Eh] [ebp-6D2Eh]
  int v128; // [esp-6D2Ah] [ebp-6D2Ah]
  int v129; // [esp-6D26h] [ebp-6D26h]
  int v130; // [esp-6D22h] [ebp-6D22h]
  int v131; // [esp-6D1Eh] [ebp-6D1Eh]
  int v132; // [esp-6D1Ah] [ebp-6D1Ah]
  int v133; // [esp-6D16h] [ebp-6D16h]
  int v134; // [esp-6D12h] [ebp-6D12h]
  int v135; // [esp-6D0Eh] [ebp-6D0Eh]
  int v136; // [esp-6D0Ah] [ebp-6D0Ah]
  int v137; // [esp-6D06h] [ebp-6D06h]
  int v138; // [esp-6D02h] [ebp-6D02h]
  int v139; // [esp-6CFEh] [ebp-6CFEh]
  int v140; // [esp-6CFAh] [ebp-6CFAh]
  int v141; // [esp-6CF6h] [ebp-6CF6h]
  int v142; // [esp-6CF2h] [ebp-6CF2h]
  int v143; // [esp-6CEEh] [ebp-6CEEh]
  int v144; // [esp-6CEAh] [ebp-6CEAh]
  int v145; // [esp-6CE6h] [ebp-6CE6h]
  int v146; // [esp-6CE2h] [ebp-6CE2h]
  int v147; // [esp-6CDEh] [ebp-6CDEh]
  int v148; // [esp-6CDAh] [ebp-6CDAh]
  int v149; // [esp-6CD6h] [ebp-6CD6h]
  int v150; // [esp-6CD2h] [ebp-6CD2h]
  int v151; // [esp-6CCEh] [ebp-6CCEh]
  int v152; // [esp-6CCAh] [ebp-6CCAh]
  int v153; // [esp-6CC6h] [ebp-6CC6h]
  int v154; // [esp-6CC2h] [ebp-6CC2h]
  int v155; // [esp-6CBEh] [ebp-6CBEh]
  int v156; // [esp-6CBAh] [ebp-6CBAh]
  int v157; // [esp-6CB6h] [ebp-6CB6h]
  int v158; // [esp-6CB2h] [ebp-6CB2h]
  int v159; // [esp-6CAEh] [ebp-6CAEh]
  int v160; // [esp-6CAAh] [ebp-6CAAh]
  int v161; // [esp-6CA6h] [ebp-6CA6h]
  int v162; // [esp-6CA2h] [ebp-6CA2h]
  int v163; // [esp-6C9Eh] [ebp-6C9Eh]
  int v164; // [esp-6C9Ah] [ebp-6C9Ah]
  int v165; // [esp-6C96h] [ebp-6C96h]
  int v166; // [esp-6C92h] [ebp-6C92h]
  int v167; // [esp-6C8Eh] [ebp-6C8Eh]
  int v168; // [esp-6C8Ah] [ebp-6C8Ah]
  int v169; // [esp-6C86h] [ebp-6C86h]
  int v170; // [esp-6C82h] [ebp-6C82h]
  int v171; // [esp-6C7Eh] [ebp-6C7Eh]
  int v172; // [esp-6C7Ah] [ebp-6C7Ah]
  int v173; // [esp-6C76h] [ebp-6C76h]
  int v174; // [esp-6C72h] [ebp-6C72h]
  int v175; // [esp-6C6Eh] [ebp-6C6Eh]
  int v176; // [esp-6C6Ah] [ebp-6C6Ah]
  int v177; // [esp-6C66h] [ebp-6C66h]
  int v178; // [esp-20h] [ebp-20h]
  _DWORD *v179; // [esp-1Ch] [ebp-1Ch]
  int v180; // [esp-14h] [ebp-14h]
  _DWORD *v181; // [esp-4h] [ebp-4h]

  v16 = __CFADD__(__CFSHL__(BYTE1(_EAX), 17), BYTE1(a4));
  BYTE1(a4) += __CFSHL__(BYTE1(_EAX), 17);
  v16 |= __CFADD__((_BYTE)_ECX, BYTE1(a4));
  BYTE1(a4) += _ECX;
  v17 = a7 - (v16 - 1358614813);
  BYTE1(_EAX) = 0;
  _EDX = a2 << 7 << _ECX;
  BYTE1(_EDX) <<= _ECX;
  __asm
  {
    rcr     dh, 16h
    rcl     di, cl
  }
  _EBX = _EAX ^ a4;
  _AL = __ROR1__(_EAX, 27);
  __asm { rcl     al, cl }
  ++BYTE1(_ECX);
  _EDI = __ROL4__(-_EDI, _ECX);
  BYTE1(_EAX) = __ROR1__(0, _ECX);
  BYTE1(_EDX) >>= _ECX;
LABEL_42:
  LOBYTE(_EAX) = BYTE1(_EDX) + _EAX;
  _ESI = __ROR4__(v17, _ECX);
  v16 = __CFSHR__(_ECX, _ECX);
  LOWORD(_ECX) = (__int16)_ECX >> _ECX;
  BYTE1(_EAX) -= v16 - 14;
  BYTE1(_EDX) &= BYTE1(_EAX);
  v56 = _EAX | _ECX;
  LOWORD(v56) = v56 - 1;
  __asm { rcl     edi, 8 }
  _ECX = __CFSHL__(_EDX, 11) + v56 - 1550206638;
  LOWORD(_ESI) = ~(_WORD)_ESI;
  LOWORD(_ECX) = (__int16)_ECX >> _ECX;
  __asm { rcr     ah, cl }
  LOBYTE(_EAX) = 13;
  LOWORD(_ECX) = _ECX - 1;
  BYTE1(_ECX) <<= _ECX;
  _ECX = _ECX & 0x346AFBC3;
  __asm { rcl     ah, 0Ah }
  LOWORD(_EDI) = -(__int16)_EDI;
  v19 = HIBYTE(_EDI);
  HIWORD(_EDX) = HIWORD(_EBX);
  LOBYTE(_ECX) = BYTE1(_ECX) + _ECX;
  if ( _EAX == -957168620 )
  {
    v122 = _EBX;
    _disable();
  }
  else
  {
    _ECX &= 0xBD84DABA;
    v87 = __ROR4__(~_ESI, _ECX);
    LOBYTE(_EAX) = 24;
    LOWORD(v87) = (unsigned __int16)v87 >> _ECX;
    BYTE1(_EAX) = BYTE1(_ECX) & (BYTE1(_EAX) + 13);
    __asm { rcl     ch, cl }
    _ESI = v87 + 504642153;
    LOWORD(_ESI) = _EAX ^ _ESI;
    BYTE1(_ECX) = _EBX;
    v19 >>= _ECX;
  }
  LOBYTE(_ECX) = _ECX + 1;
  LOWORD(_EDX) = v19;
  LOWORD(_EAX) = v19;
  v21 = _ECX << 14;
  BYTE1(v21) = BYTE1(v19);
  LOWORD(v19) = (__int16)v19 >> v21;
  LOBYTE(_EAX) = (char)_EAX >> v21;
  LOWORD(_ESI) = __ROR2__(_ESI, v21);
  if ( _EBX == -311827786 )
  {
    __asm { icebp }
    _EAX = __indword(_EDX);
    __asm { xlat }
    _ECX = _EAX;
LABEL_6:
    __asm { rcr     esi, 1Ah }
    v26 = (_DWORD *)__ROR4__(_ESI, 24);
    LOBYTE(_ECX) = ((unsigned __int8)_EDX & (unsigned __int8)_ECX) << (_EDX & _ECX);
    ++BYTE1(_ECX);
    __asm { rcr     ch, 11h }
    v16 = __CFSHR__(_ECX, 23);
    _ECX = _ECX >> 23;
    __asm { rcr     dl, cl }
    v96 = (_DWORD *)(v19 - (v16 - 1313954740));
    BYTE1(_ECX) = __ROR1__(BYTE1(_ECX), _ECX);
    if ( _ECX == 1448342781 )
    {
      *v96 = *v26;
      JUMPOUT(0x4068BE);
    }
    if ( _EBX != -1648686475 )
      JUMPOUT(0x406411);
    return result;
  }
  LOWORD(v21) = v21 - 1;
  LOBYTE(_EAX) = __ROL1__(_EAX, v21);
  _ECX = _EDX + v21;
  _ESI = _ESI >> 13;
  SBYTE1(_EAX) >>= _ECX;
  _EAX = -_EAX;
  __asm { rcr     esi, 13h }
  BYTE1(_EAX) = -BYTE1(_EAX);
  if ( _EAX != 144886001 )
  {
    ++BYTE1(_EDX);
    v11 = BYTE1(_EAX) << _ECX;
    v12 = __CFSHR__(v11, _ECX);
    BYTE1(_EAX) = __ROR1__(v11, _ECX);
    v13 = _EDX + v12 + v19;
    LOBYTE(_ECX) = -(char)_ECX;
    LOBYTE(_EDX) = __ROR1__(_EDX, 2);
    if ( v13 != 143334644 )
      JUMPOUT(0x406378);
    BYTE1(_ECX) = _ECX + BYTE1(_EBX);
    _ECX = (__PAIR64__(_ECX, &v122) - __PAIR64__(*(_DWORD *)(_EDX - 1044260842), a5)) >> 32;
    __asm { rep shr si, cl }
    v15 = -749106042 << _ECX;
    LOWORD(v15) = __ROR2__(-749106042 << _ECX, _ECX);
    BYTE1(_ECX) += BYTE1(_EAX) + __CFSHR__(-749106042 << _ECX, _ECX);
    __asm { rcr     ecx, cl }
    LOBYTE(_ECX) = _ECX + 1;
    _EDI = v15 << 11;
    while ( 1 )
    {
      BYTE1(_EBX) = 0;
      __asm { rcr     edi, 2 }
      v19 = _EDI << 25;
      LOWORD(_ECX) = __ROR2__(_ECX, _ECX);
      if ( _EDX == -2042369920 )
        break;
LABEL_73:
      BYTE1(_EBX) -= 81;
      v113 = __ROL4__(_EBX, _ECX);
      __asm { rcl     ch, 19h }
      LOBYTE(_ECX) = _ECX - 1;
      v112 = _ESI >> _ECX;
      BYTE1(v113) = __ROR1__(BYTE1(v113), 23);
      _EDI = v19 - 915490754;
      LOBYTE(_ECX) = __ROL1__(_ECX, 26);
      if ( _EAX == -1841576590 )
        JUMPOUT(0x2B5C641F);
      _ECX = v113 ^ _ECX;
      _EBX = v113 >> 7;
      LOBYTE(_EBX) = _ECX + __CFSHR__(BYTE1(_ECX), _ECX) + _EBX;
      _ESI = ~((_EAX < 0x923BC572) + v112 - 1148857156) << 9;
      BYTE1(_EBX) |= 5u;
      BYTE1(_ECX) = (SBYTE1(_ECX) >> _ECX) - 48;
      if ( _ESI == 1946499492 )
      {
        _EAX = MEMORY[0x740539A4];
        v17 = 1946499496;
        __asm
        {
          aam     95h ; '•'
          rcr     dword ptr [edx+61h], 5
        }
        goto LABEL_42;
      }
      LOBYTE(_ECX) = _ECX ^ 0x8E;
      _EBX -= 564015741;
      BYTE1(_EBX) = __ROR1__(BYTE1(_EBX), _ECX);
      LOWORD(_ECX) = __ROR2__(_ECX, _ECX);
      LOBYTE(_ECX) = _ECX + 86;
      LOBYTE(_EBX) = _EBX - 1;
      v19 = _EDI << 17;
      if ( _ESI == 1847888591 )
        goto LABEL_22;
      _EAX = __GS__;
      LOWORD(_ESI) = _ESI + 1;
      BYTE1(_EBX) = (BYTE1(_EBX) & 0x42) << _ECX;
      __asm { rcl     esi, cl }
      LOBYTE(_ECX) = __ROL1__(_ECX, 21);
      BYTE1(_EBX) = BYTE1(_EDX) & BYTE1(_EBX) | 0x67;
      BYTE1(_ECX) = 0;
      __asm { rcr     ch, cl }
      v88 = ~_EBX;
      LOWORD(_ESI) = _EDX;
      LOBYTE(v88) = 4 * v88;
      _ECX = (_ECX + 682873493) | 0xCB858A14;
      BYTE1(_ECX) |= 0x94u;
      if ( _ESI != -999543737 )
      {
        v54 = _ESI + (_ESI < 0xC46C2C47) + v88;
        v55 = v54;
        _EBX = v54 << v54;
        HIBYTE(v55) = (SHIBYTE(v55) >> 1) ^ 0xB9;
        LOWORD(_ECX) = __ROR2__(v55, v55);
        LOWORD(v19) = _EDX;
        v51 = _EDX + 1;
        v58 = v19 + 221611069;
        LOBYTE(_EBX) = _EBX - 123;
        __asm { rcr     bl, cl }
        BYTE1(_ECX) = ~(BYTE1(_ECX) - 67);
        if ( v58 == 963794528 )
        {
          __asm { aam     27h ; ''' }
          *(_BYTE *)(_EAX + a5) = __ROL1__(*(_BYTE *)(_EAX + a5), 186);
          v61 = BYTE1(v51);
          BYTE1(v51) = *(_BYTE *)(v58 + 232505530);
          *(_BYTE *)(v58 + 232505530) = v61;
          BYTE1(_EBX) = _EBX & (__GS^1__ << _ECX);
          v62 = _EBX + 1662723545;
          LOBYTE(v62) = v62 - v51;
          BYTE1(_ECX) = __ROR1__(BYTE1(_ECX), _ECX);
          SBYTE1(v62) >>= _ECX;
          __asm { rcr     ecx, 6 }
          _ECX = __ROL4__(_ECX, _ECX);
          __asm { rcr     cl, cl }
          v31 = __ROL4__(-493908042, _ECX);
          v16 = v31 < 0x39725660;
          v32 = v31 - 963794528 + 1;
          v33 = v16 + v62 + 2082195957;
          if ( _EAX == 1282658499 )
            JUMPOUT(0x4062F5);
          LOBYTE(v33) = __ROR1__(v33, 3);
          LOWORD(v33) = v32 | v33;
          BYTE1(v33) -= BYTE1(_ECX);
          BYTE1(_ECX) += _EAX;
          LOWORD(v32) = v32 - 1;
          sub_407AFC(
            _EAX,
            v51,
            _ECX,
            v33,
            a5,
            963794528,
            result,
            v122,
            v123,
            v124,
            v125,
            v126,
            v127,
            v128,
            v129,
            v130,
            v131,
            v132,
            v133,
            v134,
            v135,
            v136,
            v137,
            v138,
            v139,
            v140,
            v141,
            v142,
            v143,
            v144,
            v145,
            v146,
            v147,
            v148,
            v149,
            v150,
            v151,
            v152,
            v153,
            v154,
            v155,
            v156,
            v157,
            v158,
            v159,
            v160,
            v161,
            v162,
            v163,
            v164,
            v165,
            v166,
            v167,
            v168,
            v169,
            v170,
            v171,
            v172,
            v173,
            v174,
            v175,
            v176,
            v177);
          _EAX = MEMORY[0xACCE2EE3];
          LOBYTE(_EAX) = __inbyte(0xCAu);
          v16 = __CFSHL__(*(_BYTE *)(_EAX + 67), 26);
          *(_BYTE *)(_EAX + 67) = __ROL1__(*(_BYTE *)(_EAX + 67), 26);
          v116 = v16;
          v16 = __CFADD__(v16, *(_DWORD *)(v115 - 69942562)) | __CFADD__(
                                                                 v16 + *(_DWORD *)(v115 - 69942562),
                                                                 -1802201332);
          *(_DWORD *)(v115 - 69942562) = v116 + *(_DWORD *)(v115 - 69942562) - 1802201332;
          v117 = v178;
          __inbyte(v115);
          LOBYTE(_EAX) = *(_BYTE *)v32;
          __asm { aam     51h ; 'Q' }
          v120 = v16 + v115;
          v16 = *(_DWORD *)(v119 - 96) < v120;
          *(_DWORD *)(v119 - 96) -= v120;
          v178 = v117;
          __indword(v115);
          v121 = v180;
          v181 = v179;
          _enable();
          *v181 -= v16 + v121;
          JUMPOUT(0x406ABC);
        }
        v16 = __CFSHR__(_ECX, 27);
        _ECX = _ECX >> 27;
        BYTE1(_EBX) = _EBX;
        __asm { rcr     ch, 2 }
        LOBYTE(_EBX) = __GS__ + v16 + _EBX;
        __asm
        {
          rcr     ch, cl
          rcl     bx, cl
        }
        if ( _ECX != -476751825 )
        {
          v27 = HIBYTE(_BX) | 0x1D;
          v28 = _ESI << (__ROL1__(BYTE1(_ECX), _ECX) ^ 0x4F);
          if ( v51 != 30008921 )
            JUMPOUT(0x406836);
          v52 = __GS__ & 0x1C9E659;
          if ( v28 == 1083239930 )
          {
            LOBYTE(v52) = 32 * v27;
            __outdword(6u, v52);
            JUMPOUT(0x40647D);
          }
        }
        return result;
      }
      a5 = 377305982;
      _EBX = -908924646;
      _EDI = v19 - 678759994;
      _EAX = __ROR4__(__GS__, 1);
      if ( !(__GS__ & 1) )
      {
        __asm { rcl     edi, cl }
        v90 = _EDI >> _ECX;
        _ECX = HIWORD(_ECX);
        if ( v90 == 348533483 )
          JUMPOUT(0x4061A5);
        __asm { rcr     cl, cl }
        JUMPOUT(0x406535);
      }
    }
    __ES__ = v122;
    v42 = (_EAX + 0x80) & 0xB2 ^ 0x84;
    v43 = -306154058 >> _ECX;
    BYTE1(_EDX) = 23;
    LOBYTE(_EDX) = _ECX + __CFSHR__(v42, 4) + 127;
    v44 = v42 >> 7;
    if ( _EDX == 1502387289 )
      __asm { retn    213h }
    _ECX = __ROL4__(_ECX, 9);
    LOWORD(v43) = v43 - _EDX;
    _ESI = v43 - 884438451;
    LOWORD(_EDX) = (_WORD)_EDX << _ECX;
    __asm { rcr     cl, cl }
    if ( _ESI == 654003125 )
    {
      __asm
      {
        arpl    bx, sp
        lock and bh, bl
        rcl     ecx, 11h
      }
      v35 = _ESI << 30;
      BYTE1(_EDX) += _EBX;
      _AH = 0;
      __asm { rcr     ah, cl }
      LOBYTE(_ECX) = -43;
      LOBYTE(_EDX) = _AH ^ _EDX;
      LOWORD(v19) = _EDX + v19;
      BYTE1(_EBX) ^= v44;
      _ECX = _EBX + _ECX;
      if ( v35 == 1492777821 )
      {
        __asm
        {
          int     0D5h; used by BASIC while in interpreter
          retf
        }
      }
      BYTE1(_ECX) ^= 0x1Fu;
      __asm { rcr     ecx, 13h }
      if ( v19 != -410274544 )
      {
        __asm { rcl     ecx, cl }
        v98 = v19 + v35;
        v16 = __CFSHR__(v98, _ECX);
        LOWORD(v98) = (__int16)v98 >> _ECX;
        LOBYTE(_ECX) = BYTE1(_EBX) + v16 + _ECX;
        LOWORD(v19) = -(__int16)v19;
        v16 = _ECX < 3;
        _ECX = _ECX - 3;
        LOBYTE(_ECX) = v16 + _ECX + 85;
        _DX = _EDX & 0x9222;
        if ( v19 == 978712629 )
          JUMPOUT(0x4063D5);
        __asm { rcl     dx, cl }
        _ECX = _ECX ^ 0x57F4B7B2;
        __asm { rcr     ecx, 6 }
        if ( __ROL4__(~v98, _ECX) == 480438574 )
        {
          _enable();
          JUMPOUT(0x406576);
        }
        JUMPOUT(0x4063A4);
      }
      return result;
    }
    goto LABEL_6;
  }
  _enable();
  LOBYTE(_EDX) = _EDX - 9;
  _EAX = -570015;
  _ESI = __ROR4__(_ESI + 1, _ECX);
  BYTE1(_EDX) = 2 * BYTE1(_EDX) - (__CFSHL__(BYTE1(_EDX), 1) + 86);
LABEL_22:
  LOBYTE(_EDX) = __ROR1__(_EDX, 5);
  BYTE1(_EDX) ^= _EBX ^ 0x31;
  v64 = _EDX << _ECX;
  LOBYTE(_EAX) = __ROR1__(_EAX + 1, 9);
  v106 = _EAX + 1;
  BYTE1(v64) = (SBYTE1(v64) >> 7) - (__CFSHR__(BYTE1(v64), 7) + _ECX);
  v104 = (_ESI << 12) - v106;
  LOWORD(v19) = v104 + v19;
  v105 = v19 + 1197633265;
  LOWORD(v106) = __ROL2__(v106, _ECX);
  if ( _EBX == 1459301360 )
    JUMPOUT(0x4069A4);
  v16 = __CFSHL__(v106, _ECX);
  LOBYTE(v106) = (_BYTE)v106 << _ECX;
  _ESI = v104 - (v16 - 367790631);
  v16 = __CFADD__(BYTE1(v106), (_BYTE)v106);
  LOBYTE(v106) = BYTE1(v106) + v106;
  BYTE1(v64) ^= BYTE1(v106);
  BYTE1(v106) = (v64 + v16 + BYTE1(v106)) ^ 0x82;
  if ( _ECX == -2012550003 )
  {
    BYTE1(_EBX) = -68;
    MEMORY[0xA0145013] = v106;
  }
  BYTE1(v106) ^= BYTE1(_ECX);
  v108 = __CFSHR__(v106, 25);
  LOBYTE(v106) = __ROR1__(v106, 25);
  _EAX = v106 - (v108 - 1669340948);
  LOBYTE(_EAX) = _EAX - v64;
  __asm { rcr     si, cl }
  LOWORD(v64) = v64 + 1;
  _EDI = __ROR4__(v105, 18);
  v111 = -v64;
  if ( _EDI == 1621050983 )
    JUMPOUT(0x40699B);
  _EDX = v111 | 0x4796B41D;
  LOBYTE(_ECX) = ~(_BYTE)_ECX;
  _BX = _EDI | _EBX;
  __asm
  {
    rcr     eax, cl
    rcl     bh, 1Bh
  }
  _ECX = _ECX - 1;
  v16 = (unsigned __int16)_EDX < (unsigned __int16)_ECX;
  BYTE1(_EDX) = BYTE1(_EDI);
  LOBYTE(_ECX) = v16 + _ECX + 3;
  __asm { rcl     ecx, 0Bh }
  LOBYTE(_EDX) = 0;
  _EAX = 0;
  _ESI = ((int)__ROL4__(_ESI, 7) >> _ECX) + 1880841700;
  __asm
  {
    rcr     edi, cl
    rcl     dh, 17h
  }
  v69 = __ROR4__(_EDI, 20);
  LOWORD(_ESI) = _BX + _ESI;
  __asm { rcr     bl, cl }
  BYTE1(_ECX) = 0;
  LOBYTE(_BX) = _BL >> _ECX;
  _ECX = _ECX << _ECX;
  if ( _ESI == -2019075655 )
  {
    __outbyte(_EDX, 0);
    JUMPOUT(0x406682);
  }
  __asm { rcr     si, cl }
  BYTE1(_ECX) -= 12;
  v53 = _ECX ^ 0x61A454A4;
  HIBYTE(_BX) = __ROL1__(HIBYTE(_BX), v53);
  LOWORD(v53) = (unsigned __int16)v53 >> v53;
  LOBYTE(v53) = (_BYTE)v53 << v53;
  _ECX = __ROR4__(v53, v53);
  _EDI = (v69 - 1243778928) | 0xBE7FDE77;
  v82 = _ECX & _ESI;
  __asm { rcr     bx, cl }
  BYTE1(_ECX) -= _BX;
  v82 -= 371240278;
  LOWORD(v82) = __ROL2__(v82, _ECX);
  __asm
  {
    rcl     edi, cl
    int     2Eh; DOS 2+ internal - EXECUTE COMMAND
  }
  v16 = __CFADD__(__CFSHL__(HIBYTE(_BX), _ECX), v82);
  v67 = __CFSHL__(HIBYTE(_BX), _ECX) + v82;
  v16 |= __CFADD__(v67, 116095897);
  v67 += 116095897;
  LOWORD(_EDX) = _EDX + 1;
  LOBYTE(_EDX) = v16 + _EDX - 40;
  __asm { rcr     edi, 0Dh }
  v78 = v67 ^ _EDX;
  LOBYTE(v78) = BYTE1(_ECX) + __CFSHL__(HIBYTE(_BX) << _ECX, 26) + v78;
  LOWORD(v67) = (_WORD)v67 << _ECX;
  _ESI = v67 + 1;
  v19 = -_EDI;
  v92 = (unsigned __int8)__ROR1__(_BX, _ECX);
  v16 = __CFADD__(__CFSHR__(v92, _ECX), v78);
  v93 = __CFSHR__(v92, _ECX) + v78;
  v16 |= __CFADD__(v93, -538330077);
  _EDX = v93 - 538330077;
  BYTE1(_EDX) -= v16 - 27;
  __asm
  {
    rcl     ecx, 16h
    rcr     al, 18h
  }
  LOBYTE(_EDX) = __ROL1__(_EDX, _ECX) - 1;
  BYTE1(_EBX) = HIBYTE(v92) >> _ECX;
  BYTE1(_EDX) = (BYTE1(_EDX) >> _ECX) ^ 0xAD;
  LOBYTE(_EBX) = v92 & 0xC1;
  BYTE1(_EAX) = 80;
  __asm { rcl     si, cl }
  if ( v19 == -745542422 )
  {
    *(_DWORD *)(_EAX - 1958581018) += _EDX;
    LOBYTE(_EAX) = _EAX + 6;
    goto LABEL_73;
  }
  return result;
}
// 406AAB: positive sp value 6D3E has been found
// 4062F3: control flows out of bounds to 4062F5
// 40647C: control flows out of bounds to 40647D
// 4064A3: control flows out of bounds to 4064A4
// 406575: control flows out of bounds to 406576
// 406680: control flows out of bounds to 406682
// 4069A2: control flows out of bounds to 4069A4
// 406A76: control flows out of bounds to 406A7C
// 406ABA: control flows out of bounds to 406ABC
// 4063EA: control flows out of bounds to 4063D5
// 4065A6: control flows out of bounds to 406535
// 40662D: control flows out of bounds to 406322
// 4067AC: control flows out of bounds to 406836
// 4067F5: control flows out of bounds to 406378
// 40687E: control flows out of bounds to 4061A5
// 4068D5: control flows out of bounds to 4068BE
// 406A59: control flows out of bounds to 2B5C641F
// 40656D: control flows out of bounds to 4063A4
// 406680: control flows out of bounds to 40667D
// 406916: control flows out of bounds to 406411
// 4069F4: control flows out of bounds to 40699B
// 4064A1: conditional instruction was optimized away because esi.4==6E248ACF
// 406A94: variable 'v115' is possibly undefined
// 406AA3: variable 'v119' is possibly undefined

//----- (00407AFC) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
double __userpurge sub_407AFC@<st0>(
        char a1@<al>,
        __int16 a2@<dx>,
        int _ECX@<ecx>,
        int a4@<ebx>,
        int _EBP@<ebp>,
        int a6@<edi>,
        double result@<st0>,
        int a8,
        int a9,
        int a10,
        int a11,
        int a12,
        int a13,
        int a14,
        int a15,
        int a16,
        int a17,
        int a18,
        int a19,
        int a20,
        int a21,
        int a22,
        int a23,
        int a24,
        int a25,
        int a26,
        int a27,
        int a28,
        int a29,
        int a30,
        int a31,
        int a32,
        int a33,
        int a34,
        int a35,
        int a36,
        int a37,
        int a38,
        int a39,
        int a40,
        int a41,
        int a42,
        int a43,
        int a44,
        int a45,
        int a46,
        int a47,
        int a48,
        int a49,
        int a50,
        int a51,
        int a52,
        int a53,
        int a54,
        int a55,
        int a56,
        int a57,
        int a58,
        int a59,
        int a60,
        int a61,
        int a62,
        int a63)
{
  int v64; // edi
  _BYTE *v70; // edx
  int v71; // eax
  int v72; // ecx
  char v73; // bh
  unsigned int v74; // eax
  char v76; // pf
  unsigned int v77; // eax
  bool v80; // tt
  int v81; // eax
  int v83; // ecx
  int v86; // edi
  int v87; // ebx
  char v90; // bl
  int v91; // edi
  unsigned int v92; // eax
  char v93; // tt
  int v94; // ebx
  int v95; // edi
  bool v96; // cf
  char v97; // al
  int v98; // edi
  char v101; // tt
  unsigned int v104; // eax
  unsigned int v105; // edx
  int v106; // eax
  int v108; // eax
  __int16 v112; // bx
  char v113; // bh
  char v114; // bl
  int v117; // edi
  int v119; // [esp-8h] [ebp-8h]
  unsigned int v120; // [esp-4h] [ebp-4h]
  unsigned int v121; // [esp-4h] [ebp-4h]

  v97 = a2 | a1;
  v98 = a4 + a6;
  BYTE1(_ECX) &= HIBYTE(a2);
  BYTE1(a4) += 73;
  v112 = -(__int16)a4;
  v113 = HIBYTE(v112) << _ECX;
  v114 = __ROR1__(v112, _ECX);
  LOBYTE(_ECX) = v113 + _ECX;
  if ( _ECX == 233165481 )
  {
    _AL = ~v97;
    __asm { rcr     al, cl }
    JUMPOUT(0x4076A2);
  }
  _EDI = __ROR4__(v98, _ECX);
  for ( _EAX = (_DWORD *)&loc_407CBE; *_EAX != 9460301; _EAX = (_DWORD *)(((unsigned int)_EAX - 1) & 0xFFFFF000) )
    ;
  if ( _EAX == (_DWORD *)195215312 )
  {
    __asm { rcl     ah, 3 }
    BYTE1(_EAX) -= (unsigned __int16)(MEMORY[0xDF5D898B] & 0x6826) >> 8;
    v96 = (unsigned int)_EAX < (unsigned int)__CFSHR__(100, 20) - 455216258;
    v106 = (int)_EAX - __CFSHR__(100, 20) + 455216258;
    BYTE1(v106) = v114 - (v96 - 48);
    _EAX = -v106;
    __asm { rcr     al, 4 }
    *(_BYTE *)(MEMORY[0xDF5D898B] & 0xDAE6826) = v113;
    JUMPOUT(0x4079BB);
  }
  v71 = (*(int (__cdecl **)(_DWORD *))((char *)_EAX
                                     + *(_DWORD *)((char *)_EAX
                                                 + *(_DWORD *)((char *)_EAX + _EAX[15] + (_DWORD)&loc_407D3C - 4226236)
                                                 + 16)))(_EAX);
  v72 = v119;
  LOBYTE(v71) = v71 - 1;
  v73 = __ROL1__(v113, v114 ^ v119);
  if ( v71 != -756558241 )
  {
    LOBYTE(v72) = v120 | v114 ^ v119;
    _ECX = v72 << 30;
    v104 = v71 << 17;
    __asm { rcr     di, cl }
    v105 = v120 + 706;
    BYTE1(v104) = -(char)_ECX;
    LOBYTE(v104) = v73 + ((_BYTE)_ECX != 0) + v120 - 62 + (v120 < 0xFFFFFD3E) + v104;
    LOBYTE(_ECX) = _ECX | 0xEB;
    v86 = __ROR4__(_EDI, 17) - 1;
    v104 >>= 23;
    LOWORD(v86) = -(__int16)v86;
    LOBYTE(v104) = __ROR1__(v104, 19)
                 - ((__CFADD__(__CFSHR__(v104, 19), _ECX & v73) | __CFADD__(__CFSHR__(v104, 19) + (_ECX & v73), 22))
                  + __CFSHR__(v104, 19)
                  + (_ECX & v73)
                  + 22);
    __asm { rcl     ecx, cl }
    _EBX = -688501511;
    v121 = v105;
    v96 = __CFADD__(BYTE1(_ECX), (_BYTE)v104);
    LOBYTE(v104) = BYTE1(_ECX) + v104;
    v101 = v96;
    v96 = __CFADD__(v96, BYTE1(_ECX));
    BYTE1(_ECX) += v101;
    v96 |= __CFADD__((_BYTE)v105, BYTE1(_ECX));
    BYTE1(_ECX) += v105;
    _EDI = v96 + v86 + 1158122119;
    LOWORD(_EDI) = v105;
    BYTE1(v104) -= 56;
    _EAX = v104 << 25;
    BYTE1(_EAX) = __ROR1__(BYTE1(_EAX), 20);
    LOBYTE(_ECX) = (_BYTE)v105 << 7;
    BYTE1(_EBX) = 0;
    v70 = (_BYTE *)(v105 - 706);
    if ( _ECX == -475547264 )
    {
      *(_DWORD *)_EBX &= 0x13u;
      __asm { aad     0E6h ; 'æ' }
      BYTE1(_EBX) = *(_BYTE *)(_EBP - 947858186);
      *(float *)_EBX = result;
      LOWORD(_EDI) = (__int16)_EDI >> 15;
      BYTE1(_EAX) = 0;
      LOWORD(_EDI) = _EDI - 1;
      v64 = 32 * _EDI;
      BYTE1(_ECX) = BYTE1(v70) + __CFSHR__(0x80, 3) - 71;
      LOBYTE(_ECX) = -17;
      __asm
      {
        rcl     ecx, cl
        rcr     ah, cl
      }
      LOBYTE(_ECX) = BYTE1(_EAX) + (BYTE1(_ECX) | _ECX);
      LOBYTE(_EAX) = 0;
      LOWORD(v64) = (unsigned __int16)v64 >> _ECX;
      if ( v64 == 307028920 )
        __asm { retf    6D1Eh }
      LOBYTE(_ECX) = _ECX - 1;
      BYTE1(_ECX) = BYTE1(v70) ^ (BYTE1(_EAX) | BYTE1(_ECX));
      __asm { rcr     ah, 6 }
      v108 = (_EAX >> _ECX) - (__CFSHR__(_EAX, _ECX) + 981837574);
      _ECX = __ROR4__(_ECX, _ECX);
      if ( v108 == -754536798 )
      {
        __asm { bound   ebp, [ecx-66h] }
        JUMPOUT(0x407CA8);
      }
      _CL = BYTE1(v70) | _ECX;
      __asm { rcl     cl, cl }
      JUMPOUT(0x407DEE);
    }
    BYTE1(_ECX) = (~BYTE1(_ECX) - BYTE1(v70)) ^ 0xD;
    LOBYTE(_ECX) = _ECX & 2;
    LOBYTE(_EBX) = __ROL1__(-7, _ECX);
    LOBYTE(_EAX) = _EAX + 1;
    __asm { rcr     di, cl }
    v96 = __CFADD__(_EDI, 2057951290);
    v117 = _EDI + 2057951290;
    BYTE1(_EAX) = __ROL1__(BYTE1(_EAX), 28);
    BYTE1(_EAX) = BYTE1(_EAX) - 68 - ((BYTE1(_EAX) < 0x44u) + BYTE1(v70)) - (v96 - 113);
    if ( _ECX == -1511839185 )
    {
      __asm { aaa }
      MEMORY[0x31CFE8E] &= 0xFFFFFFC9;
      JUMPOUT(0x407CFD);
    }
    _ECX = _ECX - 926613278;
    v77 = _EAX << _ECX;
    BYTE1(v77) = ~BYTE1(v77);
    __asm { rcr     bl, 1Dh }
    _EDI = __ROL4__(v117, 15) ^ 0xFAA84E43;
    LOBYTE(v77) = __ROL1__(BYTE1(v70) | v77, 25);
    LOBYTE(_ECX) = __ROL1__(_ECX, 5);
    LOWORD(_EDI) = (_WORD)_EDI << _ECX;
    v74 = __ROL4__(v77 - 558458246, _ECX);
    __asm { rcr     edi, 1Ah }
    LOWORD(_EDI) = _ECX & _EDI;
    BYTE1(_EBX) = BYTE1(_EDI);
    __asm { rcr     bh, 0Ch }
    LOBYTE(_EBX) = 0;
    v96 = __CFSHR__(BYTE1(_EBX), 122);
    SBYTE1(_EBX) >>= 7;
    v93 = v96 - 89;
    v96 = BYTE1(_EBX) < (unsigned __int8)(v96 - 89);
    BYTE1(_EBX) -= v93;
    v94 = _EBX - (v96 + 1359185706);
    v90 = __ROR1__(v94, 122);
    LOBYTE(_ECX) = 122 - BYTE1(v74);
    v91 = _EDI + 705595336;
    __asm { rcl     ch, cl }
    BYTE1(_ECX) &= 0xA9u;
    v96 = v74 < 0xBED;
    v92 = v74 - 3053;
    BYTE1(v92) -= v96 + 84;
    if ( v91 == 1288270858 )
      JUMPOUT(0x407A6C);
    BYTE1(v92) = __ROR1__(BYTE1(v92) | 0xB4, _ECX);
    v81 = _ECX & v92;
    BYTE1(_ECX) = __ROL1__(BYTE1(_ECX), _ECX);
    v95 = -v91;
    v96 = __CFSHR__(_ECX, 27);
    _ECX = _ECX >> 27;
    v80 = v96;
    v96 = __CFADD__(v96, (_BYTE)v81);
    LOBYTE(v81) = v80 + v81;
    v96 |= __CFADD__(v90, (_BYTE)v81);
    LOBYTE(v81) = (v90 + v81) ^ 0xAE;
    BYTE1(v81) = v90 ^ (v96 - 11 - BYTE1(v81));
    __asm { rcr     ch, cl }
    LOBYTE(v94) = -v90 ^ 0x67;
    LOWORD(v95) = v95 + 1;
    if ( v95 == 1592213372 )
    {
      __writeeflags(v121);
      if ( v76 )
      {
        LOWORD(_ECX) = __ROL2__(_ECX, _ECX);
        LOBYTE(_ECX) = v94 ^ _ECX;
        v83 = __ROL4__(_ECX, 29);
        LOWORD(v83) = (unsigned __int16)v83 >> v83;
        if ( v83 == 9221020 )
        {
          MEMORY[0xBF8] = 0;
          JUMPOUT(0x407957);
        }
        JUMPOUT(0x4077C9);
      }
      _disable();
      __outdword((unsigned __int16)v70, v81);
      JUMPOUT(0x407861);
    }
    v87 = v94 << 27;
    BYTE1(v87) = *v70;
    _CX = _ECX ^ 0xC14A;
    __asm { rcr     cx, cl }
    _AH = 0;
    if ( v87 == -1827062854 )
      JUMPOUT(0x407B6A);
    __asm { rcr     ah, 11h }
    BYTE1(v87) = -BYTE1(v87);
    if ( v87 == -1444798098 )
    {
      __indword(0xCFu);
      JUMPOUT(0xF001E879);
    }
    JUMPOUT(0x4078C0);
  }
  return result;
}
// 407859: positive sp value 6D16 has been found
// 407B68: control flows out of bounds to 407B6A
// 407CA5: control flows out of bounds to 407CA8
// 407CFA: control flows out of bounds to 407CFD
// 407D75: control flows out of bounds to 407D77
// 4076A3: control flows out of bounds to 4076A5
// 407853: control flows out of bounds to 407858
// 40785C: control flows out of bounds to 407861
// 4078BD: control flows out of bounds to 4078C0
// 407955: control flows out of bounds to 407957
// 407A6B: control flows out of bounds to 407A6C
// 407C19: control flows out of bounds to 40794D
// 407C3A: control flows out of bounds to 4079BB
// 407DB3: control flows out of bounds to 4076A2
// 407735: control flows out of bounds to F001E879
// 4079F7: control flows out of bounds to 407DEE
// 407AD6: control flows out of bounds to 4077C9
// 407BF4: control flows out of bounds to 407C07
// 407D0E: control flows out of bounds to 407D5B
// 40782B: bad sp value at call
// 407919: conditional instruction was optimized away because edi.4==5EE73F7C
// 407874: variable 'v120' is possibly undefined
// 407870: variable 'v119' is possibly undefined
// 4078C4: variable 'v76' is possibly undefined
// 407AFC: too many input arguments, some ignored

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
