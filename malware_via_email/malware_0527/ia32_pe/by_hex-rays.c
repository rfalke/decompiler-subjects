/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

// void __usercall sub_401052(int a1@<eax>, int a2@<edx>, char a3@<cl>);
void __fastcall sub_401072(int a1, int a2);
void sub_401090();
_DWORD __far sub_401EDA(); // weak
// int __usercall sub_401FF1@<eax>(__int32 a1@<eax>, char a2@<bh>, int a3@<esi>, int a4, int a5);
void __fastcall sub_40202D(int a1, int a2);
void sub_40206E();
// void __usercall sub_402116(char a1@<al>, int a2@<edx>, int a3@<ebx>);
_DWORD __far sub_4024DC(); // weak
void sub_4024FB();
_DWORD __cdecl sub_402545(_DWORD, _DWORD); // weak
_DWORD sub_40270D(); // weak
_DWORD __far sub_402711(); // weak
void sub_40272F();
int sub_402821();
_DWORD sub_402836(); // weak
void sub_4028D5();
_DWORD __cdecl sub_402900(_DWORD, char); // weak
// void __usercall sub_40297E(int a1@<ebx>, __int32 a2@<edi>, int a3@<esi>);
void sub_402A4B();
void __thiscall sub_402C57(void *this);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_4010A6; // weak
_UNKNOWN loc_4022CD; // weak
_UNKNOWN loc_402474; // weak
_UNKNOWN loc_4024C5; // weak
_UNKNOWN loc_402792; // weak
_UNKNOWN loc_402874; // weak
_UNKNOWN loc_40295D; // weak


//----- (00401052) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401052(int a1@<eax>, int a2@<edx>, char a3@<cl>)
{
  bool v3; // zf
  int v4; // edx

  v4 = a1 | a2;
  LOBYTE(v4) = a1 + v4;
  v3 = ((unsigned __int8)a1 ^ (unsigned __int8)(BYTE1(a1) ^ BYTE1(v4))) == 0;
  BYTE1(v4) = a3;
  if ( v3 || !v3 )
    JUMPOUT(0x4010C1);
  __asm { fidiv   word ptr ds:13D211F0h }
  sub_401072(a3, v4);
}
// 401023: positive sp value 4 has been found
// 40106C: inconsistent fpu stack
// 401033: control flows out of bounds to 4010C1

//----- (00401072) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_401072(int a1, int a2)
{
  int v2; // edx

  v2 = a2 - a1;
  if ( (v2 + 1 < 0) ^ __OFADD__(1, v2) | (v2 == -1) || !((v2 + 1 < 0) ^ __OFADD__(1, v2) | (v2 == -1)) )
    JUMPOUT(0x4010D6);
  sub_401090();
}
// 401048: positive sp value 8 has been found
// 401048: control flows out of bounds to 4010D6

//----- (00401090) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401090()
{
  ((void (*)(void))loc_4010A6)();
  JUMPOUT(0x4010A6);
}
// 401094: positive sp value 4 has been found
// 4010A5: control flows out of bounds to 4010A6

//----- (00401E50) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401E50(void *a1@<eax>, char a2@<dh>, __int16 a3@<cx>, _BYTE *a4@<ebx>, __int16 a5@<si>)
{
  char v5; // cl
  int v6; // edx
  int v7; // esi
  int v9; // [esp+Ch] [ebp-14h]
  int v10; // [esp+10h] [ebp-10h]
  int v11; // [esp+14h] [ebp-Ch] BYREF

  *(&v10 - 9) = v9;
  BYTE1(a1) ^= (HIBYTE(a5) | a2) - (_BYTE)a4;
  LOBYTE(a1) = (unsigned __int16)((_WORD)a1 + a3) >> 8;
  sub_402C57(a1);
  *a4 = v5;
  v7 = v6;
  ((void (*)(void))loc_4024C5)();
  _EAX = &v11;
  __asm { aaa }
  v11 = v7;
  JUMPOUT(0x40291E);
}
// 402080: positive sp value 14 has been found
// 4020A1: control flows out of bounds to 4020A2
// 402CA8: control flows out of bounds to 402BCA
// 401F7D: control flows out of bounds to 402C12
// 402090: control flows out of bounds to 402996
// 4025B6: control flows out of bounds to 40291E
// 402C1D: control flows out of bounds to 4023D1
// 402C07: conditional instruction was optimized away because of 'bh.1>=0'
// 401E74: variable 'v5' is possibly undefined
// 402751: variable 'v6' is possibly undefined
// 4024DC: using guessed type _DWORD __far sub_4024DC();

//----- (00401EDA) --------------------------------------------------------
#error "402261: cannot convert to microcode (funcsize=82)"

//----- (00401FF1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_401FF1@<eax>(__int32 a1@<eax>, char a2@<bh>, int a3@<esi>, int a4, int a5)
{
  char v5; // bh
  __int32 v6; // eax
  int v7; // esi
  int v8; // eax
  _BYTE *v9; // esi
  int v10; // edx
  int v11; // edi
  __int32 v13; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v13, a1);
  v6 = v13;
  v5 = -a2;
  BYTE1(v6) = -35;
  if ( v5 >= 1 && v5 != 0 && (v5 < 1 || v5 == 0) )
  {
    if ( v5 )
    {
      __asm { iret }
      JUMPOUT(0x402012);
    }
    JUMPOUT(0x402053);
  }
  v7 = a3 - v6;
  ((void (*)(void))loc_402474)();
  __asm { icebp }
  v9 = (_BYTE *)(v8 + v7 + 1);
  v11 = -v10;
  sub_4028D5();
  *(_BYTE *)v11 = *v9;
  return sub_402545(a4, a5);
}
// 401FF8: positive sp value 4 has been found
// 402011: control flows out of bounds to 402012
// 40200E: control flows out of bounds to 402053
// 402530: variable 'v8' is possibly undefined
// 402536: variable 'v10' is possibly undefined
// 402545: using guessed type _DWORD __cdecl sub_402545(_DWORD, _DWORD);

//----- (0040202D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_40202D(int a1, int a2)
{
  int v2; // eax
  char v3; // cl
  bool v4; // cc
  unsigned __int32 v5; // eax
  int v6; // esi
  int v7; // [esp-4h] [ebp-4h]

  v3 = a2 ^ a1;
  v4 = __CFADD__((_BYTE)a2, v3) || (_BYTE)a2 + v3 == 0;
  LOBYTE(a1) = a2 + v3;
  if ( !v4 && v4 )
  {
    v5 = __indword(0xE4u);
    v2 = v5 + 120;
    if ( a1 + 1 < 0 == __OFADD__(1, a1) && a1 + 1 < 0 != __OFADD__(1, a1) )
    {
      *(_DWORD *)(v2 - 67) += a1 + ((unsigned __int8)a1 != BYTE1(a1));
      JUMPOUT(0x401FD7);
    }
    v6 = (a1 ^ a2) + 1;
    if ( !__SETP__(a1, 0) && __SETP__(a1, 0) )
    {
      __asm { icebp }
      sub_402821();
      *(_DWORD *)(v6 - 854929869) = v7;
      JUMPOUT(0x4023E7);
    }
    JUMPOUT(0x402AA8);
  }
}
// 402668: positive sp value 8 has been found
// 401FD4: control flows out of bounds to 401FD7
// 402679: control flows out of bounds to 4023E7
// 402632: control flows out of bounds to 402AA8
// 402662: variable 'v7' is possibly undefined

//----- (0040206E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40206E()
{
  void *v0; // [esp+8h] [ebp-4h]
  void *retaddr; // [esp+Ch] [ebp+0h]

  *(&retaddr - 4) = v0;
  JUMPOUT(0x402080);
}
// 402072: positive sp value 4 has been found
// 40207E: control flows out of bounds to 402080

//----- (00402116) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402116(char a1@<al>, int a2@<edx>, int a3@<ebx>)
{
  __int16 v3; // cx
  int v4; // edx
  int v5; // ecx
  char v6; // zf
  char v7; // sf
  char v8; // of
  unsigned int v9; // kr00_4
  int v10; // ecx

  LOBYTE(a3) = a3 - BYTE1(a2);
  LOBYTE(v3) = a1 - BYTE1(a2);
  HIBYTE(v3) = BYTE1(a3);
  BYTE1(a2) -= BYTE1(a3);
  ((void (__fastcall *)(__int16, int))loc_4022CD)(v3, a2);
  if ( !(v7 ^ v8 | v6) )
  {
    v9 = __readeflags();
    JUMPOUT(0x4021DC);
  }
  LOBYTE(v5) = v5 - a3;
  v10 = a3 ^ v5;
  BYTE1(v10) += BYTE1(v4);
  sub_40202D(v10, v4);
  JUMPOUT(0x40218F);
}
// 402188: positive sp value 8 has been found
// 40218A: control flows out of bounds to 40218F
// 402143: control flows out of bounds to 4021DC
// 402C86: control flows out of bounds to 401E72
// 402C8C: conditional instruction was optimized away because of 'al.1!=0'
// 40212B: variable 'v7' is possibly undefined
// 40212B: variable 'v8' is possibly undefined
// 40212B: variable 'v6' is possibly undefined
// 40217B: variable 'v5' is possibly undefined
// 402181: variable 'v4' is possibly undefined

//----- (004024DC) --------------------------------------------------------
#error "40238C: call analysis failed (funcsize=49)"

//----- (004024FB) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4024FB()
{
  JUMPOUT(0x402B93);
}
// 4024FF: positive sp value 4 has been found
// 402509: control flows out of bounds to 402B93

//----- (00402545) --------------------------------------------------------
#error "4029FA: cannot convert to microcode (funcsize=19)"

//----- (00402711) --------------------------------------------------------
#error "402723: call analysis failed (funcsize=13)"

//----- (0040272F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40272F()
{
  JUMPOUT(0x40233B);
}
// 40260A: positive sp value 4 has been found
// 40261B: control flows out of bounds to 40233B

//----- (00402821) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int sub_402821()
{
  void *v1; // [esp+8h] [ebp-4h]
  void *retaddr; // [esp+Ch] [ebp+0h]

  *(&retaddr - 4) = v1;
  ((void (*)(void))loc_402792)();
  return sub_402836();
}
// 402825: positive sp value 4 has been found
// 402836: using guessed type _DWORD sub_402836();

//----- (00402836) --------------------------------------------------------
#error "402864: cannot convert to microcode (funcsize=18)"

//----- (004028D5) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4028D5()
{
  JUMPOUT(0x402853);
}
// 4028D9: positive sp value 4 has been found
// 4028ED: control flows out of bounds to 402853
// 4028F5: conditional instruction was optimized away because of 'esi.4>=0'
// 402900: using guessed type _DWORD __cdecl sub_402900(_DWORD, char);

//----- (00402900) --------------------------------------------------------
#error "402952: cannot convert to microcode (funcsize=35)"

//----- (0040297E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40297E(int a1@<ebx>, __int32 a2@<edi>, int a3@<esi>)
{
  __int32 v3; // edi
  int v4; // esi
  int v5; // ecx
  int v6; // edx
  int v7; // ecx
  int v8; // eax
  char v9; // cf
  __int32 v10; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v10, a2);
  v3 = v10;
  v4 = a3 - v10;
  ((void (*)(void))((char *)&loc_40295D + 4))();
  v7 = v6 | v4 | v5;
  BYTE1(a1) -= BYTE1(v7);
  LOBYTE(a1) = BYTE1(a1) | a1;
  BYTE1(v7) = BYTE1(v6);
  v8 = ((int (__thiscall *)(int, _DWORD))((char *)&loc_402874 + 2))(v7, (unsigned __int16)__SS__);
  LOBYTE(v8) = v8 - (v9 + 3);
  *(_DWORD *)(v3 + a1 - 114) = v8;
  JUMPOUT(0x4029AF);
}
// 402984: positive sp value 4 has been found
// 4029AC: control flows out of bounds to 4029AF
// 40299A: variable 'v6' is possibly undefined
// 402998: variable 'v5' is possibly undefined
// 4029AA: variable 'v9' is possibly undefined

//----- (00402A4B) --------------------------------------------------------
void sub_402A4B()
{
  JUMPOUT(0x401E9B);
}
// 402AF5: control flows out of bounds to 401E9B

//----- (00402C57) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __thiscall sub_402C57(void *this)
{
  __int32 v1; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v1, (__int32)this);
  JUMPOUT(0x402664);
}
// 402C5F: positive sp value 4 has been found
// 402C6C: control flows out of bounds to 402664

// nfuncs=22 queued=21 decompiled=21 lumina nreq=0 worse=0 better=0
#error "There were 6 decompilation failure(s) on 21 function(s)"
