/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall sub_401035(int@<edx>, int@<ecx>, int@<ebx>, int@<ebp>, int@<edi>, int@<esi>, double@<st0>);
void sub_40110D();
// void __usercall sub_40113B(int@<eax>, int@<edx>, char@<cl>, int@<ebx>, int@<ebp>, int@<edi>, int@<esi>);
void sub_4011BA();
// void __usercall start(int@<eax>, int@<edx>, int@<ebx>, int@<esi>, double@<st7>, double@<st6>, double@<st5>, double@<st4>, double@<st3>, double@<st2>, double@<st1>, double@<st0>);
// void __usercall sub_4012DD(int@<edx>, int@<ecx>, int@<ebx>, int@<ebp>, int@<edi>, int@<esi>, double@<st0>);
// void __usercall sub_401357(int@<edx>, int@<esi>, int@<eax>, int@<ebx>);
// void __usercall sub_401378(char@<cf>, int _EDX@<edx>, int@<ebx>, int@<edi>, int@<esi>, int@<eax>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401172; // weak
_UNKNOWN loc_4012F5; // weak
_UNKNOWN loc_4013A3; // weak
_UNKNOWN loc_40145B; // weak


//----- (00401035) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401035(
        int a1@<edx>,
        int a2@<ecx>,
        int a3@<ebx>,
        int a4@<ebp>,
        int a5@<edi>,
        int a6@<esi>,
        double a7@<st0>)
{
  int v7; // edi
  int v8; // esi
  int v9; // ebx
  int v10; // edi
  int v11; // esi
  int v12; // eax
  int v13; // edx
  int v14; // ecx
  char v15; // of
  int v16; // ecx
  int v17; // edi
  int v18; // edx
  char v19; // bl

  v7 = a5 - 1;
  v8 = a6 + 1;
  v9 = v8 + (v7 ^ a3);
  v10 = ((a2 + 1) | v7) - (a1 - 1) + 1;
  v11 = v8 + 1;
  sub_40110D();
  if ( v15 )
  {
    v13 = v10;
    v14 = v11;
  }
  v16 = v11 + v14;
  v17 = v10 - 1;
  v18 = v17 ^ (((v9 - v12) | v13) + 1);
  v19 = v16;
  ((void (__usercall *)(int@<ecx>, int@<edx>, double@<st0>))loc_401172)(2 * v16, v18, a7);
  *(_BYTE *)((v17 ^ v11) + 4 * a4 - 398737750) ^= v19;
  JUMPOUT(0x401495);
}
// 401039: positive sp value 4 has been found
// 401494: control flows out of bounds to 401495
// 4013E9: variable 'v15' is possibly undefined
// 401475: variable 'v14' is possibly undefined
// 4013F5: variable 'v12' is possibly undefined
// 401477: variable 'v13' is possibly undefined

//----- (0040110D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40110D()
{
  JUMPOUT(0x4011F4);
}
// 40120C: positive sp value C has been found
// 40121B: control flows out of bounds to 4010F1
// 40132B: control flows out of bounds to 4011F4
// 40133D: control flows out of bounds to 40134C
// 401337: conditional instruction was optimized away because edx.4>=1

//----- (0040113B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40113B(
        int a1@<eax>,
        int a2@<edx>,
        char a3@<cl>,
        int a4@<ebx>,
        int a5@<ebp>,
        int a6@<edi>,
        int a7@<esi>)
{
  int v7; // ecx
  int v8; // ecx
  _DWORD *v10; // eax
  int v11; // edx
  int v14; // eax
  int v18; // ebx
  int v19; // edx
  void *v22; // ecx
  void *v23; // [esp+4h] [ebp-4h]
  void *retaddr; // [esp+8h] [ebp+0h]

  *(&retaddr - 3) = v23;
  --BYTE1(a4);
  sub_401378(__CFADD__(BYTE1(a1), a3), a6 - 1 + a2, a4, a6 - 1, a7, a1);
  if ( _SF )
  {
    v14 = __indword(v11);
    LOBYTE(v14) = _CF + v14 - 65;
    __asm { repne add ch, 46h ; 'F' }
    LOBYTE(a4) = -(char)a4 - BYTE1(v11);
    v18 = v14 + a4;
    v19 = v18 ^ v11;
    LOBYTE(v19) = HIBYTE(_CX) | v19;
    LOBYTE(v18) = v18 - 121;
    BYTE1(v19) = v14;
    BYTE1(v18) = (v14 | BYTE1(v18)) + 1;
    sub_40113B(v14, v19, _CX, v18 + 1, a5, 200737300, v14);
    __asm { insb }
    v23 = v22;
    JUMPOUT(0x4010D8);
  }
  __asm { into }
  ((void (__cdecl *)(_DWORD))((char *)&loc_40145B + 1))(*v10);
  v8 = v7 - 1;
  if ( !a5 || !v8 )
    JUMPOUT(0x401492);
  JUMPOUT(0x401166);
}
// 4010D9: positive sp value 4 has been found
// 401057: control flows out of bounds to 401492
// 401201: control flows out of bounds to 4010D8
// 4010EB: control flows out of bounds to 401166
// 40114F: variable '_SF' is possibly undefined
// 401151: variable 'v11' is possibly undefined
// 401152: variable '_CF' is possibly undefined
// 4011E8: variable '_CX' is possibly undefined
// 4011F0: variable 'v22' is possibly undefined
// 4010DD: variable 'v10' is possibly undefined
// 4010EB: variable 'v7' is possibly undefined

//----- (004011BA) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4011BA()
{
  JUMPOUT(0x401156);
}
// 401074: positive sp value 4 has been found
// 40107F: control flows out of bounds to 401156

//----- (00401228) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
void __usercall start(
        int a1@<eax>,
        int a2@<edx>,
        int a3@<ebx>,
        int a4@<esi>,
        double a5@<st7>,
        double a6@<st6>,
        double a7@<st5>,
        double a8@<st4>,
        double a9@<st3>,
        double a10@<st2>,
        double a11@<st1>,
        double a12@<st0>)
{
  int v12; // ebx
  int v13; // esi
  __int64 v14; // rax
  int v15; // ecx
  char v16; // t2
  int v17; // ecx
  _BYTE *v18; // edi
  _BYTE *v19; // esi
  int v22; // ecx
  int v24; // edx
  int v25; // edi
  int v26; // eax
  char v27; // cl
  int v28; // esi
  int v29; // edx
  int v30; // ecx
  int v31; // ebx
  int v32; // edx
  int v33; // edi
  int v34; // esi
  int v35; // edx
  int v36; // ebx
  int v37; // edi
  bool v38; // cc
  int v39; // edx
  int v40; // [esp-8h] [ebp-8h] BYREF
  int v41; // [esp-4h] [ebp-4h]
  unsigned int savedregs; // [esp+0h] [ebp+0h]

  v34 = a4 - a1;
  v35 = a2 - 1;
  v36 = a3 - v35;
  v37 = v36 + v35;
  v38 = v35 < v36;
  v39 = v35 - v36;
  if ( v38 || !v38 )
  {
    sub_4011BA();
    v25 = v40;
    LOBYTE(v26) = __inbyte(v24);
    MEMORY[0xB4BBD359] = v26;
    sub_40113B(v26, v24, v27, v36 - 2, (int)&v40, v25, v34 - 1);
  }
  else
  {
    v28 = (v37 + 1) ^ v39;
    v29 = v39 | (v40 + 1);
    v30 = v28 | (v29 + 1);
    v31 = v37 + 2;
    v32 = v37 + v29;
    v33 = v28 + v37 + 1;
    v12 = v31 - v41;
    v13 = (v32 - 1) | v41 | v28;
    ++v33;
    v14 = ((__int64 (__usercall *)@<edx:eax>(int@<ecx>, double@<st0>, double@<st1>, double@<st2>, double@<st3>, double@<st4>, double@<st5>, double@<st6>, double@<st7>))((char *)&loc_4013A3 + 1))(
            v30 - v33,
            a12,
            a11,
            a10,
            a9,
            a8,
            a7,
            a6,
            a12 / a5);
    v16 = BYTE4(v14);
    BYTE4(v14) = *(_BYTE *)(v12 - 115);
    *(_BYTE *)(v12 - 115) = v16;
    LOBYTE(v14) = (BYTE1(v15) + v14) & 4;
    v17 = v33 | v14 | v15;
    v18 = (_BYTE *)(v33 - v14);
    v19 = (_BYTE *)(HIDWORD(v14) + v13);
    sub_4012DD(SHIDWORD(v14), v17 - (_DWORD)v18, v12, (int)&v40, (int)v18, (int)v19, a12);
    *v18++ = *v19++;
    __asm { insb }
    __writeeflags(savedregs);
    __asm { insd }
    sub_401035(_EDX, v22, v12, (int)&v40, (int)v18, (int)v19, a12);
  }
}
// 401034: positive sp value 8 has been found
// 401289: control flows out of bounds to 401290
// 401276: control flows out of bounds to 4013ED
// 401261: conditional instruction was optimized away because edx.4!=0
// 4011B0: conditional instruction was optimized away because edi.4!=0
// 40102C: bad sp value at call
// 401034: bad sp value at call
// 401137: bad sp value at call
// 401019: variable 'v15' is possibly undefined
// 401034: variable '_EDX' is possibly undefined
// 401034: variable 'v22' is possibly undefined
// 401135: variable 'v24' is possibly undefined
// 401137: variable 'v26' is possibly undefined
// 401137: variable 'v27' is possibly undefined

//----- (004012DD) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4012DD(
        int a1@<edx>,
        int a2@<ecx>,
        int a3@<ebx>,
        int a4@<ebp>,
        int a5@<edi>,
        int a6@<esi>,
        double a7@<st0>)
{
  int v7; // ebx
  char v8; // cf
  int v9; // [esp+8h] [ebp-8h]
  int v10; // [esp+Ch] [ebp-4h]

  *(&v10 - 5) = v9;
  v7 = a3 - 1;
  sub_401035(v10 ^ (a6 + 1), v10 ^ (a2 - (v10 ^ (a6 + 1))), v7, a4, a5 - a1, a2 - (v10 ^ (a6 + 1)), a7);
  *(_DWORD *)(v7 - 651040891) -= v8 - 119;
  JUMPOUT(0x4012FC);
}
// 4012E2: positive sp value 8 has been found
// 4012F5: control flows out of bounds to 4012FC
// 4012F5: variable 'v8' is possibly undefined

//----- (00401357) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401357(int a1@<edx>, int a2@<esi>, int a3@<eax>, int a4@<ebx>)
{
  int v4; // esi
  int v6; // ebx
  char v7; // cf
  int v8; // eax
  int v9; // edx
  int v10; // esi
  int v11; // et0
  char v12; // cc
  int v13; // eax

  v4 = a1 ^ (a2 - 1);
  v6 = v4 + a4;
  v11 = ((int (__cdecl *)(struct _TEB *))((char *)&loc_4012F5 + 6))(NtCurrentTeb());
  v8 = v4;
  v10 = v11;
  v12 = v7 | (v8 == 1);
  v13 = v8 - 1;
  if ( !v12 )
    JUMPOUT(0x4012FB);
  BYTE1(v13) = *(_BYTE *)(a3 - 7);
  sub_401378(v7, v9, v6, a3, v10, v13);
}
// 40135B: positive sp value 4 has been found
// 401376: control flows out of bounds to 4012FB
// 401372: variable 'v7' is possibly undefined
// 401377: variable 'v9' is possibly undefined

//----- (00401378) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401378(char a1@<cf>, int _EDX@<edx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>, int a6@<eax>)
{
  int v6; // ebx
  int v7; // ebx
  int v9; // edi

  BYTE1(a3) = (BYTE1(a3) < (unsigned __int8)(a1 + 124)) + BYTE1(a3) - (a1 + 124) - 12;
  v9 = a4 + 1;
  LOBYTE(a3) = BYTE1(_EDX);
  HIWORD(_EDX) = HIWORD(v9);
  BYTE1(_EDX) = BYTE1(v9) + 1;
  LOBYTE(_EDX) = v9 + 1;
  v7 = a3 - 1;
  if ( !__SETP__(a5 ^ v9, 0) )
  {
    __asm { rep mov dl, dl }
    if ( __SETP__(a5 ^ v9, 0) )
    {
      __asm { insb }
      JUMPOUT(0x4010A0);
    }
  }
  v6 = v7 + 1;
  sub_401357(_EDX - 1, (2 * v6) | a5, a6, v6);
  if ( __SETP__(v6 + a1 + v6, 0) )
    JUMPOUT(0x401074);
  JUMPOUT(0x4010BB);
}
// 40105C: positive sp value 4 has been found
// 4013A3: control flows out of bounds to 4013A5
// 401072: control flows out of bounds to 401074
// 40109E: control flows out of bounds to 4010A0
// 40139F: control flows out of bounds to 4013E2
// 4013A3: control flows out of bounds to 401334
// 401072: control flows out of bounds to 4010BB
// 401395: conditional instruction was optimized away because di^1.1!=FF
// 401070: variable 'a1' is possibly undefined

// nfuncs=8 queued=8 decompiled=8 lumina nreq=0 worse=0 better=0
// ALL OK, 8 function(s) have been successfully decompiled
