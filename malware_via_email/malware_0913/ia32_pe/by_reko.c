// subject_rsec.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw40A078 = 0xA0AD; // 0040A078
word32 g_dw40A07C = 41151; // 0040A07C
word32 g_dw40A080 = 41166; // 0040A080
word32 g_dw40A084 = 0xA0E1; // 0040A084
word32 g_dw40A088 = 0xA0F3; // 0040A088
word32 g_dw40A08C = 41222; // 0040A08C
word32 g_dw40A094 = 0xA120; // 0040A094
word32 g_dw40A098 = 0xA12C; // 0040A098
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401005: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	word32 ebp;
	word32 dwLoc2C;
	word32 ebp_108;
	fn004010CE(ebp, (word16) dwLoc2C, out ebp_108);
	word32 ebp_121;
	return fn004010CE(ebp_108, 0x00, out ebp_121);
}

// 004010CE: Register word32 fn004010CE(Register word32 ebp, Stack word16 wArg00, Register out ptr32 ebpOut)
// Called from:
//      Win32CrtStartup
word32 fn004010CE(word32 ebp, word16 wArg00, ptr32 & ebpOut)
{
	ptr32 fp;
	struct Eq_21 * fs;
	word32 dwArg00;
	word32 dwLoc30;
	ptr32 dwLoc0130;
	word16 eax_16_16_25 = SLICE(dwArg00, word16, 16);
	word32 eax_38 = SEQ(eax_16_16_25, 0x00);
	struct Eq_30 * ebx_115;
	word32 ecx_116;
	word32 eax_114 = fn00401695((word16) dwLoc30, out ecx_116, out ebx_115);
	word16 ecx_16_16_135 = SLICE(ecx_116, word16, 16);
	word32 eax_137;
	word32 ecx_139;
	ebx_115->ptr0018();
	struct Eq_49 * esp_144;
	<unknown> Eq_21::* eax_145;
	word32 ecx_147;
	ebx_115->ptr001C();
	word16 ecx_16_16_168 = SLICE(ecx_147, word16, 16);
	uint32 esi_158 = (uint32) ((&(fs->*((char *) eax_145 + 4)))[(char *) eax_145 + 6].w0000 + 0x02);
	esp_144->ptrFFFFFFFC = (<unknown> Eq_21::*) ((char *) eax_145 + 6);
	esp_144->ptrFFFFFFF8 = (<unknown> Eq_21::*) ((char *) eax_145 + 6);
	struct Eq_77 * esp_169;
	struct Eq_30 * eax_170;
	word32 ecx_172;
	ebx_115->ptr0000();
	esp_169->ptr0038 = ebx_115;
	esp_169->dw003C = esi_158 - 0x01;
	esp_169->ptrFFFFFFFC = ebx_115;
	esp_169->ptrFFFFFFFC -= 0x04;
	word16 ecx_16_16_218 = SLICE(ecx_172, word16, 16);
	struct Eq_30 * edi_189 = esp_169->ptrFFFFFFFC;
	esp_169->ptrFFFFFFFC = eax_170;
	esp_169->dwFFFFFFF8 = ecx_172;
	esp_169->ptrFFFFFFF4 = esp_169 - 8;
	esp_169->dwFFFFFFF0 = 0x40;
	esp_169->dwFFFFFFEC = esp_169->dw0020;
	esp_169->dwFFFFFFE8 = esp_169->dw0014;
	esp_169->dw0018 = 0x00;
	esp_169->dwFFFFFFE4 = ~0x00;
	struct Eq_143 * esp_219;
	struct Eq_144 Eq_21::* eax_220;
	edi_189->ptr0010();
	struct Eq_148 * eax_226 = eax_220 + (fs->*eax_220).dw002F / 0x0033;
	esp_219->dw0030 += eax_226->dw0003;
	esp_219->ptrFFFFFFFC = eax_226;
	esp_219->ptr0000 = esp_219->ptrFFFFFFFC;
	esp_219->ptr0004 = esp_219->ptr0000;
	struct Eq_148 * edi_252 = esp_219->ptr0008;
	esp_219->ptr0008 = esp_219->ptr0004;
	struct Eq_148 * eax_257 = esp_219->ptr0008;
	esp_219->ptr0010 = (struct Eq_148 *) &eax_257->dw0003;
	struct Eq_148 * eax_268 = esp_219->ptr0010;
	word32 ecx_270 = eax_268->dw0000;
	esp_219->ptr0010 = eax_268;
	esp_219->dw003C = esp_219->dw003C ^ ecx_270;
	struct Eq_148 * eax_281 = esp_219->ptr001C;
	word32 ecx_282 = esp_219->dw002C;
	esp_219->ptr0010 = eax_281;
	esp_219->ptrFFFFFF08 = esp_219->ptr0010;
	esp_219->ptrFFFFFF0C = esp_219->ptrFFFFFF08;
	word16 ecx_16_16_357 = SLICE(ecx_282, word16, 16);
	esp_219->dwFFFFFF10 = ecx_282;
	esp_219->ptrFFFFFF08 = edi_252;
	struct Eq_148 * eax_299 = null;
	do
	{
		esp_219->ptrFFFFFF04 = eax_299;
		struct Eq_148 * eax_309 = esp_219->ptrFFFFFF04;
		eax_299[(esp_219 - 0xEC) / 7] = (struct Eq_148) (byte) eax_309;
		esp_219->ptrFFFFFF04 = eax_309;
		esp_219->ptrFFFFFF04 = (struct Eq_148 *) ((char *) &esp_219->ptrFFFFFF04->dw0000 + 1);
		struct Eq_148 * eax_323 = esp_219->ptrFFFFFF04;
		esp_219->ptrFFFFFF04 = eax_323;
		eax_299 = esp_219->ptrFFFFFF04;
	} while (eax_323 < (struct Eq_148 *) 0x0100);
	esp_219->ptrFFFFFF04 = eax_299;
	esp_219->ptrFFFFFF08 = esp_219->ptrFFFFFF04;
	esp_219->ptrFFFFFF08 = (struct Eq_148 *) (&esp_219->dw003C + 2);
	struct Eq_148 * eax_348 = esp_219->ptrFFFFFF08;
	if (eax_348->dw0000 != 121)
	{
		struct Eq_303 * edi_352 = eax_348->ptrFFFFFFFC;
		do
		{
			word32 eax_364;
			edi_352->ptr0018();
			esp_375->dwFFFFFFFC = fn00000000(eax_364);
			struct Eq_318 * esp_387;
			word32 eax_388;
			word32 ecx_390;
			edi_352->ptr0018();
			esp_387->dwFFFFFFFC = eax_388;
			struct Eq_327 * esp_399;
			word32 eax_400;
			word32 ecx_402;
			edi_352->ptr0018();
			esp_399->dwFFFFFFFC = eax_400;
			struct Eq_336 * esp_411;
			word32 eax_412;
			word32 ecx_414;
			edi_352->ptr0018();
			esp_411->dwFFFFFFFC = eax_412;
			word32 eax_424;
			word32 ecx_426;
			edi_352->ptr0018();
			word16 ecx_16_16_429 = SLICE(ecx_426, word16, 16);
			edi_352->ptr0018();
			esp_437->ptrFFFFFFFC = fn00000000();
			word16 cx_457 = (word16) ecx_440;
			ecx_16_16_357 = SLICE(ecx_440, word16, 16);
			struct Eq_148 * eax_446 = esp_437->ptrFFFFFFFC;
			esp_437->ptrFFFFFFFC = (struct Eq_148 *) ((char *) &eax_446->dw0000 + 1);
			struct Eq_148 * eax_454 = esp_437->ptrFFFFFFFC;
			cup16 ax_458 = (word16) eax_454 - cx_457;
			esp_437->ptrFFFFFFFC = SEQ(SLICE(eax_454, word16, 16), ax_458);
			eax_348 = esp_437->ptrFFFFFFFC;
		} while (ax_458 < 0x00);
		esp_437->ptrFFFFFFFC = eax_348;
	}
	int32 esi_508 = 0x00;
	Eq_372 eax_512 = 0x00;
	int32 ebp_514 = 0x00;
	do
	{
		word32 ebx_525 = (word32) *((word32) (fp - 300) + ebp_514);
		byte bl_620 = (byte) ebx_525;
		word32 edx_538 = (word32) *((word32) eax_512.u0 + dwLoc0130);
		word32 ecx_546 = ebx_525 + esi_508;
		word32 edx_548 = edx_538 + ecx_546;
		byte dl_560 = (byte) edx_548;
		word16 edx_16_16_561 = SLICE(edx_548, word16, 16);
		int32 edx_562 = SEQ(edx_16_16_561, 0x00, dl_560);
		Eq_372 dwLoc0148_939 = (word32) eax_512.u0 + 1;
		esi_508 = edx_562;
		Eq_372 eax_574 = dwLoc0148_939;
		if (dwLoc0148_939 >= fp - 40)
			eax_574.u0 = 0x00;
		(fp - 300)[ebp_514] = (byte) *((word32) (fp - 300) + edx_562);
		++ebp_514;
		ptr32 edx_610 = fp - 300 + edx_562;
		ptr32 edx_611 = edx_610 - eax_574;
		*((word32) eax_574.u0 + edx_611) = SEQ(*((word32) ((word32) eax_574.u0 + 1) + edx_611), bl_620);
		eax_512 = eax_574;
	} while (SLICE(ebp_514, byte, 8) != 0x01);
	ebpOut = ebp + 0x01;
	return eax_114;
}

// 00401695: Register ptr32 fn00401695(Stack word16 wArg00, Register out Eq_36 ecxOut, Register out ptr32 ebxOut)
// Called from:
//      fn004010CE
ptr32 fn00401695(word16 wArg00, union Eq_36 & ecxOut, ptr32 & ebxOut)
{
	word32 dwArg00;
	word32 eax_164 = dwArg00;
	while (true)
	{
		word16 eax_16_16_38 = SLICE(eax_164, word16, 16);
		word16 ax_58 = *SEQ(eax_16_16_38, 0x00);
		word32 eax_64 = SEQ(eax_16_16_38, ax_58 + 42421);
		if (ax_58 == 23117)
			break;
		eax_164 = eax_64 - 0x00010000;
	}
	struct Eq_471 * eax_70;
	__btc<word32>(eax_64, 0x01, out eax_70);
	int32 ecx_91 = eax_70->dw003C;
	Eq_36 ecx_117 = eax_70[(&(eax_70 + ecx_91 / 64)->dw003C)[0x0011] / 64];
	ecxOut = ecx_117;
	word32 eax_123 = eax_70 + ecx_117;
	ebxOut = eax_123 + 0x04;
	return eax_123 + 0x04;
}

