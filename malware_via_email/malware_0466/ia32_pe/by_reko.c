// subject_UPX0_0000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 1310D000: void fn1310D000(Stack (ptr32 byte) dwArg04, Stack ptr32 dwArg08, Stack word32 dwArg0C, Stack Eq_5 dwArg10, Stack Eq_5 dwArg14, Stack Eq_5 dwArg18)
// Called from:
//      fn1310D0E5
void fn1310D000(byte * dwArg04, ptr32 dwArg08, word32 dwArg0C, Eq_5 dwArg10, Eq_5 dwArg14, Eq_5 dwArg18)
{
	*dwArg10.u0 = dwArg0C;
	CreateSemaphoreA(null, 0x00, 0x00, 0x00);
	uint32 edx_24 = (uint32) ((uint64) dwArg14 % 0x05);
	word16 wLoc1C_140 = (word16) edx_24;
	byte bLoc1A_144 = SLICE(edx_24, byte, 16);
	byte * dwArg08_135 = dwArg14.u0 + ((word32) (GetLastError() - 0x57) + dwArg08);
	do
	{
		--dwArg0C;
		if (dwArg0C == 0x00)
			return;
		ui32 edx_84 = SEQ(bLoc1A_144, wLoc1C_140, *dwArg08_202) ^ (dwArg18.u0)[(uint32) wLoc1C_140] & 0xFF;
		*dwArg04 = (byte) edx_84;
		word32 eax_89 = (word32) SLICE(edx_84, word16, 8);
		wLoc1C_140 = (word16) eax_89 + 0x01;
		bLoc1A_144 = SLICE(eax_89 + 0x01, byte, 16);
		if ((int32) wLoc1C_140 == 0x05)
			wLoc1C_140 = 0x00;
		if (dwArg04 == (byte *) 0x07FF)
			return;
		++dwArg04;
		dwArg08_135 = dwArg08_202 + 1;
		dwArg08_202 = dwArg08_135;
	} while (dwArg08_202 != (byte *) 0x00F7FFFF);
}

// 1310D0E5: void fn1310D0E5()
void fn1310D0E5()
{
	ptr32 fp;
	Eq_81 tLoc02C4;
	Eq_82 tLoc10;
	Eq_21 tLoc02D8;
	ui32 dwLoc0264;
	ui32 dwLoc0248;
	ui32 dwLoc08;
	ui32 dwLoc14;
	word32 * dwLoc24;
	Eq_5 dwLoc024C;
	word32 dwLoc20;
	Eq_91 dwLoc0260;
	Eq_92 dwLoc18;
	byte * dwLoc0C;
	tLoc02C4.LowPart = (DWORD) 0x6B800000;
	LookupPrivilegeValueW(null, null, &tLoc02C4);
	ptr32 esp_19 = fp - 0x02D8;
	if (tLoc02C4.LowPart == 0x00)
	{
		tLoc02C4.LowPart = (DWORD) 0xFFF5;
		BOOL eax_39 = WriteProfileSectionW(null, null);
		tLoc02C4.LowPart = (word32) eax_39 + tLoc02C4.LowPart;
		struct Eq_139 * v17_47 = (word32) eax_39 + 0x0000FFF5 ^ ((eax_39 ^ 0x13101FF6) ^ 0x01);
		word32 esi_51 = v17_47->dw0000;
		fn1310D000(fp - 0x023C, fp - 0x023C, 0x04, &tLoc10, 0x00, fp - 0x0234);
		word32 v21_109 = (char *) WaitForSingleObject(null, (void *) 0x04000000) + 1 + v17_47->dw0004;
		fn1310D000(fp - 600, fp - 0x025C, 0x04, &tLoc10, 0x04, fp - 0x0234);
		ui32 edi_132 = v17_47->dw0008;
		fn1310D000(fp - 20, fp - 0x1C, 0x04, &tLoc10, 0x08, fp - 0x0234);
		word32 esi_174 = v17_47->dw000C;
		fn1310D000(fp - 28, fp - 0x28, 0x04, &tLoc10, 0x0C, fp - 0x0234);
		CreateFileW(null, null, null, null, null, null, tLoc02D8);
		dwLoc0248 = v17_47->dw0010;
		fn1310D000(fp - 0x0248, fp - 600, 0x04, &tLoc10, 0x10, fp - 0x0234);
		WritePrivateProfileStringA(0x00, 0xB8000000, 0x00, 0x00);
		ui32 ebx_271 = edi_132 * 0x08 + 0x0C;
		dwLoc14 = edi_132;
		dwLoc20 = 0x13100000;
		dwLoc024C.u0 = 0x14;
		dwLoc24 = (word32 *) (&v17_47->dw0010 + 1);
		esp_19 = fp - 0x02D4;
		dwLoc0260 = VirtualAlloc(tLoc02C4.LowPart - 0xFFF6, ebx_271 + v21_109 + esi_51, (void *) 0x3000, (void *) 0x40);
		dwLoc0C = esi_174 + 0x13100000 + ebx_271;
		dwLoc0264 = ebx_271;
		dwLoc08 = 0x00;
		dwLoc18.u0 = 0x00;
	}
	while (true)
	{
		struct Eq_292 * esp_323 = esp_19 - 4;
		esp_323->t0000.u0 = 0x00;
		esp_323->tFFFFFFFC.u0 = 0x00;
		esp_323->tFFFFFFF8.u0 = 0x00;
		WritePrivateProfileSectionA(esp_323->tFFFFFFF8, esp_323->tFFFFFFFC, esp_323->t0000);
		if (dwLoc0264 == dwLoc0248)
		{
			++dwLoc08;
			if (dwLoc08 == dwLoc14)
				;
			word32 ecx_342 = *dwLoc24;
			esp_323->t0000.u0 = (word32 *) (fp - 0x0234);
			esp_323->tFFFFFFFC.u0 = (word32 *) dwLoc024C;
			esp_323->tFFFFFFF8.u0 = (word32 *) &tLoc10;
			esp_323->dwFFFFFFF4 = 0x04;
			esp_323->ptrFFFFFFF0 = fp - 28 - dwLoc024C;
			esp_323->ptrFFFFFFEC = fp - 28;
			fn1310D000(esp_323->ptrFFFFFFEC, esp_323->ptrFFFFFFF0, esp_323->dwFFFFFFF4, esp_323->tFFFFFFF8.u0, esp_323->tFFFFFFFC.u0, esp_323->t0000.u0);
			ui32 * dwLoc24_623 = dwLoc24 + 1;
			dwLoc0248 = *dwLoc24_623;
			esp_323->t0000.u0 = (word32 *) (fp - 0x0234);
			Eq_5 dwLoc024C_622 = dwLoc024C.u0 + 1;
			esp_323->tFFFFFFFC.u0 = (word32 *) dwLoc024C_622;
			esp_323->tFFFFFFF8.u0 = (word32 *) &tLoc10;
			esp_323->dwFFFFFFF4 = 0x04;
			esp_323->ptrFFFFFFF0 = fp - 0x0248 - dwLoc024C_622;
			esp_323->ptrFFFFFFEC = fp - 0x0248;
			fn1310D000(esp_323->ptrFFFFFFEC, esp_323->ptrFFFFFFF0, esp_323->dwFFFFFFF4, esp_323->tFFFFFFF8.u0, esp_323->tFFFFFFFC.u0, esp_323->t0000.u0);
			dwLoc024C.u0 = (word32) dwLoc024C_622 + 4;
			dwLoc24 = dwLoc24_623 + 1;
			dwLoc0264 = 0x00;
			dwLoc0C = ecx_342 + dwLoc20;
		}
		Mem434[dwLoc0260 + dwLoc18:byte] = Mem429[dwLoc0C + 0x00:byte];
		++dwLoc0C;
		++dwLoc18;
		++dwLoc0264;
	}
}

