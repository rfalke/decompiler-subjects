/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

// void __usercall start(int a1@<ecx>, int a2@<ebx>, int a3@<edi>);
void sub_401040();
// void __usercall sub_40114C(__int32 a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<esi>);
void __thiscall sub_401166(void *this);
// char __usercall sub_401217@<al>(int a1@<eax>);
void sub_4012C2();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401073; // weak
_UNKNOWN loc_401362; // weak


//----- (00401024) --------------------------------------------------------
void __usercall start(int a1@<ecx>, int a2@<ebx>, int a3@<edi>)
{
  int v4; // ecx

  _EAX = ((int (__fastcall *)(int, int))loc_401073)(a1, a2 - (a3 - 1) + a1);
  if ( v4 != 1 )
    JUMPOUT(0x400FCE);
  __asm { aas }
  sub_401040();
}
// 40103C: control flows out of bounds to 400FCE
// 40103C: variable 'v4' is possibly undefined

//----- (00401040) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401040()
{
  __asm { rep pop ecx }
  JUMPOUT(0x401325);
}
// 401045: positive sp value 4 has been found
// 40104F: control flows out of bounds to 401325

//----- (0040114C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40114C(__int32 a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<esi>)
{
  void *v4; // ecx
  __int16 v5; // [esp-4h] [ebp-6h]
  __int32 v6; // [esp-2h] [ebp-4h] BYREF

  _InterlockedExchange(&v6, a1);
  LOWORD(a4) = v5;
  ((int (__fastcall *)(int, int))loc_401362)(a3 - 1, a4 + a2);
  sub_401166(v4);
}
// 401156: positive sp value 4 has been found
// 401151: variable 'v5' is possibly undefined
// 401164: variable 'v4' is possibly undefined

//----- (00401166) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __thiscall sub_401166(void *this)
{
  __int32 v2; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v2, (__int32)this);
  __asm { rep pop ecx }
  JUMPOUT(0x4011D0);
}
// 40112C: positive sp value 4 has been found
// 401144: control flows out of bounds to 401146
// 401136: control flows out of bounds to 4011D0
// 40113E: conditional instruction was optimized away because of 'edi.4!=0'

//----- (00401217) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
char __usercall sub_401217@<al>(int a1@<eax>)
{
  if ( !a1 )
    JUMPOUT(0x401097);
  return a1;
}
// 401191: positive sp value 8 has been found
// 401128: control flows out of bounds to 40112A
// 40122C: control flows out of bounds to 40122E
// 4011A1: control flows out of bounds to 401097
// 40135A: control flows out of bounds to 4012F4
// 40122A: conditional instruction was optimized away because of 'esi.4!=0'

//----- (004012C2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4012C2()
{
  JUMPOUT(0x401383);
}
// 4012C6: positive sp value 4 has been found
// 4012D3: control flows out of bounds to 401383

// nfuncs=6 queued=6 decompiled=6 lumina nreq=0 worse=0 better=0
// ALL OK, 6 function(s) have been successfully decompiled
