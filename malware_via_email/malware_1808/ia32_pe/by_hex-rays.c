/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// BOOL __usercall start@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>);
// void __usercall sub_402F14(char a1@<al>, int a2@<edx>, int a3@<ecx>, int a4@<esi>, int a5@<ebp>);
// void __usercall sub_40314F(__int32 a1@<esi>);
// void __usercall sub_40325F(int a1@<eax>, int a2@<edx>, int a3@<ebx>);
// void __usercall sub_40335F(__int32 a1@<eax>, _BYTE *a2@<ebx>);
void sub_40365F();
// void __usercall sub_4036F8(char a1@<al>, int a2@<edx>, int a3@<ecx>, int a4@<edi>, int a5@<esi>, int a6@<ebp>);
void sub_403788();
// void __usercall sub_403847(char a1@<al>, _BYTE *a2@<ebx>);
// void __usercall sub_40394E(unsigned int a1@<eax>, int a2@<edx>, unsigned int a3@<ecx>, int a4@<ebx>, __int32 a5@<edi>, int a6@<esi>);
// void __usercall sub_403ABD(char a1@<cf>, unsigned int a2@<eax>, _BYTE *a3@<edx>, __int32 a4@<ecx>, int a5@<ebx>);
// char __usercall sub_403B42@<al>(char a1@<pf>, _BYTE *a2@<eax>, unsigned int a3@<edx>, int a4@<ecx>, unsigned int a5@<ebx>, int a6@<esi>);
void sub_403D61();
// void __usercall sub_403E83(_BYTE *a1@<eax>, int a2@<edx>, int a3@<ecx>, __int32 a4@<ebx>, int a5@<ebp>, int a6@<edi>, int a7@<esi>);
// void __usercall sub_403FCA(__int32 a1@<edi>, __int32 a2@<esi>);
// void __usercall sub_404002(__int32 a1@<edi>);
// void __usercall sub_4040E7(__int32 a1@<eax>, _BYTE *a2@<edx>, char a3@<cl>);
// int __usercall sub_40416C@<eax>(int a1@<edx>, int a2@<ecx>, _BYTE *a3@<edi>);
double sub_4041B9(); // weak
// void __usercall sub_4043FD(int a1@<eax>, _BYTE *a2@<edx>, __int32 a3@<ecx>, int a4@<edi>);
// HWND __stdcall GetDlgItem(HWND hDlg, int nIDDlgItem);
// int __stdcall ReleaseDC(HWND hWnd, HDC hDC);
// HICON __stdcall LoadIconW(HINSTANCE hInstance, LPCWSTR lpIconName);
// BOOL __stdcall DestroyWindow(HWND hWnd);
// LRESULT __stdcall DefWindowProcW(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// BOOL __stdcall PostMessageW(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// int __stdcall LoadStringW(HINSTANCE hInstance, UINT uID, LPWSTR lpBuffer, int cchBufferMax);
// BOOL __stdcall UpdateLayeredWindow(HWND hWnd, HDC hdcDst, POINT *pptDst, SIZE *psize, HDC hdcSrc, POINT *pptSrc, COLORREF crKey, BLENDFUNCTION *pblend, DWORD dwFlags);
// BOOL __stdcall ShowWindow(HWND hWnd, int nCmdShow);
// HWND __stdcall CreateWindowExW(DWORD dwExStyle, LPCWSTR lpClassName, LPCWSTR lpWindowName, DWORD dwStyle, int X, int Y, int nWidth, int nHeight, HWND hWndParent, HMENU hMenu, HINSTANCE hInstance, LPVOID lpParam);
// HDC __stdcall GetDC(HWND hWnd);
// BOOL __stdcall GetMessageW(LPMSG lpMsg, HWND hWnd, UINT wMsgFilterMin, UINT wMsgFilterMax);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// DWORD __stdcall GetCurrentProcessId();
// int __stdcall lstrcmpiW(LPCWSTR lpString1, LPCWSTR lpString2);
// HANDLE __stdcall GetProcessHeap();
// DWORD __stdcall GetCurrentThreadId();
// HLOCAL __stdcall LocalFree(HLOCAL hMem);
// HANDLE __stdcall GetCurrentProcess();
// LPVOID __stdcall VirtualAlloc(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// HMODULE __stdcall GetModuleHandleW(LPCWSTR lpModuleName);
// BOOL __stdcall QueryPerformanceCounter(LARGE_INTEGER *lpPerformanceCount);
// LPTOP_LEVEL_EXCEPTION_FILTER __stdcall SetUnhandledExceptionFilter(LPTOP_LEVEL_EXCEPTION_FILTER lpTopLevelExceptionFilter);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_4034DC; // weak
_UNKNOWN loc_403596; // weak
_UNKNOWN loc_403AFD; // weak
_UNKNOWN loc_403EC3; // weak
_UNKNOWN loc_40407E; // weak
_UNKNOWN loc_4040B1; // weak
_UNKNOWN loc_4042F7; // weak
_UNKNOWN loc_40458F; // weak


//----- (004015C4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
BOOL __usercall start@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  int v6; // ebx
  LPCSTR v7; // edi
  char v8; // ch
  BOOL result; // eax
  HWND v10; // esi
  int v11; // edi
  int v12; // edx
  DWORD v13; // edx
  int v14; // ecx
  int v15; // eax
  int v16; // esi
  int v17; // ebx
  BOOL v18; // eax
  char v19; // ch
  BOOL v20; // edi
  const CHAR *v21; // ebx
  int v22; // esi
  int v23; // ecx
  int v24; // eax
  char v25; // dh
  char v26; // ch
  HDC v27; // eax
  char v28; // cf
  int v29; // edx
  int v30; // esi
  int v31; // edx
  int v32; // ebx
  HICON v33; // eax
  char v34; // dl
  int v35; // esi
  int v36; // edx
  char v37; // dh
  int v38; // esi
  int v39; // edi
  int v40; // eax
  int v41; // edx
  int v42; // edx
  char v43; // cl
  char v44; // ch
  char v45; // dh
  int v46; // edx
  int v47; // esi
  int v48; // ecx
  unsigned __int64 v49; // kr08_8
  int v50; // ebx
  int v51; // edx
  int v52; // edi
  int v53; // ebx
  char v54; // cl
  char v55; // ch
  int v56; // edx
  int v57; // esi
  int v58; // ebx
  int v59; // eax
  int v60; // ecx
  int v61; // ecx
  HMENU v62; // esi
  __int16 v63; // ax
  int v64; // ecx
  HWND v65; // ebx
  int v66; // esi
  char v67; // ch
  HLOCAL v68; // eax
  char v69; // dl
  int v70; // edx
  int v71; // ecx
  int v72; // esi
  int v73; // edi
  int v74; // eax
  double v75; // st7
  unsigned __int8 v79; // al
  HDC v81[3]; // [esp-6Ch] [ebp-70h] BYREF
  HDC v82; // [esp-60h] [ebp-64h]
  BLENDFUNCTION *v83[7]; // [esp-54h] [ebp-58h] BYREF
  int v84; // [esp-38h] [ebp-3Ch]
  int v85; // [esp-28h] [ebp-2Ch]
  int v86; // [esp-20h] [ebp-24h]
  int v87; // [esp-1Ch] [ebp-20h]
  int v88; // [esp-18h] [ebp-1Ch]
  int v89; // [esp-14h] [ebp-18h]
  const CHAR *v90; // [esp-Ch] [ebp-10h]
  LPCSTR v91; // [esp-4h] [ebp-8h]

  v70 = a5 & a2;
  v71 = ((a6 - a4) ^ a3) - 1;
  v90 = (const CHAR *)(a6 - a4);
  v72 = v71 + (a5 | (a6 - a4));
  v73 = v70 & a5;
  LOBYTE(v89) = a4;
  v74 = v70 & ((v73 | (a4 + a1 + 1)) - a4);
  v48 = v71 - v72 + 1;
  v87 = v74;
  v86 = v70 + v73 - ((__PAIR64__(v48, v48) + (unsigned int)(v72 - v48)) >> 32);
  v49 = __PAIR64__(v74, v70) + (unsigned int)v72;
  v50 = v86 - HIDWORD(v49) + (v70 ^ v48);
  v85 = v48 - v70;
  v51 = v70 - v74;
  v15 = v50 + v74;
  v16 = v50 & (v86 - HIDWORD(v49));
  v84 = v50 | v51;
  v17 = (v16 & v50) - (v85 - v49 - v49 - (v86 - HIDWORD(v49)));
  v38 = v17 ^ (v17 + ((v84 - 1) | v16) - 1);
  v39 = v17 | v38 & (v15 - v17);
  v40 = ReleaseDC((HWND)0x8FADD030, (HDC)0xEB7B1C49);
  v42 = v17 ^ v41;
  BYTE1(v64) = (v44 | 0xC5) - 44;
  LOBYTE(v64) = BYTE1(v40) ^ (v40 + v43);
  v65 = (HWND)(v38 ^ ((v38 | v17) - 1));
  v66 = (v39 + 1 + ((v42 | v64) & v40 & v42)) & v38;
  SetUnhandledExceptionFilter((LPTOP_LEVEL_EXCEPTION_FILTER)0xF383186E);
  BYTE1(v65) += v67;
  LoadIconW(0, (LPCWSTR)0x73C);
  v68 = LocalFree((HLOCAL)0x9D0FBD1F);
  BYTE1(v65) &= BYTE1(v68) + v69;
  lstrcmpiW(0, 0);
  LoadIconW(0, (LPCWSTR)0x69D);
  LoadStringW((HINSTANCE)0xC8, v66, 0, 53982);
  v18 = DestroyWindow((HWND)0xA180909B);
  LOBYTE(v65) = v19;
  v20 = v18;
  GetDC((HWND)0xB6445475);
  v27 = GetDC((HWND)0xBAAE6069);
  LOBYTE(v65) = (_BYTE)v65 + 1;
  BYTE1(v65) -= v28 + BYTE1(v27);
  GetProcessHeap();
  ShowWindow(0, v66);
  v30 = v66 - (v28 + v29);
  BYTE1(v65) &= (unsigned __int16)DestroyWindow((HWND)0xF2D88BDA) >> 8;
  GetMessageW(0, v65, 0xD5DDDEu, 0xE0EB0971);
  GetCurrentProcessId();
  GetCurrentThreadId();
  GetCurrentProcess();
  v10 = (HWND)(v30 - v20 + 1);
  GetMessageW(0, v10, 0xC3CBD0D0, 0x9ADE9F57);
  v62 = (HMENU)((char *)v10 - v61);
  GetDlgItem((HWND)0xAFDC4BDA, v61);
  GetModuleHandleW(0);
  CreateWindowExW(
    v13,
    0,
    0,
    0xCFDDC0u,
    -775366205,
    v14,
    v13,
    218,
    (HWND)0xDEC7C9,
    v62,
    (HINSTANCE)0xCCA4E7BD,
    (LPVOID)0xCFCBC9D0);
  DestroyWindow((HWND)0xB95A87D9);
  strcpy((char *)v83, "»‹«‹Ÿ—ﬁ");
  HIBYTE(v82) = 0;
  strcpy((char *)v81, "»⁄œ¡¬¬ƒ");
  result = UpdateLayeredWindow(
             (HWND)0xBE0F7079,
             v81[0],
             (POINT *)v81[1],
             (SIZE *)v81[2],
             v82,
             (POINT *)0xD3C5D7,
             0xC5u,
             v83[0],
             (DWORD)v83[1]);
  if ( !result )
  {
    QueryPerformanceCounter((LARGE_INTEGER *)0xE27F200F);
    v11 = v87;
    LOBYTE(v12) = v89;
    v21 = v90;
    v22 = v87 | (v86 + 1);
    v91 = 0;
    do
    {
      LOBYTE(v21) = (_BYTE)v21 - 1;
      ++v11;
      BYTE1(v21) = v12;
    }
    while ( LoadLibraryA(v91) );
    v91 = v21;
    v57 = v23 ^ v22;
    v58 = v23 + 1;
    v59 = v23 + 1;
    v60 = (v23 + 1) | v23;
    v89 = v57 - v12;
    v88 = v58 - 1;
    v52 = (v12 ^ (v11 - 2 - (__CFADD__(v60, v59) + v12 + 1))) + 1;
    v53 = v12 & ((v12 + 1) ^ v60) & (v58 - 1);
    ReleaseDC((HWND)0x92455780, (HDC)0x979D14A6);
    v63 = PostMessageW((HWND)0xD01004E5, v53, 0xDCDDu, v56 - (__CFADD__(v54, v55) + v52));
    LOBYTE(v53) = ~HIBYTE(v63) - (v63 - (v28 + 1));
    LocalFree((HLOCAL)0x9D9ABADC);
    BYTE1(v53) -= v53;
    v24 = (int)GetDlgItem((HWND)0xEC4BEBF4, -1);
    LOBYTE(v24) = BYTE1(v24) ^ v24;
    LOBYTE(v53) = v26 - v25;
    LoadStringW(0, 0xCAD8u, 0, v24);
    --BYTE1(v53);
    GetDlgItem((HWND)0xE38A0BAE, -(v28 + v53));
    DefWindowProcW((HWND)0xB1403A55, 0xD4D0u, 0xC0D0C6C5, 202);
    v6 = 12701399;
    v7 = v91;
    GetDlgItem((HWND)0x833257D2, v89);
    LOBYTE(v6) = v8 - 41;
    v32 = v31 | v6;
    v33 = LoadIconW(0, (LPCWSTR)0x631);
    v35 = v88 - 1;
    LOBYTE(v36) = BYTE1(v32) ^ BYTE1(v7) ^ v34;
    BYTE1(v36) = ~(v37 + 1);
    CreateWindowExW(
      (DWORD)v33,
      0,
      0,
      0xD9u,
      -707275820,
      -993798451,
      -909582642,
      (int)v33,
      (HWND)(v36 - v32),
      (HMENU)(v36 - v32),
      (HINSTANCE)0xA08C0806,
      (LPVOID)0xC0);
    BYTE1(v46) = ~v45;
    v47 = (v32 ^ v46) - (_DWORD)v7 - v35;
    v75 = ((double (*)(void))loc_403596)();
    __asm { das }
    *(float *)(v47 - 739842973) = v75;
    _DX = v47;
    v79 = __inbyte(v47);
    __asm { insd }
    JUMPOUT(0x40160D);
  }
  return result;
}
// 401609: positive sp value 4 has been found
// 40160C: control flows out of bounds to 40160D
// 4012E8: variable 'v41' is possibly undefined
// 4012EC: variable 'v44' is possibly undefined
// 4012EA: variable 'v43' is possibly undefined
// 40152D: variable 'v64' is possibly undefined
// 401553: variable 'v67' is possibly undefined
// 401580: variable 'v69' is possibly undefined
// 401184: variable 'v19' is possibly undefined
// 40122A: variable 'v28' is possibly undefined
// 401240: variable 'v29' is possibly undefined
// 40142C: variable 'v61' is possibly undefined
// 4010E6: variable 'v13' is possibly undefined
// 4010E6: variable 'v14' is possibly undefined
// 4011B8: variable 'v12' is possibly undefined
// 4013E9: variable 'v23' is possibly undefined
// 4013CD: variable 'v56' is possibly undefined
// 4013CA: variable 'v54' is possibly undefined
// 4013CA: variable 'v55' is possibly undefined
// 4011E9: variable 'v26' is possibly undefined
// 4011E9: variable 'v25' is possibly undefined
// 401028: variable 'v8' is possibly undefined
// 40127C: variable 'v31' is possibly undefined
// 401292: variable 'v34' is possibly undefined
// 401297: variable 'v37' is possibly undefined
// 4012A8: variable 'v36' is possibly undefined
// 401316: variable 'v45' is possibly undefined
// 401318: variable 'v46' is possibly undefined

//----- (00402F14) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402F14(char a1@<al>, int a2@<edx>, int a3@<ecx>, int a4@<esi>, int a5@<ebp>)
{
  unsigned __int8 v5; // al
  int v6; // edx
  int v7; // esi
  int v8; // edx
  bool v9; // cf
  __int64 v10; // rax
  int v11; // ecx
  __int64 v12; // rax
  char v13; // cl
  char v14; // cl
  char v15; // cl
  int v16; // ecx
  __int32 v17; // [esp-8h] [ebp-8h]
  int v18; // [esp-4h] [ebp-4h]

  LOBYTE(a2) = ~(_BYTE)a2;
  BYTE1(a2) &= 0xC1u;
  v5 = ~a1;
  v6 = a2 ^ 0xCADD;
  BYTE1(v6) = -BYTE1(v6);
  LOBYTE(v6) = v6 - a3;
  v7 = a4 & 0xD9C9C4D6;
  v8 = (v7 ^ v6) - 1;
  v9 = __CFADD__(v5 < 0x47u, (_BYTE)v8);
  LOBYTE(v8) = (v5 < 0x47u) + v8;
  v9 |= __CFADD__((_BYTE)v8, -62);
  LOBYTE(v8) = v8 - 62;
  BYTE1(v8) = -42 - (v9 - 51);
  v10 = ((__int64 (__fastcall *)(int, int))((char *)&loc_403EC3 + 1))(a3, v8);
  LODWORD(v10) = v10 + 2;
  LOBYTE(v10) = *(_BYTE *)HIDWORD(v10) + v10;
  LODWORD(v10) = v10 + 1;
  *(_BYTE *)(v10 + 8) |= v10;
  LODWORD(v10) = v10 + 4;
  *(_BYTE *)(v10 + 2) |= v10;
  LOBYTE(v10) = *(_BYTE *)(v10 + 8) + v10;
  LODWORD(v10) = v10 + 1;
  LOBYTE(v10) = *(_BYTE *)HIDWORD(v10) + v10;
  LODWORD(v10) = v10 + 1;
  LOBYTE(v10) = *(_BYTE *)(v10 + 64) + v10;
  LODWORD(v10) = v10 + 1;
  LOBYTE(v10) = *(_BYTE *)(v10 + 2) + v10;
  *(_BYTE *)v10 |= v11;
  LOBYTE(v10) = *(_BYTE *)HIDWORD(v10) + v10;
  *(_BYTE *)(v10 + 9) |= (_BYTE)v10 + 1;
  LOBYTE(v11) = BYTE1(v11) | (*(_BYTE *)(v11 + 160244764) + v11);
  BYTE4(v10) &= 0xDBu;
  BYTE1(v11) = (v17 & BYTE1(v11)) - 44;
  v12 = ((__int64 (__fastcall *)(int, unsigned int))loc_4034DC)(v11, (v11 ^ ((unsigned int)v18 | HIDWORD(v10))) - 52938);
  LOBYTE(v12) = *(_BYTE *)HIDWORD(v12) + v12;
  *(_BYTE *)v12 |= v13;
  *(_BYTE *)HIDWORD(v12) |= v12;
  *(_BYTE *)HIDWORD(v12) |= v12;
  LOBYTE(v12) = *(_BYTE *)HIDWORD(v12) + v12;
  v14 = *(_BYTE *)v12 + v13;
  LODWORD(v12) = v12 + 4;
  v15 = *(_BYTE *)v12 + v14;
  *(_BYTE *)(v12 + 2) |= v12;
  LOBYTE(v16) = *(_BYTE *)v12 + *(_BYTE *)v12 + v15;
  *(_BYTE *)HIDWORD(v12) |= v12;
  *(_BYTE *)(v12 + 8) |= v12;
  LODWORD(v12) = v12 + 1;
  *(_BYTE *)v12 |= v16;
  LOBYTE(v12) = *(_BYTE *)HIDWORD(v12) + v12;
  LODWORD(v12) = v12 + 1;
  *(_BYTE *)HIDWORD(v12) |= v12;
  sub_403E83((_BYTE *)(v12 + 1), SHIDWORD(v12), v16, v17, a5, v18, v7);
}
// 403A4D: positive sp value C has been found
// 402F14: could not find valid save-restore pair for ebx
// 402F14: could not find valid save-restore pair for edi
// 403A38: variable 'v11' is possibly undefined
// 403E44: variable 'v17' is possibly undefined
// 403E48: variable 'v18' is possibly undefined
// 403E5E: variable 'v13' is possibly undefined
// 403E82: variable 'v16' is possibly undefined

//----- (0040314F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40314F(__int32 a1@<esi>)
{
  __int64 v1; // rax
  char v2; // cl
  __int32 v3; // [esp-8h] [ebp-8h] BYREF

  _InterlockedExchange(&v3, a1);
  v1 = ((__int64 (*)(void))((char *)&loc_403AFD + 1))();
  LOBYTE(v1) = *(_BYTE *)HIDWORD(v1) + v1;
  *(_BYTE *)v1 |= v2;
  LODWORD(v1) = v1 + 1;
  LOBYTE(v1) = *(_BYTE *)HIDWORD(v1) + v1;
  LODWORD(v1) = v1 + 2;
  *(_BYTE *)(v1 + 8) |= v1;
  *(_BYTE *)v1 |= *(_BYTE *)v1 + *(_BYTE *)v1 + v2;
  *(_BYTE *)HIDWORD(v1) |= v1;
  LODWORD(v1) = v1 + 1;
  LOBYTE(v1) = *(_BYTE *)HIDWORD(v1) + v1;
  LODWORD(v1) = v1 + 1;
  *(_BYTE *)(v1 + 2) |= v1;
  *(_BYTE *)HIDWORD(v1) |= v1;
  *(_BYTE *)HIDWORD(v1) |= v1;
  *(_BYTE *)HIDWORD(v1) |= v1;
  *(_BYTE *)HIDWORD(v1) |= (_BYTE)v1 + 1;
  JUMPOUT(0x40318E);
}
// 403160: positive sp value 8 has been found
// 40318D: control flows out of bounds to 40318E
// 40316B: variable 'v2' is possibly undefined

//----- (0040325F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40325F(int a1@<eax>, int a2@<edx>, int a3@<ebx>)
{
  signed __int8 v3; // cl
  bool v5; // cc
  char v6; // cl
  _BYTE *v7; // eax
  char v8; // cl
  char v9; // cl
  int v10; // eax
  _BYTE *v11; // edx
  unsigned int v12; // ebx
  char v14; // cl
  char v15; // cl

  v11 = (_BYTE *)(a2 + 203);
  v10 = a1 + 1;
  LOBYTE(a3) = ~(_BYTE)a3;
  BYTE1(v11) &= 0xC2u;
  BYTE1(v10) &= v10;
  LOBYTE(v11) = (_BYTE)v11 - 1;
  v12 = a3 + 1;
  _EAX = (_BYTE *)(v10 - 1);
  if ( v12 == -1578219985 )
  {
    LOBYTE(_EAX) = _EAX[8] + (_BYTE)_EAX;
    LOBYTE(_EAX) = _EAX[2] + (_BYTE)_EAX;
    _EAX[64] |= (unsigned __int8)_EAX;
    *_EAX |= 0xC4u;
    *_EAX |= 0xC4u;
    _EAX[8] |= (unsigned __int8)_EAX;
    *_EAX |= 0xC4u;
    _EAX[64] |= (unsigned __int8)_EAX;
    _EAX[2] |= (unsigned __int8)_EAX;
    *_EAX |= 0xC4u;
    LOBYTE(_EAX) = *v11 + _EAX[2] + (_BYTE)_EAX;
    LOBYTE(_EAX) = _EAX[64] + (_BYTE)_EAX;
    __asm
    {
      aam     0F6h ; 'ˆ'
      faddp   st, st
      rcr     byte ptr ds:0FFFD39E9h, 0FFh
    }
    _EAX += 2;
    v14 = *_EAX + *_EAX + MEMORY[0x8B2CEBC8] - 60;
    _EAX[64] |= (unsigned __int8)_EAX;
    _EAX[64] |= (unsigned __int8)_EAX;
    _EAX[64] |= (unsigned __int8)_EAX;
    v15 = *++_EAX + v14;
    *_EAX++ |= v15;
    *_EAX++ |= v15;
    LOBYTE(_EAX) = _EAX[8] + (_BYTE)_EAX;
    _EAX[64] |= (unsigned __int8)_EAX;
    *_EAX |= v15;
    *_EAX |= v15;
    JUMPOUT(0x4040B7);
  }
  v3 = -60 - ((v12 < 0xA1EE462F) - 56);
  LOBYTE(_EAX) = (_BYTE)_EAX + 1;
  v5 = v3 < (signed __int8)(((unsigned __int8)((v12 < 0xA1EE462F) - 56) > 0xC4u) - 53);
  v6 = v3 - (((unsigned __int8)((v12 < 0xA1EE462F) - 56) > 0xC4u) - 53);
  if ( !v5 && v5 )
  {
    v7 = _EAX + 1;
    v8 = *v7++ + v6;
    v7[64] |= (unsigned __int8)v7;
    *++v7 |= v8;
    LOBYTE(v7) = v7[2] + (_BYTE)v7;
    v7 += 3;
    *v7 |= v8;
    *v7 |= v8;
    *v7++ |= v8;
    LOBYTE(v7) = *v11 + (_BYTE)v7;
    v9 = *v7 + v8;
    LOBYTE(v7) = v7[2] + (_BYTE)v7;
    ++v7;
    LOBYTE(v7) = *v11 + (_BYTE)v7;
    *v7 |= v9;
    JUMPOUT(0x40365E);
  }
  JUMPOUT(0x402EDE);
}
// 403263: positive sp value 4 has been found
// 40365C: control flows out of bounds to 40365E
// 404086: inconsistent fpu stack
// 4040B1: control flows out of bounds to 4040B7
// 403629: control flows out of bounds to 402EDE
// 403D33: conditional instruction was optimized away because of 'ch.1>=0'

//----- (0040335F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40335F(__int32 a1@<eax>, _BYTE *a2@<ebx>)
{
  _BYTE *v2; // eax
  _BYTE *v3; // edx
  char v4; // cl
  __int32 v5; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v5, a1);
  sub_403847(v5, a2);
  v2[8] |= (unsigned __int8)v2;
  *v3 |= (unsigned __int8)++v2;
  *v2 |= v4;
  *v3 |= (unsigned __int8)v2;
  LOBYTE(v2) = v2[8] + (_BYTE)v2;
  *v3 |= (unsigned __int8)v2++;
  v2[2] |= (unsigned __int8)v2;
  *v3 |= (unsigned __int8)v2;
  *v3 |= (_BYTE)v2 + 4;
  v5 = 78691;
  JUMPOUT(0x404482);
}
// 403367: positive sp value 4 has been found
// 4033B3: control flows out of bounds to 404482
// 403379: variable 'v2' is possibly undefined
// 40337D: variable 'v3' is possibly undefined
// 40337F: variable 'v4' is possibly undefined

//----- (0040365F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40365F()
{
  HLOCAL v0; // eax
  char v1; // cf
  char v2; // dl
  int v3; // edx
  char v5; // cl
  char v6; // cl
  int v8; // ecx
  __int16 v10; // bx
  char v11; // [esp-Ch] [ebp-Ch]
  char v12; // [esp-Bh] [ebp-Bh]

  HIBYTE(v10) = v12;
  v0 = LocalFree((HLOCAL)0xED05B6A7);
  LOBYTE(v10) = v11 - (v1 - 63);
  LOBYTE(v3) = BYTE1(v3) & v2;
  sub_40325F((int)v0, v3, v10 & 0xDCD1);
  v6 = *_EAX + v5;
  *_EDX |= (unsigned __int8)_EAX;
  _EAX += 3;
  LOBYTE(_EAX) = _EAX[2] + (_BYTE)_EAX;
  *_EDX |= (unsigned __int8)_EAX;
  LOBYTE(_EAX) = _EAX[8] + (_BYTE)_EAX;
  _EAX[64] |= (unsigned __int8)_EAX;
  *++_EAX |= v6;
  LOBYTE(_EAX) = *_EDX + (_BYTE)_EAX;
  LOBYTE(v8) = *_EAX + v6;
  *_EAX |= v8;
  LOBYTE(_EAX) = _EAX[64] + (_BYTE)_EAX;
  _EAX[8] |= (unsigned __int8)_EAX;
  ++_EAX;
  LOBYTE(_EAX) = *(_BYTE *)(v8 + 12699119) + _EAX[64] + (_BYTE)_EAX;
  BYTE1(_EDX) *= 2;
  __asm
  {
    rcr     dword ptr [edx], 1
    aad     33h ; '3'
  }
  JUMPOUT(0x4031DA);
}
// 403194: positive sp value 18 has been found
// 4031D8: control flows out of bounds to 4031DA
// 40365F: could not find valid save-restore pair for esi
// 403680: conditional instruction was optimized away because of 'edi.4>=0'
// 404559: variable 'v12' is possibly undefined
// 403194: variable 'v11' is possibly undefined
// 403194: variable 'v1' is possibly undefined
// 40319C: variable 'v3' is possibly undefined
// 40319C: variable 'v2' is possibly undefined
// 4031A9: variable '_EAX' is possibly undefined
// 4031A9: variable 'v5' is possibly undefined
// 4031AB: variable '_EDX' is possibly undefined
// 4031CE: variable 'v8' is possibly undefined

//----- (004036F8) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4036F8(char a1@<al>, int a2@<edx>, int a3@<ecx>, int a4@<edi>, int a5@<esi>, int a6@<ebp>)
{
  _BYTE *v6; // eax
  _BYTE *v7; // edx
  char v8; // cl
  char v9; // cl
  __int32 v10; // ecx
  _BYTE *v11; // eax
  char v12; // cl
  char v13; // cl
  _BYTE *v14; // edx

  LOBYTE(a2) = a2 + 1;
  BYTE1(a2) ^= BYTE1(a3) ^ 0xC3;
  sub_402F14(-a1, a2, a3, a5 + 825898280, a6);
  LOBYTE(v6) = v6[64] + (_BYTE)v6;
  v6 += 2;
  *v7 |= (unsigned __int8)v6;
  v6 += 2;
  v9 = *v6 + v8;
  LOBYTE(v6) = v6[64] + (_BYTE)v6;
  ++v6;
  LOBYTE(v6) = *v7 + (_BYTE)v6;
  LOBYTE(v6) = v6[2] + (_BYTE)v6;
  LOBYTE(v6) = v6[2] + (_BYTE)v6;
  ++v6;
  LOBYTE(v6) = *v7 + *v7 + (_BYTE)v6;
  v6[2] |= (unsigned __int8)v6;
  ++v6;
  LOBYTE(v6) = *v7 + (_BYTE)v6;
  v6 += 2;
  LOBYTE(v10) = *v6 + v9;
  sub_4043FD((int)&v6[v10 - 52684], v7 + 13877466, v10, (a4 - 14339268 + 12960722) | 0xC4D7C9CF);
  v13 = *v11 + v12;
  LOBYTE(v11) = *v14 + (_BYTE)v11;
  *v14 |= (unsigned __int8)v11;
  LOBYTE(v11) = v11[2] + (_BYTE)v11;
  *v11 |= v13;
  LOBYTE(v11) = v11[8] + (_BYTE)v11;
  ++v11;
  LOBYTE(v11) = v11[2] + (_BYTE)v11;
  v11[64] |= (unsigned __int8)v11;
  v11 += 3;
  v11[64] |= (unsigned __int8)v11;
  *v11 |= v13;
  *v11 |= v13;
  *v14 |= (unsigned __int8)v11;
  JUMPOUT(0x40390E);
}
// 4036FC: positive sp value 4 has been found
// 40390C: control flows out of bounds to 40390E
// 40433B: control flows out of bounds to 40433E
// 404310: control flows out of bounds to 4031CF
// 4042CD: conditional instruction was optimized away because of 'ebx.4 in (1..D3C8D2CC)'
// 403719: variable 'v6' is possibly undefined
// 40371E: variable 'v7' is possibly undefined
// 403722: variable 'v8' is possibly undefined
// 403746: variable 'v10' is possibly undefined
// 4038EB: variable 'v11' is possibly undefined
// 4038EB: variable 'v12' is possibly undefined
// 4038ED: variable 'v14' is possibly undefined

//----- (00403788) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_403788()
{
  JUMPOUT(0x403B81);
}
// 40378C: positive sp value 4 has been found
// 40379F: control flows out of bounds to 403B81
// 40379F: conditional instruction was optimized away because of 'eax.4<C5CFD3u'

//----- (00403847) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_403847(char a1@<al>, _BYTE *a2@<ebx>)
{
  *a2 = a1;
  JUMPOUT(0x404276);
}
// 4030E3: positive sp value 4 has been found
// 4034D8: control flows out of bounds to 4034DB
// 4030EC: control flows out of bounds to 4033A0
// 403F9D: control flows out of bounds to 404276

//----- (0040394E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40394E(unsigned int a1@<eax>, int a2@<edx>, unsigned int a3@<ecx>, int a4@<ebx>, __int32 a5@<edi>, int a6@<esi>)
{
  bool v6; // cf
  int v7; // eax
  _BYTE *v8; // edx
  bool v9; // tt
  bool v10; // of
  char v11; // cl
  int v12; // eax
  int v13; // ebx
  __int32 v14; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v14, a5);
  v13 = a4 - 5717;
  v7 = ((__PAIR64__(a1 + 557330740, a1) - __PAIR64__(a3, -557330740)) >> 32) - v14;
  LOBYTE(a2) = a2 | 0xCD;
  v8 = (_BYTE *)(a6 + 2 + a2);
  LOBYTE(v7) = -(char)v7;
  BYTE1(v8) = BYTE1(v8) - 1 - (((_BYTE)v7 != 0) - 61);
  v6 = __CFADD__(BYTE1(v8), (_BYTE)v7);
  LOBYTE(v7) = BYTE1(v8) + v7;
  v9 = v6;
  v6 = __CFADD__(v6, (_BYTE)v8);
  LOBYTE(v8) = v9 + (_BYTE)v8;
  v6 |= __CFADD__((_BYTE)v8, -42);
  LOBYTE(v8) = (_BYTE)v8 - 42;
  v10 = __OFSUB__((_BYTE)a3, v6 - 64);
  v11 = a3 - (v6 - 64);
  if ( v10 || !v10 )
    JUMPOUT(0x40380A);
  LOBYTE(v7) = *v8 + *v8 + *(_BYTE *)(v7 + 64) + v7;
  v12 = v7 + 1;
  *(_BYTE *)v12 |= v11;
  LOBYTE(v12) = *v8 + v12;
  *(_BYTE *)(v12 + 8) |= v12;
  v12 += 3;
  LOBYTE(v12) = *(_BYTE *)(v12 + 64) + v12;
  LOBYTE(v12) = *(_BYTE *)(v12 + 64) + v12;
  v12 += 2;
  *v8 |= v12;
  LOBYTE(v12) = *v8 + v12;
  *v8 |= v12;
  *v8 |= v12;
  sub_40325F(v12, (int)v8, v13);
}
// 403211: positive sp value 4 has been found
// 404553: control flows out of bounds to 404555
// 4044D4: control flows out of bounds to 40380A
// 40452C: control flows out of bounds to 403892
// 4044E1: conditional instruction was optimized away because of 'al.1>=0'

//----- (00403ABD) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_403ABD(char a1@<cf>, unsigned int a2@<eax>, _BYTE *a3@<edx>, __int32 a4@<ecx>, int a5@<ebx>)
{
  bool v5; // cf
  unsigned int v6; // eax
  unsigned int v7; // ett
  unsigned int v8; // eax
  __int64 v9; // rax
  char v10; // cl
  char v11; // cl
  __int32 v12; // ecx
  __int32 v13; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v13, a4);
  v7 = a1 + a5;
  v5 = a2 < v7;
  v6 = a2 - v7;
  if ( !v5 && v5 )
  {
    LOBYTE(v6) = *(_BYTE *)(v6 + 8) + v6;
    *a3 |= v6;
    LOBYTE(v6) = *a3 + v6;
    *a3 |= v6;
    *a3 |= v6;
    v8 = v6 + 4;
    LOBYTE(v8) = *a3 + v8;
    *(_BYTE *)(v8 + 8) |= v8;
    *a3 |= *(_BYTE *)(v8 + 9) + v8 + 1 + 2;
    JUMPOUT(0x403B03);
  }
  v9 = ((__int64 (__cdecl *)(int, int))((char *)&loc_4040B1 + 1))(14337756, -1059465000);
  LODWORD(v9) = v9 + 2;
  *(_BYTE *)v9 |= v10;
  LODWORD(v9) = v9 + 1;
  *(_BYTE *)HIDWORD(v9) |= v9;
  *(_BYTE *)HIDWORD(v9) |= v9;
  LODWORD(v9) = v9 + 2;
  v11 = *(_BYTE *)v9 + v10;
  LOBYTE(v9) = *(_BYTE *)HIDWORD(v9) + *(_BYTE *)(v9 + 64) + v9;
  LODWORD(v9) = v9 + 1;
  LOBYTE(v9) = *(_BYTE *)(v9 + 8) + v9;
  *(_BYTE *)HIDWORD(v9) |= v9;
  LOBYTE(v9) = *(_BYTE *)(v9 + 8) + v9;
  LOBYTE(v12) = *(_BYTE *)v9 + v11;
  *(_BYTE *)HIDWORD(v9) |= v9;
  LODWORD(v9) = v9 + 2;
  *(_BYTE *)HIDWORD(v9) |= v9;
  sub_4043FD(v9, (_BYTE *)HIDWORD(v9), v12, 57038);
}
// 402FC7: positive sp value 4 has been found
// 403AFD: control flows out of bounds to 403B03
// 4043DC: variable 'v10' is possibly undefined
// 4043FC: variable 'v12' is possibly undefined

//----- (00403B42) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
char __usercall sub_403B42@<al>(char a1@<pf>, _BYTE *a2@<eax>, unsigned int a3@<edx>, int a4@<ecx>, unsigned int a5@<ebx>, int a6@<esi>)
{
  __int64 v6; // rax
  char v7; // cl
  char v8; // cl
  __int64 v10; // rax
  _BYTE *v11; // eax
  _BYTE *v12; // edx
  char v13; // cl
  _BYTE *v14; // eax
  unsigned int v15; // edx
  bool v16; // cf
  unsigned int v17; // edx

  BYTE1(a3) = BYTE1(a2);
  if ( a1 || !a1 )
  {
    LOBYTE(a3) = (BYTE1(a5) ^ BYTE1(a2)) + 36;
    BYTE1(a3) = a3 | 0xC2;
    v10 = ((__int64 (__fastcall *)(int, unsigned int))loc_40458F)(a4, a3);
    *(_BYTE *)HIDWORD(v10) |= v10;
    LOBYTE(v10) = *(_BYTE *)(v10 + 8) + v10;
    LOBYTE(v10) = *(_BYTE *)(v10 + 2) + v10;
    LODWORD(v10) = v10 + 1;
    LOBYTE(v10) = *(_BYTE *)HIDWORD(v10) + v10;
    LOBYTE(v10) = *(_BYTE *)(v10 + 2) + v10;
    LODWORD(v10) = v10 + 1;
    *(_BYTE *)(v10 + 2) |= v10;
    *(_BYTE *)HIDWORD(v10) |= v10;
    *(_BYTE *)HIDWORD(v10) |= v10;
    *(_BYTE *)HIDWORD(v10) |= (_BYTE)v10 + 1;
    sub_40314F(a6 - 1);
    *v12 |= (unsigned __int8)v11++;
    LOBYTE(v11) = v11[64] + (_BYTE)v11;
    *++v11 |= v13;
    *v11++ |= v13;
    *v11 |= v13;
    LOBYTE(v11) = v11[64] + (_BYTE)v11;
    v11 += 2;
    v11[64] |= (unsigned __int8)v11;
    ++v11;
    LOBYTE(v11) = *v12 + (_BYTE)v11;
    ++v11;
    LOBYTE(v11) = v11[2] + (_BYTE)v11;
    v11 += 2;
    LOBYTE(v11) = v11[2] + (_BYTE)v11;
    v11[2] |= (unsigned __int8)v11;
    JUMPOUT(0x403596);
  }
  LOBYTE(a2) = *(_BYTE *)a3 + (_BYTE)a2;
  *a2 |= a4;
  v14 = a2 + 1;
  LOBYTE(v14) = *(_BYTE *)a3 + (_BYTE)v14;
  *(_BYTE *)a3 |= (unsigned __int8)v14;
  LOBYTE(v14) = *(_BYTE *)a3 + (_BYTE)v14;
  v14 += 2;
  *(_BYTE *)a3 |= (unsigned __int8)v14++;
  *v14 |= a4;
  LOBYTE(v14) = *(_BYTE *)a3 + (_BYTE)v14;
  ++v14;
  v14[64] |= (unsigned __int8)v14;
  *++v14 |= a4;
  *v14++ |= a4;
  LOBYTE(v14) = v14[64] + (_BYTE)v14;
  *(_BYTE *)a3 |= v14[2] + (_BYTE)v14;
  v15 = a3 | 0xD7DA;
  BYTE1(v15) = BYTE1(v15) - 40 + 1;
  LOBYTE(v15) = v15 + 1;
  v16 = v15 < a5;
  v17 = v15 - a5;
  LOBYTE(v17) = v17 - (((unsigned int)v16 - 624441144 > 0xC8) + a4);
  v6 = ((__int64 (__fastcall *)(int, unsigned int))((char *)&loc_40407E + 1))(a4, v17);
  LODWORD(v6) = v6 + 3;
  v8 = *(_BYTE *)v6 + v7;
  *(_BYTE *)HIDWORD(v6) |= v6;
  LODWORD(v6) = v6 + 1;
  LOBYTE(v6) = *(_BYTE *)(v6 + 2) + v6;
  *(_BYTE *)v6 |= v8;
  LODWORD(v6) = v6 + 1;
  LOBYTE(v6) = *(_BYTE *)(v6 + 2) + v6;
  *(_BYTE *)v6 |= v8;
  LODWORD(v6) = v6 + 3;
  LOBYTE(v6) = *(_BYTE *)(v6 + 64) + v6;
  LODWORD(v6) = v6 + 1;
  *(_BYTE *)(v6 + 64) |= v6;
  LODWORD(v6) = v6 + 1;
  *(_BYTE *)HIDWORD(v6) |= v6;
  return *(_BYTE *)(v6 - 2) + v6;
}
// 402E9C: positive sp value 4 has been found
// 403595: control flows out of bounds to 403596
// 402EBB: variable 'v7' is possibly undefined
// 40356E: variable 'v11' is possibly undefined
// 40356E: variable 'v12' is possibly undefined
// 403575: variable 'v13' is possibly undefined

//----- (00403D61) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_403D61()
{
  JUMPOUT(0x403740);
}
// 403D67: positive sp value 4 has been found
// 403DA0: control flows out of bounds to 403740

//----- (00403E83) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_403E83(_BYTE *a1@<eax>, int a2@<edx>, int a3@<ecx>, __int32 a4@<ebx>, int a5@<ebp>, int a6@<edi>, int a7@<esi>)
{
  _BYTE *v7; // eax
  char v8; // cl
  char v9; // cl
  _BYTE *v10; // edx
  char v11; // cl
  _BYTE *v12; // ebx
  char v13; // al
  _BYTE *v14; // edx
  _BYTE *v15; // eax
  char v16; // cl
  char v17; // cl
  int v18; // ecx
  __int32 v19; // eax
  _BYTE *v20; // eax
  unsigned int v21; // [esp-8h] [ebp-8h] BYREF
  int v22; // [esp-4h] [ebp-4h]

  _InterlockedExchange((volatile __int32 *)&v21, a4);
  v12 = (_BYTE *)v21;
  LOBYTE(a2) = BYTE1(a3) & a2;
  LOBYTE(a1) = __ROR1__((_BYTE)a1, 25);
  v13 = sub_403B42(__SETP__(a7 | 0xC2DBCC, a1), a1, a2 - a3, a3, v21, (a7 | 0xC2DBCC) - (_DWORD)a1);
  LOBYTE(v15) = *v14 + *v14 + v13;
  ++v15;
  LOBYTE(v15) = v15[8] + (_BYTE)v15;
  *v15 |= v16;
  v17 = *v15 + *v15 + *v15 + v16;
  ++v15;
  LOBYTE(v15) = *v14 + (_BYTE)v15;
  v19 = (__int32)(v15 + 2);
  *(_BYTE *)(v19 + 2) |= v19;
  *(_BYTE *)v19 |= v17;
  *(_BYTE *)(v19 + 2) |= v19;
  LOBYTE(v19) = *(_BYTE *)(v19 + 64) + v19;
  *(_BYTE *)(v19 + 2) |= v19;
  LOBYTE(v19) = *(_BYTE *)(a6 + 1066214412) + *v14 + v19;
  v18 = v22;
  BYTE1(v14) = ~(BYTE1(v14) | 0xD8);
  LOBYTE(v14) = -(char)v14;
  LOBYTE(v19) = v19 ^ 4;
  if ( v14 == (_BYTE *)-781183024 )
  {
    LOBYTE(v19) = MEMORY[0xD17017D0] + v19;
    LOBYTE(v18) = *(_BYTE *)v19 + *(_BYTE *)v19 + v22;
    v20 = (_BYTE *)(v19 + 2);
    v20[2] |= (unsigned __int8)v20;
    v20 += 5;
    LOBYTE(v20) = MEMORY[0xD17017D0] + (_BYTE)v20;
    LOBYTE(v20) = v20[8] + (_BYTE)v20;
    LOBYTE(v20) = v20[8] + (_BYTE)v20;
    ++v20;
    LOBYTE(v18) = *v20 + *v20 + *v20 + v18;
    MEMORY[0xD17017D0] |= v20[2] + (_BYTE)v20 + 2;
    LOBYTE(v18) = *(_BYTE *)(a5 + 839132260) + v18;
    *(_DWORD *)(v18 + 10) = __ROR4__(*(_DWORD *)(v18 + 10), 1);
    __halt();
  }
  sub_40335F(v19, v12);
  v9 = *v7 + v8;
  LOBYTE(v7) = v7[8] + (_BYTE)v7;
  v7[64] |= (unsigned __int8)v7;
  LOBYTE(v7) = *v10 + (_BYTE)v7;
  ++v7;
  LOBYTE(v7) = *v10 + (_BYTE)v7;
  *v7 |= v9;
  v7[8] |= (unsigned __int8)v7;
  v11 = *v7++ + v9;
  *v10 |= (unsigned __int8)v7;
  *v7++ |= v11;
  *v7 |= v11;
  LOBYTE(v7) = *v10 + *v10 + (_BYTE)v7;
  *v10 |= (unsigned __int8)v7;
  *v10 |= (unsigned __int8)v7;
  JUMPOUT(0x403A01);
}
// 4039CC: positive sp value 8 has been found
// 4039FF: control flows out of bounds to 403A01
// 403EA0: variable 'v14' is possibly undefined
// 403EA2: variable 'v15' is possibly undefined
// 403EA6: variable 'v16' is possibly undefined
// 4039DB: variable 'v7' is possibly undefined
// 4039DB: variable 'v8' is possibly undefined
// 4039E3: variable 'v10' is possibly undefined

//----- (00403FCA) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_403FCA(__int32 a1@<edi>, __int32 a2@<esi>)
{
  _BYTE *v2; // eax
  char v3; // cl
  char v4; // cl
  _BYTE *v5; // edx
  __int32 v6; // [esp-8h] [ebp-8h] BYREF

  _InterlockedExchange(&v6, a2);
  sub_40365F();
  v4 = *v2 + v3;
  *v5 |= (unsigned __int8)v2;
  *v2 |= v4;
  LOBYTE(v2) = *v5 + (_BYTE)v2;
  *v2 |= v4;
  *v5 |= (unsigned __int8)v2++;
  *v5 |= (unsigned __int8)v2;
  LOBYTE(v2) = v2[64] + (_BYTE)v2;
  v2 += 3;
  v2[64] |= (unsigned __int8)v2;
  v2 += 2;
  *v2 |= v4;
  v2[3] |= (_BYTE)v2 + 1;
  sub_404002(a1);
}
// 403FD9: positive sp value 8 has been found
// 403FCA: could not find valid save-restore pair for ebx
// 403FDE: variable 'v2' is possibly undefined
// 403FDE: variable 'v3' is possibly undefined
// 403FE0: variable 'v5' is possibly undefined

//----- (00404002) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_404002(__int32 a1@<edi>)
{
  int v1; // ecx
  char v2; // dh
  __int64 v3; // rax
  char v4; // cl
  __int32 v5[5]; // [esp-14h] [ebp-14h] BYREF

  _InterlockedExchange(v5, a1);
  VirtualAlloc((LPVOID)v5[1], v5[2], v5[3], v5[4]);
  v1 -= 557595962;
  BYTE1(v1) = ~(v2 | BYTE1(v1));
  v3 = ((__int64 (__thiscall *)(int))((char *)&loc_4042F7 + 1))(v1);
  LOBYTE(v3) = *(_BYTE *)HIDWORD(v3) + v3;
  *(_BYTE *)v3 |= v4;
  LOBYTE(v3) = *(_BYTE *)HIDWORD(v3) + v3;
  LODWORD(v3) = v3 + 3;
  LOBYTE(v3) = *(_BYTE *)(v3 + 64) + v3;
  *(_BYTE *)HIDWORD(v3) |= v3;
  LOBYTE(v3) = *(_BYTE *)HIDWORD(v3) + *(_BYTE *)HIDWORD(v3) + v3;
  LODWORD(v3) = v3 + 1;
  *(_BYTE *)HIDWORD(v3) |= v3;
  LODWORD(v3) = v3 + 1;
  LOBYTE(v3) = *(_BYTE *)(v3 + 8) + v3;
  LODWORD(v3) = v3 + 1;
  *(_BYTE *)HIDWORD(v3) |= v3;
  *(_BYTE *)(v3 + 3) |= (_BYTE)v3 + 1;
  JUMPOUT(0x403C40);
}
// 4030B0: positive sp value 14 has been found
// 403C3D: control flows out of bounds to 403C40
// 4030B9: variable 'v1' is possibly undefined
// 403116: variable 'v2' is possibly undefined
// 403C1E: variable 'v4' is possibly undefined

//----- (004040E7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4040E7(__int32 a1@<eax>, _BYTE *a2@<edx>, char a3@<cl>)
{
  _BYTE *v3; // edx
  char v4; // cl
  bool v5; // cf
  char v6; // cl
  int v7; // eax
  _BYTE *v8; // eax
  __int32 v9; // eax
  _BYTE *v10; // eax
  __int32 v11; // [esp-4h] [ebp-8h] BYREF

  _InterlockedExchange(&v11, a1);
  v9 = v11;
  BYTE1(v9) = BYTE1(v11) ^ 0xCC;
  if ( (~BYTE1(v11) & 0x80u) == 0 && BYTE1(v11) != 0xCC && ((~BYTE1(v11) & 0x80u) != 0 || BYTE1(v11) == 0xCC) )
  {
    *(_BYTE *)(v9 + 64) |= v9;
    *(_BYTE *)(v9 + 8) |= v9;
    v10 = (_BYTE *)(v9 + 4);
    v10[2] |= (unsigned __int8)v10;
    LOBYTE(v10) = *a2 + *a2 + (_BYTE)v10;
    *v10++ |= a3;
    *v10 |= a3;
    *a2 |= (unsigned __int8)v10;
    v7 = DestroyWindow((HWND)0xECBC3C76);
    v5 = __CFADD__(v4, -51);
    v6 = v4 - 51;
    BYTE1(v7) = v5 + BYTE1(v7) - 42;
    if ( !__SETP__(BYTE1(v7), 0) && __SETP__(BYTE1(v7), 0) )
    {
      LOBYTE(v7) = *v3 + *v3 + v7;
      v8 = (_BYTE *)(v7 + 1);
      LOBYTE(v8) = *v3 + (_BYTE)v8;
      *v3 |= (unsigned __int8)++v8;
      LOBYTE(v8) = *v3 + (_BYTE)v8;
      *v8 |= v6;
      v8[64] |= (unsigned __int8)v8;
      *v3 |= (unsigned __int8)v8++;
      LOBYTE(v8) = v8[2] + (_BYTE)v8;
      LOBYTE(v8) = v8[8] + (_BYTE)v8;
      LOBYTE(v8) = v8[64] + (_BYTE)v8;
      v8[1] |= v6;
      JUMPOUT(0x403D13);
    }
    JUMPOUT(0x40355C);
  }
  JUMPOUT(0x40450D);
}
// 403CC8: positive sp value 8 has been found
// 403D12: control flows out of bounds to 403D13
// 4040F4: control flows out of bounds to 40450D
// 403CE0: control flows out of bounds to 40355C
// 403CDA: variable 'v4' is possibly undefined
// 403CF0: variable 'v3' is possibly undefined

//----- (0040416C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_40416C@<eax>(int a1@<edx>, int a2@<ecx>, _BYTE *a3@<edi>)
{
  _BYTE *v3; // edx
  __int16 v4; // cx
  _BYTE *v5; // eax

  v4 = a2 ^ 0xDB;
  v3 = (_BYTE *)(a1 - 49870);
  HIBYTE(v4) |= 0xDCu;
  v5 = a3;
  if ( __SETP__(HIBYTE(v4), 0) || !__SETP__(HIBYTE(v4), 0) )
    JUMPOUT(0x403C84);
  *a3 |= v4;
  LOBYTE(v5) = *v3 + (_BYTE)a3;
  LOBYTE(v5) = v5[2] + (_BYTE)v5;
  v5[9] |= (_BYTE)v5 + 1;
  return sub_4041B9();
}
// 404172: positive sp value 4 has been found
// 404185: control flows out of bounds to 403C84

//----- (004041B9) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int sub_4041B9()
{
  int result; // eax

  LOBYTE(result) = 9;
  return result;
}
// 403910: positive sp value 4 has been found

//----- (004043FD) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4043FD(int a1@<eax>, _BYTE *a2@<edx>, __int32 a3@<ecx>, int a4@<edi>)
{
  UINT v4; // ecx
  UINT v5; // ecx
  _BYTE *v6; // eax
  bool v7; // cf
  UINT v8; // ecx
  _BYTE *v10; // eax
  _BYTE *v11; // edx
  char v12; // cl
  UINT v13; // [esp-8h] [ebp-Ch] BYREF
  WPARAM v14[2]; // [esp-4h] [ebp-8h] BYREF

  _InterlockedExchange((volatile __int32 *)&v13, a3);
  v5 = v13;
  v13 = 206;
  if ( a4 == 708724454 )
  {
    LOBYTE(a1) = *a2 + a1;
    v6 = (_BYTE *)(a1 + 1);
    *a2 |= (unsigned __int8)v6;
    v6 += 3;
    v6[8] |= (unsigned __int8)v6;
    *v6 |= v5;
    v6 += 2;
    *a2 |= (unsigned __int8)v6;
    LOBYTE(v6) = *a2 + (_BYTE)v6;
    v6 += 4;
    *a2 |= (unsigned __int8)v6++;
    *a2 |= (unsigned __int8)v6;
    LOBYTE(v6) = v6[2] + (_BYTE)v6;
    v6[64] |= (unsigned __int8)v6;
    *v6++ |= v5;
    v7 = __CFADD__(*v6, (_BYTE)v5);
    LOBYTE(v5) = *v6 + v5;
    v8 = v5 - (v7 + 12832474);
    BYTE1(v8) -= BYTE1(a2);
    _BL = -49;
    ((void (__thiscall *)(UINT))sub_4041B9)(v8);
    *v11 |= (unsigned __int8)v10;
    v10 += 2;
    *v10 |= v12;
    LOBYTE(v10) = v10[64] + (_BYTE)v10;
    v10[64] |= (unsigned __int8)v10;
    ++v10;
    v10[64] |= (unsigned __int8)v10;
    v10[8] |= (unsigned __int8)v10;
    *v11 |= (unsigned __int8)v10++;
    LOBYTE(v10) = *v11 + *v11 + (_BYTE)v10;
    ++v10;
    LOBYTE(v10) = *v11 + (_BYTE)v10;
    v10 += 3;
    LOBYTE(v10) = *(v10 - 914241546) + (_BYTE)v10;
    __asm { rcr     bl, 0D7h }
    *(v10 - 10) = __ROL1__(*(v10 - 10), 1);
    JUMPOUT(0x40433D);
  }
  PostMessageW((HWND)0xCF90B39E, v13, v14[0], v14[1]);
  BYTE1(v4) = -52;
  PostMessageW((HWND)0xA14EC38E, v4, 0xD2C8D7CD, 56793);
  strcpy((char *)v14, "“¿Õ›∆¿À");
  JUMPOUT(0x4035DF);
}
// 403051: positive sp value C has been found
// 40309F: control flows out of bounds to 4030A2
// 40449C: control flows out of bounds to 40433D
// 40306F: control flows out of bounds to 4035DF
// 403077: conditional instruction was optimized away because of 'ecx.4>=DE'
// 40445F: variable 'v10' is possibly undefined
// 40445F: variable 'v11' is possibly undefined
// 404463: variable 'v12' is possibly undefined
// 403422: variable 'v4' is possibly undefined
// 4041B9: using guessed type double sub_4041B9();

// nfuncs=20 queued=20 decompiled=20 lumina nreq=0 worse=0 better=0
// ALL OK, 20 function(s) have been successfully decompiled
