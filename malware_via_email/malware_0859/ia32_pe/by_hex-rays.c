/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int, int, int);
void __fastcall sub_4010C0(int, int);
// void __usercall __noreturn sub_4041C0(int@<ebx>, int@<esi>, double@<st7>, double@<st5>, double@<st1>, double@<st0>);

//-------------------------------------------------------------------------
// Data declarations

int dword_401000 = -678747787; // weak
// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);


//----- (0040106F) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  HMODULE ModuleHandleA; // eax
  int v4; // edx
  int v5; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  ModuleHandleA = GetModuleHandleA(0);
  sub_4010C0((int)ModuleHandleA, v4);
  v5 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 10;
  *(_DWORD *)(a3 + 176) = v5;
  return 0;
}
// 40109E: variable 'v4' is possibly undefined

//----- (004010C0) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
void __fastcall sub_4010C0(int a1, int a2)
{
  int v2; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v2);
  dword_401000 = a2;
}
// 4010C8: write access to const memory at 401000 has been detected
// 401000: using guessed type int dword_401000;

//----- (004041C0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_4041C0(
        int a1@<ebx>,
        int a2@<esi>,
        double a3@<st7>,
        double a4@<st5>,
        double a5@<st1>,
        double a6@<st0>)
{
  int v8; // ebx
  int v9; // ecx
  int v10; // eax
  int v12; // ecx
  int v13; // esi
  signed __int64 v16; // kr00_8
  int v17; // esi
  char v18; // cf
  int v19; // ecx
  int v20; // ecx
  int v21; // esi
  int v25; // eax
  int v26; // ecx
  int v27; // [esp-4h] [ebp-4h]

  _ESI = __ROL4__(a2, 67) - (__CFSHL__(a2, 67) - 562809190);
  _EDI = (_DWORD *)(v27 + 352);
  __asm { fadd    st(5), st }
  LOWORD(a1) = 558;
  v8 = a1 + 168158329;
  __asm { fsub    st(6), st }
  LOWORD(v8) = -31733;
  v9 = v8;
  v10 = v8;
  __asm { rcr     esi, 0F0h }
  while ( 1 )
  {
    __asm { fsubr   st, st }
    LOWORD(_ESI) = v9 ^ 0x3E10;
    LOWORD(v9) = v8 + v9;
    v12 = v9 + 1;
    v13 = -(v10 + _ESI);
    __asm { fadd    st(6), st }
    _CF = __PAIR64__(v13, *_EDI) < 0xDD849CC000E0E2E9ui64;
    _OF = __OFSUB__(__PAIR64__(v13, *_EDI), 0xDD849CC000E0E2E9ui64);
    v16 = __PAIR64__(v13, *_EDI) + 0x227B633FFF1F1D17i64;
    *_EDI -= 14738153;
    __asm { fmul    st, st }
    HIWORD(v8) = HIWORD(v16);
    __asm { fcom    st(7) }
    if ( v16 < 0 != _OF )
      v12 = v27 + 1317;
    v17 = v12;
    if ( _OF )
      v17 = v10;
    LOWORD(v17) = v10 + _CF + (_WORD)v17;
    __asm { fcom    st(5) }
    LOWORD(v8) = -6490;
    if ( __SETP__(v17, 0) )
      v10 = v12;
    _CF = __CFADD__(__CFSHR__(v17, 96), v12);
    _OF = __OFADD__(__CFSHR__(v17, 96), v12);
    v19 = __CFSHR__(v17, 96) + v12;
    v18 = _CF | __CFADD__(v8, v19);
    _OF |= __OFADD__(v8, v19);
    v19 += v8;
    if ( !((v19 < 0) ^ _OF | (v19 == 0)) )
    {
      if ( !v18 )
        v19 = v8;
      ++v10;
    }
    v20 = v19 + 1;
    v21 = v10 + 1;
    LOWORD(v21) = v20 + v18 + v10 + 1;
    _ESI = v21 - 2138650637;
    v8 = ~v8;
    __asm
    {
      fsub    st(2), st
      rep add edi, 4
    }
    if ( !_OF )
      --v20;
    __asm { fsubr   st(7), st }
    HIWORD(_ESI) ^= HIWORD(v10);
    v9 = ~v20;
    if ( (int)_EDI >= v27 + 1317 )
    {
      v25 = 4 * v10;
      if ( (v25 < 0) ^ _OF | (v25 == 0) )
        v9 = v8;
      if ( v25 < 0 )
        v9 = v8;
      v26 = v9 - 1;
      if ( v8 == 1 )
      {
        if ( v26 )
          JUMPOUT(0xDF7489FC);
      }
      JUMPOUT(0x42A58BCC);
    }
  }
}
// 4041C5: positive sp value 4 has been found
// 4041D9: inconsistent fpu stack
// 4042E5: control flows out of bounds to 42A58BCC
// 404315: control flows out of bounds to DF7489FC
// 4041CF: variable 'v27' is possibly undefined
// 4042D7: variable '_OF' is possibly undefined

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
