/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int a1, int a2, int a3);
void __fastcall sub_4010C0(int a1, int a2);
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// void __usercall __noreturn sub_4041C0(int a1@<ebx>, int a2@<esi>, double a3@<st7>, double a4@<st5>, double a5@<st1>, double a6@<st0>);

//-------------------------------------------------------------------------
// Data declarations

int dword_401000 = -678747787; // weak


//----- (0040106F) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  HMODULE v3; // eax
  int v4; // edx
  int v5; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  v3 = GetModuleHandleA(0);
  sub_4010C0((int)v3, v4);
  v5 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 10;
  *(_DWORD *)(a3 + 176) = v5;
  return 0;
}
// 40109E: variable 'v4' is possibly undefined

//----- (004010C0) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
void __fastcall sub_4010C0(int a1, int a2)
{
  int v2; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v2);
  dword_401000 = a2;
}
// 4010C8: write access to const memory at 401000 has been detected
// 401000: using guessed type int dword_401000;

//----- (004041C0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_4041C0(int a1@<ebx>, int a2@<esi>, double a3@<st7>, double a4@<st5>, double a5@<st1>, double a6@<st0>)
{
  double v8; // st6
  int v9; // ebx
  int v10; // ecx
  int v11; // eax
  double v13; // st0
  int v14; // ecx
  int v15; // esi
  signed __int64 v18; // kr00_8
  int v19; // esi
  char v20; // cf
  int v21; // ecx
  int v22; // ecx
  int v23; // esi
  int v26; // eax
  int v27; // ecx
  int v28; // [esp-4h] [ebp-4h]

  _ESI = __ROL4__(a2, 67) - (__CFSHL__(a2, 67) - 562809190);
  _EDI = (_DWORD *)(v28 + 352);
  LOWORD(a1) = 558;
  v9 = a1 + 168158329;
  v8 = a5 - a3;
  LOWORD(v9) = -31733;
  v10 = v9;
  v11 = v9;
  __asm { rcr     esi, 0F0h }
  while ( 1 )
  {
    v13 = a3 - a3;
    LOWORD(_ESI) = v10 ^ 0x3E10;
    LOWORD(v10) = v9 + v10;
    v14 = v10 + 1;
    v15 = -(v11 + _ESI);
    v8 = v8 + v13;
    _CF = __PAIR64__(v15, *_EDI) < 0xDD849CC000E0E2E9ui64;
    _OF = __OFSUB__(__PAIR64__(v15, *_EDI), 0xDD849CC000E0E2E9ui64);
    v18 = __PAIR64__(v15, *_EDI) + 0x227B633FFF1F1D17i64;
    *_EDI -= 14738153;
    a3 = v13 * v13;
    HIWORD(v9) = HIWORD(v18);
    if ( v18 < 0 != _OF )
      v14 = v28 + 1317;
    v19 = v14;
    if ( _OF )
      v19 = v11;
    LOWORD(v19) = v11 + _CF + (_WORD)v19;
    LOWORD(v9) = -6490;
    if ( __SETP__(v19, 0) )
      v11 = v14;
    _CF = __CFADD__(__CFSHR__(v19, 96), v14);
    _OF = __OFADD__(__CFSHR__(v19, 96), v14);
    v21 = __CFSHR__(v19, 96) + v14;
    v20 = _CF | __CFADD__(v9, v21);
    _OF |= __OFADD__(v9, v21);
    v21 += v9;
    if ( !((v21 < 0) ^ _OF | (v21 == 0)) )
    {
      if ( !v20 )
        v21 = v9;
      ++v11;
    }
    v22 = v21 + 1;
    v23 = v11 + 1;
    LOWORD(v23) = v22 + v20 + v11 + 1;
    _ESI = v23 - 2138650637;
    v9 = ~v9;
    a4 = a4 - a3;
    __asm { rep add edi, 4 }
    if ( !_OF )
      --v22;
    a6 = a3 - a6;
    HIWORD(_ESI) ^= HIWORD(v11);
    v10 = ~v22;
    if ( (int)_EDI >= v28 + 1317 )
    {
      v26 = 4 * v11;
      if ( (v26 < 0) ^ _OF | (v26 == 0) )
        v10 = v9;
      if ( v26 < 0 )
        v10 = v9;
      v27 = v10 - 1;
      if ( v9 == 1 )
      {
        if ( v27 )
          JUMPOUT(0xDF7489FC);
      }
      JUMPOUT(0x42A58BCC);
    }
  }
}
// 4041C5: positive sp value 4 has been found
// 4042E5: control flows out of bounds to 42A58BCC
// 404315: control flows out of bounds to DF7489FC
// 4041CF: variable 'v28' is possibly undefined
// 4042D7: variable '_OF' is possibly undefined

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
