/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

_DWORD sub_401024(); // weak
// void __usercall sub_401064(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>);
void sub_40107A();
// void __usercall sub_4010DC(int a1@<ecx>, int a2@<edi>, int a3@<esi>, int a4@<eax>, int a5@<ebx>);
// void __usercall sub_4010FB(int a1@<edx>, int a2@<ebx>, int a3@<edi>, int a4@<esi>);
// void __usercall sub_40113A(__int32 a1@<eax>);
// void __usercall sub_401152(int a1@<edx>, int a2@<ecx>, __int32 a3@<ebx>, int a4@<esi>);
// void __usercall sub_4011A6(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>);
// void __usercall start(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<edi>, int a5@<esi>);
// int __usercall sub_40123C@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>);
int sub_40128A();
// void __usercall sub_4012C8(int a1@<ecx>, __int16 a2@<dx>, int a3@<edi>);
// void __usercall sub_4012E0(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<edi>);
// int __usercall sub_401339@<eax>(int result@<eax>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>);
// void __usercall sub_4013AA(char a1@<al>, int a2@<ecx>, char a3@<bl>);
int __thiscall sub_4013FF(char *this);
// int __userpurge sub_401436@<eax>(int a1@<ecx>, int a2@<edi>, int a3@<esi>, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
void sub_40146C();
// int __usercall sub_401485@<eax>(int a1@<eax>, int a2@<ecx>);
// void __usercall sub_4014A9(int a1@<edx>, int a2@<ecx>, int a3@<edi>);
// void __usercall sub_4014F8(__int32 a1@<eax>, int a2@<ebx>);
// void __usercall sub_40150E(int a1@<eax>, int a2@<edx>, int a3@<ebx>);
// void __usercall sub_4015B2(__int32 a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>);
void __fastcall sub_401623(int a1, int a2);
void sub_401670();
void sub_40170D();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401006; // weak
_UNKNOWN loc_401041; // weak
_UNKNOWN loc_4010A5; // weak
_UNKNOWN loc_40111B; // weak
_UNKNOWN loc_40116F; // weak
_UNKNOWN loc_401185; // weak
_UNKNOWN loc_4011D9; // weak
_UNKNOWN loc_401209; // weak
_UNKNOWN loc_401221; // weak
_UNKNOWN loc_4012A4; // weak
_UNKNOWN loc_40131C; // weak
_UNKNOWN loc_4013BF; // weak
_UNKNOWN loc_4014C2; // weak
_UNKNOWN loc_40155F; // weak
_UNKNOWN loc_40157B; // weak
_UNKNOWN loc_4015D1; // weak
_UNKNOWN loc_4015EA; // weak
_UNKNOWN loc_401638; // weak
_UNKNOWN loc_401681; // weak
_UNKNOWN loc_40172B; // weak


//----- (00401024) --------------------------------------------------------
#error "4016BB: cannot convert to microcode (funcsize=37)"

//----- (00401064) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401064(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>)
{
  char v4; // zf

  sub_4014A9(a2 | a1, a3, a4);
  if ( v4 )
    JUMPOUT(0x401060);
  sub_40107A();
}
// 401068: positive sp value 4 has been found
// 401076: control flows out of bounds to 401060
// 401078: control flows out of bounds to 401062
// 401076: variable 'v4' is possibly undefined

//----- (0040107A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40107A()
{
  __asm { repne pop ecx }
  JUMPOUT(0x401745);
}
// 401081: positive sp value 4 has been found
// 40108A: control flows out of bounds to 401745

//----- (004010DC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4010DC(int a1@<ecx>, int a2@<edi>, int a3@<esi>, int a4@<eax>, int a5@<ebx>)
{
  int v5; // ecx
  int v6; // edi
  int v7; // esi
  char v8; // zf
  int v9; // edx
  void *v10; // [esp+14h] [ebp-4h]
  void *retaddr; // [esp+18h] [ebp+0h]

  *(&retaddr - 7) = v10;
  v5 = a3 ^ a1;
  v6 = a3 + a2;
  v7 = a3 - a4;
  ((void (__fastcall *)(int, int))((char *)&loc_40116F + 1))(v5 + 1, ((v5 + 1) ^ v6) - v6);
  if ( v8 )
    JUMPOUT(0x4010F5);
  MEMORY[0x75291020]();
  sub_4010FB(v9, a5, v6, v7);
}
// 4010E0: positive sp value 4 has been found
// 4010F4: control flows out of bounds to 4010F5
// 4010F4: variable 'v8' is possibly undefined
// 4010F7: variable 'v9' is possibly undefined

//----- (004010FB) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4010FB(int a1@<edx>, int a2@<ebx>, int a3@<edi>, int a4@<esi>)
{
  int v4; // ebx
  int v5; // ecx
  char v6; // zf
  int v7; // edx
  int v8; // [esp-4h] [ebp-4h]

  v4 = a3 | a2;
  BYTE1(v4) = 63;
  sub_401623(v4, a1);
  if ( !v6 )
    JUMPOUT(0x401120);
  ((void (__thiscall *)(int))((char *)&loc_401638 + 4))(v8 | v5);
  if ( !v6 )
    JUMPOUT(0x401150);
  ((void (__fastcall *)(int, int))loc_4011D9)(2074138129, a4 + v7);
  JUMPOUT(0x4011D4);
}
// 401140: positive sp value C has been found
// 40111B: control flows out of bounds to 401120
// 40114E: control flows out of bounds to 401150
// 4011CF: control flows out of bounds to 4011D4
// 401119: control flows out of bounds to 40111A
// 401117: variable 'v6' is possibly undefined
// 401147: variable 'v8' is possibly undefined
// 401147: variable 'v5' is possibly undefined
// 4011CB: variable 'v7' is possibly undefined

//----- (0040113A) --------------------------------------------------------
void __usercall sub_40113A(__int32 a1@<eax>)
{
  void *retaddr; // [esp+4h] [ebp+0h] BYREF

  _InterlockedExchange((volatile __int32 *)&retaddr, a1);
  JUMPOUT(0x40113E);
}
// 40113D: control flows out of bounds to 40113E

//----- (00401152) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401152(int a1@<edx>, int a2@<ecx>, __int32 a3@<ebx>, int a4@<esi>)
{
  int v5; // esi
  char v6; // zf
  __int32 v7; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v7, a3);
  __asm { repne pop ebx }
  v5 = a4 - 1;
  ((void (__thiscall *)(int))((char *)&loc_4013BF + 3))((v5 | _EBX) ^ v5 ^ (a1 + a2));
  if ( !v6 )
  {
    --*(_DWORD *)((v5 | _EBX) + 0x2BF42444);
    JUMPOUT(0x401175);
  }
  JUMPOUT(0x401169);
}
// 401157: positive sp value 4 has been found
// 40116F: control flows out of bounds to 401175
// 401168: control flows out of bounds to 401169
// 401168: variable 'v6' is possibly undefined

//----- (004011A6) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4011A6(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>)
{
  void *v5; // [esp+Ch] [ebp-4h]
  void *retaddr; // [esp+10h] [ebp+0h]

  *(&retaddr - 5) = v5;
  sub_401064(a1, a2, a5 | (a3 - 1), a4);
  MEMORY[0x902885E3]();
  JUMPOUT(0x4011BE);
}
// 4011AA: positive sp value 4 has been found
// 4011B9: control flows out of bounds to 4011BE

//----- (004011F4) --------------------------------------------------------
void __usercall start(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<edi>, int a5@<esi>)
{
  int v5; // eax
  int savedregs; // [esp+0h] [ebp+0h] BYREF

  sub_401152(a2, a2 + a3, ((a5 ^ a4) - 1) | a1, a5);
  MEMORY[0x464769B](*(_DWORD *)(v5 + 8 * (_DWORD)&savedregs + 37));
  JUMPOUT(0x40120E);
}
// 401209: control flows out of bounds to 40120E
// 401205: variable 'v5' is possibly undefined

//----- (0040123C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_40123C@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>)
{
  int v3; // eax
  int v4; // ecx
  char v5; // zf

  ((void (__fastcall *)(int, int))loc_4010A5)(a1 + a3 - 1, a2 - a1);
  v3 = MEMORY[0xD46456EA]();
  ((void (__thiscall *)(int))((char *)&loc_4015D1 + 3))(v3 | v4);
  if ( v5 )
    JUMPOUT(0x401296);
  return MEMORY[0x243C87E8]();
}
// 401240: positive sp value 4 has been found
// 40126F: control flows out of bounds to 401296
// 401267: variable 'v4' is possibly undefined
// 40126F: variable 'v5' is possibly undefined

//----- (0040128A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int sub_40128A()
{
  void *v1; // [esp+Ch] [ebp-4h]
  void *retaddr; // [esp+10h] [ebp+0h]

  *(&retaddr - 5) = v1;
  sub_40170D();
  return MEMORY[0x89747474]();
}
// 40128E: positive sp value 4 has been found

//----- (004012C8) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4012C8(int a1@<ecx>, __int16 a2@<dx>, int a3@<edi>)
{
  int v3; // eax
  int v4; // edx
  int v5; // ecx
  char v6; // zf
  char v7; // cf
  int v8; // eax
  int v9; // ecx
  int v10; // ebx
  int v11; // edi
  int v12; // esi
  int v13; // eax
  int v14; // ecx

  HIBYTE(a2) = a1;
  v3 = ((int (__fastcall *)(int, __int16))loc_401041)(a1, a2);
  if ( v6 )
  {
    ((void (__thiscall *)(int))((char *)&loc_40172B + 4))(v4);
    v8 = MEMORY[0x263FFB90]();
    if ( v6 )
      JUMPOUT(0x4012A5);
    LOBYTE(v8) = v7 + v8 + 36;
    v10 = v8;
    v11 = v9;
    v12 = 2 * v8;
    v13 = ((int (*)(void))((char *)&loc_40157B + 2))();
    if ( v6 )
      JUMPOUT(0x4013A8);
    sub_401339(v13 & 0xFF742574, v14, v10, v11, v12);
  }
  else
  {
    sub_4012E0(v3, v4, v5, a3);
  }
}
// 401323: positive sp value C has been found
// 40131C: control flows out of bounds to 4012A5
// 401332: control flows out of bounds to 4013A8
// 4012DC: variable 'v6' is possibly undefined
// 4012DF: variable 'v4' is possibly undefined
// 4012DF: variable 'v5' is possibly undefined
// 40131E: variable 'v7' is possibly undefined
// 401329: variable 'v9' is possibly undefined
// 401335: variable 'v14' is possibly undefined

//----- (004012E0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4012E0(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<edi>)
{
  char v4; // zf
  int v5; // [esp-F8E7h] [ebp-F907h]
  int v6[15928]; // [esp-F8E3h] [ebp-F903h]

  v6[-9] = v5;
  sub_401436(
    a1 ^ a3,
    a4 + 1,
    a2 - 1,
    *(_DWORD *)(a1 + 8),
    v6[0],
    v6[1],
    v6[2],
    v6[3],
    v6[4],
    v6[5],
    v6[6],
    v6[7],
    v6[8],
    v6[9],
    v6[10],
    v6[11],
    v6[12],
    v6[13],
    v6[14],
    v6[15],
    v6[16],
    v6[17],
    v6[18],
    v6[19],
    v6[20],
    v6[21],
    v6[22],
    v6[23],
    v6[24],
    v6[25],
    v6[26],
    v6[27],
    v6[28],
    v6[29],
    v6[30],
    v6[31],
    v6[32],
    v6[33],
    v6[34],
    v6[35],
    v6[36],
    v6[37],
    v6[38],
    v6[39],
    v6[40],
    v6[41],
    v6[42],
    v6[43],
    v6[44],
    v6[45],
    v6[46],
    v6[47],
    v6[48],
    v6[49],
    v6[50],
    v6[51],
    v6[52],
    v6[53],
    v6[54],
    v6[55],
    v6[56],
    v6[57],
    v6[58]);
  if ( !v4 )
  {
    MEMORY[0x34C7FBE9]();
    JUMPOUT(0x401301);
  }
  JUMPOUT(0x40131F);
}
// 4012F8: positive sp value F907 has been found
// 4012FC: control flows out of bounds to 401301
// 4012F8: control flows out of bounds to 40131F
// 4012F8: variable 'v4' is possibly undefined

//----- (00401339) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_401339@<eax>(int result@<eax>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>)
{
  int v6; // ecx
  char v7; // zf

  __asm { repne pop edx }
  v6 = a2 - (a3 + 1);
  if ( !result )
  {
    sub_4010DC(v6, a4, a5, 0, 0);
    if ( !v7 )
    {
      MEMORY[0x2484A33D]();
      JUMPOUT(0x401355);
    }
    JUMPOUT(0x401338);
  }
  return result;
}
// 40133E: positive sp value 4 has been found
// 401350: control flows out of bounds to 401355
// 40134E: control flows out of bounds to 401338
// 40134E: variable 'v7' is possibly undefined

//----- (004013AA) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4013AA(char a1@<al>, int a2@<ecx>, char a3@<bl>)
{
  void *v3; // [esp+28h] [ebp-4h]
  void *retaddr; // [esp+2Ch] [ebp+0h]

  *(&retaddr - 12) = v3;
  LOBYTE(a2) = a2 - a1;
  BYTE1(a2) += a3 + 1;
  ((void (__thiscall *)(int))loc_401185)(a2 + 1);
  MEMORY[0xE92888A7]();
  MEMORY[0x14C939C3]();
  JUMPOUT(0x4013C4);
}
// 4013AE: positive sp value 4 has been found
// 4013BF: control flows out of bounds to 4013C4

//----- (004013FF) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __thiscall sub_4013FF(char *this)
{
  ((void (__thiscall *)(char *))((char *)&loc_4012A4 + 5))(this + 1);
  return MEMORY[0x2525E825]();
}
// 401403: positive sp value 4 has been found

//----- (00401436) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
int __userpurge sub_401436@<eax>(int a1@<ecx>, int a2@<edi>, int a3@<esi>, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  int v64; // edi
  int v66; // eax
  int v67; // edx
  int v68; // ecx
  char v69; // zf
  int v71; // [esp+24h] [ebp-8h]
  int v72; // [esp+28h] [ebp-4h]
  void *retaddr[2]; // [esp+2Ch] [ebp+0h]

  *(&v72 - 12) = v71;
  v64 = a3 | a2;
  v66 = sub_40128A();
  if ( v69 )
  {
    ((void (__fastcall *)(int, int))((char *)&loc_401221 + 2))(v64 + (a1 | v68) - v66, v66 ^ v67);
    JUMPOUT(0x40147F);
  }
  MEMORY[0x2484A3C5]();
  *(_BYTE *)(a1 + 64893913) = __ROR1__(*(_BYTE *)(a1 + 64893913), 1);
  return MK_FP(retaddr[0], retaddr[0])();
}
// 401443: positive sp value 8 has been found
// 40147A: control flows out of bounds to 40147F
// 401457: bad sp value at call
// 40144A: variable 'v69' is possibly undefined
// 401471: variable 'v68' is possibly undefined
// 401478: variable 'v67' is possibly undefined
// 401436: too many input arguments, some ignored

//----- (0040146C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40146C()
{
  JUMPOUT(0x401471);
}
// 401470: positive sp value 4 has been found
// 401470: control flows out of bounds to 401471

//----- (00401485) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_401485@<eax>(int a1@<eax>, int a2@<ecx>)
{
  void *v3; // [esp+1Ch] [ebp-4h]
  void *retaddr; // [esp+20h] [ebp+0h]

  *(&retaddr - 9) = v3;
  ((void (__thiscall *)(int, _DWORD))((char *)&loc_40111B + 4))(a1 ^ a2, *(_DWORD *)(a1 + 48));
  return MEMORY[0xE8E825FF]();
}
// 401489: positive sp value 4 has been found

//----- (004014A9) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4014A9(int a1@<edx>, int a2@<ecx>, int a3@<edi>)
{
  ((void (__fastcall *)(int, int))((char *)&loc_401681 + 4))(a3 | a2, (a3 | a2) ^ a2 ^ a1);
  MEMORY[0x24A4A2C6]();
  JUMPOUT(0x4014C7);
}
// 4014AD: positive sp value 4 has been found
// 4014C2: control flows out of bounds to 4014C7

//----- (004014F8) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4014F8(__int32 a1@<eax>, int a2@<ebx>)
{
  __int64 v3; // rax
  __int32 v4; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v4, a1);
  __asm { rep pop eax }
  ((void (*)(void))((char *)&loc_40155F + 1))();
  v3 = MEMORY[0x74653B0D]();
  sub_40150E(v3, SHIDWORD(v3), a2);
}
// 4014FF: positive sp value 4 has been found

//----- (0040150E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40150E(int a1@<eax>, int a2@<edx>, int a3@<ebx>)
{
  int v3; // ecx
  char v4; // zf
  int v5; // [esp+18h] [ebp-8h]
  int v6; // [esp+1Ch] [ebp-4h]

  ((void (__fastcall *)(int, int))((char *)&loc_40131C + 1))(a1, a3 + a2 + 1);
  if ( !v4 )
  {
    *(&v6 - 10) = v5;
    ((void (__thiscall *)(int))((char *)&loc_401209 + 1))(v3 + 1);
    MEMORY[0x263F3B40]();
    MEMORY[0x64CDFDBA]();
    JUMPOUT(0x401546);
  }
  JUMPOUT(0x401521);
}
// 40152C: positive sp value C has been found
// 401541: control flows out of bounds to 401546
// 401520: control flows out of bounds to 401521
// 401520: variable 'v4' is possibly undefined
// 401534: variable 'v3' is possibly undefined

//----- (004015B2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4015B2(__int32 a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  __int32 v6; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v6, a1);
  sub_4011A6((a5 - (v6 ^ a4)) ^ ((a5 | a2) - a4), a3, (v6 ^ a4) - 1, a5 - (v6 ^ a4), a6);
  MEMORY[0x2628FED0]();
  JUMPOUT(0x4015D6);
}
// 4015BA: positive sp value 4 has been found
// 4015D1: control flows out of bounds to 4015D6

//----- (00401623) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_401623(int a1, int a2)
{
  void *v2; // [esp+1Ch] [ebp-4h]
  void *retaddr; // [esp+20h] [ebp+0h]

  *(&retaddr - 9) = v2;
  LOBYTE(a1) = BYTE1(a2);
  ((void (__thiscall *)(int))((char *)&loc_4014C2 + 2))(a2 + a1);
  MEMORY[0x87B51625]();
  JUMPOUT(0x40163D);
}
// 401627: positive sp value 4 has been found
// 401638: control flows out of bounds to 40163D

//----- (00401670) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401670()
{
  ((void (*)(void))loc_401006)();
  MEMORY[0x8DB43C85]();
  JUMPOUT(0x401686);
}
// 401674: positive sp value 4 has been found
// 401681: control flows out of bounds to 401686

//----- (0040170D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40170D()
{
  char v0; // zf

  ((void (*)(void))loc_4015EA)();
  if ( !v0 )
    JUMPOUT(0x401730);
  JUMPOUT(0x40172A);
}
// 401711: positive sp value 4 has been found
// 40172B: control flows out of bounds to 401730
// 401729: control flows out of bounds to 40172A
// 401729: variable 'v0' is possibly undefined

// nfuncs=26 queued=26 decompiled=26 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 26 function(s)"
