// subject_data.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

CHAR g_t406288 = 'k'; // 00406288
CHAR g_t406298 = 'M'; // 00406298
CHAR g_t4062A8 = 'U'; // 004062A8
CHAR g_t4062B8 = 'C'; // 004062B8
CHAR g_t4062CC = 'V'; // 004062CC
CHAR g_t4062DC = 'L'; // 004062DC
CHAR g_t4062EC = 'V'; // 004062EC
CHAR g_t4062F8 = 'V'; // 004062F8
CHAR g_t406308 = 'k'; // 00406308
CHAR g_t406318 = 'U'; // 00406318
CHAR g_t406328 = 'a'; // 00406328
Eq_2 g_t406334 = // 00406334
	{
		0x00
	};
Eq_2 g_t40633C = // 0040633C
	{
		0x00
	};
struct Eq_648 * g_ptr406350 = null; // 00406350
Eq_304 g_t406358 = // 00406358
	{
		0
	};
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__RegOpenKeyA = &g_t1A78; // 00401000
<anonymous> * __imp__VirtualAlloc = &g_t1A1C; // 00401008
<anonymous> * __imp__MapViewOfFileEx = &g_t1A2C; // 0040100C
<anonymous> * __imp__GetProcAddress = &g_t19FC; // 00401010
<anonymous> * __imp__UnmapViewOfFile = &g_t1A4C; // 00401014
<anonymous> * __imp__lstrcpyA = &g_t1A5E; // 00401018
<anonymous> * __imp__VirtualFree = &g_t1A3E; // 0040101C
<anonymous> * __imp__CloseHandle = &g_t1A0E; // 00401020
<anonymous> * __imp__GetModuleHandleA = &g_t19E8; // 00401024
// 00401030: void fn00401030(Stack Eq_2 dwArg04, Stack Eq_2 dwArg08, Stack Eq_2 dwArg0C)
// Called from:
//      fn004012B0
//      fn00401660
void fn00401030(Eq_2 dwArg04, Eq_2 dwArg08, Eq_2 dwArg0C)
{
	g_t40633C.u0 = 0x00;
	while (g_t40633C.u0 < dwArg0C)
	{
		*((word32) dwArg04 + g_t40633C.u0) = *((word32) dwArg08 + g_t40633C.u0);
		g_t40633C.u0 = (DWORD) (g_t40633C.u0 + 0x01);
	}
}

// 004010D0: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
}

// 00401290: void fn00401290(Stack Eq_21 dwArg04, Stack Eq_22 dwArg08)
// Called from:
//      fn004012B0
void fn00401290(Eq_21 dwArg04, Eq_22 dwArg08)
{
	GetProcAddress(dwArg04, dwArg08);
}

// 004012B0: void fn004012B0(Stack Eq_2 dwArg04)
// Called from:
//      Win32CrtStartup
void fn004012B0(Eq_2 dwArg04)
{
	ptr32 fp;
	Eq_21 eax_11 = GetModuleHandleA(&g_t406288);
	Eq_27 eax_19 = GetProcAddress(eax_11, &g_t406298);
	GetProcAddress(eax_11, &g_t4062A8);
	Eq_27 eax_35 = GetProcAddress(eax_11, &g_t4062B8);
	Eq_27 eax_43 = GetProcAddress(eax_11, &g_t4062CC);
	Eq_27 eax_51 = GetProcAddress(eax_11, &g_t4062DC);
	GetProcAddress(eax_11, &g_t4062EC);
	word32 edx_66 = dwArg04 + Mem63[dwArg04 + 60:word32];
	struct Eq_81 * dwLoc30_487 = &edx_66->w0014 + 2 + (word32) edx_66->w0014 / 64;
	Eq_2 eax_85 = eax_43();
	fn00401030(eax_85, dwArg04, (word32) *((word32) dwArg04 + 60) + 312 + (word32) edx_66->w0006 *s 0x28);
	up32 dwLoc10_493;
	for (dwLoc10_493 = 0x00; dwLoc10_493 < (word32) edx_66->w0006; ++dwLoc10_493)
	{
		if (dwLoc30_487->dw0014 != 0x00 && dwLoc30_487->dw0010 != 0x00)
			fn00401030((char *) eax_85.u1 + dwLoc30_487->dw000C, (char *) dwArg04.u1 + dwLoc30_487->dw0014, (uint32) ((uint64) (dwLoc30_487->dw0010 - 1 + (edx_66->t003C).u0) /u (edx_66->t003C).u0) *s (edx_66->t003C).u0);
		++dwLoc30_487;
	}
	word32 ecx_124 = eax_85 + Mem121[eax_85 + 60:word32];
	Eq_2 eax_144 = eax_35();
	struct Eq_120 * esp_143 = fp - 0x84;
	struct Eq_123 * dwLoc5C_501 = (char *) eax_85.u1 + ecx_124->dw0080;
	while (dwLoc5C_501->dw0010 != 0x00)
	{
		word32 * dwLoc3C_520;
		ui32 * dwLoc2C_519;
		struct Eq_120 * esp_302 = esp_143 - 4;
		esp_302->ptr0000 = (char *) eax_85.u1 + dwLoc5C_501->dw000C;
		Eq_21 eax_305 = eax_51();
		if (dwLoc5C_501->dw0000 != 0x00)
		{
			dwLoc2C_519 = (ui32 *) ((char *) eax_85.u1 + dwLoc5C_501->dw0000);
			dwLoc3C_520 = (word32 *) ((char *) eax_85.u1 + dwLoc5C_501->dw0010);
		}
		else
		{
			dwLoc2C_519 = (ui32 *) ((char *) eax_85.u1 + dwLoc5C_501->dw0010);
			dwLoc3C_520 = (word32 *) ((char *) eax_85.u1 + dwLoc5C_501->dw0000);
		}
		word32 dwLoc1C_523 = 0x00;
		if (dwLoc5C_501->dw0010 != 0x00 && dwLoc5C_501->dw0000 != 0x00)
			dwLoc1C_523 = 0x01;
		while (true)
		{
			esp_143 = esp_302;
			if (*dwLoc2C_519 == 0x00)
				break;
			if ((*dwLoc2C_519 & 0x80000000) != 0x00)
			{
				ui32 eax_373 = *dwLoc2C_519;
				esp_302->tFFFFFFFC = eax_373 & 0x7FFFFFFF;
				esp_302->tFFFFFFF8 = eax_305;
				fn00401290(esp_302->tFFFFFFF8, esp_302->tFFFFFFFC);
				*dwLoc2C_519 = eax_373 & 0x7FFFFFFF;
			}
			else
			{
				Eq_22 eax_360 = (char *) eax_85.u1 + (*dwLoc2C_519 + 2);
				esp_302->tFFFFFFFC = eax_360;
				esp_302->tFFFFFFF8 = eax_305;
				fn00401290(esp_302->tFFFFFFF8, esp_302->tFFFFFFFC);
				*dwLoc2C_519 = (ui32) eax_360;
			}
			if (dwLoc1C_523 != 0x00)
				*dwLoc3C_520 = *dwLoc2C_519;
			++dwLoc2C_519;
			++dwLoc3C_520;
		}
		++dwLoc5C_501;
	}
	struct Eq_169 * esp_163 = esp_143 - 4;
	esp_163->t0000.u0 = ecx_124->t0034.u0;
	esp_163->dwFFFFFFFC = 0x00;
	esp_163->dwFFFFFFF8 = 0x00;
	esp_163->dwFFFFFFF4 = 0x00;
	esp_163->dwFFFFFFF0 = 0x22;
	esp_163->tFFFFFFEC.u0 = (DWORD) eax_144;
	g_t406334.u0 = (DWORD) eax_19();
	if (g_t406334.u0 == 0x00)
	{
		esp_163->tFFFFFFE8.u0 = ecx_124->t0034.u0;
		if (UnmapViewOfFile(esp_163->tFFFFFFE8.u0) == 0x00)
		{
			esp_163->tFFFFFFE8.u0 = 0x8000;
			esp_163->tFFFFFFE4.u0 = 0x00;
			esp_163->tFFFFFFE0.u0 = ecx_124->t0034.u0;
			if (VirtualFree(esp_163->tFFFFFFE0.u0, esp_163->tFFFFFFE4.u0, esp_163->tFFFFFFE8.u0) == 0x00)
				return;
		}
		esp_163->tFFFFFFE8.u0 = ecx_124->t0034.u0;
		esp_163->tFFFFFFE4.u0 = 0x00;
		esp_163->tFFFFFFE0.u0 = 0x00;
		esp_163->tFFFFFFDC.u0 = 0x00;
		esp_163->tFFFFFFD8.u0 = 0x22;
		esp_163->tFFFFFFD4.u0 = (DWORD) eax_144;
		g_t406334.u0 = (DWORD) MapViewOfFileEx(esp_163->tFFFFFFD4.u0, esp_163->tFFFFFFD8.u0, esp_163->tFFFFFFDC.u0, esp_163->tFFFFFFE0.u0, esp_163->tFFFFFFE4.u0, esp_163->tFFFFFFE8.u0);
		if (g_t406334.u0 == 0x00)
		{
			esp_163->tFFFFFFE8.u0 = 0x40;
			esp_163->tFFFFFFE4.u0 = 0x3000;
			esp_163->tFFFFFFE0.u0 = ecx_124->t0050.u0;
			esp_163->tFFFFFFDC.u0 = ecx_124->t0034.u0;
			g_t406334.u0 = (DWORD) VirtualAlloc(esp_163->tFFFFFFDC.u0, esp_163->tFFFFFFE0.u0, esp_163->tFFFFFFE4.u0, esp_163->tFFFFFFE8.u0);
		}
	}
	esp_163->tFFFFFFE8.u0 = (DWORD) eax_144;
	CloseHandle(esp_163->tFFFFFFE8.u0);
	esp_163->tFFFFFFE8.u0 = ecx_124->t0050.u0;
	esp_163->tFFFFFFE4.u0 = (DWORD) eax_85;
	esp_163->tFFFFFFE0.u0 = g_t406334.u0;
	fn00401030(esp_163->tFFFFFFE0.u0, esp_163->tFFFFFFE4.u0, esp_163->tFFFFFFE8.u0);
	esp_163->tFFFFFFE8.u0 = g_t406334.u0;
	fn004017C0(esp_163->tFFFFFFE8.u0);
	g_t406358.u0 = (int32) (g_t406334.u0 + (ecx_124->t0028).u0);
	ecx_124->t0028.u0 = g_t406358.u0;
}

// 00401630: void fn00401630(Stack Eq_2 dwArg04)
// Called from:
//      Win32CrtStartup
void fn00401630(Eq_2 dwArg04)
{
	VirtualAlloc(0x00, dwArg04, 0x3000, 0x04);
}

// 00401660: void fn00401660(Stack word32 dwArg04, Stack Eq_2 dwArg08)
// Called from:
//      Win32CrtStartup
void fn00401660(word32 dwArg04, Eq_2 dwArg08)
{
	word32 edx_16 = dwArg08 + Mem13[dwArg08 + 60:word32];
	g_t406334.u0 = (DWORD) GetProcAddress(GetModuleHandleA(&g_t406308), &g_t4062F8)();
	if (g_t406334.u0 == 0x00)
		return;
	fn00401030(g_t406334.u0, dwArg08, edx_16->t0050.u0);
	int32 eax_66 = g_t406334.u0 - dwArg08;
	if (edx_16->dw00A4 != 0x00)
	{
		struct Eq_582 * dwLoc0C_173 = (char *) dwArg08.u1 + edx_16->dw00A0;
		while (dwLoc0C_173->t0004.u0 != 0x00)
		{
			uint32 eax_101 = dwLoc0C_173->t0004.u0 - 0x08 >> 0x01;
			word16 dwLoc20_179[] = (char *) &dwLoc0C_173->t0004 + 4;
			uint32 dwLoc08_180;
			for (dwLoc08_180 = 0x00; dwLoc08_180 < eax_101; ++dwLoc08_180)
			{
				if ((word32) dwLoc20_179[dwLoc08_180] >> 0x0C == 0x03)
					(g_t406334.u0 + dwLoc0C_173->dw0000)[((word32) dwLoc20_179[dwLoc08_180] & 0x0FFF) / 4].b0000 = (byte) ((g_t406334.u0 + dwLoc0C_173->dw0000)[((word32) dwLoc20_179[dwLoc08_180] & 0x0FFF) / 4] + eax_66);
			}
			dwLoc0C_173 += dwLoc0C_173->t0004.u0 / 8;
		}
	}
	<anonymous> * edx_84 = dwArg04 + g_t406334.u0;
	edx_84();
}

// 004017C0: void fn004017C0(Stack Eq_2 dwArg04)
// Called from:
//      fn004012B0
void fn004017C0(Eq_2 dwArg04)
{
	g_ptr406350->ptr0030->t0008.u0 = (DWORD) dwArg04;
}

// 004017F0: void fn004017F0(Stack (ptr32 byte) dwArg04, Stack (arr byte) dwArg08, Stack Eq_657 dwArg0C)
// Called from:
//      Win32CrtStartup
void fn004017F0(byte * dwArg04, byte dwArg08[], Eq_657 dwArg0C)
{
	Eq_658 tLoc94;
	Eq_659 tLoc20;
	Eq_660 tLoc10;
	byte cl_12 = *dwArg04;
	lstrcpyA(&tLoc94, &g_t406328);
	Eq_657 dwLoc0C_137 = 0x01;
	int32 dwLoc18_142 = 0x00;
	do
	{
		byte cl_26 = Mem23[dwArg04 + dwLoc0C_137:byte];
		dwLoc0C_137 = (word32) dwLoc0C_137 + 1;
		if ((word32) cl_26 == (word32) cl_12)
		{
			if ((word32) dwArg04[(word32) dwLoc0C_137 + 1] == 0x00)
			{
				dwArg08[dwLoc18_142] = cl_12;
				++dwLoc18_142;
				dwLoc0C_137 = (word32) dwLoc0C_137 + 2;
			}
			else
			{
				int32 eax_67 = fn00401910(&tLoc10, dwArg04 + ((word32) dwLoc0C_137 + 1)) + ((word32) dwLoc0C_137 + 1);
				dwLoc0C_137 = fn00401910(&tLoc20, dwArg04 + eax_67) + eax_67;
				up32 dwLoc1C_157;
				for (dwLoc1C_157 = 0x00; dwLoc1C_157 < tLoc10; ++dwLoc1C_157)
				{
					dwArg08[dwLoc18_142] = dwArg08[dwLoc18_142 - tLoc20];
					++dwLoc18_142;
				}
			}
		}
		else
		{
			dwArg08[dwLoc18_142] = cl_26;
			++dwLoc18_142;
		}
	} while (dwLoc0C_137 < dwArg0C);
}

// 00401910: Register word32 fn00401910(Stack (ptr32 ui32) dwArg04, Stack (ptr32 byte) dwArg08)
// Called from:
//      fn004017F0
word32 fn00401910(ui32 * dwArg04, byte * dwArg08)
{
	Eq_658 tLoc84;
	lstrcpyA(&tLoc84, &g_t406318);
	ui32 dwLoc08_52 = 0x00;
	word32 dwLoc10_53 = 0x00;
	do
	{
		ui32 edx_22 = (word32) *dwArg08;
		ui32 edx_32 = edx_22 & 0x7F | dwLoc08_52 << 0x07;
		++dwArg08;
		dwLoc08_52 = edx_32;
		++dwLoc10_53;
	} while ((edx_22 & 0x80) != 0x00);
	*dwArg04 = edx_32;
	return dwLoc10_53;
}

word32 g_dw4019BC = 6776; // 004019BC
word32 g_dw4019C4 = 0x1A1C; // 004019C4
word32 g_dw4019C8 = 6700; // 004019C8
word32 g_dw4019CC = 6652; // 004019CC
word32 g_dw4019D0 = 0x1A4C; // 004019D0
word32 g_dw4019D4 = 0x1A5E; // 004019D4
word32 g_dw4019D8 = 0x1A3E; // 004019D8
word32 g_dw4019DC = 6670; // 004019DC
word32 g_dw4019E0 = 6632; // 004019E0
