/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

_DWORD __cdecl sub_401007(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, __int16); // weak
// int __usercall sub_4010E2@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<esi>);
// void __usercall sub_40111B(_BYTE *a1@<eax>, int a2@<ebx>);
// void __usercall sub_40112F(int a1@<ecx>, int a2@<ebx>);
// void __usercall sub_401224(int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4@<esi>);
void sub_401243();
_DWORD sub_4012C2(); // weak
_DWORD sub_401312(); // weak
// void __usercall sub_401378(void **a1@<eax>);
void start();
// double __userpurge sub_4021EB@<st0>(int a1@<edx>, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
double sub_402250(); // weak
_DWORD sub_4022B7(); // weak
_DWORD __far sub_4022F8(); // weak
// void __usercall sub_40232C(__int32 a1@<ecx>, _BYTE *a2@<ebx>, int *a3@<edi>);
// int __userpurge sub_402351@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<esi>, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
// void __usercall sub_4023DD(int a1@<eax>, char a2@<dl>, __int16 a3@<di>);
double sub_40249E(); // weak
void sub_4025D8();
void __fastcall sub_4025FC(int a1, int a2);
void __thiscall sub_40269D(void *this);
_DWORD sub_4027B1(); // weak
int sub_4027D7();
_DWORD sub_4027F4(); // weak
// void __usercall sub_402858(__int32 a1@<esi>);
void sub_402A29();
void sub_402D1D();
void sub_402E31();
void sub_402EC8();
void sub_402F51();
void sub_402FB1();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_4010AF; // weak
_UNKNOWN loc_40245C; // weak
_UNKNOWN sub_40255E; // weak
_UNKNOWN loc_40261C; // weak
_UNKNOWN loc_402786; // weak
_UNKNOWN loc_402991; // weak
_UNKNOWN loc_402C65; // weak


//----- (00401007) --------------------------------------------------------
#error "40150A: cannot convert to microcode (funcsize=61)"

//----- (004010E2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4010E2@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<esi>)
{
  int v5; // ebx
  int v6; // edx
  bool v7; // cf
  int v8; // ecx

  BYTE1(a2) -= __CFADD__(a1, a4) + 89;
  v5 = a1 + a4 - a3;
  BYTE1(a3) = -BYTE1(a3);
  v6 = v5 ^ (a2 - v5);
  v7 = __CFADD__(BYTE1(v6), -103);
  BYTE1(v6) -= 103;
  LOBYTE(a3) = ~(_BYTE)a3;
  LOBYTE(v5) = v5 - (v7 + 5);
  ++v5;
  LOBYTE(v5) = BYTE1(v5);
  ((void (__fastcall *)(int, int))sub_401312)(a3, v5 + v6);
  *(_DWORD *)(a5 - 1645194491) |= v8;
  return sub_401312();
}
// 4010E6: positive sp value 4 has been found
// 40130C: variable 'v8' is possibly undefined
// 401312: using guessed type _DWORD sub_401312();

//----- (0040111B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40111B(_BYTE *a1@<eax>, int a2@<ebx>)
{
  int v3; // eax
  int v4; // ecx
  char v5; // zf

  v3 = ((int (*)(void))((char *)&loc_4010AF + 1))();
  __outdword(0x24u, v3);
  if ( v5 )
  {
    *a1 = v3;
    JUMPOUT(0x401147);
  }
  sub_40112F(v4, a2);
}
// 4011A3: positive sp value C has been found
// 4011AC: control flows out of bounds to 401147
// 40112D: variable 'v5' is possibly undefined
// 40112E: variable 'v4' is possibly undefined

//----- (0040112F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40112F(int a1@<ecx>, int a2@<ebx>)
{
  int v2; // [esp-4h] [ebp-4h]

  ((void (__fastcall *)(int, int, _DWORD))sub_4012C2)(
    (v2 ^ (a1 - 4)) - ((a1 | a2) - 2),
    v2 ^ (a1 - 4) | a1 | a2,
    *(_DWORD *)(v2 + 48));
  JUMPOUT(0x401118);
}
// 401101: positive sp value 8 has been found
// 401117: control flows out of bounds to 401118
// 401102: variable 'v2' is possibly undefined
// 4012C2: using guessed type _DWORD sub_4012C2();

//----- (00401224) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401224(int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4@<esi>)
{
  unsigned int v4; // kr00_4
  unsigned int v5; // [esp+10h] [ebp-8h]
  struct _TEB *v6; // [esp+14h] [ebp-4h]
  void *retaddr; // [esp+18h] [ebp+0h]

  *(&retaddr - 7) = v6;
  v6 = NtCurrentTeb();
  sub_40112F(a1 - (a1 ^ (a4 | (a1 | (a2 + 2)) ^ (a3 - a4))), (a1 + a4) | a1 | (a2 + 2));
  v4 = __readeflags();
  v5 = v4;
  JUMPOUT(0x401282);
}
// 401228: positive sp value 4 has been found
// 40127F: control flows out of bounds to 401282

//----- (00401243) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401243()
{
  JUMPOUT(0x401482);
}
// 401247: positive sp value 4 has been found
// 40125C: control flows out of bounds to 401482

//----- (004012C2) --------------------------------------------------------
#error "4012EB: cannot convert to microcode (funcsize=21)"

//----- (00401312) --------------------------------------------------------
#error "401071: cannot convert to microcode (funcsize=31)"

//----- (00401378) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401378(void **a1@<eax>)
{
  void *v1; // [esp+24h] [ebp-4h]
  void *retaddr; // [esp+28h] [ebp+0h]

  *(&retaddr - 11) = v1;
  v1 = *a1;
  JUMPOUT(0x401345);
}
// 40137C: positive sp value 4 has been found
// 401388: control flows out of bounds to 401345

//----- (004013EB) --------------------------------------------------------
void start()
{
  JUMPOUT(0x40115C);
}
// 40103F: control flows out of bounds to 401040
// 401036: control flows out of bounds to 40115C
// 401404: conditional instruction was optimized away because of 'ebx.4!=0'

//----- (0040140E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40140E(int a1@<eax>)
{
  void *v1; // [esp+4h] [ebp-4h]
  void *retaddr; // [esp+8h] [ebp+0h]

  *(&retaddr - 3) = v1;
  v1 = *(void **)(a1 + 8);
  JUMPOUT(0x4012EA);
}
// 4012DD: positive sp value 4 has been found
// 401430: control flows out of bounds to 401436
// 4012E8: control flows out of bounds to 4012EA
// 40142E: control flows out of bounds to 401405
// 401428: conditional instruction was optimized away because of 'esi.4>=1'

//----- (004021EB) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
double __userpurge sub_4021EB@<st0>(int a1@<edx>, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  double v65; // st7
  int v66; // edx
  int v67; // eax

  __asm { rep pop ecx }
  BYTE1(a1) -= 2;
  v65 = ((double (__fastcall *)(int, int))sub_402250)(_ECX, a1);
  *(_BYTE *)(4 * v66 - 154599904) *= 2;
  return v65 + *(float *)(v67 + 726021596);
}
// 4021F0: positive sp value 4 has been found
// 4021FB: variable 'v66' is possibly undefined
// 402202: variable 'v67' is possibly undefined
// 4021EB: too many input arguments, some ignored
// 402250: using guessed type double sub_402250();

//----- (00402250) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402250(_BYTE *a1@<ebx>)
{
  unsigned int v1; // eax

  sub_402F51();
  LOBYTE(v1) = *(_BYTE *)(v1 + 172141776) & v1;
  __outdword(0x8Bu, v1);
  *a1 = __ROR1__(*a1, 1);
  __asm { lock neg dh }
  JUMPOUT(0x4025AE);
}
// 402257: positive sp value 4 has been found
// 402DD6: control flows out of bounds to 4025AE
// 402AB4: conditional instruction was optimized away because of 'dh.1!=0'
// 402A90: variable 'v1' is possibly undefined

//----- (004022B7) --------------------------------------------------------
#error "4022CD: cannot convert to microcode (funcsize=11)"

//----- (004022F8) --------------------------------------------------------
#error "4022F8: function frame is wrong (funcsize=0)"

//----- (0040232C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40232C(__int32 a1@<ecx>, _BYTE *a2@<ebx>, int *a3@<edi>)
{
  int v3; // eax
  char v4; // dl
  __int32 v5[2]; // [esp-8h] [ebp-8h] BYREF

  _InterlockedExchange(v5, a1);
  v3 = ((int (*)(void))((char *)&loc_40261C + 1))();
  *a2 += v4;
  if ( v5[1] == 1 )
  {
    *a3 = v3;
    JUMPOUT(0x40304B);
  }
  JUMPOUT(0x40309A);
}
// 403046: positive sp value 8 has been found
// 40304A: control flows out of bounds to 40304B
// 403046: control flows out of bounds to 40309A
// 403043: variable 'v4' is possibly undefined

//----- (00402351) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __userpurge sub_402351@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<esi>, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  void *v65; // [esp+24h] [ebp-4h]
  void *retaddr; // [esp+28h] [ebp+0h]

  *(&retaddr - 11) = v65;
  LOBYTE(a2) = -(char)a2;
  BYTE1(a1) = a2 | 0x23;
  return ((int (__fastcall *)(int, int))((char *)&loc_402991 + 1))(a4 | a2, a1 - ((a4 ^ a3) + 1));
}
// 402355: positive sp value 4 has been found
// 402351: too many input arguments, some ignored

//----- (004023DD) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4023DD(int a1@<eax>, char a2@<dl>, __int16 a3@<di>)
{
  char v5; // dl
  int v6; // edx
  char v7; // cl
  int v8; // ecx
  unsigned int v9; // kr00_4
  int v10; // [esp-4h] [ebp-8h]

  __asm { repne pop ecx }
  _DI = _ECX + a3;
  if ( !__SETP__(a2 | 0xED, 35) )
  {
    __asm { rep push di }
    if ( __SETP__(a2 | 0xED, 35) )
      JUMPOUT(0x40245F);
  }
  v10 = ((int (__cdecl *)(_DWORD))loc_402C65)(*(_DWORD *)(a1 + 16));
  LOBYTE(v6) = v5 - MEMORY[0x894E1F5A];
  LOBYTE(v8) = v7 - BYTE1(v8);
  ((void (__fastcall *)(int, int, int))sub_4027F4)(v8, v6, v10);
  v9 = __readeflags();
  JUMPOUT(0x402C40);
}
// 4023E2: positive sp value 4 has been found
// 40245C: control flows out of bounds to 40245F
// 402F2D: control flows out of bounds to 402C40
// 402F0E: variable 'v5' is possibly undefined
// 402F10: variable 'v7' is possibly undefined
// 402F10: variable 'v8' is possibly undefined
// 402F12: variable 'v6' is possibly undefined
// 4027F4: using guessed type _DWORD sub_4027F4();

//----- (0040249E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40249E()
{
  JUMPOUT(0x402171);
}
// 4024A2: positive sp value 4 has been found
// 4024AC: control flows out of bounds to 402171

//----- (0040253D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40253D(int a1@<eax>, int a2@<ecx>)
{
  void *v2; // [esp+4h] [ebp-4h]
  void *retaddr; // [esp+8h] [ebp+0h]

  *(&retaddr - 3) = v2;
  if ( !a1 )
  {
    if ( !__OFADD__(*(_DWORD *)(a2 + 60), a2) && __OFADD__(*(_DWORD *)(a2 + 60), a2) )
    {
      __asm { iret }
      JUMPOUT(0x402893);
    }
    JUMPOUT(0x402A11);
  }
  JUMPOUT(0x402AE1);
}
// 402541: positive sp value 4 has been found
// 402892: control flows out of bounds to 402893
// 4026C8: control flows out of bounds to 402AE1
// 402884: control flows out of bounds to 402A11

//----- (0040255E) --------------------------------------------------------
#error "40255E: function frame is wrong (funcsize=0)"

//----- (004025D8) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4025D8()
{
  JUMPOUT(0x4025E0);
}
// 4025DC: positive sp value 4 has been found
// 4025DE: control flows out of bounds to 4025E0

//----- (004025FC) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_4025FC(int a1, int a2)
{
  int v2; // [esp-545Ch] [ebp-5464h]
  int v3; // [esp-5458h] [ebp-5460h]

  *(&v3 - 3) = v2;
  ((void (__thiscall *)(int))sub_40255E)(a1 + a2);
  JUMPOUT(0x402621);
}
// 402617: positive sp value 5464 has been found
// 40261C: control flows out of bounds to 402621
// 402612: bad sp value at call

//----- (0040269D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __thiscall sub_40269D(void *this)
{
  __int32 v2; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v2, (__int32)this);
  __asm { repne pop ecx }
  JUMPOUT(0x4023F7);
}
// 4026A2: positive sp value 4 has been found
// 4026C0: control flows out of bounds to 4026C2
// 402737: control flows out of bounds to 40273C
// 4026AA: control flows out of bounds to 4023F7
// 4026B5: conditional instruction was optimized away because of 'esi.4>=0'

//----- (004027B1) --------------------------------------------------------
#error "4027C8: cannot convert to microcode (funcsize=8)"

//----- (004027D7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int sub_4027D7()
{
  __asm { rep pop eax }
  ((void (*)(void))((char *)&loc_40245C + 2))();
  return sub_4027F4();
}
// 4027E4: positive sp value 8 has been found
// 4027F4: using guessed type _DWORD sub_4027F4();

//----- (004027F4) --------------------------------------------------------
#error "403025: cannot convert to microcode (funcsize=133)"

//----- (00402858) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402858(__int32 a1@<esi>)
{
  __int32 v1; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v1, a1);
  JUMPOUT(0x402E72);
}
// 40285E: positive sp value 4 has been found
// 402868: control flows out of bounds to 402E72

//----- (00402A29) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402A29()
{
  JUMPOUT(0x402FD2);
}
// 402A2F: positive sp value 4 has been found
// 402A3D: control flows out of bounds to 402FD2

//----- (00402ABF) --------------------------------------------------------
#error "402C83: cannot convert to microcode (funcsize=140)"

//----- (00402D1D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402D1D()
{
  void *v0; // [esp+Ch] [ebp-4h]
  void *retaddr; // [esp+10h] [ebp+0h]

  *(&retaddr - 5) = v0;
  JUMPOUT(0x402B22);
}
// 402281: positive sp value 4 has been found
// 402D41: control flows out of bounds to 402D47
// 402D06: control flows out of bounds to 402B22
// 402D17: control flows out of bounds to 402D32

//----- (00402E31) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402E31()
{
  ;
}
// 402E35: positive sp value 4 has been found

//----- (00402EC8) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402EC8()
{
  int v0; // [esp+4h] [ebp-8h]
  int v1; // [esp+8h] [ebp-4h]

  *(&v1 - 4) = v0;
  JUMPOUT(0x4028F7);
}
// 402D9F: positive sp value 8 has been found
// 402DB8: control flows out of bounds to 402DBE
// 402DAF: control flows out of bounds to 4028F7
// 402DB8: conditional instruction was optimized away because of 'al.1>=0'

//----- (00402F51) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402F51()
{
  JUMPOUT(0x402A91);
}
// 402F55: positive sp value 4 has been found
// 402F66: control flows out of bounds to 402A91

//----- (00402FB1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402FB1()
{
  int v0; // eax

  v0 = ((int (*)(void))loc_402786)();
  MEMORY[0x50175AF7](__GS__, v0 >> 31, v0);
  JUMPOUT(0x4022DB);
}
// 402FB5: positive sp value 4 has been found
// 402CCD: control flows out of bounds to 402CCF
// 402CBB: control flows out of bounds to 4022DB
// 402FB1: could not find valid save-restore pair for ebp
// 402CC6: conditional instruction was optimized away because of 'bl.1>=1'

// nfuncs=35 queued=35 decompiled=35 lumina nreq=0 worse=0 better=0
#error "There were 9 decompilation failure(s) on 35 function(s)"
