// subject_rdata.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw402046 = 0x209A; // 00402046
word32 g_dw40204A = 0x20AA; // 0040204A
word32 g_dw40204E = 0x20B8; // 0040204E
word32 g_dw402052 = 8387; // 00402052
word32 g_dw402056 = 0x20CC; // 00402056
word32 g_dw40205A = 0x20D5; // 0040205A
word32 g_dw40205E = 0x20E0; // 0040205E
word32 g_dw402062 = 0x20F0; // 00402062
word32 g_dw402066 = 8445; // 00402066
word32 g_dw40206A = 0x210D; // 0040206A
word32 g_dw40206E = 0x211D; // 0040206E
word32 g_dw402072 = 0x212A; // 00402072
word32 g_dw402076 = 0x2135; // 00402076
word32 g_dw40207A = 0x2142; // 0040207A
word32 g_dw40207E = 0x2152; // 0040207E
word32 g_dw402082 = 0x215D; // 00402082
word32 g_dw402086 = 0x2172; // 00402086
word32 g_dw40208A = 0x217C; // 0040208A
word32 g_dw40208E = 0x2188; // 0040208E
word32 g_dw402092 = 0x2195; // 00402092
word32 g_dw4021B1 = 8661; // 004021B1
word32 g_dw4021B5 = 0x21E2; // 004021B5
word32 g_dw4021B9 = 0x21F2; // 004021B9
word32 g_dw4021BD = 0x2200; // 004021BD
word32 g_dw4021C1 = 0x220C; // 004021C1
word32 g_dw4021C5 = 0x2217; // 004021C5
word32 g_dw4021C9 = 0x2226; // 004021C9
word32 g_dw4021CD = 0x2239; // 004021CD
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	word32 eax;
	word32 * edi;
	Eq_5 xmm1;
	uint32 dwArg0100;
	word32 dwLoc04;
	word128 xmm2_11 = __pshuf<Eq_328[4]>(0FEAD, 0FEAD, 0x44);
	if ((word32) xmm2_11 != 0xFEAD)
	{
		word32 ebx_20;
		word32 edi_21;
		word32 esi_23;
		word128 xmm1_25;
		return fn00401053(eax, (struct Eq_30 *) 0xFEAD, edi, xmm1, out ebx_20, out esi_23, out edi_21, out xmm1_25);
	}
	else
	{
		Eq_2 eax_31 = (word32) xmm2_11;
		if (eax_31 == 10000)
			return eax_31;
		eax_31 = dwArg0100 * 0xFEAD;
		if (dwArg0100 * 0xFEAD > 1341924402)
			return eax_31;
		struct Eq_30 * ebx_42;
		word32 * edi_44;
		Eq_5 xmm1_48;
		word32 eax_40 = fn0040181A(xmm1, (word16) dwLoc04, out ebx_42, out edi_44, out xmm1_48);
		word32 ebx_58;
		word32 edi_59;
		word32 esi_61;
		word128 xmm1_63;
		return fn00401053(eax_40, ebx_42, edi_44, xmm1_48, out ebx_58, out esi_61, out edi_59, out xmm1_63);
	}
}

// 00401053: Register word32 fn00401053(Register word32 eax, Register (ptr32 Eq_30) ebx, Register (ptr32 word32) edi, Register Eq_5 xmm1, Register out (ptr32 Eq_56) ebxOut, Register out (ptr32 word32) esiOut, Register out ptr32 ediOut, Register out Eq_59 xmm1Out)
// Called from:
//      Win32CrtStartup
//      fn0040181A
word32 fn00401053(word32 eax, struct Eq_30 * ebx, word32 * edi, Eq_5 xmm1, struct Eq_56 & ebxOut, word32 & esiOut, ptr32 & ediOut, union Eq_59 & xmm1Out)
{
	int32 ecx_11 = *(int32 *) 0x7FFE02D0;
	if (ecx_11 == 0x0112)
		ecx_11 -= 0x02;
	if (ecx_11 == 0x00)
		ecx_11 += 0x0110;
	struct Eq_56 * ebx_64;
	word32 * edi_66;
	word32 edx_67;
	word32 * esi_68;
	Eq_59 xmm1_71;
	word32 eax_76 = fn004017A5(eax, ebx, edi, xmm1, out edx_67, out ebx_64, out esi_68, out edi_66, out xmm1_71) - edx_67;
	*edi_66 = eax_76;
	ebxOut = ebx_64;
	esiOut = esi_68;
	ediOut = edi_66 + 1;
	xmm1Out = xmm1_71;
	return eax_76;
}

// 004017A5: Register word32 fn004017A5(Register word32 eax, Register (ptr32 Eq_30) ebx, Register (ptr32 word32) edi, Register Eq_5 xmm1, Register out ptr32 edxOut, Register out ptr32 ebxOut, Register out ptr32 esiOut, Register out ptr32 ediOut, Register out Eq_5 xmm1Out)
// Called from:
//      fn00401053
word32 fn004017A5(word32 eax, struct Eq_30 * ebx, word32 * edi, Eq_5 xmm1, ptr32 & edxOut, ptr32 & ebxOut, ptr32 & esiOut, ptr32 & ediOut, union Eq_5 & xmm1Out)
{
	ptr32 fp;
	real32 * esp_30 = fp - 0x28;
	word32 edx_33 = 0x00;
	word32 ecx_35 = 0x21CD;
	do
	{
		xmm1 = SEQ(SLICE(xmm1, word96, 32), (real32) xmm1 * *esp_30);
		struct Eq_133 * esp_47 = esp_30 - 4;
		esp_47->dw0000 = ecx_35;
		esp_47->dwFFFFFFFC = edx_33;
		struct Eq_142 * esp_59;
		ebx->ptr2072();
		Eq_146 edx_65 = esp_59->t0000.u0;
		esp_30 = (real32 *) (&esp_59->dw0004 + 1);
		ecx_35 = esp_59->dw0004 + eax;
		edx_33 = (word32) edx_65.u0 + 1;
	} while (edx_65 <= 3463);
	esp_59->dw0004 = ecx_35;
	esp_59->t0000.u0 = (int32) (fp - 8);
	esp_59->dwFFFFFFFC = 0x04;
	esp_59->dwFFFFFFF8 = 0x02;
	esp_59->ptrFFFFFFF4 = edi;
	esp_59->dwFFFFFFF0 = ~0x00;
	struct Eq_183 * esp_86;
	word32 eax_87;
	ebx[(ecx_35 + ~0x0D88) / 0x00001000]();
	Eq_189 xmm0_92 = (word128) eax_87;
	word128 xmm0_95 = __pshuflw<byte[16]>(xmm0_92, xmm0_92, 0x40);
	word32 eax_99 = (SLICE(__pshuf<Eq_328[4]>(xmm0_95, xmm0_95, 0x44), word32, 0) >>u 0x10) *s 0x40;
	ptr32 ecx_101 = esp_86->ptr0000;
	esp_86->ptr0000 = fp - 8;
	esp_86->dwFFFFFFFC = eax_99;
	esp_86->dwFFFFFFF8 = 0x02;
	esp_86->ptrFFFFFFF4 = edi;
	esp_86->dwFFFFFFF0 = ~0x00;
	struct Eq_231 * esp_114;
	ebx[(ecx_101 + ~0x0D88) / 0x00001000]();
	ptr32 edi_120 = esp_114->ptr0000;
	ptr32 esi_122 = esp_114->ptr0004;
	ptr32 ebx_127 = esp_114->ptr0010;
	word32 eax_133 = esp_114->dw001C;
	edxOut = esp_114->ptr0014;
	ebxOut = ebx_127;
	esiOut = esi_122;
	ediOut = edi_120;
	xmm1Out = xmm1;
	return eax_133;
}

// 0040181A: Register Eq_2 fn0040181A(Register Eq_5 xmm1, Stack word16 wArg00, Register out (ptr32 Eq_30) ebxOut, Register out (ptr32 word32) ediOut, Register out Eq_5 xmm1Out)
// Called from:
//      Win32CrtStartup
Eq_2 fn0040181A(Eq_5 xmm1, word16 wArg00, struct Eq_30 & ebxOut, word32 & ediOut, union Eq_5 & xmm1Out)
{
	word32 dwArg00;
	struct Eq_30 * edx_15 = SEQ(SLICE(dwArg00, word16, 16), 0x00);
	while (edx_15->b0000 != 77 || edx_15->b0001 != 0x5A)
		edx_15 = (struct Eq_30 *) ((char *) edx_15 - 0x00001000);
	word32 * esi_31 = (char *) &edx_15->ptr2072 + 0x0000338E;
	struct Eq_30 * ebx_21 = edx_15;
	word32 ecx_23 = 0x0436;
	word32 * edi_34 = esi_31;
	do
	{
		word32 eax_39 = *esi_31;
		word32 ecx_62 = ecx_23 - 4751210;
		Eq_2 eax_46 = fn00401053(eax_39 - 5337371, ebx_21, edi_34, xmm1, out ebx_21, out esi_31, out edi_34, out xmm1);
		ecx_23 = ecx_62 + 0x00487F69;
	} while (ecx_62 != ~0x00487F68);
	ebxOut = ebx_21;
	ediOut = edi_34;
	xmm1Out = xmm1;
	return eax_46;
}

