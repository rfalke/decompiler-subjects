/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

int __cdecl start(int a1, int a2, int a3);
void __fastcall sub_4010FB(int a1, int a2);
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
void __thiscall sub_404152(void *this);
void __thiscall sub_404242(void *_ECX);
// void __usercall sub_404317(_DWORD *a1@<esi>);

//-------------------------------------------------------------------------
// Data declarations

int dword_401000 = 309912196; // weak
_UNKNOWN loc_404368; // weak


//----- (00401092) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  HMODULE v3; // eax
  int v4; // edx
  int v5; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  v3 = GetModuleHandleA(0);
  sub_4010FB((int)v3, v4);
  v5 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 10;
  *(_DWORD *)(a3 + 176) = v5;
  return 0;
}
// 4010D9: variable 'v4' is possibly undefined

//----- (004010FB) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_4010FB(int a1, int a2)
{
  int v2; // [esp-10h] [ebp-10h] BYREF

  __writefsdword(0, (unsigned int)&v2);
  dword_401000 = a2;
}
// 40110C: positive sp value C has been found
// 401103: write access to const memory at 401000 has been detected
// 401000: using guessed type int dword_401000;

//----- (00404152) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __thiscall sub_404152(void *this)
{
  int v1; // ecx
  int savedregs; // [esp+0h] [ebp+0h]

  savedregs = 23916668;
  sub_404242(this);
  sub_404242((void *)(v1 >> 10));
}
// 4041DB: positive sp value 8 has been found
// 404236: variable 'v1' is possibly undefined

//----- (00404242) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __thiscall sub_404242(void *_ECX)
{
  int v3; // [esp-4h] [ebp-4h]

  __asm { repne cmovo edi, ecx }
  sub_404317((_DWORD *)(v3 + 522));
  _EDI = 1591184873;
  __asm { rcr     edi, 9 }
  sub_404317((_DWORD *)(v3 + 522));
}
// 40425A: positive sp value 4 has been found
// 404277: variable 'v3' is possibly undefined

//----- (00404317) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_404317(_DWORD *a1@<esi>)
{
  _DWORD *savedregs; // [esp+0h] [ebp+0h] BYREF

  *a1 -= 1446612890;
  ((void (*)(void))loc_404368)();
  savedregs = &savedregs;
  JUMPOUT(0x404368);
}
// 40431C: positive sp value 4 has been found
// 404367: control flows out of bounds to 404368

// nfuncs=5 queued=5 decompiled=5 lumina nreq=0 worse=0 better=0
// ALL OK, 5 function(s) have been successfully decompiled
