/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall start(__int64 _RAX@<edx:eax>, int a2@<ecx>, int a3@<ebx>, int a4@<ebp>, unsigned int _EDI@<edi>, int a6@<esi>);


//----- (00406501) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall start(__int64 _RAX@<edx:eax>, int a2@<ecx>, int a3@<ebx>, int a4@<ebp>, unsigned int _EDI@<edi>, int a6@<esi>)
{
  _DWORD *v6; // edi
  _DWORD *v7; // edx
  unsigned int v8; // ebx
  char v15; // tt
  int v16; // edi
  unsigned int v17; // edi
  unsigned int v18; // esi
  int v20; // edi
  int v27; // ebx
  int v28; // esi
  int v29; // edi
  int v32; // ecx
  bool v34; // tt
  bool v37; // cf
  _DWORD *v38; // edi
  int v41; // esi
  int v42; // edx
  unsigned int v44; // edi
  bool v46; // tt
  unsigned int v47; // edi
  char v48; // dl
  __int16 v53; // si
  bool v56; // cf
  char v57; // tt
  int v58; // edi
  __int16 v61; // cx
  _DWORD *v64; // esi
  int v66; // ecx
  unsigned int v69; // ecx
  int v70; // ebx
  __int16 v72; // bx
  _BYTE *v73; // edi
  bool v74; // zf
  int v75; // edi
  __int16 v76; // bx
  __int16 v79; // t2
  char v81; // tt
  char v82; // di

  v70 = a3 << 28;
  v41 = __ROR4__(a6, 24);
  BYTE4(_RAX) = 0;
  LOBYTE(a2) = a2 ^ 0x3A;
  v42 = HIDWORD(_RAX) | 0xDCCCAC;
  BYTE1(a2) >>= a2;
  LOWORD(v70) = v70 - v42;
  v32 = __ROR4__(a2, a2) - 996089977;
  HIDWORD(_RAX) = v42 - 1;
  LOWORD(_RAX) = 27072;
  LOBYTE(v32) = 124;
  BYTE1(v70) = (BYTE1(v70) | 0x46) + 1;
  v69 = _EDI | __ROR4__(v32, 2);
  LOBYTE(v70) = (_BYTE)v70 << v69;
  BYTE5(_RAX) = __ROL1__(BYTE5(_RAX) + 1, 8);
  v27 = v41 + v70;
  v28 = HIDWORD(_RAX) ^ v41;
  BYTE5(_RAX) <<= v69;
  _ECX = v69 >> 4;
  __asm { rcr     ch, 12h }
  BYTE1(v27) = -46;
  BYTE4(_RAX) = ~BYTE4(_RAX);
  LOBYTE(v27) = v27 - 1;
  _EBX = v27 << _ECX;
  if ( _EBX == -1021766098 )
  {
    *(_DWORD *)(HIDWORD(_RAX) - 1467404732) += 10;
    __asm { xlat }
    LOBYTE(_EBX) = -72;
    _ECX |= 0x204F336Au;
    BYTE1(_ECX) = __ROR1__(BYTE1(_ECX) + 117, _ECX);
    _EBX |= _RAX;
    if ( _EDI != 1729130897 )
      JUMPOUT(0x4064B6);
    v29 = 1729130898;
    v37 = (unsigned int)_RAX < (unsigned int)(MEMORY[0x67107191] < (unsigned __int8)_RAX) - 1400925047;
    LOWORD(_RAX) = _RAX - ((MEMORY[0x67107191] < (unsigned __int8)_RAX) - 27511);
    LOBYTE(_RAX) = v37;
LABEL_19:
    _ECX = _ECX - v29;
    __asm { rcl     cl, cl }
    LOBYTE(_EBX) = (HIDWORD(_RAX) < 0x1E25DAAF) + __ROR1__(_EBX, 21) - 27;
    WORD2(_RAX) ^= _RAX;
    if ( _EBX == 1862951878 )
      JUMPOUT(0x4063C6);
    LOWORD(_ECX) = (unsigned __int16)_ECX >> _ECX;
    _ECX = _ECX << _ECX;
    HIDWORD(_RAX) += v29;
    goto LABEL_62;
  }
  LOBYTE(_EBX) = __ROL1__(_EBX, _ECX);
  BYTE1(_EBX) = __ROL1__(BYTE1(_EBX), 20);
  v18 = (v28 | 0xBA7F03F9) - HIDWORD(_RAX);
  LOWORD(_ECX) = (unsigned __int8)_EBX;
  if ( _EBX == -2102935849 )
    return;
  while ( 1 )
  {
    BYTE1(_EBX) = _EBX + (_RAX & BYTE1(_EBX));
    LOBYTE(_ECX) = _ECX - ((HIDWORD(_RAX) < 0xB6A315B5) + BYTE1(_ECX) - _EBX);
    LOBYTE(_EBX) = __ROL1__(_EBX, 14);
    _ESI = v18 >> _ECX;
    if ( _EBX == -1734826651 )
    {
      BYTE1(_ECX) = -91;
      __asm { arpl    [ecx-34CD1B06h], ax }
      v37 = __CFADD__(_ESI, *(_DWORD *)(a4 - 76));
      *(_DWORD *)(a4 - 76) += _ESI;
      v81 = v37;
      v37 = __CFADD__(v37, BYTE5(_RAX));
      BYTE5(_RAX) += v81;
      v37 |= __CFADD__(BYTE5(_RAX), -80);
      BYTE5(_RAX) -= 80;
      BYTE4(_RAX) += BYTE5(_RAX) + v37;
      v82 = _ECX ^ _EDI;
      BYTE1(_RAX) += 91;
      HIDWORD(_RAX) ^= 0xC572A0D9;
      LOBYTE(_EBX) = __ROR1__(101, 15);
      BYTE5(_RAX) |= 0xD1u;
      LOBYTE(_RAX) = 89;
      if ( _EBX != 1943374267 )
        return;
      __asm { aad     34h ; '4' }
      __outbyte(WORD2(_RAX), _RAX);
      __asm
      {
        arpl    bx, dx
        rep ror esi, 9
      }
      LOBYTE(_ECX) = (v82 + (_BYTE)_ECX) << (v82 + _ECX);
      __asm { rcl     esi, 19h }
      if ( HIDWORD(_RAX) != 13735162 )
        JUMPOUT(0x4069F6);
      if ( SHIDWORD(_RAX) >= 13735162 )
        JUMPOUT(0x4069EA);
LABEL_62:
      BYTE4(_RAX) -= __CFSHR__(-28985, _ECX) + 63;
      if ( HIDWORD(_RAX) == 1254241441 )
        JUMPOUT(0x406A0C);
      JUMPOUT(0x406909);
    }
    BYTE1(_ECX) = 0;
    LOWORD(_EDI) = __ROL2__(_EDI, _ECX);
    SBYTE5(_RAX) >>= _ECX;
    __asm
    {
      rcr     ch, cl
      rcr     bl, 0Fh
    }
    HIDWORD(_RAX) <<= 9;
    _ESI = _ESI - 35826409;
    _ECX = _ECX & 0x78C61B05;
    if ( (_DWORD)_RAX != 220421511 )
      break;
    while ( 1 )
    {
      LOBYTE(_ECX) = __ROR1__(_ECX, _ECX);
      v66 = __ROL4__(_ECX, 18);
      LODWORD(_RAX) = __GS__;
      LOBYTE(v66) = __ROR1__(v66, 27);
      LOWORD(_ESI) = (_WORD)_ESI << v66;
      BYTE1(_EBX) ^= BYTE5(_RAX);
      LOBYTE(_EBX) = __ROR1__(__ROR1__(0, 17), v66);
      v37 = __CFSHL__(BYTE1(v66), 22);
      BYTE1(v66) = 0;
      _ECX = v66 - (v37 - 723329660);
      LOWORD(_EBX) = _ECX & _EBX;
      LOBYTE(_EBX) = (_BYTE)_EBX << _ECX;
      __asm
      {
        rcr     esi, cl
        rcr     ebx, 4
      }
      BYTE1(_ECX) &= 0x7Du;
      LOBYTE(_EBX) = -18;
      __asm { rcr     bh, 12h }
      v37 = (unsigned __int8)_ECX < __GS__;
      LOBYTE(_ECX) = _ECX - __GS__;
      v16 = v37 + _EDI + 1291589920;
      v37 = _ECX & 1;
      _ECX = _ECX >> 1;
      BYTE1(_ECX) = v37 + BYTE1(_ECX) - 45;
      v17 = v16 << 11;
      __asm { rcl     bl, 1Eh }
      LOBYTE(_EBX) = BYTE4(_RAX) & _EBX;
      BYTE1(_ECX) = __ROR1__(BYTE1(_ECX), _ECX);
      BYTE1(_EBX) = __ROR1__(BYTE1(_EBX), 7) << _ECX;
      v37 = __CFADD__(__GS__, BYTE1(_ECX));
      BYTE1(_ECX) += __GS__;
      v73 = (_BYTE *)__ROL4__((unsigned __int16)((v17 >> 28) - (v37 + (_WORD)_EBX)), _ECX);
      _ESI = (_DWORD *)(_ESI >> 9);
      __asm { rcl     ch, cl }
      ++HIDWORD(_RAX);
      if ( _ECX != 427160067 )
      {
        v8 = (_EBX >> 15) ^ 0xAF1B2C68;
        if ( (_DWORD *)((char *)_ESI - __CFSHL__(_ECX, 27) + 1457659484) == (_DWORD *)387172590 )
          JUMPOUT(0x4061D3);
        LOWORD(v8) = -(unsigned __int8)v8;
        LOBYTE(v8) = v8 & 0xD;
        if ( v8 == 518046500 )
          JUMPOUT(0x40654E);
        JUMPOUT(0x4064E5);
      }
      if ( __SETP__(427160067, 427160067) )
        goto LABEL_62;
      ++a4;
      v37 = *v73 < __GS__;
      v74 = *v73 == __GS__;
      _EDI = (unsigned int)(v73 + 1);
      if ( !v74 )
        goto LABEL_54;
      LODWORD(_RAX) = _EBX;
      _EBX = __GS__;
      _RAX = (int)_RAX;
      v79 = (__int16)_RAX % *(char *)__GS__;
      LOBYTE(_RAX) = (__int16)_RAX / *(char *)__GS__;
      BYTE1(_RAX) = v79;
      LOBYTE(_ECX) = (char)_ECX >> _ECX;
      SWORD2(_RAX) >>= _ECX;
      __asm { rcr     bl, cl }
      _EDI = _EDI ^ 0xA08BC4DA;
      v18 = (unsigned int)(_ESI + 372111501);
      __asm { rcr     cx, cl }
      if ( HIDWORD(_RAX) == 666634856 )
        break;
      v37 = (unsigned __int16)_EDI < (unsigned __int16)_RAX;
      LOWORD(_EDI) = _EDI - _RAX;
      BYTE1(_ECX) -= v37 + 29;
      __asm { rcl     ch, cl }
      _ECX = _ECX | 0xF4D42FD5;
      BYTE1(_EBX) = __GS^1__ & 0x58;
      LOBYTE(_EBX) = _RAX;
      if ( _EDI == -1531784845 )
      {
        LOBYTE(_RAX) = _RAX + 9;
        _ECX = _ECX - 1;
        if ( (_BYTE)_RAX && _ECX )
        {
          __asm
          {
            rcr     edi, 0Bh
            rcl     bl, 10h
          }
          JUMPOUT(0x40617F);
        }
        if ( !_ECX )
          JUMPOUT(0x406635);
        goto LABEL_39;
      }
      _ESI = (_EDI < 0xA4B2D173) + v18 + 2101375748;
      _EDI = ((int)_EDI >> 5) - (__CFSHR__(_EDI, 5) + _ESI);
      v15 = _RAX & 1;
      LODWORD(_RAX) = __ROR4__(_RAX, 1);
      if ( !v15 )
        JUMPOUT(0x4069AC);
      LOWORD(_EBX) = __ROR2__(_EBX, _ECX);
      _EBX = _EBX & 0x9300C7DF;
      __asm
      {
        rcr     di, cl
        rcl     ebx, 0Ah
      }
      BYTE1(_ECX) = -__ROL1__(BYTE1(_ECX) - 1, 27);
      BYTE1(_EBX) ^= 0x2Fu;
      _EDI = (int)(_EDI | 0x91424DC1) >> 19;
      LOBYTE(_EBX) = _RAX & _EBX;
      _ECX = _ECX + 49168370;
      v37 = __CFADD__(BYTE4(_RAX), BYTE1(_EBX));
      BYTE1(_EBX) += BYTE4(_RAX);
      v57 = v37 - 48;
      v56 = BYTE1(_EBX) < (unsigned __int8)(v37 - 48);
      BYTE1(_EBX) -= v57;
      __asm { rcl     edi, cl }
      --BYTE1(_ECX);
      v20 = _EDI - (v56 + _ECX);
      _ECX = _RAX & _ECX;
      BYTE1(_EBX) >>= _ECX;
      __asm { rcr     si, cl }
      v37 = __CFSHL__(BYTE1(_ECX), _ECX);
      BYTE1(_ECX) <<= _ECX;
      LOBYTE(_EBX) = _EBX - (v37 + 81);
      _ESI = __ROR4__(_ESI, _ECX);
      if ( HIDWORD(_RAX) == -543722545 )
        JUMPOUT(0x406318);
      _EDI = v20 - ((HIDWORD(_RAX) < 0xDF9773CF) - 1904125878);
      __asm { rcr     bh, 5 }
      BYTE1(_ECX) += _RAX;
      _EBX = ~_EBX;
      _ECX = _ECX >> 6;
      BYTE1(_EBX) = ~BYTE1(_EBX);
      if ( _EDI == 1049421999 )
      {
        __debugbreak();
        __halt();
      }
    }
    __asm { lock xor eax, 0CFFF6281h }
  }
  v47 = _EDI >> 26;
  v48 = BYTE4(_RAX) - 78;
  v37 = __CFSHR__(_BL, _ECX);
  _EBX = -1128212165;
  BYTE1(_ECX) += _ECX + v37;
  if ( v47 == -1438742306 )
  {
    MEMORY[0xD386EB80] += v48;
    __asm { iret }
    JUMPOUT(0x4065E8);
  }
  BYTE1(_ECX) ^= 0x2Fu;
  HIDWORD(_RAX) = _ECX;
  __asm { rcr     ebx, cl }
  BYTE4(_RAX) = _EBX;
  _ECX = _ECX >> 15;
  LOBYTE(_EBX) = _EBX & 0x65;
  __asm { rcr     esi, 2 }
  if ( _ECX != 1735876129 )
    JUMPOUT(0x406576);
  __outdword(0x41u, _RAX);
  v44 = v47 & 0xC5E6B432;
  BYTE1(_EBX) = 2 * _RAX;
  BYTE4(_RAX) = ~BYTE4(_RAX);
  __asm { rcr     ecx, 1Bh }
  _ECX = v44 & _ECX;
  v37 = (unsigned __int8)_ECX < 0xFBu;
  LOBYTE(_ECX) = _ECX + 5;
  BYTE1(_ECX) = ~BYTE1(_ECX);
  _EDI = v44 - (v37 + _ECX);
  v46 = __CFSHL__(BYTE4(_RAX), 4);
  BYTE4(_RAX) = __ROL1__(BYTE4(_RAX), 4);
  LOBYTE(_ECX) = v46 + _ECX - 93;
  HIDWORD(_RAX) &= 0x2EA809A2u;
  LOWORD(_ESI) = (unsigned __int16)-(__int16)(_EBX + __CFSHL__(_RAX, 33) + (_WORD)_ESI) >> _ECX;
  while ( 1 )
  {
    __asm { rcr     edx, cl }
    BYTE1(_ECX) -= 57;
    __asm
    {
      rcr     bl, 1Ch
      rcr     esi, 2
    }
    LOBYTE(_EBX) = __ROR1__(0, 18);
    _EDI = -_EDI;
    _EBX = _EBX & 0xAA80064D;
    SHIDWORD(_RAX) >>= 23;
    BYTE1(_EBX) &= 0x13u;
    LOWORD(_ESI) = (_WORD)_ESI - _RAX;
    LOBYTE(_ECX) = BYTE4(_RAX) + (_EBX & _ECX);
    __asm { rcl     edi, 1Eh }
    LOWORD(_EBX) = ~(_WORD)_EBX;
    BYTE1(_ECX) -= 79;
    _BH = BYTE1(_ECX) + BYTE1(_EBX);
    __asm { rcl     ch, 6 }
    v34 = __CFSHR__((_WORD)_ESI, _ECX);
    LOWORD(_ESI) = __ROR2__((_WORD)_ESI, _ECX);
    __asm
    {
      rcr     edi, cl
      rcl     bh, cl
    }
    LOWORD(_EDI) = WORD2(_RAX);
    BYTE1(_EBX) = BYTE1(_RAX) + v34 + _BH;
    v37 = HIDWORD(_RAX) < 0x72EB5DD0;
    if ( HIDWORD(_RAX) != 1928027600 )
    {
LABEL_54:
      v75 = _EDI - ((_DWORD)_ESI + (__CFADD__(v37, BYTE1(_ECX)) | __CFADD__((_BYTE)_RAX, v37 + BYTE1(_ECX))));
      v76 = _EBX | 0x9390;
      LOBYTE(v76) = ~(_BYTE)v76;
      _BX = v76 << _ECX;
      _CL = _BX & _ECX;
      --HIBYTE(_BX);
      __asm { rcl     bh, cl }
      LOBYTE(_BX) = __ROR1__(_BX, _CL) & 0x6C;
      _ECX = 0;
      v72 = v75 + _BX;
      __asm { rcr     ecx, cl }
      HIBYTE(v72) = __ROL1__(HIBYTE(v72), _ECX);
      BYTE1(_ECX) ^= 0x8Cu;
      LOBYTE(_ECX) = _ECX + 107;
      LOWORD(_ECX) = __ROR2__(_ECX, _ECX);
      LOBYTE(_ECX) = _ECX & 0xF2;
      v64 = (_DWORD *)__ROR4__((unsigned int)_RAX >> 8, _ECX);
      _BX = (_WORD)v64 + __CFSHR__((unsigned int)_RAX >> 8, _ECX) + v72;
      LOBYTE(_ECX) = __ROR1__(_ECX, _ECX);
      BYTE1(_ECX) *= 4;
      v58 = HIDWORD(_RAX) | (v75 - _RAX);
      LOBYTE(_BX) = __ROL1__(_BX, 22);
      _ECX = (unsigned int)v64 + _ECX;
      v6 = (_DWORD *)(_ECX & v58);
      __asm { rcl     bh, cl }
      BYTE1(_RAX) += _BX + __CFSHL__(BYTE4(_RAX), _ECX);
      BYTE4(_RAX) = (char)(BYTE4(_RAX) << _ECX) >> _ECX;
      v7 = (_DWORD *)(HIDWORD(_RAX) | 0x66DCDB54);
      if ( (_DWORD)_RAX == -537742027 )
      {
        *v6 = *v64;
        *v7 = (__PAIR64__(*v7, -537742027) - __PAIR64__((unsigned int)v7, -537742027)) >> 32;
        if ( v6[1] > 0xDFF2B535 )
          JUMPOUT(0x406182);
        JUMPOUT(0xC2CEF062);
      }
      JUMPOUT(0x4063C5);
    }
    __asm { xlat }
    *(_DWORD *)_EDI = *_ESI;
    v18 = (unsigned int)(_ESI + 1);
    v38 = (_DWORD *)(_EDI + 4);
    LODWORD(_RAX) = __ROL4__(_RAX, 1);
    _ECX = ((unsigned int)v38 + _ECX + 1) >> ((_BYTE)v38 + _ECX + 1);
    _EDI = 2 * (_DWORD)v38;
    _EBX = _EBX + 83870762;
    __asm { int     2Eh; DOS 2+ internal - EXECUTE COMMAND }
    HIWORD(_RAX) = 11523;
    if ( _EBX == -1626075439 )
    {
      MEMORY[0xAB309BDC] += 14;
      *(_DWORD *)_ECX = ~*(_DWORD *)_ECX;
      __asm { rcl     ebx, 2 }
      JUMPOUT(0x40697A);
    }
    BYTE1(_ECX) = __ROL1__(BYTE1(_ECX), _ECX);
    BYTE4(_RAX) = __ROL1__(-26, 4);
    BYTE5(_RAX) = 89;
    _EBX = __CFSHL__(BYTE1(_ECX), 28) + (_EBX >> _ECX) + 1158825884;
    HIDWORD(_RAX) <<= 17;
    BYTE1(_ECX) = __ROR1__(__ROL1__(BYTE1(_ECX), 28), 23);
    BYTE5(_RAX) = __ROR1__(BYTE5(_RAX), 30);
    if ( (_DWORD)_RAX != -1901706150 )
      break;
    _ESI = (unsigned __int16)__ES__;
    LOBYTE(_ECX) = _ECX - __readfsbyte((unsigned __int16)__ES__);
  }
  LOBYTE(_ECX) = (_BYTE)_ECX << _ECX;
  BYTE5(_RAX) = __ROL1__(BYTE5(_RAX), 30);
  LOWORD(_EBX) = __ROL4__(_EBX, _ECX);
  __asm { rcl     dl, cl }
  if ( (_DWORD)_RAX == -1073741819 )
  {
    BYTE1(_ECX) += BYTE1(_EBX);
    if ( v18 == -202165358 )
    {
      _enable();
      *(_BYTE *)(_EDI - 100) &= 0xFEu;
      JUMPOUT(0x406376);
    }
LABEL_39:
    BYTE5(_RAX) |= BYTE1(_ECX);
    BYTE4(_RAX) += _EBX;
    v53 = (v18 - (__CFSHL__(BYTE1(_ECX), 15) + WORD2(_RAX))) & 0x3ECB;
    HIWORD(_EBX) = -30679;
    BYTE1(_ECX) = __ROR1__(0, _ECX);
    if ( (_DWORD)_RAX == 130651642 )
      JUMPOUT(0x40665B);
    HIDWORD(_RAX) >>= 30;
    LOWORD(_EBX) = WORD2(_RAX) ^ 0x34D8;
    v61 = v53 ^ _ECX;
    BYTE1(_ECX) = __ROR1__(HIBYTE(v61), v61);
    BYTE4(_RAX) = BYTE5(_RAX) + __CFSHL__(BYTE4(_RAX), v61) + __ROL1__(BYTE4(_RAX), v61);
    v29 = _EDI | 0x7120EB21;
    LOBYTE(_ECX) = BYTE1(_ECX) + v61;
    LOBYTE(_EBX) = BYTE1(_EBX) | _EBX;
    goto LABEL_19;
  }
  if ( _ECX == 623644455 )
    JUMPOUT(0x40682A);
}
// 4062A5: positive sp value 4 has been found
// 40617D: control flows out of bounds to 406182
// 4061D1: control flows out of bounds to 4061D3
// 406348: control flows out of bounds to 40634D
// 4063C4: control flows out of bounds to 4063C6
// 40654D: control flows out of bounds to 40654E
// 40665A: control flows out of bounds to 40665B
// 406824: control flows out of bounds to 40682A
// 406908: control flows out of bounds to 406909
// 406AAC: control flows out of bounds to 406AAE
// 406B58: control flows out of bounds to 406B5A
// 4065E7: control flows out of bounds to 4065E8
// 406157: control flows out of bounds to C2CEF062
// 406250: control flows out of bounds to 4069AC
// 4064F8: control flows out of bounds to 40697A
// 4065FB: control flows out of bounds to 40617F
// 4066CD: control flows out of bounds to 40672C
// 406A2E: control flows out of bounds to 4064B6
// 406149: control flows out of bounds to 4063C5
// 4062EE: control flows out of bounds to 406318
// 406342: control flows out of bounds to 4065E3
// 406426: control flows out of bounds to 406376
// 40654B: control flows out of bounds to 4064E5
// 40656E: control flows out of bounds to 406576
// 406634: control flows out of bounds to 406635
// 4066C3: control flows out of bounds to 406156
// 4069C3: control flows out of bounds to 4069F6
// 4069C5: control flows out of bounds to 4069EA
// 4069EF: control flows out of bounds to 406A0C
// 406B26: control flows out of bounds to 406B70
// 406426: conditional instruction was optimized away because of 'eax.4==C0000005'

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
