/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall start(__int128@<xmm6>);
// int __usercall sub_40777E@<eax>(__int128@<xmm6>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN unk_409000; // weak
int dword_409150 = 317240188; // weak
int dword_409179 = 1203758367; // weak
int dword_409324 = -1087890499; // weak
_UNKNOWN unk_409460; // weak


//----- (004075A0) --------------------------------------------------------
void __usercall start(__int128 a1@<xmm6>)
{
  void **v1; // ecx
  void (__thiscall *v2)(_DWORD); // ebx
  int v3; // esi
  int v4; // ecx
  int v5; // kr00_4
  void (__thiscall *retaddr)(_DWORD); // [esp+1Ch] [ebp+4h] BYREF

  v1 = (void **)&retaddr;
  v2 = retaddr;
  while ( 1 )
  {
    v2 = (void (__thiscall *)(_DWORD))((char *)v2 + 1);
    v3 = dword_409324;
    if ( (unsigned __int16)*(_DWORD *)v2 == 0xD7FF )
      break;
    v1 = (void **)((char *)v1 - 1199771398);
  }
  v2((char *)v1 - dword_409324);
  sub_40777E(a1);
  if ( v3 == 11 )
  {
    v4 += dword_409150;
    v3 = *(int *)((char *)&dword_409179 + 3) + 11;
  }
  v5 = (*(int (__thiscall **)(int, int))(v3 + 52))(v4, 1);
  __asm { jmp     eax }
}
// 407745: unbalanced stack, ignored a potential tail call
// 407730: variable 'v4' is possibly undefined
// 40908F: using guessed type int dword_40908F;
// 409106: using guessed type int dword_409106;
// 409134: using guessed type int dword_409134;
// 409150: using guessed type int dword_409150;
// 409179: using guessed type int dword_409179;
// 40925D: using guessed type int dword_40925D;
// 4092D2: using guessed type int dword_4092D2;
// 409324: using guessed type int dword_409324;

//----- (0040777E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_40777E@<eax>(__int128 a1@<xmm6>)
{
  int v1; // eax
  _DWORD *v2; // ecx
  int result; // eax
  _DWORD v4[17]; // [esp-44h] [ebp-4Ch] BYREF

  v1 = 8259;
  do
  {
    v2 = (_DWORD *)&unk_409000;
    do
    {
      *v2 -= 874;
      *v2++ += 3627;
    }
    while ( v2 != (_DWORD *)&unk_409460 );
    --v1;
    v4[2] = 0;
  }
  while ( v1 );
  __writefsdword(0, (unsigned int)v4);
  result = 0;
  MEMORY[0] = a1;
  return result;
}
// 40830F: positive sp value 40 has been found
// 407EFF: conditional instruction was optimized away because ecx.4==DB8CD7D1
// 409012: using guessed type int dword_409012;
// 409061: using guessed type int dword_409061;
// 40907C: using guessed type int dword_40907C;
// 40908F: using guessed type int dword_40908F;
// 409095: using guessed type int dword_409095;
// 4090A0: using guessed type int dword_4090A0;
// 4090AA: using guessed type int dword_4090AA;
// 4090B6: using guessed type int dword_4090B6;
// 4090D0: using guessed type int dword_4090D0;
// 409106: using guessed type int dword_409106;
// 409130: using guessed type int dword_409130;
// 409134: using guessed type int dword_409134;
// 40913C: using guessed type int dword_40913C;
// 409140: using guessed type int dword_409140;
// 4091C9: using guessed type int dword_4091C9;
// 4091CE: using guessed type int dword_4091CE;
// 4091E1: using guessed type int dword_4091E1;
// 40921D: using guessed type int dword_40921D;
// 40925D: using guessed type int dword_40925D;
// 4092D2: using guessed type int dword_4092D2;
// 4092F2: using guessed type int dword_4092F2;
// 409300: using guessed type int dword_409300;
// 40931E: using guessed type int dword_40931E;
// 4093D8: using guessed type int dword_4093D8;
// 40943C: using guessed type int dword_40943C;
// 409445: using guessed type int dword_409445;

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
