/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall sub_4010AC(__int64 _RAX@<edx:eax>, char *a2@<ecx>, char *a3@<ebx>, void *a4@<ebp>, __int64 a5@<esi:edi>);
// void __usercall sub_4010ED(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, void *a5@<ebp>, __int32 a6@<edi>, int a7@<esi>);
// void __usercall sub_4011B1(int a1@<eax>, int a2@<edx>, int a3@<ebx>, void *a4@<ebp>, __int32 a5@<edi>, int a6@<esi>);
// void __usercall sub_4011F4(__int64 a1@<edx:eax>, int a2@<ebx>, void *a3@<ebp>);
void sub_40134C();
void sub_4013BD();
_DWORD sub_4013D7(); // weak
// void __usercall start(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401281; // weak


//----- (004010AC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4010AC(__int64 _RAX@<edx:eax>, char *a2@<ecx>, char *a3@<ebx>, void *a4@<ebp>, __int64 a5@<esi:edi>)
{
  int v5; // ecx
  int v6; // ebx
  char *v7; // et1
  unsigned int v8; // ecx
  unsigned int v9; // ebx
  __int64 v10; // [esp-8h] [ebp-8h]
  void *retaddr; // [esp+0h] [ebp+0h] BYREF

  while ( 1 )
  {
    v8 = (unsigned int)&a2[_RAX - HIDWORD(a5)];
    v9 = (unsigned int)&a3[-a5];
    LODWORD(a5) = v8 ^ a5;
    HIDWORD(a5) ^= a5;
    v5 = HIDWORD(v10) ^ (v8 - 1);
    v6 = v5 + (v5 | v9);
    LODWORD(a5) = v5 | a5;
    HIDWORD(a5) = a5 + (HIDWORD(v10) | HIDWORD(_RAX) | HIDWORD(a5));
    _RAX = ((__int64 (*)(void))((char *)&loc_401281 + 4))();
    v7 = (char *)_RAX;
    LODWORD(_RAX) = v6;
    a3 = v7;
    __asm
    {
      aaa
      aam     4Ch ; 'L'
    }
    v10 = a5;
    *(&retaddr - 3) = a4;
    *(&retaddr - 4) = &retaddr;
    *(&retaddr - 5) = v7;
    *(&retaddr - 6) = a2;
    *((_QWORD *)&retaddr - 4) = _RAX;
  }
}
// 401092: positive sp value 8 has been found
// 4010C4: control flows out of bounds to 4010CA
// 4010C0: conditional instruction was optimized away because of 'ecx.4>=0'
// 4010B0: variable 'a2' is possibly undefined

//----- (004010ED) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4010ED(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, void *a5@<ebp>, __int32 a6@<edi>, int a7@<esi>)
{
  unsigned __int8 v7; // al
  unsigned __int16 v8; // dx
  char v9; // zf
  __int32 v10; // [esp-8h] [ebp-8h] BYREF

  _InterlockedExchange(&v10, a6);
  sub_4011B1(a1, a1 | a2, a7 + 1 + a4 + 2, a5, v10 + 1 - a1 + (a1 | (a3 - 1)), v10 + 1 - a1);
  if ( v9 )
  {
    __outbyte(v8, v7);
    JUMPOUT(0x401427);
  }
  JUMPOUT(0x401434);
}
// 40110F: positive sp value 8 has been found
// 40110F: control flows out of bounds to 401115
// 401426: control flows out of bounds to 401427
// 401423: control flows out of bounds to 401434
// 401423: variable 'v9' is possibly undefined
// 401426: variable 'v8' is possibly undefined
// 401426: variable 'v7' is possibly undefined

//----- (004011B1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4011B1(int a1@<eax>, int a2@<edx>, int a3@<ebx>, void *a4@<ebp>, __int32 a5@<edi>, int a6@<esi>)
{
  int v6; // edi
  __int32 v7; // ebx
  char v9; // dl
  bool v10; // cf
  int v11; // edx
  __int64 v12; // rax
  __int32 v13; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v13, a5);
  v6 = a2 + (a1 | v13);
  v7 = a1 ^ (v13 + a3 - 1);
  sub_4013BD();
  __asm { cmpxchg [ecx-2Eh], ecx }
  *(_DWORD *)(a6 + 80) &= v6;
  v10 = (unsigned __int8)++v9 < (unsigned __int8)v7;
  LOBYTE(v11) = v9 - v7;
  BYTE1(v7) = v10 + (BYTE1(v11) ^ BYTE1(v7)) - 30;
  HIDWORD(v12) = v11 + 1 - v7;
  sub_4011F4(v12, v7 - HIDWORD(v12), a4);
  __asm { iret }
}
// 4011BA: positive sp value 4 has been found
// 4011D3: variable 'v9' is possibly undefined
// 4011D9: variable 'v11' is possibly undefined
// 4011E7: variable 'v12' is possibly undefined

//----- (004011F4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4011F4(__int64 a1@<edx:eax>, int a2@<ebx>, void *a3@<ebp>)
{
  int v3; // ecx
  char *v4; // ebx
  int v5; // esi
  char v6; // t0
  __int64 v7; // rdi
  int v8; // esi

  HIDWORD(a1) = a1 - 1 + HIDWORD(a1) - 1;
  v8 = a1 + (a1 ^ HIDWORD(a1));
  HIDWORD(a1) += a2;
  v3 = (v8 ^ a2 ^ (a1 - 1)) - 1;
  v4 = (char *)(v3 + a2);
  HIDWORD(a1) += v3 + 1;
  v5 = a1 + v8 - (_DWORD)v4;
  if ( !__SETP__(v5, 0) && __SETP__(v5, 0) )
  {
    LOBYTE(a1) = __inbyte(0x65u);
    v6 = BYTE4(a1);
    BYTE4(a1) = BYTE1(v3);
    BYTE1(v3) = v6;
  }
  LODWORD(v7) = &v4[-HIDWORD(a1)];
  HIDWORD(v7) = v5 + 1;
  sub_4010AC(a1, (char *)((unsigned int)v4 ^ (HIDWORD(a1) | v3)), v4, a3, v7);
  JUMPOUT(0x40118C);
}
// 4011F8: positive sp value 4 has been found
// 401186: control flows out of bounds to 40118C

//----- (0040134C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40134C()
{
  JUMPOUT(0x401074);
}
// 401353: positive sp value 8 has been found
// 401359: control flows out of bounds to 401074

//----- (004013BD) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4013BD()
{
  int v0; // [esp+20h] [ebp-8h]
  int v1; // [esp+24h] [ebp-4h]

  *(&v1 - 11) = v0;
  JUMPOUT(0x4012FD);
}
// 401050: positive sp value 8 has been found
// 401050: control flows out of bounds to 401051
// 401072: control flows out of bounds to D742D289
// 4014C8: control flows out of bounds to B828518B
// 401498: control flows out of bounds to 4012FD

//----- (004013D7) --------------------------------------------------------
#error "4012BF: cannot convert to microcode (funcsize=102)"

//----- (00401428) --------------------------------------------------------
void __usercall start(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  int savedregs; // [esp+0h] [ebp+0h] BYREF

  sub_4010ED(a1, a2 - a1, (a2 | a3) - a2 + 1, a4, &savedregs, (a2 | a3) - a2 + 1, a6 - a5);
  __asm
  {
    sldt    edx
    retfw
  }
}
// 401442: control flows out of bounds to 401444

// nfuncs=8 queued=8 decompiled=8 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 8 function(s)"
