// subject_data.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

Eq_2 g_t403000 = // 00403000
	{
		&g_a3F81
	};
Eq_2 g_t403004 = // 00403004
	{
		&g_a5200
	};
Eq_1052 g_a403008[] = // 00403008
	{
	};
Eq_2 g_t407024 = // 00407024
	{
		null
	};
word32 g_dw407028 = 0x00; // 00407028
Eq_2 g_t40702C = // 0040702C
	{
		null
	};
word32 g_dw407030 = 0x00; // 00407030
Eq_2 g_t407034 = // 00407034
	{
		null
	};
ptr32 g_ptr407038 = 0x00; // 00407038
word32 g_dw40703C = 0x00; // 0040703C
Eq_2 g_t407040 = // 00407040
	{
		null
	};
word32 g_dw407044 = 0x00; // 00407044
struct Eq_123 * g_ptr407048 = null; // 00407048
<anonymous> * g_ptr40704C = null; // 0040704C
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__LoadLibraryA = &g_t1B96; // 00401000
<anonymous> * __imp__GetModuleHandleA = &g_t1BA6; // 00401004
<anonymous> * __imp__GetProcAddress = &g_t1BBA; // 00401008
<anonymous> * __imp__CloseHandle = &g_t1BCC; // 0040100C
<anonymous> * __imp__VirtualAlloc = &g_t1BDA; // 00401010
<anonymous> * __imp__GetCommandLineA = &g_t1B84; // 00401014
// 00401020: void fn00401020(Stack Eq_2 dwArg04, Stack Eq_2 dwArg08, Stack Eq_2 dwArg0C)
// Called from:
//      fn00401290
//      fn00401860
void fn00401020(Eq_2 dwArg04, Eq_2 dwArg08, Eq_2 dwArg0C)
{
	g_t40702C.u0 = 0x00;
	while (g_t40702C.u0 < dwArg0C)
	{
		Mem23[dwArg04 + Mem9[0x0040702C<p32>:word32]:byte] = Mem9[dwArg08 + Mem9[0x0040702C<p32>:word32]:byte];
		g_t40702C.u0 = (Eq_910 (*)[]) ((char *) g_t40702C.u0 + 1);
	}
}

// 004010B0: Register Eq_20 Win32CrtStartup()
Eq_20 Win32CrtStartup()
{
	ptr32 fp;
	word32 ebx;
	word32 esi;
	word32 edi;
	struct Eq_25 * fs;
	Eq_2 dwArg04;
	Eq_2 eax_20 = GetModuleHandleA(0x00);
	if ((dwArg04 & 0xFFFF) != 0x00)
		g_dw407044 = 0x00;
	else
		g_dw407044 = 0x01;
	if (dwArg04 == 0x00)
		g_dw407044 = 0x00;
	if (g_dw407044 != 0x00)
		g_t407034.u0 = (Eq_910 (*)[]) dwArg04;
	Eq_2 eax_51 = LoadLibraryA(4222872);
	fn00401270(eax_51, 4222860);
	struct Eq_61 * esp_79;
	word32 eax_80;
	eax_51();
	if (eax_80 != 0x00)
		return 0x00;
	Eq_2 ecx_91 = g_t403000.u0;
	Eq_2 eax_94 = g_t403004.u0;
	Eq_2 dwLoc08_263 = 0x00;
	while (dwLoc08_263 < ecx_91)
	{
		dwLoc08_263.u7[525825] = (struct Eq_1090) (dwLoc08_263.u7[525825] ^ 22222);
		&dwLoc08_263.u0->u0 = (word32) dwLoc08_263 + 8;
	}
	esp_79->tFFFFFFFC.u0 = (Eq_910 (*)[]) eax_94;
	fn00401830(esp_79->tFFFFFFFC.u0);
	g_t407040.u0 = (Eq_910 (*)[]) eax_94;
	esp_79->tFFFFFFFC.u0 = (Eq_910 (*)[]) ecx_91;
	esp_79->tFFFFFFF8.u0 = g_t407040.u0;
	esp_79->ptrFFFFFFF4 = (byte *) g_a403008;
	fn004019E0(esp_79->ptrFFFFFFF4, esp_79->tFFFFFFF8.u0, esp_79->tFFFFFFFC.u0);
	g_dw407030 = edi;
	g_dw407028 = esi;
	g_dw40703C = ebx;
	g_ptr407048 = fs->ptr0018;
	g_ptr407038 = fp - 4;
	if (g_dw407044 != 0x00)
	{
		esp_79->tFFFFFFFC.u0 = (Eq_910 (*)[]) dwArg04;
		esp_79->tFFFFFFF8.u0 = (Eq_910 (*)[]) (0x00401234 - dwArg04);
		fn00401860(esp_79->tFFFFFFF8.u0, esp_79->tFFFFFFFC.u0);
	}
	else
	{
		esp_79->tFFFFFFFC.u0 = (Eq_910 (*)[]) eax_20;
		esp_79->tFFFFFFF8.u0 = (Eq_910 (*)[]) (0x00401234 - eax_20);
		fn00401860(esp_79->tFFFFFFF8.u0, esp_79->tFFFFFFFC.u0);
	}
	esp_79->tFFFFFFFC.u0 = g_t407040.u0;
	fn00401290(esp_79->tFFFFFFFC.u0);
	Eq_20 eax_207;
	g_ptr40704C();
	return eax_207;
}

// 00401270: void fn00401270(Stack Eq_2 dwArg04, Stack Eq_30 dwArg08)
// Called from:
//      Win32CrtStartup
//      fn00401290
void fn00401270(Eq_2 dwArg04, Eq_30 dwArg08)
{
	GetProcAddress(dwArg04, dwArg08);
}

// 00401290: void fn00401290(Stack Eq_2 dwArg04)
// Called from:
//      Win32CrtStartup
void fn00401290(Eq_2 dwArg04)
{
	ptr32 fp;
	<anonymous> * dwLoc14;
	struct Eq_199 * edx_16 = &(dwArg04.u0 + (dwArg04.u7)->dw003C / 4)->u0;
	struct Eq_204 * dwLoc2C_700 = &edx_16->w0014 + 2 + (word32) edx_16->w0014 / 84;
	Eq_2 eax_33 = VirtualAlloc(0x00, edx_16->t0050.u0, 0x3000, 0x40);
	if (eax_33 == 0x00)
		return;
	fn00401020(eax_33, dwArg04, dwArg04.u7->dw003C + 0x0138 + (word32) edx_16->w0006 *s 0x28);
	Eq_196 eax_68 = GetProcAddress(GetModuleHandleA(4222928), 4222912);
	Eq_196 eax_79 = GetProcAddress(GetModuleHandleA(4222964), 4222944);
	up32 dwLoc10_717;
	for (dwLoc10_717 = 0x00; dwLoc10_717 < (word32) edx_16->w0006; ++dwLoc10_717)
	{
		if (dwLoc2C_700->dw0014 != 0x00 && dwLoc2C_700->dw0010 != 0x00)
			fn00401020(eax_33 + Mem639[dwLoc2C_700 + 0x0C:word32], dwArg04 + Mem634[dwLoc2C_700 + 20:word32], CONVERT(CONVERT(Mem84[dwLoc2C_700 + 16:word32] - 1 + Mem84[edx_16 + 60:word32], word32, uint64) /u Mem84[edx_16 + 60:word32], word32, uint32) *s Mem84[edx_16 + 60:word32]);
		++dwLoc2C_700;
	}
	Eq_274 ecx_93 = &(eax_33.u0 + (eax_33.u7)->dw003C / 4)->u0;
	Eq_2 eax_114 = eax_79();
	if (eax_114 == 0x00)
		return;
	word32 dwLoc50_732 = eax_33 + Mem119[ecx_93 + 0x80:word32];
	while (dwLoc50_732.u0[4] != 0x00)
	{
		Eq_332 dwLoc38_789;
		Eq_333 dwLoc28_788;
		word32 eax_506 = LoadLibraryA(eax_33 + Mem128[dwLoc50_732 + 0x0C:word32]);
		if (dwLoc50_732.u1->t0000.u0 != 0x00)
		{
			dwLoc28_788 = eax_33 + Mem508[dwLoc50_732 + 0x00:word32];
			dwLoc38_789 = eax_33 + Mem524[dwLoc50_732 + 16:word32];
		}
		else
		{
			dwLoc28_788 = eax_33 + Mem508[dwLoc50_732 + 16:word32];
			dwLoc38_789 = eax_33 + Mem515[dwLoc50_732 + 0x00:word32];
		}
		word32 dwLoc1C_792 = 0x00;
		if (dwLoc50_732.u0[4] != 0x00 && ((dwLoc50_732.u1)->t0000).u0 != 0x00)
			dwLoc1C_792 = 0x01;
		while (dwLoc28_788.u6->t0000.u0 != 0x00)
		{
			if ((dwLoc28_788.u6->t0000.u0 & 0x80000000) != 0x00)
			{
				ui32 eax_571 = dwLoc28_788.u6->t0000.u0;
				fn00401270(eax_506, eax_571 & 0x7FFFFFFF);
				dwLoc28_788.u6->t0000.u0 = eax_571 & 0x7FFFFFFF;
			}
			else
			{
				word32 eax_558 = Mem540[dwLoc28_788 + 0x00:word32] + 2 + eax_33;
				fn00401270(eax_506, eax_558);
				dwLoc28_788.u6->t0000.u0 = (struct Eq_1109 *) eax_558;
			}
			if (dwLoc28_788.u6->t0000.u0 == 0x00)
				return;
			if (dwLoc1C_792 != 0x00)
				dwLoc38_789.u6->t0000.u0 = dwLoc28_788.u6->t0000.u0;
			dwLoc28_788 += 0x04;
			dwLoc38_789 += 0x04;
		}
		dwLoc50_732 += 0x14;
	}
	if (g_dw407044 != 0x00)
	{
		word32 edx_136 = g_t407034.u0 - ((ecx_93.u0)->t0034).u0;
		if (ecx_93.u0->dw00A4 != 0x00)
		{
			word32 dwLoc24_737 = eax_33 + Mem137[ecx_93 + 0xA0:word32];
			while (dwLoc24_737.u0[1] != 0x00)
			{
				uint32 edx_454 = dwLoc24_737.u0[1] - 0x08 >> 0x01;
				word32 dwLoc48_776 = dwLoc24_737 + 0x08;
				uint32 dwLoc10_777;
				for (dwLoc10_777 = 0x00; dwLoc10_777 < edx_454; ++dwLoc10_777)
				{
					if ((word32) *((word32) dwLoc48_776 + dwLoc10_777 * 0x02) >> 0x0C == 0x03)
						Mem494[eax_33 + Mem462[dwLoc24_737 + 0x00:word32] + (CONVERT(dwLoc48_776[dwLoc10_777 * 0x02], word16, word32) & 0x0FFF):word32] = Mem462[eax_33 + Mem462[dwLoc24_737 + 0x00:word32] + (CONVERT(dwLoc48_776[dwLoc10_777 * 0x02], word16, word32) & 0x0FFF):word32] + edx_136;
				}
				dwLoc24_737 += Mem462[dwLoc24_737 + 4:word32];
			}
		}
	}
	Eq_196 eax_162 = GetProcAddress(GetModuleHandleA(0x00407014), 0x00407004);
	if (g_dw407044 != 0x00)
		g_t407024.u0 = (Eq_910 (*)[]) eax_162();
	else
		g_t407024.u0 = (Eq_910 (*)[]) eax_162();
	struct Eq_533 * esp_225 = fp - 0x84;
	if (g_t407024.u0 == 0x00)
	{
		ptr32 esp_230;
		if (g_dw407044 != 0x00)
		{
			esp_230 = fp - 0x88;
			if (eax_68() == 0x00)
			{
				Eq_2 edx_279 = g_t407034.u0;
				word32 eax_283;
				dwLoc14();
				if (eax_283 == 0x00)
					return;
			}
		}
		else
		{
			esp_230 = fp - 0x88;
			if (eax_68() == 0x00)
			{
				Eq_2 eax_245 = ecx_93.u0->t0034.u0;
				word32 eax_249;
				dwLoc14();
				if (eax_249 == 0x00)
					return;
			}
		}
		if (g_dw407044 != 0x00)
		{
			struct Eq_682 * esp_327 = esp_230 - 4;
			esp_327->t0000.u0 = g_t407034.u0;
			esp_327->dwFFFFFFFC = 0x00;
			esp_327->dwFFFFFFF8 = 0x00;
			esp_327->dwFFFFFFF4 = 0x00;
			esp_327->dwFFFFFFF0 = 0x22;
			esp_327->tFFFFFFEC.u0 = (Eq_910 (*)[]) eax_114;
			g_t407024.u0 = (Eq_910 (*)[]) eax_162();
		}
		else
		{
			struct Eq_652 * esp_302 = esp_230 - 4;
			esp_302->t0000.u0 = ecx_93.u0->t0034.u0;
			esp_302->dwFFFFFFFC = 0x00;
			esp_302->dwFFFFFFF8 = 0x00;
			esp_302->dwFFFFFFF4 = 0x00;
			esp_302->dwFFFFFFF0 = 0x22;
			esp_302->tFFFFFFEC.u0 = (Eq_910 (*)[]) eax_114;
			g_t407024.u0 = (Eq_910 (*)[]) eax_162();
		}
		esp_225 = esp_230 - 24;
		if (g_t407024.u0 == 0x00)
		{
			if (g_dw407044 == 0x00)
			{
				esp_225->tFFFFFFFC = 0x40;
				esp_225->tFFFFFFF8 = 0x3000;
				esp_225->tFFFFFFF4.u0 = ecx_93.u0->t0050.u0;
				esp_225->tFFFFFFF0.u0 = ecx_93.u0->t0034.u0;
				g_t407024.u0 = (Eq_910 (*)[]) VirtualAlloc(esp_225->tFFFFFFF0, esp_225->tFFFFFFF4.u0, esp_225->tFFFFFFF8, esp_225->tFFFFFFFC);
			}
			else
			{
				esp_225->tFFFFFFFC = 0x40;
				esp_225->tFFFFFFF8 = 0x3000;
				esp_225->tFFFFFFF4.u0 = ecx_93.u0->t0050.u0;
				esp_225->tFFFFFFF0.u0 = g_t407034.u0;
				g_t407024.u0 = (Eq_910 (*)[]) VirtualAlloc(esp_225->tFFFFFFF0, esp_225->tFFFFFFF4.u0, esp_225->tFFFFFFF8, esp_225->tFFFFFFFC);
			}
		}
	}
	struct Eq_539 * esp_387 = esp_225 - 4;
	esp_387->t0000.u0 = (Eq_910 (*)[]) eax_114;
	CloseHandle(esp_387->t0000);
	esp_387->t0000.u0 = ecx_93.u0->t0050.u0;
	esp_387->tFFFFFFFC.u0 = (Eq_910 (*)[]) eax_33;
	esp_387->tFFFFFFF8.u0 = g_t407024.u0;
	fn00401020(esp_387->tFFFFFFF8.u0, esp_387->tFFFFFFFC.u0, esp_387->t0000.u0);
	if (g_dw407044 != 0x00)
	{
		Mem422[esp_387 + 0x00:word32] = Mem400[0x00407024<p32>:word32] + Mem400[ecx_93 + 40:word32];
		esp_387->tFFFFFFFC.u0 = g_t407034.u0;
		fn004017C0(esp_387->tFFFFFFFC.u0, esp_387->t0000.u0);
	}
	else
	{
		esp_387->t0000.u0 = g_t407024.u0;
		fn004019B0(esp_387->t0000.u0);
	}
	Mem442[0x0040704C<p32>:word32] = Mem437[0x00407024<p32>:word32] + Mem437[ecx_93 + 40:word32];
	ecx_93.u0->ptr0028 = g_ptr40704C;
}

// 004017C0: void fn004017C0(Stack Eq_2 dwArg04, Stack Eq_2 dwArg08)
// Called from:
//      fn00401290
void fn004017C0(Eq_2 dwArg04, Eq_2 dwArg08)
{
	struct Eq_796 * ecx_15 = g_ptr407048->ptr0030->ptr000C->ptr000C;
	struct Eq_796 * dwLoc0C_61 = ecx_15;
	while (dwLoc0C_61 != null)
	{
		if (dwLoc0C_61->t0018.u0 == dwArg04)
		{
			dwLoc0C_61->t001C.u0 = (Eq_910 (*)[]) dwArg08;
			return;
		}
		struct Eq_796 * eax_37 = dwLoc0C_61->ptr0000;
		dwLoc0C_61 = eax_37;
		if (eax_37 == ecx_15)
			return;
	}
}

// 00401830: void fn00401830(Stack Eq_2 dwArg04)
// Called from:
//      Win32CrtStartup
void fn00401830(Eq_2 dwArg04)
{
	VirtualAlloc(0x00, dwArg04, 0x3000, 0x04);
}

// 00401860: void fn00401860(Stack Eq_2 dwArg04, Stack Eq_2 dwArg08)
// Called from:
//      Win32CrtStartup
void fn00401860(Eq_2 dwArg04, Eq_2 dwArg08)
{
	Eq_2 dwLoc20_155;
	if (g_dw407044 != 0x00)
		&dwLoc20_155.u0->u0 = g_t407034.u0;
	else
		dwLoc20_155 = dwArg08;
	struct Eq_837 * eax_22 = &(dwLoc20_155.u0 + ((dwLoc20_155.u0))[0x0F].u0 / 4)->u0;
	g_t407024.u0 = (Eq_910 (*)[]) VirtualAlloc(0x00, eax_22->t0050.u0, 0x3000, 0x40);
	if (g_t407024.u0 == 0x00)
		return;
	fn00401020(g_t407024.u0, dwLoc20_155, eax_22->t0050.u0);
	int32 ecx_57 = g_t407024.u0 - dwLoc20_155;
	if (eax_22->dw00A4 != 0x00)
	{
		word32 dwLoc0C_167 = dwLoc20_155 + Mem58[eax_22 + 0xA0:word32];
		while (dwLoc0C_167.u1->t0004.u0 != 0x00)
		{
			uint32 ecx_94 = dwLoc0C_167.u1->t0004.u0 - 0x08 >> 0x01;
			word32 dwLoc1C_177 = dwLoc0C_167 + 0x08;
			uint32 dwLoc08_178;
			for (dwLoc08_178 = 0x00; dwLoc08_178 < ecx_94; ++dwLoc08_178)
			{
				if ((word32) *((word32) dwLoc1C_177 + dwLoc08_178 * 0x02) >> 0x0C == 0x03)
					Mem134[Mem102[0x00407024<p32>:word32] + Mem102[dwLoc0C_167 + 0x00:word32] + (CONVERT(dwLoc1C_177[dwLoc08_178 * 0x02], word16, word32) & 0x0FFF):word32] = Mem102[Mem102[0x00407024<p32>:word32] + Mem102[dwLoc0C_167 + 0x00:word32] + (CONVERT(dwLoc1C_177[dwLoc08_178 * 0x02], word16, word32) & 0x0FFF):word32] + ecx_57;
			}
			dwLoc0C_167 += Mem102[dwLoc0C_167 + 4:word32];
		}
	}
	word32 edx_75 = dwArg04 + Mem73[0x00407024<p32>:word32];
	edx_75();
}

// 004019B0: void fn004019B0(Stack Eq_2 dwArg04)
// Called from:
//      fn00401290
void fn004019B0(Eq_2 dwArg04)
{
	g_ptr407048->ptr0030->t0008.u0 = (Eq_910 (*)[]) dwArg04;
}

// 004019E0: void fn004019E0(Stack (ptr32 byte) dwArg04, Stack Eq_2 dwArg08, Stack Eq_2 dwArg0C)
// Called from:
//      Win32CrtStartup
void fn004019E0(byte * dwArg04, Eq_2 dwArg08, Eq_2 dwArg0C)
{
	Eq_948 tLoc20;
	Eq_949 tLoc10;
	Eq_2 dwLoc0C_129 = 0x01;
	byte cl_12 = *dwArg04;
	int32 dwLoc18_132 = 0x00;
	do
	{
		byte al_19 = Mem16[dwArg04 + dwLoc0C_129:byte];
		&dwLoc0C_129.u0->u0 = (word32) dwLoc0C_129 + 1;
		if ((word32) al_19 == (word32) cl_12)
		{
			if ((word32) dwArg04[(word32) dwLoc0C_129 + 1] == 0x00)
			{
				dwArg08.u5[dwLoc18_132] = cl_12;
				++dwLoc18_132;
				&dwLoc0C_129.u0->u0 = (word32) dwLoc0C_129 + 2;
			}
			else
			{
				int32 eax_60 = fn00401AE0(&tLoc10, dwArg04 + ((word32) dwLoc0C_129 + 1)) + ((word32) dwLoc0C_129 + 1);
				dwLoc0C_129 = fn00401AE0(&tLoc20, dwArg04 + eax_60) + eax_60;
				up32 dwLoc1C_147;
				for (dwLoc1C_147 = 0x00; dwLoc1C_147 < tLoc10; ++dwLoc1C_147)
				{
					dwArg08.u5[dwLoc18_132] = dwArg08.u5[dwLoc18_132 - tLoc20];
					++dwLoc18_132;
				}
			}
		}
		else
		{
			dwArg08.u5[dwLoc18_132] = al_19;
			++dwLoc18_132;
		}
	} while (dwLoc0C_129 < dwArg0C);
}

// 00401AE0: Register word32 fn00401AE0(Stack (ptr32 ui32) dwArg04, Stack (ptr32 byte) dwArg08)
// Called from:
//      fn004019E0
word32 fn00401AE0(ui32 * dwArg04, byte * dwArg08)
{
	ui32 dwLoc08_44 = 0x00;
	word32 dwLoc10_45 = 0x00;
	do
	{
		ui32 ecx_15 = (word32) *dwArg08;
		ui32 ecx_25 = ecx_15 & 0x7F | dwLoc08_44 << 0x07;
		++dwArg08;
		dwLoc08_44 = ecx_25;
		++dwLoc10_45;
	} while ((ecx_15 & 0x80) != 0x00);
	*dwArg04 = ecx_25;
	return dwLoc10_45;
}

word32 g_dw401B68 = 0x1B96; // 00401B68
word32 g_dw401B6C = 7078; // 00401B6C
word32 g_dw401B70 = 0x1BBA; // 00401B70
word32 g_dw401B74 = 0x1BCC; // 00401B74
word32 g_dw401B78 = 0x1BDA; // 00401B78
word32 g_dw401B7C = 7044; // 00401B7C
