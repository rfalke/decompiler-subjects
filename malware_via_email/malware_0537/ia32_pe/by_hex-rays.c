/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

// void __usercall sub_4010ED(int *@<eax>, int@<edx>, int@<ebx>, int@<edi>, int@<esi>, double@<st7>, double@<st6>, double@<st5>, double@<st4>, double@<st3>, double@<st2>, double@<st1>, double@<st0>);
// void __usercall sub_401155(__int32@<edi>);
// int __usercall sub_40119D@<eax>(int@<eax>, int@<ecx>, int@<ebx>, __int32@<edi>);
void sub_4011FD();
// double __usercall sub_401208@<st0>(int@<eax>, int@<edx>, int@<ebx>, int@<edi>, int@<esi>, double@<st7>, double@<st6>, double@<st5>, double@<st4>, double@<st3>, double@<st2>, double@<st1>, double result@<st0>);
void start();
void __thiscall sub_40129E(void *this);
_DWORD nullsub_1(); // weak
// void __usercall sub_402000(__int32@<eax>);
// void __usercall sub_40202D(int@<edx>, int@<ebx>, int@<edi>, int@<esi>);
// void __usercall sub_402044(int@<eax>, int _EBX@<ebx>, __int32@<edi>);
void sub_40205E();
// void __usercall sub_4020CC(int a1@<edx>, void **a2@<ecx>, int a3@<ebx>, _DWORD *a4@<edi>, int _ESI@<esi>);
// void __usercall sub_40215F(__int16@<ax>, int@<edx>, int@<ecx>, int@<ebx>, int@<edi>);
_DWORD sub_4021CE(); // weak
// void __usercall sub_402278(int@<eax>, int@<ecx>, int@<ebx>, int@<ebp>, int@<edi>, double@<st0>);
// void __usercall __noreturn sub_4022EB(__int32@<eax>);
// void __usercall sub_40237E(bool@<cf>, int@<ebx>);
// void __usercall sub_40239B(int@<edx>, __int32@<ecx>, int@<ebx>);
// void __usercall sub_4023F3(__int32@<eax>, int@<edx>, int@<ecx>, char@<bl>, int@<ebp>, __int16@<di>);
void __fastcall sub_40248D(int, int);
// char __userpurge sub_4024F8@<al>(char@<al>, int@<edx>, int@<ecx>, int@<ebx>, int@<edi>, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int);
// void __usercall sub_4025A3(int@<edx>, char@<ch>, int@<edi>);
// void __usercall sub_40269B(int@<esi>);
// void __usercall sub_4026B4(char@<cf>, int@<eax>, int@<edx>, int@<ecx>, int@<esi>);
// int __usercall sub_40274B@<eax>(int _EAX@<eax>, char@<ch>, int@<ebx>, int@<edi>);
// void __usercall sub_402938(char@<ah>, __int32@<edx>, int@<ecx>, int@<ebx>, __int16 _DI@<di>);
void sub_40296F();
_DWORD sub_402989(); // weak
int sub_402A50();
// void __usercall sub_402B45(char@<ah>, char@<dh>, int@<ebx>, int@<esi>);
void sub_402C99();
void sub_402CE0();
void sub_402D03();
void sub_402D64();
void sub_402DA6();
// void __usercall sub_402DDB(int@<eax>);
void sub_402E71();
void sub_402E91();
// void __usercall sub_402F07(char@<al>, int@<edx>, int@<ecx>, char@<bl>, int _EBP@<ebp>, __int16 _DI@<di>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401038; // weak
_UNKNOWN loc_4012BB; // weak
_UNKNOWN loc_402212; // weak
_UNKNOWN loc_402255; // weak
_UNKNOWN loc_402412; // weak
_UNKNOWN loc_40255C; // weak
_UNKNOWN loc_4026D1; // weak
_UNKNOWN loc_402711; // weak
_UNKNOWN loc_402795; // weak
_UNKNOWN loc_40286B; // weak
_UNKNOWN loc_4029AE; // weak
_UNKNOWN loc_402DFC; // weak


//----- (004010ED) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4010ED(
        int *a1@<eax>,
        int a2@<edx>,
        int a3@<ebx>,
        int a4@<edi>,
        int a5@<esi>,
        double a6@<st7>,
        double a7@<st6>,
        double a8@<st5>,
        double a9@<st4>,
        double a10@<st3>,
        double a11@<st2>,
        double a12@<st1>,
        double a13@<st0>)
{
  sub_401208(*a1, a2 + 1, a3, a5 | a4, a3 ^ (*a1 + a5), a6, a7, a8, a9, a10, a11, a12, a13);
  JUMPOUT(0x401226);
}
// 4010F1: positive sp value 4 has been found
// 401110: control flows out of bounds to 401226

//----- (00401155) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401155(__int32 a1@<edi>)
{
  __int32 v1; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v1, a1);
  JUMPOUT(0x40107D);
}
// 40115E: positive sp value 4 has been found
// 401301: control flows out of bounds to 40107D

//----- (0040119D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_40119D@<eax>(int a1@<eax>, int a2@<ecx>, int a3@<ebx>, __int32 a4@<edi>)
{
  int v4; // ecx
  __int32 v6; // [esp-10h] [ebp-10h] BYREF

  _InterlockedExchange(&v6, a4);
  v4 = (v6 ^ a3) + a2;
  if ( !a1 )
    JUMPOUT(0x40127C);
  return ((int (__thiscall *)(int))nullsub_1)(v4);
}
// 401353: positive sp value 10 has been found
// 40131C: control flows out of bounds to 40127C
// 401329: conditional instruction was optimized away because ebx.4>=0
// 40130D: using guessed type _DWORD nullsub_1();

//----- (004011FD) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4011FD()
{
  JUMPOUT(0x401336);
}
// 401201: positive sp value 4 has been found
// 401203: control flows out of bounds to 401336

//----- (00401208) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
double __usercall sub_401208@<st0>(
        int a1@<eax>,
        int a2@<edx>,
        int a3@<ebx>,
        int a4@<edi>,
        int a5@<esi>,
        double a6@<st7>,
        double a7@<st6>,
        double a8@<st5>,
        double a9@<st4>,
        double a10@<st3>,
        double a11@<st2>,
        double a12@<st1>,
        double result@<st0>)
{
  int v13; // esi
  int v15; // ecx
  int v16; // ecx
  int v17; // ebx
  int v18; // esi
  int v19; // edi
  int v20; // edx
  int v21; // ecx
  int v22; // edx
  int v23; // esi
  int v24; // edi
  int v25; // esi
  int v26; // ebx
  int v27; // ecx
  int v28; // esi
  __int32 v29; // edi
  int v30; // ebx
  char v31; // cf
  int v32; // eax
  int v34; // ecx
  int v35; // ecx
  int v36; // esi
  __int32 v37; // edi
  struct _PEB *v38; // eax
  int v39; // ecx
  bool v40; // zf
  int v41; // ecx
  int v42; // edi
  int v43; // ebx
  int v44; // ecx
  int v45; // edx
  void *v46; // ecx
  int v47; // esi
  int v48; // ebx
  int v49; // eax
  int v50; // edx
  int v51; // ecx
  int v52; // eax
  int v53; // edx
  int v54; // [esp-10h] [ebp-28h]
  int v55; // [esp-Ch] [ebp-24h]
  int v56; // [esp-8h] [ebp-20h]
  int v57; // [esp+0h] [ebp-18h]
  int v58; // [esp+14h] [ebp-4h]

  *(&v55 - 7) = v54;
  v46 = (void *)((a2 + a3) | a2);
  v47 = (a1 | a5) - 1;
  v48 = v47 ^ a2;
  sub_40129E(v46);
  if ( !v51 )
  {
    __asm { lock leave }
    JUMPOUT(0x4010D6);
  }
  MEMORY[0x6412DC0B] = v49;
  v52 = v49 & 0xEEEEEEEE;
  v53 = v50 - 1 - v48;
  v35 = v52 | v53;
  v36 = v53 + v47 - a4 - 1;
  v52 += 286331154;
  v29 = v52 + (v53 ^ (v53 | a4));
  v30 = v36 ^ v35;
  v32 = sub_40119D(v52, v30, v30, v29);
  if ( !v31 )
  {
    __asm { rcl     dl, 43h }
    ((void (__usercall *)(int@<ecx>, int@<edx>, double@<st0>, double@<st1>, double@<st2>, double@<st3>, double@<st4>, double@<st5>, double@<st6>))loc_401038)(
      (v32 + 1) | v34,
      (v30 + 1) | _EDX,
      result,
      a12,
      a11,
      a10,
      a9,
      a8,
      a7);
    *(_BYTE *)(v58 + 43) = BYTE1(v57);
    JUMPOUT(0x4010C5);
  }
  v25 = v36 - v34;
  v26 = v30 - v25;
  v27 = v34 + 1;
  v28 = v29 + v26 + v25 + 1;
  v37 = v29 - v26;
  v38 = NtCurrentPeb();
  v39 = (v28 - v37) ^ v27;
  v40 = (struct _PEB *)((char *)v38 + v39) == 0;
  v41 = (int)v38 + v39;
  if ( !v41 || !v40 )
  {
    v42 = v41;
    v43 = 2 * v41;
    v44 = 2 * v41 + 1;
    v13 = v44 | v42;
    sub_4010ED((int *)v38->ProcessHeaps, v44 | v42, v43 - v44, v42, v44 | v42, a6, a7, a8, a9, a10, a11, a12, result);
    __asm { rep out 1Dh, al }
    v16 = v56 + v15;
    v17 = v13;
    v18 = v13 - (v16 ^ (v56 + v42 + 1));
    v19 = _EAX - v17;
    v20 = -_EAX - (v16 + 1);
    v21 = v18;
    v22 = (_EAX - v17) ^ v20;
    v23 = v18 | (v18 - v17);
    LOWORD(v17) = v17 - 1;
    v24 = v23 | v19;
    LOBYTE(v22) = _EAX | v22;
    BYTE1(v22) = -120;
    BYTE1(v21) += BYTE1(_EAX) + BYTE1(v17);
    v45 = v21 ^ (v24 + v22);
    ++BYTE1(v21);
    BYTE1(v45) = BYTE1(v45) + 1 - (((unsigned __int8)(62 - v17) < (unsigned __int8)(((_BYTE)v17 != 62) + 30)) - 36);
    ((void (__usercall *)(int@<ecx>, int@<edx>, double@<st0>, double@<st1>, double@<st2>, double@<st3>, double@<st4>, double@<st5>, double@<st6>, double@<st7>))loc_4012BB)(
      v21,
      v24 + v45,
      result,
      a12,
      a11,
      a10,
      a9,
      a8,
      a7,
      a6);
    JUMPOUT(0x4011F9);
  }
  sub_401155(v37);
  return result;
}
// 4010D3: positive sp value 28 has been found
// 4010E8: control flows out of bounds to 4010E9
// 4011F4: control flows out of bounds to 4011F9
// 4010E2: control flows out of bounds to 4010C5
// 40118F: control flows out of bounds to 4010D6
// 40106F: conditional instruction was optimized away because dl.1>=0
// 40121E: variable 'v51' is possibly undefined
// 401221: variable 'v49' is possibly undefined
// 401228: variable 'v50' is possibly undefined
// 401081: variable 'v34' is possibly undefined
// 4010C1: variable 'v31' is possibly undefined
// 4010C7: variable '_EDX' is possibly undefined
// 40101D: variable 'v15' is possibly undefined
// 401056: variable '_EAX' is possibly undefined

//----- (00401248) --------------------------------------------------------
void start()
{
  JUMPOUT(0x40101D);
}
// 401258: control flows out of bounds to 40101D

//----- (0040129E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __thiscall sub_40129E(void *this)
{
  __int32 v1; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v1, (__int32)this);
  JUMPOUT(0x401107);
}
// 401263: positive sp value 4 has been found
// 40126F: control flows out of bounds to 401107

//----- (00402000) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402000(__int32 a1@<eax>)
{
  void (*v1)(void); // [esp-8h] [ebp-8h] BYREF

  _InterlockedExchange((volatile __int32 *)&v1, a1);
  v1();
  JUMPOUT(0x4024AA);
}
// 402026: positive sp value 8 has been found
// 402016: control flows out of bounds to 4024AA
// 40201F: conditional instruction was optimized away because bh.1!=0

//----- (0040202D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40202D(int a1@<edx>, int a2@<ebx>, int a3@<edi>, int a4@<esi>)
{
  int v4; // edx
  int v5; // esi
  int v6; // ebx
  int v7; // eax
  int v8; // [esp+Ch] [ebp-8h]
  int v9; // [esp+10h] [ebp-4h]

  *(&v9 - 6) = v8;
  v4 = a3 + a1;
  v5 = a4 - v4;
  LOBYTE(a2) = BYTE1(a2);
  ++v4;
  LOBYTE(v4) = -41;
  BYTE1(a2) = 89;
  v6 = v4 ^ a2;
  sub_402E71();
  LOBYTE(v6) = 49;
  *(_DWORD *)(v7 + 93) *= 2;
  BYTE1(v6) = -BYTE1(v6);
  sub_40269B(a3 + (a3 ^ v5));
  *(_BYTE *)(v6 + 1015653711) += 36;
  JUMPOUT(0x4021B7);
}
// 402641: positive sp value 8 has been found
// 40265E: control flows out of bounds to 402660
// 40264B: control flows out of bounds to 4021B7
// 40265C: control flows out of bounds to 40261C
// 402656: conditional instruction was optimized away because esi.4!=0
// 40261A: variable 'v7' is possibly undefined

//----- (00402044) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402044(int a1@<eax>, int _EBX@<ebx>, __int32 a3@<edi>)
{
  __int32 v4; // [esp-8h] [ebp-8h] BYREF

  _InterlockedExchange(&v4, a3);
  __asm { rep mov ebx, ebx }
  sub_402DDB(~a1);
  JUMPOUT(0x402F8B);
}
// 402349: positive sp value 8 has been found
// 40234C: control flows out of bounds to 402F8B

//----- (0040205E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40205E()
{
  JUMPOUT(0x402EDD);
}
// 402062: positive sp value 4 has been found
// 40206B: control flows out of bounds to 402EDD
// 402073: conditional instruction was optimized away because ebx.4>=0

//----- (004020CC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4020CC(int a1@<edx>, void **a2@<ecx>, int a3@<ebx>, _DWORD *a4@<edi>, int _ESI@<esi>)
{
  bool v5; // cf
  __int16 v6; // bx
  int v7; // esi
  unsigned int v8; // eax
  int v9; // edx
  char v10; // ch
  char v11; // sf
  char v12; // of
  _DWORD *v13; // esi
  __int16 v14; // bx
  unsigned int v15; // eax
  __int16 v16; // bx
  int v17; // edx
  void **v18; // [esp-4h] [ebp-4h]
  void *retaddr; // [esp+0h] [ebp+0h] BYREF

  v18 = a2;
  BYTE1(a3) -= BYTE1(a1);
  BYTE1(a1) = (_BYTE)a2;
  sub_40202D(a1, a3, (int)a4, _ESI);
  LOBYTE(v17) = a3 | v17;
  BYTE1(a3) -= 69;
  v16 = (_WORD)a4 + a3;
  BYTE1(v17) = __CFADD__(HIBYTE(v16), BYTE1(v15) | -BYTE1(v17)) + HIBYTE(v16) + (BYTE1(v15) | -BYTE1(v17)) + 126;
  if ( !__SETP__(BYTE1(v17), 0) && __SETP__(BYTE1(v17), 0) )
  {
    __outdword(v17, v15);
    __debugbreak();
    __asm { rcr     dword ptr [esi+34h], 0DBh }
    ((void (__cdecl *)(_DWORD, void **))sub_4021CE)(*(_DWORD *)(v17 + 8), v18);
    ((void (*)(void))loc_402255)();
    sub_402E91();
    JUMPOUT(0x402AFF);
  }
  HIBYTE(v16) = -HIBYTE(v16);
  BYTE1(v17) = -BYTE1(v17);
  LOBYTE(v17) = (BYTE1(v17) != 0) + v17 - 24;
  LOBYTE(v16) = HIBYTE(v16) ^ v16;
  BYTE1(v17) = BYTE1(v17) - 1 + 48;
  v8 = v15 ^ 0x986DD6D2;
  v7 = (v17 - _ESI) ^ _ESI;
  v5 = (unsigned __int8)v16 < 0x67u;
  LOBYTE(v16) = v16 - 103;
  HIBYTE(v16) -= v5 - 32;
  v6 = v16 + 1;
  do
  {
    v7 = (v8 ^ v7) + 1;
    sub_40205E();
    v18 = &retaddr;
  }
  while ( v11 != v12 );
  LOBYTE(v9) = *(_BYTE *)(v8 + 2) & v9;
  v13 = (_DWORD *)(v7 - v8);
  LOBYTE(v6) = v6 - 1;
  v14 = v6 - 1;
  LOBYTE(v14) = -(char)v14;
  sub_4025A3(v9, v10, (int)a4);
  *a4 = *v13;
  __indword(v14 - 1);
  JUMPOUT(0x4020CB);
}
// 4020B1: positive sp value 4 has been found
// 4020CA: control flows out of bounds to 4020CB
// 402861: control flows out of bounds to 402863
// 402AFA: control flows out of bounds to 402AFF
// 402D58: control flows out of bounds to 402D5E
// 402EFB: control flows out of bounds to 402F01
// 402A43: control flows out of bounds to 402292
// 402A17: control flows out of bounds to 4029AA
// 402D48: control flows out of bounds to 40253B
// 402EC1: control flows out of bounds to 4027DA
// 402132: conditional instruction was optimized away because bh.1>=0
// 402A0F: conditional instruction was optimized away because bl.1!=0
// 4020EB: variable 'v17' is possibly undefined
// 4020F2: variable 'v15' is possibly undefined
// 4020A9: variable 'v8' is possibly undefined
// 4020B2: variable 'v11' is possibly undefined
// 4020B2: variable 'v12' is possibly undefined
// 4020B4: variable 'v9' is possibly undefined
// 4020C0: variable 'v10' is possibly undefined
// 4021CE: using guessed type _DWORD sub_4021CE();

//----- (0040215F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40215F(__int16 a1@<ax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>)
{
  int v5; // edi
  bool v6; // zf
  int v7; // edx
  int v8; // edx
  int v9; // [esp-EA66h] [ebp-EA66h]
  int v10; // [esp-EA62h] [ebp-EA62h]
  int v11; // [esp-EA5Eh] [ebp-EA5Eh]
  int v12; // [esp-EA5Ah] [ebp-EA5Ah]
  int v13; // [esp-EA56h] [ebp-EA56h]
  int v14; // [esp-EA52h] [ebp-EA52h]
  int v15; // [esp-EA4Eh] [ebp-EA4Eh]
  int v16; // [esp-EA4Ah] [ebp-EA4Ah]
  int v17; // [esp-EA46h] [ebp-EA46h]
  int v18; // [esp-EA42h] [ebp-EA42h]
  int v19; // [esp-EA3Eh] [ebp-EA3Eh]
  int v20; // [esp-EA3Ah] [ebp-EA3Ah]
  int v21; // [esp-EA36h] [ebp-EA36h]
  int v22; // [esp-EA32h] [ebp-EA32h]
  int v23; // [esp-EA2Eh] [ebp-EA2Eh]
  int v24; // [esp-EA2Ah] [ebp-EA2Ah]
  int v25; // [esp-EA26h] [ebp-EA26h]
  int v26; // [esp-EA22h] [ebp-EA22h]
  int v27; // [esp-EA1Eh] [ebp-EA1Eh]
  int v28; // [esp-EA1Ah] [ebp-EA1Ah]
  int v29; // [esp-EA16h] [ebp-EA16h]
  int v30; // [esp-EA12h] [ebp-EA12h]
  int v31; // [esp-EA0Eh] [ebp-EA0Eh]
  int v32; // [esp-EA0Ah] [ebp-EA0Ah]
  int v33; // [esp-EA06h] [ebp-EA06h]
  int v34; // [esp-EA02h] [ebp-EA02h]
  int v35; // [esp-E9FEh] [ebp-E9FEh]
  int v36; // [esp-E9FAh] [ebp-E9FAh]
  int v37; // [esp-E9F6h] [ebp-E9F6h]
  int v38; // [esp-E9F2h] [ebp-E9F2h]
  int v39; // [esp-E9EEh] [ebp-E9EEh]
  int v40; // [esp-E9EAh] [ebp-E9EAh]
  int v41; // [esp-E9E6h] [ebp-E9E6h]
  int v42; // [esp-E9E2h] [ebp-E9E2h]
  int v43; // [esp-E9DEh] [ebp-E9DEh]
  int v44; // [esp-E9DAh] [ebp-E9DAh]
  int v45; // [esp-E9D6h] [ebp-E9D6h]
  int v46; // [esp-E9D2h] [ebp-E9D2h]
  int v47; // [esp-E9CEh] [ebp-E9CEh]
  int v48; // [esp-E9CAh] [ebp-E9CAh]
  int v49; // [esp-E9C6h] [ebp-E9C6h]
  int v50; // [esp-E9C2h] [ebp-E9C2h]
  int v51; // [esp-E9BEh] [ebp-E9BEh]
  int v52; // [esp-E9BAh] [ebp-E9BAh]
  int v53; // [esp-E9B6h] [ebp-E9B6h]
  int v54; // [esp-E9B2h] [ebp-E9B2h]
  int v55; // [esp-E9AEh] [ebp-E9AEh]
  int v56; // [esp-E9AAh] [ebp-E9AAh]
  int v57; // [esp-E9A6h] [ebp-E9A6h]
  int v58; // [esp-E9A2h] [ebp-E9A2h]
  int v59; // [esp-E99Eh] [ebp-E99Eh]
  int v60; // [esp-E99Ah] [ebp-E99Ah]
  int v61; // [esp-E996h] [ebp-E996h]
  int v62; // [esp-E992h] [ebp-E992h]
  int v63; // [esp-E98Eh] [ebp-E98Eh]
  int v64; // [esp-E98Ah] [ebp-E98Ah]
  int v65; // [esp-E986h] [ebp-E986h]
  int v66; // [esp-E982h] [ebp-E982h]
  void *retaddr[2]; // [esp+0h] [ebp+0h]

  v5 = a5 + 1;
  BYTE1(a2) += 115;
  LOBYTE(a2) = (HIBYTE(a1) | 0xC4) + 1;
  v6 = a2 == -1;
  v7 = a2 + 1;
  if ( !v6 && v6 )
  {
    MEMORY[0xCBFE7554] |= HIBYTE(a1);
    JUMPOUT(0x402CC1);
  }
  BYTE1(v7) = ~(a1 + BYTE1(v7));
  v8 = a4 + v7 + 1;
  LOBYTE(v8) = -(char)v8;
  BYTE1(v8) = BYTE1(a4) ^ (BYTE1(v8) - 102);
  sub_4024F8(
    a1,
    v8,
    a3,
    a4,
    v5,
    v9,
    v10,
    v11,
    v12,
    v13,
    v14,
    v15,
    v16,
    v17,
    v18,
    v19,
    v20,
    v21,
    v22,
    v23,
    v24,
    v25,
    v26,
    v27,
    v28,
    v29,
    v30,
    v31,
    v32,
    v33,
    v34,
    v35,
    v36,
    v37,
    v38,
    v39,
    v40,
    v41,
    v42,
    v43,
    v44,
    v45,
    v46,
    v47,
    v48,
    v49,
    v50,
    v51,
    v52,
    v53,
    v54,
    v55,
    v56,
    v57,
    v58,
    v59,
    v60,
    v61,
    v62,
    v63,
    v64,
    v65,
    v66);
  MK_FP(retaddr[0], retaddr[0])();
}
// 402C92: positive sp value EA6A has been found
// 40245C: control flows out of bounds to 402CC1
// 402C8D: variable 'v9' is possibly undefined
// 402C8D: variable 'v10' is possibly undefined
// 402C8D: variable 'v11' is possibly undefined
// 402C8D: variable 'v12' is possibly undefined
// 402C8D: variable 'v13' is possibly undefined
// 402C8D: variable 'v14' is possibly undefined
// 402C8D: variable 'v15' is possibly undefined
// 402C8D: variable 'v16' is possibly undefined
// 402C8D: variable 'v17' is possibly undefined
// 402C8D: variable 'v18' is possibly undefined
// 402C8D: variable 'v19' is possibly undefined
// 402C8D: variable 'v20' is possibly undefined
// 402C8D: variable 'v21' is possibly undefined
// 402C8D: variable 'v22' is possibly undefined
// 402C8D: variable 'v23' is possibly undefined
// 402C8D: variable 'v24' is possibly undefined
// 402C8D: variable 'v25' is possibly undefined
// 402C8D: variable 'v26' is possibly undefined
// 402C8D: variable 'v27' is possibly undefined
// 402C8D: variable 'v28' is possibly undefined
// 402C8D: variable 'v29' is possibly undefined
// 402C8D: variable 'v30' is possibly undefined
// 402C8D: variable 'v31' is possibly undefined
// 402C8D: variable 'v32' is possibly undefined
// 402C8D: variable 'v33' is possibly undefined
// 402C8D: variable 'v34' is possibly undefined
// 402C8D: variable 'v35' is possibly undefined
// 402C8D: variable 'v36' is possibly undefined
// 402C8D: variable 'v37' is possibly undefined
// 402C8D: variable 'v38' is possibly undefined
// 402C8D: variable 'v39' is possibly undefined
// 402C8D: variable 'v40' is possibly undefined
// 402C8D: variable 'v41' is possibly undefined
// 402C8D: variable 'v42' is possibly undefined
// 402C8D: variable 'v43' is possibly undefined
// 402C8D: variable 'v44' is possibly undefined
// 402C8D: variable 'v45' is possibly undefined
// 402C8D: variable 'v46' is possibly undefined
// 402C8D: variable 'v47' is possibly undefined
// 402C8D: variable 'v48' is possibly undefined
// 402C8D: variable 'v49' is possibly undefined
// 402C8D: variable 'v50' is possibly undefined
// 402C8D: variable 'v51' is possibly undefined
// 402C8D: variable 'v52' is possibly undefined
// 402C8D: variable 'v53' is possibly undefined
// 402C8D: variable 'v54' is possibly undefined
// 402C8D: variable 'v55' is possibly undefined
// 402C8D: variable 'v56' is possibly undefined
// 402C8D: variable 'v57' is possibly undefined
// 402C8D: variable 'v58' is possibly undefined
// 402C8D: variable 'v59' is possibly undefined
// 402C8D: variable 'v60' is possibly undefined
// 402C8D: variable 'v61' is possibly undefined
// 402C8D: variable 'v62' is possibly undefined
// 402C8D: variable 'v63' is possibly undefined
// 402C8D: variable 'v64' is possibly undefined
// 402C8D: variable 'v65' is possibly undefined
// 402C8D: variable 'v66' is possibly undefined

//----- (004021CE) --------------------------------------------------------
#error "4021E8: cannot convert to microcode (funcsize=11)"

//----- (00402278) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402278(int a1@<eax>, int a2@<ecx>, int a3@<ebx>, int a4@<ebp>, int a5@<edi>, double a6@<st0>)
{
  int v6; // edx
  __int32 v7; // eax
  int v8; // edi
  int v9; // eax
  void *v10; // [esp+14h] [ebp-4h]
  void *retaddr; // [esp+18h] [ebp+0h]

  *(&retaddr - 7) = v10;
  LOBYTE(a1) = a1 - a3;
  v6 = a1;
  v7 = a1 - 1;
  LOBYTE(a2) = a2 - BYTE1(v7);
  BYTE1(v6) |= a2;
  v8 = a5 - 1;
  sub_4023F3(v7, v6, a2, a3, a4, v8);
  BYTE1(a3) = __ROL1__(BYTE1(a3), 29) ^ 0xD4;
  v9 = ((int (__usercall *)@<eax>(double@<st0>))loc_402795)(a6 + (double)*(__int16 *)(v8 + 803488699));
  *(_DWORD *)(a3 + 8 * v9) &= a3;
  JUMPOUT(0x40254F);
}
// 40227C: positive sp value 4 has been found
// 402549: control flows out of bounds to 40254F
// 402840: control flows out of bounds to 402846
// 402D2B: control flows out of bounds to 402A1E
// 402836: control flows out of bounds to 402BEF
// 402840: conditional instruction was optimized away because edx.4!=0

//----- (004022EB) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_4022EB(__int32 a1@<eax>)
{
  sub_402000(a1);
  __halt();
}
// 4022EF: positive sp value 4 has been found

//----- (0040237E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40237E(bool a1@<cf>, int a2@<ebx>)
{
  unsigned __int8 v2; // tt
  int v3; // ebx

  BYTE1(a2) -= a1 - 74;
  v3 = a2 + 1;
  a1 = __CFADD__(BYTE1(v3), -76);
  BYTE1(v3) -= 76;
  v2 = (__CFADD__(a1, v3 - 40) | __CFADD__(a1 + v3 - 40, 50)) - 63;
  a1 = BYTE1(v3) < v2;
  BYTE1(v3) -= v2;
  LOBYTE(v3) = BYTE1(v3) - (a1 + 25) - ((BYTE1(v3) < (unsigned __int8)(a1 + 25)) + 53);
  if ( !__OFSUB__(v3, 1) && __OFSUB__(v3, 1) )
    JUMPOUT(0x402379);
  JUMPOUT(0x402B2F);
}
// 4022D4: positive sp value 4 has been found
// 402378: control flows out of bounds to 402379
// 402B2D: control flows out of bounds to 402B2F

//----- (0040239B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40239B(int a1@<edx>, __int32 a2@<ecx>, int a3@<ebx>)
{
  __int32 v3; // ecx
  __int32 v4; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v4, a2);
  v3 = v4;
  BYTE1(a1) -= a3;
  LOBYTE(a1) = a1 + 1;
  LOBYTE(a3) = a3 - 1;
  BYTE1(v3) = 120;
  ((void (__fastcall *)(__int32, int, _DWORD))((char *)&loc_402DFC + 4))(a3 | v3, a1, 0);
  JUMPOUT(0x4023B9);
}
// 4023A1: positive sp value 4 has been found
// 4023B4: control flows out of bounds to 4023B9

//----- (004023F3) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4023F3(__int32 a1@<eax>, int a2@<edx>, int a3@<ecx>, char a4@<bl>, int a5@<ebp>, __int16 a6@<di>)
{
  __int32 v6; // eax
  __int32 v7; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v7, a1);
  v6 = v7;
  v7 = 64;
  ++v6;
  BYTE1(v6) = BYTE1(a3) + (BYTE1(a2) ^ BYTE1(v6));
  LOBYTE(v6) = -(char)v6;
  sub_402F07(v6, v6 + a2, a3, a4, a5, a6);
}
// 4023FA: positive sp value 4 has been found

//----- (0040248D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_40248D(int a1, int a2)
{
  ((double (__fastcall *)(int, int))sub_402989)(a1, a2);
}
// 40249F: positive sp value 8 has been found
// 402989: using guessed type _DWORD sub_402989();

//----- (004024F8) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
char __userpurge sub_4024F8@<al>(
        char a1@<al>,
        int a2@<edx>,
        int a3@<ecx>,
        int a4@<ebx>,
        int a5@<edi>,
        int a6,
        int a7,
        int a8,
        int a9,
        int a10,
        int a11,
        int a12,
        int a13,
        int a14,
        int a15,
        int a16,
        int a17,
        int a18,
        int a19,
        int a20,
        int a21,
        int a22,
        int a23,
        int a24,
        int a25,
        int a26,
        int a27,
        int a28,
        int a29,
        int a30,
        int a31,
        int a32,
        int a33,
        int a34,
        int a35,
        int a36,
        int a37,
        int a38,
        int a39,
        int a40,
        int a41,
        int a42,
        int a43,
        int a44,
        int a45,
        int a46,
        int a47,
        int a48,
        int a49,
        int a50,
        int a51,
        int a52,
        int a53,
        int a54,
        int a55,
        int a56,
        int a57,
        int a58,
        int a59,
        int a60,
        int a61,
        int a62,
        int a63)
{
  bool v64; // of
  int v68; // edx
  int v69; // edx
  int v70; // ecx
  int v71; // edx
  __int16 v72; // ax
  int v74; // ecx
  int v75; // ecx
  int v76; // edx
  int v77; // edx

  _EDX = a4 ^ a2;
  BYTE1(_EDX) |= a1;
  v64 = __OFADD__(1, BYTE1(_EDX)++);
  if ( v64 || !v64 )
  {
    v70 = a3 + 1;
    LOBYTE(_EDX) = _EDX - BYTE1(a4);
    v71 = _EDX - 1;
    LOBYTE(v71) = BYTE1(v70) - 25;
    BYTE1(v71) = a1 ^ ((a4 ^ BYTE1(v71)) - 73);
    v72 = ((int (__fastcall *)(int, int))loc_402212)(v70, v71);
    __asm { repne pop ebp }
    *(_BYTE *)a5 = v72;
    v75 = *(_DWORD *)(a5 + 199763013) | (v74 - 1);
    __asm { icebp }
    v77 = a4 ^ v76;
    LOBYTE(v77) = v77 - 50;
    ++v77;
    BYTE1(v77) = ~BYTE1(v77);
    --v77;
    LOBYTE(v77) = ~(_BYTE)v77;
    BYTE1(v77) = BYTE1(a4) - BYTE1(v77) + 10 - v77;
    LOBYTE(v77) = v77 + 98;
    v68 = v72 ^ v77;
    BYTE1(v68) -= v72;
    LOBYTE(v68) = a4;
    v69 = v75 ^ (v68 - 1);
    LOBYTE(v69) = a4 ^ v69;
    ((void (__fastcall *)(int, int))((char *)&loc_4026D1 + 6))(v75, v69);
    return -96;
  }
  else
  {
    __asm { insb }
    return a4;
  }
}
// 402516: positive sp value 8 has been found
// 402E38: variable 'v74' is possibly undefined
// 402E41: variable 'v76' is possibly undefined
// 4024F8: too many input arguments, some ignored

//----- (004025A3) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4025A3(int a1@<edx>, char a2@<ch>, int a3@<edi>)
{
  _DWORD *v3; // edi
  char v4; // bl
  char v5; // cf
  int v6; // eax

  v3 = (_DWORD *)(a1 | a3);
  v4 = 1 - (a2 - 1);
  sub_402D03();
  if ( v5 + v6 + 292486113 >= 0 )
    JUMPOUT(0x4025C7);
  --*v3;
  *(_BYTE *)v3 = v4;
  JUMPOUT(0x40255C);
}
// 402550: positive sp value 8 has been found
// 4025C5: control flows out of bounds to 4025C7
// 40255B: control flows out of bounds to 40255C
// 4025C0: variable 'v5' is possibly undefined
// 4025C0: variable 'v6' is possibly undefined

//----- (0040269B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40269B(int a1@<esi>)
{
  unsigned int v1; // eax
  int v2; // edx
  int v3; // ecx
  int v4; // [esp+28h] [ebp-8h]
  int v5; // [esp+2Ch] [ebp-4h]

  *(&v5 - 13) = v4;
  v1 = sub_402A50();
  sub_4026B4(v1 < 0x1C92BDD9, v1, v2, v3, a1);
}
// 4026AE: positive sp value 8 has been found
// 40269B: could not find valid save-restore pair for ebp
// 4026B3: variable 'v2' is possibly undefined
// 4026B3: variable 'v3' is possibly undefined

//----- (004026B4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4026B4(char a1@<cf>, int a2@<eax>, int a3@<edx>, int a4@<ecx>, int a5@<esi>)
{
  int v5; // edx
  int v6; // esi
  void *v7; // [esp+8h] [ebp-4h]
  void *retaddr; // [esp+Ch] [ebp+0h]

  *(&retaddr - 4) = v7;
  LOBYTE(a3) = a3 - (a1 + 117);
  v5 = a2 + a3;
  v6 = a2 + a5;
  LOBYTE(v5) = (BYTE1(a2) ^ v5) + 39;
  BYTE1(v5) = a4 + (a2 | v5 ^ 0x9E);
  ((void (__fastcall *)(int, int))loc_40255C)(a4, v5);
  *(_DWORD *)(v6 - 1027497539) ^= 0xFFFFFF8D;
  JUMPOUT(0x4026D8);
}
// 4026B8: positive sp value 4 has been found
// 4026D1: control flows out of bounds to 4026D8

//----- (0040274B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_40274B@<eax>(int _EAX@<eax>, char a2@<ch>, int a3@<ebx>, int a4@<edi>)
{
  bool v4; // cf
  void *v10; // [esp+2Ch] [ebp-4h]
  void *retaddr[2]; // [esp+30h] [ebp+0h]

  retaddr[-13] = v10;
  BYTE1(a3) = -BYTE1(a3);
  LOBYTE(a3) = (a2 ^ a3)
             + 1
             - ((BYTE1(a3) != 0)
              - 36)
             - (((unsigned __int8)((a2 ^ a3) + 1) < (unsigned __int8)((BYTE1(a3) != 0) - 36))
              + 54);
  v4 = __CFADD__(a3, a4);
  _EDI = a3 + a4;
  if ( v4 )
    goto LABEL_4;
  __asm { rep lea edi, [edi] }
  if ( !v4 )
LABEL_4:
    JUMPOUT(0x40218A);
  __asm
  {
    aam     45h ; 'E'
    aam     0A4h ; '¤'
  }
  return MK_FP(retaddr[0], retaddr[0])();
}
// 40274F: positive sp value 4 has been found
// 402761: control flows out of bounds to 40218A

//----- (00402938) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402938(char a1@<ah>, __int32 a2@<edx>, int a3@<ecx>, int a4@<ebx>, __int16 _DI@<di>)
{
  __int32 v6; // ecx
  __int32 v8; // [esp-8h] [ebp-8h] BYREF

  _InterlockedExchange(&v8, a2);
  __asm { rep pop edx }
  BYTE1(a4) += 72;
  __asm { repne lea di, [edi] }
  BYTE1(_EDX) = BYTE1(a4) | HIBYTE(_DI);
  BYTE1(a4) = ~BYTE1(a4);
  sub_402B45(a1, SBYTE1(_EDX), a4, a3);
  v8 = v6;
  JUMPOUT(0x402ACD);
}
// 402C74: positive sp value 8 has been found
// 402ACA: control flows out of bounds to 402ACD
// 402C76: control flows out of bounds to 402C79
// 402AC9: variable 'v6' is possibly undefined

//----- (0040296F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40296F()
{
  char v0; // pf
  void *v1; // [esp+4h] [ebp-4h]
  void *retaddr; // [esp+8h] [ebp+0h]

  *(&retaddr - 3) = v1;
  ((void (*)(void))((char *)&loc_402711 + 1))();
  if ( v0 )
    JUMPOUT(0x402B25);
  JUMPOUT(0x402B2A);
}
// 402973: positive sp value 4 has been found
// 402B23: control flows out of bounds to 402B25
// 402B1E: control flows out of bounds to 402B2A
// 402B1E: variable 'v0' is possibly undefined

//----- (00402989) --------------------------------------------------------
#error "402802: cannot convert to microcode (funcsize=55)"

//----- (00402A50) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int sub_402A50()
{
  void *retaddr[2]; // [esp+0h] [ebp+0h]

  ((void (*)(void))loc_40286B)();
  return MK_FP(retaddr[0], retaddr[0])();
}
// 402A54: positive sp value 4 has been found

//----- (00402B45) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402B45(char a1@<ah>, char a2@<dh>, int a3@<ebx>, int a4@<esi>)
{
  int v4; // esi

  v4 = (a3 ^ a4) - 1;
  if ( !(((char)(a1 + a2 + 1) < 0) ^ __OFADD__(1, a1 + a2) | (a1 + a2 == -1))
    && ((char)(a1 + a2 + 1) < 0) ^ __OFADD__(1, a1 + a2) | (a1 + a2 == -1) )
  {
    _EAX = v4;
    __asm { aad     67h ; 'g' }
    if ( !__SETP__(0, 0) && __SETP__(0, 0) )
      JUMPOUT(0x402B3D);
    sub_402CE0();
    JUMPOUT(0x402824);
  }
  JUMPOUT(0x402234);
}
// 402810: positive sp value 4 has been found
// 402823: control flows out of bounds to 402824
// 402C43: control flows out of bounds to 402C49
// 402B9D: control flows out of bounds to 402234
// 402B39: control flows out of bounds to 4025E0
// 402B7F: control flows out of bounds to 402B3D
// 402B7F: conditional instruction was optimized away because dh.1==0

//----- (00402BC4) --------------------------------------------------------
#error "402BC4: stack frame is too big (funcsize=0)"

//----- (00402C99) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402C99()
{
  JUMPOUT(0x40291D);
}
// 402CA1: positive sp value 4 has been found
// 402CD6: control flows out of bounds to 4028AC
// 402CB3: control flows out of bounds to 40291D

//----- (00402CE0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402CE0()
{
  JUMPOUT(0x40213C);
}
// 402CE4: positive sp value 4 has been found
// 402CF8: control flows out of bounds to 40213C

//----- (00402D03) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402D03()
{
  JUMPOUT(0x4022B6);
}
// 4027D9: positive sp value C has been found
// 4027E4: control flows out of bounds to 402118
// 4027C5: control flows out of bounds to 4022B6
// 4027CD: conditional instruction was optimized away because edi.4>=1

//----- (00402D64) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402D64()
{
  JUMPOUT(0x402340);
}
// 402D68: positive sp value 4 has been found
// 402F67: control flows out of bounds to 402340

//----- (00402DA6) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402DA6()
{
  int v0; // ebx
  __int32 v1; // ecx
  char v2; // cf
  char v3; // al
  __int32 v4; // eax
  int *v5; // edx
  int v6; // eax
  __int32 v7; // [esp-4h] [ebp-4h] BYREF

  sub_40296F();
  LOBYTE(v4) = v3 - (v2 + 3);
  _InterlockedExchange(&v7, v4);
  v6 = *v5;
  LOBYTE(v5) = BYTE1(v5);
  v0 = v6;
  LOBYTE(v0) = v6 - 1;
  BYTE1(v1) = v6 - 1;
  sub_40239B((int)v5, v1, v0);
}
// 40258E: positive sp value 8 has been found
// 402DC3: variable 'v3' is possibly undefined
// 402DC3: variable 'v2' is possibly undefined
// 402DC5: variable 'v4' is possibly undefined
// 402DD0: variable 'v5' is possibly undefined
// 402599: variable 'v1' is possibly undefined

//----- (00402DDB) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402DDB(int a1@<eax>)
{
  __int32 v1; // eax

  if ( !a1 )
  {
    ((void (*)(void))loc_402412)();
    v1 = MEMORY[0x87FA72BD]();
    LOBYTE(v1) = v1 ^ 0x24;
    __asm { repne pop esi }
    sub_4022EB(v1);
  }
  JUMPOUT(0x402AF6);
}
// 402E08: positive sp value 8 has been found
// 402DE6: control flows out of bounds to 402AF6

//----- (00402E71) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402E71()
{
  void *v0; // [esp+24h] [ebp-4h]
  void *retaddr; // [esp+28h] [ebp+0h]

  *(&retaddr - 11) = v0;
  JUMPOUT(0x4020EB);
}
// 402469: positive sp value 4 has been found
// 402481: control flows out of bounds to 4020EB

//----- (00402E91) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402E91()
{
  JUMPOUT(0x4021F5);
}
// 402E95: positive sp value 4 has been found
// 402EA1: control flows out of bounds to 4021F5

//----- (00402F07) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402F07(char a1@<al>, int a2@<edx>, int a3@<ecx>, char a4@<bl>, int _EBP@<ebp>, __int16 _DI@<di>)
{
  void *v6; // [esp+8h] [ebp-4h]
  void *retaddr; // [esp+Ch] [ebp+0h]

  *(&retaddr - 4) = v6;
  LOBYTE(a3) = a4 + a3;
  BYTE1(a2) -= a1;
  ((void (__fastcall *)(int, int))((char *)&loc_4029AE + 4))(a3, a2);
  __asm { arpl    [ebp+489F2BDh], di }
  JUMPOUT(0x402F24);
}
// 402F0B: positive sp value 4 has been found
// 402F1E: control flows out of bounds to 402F24

// nfuncs=41 queued=40 decompiled=40 lumina nreq=0 worse=0 better=0
#error "There were 3 decompilation failure(s) on 40 function(s)"
