/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn start();
void __noreturn sub_4010A1();
// int __usercall sub_40429E@<eax>(char@<pf>, int@<eax>, int@<ecx>, _DWORD *@<edi>, int@<esi>, double@<st7>, double@<st0>);


//----- (00401077) --------------------------------------------------------
void __noreturn start()
{
  sub_4010A1();
}

//----- (004010A1) --------------------------------------------------------
void __noreturn sub_4010A1()
{
  struct _EXCEPTION_REGISTRATION_RECORD *ExceptionList; // [esp-4h] [ebp-4h] BYREF

  ExceptionList = NtCurrentTeb()->NtTib.ExceptionList;
  __writefsdword(0, (unsigned int)&ExceptionList);
  __halt();
}

//----- (0040429E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_40429E@<eax>(
        char a1@<pf>,
        int a2@<eax>,
        int a3@<ecx>,
        _DWORD *a4@<edi>,
        int a5@<esi>,
        double a6@<st7>,
        double a7@<st0>)
{
  int v7; // edx
  int v8; // ebx
  int v9; // eax
  int v10; // edx
  int v11; // esi
  int v12; // ebx
  int v13; // eax
  int result; // eax
  char v15; // cl
  char v18; // zf
  char v19; // sf
  bool v20; // of
  int v21; // eax

  if ( a1 )
  {
    __asm { fadd    st(2), st }
    a5 &= 0x1F0D829u;
    a2 = (a2 + 1) | 0x40000000;
  }
  _ESI = -a5;
  if ( (int)a4 >= a3 )
  {
    __asm
    {
      fadd    st(1), st
      rcr     esi, 0D0h
    }
    v21 = 183300164;
    if ( v19 ^ v20 | v18 )
      v21 = a3;
    if ( __SETP__(v21 << 9, 0) )
    {
      __asm
      {
        fsub    st(2), st
        fadd    st(1), st
      }
    }
    __asm
    {
      fcomp   st(3)
      fadd    st(4), st
      retf
    }
  }
  if ( (int)a4 <= a3 )
    a2 = a3;
  __asm { fsubr   st(4), st }
  *a4 ^= 0x3081FA95u;
  v7 = a2;
  v8 = -a2;
  v20 = __OFSUB__(-a2, 1);
  v9 = ~a2;
  if ( v20 )
    v9 <<= 21;
  v10 = -(v8 * v7);
  v11 = (v9 - 1) << 13;
  v12 = v11;
  v13 = v11 + (v10 != 0) + v11;
  __asm { fmul    st(7), st }
  LOWORD(v11) = 0;
  result = sub_40429E(__SETP__((v10 + 1) & 0x2E82ACFC, 0), v13, a3, a4 + 1, v11, a6, a7);
  *(_DWORD *)(v12 - 62) = __ROL4__(*(_DWORD *)(v12 - 62), v15);
  return result;
}
// 404293: positive sp value 8 has been found
// 4042B2: inconsistent fpu stack
// 404314: unbalanced stack, ignored a potential tail call
// 4042F5: variable 'v19' is possibly undefined
// 4042F5: variable 'v20' is possibly undefined
// 4042EE: variable 'v18' is possibly undefined
// 404295: variable 'v15' is possibly undefined

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
