/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __cdecl start(int, int);
int __fastcall sub_401120(int, int);
// void __usercall sub_4040F5(int@<eax>, signed int@<edx>, int@<ecx>);
// void __usercall sub_40417F(int@<eax>, int@<ecx>, int@<ebx>, int _EDI@<edi>);

//-------------------------------------------------------------------------
// Data declarations

// extern DWORD (__stdcall *GetVersion)();
_UNKNOWN loc_40426A; // weak


//----- (004010B5) --------------------------------------------------------
void __cdecl start(int a1, int a2)
{
  int v2; // ecx
  int v3; // edx
  unsigned int v4; // [esp-8h] [ebp-8h]

  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  GetVersion();
  sub_401120(v2 + 945169812, v3);
  __writefsdword(0, v4);
  JUMPOUT(0x401131);
}
// 40113D: control flows out of bounds to 401131
// 401109: variable 'v2' is possibly undefined
// 40110F: variable 'v3' is possibly undefined
// 40111A: variable 'v4' is possibly undefined

//----- (00401120) --------------------------------------------------------
int __fastcall sub_401120(int a1, int a2)
{
  int result; // eax
  int v3; // [esp-4h] [ebp-4h] BYREF

  result = 0;
  __writefsdword(0, (unsigned int)&v3);
  MEMORY[0] = a2;
  return result;
}

//----- (004040F5) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4040F5(int a1@<eax>, signed int a2@<edx>, int a3@<ecx>)
{
  int v3; // edi
  bool v4; // sf
  char v5; // cc
  bool v6; // of
  int v7; // ecx
  int v8; // eax
  int v9; // ecx
  int savedregs; // [esp+0h] [ebp+0h]

  __asm { fadd    st(4), st }
  v3 = savedregs;
  v4 = a2 - a1 < 0;
  v5 = a2 < a1;
  if ( a2 > a1 )
  {
    if ( a2 > (unsigned int)a1 )
      a1 = a3;
    __asm { fsub    st(5), st }
    v3 = -savedregs - 2;
    v6 = __OFADD__(1, a1++);
    v4 = a1 < 0;
    v5 = (a1 < 0) ^ v6;
  }
  if ( v4 && !v5 )
  {
    __asm { fcomp   st(1) }
    a1 = ~a1;
    v7 = (2 * a3) | 0x7970498F;
    v4 = v7 < 0;
    a3 = __ROR4__(__ROR4__(v7, 91), 39);
  }
  __asm
  {
    fadd    st, st
    fadd    st(2), st
    fadd    st(4), st
    fadd    st(5), st
  }
  if ( v4 )
    JUMPOUT(0x40419B);
  sub_40417F(a1, a3, 1877607599, v3);
  sub_40417F(v8, v9, 1877607599, v3);
}
// 4040FD: positive sp value 4 has been found
// 4040F9: inconsistent fpu stack
// 404174: control flows out of bounds to 40419B
// 4040FC: variable 'savedregs' is possibly undefined
// 40417D: variable 'v8' is possibly undefined
// 40417D: variable 'v9' is possibly undefined

//----- (0040417F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40417F(int a1@<eax>, int a2@<ecx>, int a3@<ebx>, int _EDI@<edi>)
{
  int v7; // edx
  int v9; // [esp-1Ch] [ebp-1Ch]
  int v10; // [esp-4h] [ebp-4h]
  int savedregs; // [esp+0h] [ebp+0h] BYREF
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  __asm
  {
    repne pop ebp
    fcomp   st(5)
    fcomp   st(6)
    fsubr   st, st
    fsubr   st(2), st
    rep not edi
  }
  _EDI = a1;
  __asm
  {
    fmul    st(2), st
    fmul    st(4), st
  }
  v7 = savedregs;
  savedregs = v10;
  v9 = __ROL4__(__ROL4__(2058446866, 200), 148);
  if ( (v7 & 0xB88C9892) == 0 )
    __asm { rcr     edi, 70h }
  ((void (__cdecl *)(int, int, int, int, int, void **, int *, int, int))loc_40426A)(
    v7,
    v9,
    v7,
    a2,
    a3,
    &retaddr,
    &savedregs,
    a1,
    savedregs);
  __asm
  {
    fsub    st(4), st
    fsubr   st(5), st
    fsub    st(1), st
  }
  JUMPOUT(0x40426A);
}
// 4041CE: positive sp value 8 has been found
// 404186: inconsistent fpu stack
// 404269: control flows out of bounds to 40426A
// 4041CE: variable 'v10' is possibly undefined

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
