// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: define fn00401000
// Called from:
//      Win32CrtStartup
//      fn00401260
define fn00401000
{
	word32 eax;
	word32 dwArg0C;
	word32 dwArg08;
	word32 dwArg10;
	word32 dwArg04;
	word32 ebx;
	Top_3 = 0;
	edx_14 = 0x00;
	dwLoc08_129 = 0x00;
	dwLoc0C_130 = 0x00;
	while (true)
	{
		ebx_172 = ϕ(ebx, ebx_74);
		eax_169 = ϕ(eax, eax_116);
		dwLoc08_141 = ϕ(dwLoc08_129, dwLoc08_150);
		dwLoc0C_135 = ϕ(dwLoc0C_130, dwLoc0C_154);
		Mem29 = ϕ(Mem27, Mem118);
		edi_30 = dwLoc0C_135;
		SCZO_31 = cond(dwLoc0C_135 - dwArg0C);
		C_32 = SLICE(SCZO_31, bool, 1);
		O_183 = SLICE(SCZO_31, bool, 4);
		S_186 = (bool) SCZO_31;
		Z_192 = SLICE(SCZO_31, bool, 2);
		if (dwLoc0C_135 >= dwArg0C)
			break;
		ebx_34 = dwArg08 + dwLoc0C_135;
		eax_40 = 0x00 - *ebx_34;
		eax_41 = -eax_40;
		eax_43 = ~eax_41;
		ebx_46 = ~eax_43;
		ecx_49 = dwArg10 + dwLoc08_141;
		eax_50 = *ecx_49;
		ecx_55 = ~(eax_50 & 0xFF);
		ebx_ecx_124 = SEQ(ebx_46 & 0xFF, ecx_55);
		ebx_ecx_125 = ebx_ecx_124 + SEQ(ecx_56, 0x01);
		ecx_56 = (word32) ebx_ecx_125;
		ebx_59 = SLICE(ebx_ecx_125, word32, 32);
		bl_72 = (byte) ebx_59;
		ecx_63 = dwArg04 + dwLoc0C_135;
		ecx_71 = *ecx_63;
		ecx_24_8_81 = SLICE(ecx_71, word24, 8);
		ebx_74 = ecx_63;
		*ecx_63 = 0x00;
		ecx_82 = SEQ(ecx_24_8_81, bl_72);
		ecx_83 = -ecx_82;
		v20_85 = *ecx_63 + ecx_83;
		*ecx_63 = v20_85;
		eax_89 = *ecx_63;
		eax_90 = ~eax_89;
		eax_91 = eax_90 + 0x01;
		*ecx_63 = eax_90 + 0x01;
		edi_94 = dwLoc08_141 + 0x01;
		dwLoc08_148 = dwLoc08_141 + 0x01;
		if (dwLoc08_148 == 0x01)
			dwLoc08_149 = 0x00;
		dwLoc08_150 = ϕ(dwLoc08_148, dwLoc08_149);
		SCZO_105 = cond(dwLoc08_150 - 0x28000000);
		Z_106 = SLICE(SCZO_105, bool, 2);
		C_167 = SLICE(SCZO_105, bool, 1);
		O_184 = SLICE(SCZO_105, bool, 4);
		S_187 = (bool) SCZO_105;
		if (dwLoc08_150 == 0x28000000)
			break;
		eax_116 = dwLoc0C_135 - ~0x00;
		dwLoc0C_154 = eax_116;
	}
	Z_191 = ϕ(Z_192, Z_106);
	S_185 = ϕ(S_186, S_187);
	O_182 = ϕ(O_183, O_184);
	edi_177 = ϕ(edi_30, edi_94);
	ecx_175 = ~0x00;
	ebx_171 = ϕ(ebx_172, ebx_74);
	eax_168 = ϕ(eax_169, eax_91);
	C_166 = ϕ(C_32, C_167);
}

// 004010CF: Register Eq_161 Win32CrtStartup()
Eq_161 Win32CrtStartup()
{
	ptr32 fp;
	word32 ebp;
	word32 edi;
	word32 esi;
	word32 ebx;
	word32 ecx;
	esp_2 = fp;
	Top_3 = 0;
	esp_4 = fp - 4;
	fp->dwFFFFFFFC = ebp;
	ebp_7 = fp - 4;
	esp_8 = fp - 0x01F8;
	esp_9 = fp - 0x01FC;
	fp->dwFFFFFE04 = edi;
	v7_12 = 0x00;
	fp->tFFFFFFE4.u1 = (_CoreCrtNonSecureSearchSortCompareFunction) 0x00;
	SZ_14 = cond(fp->tFFFFFFE4.u1);
	C_15 = false;
	esp_16 = fp - 0x0200;
	fp->dwFFFFFE00 = esi;
	esp_19 = fp - 0x0204;
	fp->dwFFFFFDFC = ebx;
	esp_22 = fp - 0x0208;
	fp->ptrFFFFFDF8 = fp - 4;
	ecx_25 = ecx + 0x01;
	SZO_26 = cond(ecx + 0x01);
	do
	{
		ecx_27 = ϕ(ecx_25, ecx_28);
		ecx_28 = ecx_27 - 0x01;
	} while (ecx_28 != 0x00);
	fp->tFFFFFFEC.u1 = (_CoreCrtNonSecureSearchSortCompareFunction) 0x0061756C;
	fp->dwFFFFFFF0 = 0x002B2B63;
	ebx_32 = fp - 20;
	esp_34 = fp - 0x020C;
	fp->ptrFFFFFDF4 = fp - 20;
	eax_36 = strlen(fp->ptrFFFFFDF4);
	eax_37 = eax_36 - 0x03;
	SCZO_38 = cond(eax_36 - 0x03);
	Z_39 = SLICE(SCZO_38, bool, 2);
	if (Test(NE,Z_39))
	{
		fn00401000();
		return;
	}
	else
	{
		ebx_49 = fp - 20;
		v17_50 = GetProcAddress;
		esp_51 = fp - 0x0210;
		fp->tFFFFFDF0.u1 = (_CoreCrtNonSecureSearchSortCompareFunction) GetProcAddress;
		esp_53 = fp - 0x0214;
		fp->tFFFFFDEC = 0x04;
		esp_55 = fp - 0x0218;
		fp->tFFFFFDE8 = 0x02;
		esp_57 = fp - 0x021C;
		fp->ptrFFFFFDE4 = fp - 20;
		qsort(fp->ptrFFFFFDE4, fp->tFFFFFDE8, fp->tFFFFFDEC, fp->tFFFFFDF0.u1);
		esp_59 = fp - 0x020C;
		eax_60 = Mem58[fp + -20:word32];
		eax_61 = eax_60 - 0x002B2B63;
		fp->tFFFFFFEC.u1 = (_CoreCrtNonSecureSearchSortCompareFunction) (eax_60 - 0x002B2B63);
		SZP_63 = cond(eax_60 - 0x002B2B63);
		Z_66 = SLICE(SZP_63, bool, 2);
		O_64 = false;
		C_65 = false;
		if (Test(NE,Z_66))
		{
			fn00401000();
			return;
		}
		else
		{
			eax_76 = GetLastError();
			SCZO_77 = cond(eax_76 - 0x7E);
			Z_78 = SLICE(SCZO_77, bool, 2);
			if (Test(NE,Z_78))
			{
				fn00401000();
				return;
			}
			else
			{
				ebx_88 = Mem62[fp + -20:word32];
				fp->tFFFFFFE4.u1 = (_CoreCrtNonSecureSearchSortCompareFunction) ebx_88;
				v19_90 = fp->dwFFFFFFF8 & ebx_88;
				fp->dwFFFFFFF8 = v19_90;
				SZ_92 = cond(fp->dwFFFFFFF8);
				esp_93 = fp - 0x0210;
				fp->tFFFFFDF0.u1 = (_CoreCrtNonSecureSearchSortCompareFunction) ebx_88;
				SCZDOP_95 = Mem94[fp + -528:word32];
				esp_96 = fp - 0x020C;
				eax_97 = 0x00;
				ecx_98 = 0x00;
				ecx_99 = 0x004181D2;
				ecx_100 = 4290674221;
				ecx_101 = 4290674222;
				ebx_102 = ebx_88 - 4290674222;
				ebx_103 = ebx_88 - 4290674222 + Mem94[fp + -28:word32];
				fp->dwFFFFFFF0 = ebx_103;
				esi_105 = fp - 4;
				edi_106 = 424;
				edi_107 = -424;
				esi_108 = &fp->dwFFFFFE04 + 20;
				fp->tFFFFFFEC.u1 = (_CoreCrtNonSecureSearchSortCompareFunction) (&fp->dwFFFFFE04 + 20);
				edi_110 = 0x00;
				edi_111 = ~0x00421FFF;
				edi_112 = -edi_111;
				ebp_7->dwFFFFFFD8 = 0x00;
				v21_114 = ebp_7->dwFFFFFFD8 ^ edi_112;
				ebp_7->dwFFFFFFD8 = v21_114;
				SZ_116 = cond(ebp_7->dwFFFFFFD8);
				ebx_117 = ebp_7->dwFFFFFFF0;
				esi_118 = ~0x0F;
				ebx_119 = ebx_117 - esi_118;
				ebp_7->dwFFFFFFE4 = ebx_119;
				v22_121 = ebp_7->dwFFFFFFFC - 0x30;
				ebp_7->dwFFFFFFFC = v22_121;
				ebx_123 = 0x00;
				ebx_124 = ebx_123 - 0x01;
				v23_125 = ~ebp_7->dwFFFFFFFC;
				ebp_7->dwFFFFFFFC = v23_125;
				v24_127 = ebp_7->dwFFFFFFFC - ebx_124;
				ebp_7->dwFFFFFFFC = v24_127;
				SCZO_129 = cond(v24_127);
				v25_130 = ebp_7->dwFFFFFFD8;
				esp_131 = esp_96 - 4;
				*esp_131 = v25_130;
				v26_133 = ebp_7->dwFFFFFFFC;
				esp_134 = esp_131 - 4;
				*esp_134 = v26_133;
				v27_136 = ebp_7->dwFFFFFFF4;
				esp_137 = esp_134 - 4;
				*esp_137 = v27_136;
				ecx_139 = ebp_7 - 424;
				esp_140 = esp_137 - 4;
				*esp_140 = ecx_139;
				fn00401268();
				fn004011B1();
				return;
			}
		}
	}
}

// 004011B1: define fn004011B1
// Called from:
//      Win32CrtStartup
//      fn00401268
define fn004011B1
{
	ptr32 fp;
	word32 ebp;
	<unknown> Mem0;
	word32 edi;
	word32 esi;
	ecx_7 = ebp->ptrFFFFFFF0;
	ecx_9 = ecx_7->dw0004;
	ebx_10 = ebp->ptrFFFFFFF0;
	ecx_11 = ecx_9 + ebx_10->dw0000;
	ebp->dwFFFFFFDC = ecx_11;
	ebp->dwFFFFFFE8 = 0x00;
	ebp->ptrFFFFFFE0 = 0x00;
	NTDLL.dll!NtAllocateVirtualMemory(0x40, 0x3000, ebp - 36, 0x00, ebp - 32, 0x00, &ecx_7->dw0004, ~0x00, ebp - 32, 0x00, ebp - 36, 0x3000, 0x40);
	eax_43 = ebp->ptrFFFFFFE0;
	SZP_44 = cond(eax_43);
	Z_48 = SLICE(SZP_44, bool, 2);
	P_146 = SLICE(SZP_44, bool, 5);
	S_150 = (bool) SZP_44;
	O_45 = false;
	C_46 = false;
	ebp->ptrFFFFFFF8 = eax_43;
	if (eax_43 == 0x00)
		return;
	ebp->ptrFFFFFFE0 = 0x00400000;
	ebp->dwFFFFFE54 = 0x00;
	while (true)
	{
		P_147 = ϕ(P_146, P_148);
		eax_134 = ϕ(eax_43, eax_109);
		Mem58 = ϕ(Mem53, Mem124);
		edi_59 = ebp->ptrFFFFFFF0;
		ebx_60 = ebp->dwFFFFFE54;
		esi_61 = edi_59->dw0008;
		if (ebx_60 >= esi_61)
			break;
		v18_89 = ebp->dwFFFFFFD8;
		edi_92 = ebp->ptrFFFFFFE4;
		v19_93 = edi_92->dw0004;
		edi_96 = ebp->ptrFFFFFFE4;
		eax_97 = ebp->ptrFFFFFFE0;
		eax_98 = eax_97 + edi_96->dw0000;
		ecx_101 = ebp->ptrFFFFFFF8;
		ecx_102 = ecx_101 + ebp->dwFFFFFFE8;
		fn00401260();
		P_148 = SLICE(SCZOP_112, bool, 5);
		ebx_113 = ebp->ptrFFFFFFE4;
		edx_114 = ebp->dwFFFFFFE8;
		edx_115 = edx_114 + ebx_113->dw0004;
		ebp->dwFFFFFFE8 = edx_115;
		esi_118 = ebp->dwFFFFFE54;
		ebp->dwFFFFFE54 = esi_118 + 0x01;
		edx_121 = ebp->ptrFFFFFFE4;
		ebp->ptrFFFFFFE4 = &edx_121->dw0004 + 1;
	}
	edi_64 = ebp->ptrFFFFFFE0;
	ecx_68 = ebp->ptrFFFFFFF8;
	ebp->ptrFFFFFFEC = ecx_68 + 5424;
	ecx_75 = ebp->ptrFFFFFFF0;
	ebx_76 = ebp->ptrFFFFFFF8;
	ebx_77 = ebx_76 + ecx_75->dw0004;
	SCZO_78 = cond(ebx_77);
	C_132 = SLICE(SCZO_78, bool, 1);
	O_144 = SLICE(SCZO_78, bool, 4);
	S_151 = (bool) SCZO_78;
	Z_154 = SLICE(SCZO_78, bool, 2);
	ebx_81 = ebp->ptrFFFFFFEC;
	edx_86 = ebp->ptrFFFFFFEC;
}

// 00401260: define fn00401260
// Called from:
//      fn004011B1
//      fn00401268
define fn00401260
{
	ptr32 fp;
	word32 dwArg0C;
	word32 dwArg08;
	word32 dwArg10;
	word32 dwArg04;
	word32 ebx;
	word32 edi;
	if (true)
		fn00401000();
	else
	{
		fn00401268();
		C_30 = SLICE(SCZO_24, bool, 1);
		O_40 = SLICE(SCZO_24, bool, 4);
		S_42 = (bool) SCZO_24;
		Z_45 = SLICE(SCZO_24, bool, 2);
	}
}

// 00401268: define fn00401268
// Called from:
//      Win32CrtStartup
//      fn00401260
define fn00401268
{
	word32 dwArg00;
	ebx_5 = dwArg00;
	fn00401260();
	fn004011B1();
	Top_10 = 0;
}

word32 g_dw403483 = 0x3623; // 00403483
word32 g_dw403487 = 0x3635; // 00403487
word32 g_dw40348B = 13893; // 0040348B
word32 g_dw40348F = 0x3663; // 0040348F
word32 g_dw403493 = 13939; // 00403493
word32 g_dw403497 = 13959; // 00403497
word32 g_dw40349B = 13981; // 0040349B
word32 g_dw40349F = 0x36B3; // 0040349F
word32 g_dw4034A7 = 0x36D3; // 004034A7
word32 g_dw4034AB = 0x36DD; // 004034AB
word32 g_dw4034AF = 0x36E5; // 004034AF
word32 g_dw4034B3 = 0x36EF; // 004034B3
word32 g_dw4034B7 = 0x3701; // 004034B7
word32 g_dw4034BB = 0x370B; // 004034BB
word32 g_dw4034BF = 14111; // 004034BF
word32 g_dw4034C3 = 0x3737; // 004034C3
word32 g_dw4034C7 = 14149; // 004034C7
word32 g_dw4034CB = 14173; // 004034CB
word32 g_dw4034CF = 0x3775; // 004034CF
word32 g_dw4034D3 = 14211; // 004034D3
word32 g_dw4034D7 = 0x379D; // 004034D7
word32 g_dw4034DF = 14271; // 004034DF
word32 g_dw4034E3 = 0x37CB; // 004034E3
word32 g_dw4034EB = 14319; // 004034EB
word32 g_dw4034EF = 0x3801; // 004034EF
word32 g_dw4034F3 = 14361; // 004034F3
word32 g_dw4034F7 = 0x3835; // 004034F7
word32 g_dw4034FB = 14417; // 004034FB
word32 g_dw4034FF = 14427; // 004034FF
word32 g_dw403503 = 14451; // 00403503
word32 g_dw403507 = 0x3883; // 00403507
word32 g_dw40350B = 14491; // 0040350B
word32 g_dw40350F = 0x38AB; // 0040350F
word32 g_dw403513 = 0x38C1; // 00403513
word32 g_dw403517 = 14543; // 00403517
word32 g_dw40351B = 14551; // 0040351B
word32 g_dw40351F = 0x38E3; // 0040351F
word32 g_dw403523 = 0x38FB; // 00403523
word32 g_dw403527 = 0x390B; // 00403527
word32 g_dw40352B = 0x3929; // 0040352B
word32 g_dw40352F = 0x3941; // 0040352F
word32 g_dw403533 = 14669; // 00403533
word32 g_dw403537 = 0x3969; // 00403537
word32 g_dw40353B = 14719; // 0040353B
word32 g_dw40353F = 14733; // 0040353F
word32 g_dw403543 = 0x399F; // 00403543
word32 g_dw40354B = 0x39BB; // 0040354B
<anonymous> * __imp__ControlService = &g_t0218; // 00403553
<anonymous> * __imp__StartServiceA = &g_t022A; // 00403557
<anonymous> * __imp__RegisterServiceCtrlHandlerA = &g_t023A; // 0040355B
<anonymous> * __imp__OpenServiceA = &g_t0258; // 0040355F
<anonymous> * __imp__SetServiceStatus = &g_t0268; // 00403563
<anonymous> * __imp__QueryServiceStatus = &g_t027C; // 00403567
<anonymous> * __imp__CloseServiceHandle = &g_t0292; // 0040356B
<anonymous> * __imp__OpenSCManagerA = &g_t02A8; // 0040356F
<anonymous> * __imp__wcsstr = &g_t02C8; // 00403577
<anonymous> * __imp__qsort = &g_t02D2; // 0040357B
<anonymous> * __imp__wcsncpy = &g_t02DA; // 0040357F
<anonymous> * __imp__RtlAllocateHeap = &g_t02E4; // 00403583
<anonymous> * __imp__strlen = &g_t02F6; // 00403587
<anonymous> * __imp__RtlQueueWorkItem = &g_t0300; // 0040358B
<anonymous> * __imp__NtDeviceIoControlFile = &g_t0314; // 0040358F
<anonymous> * __imp__RtlFreeHeap = &g_t032C; // 00403593
<anonymous> * __imp__RtlInitUnicodeString = &g_t033A; // 00403597
<anonymous> * __imp__RtlNtStatusToDosError = &g_t0352; // 0040359B
<anonymous> * __imp__NtOpenFile = &g_t036A; // 0040359F
<anonymous> * __imp__NtAllocateVirtualMemory = &g_t0378; // 004035A3
<anonymous> * __imp__NtWaitForSingleObject = &g_t0392; // 004035A7
<anonymous> * __imp__AcceptEx = &g_t03B4; // 004035AF
<anonymous> * __imp__GetAcceptExSockaddrs = &g_t03C0; // 004035B3
<anonymous> * __imp__DeviceIoControl = &g_t03E4; // 004035BB
<anonymous> * __imp__InterlockedDecrement = &g_t03F6; // 004035BF
<anonymous> * __imp__InitializeCriticalSection = &g_t040E; // 004035C3
<anonymous> * __imp__GetQueuedCompletionStatus = &g_t042A; // 004035C7
<anonymous> * __imp__SleepEx = &g_t0446; // 004035CB
<anonymous> * __imp__InterlockedIncrement = &g_t0450; // 004035CF
<anonymous> * __imp__CreateEventA = &g_t0468; // 004035D3
<anonymous> * __imp__DeleteCriticalSection = &g_t0478; // 004035D7
<anonymous> * __imp__GetLastError = &g_t0490; // 004035DB
<anonymous> * __imp__WaitForSingleObject = &g_t04A0; // 004035DF
<anonymous> * __imp__ResetEvent = &g_t04B6; // 004035E3
<anonymous> * __imp__Sleep = &g_t04C4; // 004035E7
<anonymous> * __imp__lstrlenW = &g_t04CC; // 004035EB
<anonymous> * __imp__LeaveCriticalSection = &g_t04D8; // 004035EF
<anonymous> * __imp__SetLastError = &g_t04F0; // 004035F3
<anonymous> * __imp__PostQueuedCompletionStatus = &g_t0500; // 004035F7
<anonymous> * __imp__EnterCriticalSection = &g_t051E; // 004035FB
<anonymous> * __imp__lstrcpyW = &g_t0536; // 004035FF
<anonymous> * __imp__BindIoCompletionCallback = &g_t0542; // 00403603
<anonymous> * __imp__GetOverlappedResult = &g_t055E; // 00403607
<anonymous> * __imp__GlobalAlloc = &g_t0574; // 0040360B
<anonymous> * __imp__GetProcAddress = &g_t0582; // 0040360F
<anonymous> * __imp__GlobalFree = &g_t0594; // 00403613
<anonymous> * __imp__WSARecvFrom = &g_t05B0; // 0040361B
