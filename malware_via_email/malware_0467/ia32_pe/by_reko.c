// subject_UPX0_0000.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 1310D000: void fn1310D000(Stack (ptr32 byte) dwArg04, Stack ptr32 dwArg08, Stack word32 dwArg0C, Stack Eq_5 dwArg10, Stack Eq_5 dwArg14, Stack Eq_5 dwArg18)
// Called from:
//      fn1310D0E5
void fn1310D000(byte * dwArg04, ptr32 dwArg08, word32 dwArg0C, Eq_5 dwArg10, Eq_5 dwArg14, Eq_5 dwArg18)
{
	*dwArg10.u0 = dwArg0C;
	CreateFileA(0x00, 0x00, 0x00, null, 0x00, 0x00, null);
	SleepEx(0x00, 0x00);
	uint32 edx_24 = (uint32) ((uint64) dwArg14 % 0x05);
	word16 wLoc1C_148 = (word16) edx_24;
	byte bLoc1A_151 = SLICE(edx_24, byte, 16);
	byte * dwArg08_143 = dwArg14.u0 + dwArg08;
	do
	{
		--dwArg0C;
		if (dwArg0C == 0x00)
			return;
		ui32 ebx_88 = SEQ(bLoc1A_151, wLoc1C_148, *dwArg08_210) ^ (dwArg18.u0)[(uint32) wLoc1C_148] & 0xFF;
		*dwArg04 = (byte) ebx_88;
		word32 edi_93 = (word32) SLICE(ebx_88, word16, 8);
		wLoc1C_148 = (word16) edi_93 + 0x01;
		bLoc1A_151 = SLICE(edi_93 + 0x01, byte, 16);
		if ((int32) wLoc1C_148 == 0x05)
			wLoc1C_148 = 0x00;
		if (dwArg04 == (byte *) 0x28)
			return;
		++dwArg04;
		dwArg08_143 = dwArg08_210 + 1;
		dwArg08_210 = dwArg08_143;
	} while (dwArg08_210 != (byte *) ~0x42000000);
}

// 1310D0E5: void fn1310D0E5()
void fn1310D0E5()
{
	ptr32 fp;
	Eq_88 tLoc02C4;
	Eq_89 tLoc10;
	Eq_19 tLoc02D8;
	ui32 dwLoc0264;
	ui32 dwLoc0248;
	ui32 dwLoc08;
	ui32 dwLoc14;
	word32 * dwLoc24;
	Eq_5 dwLoc024C;
	word32 dwLoc20;
	Eq_98 dwLoc0260;
	Eq_99 dwLoc18;
	byte * dwLoc0C;
	ContinueDebugEvent(0x00, 0x00, 0x00);
	GetLastError();
	tLoc02C4.LowPart = (DWORD) 0x0658;
	LookupPrivilegeValueA(0x00, 0x00, &tLoc02C4);
	ptr32 esp_29 = fp - 0x02D8;
	if (tLoc02C4.LowPart == 0x00)
	{
		tLoc02C4.LowPart = (DWORD) 0xFFF5;
		BOOL eax_46 = WriteProfileSectionW(null, null);
		tLoc02C4.LowPart = (word32) eax_46 + tLoc02C4.LowPart;
		struct Eq_158 * v16_54 = (word32) eax_46 + 0x0000FFF5 ^ ((eax_46 ^ 0x13101FF6) ^ 0x01);
		word32 esi_58 = v16_54->dw0000;
		fn1310D000(fp - 0x023C, fp - 0x023C, 0x04, &tLoc10, 0x00, fp - 0x0234);
		word32 v21_116 = v16_54->dw0004 + ((word32) WaitForSingleObject(null, 0x54000000) + 1);
		fn1310D000(fp - 600, fp - 0x025C, 0x04, &tLoc10, 0x04, fp - 0x0234);
		ui32 edi_139 = v16_54->dw0008;
		fn1310D000(fp - 20, fp - 0x1C, 0x04, &tLoc10, 0x08, fp - 0x0234);
		word32 ecx_181 = v16_54->dw000C;
		fn1310D000(fp - 28, fp - 0x28, 0x04, &tLoc10, 0x0C, fp - 0x0234);
		CreateFileW(null, 0x00, 0x00, null, 0x00, 0x00, tLoc02D8);
		dwLoc0248 = v16_54->dw0010;
		fn1310D000(fp - 0x0248, fp - 600, 0x04, &tLoc10, 0x10, fp - 0x0234);
		WritePrivateProfileStringA(0x00, 0x38000000, 0x00, 0x00);
		ui32 ebx_278 = edi_139 * 0x08 + 0x0C;
		dwLoc14 = edi_139;
		dwLoc20 = 0x13100000;
		dwLoc024C.u0 = 0x14;
		dwLoc24 = (word32 *) (&v16_54->dw0010 + 1);
		esp_29 = fp - 0x02D4;
		dwLoc0260 = VirtualAlloc(tLoc02C4.LowPart - 0xFFF6, ebx_278 + v21_116 + esi_58, 0x3000, 0x40);
		dwLoc0C = ecx_181 + 0x13100000 + ebx_278;
		dwLoc0264 = ebx_278;
		dwLoc08 = 0x00;
		dwLoc18.u0 = 0x00;
	}
	while (true)
	{
		struct Eq_311 * esp_330 = esp_29 - 4;
		esp_330->t0000.u0 = 0x00;
		esp_330->tFFFFFFFC.u0 = 0x00;
		esp_330->tFFFFFFF8.u0 = 0x00;
		WritePrivateProfileSectionA(esp_330->tFFFFFFF8, esp_330->tFFFFFFFC, esp_330->t0000);
		if (dwLoc0264 == dwLoc0248)
		{
			++dwLoc08;
			if (dwLoc08 == dwLoc14)
				;
			word32 ebx_349 = *dwLoc24;
			esp_330->t0000.u0 = (word32 *) (fp - 0x0234);
			esp_330->tFFFFFFFC.u0 = (word32 *) dwLoc024C;
			esp_330->tFFFFFFF8.u0 = (word32 *) &tLoc10;
			esp_330->dwFFFFFFF4 = 0x04;
			esp_330->ptrFFFFFFF0 = fp - 28 - dwLoc024C;
			esp_330->ptrFFFFFFEC = fp - 28;
			fn1310D000(esp_330->ptrFFFFFFEC, esp_330->ptrFFFFFFF0, esp_330->dwFFFFFFF4, esp_330->tFFFFFFF8.u0, esp_330->tFFFFFFFC.u0, esp_330->t0000.u0);
			ui32 * dwLoc24_633 = dwLoc24 + 1;
			dwLoc0248 = *dwLoc24_633;
			esp_330->t0000.u0 = (word32 *) (fp - 0x0234);
			Eq_5 dwLoc024C_632 = dwLoc024C.u0 + 1;
			esp_330->tFFFFFFFC.u0 = (word32 *) dwLoc024C_632;
			esp_330->tFFFFFFF8.u0 = (word32 *) &tLoc10;
			esp_330->dwFFFFFFF4 = 0x04;
			esp_330->ptrFFFFFFF0 = fp - 0x0248 - dwLoc024C_632;
			esp_330->ptrFFFFFFEC = fp - 0x0248;
			fn1310D000(esp_330->ptrFFFFFFEC, esp_330->ptrFFFFFFF0, esp_330->dwFFFFFFF4, esp_330->tFFFFFFF8.u0, esp_330->tFFFFFFFC.u0, esp_330->t0000.u0);
			dwLoc024C.u0 = (word32) dwLoc024C_632 + 4;
			dwLoc24 = dwLoc24_633 + 1;
			dwLoc0264 = 0x00;
			dwLoc0C = ebx_349 + dwLoc20;
		}
		Mem441[dwLoc0260 + dwLoc18:byte] = Mem436[dwLoc0C + 0x00:byte];
		++dwLoc0C;
		++dwLoc18;
		++dwLoc0264;
	}
}

