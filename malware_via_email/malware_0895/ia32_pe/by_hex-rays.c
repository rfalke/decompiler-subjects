/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// double __userpurge start@<st0>(int a1@<eax>, int _EDX@<edx>, int a3@<ecx>, int a4@<ebx>, unsigned int _EDI@<edi>, unsigned int _ESI@<esi>, double result@<st0>, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
double sub_40784E(); // weak

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_4075F8; // weak
_UNKNOWN loc_407678; // weak


//----- (004063ED) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
double __userpurge start@<st0>(int a1@<eax>, int _EDX@<edx>, int a3@<ecx>, int a4@<ebx>, unsigned int _EDI@<edi>, unsigned int _ESI@<esi>, double result@<st0>, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  int v65; // ebx
  bool v69; // cf
  bool v70; // tt
  int v71; // edx
  bool v72; // tt
  int v74; // edx
  bool v75; // tt
  unsigned int v79; // esi
  bool v82; // tt
  unsigned int v83; // esi
  unsigned int v84; // ett
  unsigned int v88; // edi
  int v89; // ebx
  __int16 v90; // bx
  bool v91; // tt
  int v94; // ebx
  int v97; // ebx
  bool v99; // cf
  unsigned int v101; // edi
  int v106; // edi
  unsigned int v108; // ebx
  __int16 v110; // ax
  int v112; // edi
  int v113; // ebx
  unsigned int v117; // ecx
  int v118; // ebx
  unsigned int v119; // ecx
  int v120; // edi
  int v121; // ecx
  int v122; // eax
  unsigned __int32 v123; // eax
  int v124; // [esp-14h] [ebp-14h]
  int v125; // [esp-10h] [ebp-10h] BYREF
  unsigned int v126; // [esp-Ch] [ebp-Ch] BYREF
  void *retaddr[2]; // [esp+0h] [ebp+0h]

  while ( 1 )
  {
    BYTE1(_EDX) = -80;
    _EAX = __ROR4__(a1, a3);
    LOBYTE(a3) = a3 + 57;
    _EDI >>= a3;
    __asm { rcl     esi, 8 }
    LOWORD(a3) = (unsigned __int8)a3;
    LOBYTE(_EDX) = (unsigned __int8)_EDX >> a3;
    LOWORD(_EDX) = _EDI | _EDX;
    _ECX = _EDX | a3;
    __asm { rcl     dl, 5 }
    v71 = _ECX + _EDX;
    a4 &= 0x2A283990u;
    v72 = __CFSHR__(BYTE1(a4), 26);
    BYTE1(a4) = __ROR1__(BYTE1(a4), 26);
    __asm { rcl     di, cl }
    LOWORD(_ECX) = _DI;
    v69 = __CFADD__(v72, (_WORD)a4);
    LOWORD(a4) = v72 + (_WORD)a4;
    v69 |= __CFADD__((_WORD)_ESI, (_WORD)a4);
    LOWORD(a4) = _ESI + a4;
    LOWORD(_EDI) = _ESI + v69 + _DI;
    LOWORD(v71) = ~(_WORD)v71;
    v75 = __CFSHL__(v71, _ECX);
    v74 = __ROL4__(v71, _ECX);
    LOBYTE(a4) = BYTE1(a4) + v75 + a4;
    if ( _ECX != 60510431 )
      break;
    a1 = MEMORY[0x39DD8FBA](60510431, v74);
  }
  LOBYTE(_EAX) = -1;
  __asm { rcr     ah, cl }
  _EDX = _EDI | __ROL4__(v74, 14);
  BYTE1(_EDX) += a4;
  LOWORD(a4) = _EAX | a4;
  v65 = a4 ^ 0x297470F7;
  __asm { rcr     edx, 1Bh }
  LOWORD(_EAX) = _EAX + 1;
  v69 = __CFSHL__(_EDX, 15);
  LOBYTE(_EDX) = 0;
  --BYTE1(_ECX);
  LOBYTE(_ECX) = _ECX - (v69 - 64);
  if ( _EAX == 1348777646 )
  {
    v126 = _EDI;
    v125 = (unsigned __int16)__CS__;
    *(_DWORD *)(_ECX + 77) = __ROL4__(*(_DWORD *)(_ECX + 77), 224);
  }
  else
  {
    BYTE1(v65) &= 0xB9u;
    _EAX >>= _ECX;
    LOWORD(_EDX) = _EAX & _EDX;
    __asm { rcl     ecx, cl }
    _EBX = 4 * (v65 + 1);
    __asm { rcr     ax, cl }
    LOBYTE(_EAX) = -(char)_EAX;
    __asm { rcr     ebx, cl }
    _EDX = __ROL4__(_EDX, _ECX);
    HIWORD(_EBX) = 28197;
    LOBYTE(_EBX) = __CFSHL__(18, _ECX) + _EDX - 11 - 43;
    _EDI = 289187771;
    LOBYTE(_EAX) = __ROL1__(_EAX, _ECX);
    __asm { rcl     dl, 17h }
    LOBYTE(_EBX) = _EBX ^ 0xD4;
    BYTE1(_EBX) = _EAX + (18 << _ECX);
    if ( _EBX == 1314151596 )
    {
      LOBYTE(_EAX) = MEMORY[0x712F9E39];
      v126 = (unsigned __int16)__ES__;
LABEL_28:
      LOBYTE(_ECX) = _EDX | _ECX;
      ++BYTE1(_EBX);
      v79 = _ESI ^ 0xCE5F43BC;
      v88 = _EDI >> 28;
      LOWORD(v88) = ~(_WORD)v88;
      __asm { rcl     cl, 0Fh }
      LOBYTE(_ECX) = (char)_ECX >> 7;
      __asm { rcl     bh, cl }
      LOBYTE(_EBX) = __ROL1__(_EBX, 14) - 107;
      BYTE1(_ECX) <<= _ECX;
      v99 = (unsigned int)_ECX < 0x3D8415D;
      if ( _ECX != 64504157 )
      {
        __asm { rcr     cx, cl }
        LOBYTE(_ECX) = v99 + _ECX + 1 - 60;
        BYTE1(_EBX) -= _EAX;
        v91 = __CFSHL__(_EBX, _ECX);
        v90 = __ROL2__(_EBX, _ECX);
        _ECX = v88 + v91 + _ECX;
        __asm { rcr     cl, cl }
        ((void (__thiscall *)(unsigned int))sub_40784E)(_ECX);
        *(_BYTE *)v79 -= v69 + HIBYTE(v90);
        v124 = v121;
        __writefsdword(v121 - 22, __readfsdword(v121 - 22) + 5);
        MEMORY[0x5A1A7522] = v122;
        MEMORY[0x22A3ED22] = v122;
        v123 = __indword(0xC7u);
        __asm { retf    8457h }
      }
      _ECX = *(_DWORD *)(_EAX + 1959139514) | 0x3D8415D;
      goto LABEL_30;
    }
    v69 = __CFSHL__(_ECX, _ECX);
    _CX = (_WORD)_ECX << _ECX;
    HIBYTE(_CX) = v69 + HIBYTE(_CX) - 12;
    LOBYTE(_EAX) = __ROL1__(_EAX, _CX);
    __asm { rcl     edx, cl }
    v94 = _EBX + 275889251;
    v69 = __CFSHR__(v94, 13);
    v65 = v94 >> 13;
    LOWORD(_EAX) = _ESI + v69 + (_WORD)_EAX;
    HIBYTE(_CX) = __ROR1__(HIBYTE(_CX), _CX);
    BYTE1(_EAX) = __ROR1__(BYTE1(_EAX), _CX);
    __asm { rcl     cx, cl }
    if ( _ECX == -806308858 )
    {
      MEMORY[0x113CA78F] = (MEMORY[0x113CA7BB] == 0) + MEMORY[0x113CA78F] - 806308858;
      MK_FP(retaddr[0], retaddr[0])(-806308858, _EDX);
      return result;
    }
  }
  BYTE1(v65) |= 0xF0u;
  BYTE1(_ECX) ^= BYTE1(_EAX);
  _EDI |= 0x563EC9FCu;
  LOBYTE(_EDX) = __ROL1__(_EDX, _ECX);
  LOBYTE(_EAX) = v65 & _EAX;
  _EBX = _ECX + v65;
  _ECX |= _EBX;
  LOWORD(_EDI) = _EDX | _EDI;
  _EDX = _EDX ^ 0x3AC2BAD6;
  __asm { rcl     cl, 17h }
  v69 = __CFSHL__(_ECX, _ECX);
  LOBYTE(_ECX) = (_BYTE)_ECX << _ECX;
  LOWORD(_ECX) = _ESI + v69 + (_WORD)_ECX;
  if ( _EAX == 981486578 )
    goto LABEL_5;
  __asm { rcl     dh, cl }
  BYTE1(_EDX) += BYTE1(_ECX) + (_EAX < 0x3A804BF2);
  BYTE1(_ECX) = __ROL1__(BYTE1(_ECX), 28);
  LOWORD(_EBX) = _ECX | _EBX;
  BYTE1(_EDX) -= _EDX;
  _ECX = _ECX + 1929020009;
  LOBYTE(_EAX) = _EAX - _EDX;
  v112 = (_EDI & 0x72BC4088) - 181672876;
  v113 = _EBX >> _ECX;
  SBYTE1(_ECX) >>= 7;
  __asm { rcl     eax, cl }
  v108 = v113 & 0x97826064;
  LOBYTE(_EAX) = _EAX + 124;
  _ECX = _ECX << 13;
  LOWORD(_ECX) = _ECX + 1;
  __asm { rcr     cl, 9 }
  v110 = _EAX + 16248;
  BYTE1(v108) &= _ECX;
  _EBX = -v108;
  LOBYTE(_ECX) = BYTE1(_EDX) + (_EBX != 0) + _ECX;
  _ECX = __ROL4__(_ECX, 18);
  if ( _EBX == -1647636609 )
    JUMPOUT(0x406839);
  BYTE1(_EBX) = (BYTE1(_EBX) - 19) << _ECX;
  v69 = (unsigned __int8)_EBX < (unsigned __int8)((HIBYTE(v110) < 0x4Au) + _EDX);
  LOBYTE(_EBX) = _EBX - ((HIBYTE(v110) < 0x4Au) + _EDX);
  __asm { rcl     ebx, cl }
  LOWORD(_ECX) = _EDX + v69 + (_WORD)_ECX;
  _AL = _EDX | -(char)v110;
  --BYTE1(_EBX);
  v97 = _EBX & 0x6E4C54DD;
  if ( _ESI == -1862000692 )
  {
    *(_DWORD *)(v112 - 9) += _EDX;
    JUMPOUT(0x4066C3);
  }
  BYTE1(_ECX) -= (_ESI < 0x91041FCC) - 79;
  __asm { rcr     al, 0Bh }
  SBYTE1(v97) >>= _ECX;
  v88 = __ROL4__(_ECX, 23);
  LOWORD(_EDX) = (unsigned __int16)_EDX >> _ECX;
  LOBYTE(_ECX) = _ECX - BYTE1(v97);
  v89 = v97 << 13;
  ++_EDX;
  ++BYTE1(_ECX);
  LOWORD(_ECX) = _ECX - 1;
  LOBYTE(_EDX) = __ROR1__(0, _ECX);
  __asm { rcl     dh, 12h }
  v79 = 363702539;
  _EBX = 8 * v89;
  if ( v88 == 1914830555 )
    JUMPOUT(0x406474);
LABEL_30:
  _EAX = 0;
  LOWORD(_ECX) = ~(_WORD)_ECX;
  v101 = __ROR4__(v88, 8);
  _EDX = __ROR4__(_EDX, 14);
  LOBYTE(_EDX) = _EDX + 57;
  LOBYTE(_ECX) = __ROR1__(_ECX, _ECX);
  LOWORD(v79) = __ROR2__(v79, _ECX);
  _EBX = __ROL4__(_EBX, 10);
  if ( _ECX != 56022485 )
  {
    _CX = (_ECX < 0x356D5D5) + (_WORD)_ECX - 3965;
    __asm
    {
      rcl     ch, cl
      rcr     cl, cl
      int     2Eh; DOS 2+ internal - EXECUTE COMMAND
    }
    JUMPOUT(0x406942);
  }
  _EDI = (__PAIR64__(v101, 56022485) - __PAIR64__(_EDX, 56022485)) >> 32;
  __asm { aam     4Eh ; 'N' }
LABEL_32:
  LOWORD(_EBX) = (_WORD)_EBX << _ECX;
  LOBYTE(_EBX) = __ROL1__(_EBX, 30);
  BYTE1(_EBX) -= _EAX;
  _CX = ((_WORD)_ECX - 1) << (_ECX - 1);
  _EBX = _EBX << 28;
  BYTE1(_EBX) &= 0x45u;
  ++HIBYTE(_CX);
  __asm { rcl     ebx, 10h }
  ++_EDX;
  __asm
  {
    rcl     ch, 0Fh
    rcl     edi, 1Ah
  }
  _CL = ((_BYTE)_CX << _CX) ^ 0xC9;
  __asm { rcr     bl, cl }
  if ( __ROR4__(v79, 11) != -1751315904 )
    JUMPOUT(0x40690A);
  _ECX = (int)&v125;
  BYTE1(_ECX) = *(_BYTE *)(_EDX - 127);
  *(_DWORD *)(_EDX - 638133198) ^= _EBX;
  LOBYTE(_EBX) = 0;
  _EDI = _EDI >> (char)&v125;
  SBYTE1(_ECX) >>= (char)&v125;
  _ESI = __ROR4__(18, (char)&v125);
  LOWORD(_EBX) = (_WORD)_EBX << (char)&v125;
  v82 = __CFSHR__(BYTE1(_ECX), (unsigned __int8)&v125);
  BYTE1(_ECX) = __ROR1__(BYTE1(_ECX), (char)&v125);
  v69 = v82;
  do
  {
    v84 = v69 - 914084217;
    v69 = _ESI < v84;
    v83 = _ESI - v84;
    LOWORD(v83) = v83 - (v69 + (_WORD)_EDI);
    LOBYTE(_ECX) = _EDI & _ECX;
    v79 = (v83 - (__CFSHL__(BYTE1(_ECX), 5) + _EDX)) ^ 0xCA4EF953;
    LOBYTE(_EBX) = 0;
    v106 = _EDI | 0x2BCBF16;
    LOWORD(v106) = v106 - 1;
    BYTE1(_ECX) = BYTE1(_EBX) | 0x3D;
    __asm { rcl     cx, cl }
    LOWORD(_EBX) = v106 ^ _EBX;
    _ECX = _ECX >> 24;
    BYTE1(_ECX) <<= _ECX;
    __asm { rcl     cl, 15h }
    v69 = __CFSHL__(BYTE1(_ECX), _ECX);
    BYTE1(_ECX) <<= _ECX;
    LOBYTE(_EBX) = _EBX - (v69 + 81);
    _EAX = __GS__;
    __asm { rcl     cl, cl }
    _EDI = v106 + 283362005;
    BYTE1(_ECX) >>= 4;
    __asm { rcr     cl, cl }
    BYTE1(_EBX) ^= 0xB1u;
    if ( _EBX != -1179765347 )
      goto LABEL_32;
    __outbyte(0x3Fu, __GS__);
    __asm { aas }
    v117 = _ECX | 0x85E5CE40;
    v118 = -1179765347 << v117;
    v69 = v117 < -1179765347 << v117;
    v119 = v117 - (-1179765347 << v117);
    BYTE1(v118) -= v69 - 29;
    LOWORD(v118) = (__int16)v118 >> v119;
    v120 = __ROL4__(_EDI, 12);
    --BYTE1(v118);
    LOBYTE(v118) = __ROL1__(v118, 26);
    __GS__ = _EAX;
    LOBYTE(v119) = ~(_BYTE)v119;
    LOWORD(v119) = -(__int16)v119;
    _ECX = v119 + 544153701;
    if ( v118 != 543185435 )
      JUMPOUT(0x40650D);
    _EBX = v125;
    _EAX = (unsigned int)&v126;
    *(_DWORD *)(_EDX - 46) &= 0xFFFFFFD1;
    _ESI = (int)__ROL4__(-925408592, 16) >> 14;
    LOWORD(_ECX) = (__int16)_ECX >> _ECX;
    if ( _EDX == 30099331 )
    {
      if ( _ECX == 1918795623 )
      {
        __outdword(0x4783u, (unsigned int)&STACK[0x24895877]);
        *(_DWORD *)(((int)&STACK[0x24895877] >> 31) - 758639770) = (int)result;
        JUMPOUT(0x406909);
      }
      return result;
    }
    v69 = (unsigned __int8)_EBX < 0x49u;
    LOBYTE(_EBX) = _EBX - 73;
    _EDI = v120 - (v69 + _EDX);
    LOBYTE(_ECX) = (char)((BYTE1(_ECX) - BYTE1(_EBX)) ^ _ECX) >> ((BYTE1(_ECX) - BYTE1(_EBX)) ^ _ECX);
    __asm { rcr     edi, 14h }
LABEL_5:
    BYTE1(_ECX) = 0;
    __asm { rcl     ch, cl }
    BYTE1(_EBX) = __ROR1__(-113, 17);
    v70 = _EAX & 1;
    _EAX = __ROR4__(_EAX, 1);
    v69 = v70;
  }
  while ( v70 );
  LOWORD(_ESI) = -(__int16)_ESI;
  _ESI ^= 0xE4D8F419;
  BYTE1(_ECX) = BYTE1(_EAX) + ~(SBYTE1(_ECX) >> _ECX) - (__CFADD__(BYTE1(_EAX), ~(SBYTE1(_ECX) >> _ECX)) - 11);
  if ( _ECX != 306912939 )
    goto LABEL_28;
  return result;
}
// 40666E: positive sp value 8 has been found
// 40646E: control flows out of bounds to 406474
// 4066C0: control flows out of bounds to 4066C3
// 406835: control flows out of bounds to 406839
// 40649D: control flows out of bounds to 40690A
// 4065EA: control flows out of bounds to 406942
// 406946: control flows out of bounds to 406909
// 4068FF: control flows out of bounds to 40650D
// 406671: bad sp value at call
// 4063ED: could not find valid save-restore pair for ebp
// 40693E: exceedingly huge offset into the stack frame
// 40693F: exceedingly huge offset into the stack frame
// 4063ED: too many input arguments, some ignored
// 40784E: using guessed type double sub_40784E();

//----- (0040784E) --------------------------------------------------------
int __usercall sub_40784E@<eax>(char a1@<cf>, int a2@<eax>, int _EDX@<edx>, char _CL@<cl>, int _EBX@<ebx>, __int16 a6@<si>, double a7@<st0>)
{
  int v8; // eax
  int result; // eax
  _DWORD *i; // eax
  _DWORD *v12; // ecx
  char *v13; // eax
  int v14; // eax
  __int16 v18; // [esp-10h] [ebp-10h]
  int v19; // [esp-10h] [ebp-10h]

  _EAX = a1 + a2 - 396845028;
  __asm
  {
    rcl     edx, 2
    rcr     ebx, cl
  }
  LOWORD(_EAX) = (_WORD)_EAX << _CL;
  BYTE1(_EBX) >>= __ROR1__(_CL, _CL);
  __asm { rcr     eax, 6 }
  for ( i = (_DWORD *)&loc_4075F8; *i != 9460301; i = (_DWORD *)(((unsigned int)i - 1) >> 15 << 15) )
    ;
  v12 = i;
  v13 = (char *)i + i[15];
  v19 = *((_DWORD *)v13 + 20);
  v14 = *(_DWORD *)&v13[(_DWORD)&loc_407678 - 4224504];
  v8 = (*(int (__usercall **)@<eax>(int, double@<st0>))((char *)v12 + *(_DWORD *)((char *)v12 + v14 + 16)))(v19, a7);
  _CL = v18;
  LOWORD(v8) = v8 - v18;
  LOWORD(_EBX) = a6 ^ _EBX;
  if ( _EBX != 492841949 )
    JUMPOUT(0x4076AA);
  result = v8 + 1;
  __asm
  {
    rcr     ah, cl
    rcl     al, cl
  }
  LOWORD(result) = -(__int16)result;
  LOBYTE(result) = 0;
  __asm
  {
    rcl     ah, 12h
    rcl     bx, cl
  }
  return result;
}
// 4076A8: control flows out of bounds to 4076AF
// 407727: control flows out of bounds to 407728
// 407789: control flows out of bounds to 40778A
// 407843: control flows out of bounds to 407849
// 4078A4: control flows out of bounds to 4078AA
// 4078DE: control flows out of bounds to 4078E0
// 4077D9: control flows out of bounds to 407644
// 40752F: control flows out of bounds to 407556
// 407557: control flows out of bounds to 4076AA
// 407701: control flows out of bounds to 407739
// 407784: control flows out of bounds to 407726
// 4078D8: control flows out of bounds to 407561
// 40791B: control flows out of bounds to 40791A
// 40753E: variable 'v18' is possibly undefined

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
