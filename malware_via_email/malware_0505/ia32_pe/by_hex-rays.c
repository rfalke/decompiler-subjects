/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void start();
// void __usercall sub_401ECA(char@<cl>, __int32@<ebx>);
void sub_401F15();
// void __usercall sub_40201C(__int32@<eax>);
_DWORD sub_402138(); // weak
// void __usercall sub_40218D(__int32@<ecx>, int@<ebx>, int@<edi>, int@<esi>);
_DWORD sub_4021C6(); // weak
void sub_402415();
// void __usercall sub_402446(int@<edx>, int@<ecx>, __int16 *@<ebx>, int _EDI@<edi>, double@<st0>);
void sub_4024B7();
_DWORD sub_4024EA(); // weak
// void __usercall sub_40252C(int@<edx>, int@<ecx>, __int16@<bx>, int _ESI@<esi>);
// void __usercall sub_402547(__int16@<ax>, char@<dl>, char@<cl>, __int32@<ebx>);
// void __usercall sub_4025E6(int@<edx>, int@<ecx>, int@<ebx>, int@<ebp>, unsigned int@<edi>, int@<esi>, double@<st0>);
int sub_402636(void); // weak
// int __usercall sub_4026B8@<eax>(int@<eax>, int@<edx>, int@<ecx>, void *@<ebx>, _DWORD *@<esi>);
// void __usercall sub_4027D7(__int32@<ebx>);
_DWORD sub_40291E(); // weak
// void __usercall sub_402996(__int32@<ebx>);
void sub_402BC2();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401FD2; // weak
_UNKNOWN loc_402075; // weak
_UNKNOWN loc_402091; // weak
_UNKNOWN loc_4022F4; // weak
_UNKNOWN loc_40233A; // weak
_UNKNOWN loc_4023AC; // weak
_UNKNOWN loc_4029D5; // weak
_UNKNOWN loc_402A66; // weak


//----- (00401101) --------------------------------------------------------
void start()
{
  JUMPOUT(0x401044);
}
// 4010CA: control flows out of bounds to 4010CC
// 4010FE: control flows out of bounds to 401100
// 40114C: control flows out of bounds to 2E19816C
// 4010EC: control flows out of bounds to 401044
// 401036: conditional instruction was optimized away because ebx.4>=0
// 4010F6: conditional instruction was optimized away because esi.4!=1

//----- (00401ECA) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401ECA(char a1@<cl>, __int32 a2@<ebx>)
{
  int v4; // edx

  LOBYTE(a2) = a2 - a1;
  sub_402996(a2);
  __asm { das }
  *(_BYTE *)(v4 - 113) += BYTE1(v4);
  JUMPOUT(0x401EEF);
}
// 401ECE: positive sp value 4 has been found
// 401EEC: control flows out of bounds to 401EEF
// 401EEC: variable 'v4' is possibly undefined

//----- (00401F15) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401F15()
{
  void *v0; // [esp+18h] [ebp-4h]
  void *retaddr; // [esp+1Ch] [ebp+0h]

  *(&retaddr - 8) = v0;
  JUMPOUT(0x402511);
}
// 401F19: positive sp value 4 has been found
// 401F24: control flows out of bounds to 402511

//----- (0040201C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40201C(__int32 a1@<eax>)
{
  __int32 v1; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v1, a1);
  JUMPOUT(0x4022BC);
}
// 402022: positive sp value 4 has been found
// 40202B: control flows out of bounds to 4022BC

//----- (00402138) --------------------------------------------------------
#error "401E88: cannot convert to microcode (funcsize=24)"

//----- (0040218D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40218D(__int32 a1@<ecx>, int a2@<ebx>, int a3@<edi>, int a4@<esi>)
{
  int v4; // edx
  int v5; // edx
  __int32 v8; // ecx
  __int32 v9; // edx
  __int32 v10; // edx
  __int32 v13; // edx
  int v14; // edx
  __int32 v15; // [esp-4h] [ebp-4h] BYREF

  _CX = _InterlockedExchange(&v15, a1);
  __asm { rep lea cx, [ecx] }
  v13 = v15;
  LOBYTE(v13) = -(char)v15;
  v14 = v13 - v15;
  LOBYTE(v14) = v14 - a3;
  v9 = v15 ^ v14;
  LOBYTE(v9) = v9 - BYTE1(v15);
  v10 = a3 | (v15 + (a3 ^ v9));
  BYTE1(v10) |= v15;
  v4 = v10 - a3;
  LOBYTE(v4) = a3 + v4;
  BYTE1(v4) |= a2;
  v5 = a2 + v4;
  LOBYTE(v5) = -(char)v5;
  sub_40252C(a4 + (a2 ^ v5), v15, a2, a4);
  __asm { insd }
  LOBYTE(a2) = *(_BYTE _ds *)(a3 + a2 - 28847) ^ a2;
  sub_40218D(v8, a2, a3 - 1, a4);
  JUMPOUT(0x401F5E);
}
// 401F31: positive sp value 4 has been found
// 401F59: control flows out of bounds to 401F5E
// 401F59: variable 'v8' is possibly undefined

//----- (004021C6) --------------------------------------------------------
#error "402696: cannot convert to microcode (funcsize=158)"

//----- (00402415) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402415()
{
  JUMPOUT(0x4029BB);
}
// 401FAF: positive sp value C has been found
// 401FB1: control flows out of bounds to 401FB2
// 4022B8: inconsistent fpu stack
// 402ADC: control flows out of bounds to 402ADE
// 402221: control flows out of bounds to 4029BB
// 402AC8: control flows out of bounds to 4028CD
// 402180: conditional instruction was optimized away because eax.4!=0
// 40291E: using guessed type _DWORD sub_40291E();

//----- (00402446) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402446(int a1@<edx>, int a2@<ecx>, __int16 *a3@<ebx>, int _EDI@<edi>, double a5@<st0>)
{
  int v5; // ecx
  __int16 v6; // ax
  bool v7; // cc
  int v8; // ecx
  __int16 v9; // ax
  __int32 v16; // ebx
  int v17; // edi
  int v19; // ecx
  int v21; // et1
  int v23; // edi
  bool v24; // cf
  bool v25; // cc
  int v26; // ecx
  __int16 v27; // bx
  __int16 v28; // bx

  v5 = a2 - 1;
  v6 = a1 + 1;
  v7 = v5 <= 1;
  v8 = v5 - 1;
  if ( v7 || !v7 )
  {
    v17 = v8;
    sub_401F15();
    _RAX = (int)_RAX;
    if ( _SF ^ _OF | _ZF )
    {
      v21 = (__int16)_RAX;
      _EAX = v19;
      LOBYTE(_EAX) = _CF;
      v23 = HIDWORD(_RAX) ^ v17;
      v24 = (unsigned int)v21 < HIDWORD(_RAX);
      v25 = v21 <= SHIDWORD(_RAX);
      v26 = v21 - HIDWORD(_RAX);
      if ( v21 > SHIDWORD(_RAX) && v25 )
      {
        LOBYTE(v27) = *(_BYTE *)v26 + v24 - 1;
        if ( ((v27 & 0x80u) != 0) == (__OFSUB__(v24, 1) | __OFADD__(*(_BYTE *)v26, v24 - 1)) )
        {
          __asm { aad     0FEh ; 'þ' }
          if ( !v26 )
            JUMPOUT(0x40289E);
          HIBYTE(v27) = ((unsigned __int16)(*(_WORD *)HIDWORD(_RAX) ^ _RAX) >> 8) - v26;
          v28 = v27 + 1;
          LODWORD(_RAX) = *(_DWORD *)HIDWORD(_RAX);
          if ( __OFADD__(1, v23) || !__OFADD__(1, v23) )
            JUMPOUT(0x40204F);
          BYTE4(_RAX) = __ROL1__(BYTE4(_RAX), 139);
          *(_DWORD *)HIDWORD(_RAX) = __ROR4__(*(_DWORD *)HIDWORD(_RAX), 1);
          *(_DWORD *)(_RAX + 72) = __ROL4__(*(_DWORD *)(_RAX + 72), v26);
          BYTE4(_RAX) -= HIBYTE(v28);
          BYTE5(_RAX) = -BYTE5(_RAX);
          HIDWORD(_RAX) ^= v26;
        }
        ((void (__fastcall *)(int, _DWORD))((char *)&loc_402091 + 1))(v26, HIDWORD(_RAX));
        sub_4021C6();
        JUMPOUT(0x4022B6);
      }
      BYTE1(v26) = 37;
      ((void (__fastcall *)(int, int))loc_4022F4)(v26, v26 + HIDWORD(_RAX));
      __writeeflags(0x40u);
      JUMPOUT(0x4024E9);
    }
    JUMPOUT(0x40280A);
  }
  LOBYTE(v6) = a1 + 43;
  v9 = v6 - 1;
  _EDX = a1 - 1;
  if ( v8 )
  {
    __asm { lock add edi, edx }
    HIWORD(v16) = HIWORD(_EDX);
    BYTE1(v16) = v8 | (v8 + (BYTE1(v8) | BYTE1(_EDX)) - v9);
    LOBYTE(v16) = v8 | 0xAD;
    sub_402547(v9, v8 + _EDX, (v8 | 0xAD) ^ v8, v16);
    __asm { iret }
    JUMPOUT(0x402498);
  }
  ((void (__usercall *)(double@<st0>))loc_4029D5)(a5 * (double)*a3);
  sub_402415();
}
// 4022A0: positive sp value 4 has been found
// 4022B1: control flows out of bounds to 4022B6
// 4024E8: control flows out of bounds to 4024E9
// 402809: control flows out of bounds to 40280A
// 402497: control flows out of bounds to 402498
// 402C4D: control flows out of bounds to 40204F
// 402871: control flows out of bounds to 40289E
// 402846: variable '_RAX' is possibly undefined
// 402847: variable '_SF' is possibly undefined
// 402847: variable '_OF' is possibly undefined
// 402847: variable '_ZF' is possibly undefined
// 40284A: variable 'v19' is possibly undefined
// 402852: variable '_CF' is possibly undefined
// 4021C6: using guessed type _DWORD sub_4021C6();

//----- (004024B7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4024B7()
{
  ((int (*)(void))((char *)&loc_401FD2 + 4))();
  JUMPOUT(0x4021FA);
}
// 4021E2: positive sp value 4 has been found
// 4021F8: control flows out of bounds to 4021FA

//----- (004024EA) --------------------------------------------------------
#error "402505: cannot convert to microcode (funcsize=12)"

//----- (0040252C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40252C(int a1@<edx>, int a2@<ecx>, __int16 a3@<bx>, int _ESI@<esi>)
{
  int v4; // edx
  char v6; // dl
  char v7; // cl

  v4 = a1 - a2 - 1;
  LOBYTE(v4) = BYTE1(a2) ^ HIBYTE(a3);
  _AX = ((int (__fastcall *)(int, int))loc_4023AC)(a2, v4);
  HIBYTE(a3) |= v6;
  __asm
  {
    das
    outsb
  }
  sub_402547(_AX, v6, v7, a3);
}
// 402543: positive sp value 8 has been found
// 402543: variable 'v6' is possibly undefined
// 402546: variable 'v7' is possibly undefined

//----- (00402547) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402547(__int16 a1@<ax>, char a2@<dl>, char a3@<cl>, __int32 a4@<ebx>)
{
  void *v4; // [esp+10h] [ebp-4h]
  void *retaddr; // [esp+14h] [ebp+0h]

  *(&retaddr - 6) = v4;
  LOBYTE(a4) = a1 | a4;
  BYTE1(a4) = -BYTE1(a4);
  sub_401ECA(a2 | HIBYTE(a1) | a3, a4);
  JUMPOUT(0x402873);
}
// 40254B: positive sp value 4 has been found
// 40256E: control flows out of bounds to 402873

//----- (004025E6) --------------------------------------------------------
void __usercall sub_4025E6(
        int a1@<edx>,
        int a2@<ecx>,
        int a3@<ebx>,
        int a4@<ebp>,
        unsigned int a5@<edi>,
        int a6@<esi>,
        double a7@<st0>)
{
  unsigned int v7; // esi
  unsigned int v8; // edx
  unsigned int v9; // ebx
  unsigned int v10; // edx
  int v12; // esi
  bool v13; // cf
  unsigned __int8 v14; // ah
  unsigned __int8 v16; // tt
  int v17; // edx
  int v18; // ecx
  int v20; // ecx
  bool v21; // pf
  _DWORD *v22; // eax
  unsigned int v23; // [esp-4h] [ebp-4h] BYREF

  _EBX = (__int16 *)(a3 - 1);
  v12 = a2 ^ (a6 - 1);
  LOBYTE(a1) = a1 - BYTE1(a2);
  LOBYTE(a2) = a1 ^ a2;
  LOBYTE(a1) = -(a2 ^ a1);
  sub_402446(a1, a2, _EBX, a5, a7);
  v16 = v13 + *(_BYTE *)(a5 + 13);
  v13 = v14 < v16;
  BYTE1(_EAX) = v14 - v16;
  *(_BYTE *)(a4 - 111) += (_BYTE)_EBX + v13;
  __asm
  {
    aam     33h ; '3'
    xlat
  }
  HIDWORD(_RAX) = a5 + (_RAX ^ (v18 | a5 | v17));
  BYTE5(_RAX) = -97;
  HIDWORD(_RAX) += v12;
  if ( (_DWORD)_RAX == 1832224422 )
  {
    HIWORD(v20) = 27957;
    LOBYTE(_RAX) = (unsigned __int8)_EBX | 0xA6;
    v9 = a5 | (unsigned int)_EBX;
    v21 = __SETP__(BYTE5(_RAX), 12);
    BYTE5(_RAX) -= 12;
    if ( !__SETP__(BYTE5(_RAX), 0) && v21 )
    {
      HIDWORD(_RAX) = _RAX % (int)__readfsdword(v12 - 416654909);
      LOWORD(v20) = 3200;
      BYTE4(_RAX) = v9;
      v22 = (_DWORD *)((int (__fastcall *)(unsigned int, _DWORD, _DWORD))((char *)&loc_40233A + 1))(
                        v9 ^ v20,
                        HIDWORD(_RAX),
                        _RAX);
      *v22 ^= (unsigned int)&v23;
      JUMPOUT(0x402B8D);
    }
    BYTE1(v9) = -78;
    v10 = a5;
    LOBYTE(v10) = BYTE1(a5) + a5;
    v7 = a5 | v12;
    v8 = v10 + 1;
    if ( !__OFSUB__(a5, v7) && __OFSUB__(a5, v7) )
    {
      *(_DWORD *)(a4 + 1939700352) += v8 + (a5 < v7);
      v23 = v9;
      JUMPOUT(0x401E76);
    }
    JUMPOUT(0x4027A8);
  }
  JUMPOUT(0x402B74);
}
// 401E75: control flows out of bounds to 401E76
// 402B8B: control flows out of bounds to 402B8D
// 402616: control flows out of bounds to 402B74
// 401E5D: control flows out of bounds to 4027A8
// 402629: conditional instruction was optimized away because eax.4==6D3586A6
// 4025F9: variable 'v13' is possibly undefined
// 4025F9: variable 'v14' is possibly undefined
// 402604: variable 'v18' is possibly undefined
// 402602: variable 'v17' is possibly undefined
// 402636: using guessed type int sub_402636(void);

//----- (00402636) --------------------------------------------------------
#error "401E1F: cannot convert to microcode (funcsize=22)"

//----- (004026B8) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4026B8@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, void *a4@<ebx>, _DWORD *a5@<esi>)
{
  int v5; // eax
  char *v6; // edx
  int v7; // ecx
  _BYTE *v8; // edi
  void *v10; // [esp+1Ch] [ebp-4h]
  void *retaddr; // [esp+20h] [ebp+0h]

  *(&retaddr - 9) = v10;
  BYTE1(a1) = -BYTE1(a1);
  LOBYTE(a1) = BYTE1(a1) ^ a1;
  BYTE1(a1) = -BYTE1(a1);
  BYTE1(a2) = -77;
  if ( !__SETP__(BYTE1(a1), 0) && __SETP__(BYTE1(a1), 0) )
  {
    LOBYTE(a1) = __inbyte(0x47u);
    *a5 -= (BYTE1(a1) != 0) + a1;
    ((void (*)(void))loc_402A66)();
    JUMPOUT(0x4026F7);
  }
  LOBYTE(a1) = -(char)a1;
  v5 = a1 - 1;
  v6 = (char *)a5 + a3 + (a3 | a2);
  v7 = v5 | a3;
  v10 = a4;
  LOBYTE(v6) = v5 ^ (unsigned __int8)v6;
  BYTE1(v7) = (_BYTE)v6;
  LOBYTE(v7) = v7 - (_BYTE)v6;
  v8 = (_BYTE *)(v7 - 1);
  sub_40201C((__int32)a5 + (_DWORD)v6);
  *v8 = *(_BYTE *)a5;
  return sub_40291E();
}
// 4026BC: positive sp value 4 has been found
// 4026F1: control flows out of bounds to 4026F7
// 402767: control flows out of bounds to 402769
// 40291E: using guessed type _DWORD sub_40291E();

//----- (004027D7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4027D7(__int32 a1@<ebx>)
{
  __int32 v2; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v2, a1);
  __asm { rep pop ebx }
  ((void (*)(void))((char *)&loc_402075 + 1))();
  JUMPOUT(0x402680);
}
// 40266A: positive sp value 4 has been found
// 40267A: control flows out of bounds to 402680

//----- (0040291E) --------------------------------------------------------
#error "4022F2: positive sp value has been found (funcsize=83)"

//----- (00402996) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402996(__int32 a1@<ebx>)
{
  __int32 v2; // [esp-8h] [ebp-8h] BYREF

  _InterlockedExchange(&v2, a1);
  __asm { repne pop ebx }
  JUMPOUT(0x4028A9);
}
// 4029B4: positive sp value 8 has been found
// 402212: control flows out of bounds to 402213
// 4029A3: control flows out of bounds to 4028A9
// 4029AD: conditional instruction was optimized away because cl.1!=0

//----- (00402BC2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402BC2()
{
  JUMPOUT(0x402B74);
}
// 40297B: positive sp value 4 has been found
// 40298D: control flows out of bounds to 402B74

// nfuncs=20 queued=20 decompiled=20 lumina nreq=0 worse=0 better=0
#error "There were 5 decompilation failure(s) on 20 function(s)"
