/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// double __usercall sub_40778A@<st0>(int@<ebx>, int@<edi>, double result@<st0>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_407774; // weak
_UNKNOWN loc_4077F4; // weak


//----- (0040778A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
double __usercall sub_40778A@<st0>(int a1@<ebx>, int a2@<edi>, double result@<st0>)
{
  int v5; // edi
  int v6; // ebx
  int v7; // ecx
  int v8; // edi
  bool v10; // cf
  unsigned int v11; // esi
  bool v12; // tt
  int v13; // edi
  unsigned int v14; // esi
  unsigned int v15; // ecx
  char v18; // cl
  int v19; // edi
  unsigned int v20; // ecx
  int v21; // esi
  unsigned int v22; // ett
  unsigned int v23; // et2
  int v24; // ecx
  unsigned int v25; // kr08_4
  bool v26; // tt
  int v27; // ecx
  int v29; // edi
  int v30; // esi
  int v31; // esi
  int v32; // edi
  int v33; // esi
  _DWORD *i; // eax
  int v37; // ebx
  __int16 v39; // cx
  _DWORD *v41; // ecx
  char *v42; // eax
  int v44; // ebx
  int v45; // ecx
  int v50; // esi
  unsigned int v51; // edi
  unsigned int v52; // esi
  int v54; // [esp-48h] [ebp-48h]
  int v55; // [esp-44h] [ebp-44h]
  int v56; // [esp-44h] [ebp-44h]
  char v58; // [esp-1Ch] [ebp-1Ch]
  char v59; // [esp-18h] [ebp-18h]

  v37 = (int)(a1 | 0x8FA116A5) >> 25;
  if ( v37 == 1565093892 )
    __asm { retf }
  for ( i = (_DWORD *)&loc_407774; *i != 9460301; i = (_DWORD *)(((unsigned int)i - 1) >> 15 << 15) )
    ;
  v41 = i;
  v42 = (char *)i + i[15];
  v56 = *((_DWORD *)v42 + 20);
  LODWORD(_RAX) = (*(int (__cdecl **)(_DWORD *))((char *)v41
                                               + *(_DWORD *)((char *)v41
                                                           + *(_DWORD *)&v42[(_DWORD)&loc_4077F4 - 4224884]
                                                           + 16)))(v41);
  _ECX = v54;
  __asm { rcr     ch, 14h }
  LOBYTE(v37) = _RAX + __CFSHL__(a2, v54) + v37;
  _ECX |= 0x6FA2FED3u;
  __asm { rcl     cl, 1Dh }
  v29 = __ROR4__(__ROL4__(a2, v54) + 1523138652, 24);
  __asm { rcl     al, cl }
  BYTE1(_RAX) = BYTE1(v56);
  BYTE1(v37) = _ECX;
  HIDWORD(_RAX) = v56 + 45;
  v6 = __ROL4__(v37, _ECX);
  LOBYTE(_ECX) = (unsigned __int16)(v56 + 45) >> 8;
  _ECX >>= 26;
  v50 = v29;
  LOBYTE(_RAX) = BYTE1(v56) + BYTE4(_RAX) + _RAX - (__CFADD__(BYTE4(_RAX), (_BYTE)_RAX) - 61);
  BYTE1(_ECX) = 0;
  v55 = v56 + 45;
  __asm { rcr     ah, cl }
  BYTE1(v6) = v6;
  __asm { rcl     ecx, 13h }
  LOWORD(v29) = ~(_WORD)v29;
  v30 = v50 << _ECX;
  LOBYTE(_ECX) = (char)_ECX >> 7;
  v31 = -v30;
  __asm { rcr     ch, cl }
  _ECX = _ECX - ((v31 != 0) + (_DWORD)_RAX);
  LOBYTE(_ECX) = 9;
  if ( v29 == -538469649 )
  {
    HIWORD(v51) = HIWORD(v55);
    LOBYTE(_RAX) = *(_BYTE *)v31;
    v52 = v31 + 1999595015;
    BYTE1(_RAX) ^= v6;
    BYTE5(_RAX) = __ROL1__(MEMORY[0xDFE79B5B], 11);
    __asm { rcl     dh, cl }
    BYTE4(_RAX) = 0;
    WORD2(_RAX) = __ROL2__(WORD2(_RAX), 9);
    BYTE5(_RAX) = __ROL1__(BYTE5(_RAX), 29);
  }
  else
  {
    HIDWORD(_RAX) -= 45;
    LOWORD(_ECX) = __ROR2__(_ECX, 9);
    v13 = __ROR4__(v29, _ECX);
    v14 = v31 >> _ECX;
    LOBYTE(_ECX) = _ECX - 1;
    v14 >>= 1;
    LOBYTE(v6) = (unsigned __int8)v6 >> _ECX;
    __asm { rcr     ecx, 0Fh }
    v51 = (v14 | v13) - v14;
    v10 = __CFSHL__(v6, 13);
    v6 <<= 13;
    LODWORD(_RAX) = -877053599;
    LOBYTE(v6) = __ROL1__(v6, 18);
    v52 = v14 << ((_ECX - (v10 + v51)) >> 29);
    HIWORD(_ECX) = 22060;
  }
  LOWORD(v51) = v6;
  BYTE1(v6) += 74;
  LOWORD(_ECX) = v6;
  LODWORD(_RAX) = _RAX ^ 0xCBB933DE;
  v10 = __CFSHL__(v6, v6);
  LOBYTE(v6) = (_BYTE)v6 << v6;
  v32 = (v52 ^ v51) - (v10 + 527233017);
  v20 = ~_ECX << ~(_BYTE)_ECX;
  BYTE1(v20) |= BYTE1(v6);
  _ESI = __ROR4__(v52, v20);
  LOBYTE(v20) = (unsigned __int8)v20 >> v20;
  if ( _ESI == 698750369 )
  {
    LOWORD(_RAX) = *(char *)(v32 - 1311416820) * (char)_RAX;
    __DS__ = v55;
    LOBYTE(v6) = v6 + 84;
    v33 = 698750369 << ((char)((BYTE1(v6) != 0) - BYTE1(v6) - 116) >> 3 >> ((char)((BYTE1(v6) != 0) - BYTE1(v6) - 116) >> 3));
    LOWORD(v20) = v32;
    LOBYTE(v20) = (_BYTE)v20 << v20;
    if ( v33 != 1121555834 )
    {
      v18 = v20 - 1;
      v19 = v32 << v18;
      LOBYTE(v20) = BYTE4(_RAX) ^ (v18 | 0x1A);
      v21 = v33 & 0x1A4DFD95;
      while ( 1 )
      {
        LOBYTE(v6) = v6 ^ 0x62;
        _ESI = v21 - 42422432;
        LOBYTE(v20) = ((unsigned __int8)v20 ^ 0x25) << (v20 ^ 0x25);
        _ECX = v20 >> 23;
        if ( HIDWORD(_RAX) == 591543364 )
        {
          v22 = 78;
          v10 = v19 < v22;
          v8 = v19 - v22;
          v23 = _RAX;
          LODWORD(_RAX) = _ESI;
          v11 = v23;
        }
        else
        {
LABEL_38:
          BYTE1(_ECX) = 123;
          _ESI = __ROR4__(_ESI, _ECX) << 20;
          LOBYTE(v6) = __ROL1__(v6, 11);
          LOBYTE(_ECX) = _ECX - 63;
          __asm { rcr     ch, 7 }
          _ECX &= 0x23D32A54u;
          if ( v19 == 1618254638 )
            return result;
          while ( 1 )
          {
            _EDI = v6 + v19;
            __asm { rcl     edi, cl }
            _ESI = _ESI << 22;
            LOBYTE(_ECX) = _ECX & 0x33;
            LOBYTE(v6) = v6 + 50;
            BYTE1(_ECX) = 51;
            __asm { rcr     esi, 7 }
            _ECX &= 0xE0280A8D;
            BYTE1(_ECX) |= 0xF5u;
            v19 = __ROR4__(-534246771, _ECX);
            if ( (_DWORD)_RAX == 1924487153 )
            {
              LODWORD(_RAX) = -222439429;
              goto LABEL_38;
            }
            LOBYTE(_ECX) = BYTE1(_RAX) + _ECX;
            LOWORD(v19) = __ROR2__(v19, _ECX);
            LOBYTE(_ECX) = (char)((unsigned __int8)(_ECX ^ 0x6F) >> (_ECX ^ 0x6F)) >> ((unsigned __int8)(_ECX ^ 0x6F) >> (_ECX ^ 0x6F));
            v19 <<= 24;
            LOBYTE(_ECX) = (unsigned __int8)((_BYTE)_ECX << _ECX) >> ((_BYTE)_ECX << _ECX);
            BYTE1(_ECX) = BYTE1(v6) + (-(BYTE1(_ECX) | 0xCB) ^ 0x77);
            if ( (_DWORD)_RAX != 738008760 )
              break;
            LODWORD(_RAX) = 1244335015;
          }
          BYTE1(_ECX) = __ROL1__(BYTE1(_ECX), 11);
          *(_BYTE *)HIDWORD(_RAX) = v6;
          LOBYTE(_ECX) = BYTE1(v6) + 105;
          v5 = __ROR4__(__ROR4__(v19 >> 25, SBYTE1(v6)), 18);
          if ( _ECX == 1349607810 )
            JUMPOUT(0x40755D);
LABEL_6:
          v7 = __ROL4__(_ECX, 27);
          v8 = v5 - 1;
          BYTE1(v7) &= v7;
          v10 = BYTE1(v7) < 0xF5u;
          BYTE1(v7) += 11;
          _ECX = __CFSHR__(v7 - (v10 - 719194335), 20) + ((v7 - (v10 - 719194335)) >> 20) + 1010481934;
          v12 = __CFSHL__(_ESI, 28);
          v11 = __ROL4__(_ESI, 28);
          v10 = v12;
          ++HIDWORD(_RAX);
          __asm { rcr     ecx, cl }
        }
        LOBYTE(_ECX) = 66;
        v19 = v6 + (v11 < v10 + (unsigned int)_RAX) + v8;
        LOWORD(v19) = _ECX | v19;
        LOBYTE(_ECX) = _RAX + 66;
        v25 = ((v11 - (v10 + (_DWORD)_RAX)) ^ 0xBB851AD4) - (_ECX - (__CFADD__((_BYTE)_RAX, 66) + 684575912));
        v24 = (__PAIR64__(_ECX - (__CFADD__((_BYTE)_RAX, 66) + 684575912), (v11 - (v10 + (_DWORD)_RAX)) ^ 0xBB851AD4)
             - ((_ECX - (__CFADD__((_BYTE)_RAX, 66) + 684575912)) | 0x5E5CF49E00000000i64)) >> 32;
        v21 = v25;
        LOBYTE(v24) = __ROR1__(v24, 1);
        v26 = __CFSHL__(v19, v24);
        LOWORD(v19) = __ROL2__(v19, v24);
        v27 = _RAX + v26 + v24;
        if ( v25 != 173583541 )
          JUMPOUT(0x4078B9);
        __DS__ = *(_WORD *)(HIDWORD(_RAX) - 77 + 4);
        v20 = v27 - 1;
        if ( !v20 )
          JUMPOUT(0x407653);
      }
    }
    BYTE4(_RAX) = v58;
    LOBYTE(_ECX) = v59 + 1;
    __readeflags();
  }
  else
  {
    BYTE1(v20) |= 0xFBu;
    LOBYTE(v20) = v20 - 108;
    _ECX = v32 | v20;
    v44 = v6 - v32;
    BYTE1(v44) <<= _ECX;
    do
    {
      LOWORD(_ESI) = _ECX;
      BYTE1(v44) += 57;
      LOBYTE(v44) = BYTE1(_ECX) & v44;
      if ( _ECX != 1385137401 )
      {
        v15 = __ROR4__(_ECX, 17) << 28;
        LOBYTE(v15) = (_BYTE)v15 << v15;
        SBYTE1(v15) >>= v15;
        _ESI = _ESI & 0x8B2D0328;
        if ( v32 == 1201263660 )
        {
          __asm
          {
            outsd
            das
          }
          JUMPOUT(0x4075E0);
        }
        BYTE1(v15) = -BYTE1(v15);
        LOBYTE(v15) = (char)v15 >> v15;
        _ECX = v15 >> 4;
        BYTE1(_ECX) = -(char)((BYTE1(_ECX) | 0xD0) << _ECX);
        LOWORD(_ECX) = (unsigned __int16)_ECX >> _ECX;
        LOBYTE(_ECX) = _ECX & 0x94;
        __asm { rcl     ch, cl }
        LOWORD(_ECX) = (_WORD)_ECX << 6;
        LOBYTE(_ECX) = 0;
        __asm { rcl     ch, cl }
        JUMPOUT(0x407708);
      }
      *(_BYTE *)(_RAX + 89) += 124;
      LODWORD(_RAX) = MEMORY[0xE5DF79C4]();
      __asm { das }
      LOBYTE(v44) = v45 + v10 + v44;
      LOBYTE(v45) = v45 | 0x4C;
      v45 |= 0x1B15743Cu;
      BYTE1(v45) = (BYTE1(v45) << v45) - BYTE1(_RAX);
      _ESI = _ESI >> 29;
      v32 += 56240986;
      _ECX = v45 << 28;
      __asm { rcr     si, cl }
      _ESI = _ESI - ((_ECX & 1) - 322954050);
      LOBYTE(_ECX) = -1;
      v39 = WORD2(_RAX) + _ECX;
      v10 = (unsigned __int8)v39 < (unsigned __int8)v44;
      LOBYTE(_ECX) = v39 - v44;
      BYTE1(_ECX) = HIBYTE(v39) - (v10 + 102);
    }
    while ( v32 != 56240986 );
    BYTE1(_RAX) &= 0x52u;
    BYTE4(_RAX) ^= _RAX;
    __asm { rcr     eax, cl }
    v10 = __CFADD__(BYTE1(_ECX), BYTE4(_RAX));
    BYTE4(_RAX) += BYTE1(_ECX);
    LOBYTE(_ECX) = _ECX ^ 0xCB;
    _ECX = _ECX - 1650366072;
    BYTE1(_ECX) ^= 0xD2u;
    BYTE4(_RAX) += BYTE5(_RAX);
    if ( v44 - (v10 + 1627707414) == 380142324 )
    {
      _RAX = (int)_RAX;
      MEMORY[0x35A2B5A] = _RAX;
      v5 = 56240990;
      LODWORD(_RAX) = __indword((int)_RAX >> 31);
      LODWORD(_RAX) = _RAX - 1;
      v6 = 380142323;
      __outdword(WORD2(_RAX), _RAX);
      result = result - (double)MEMORY[0x16A882F3];
      goto LABEL_6;
    }
  }
  _DL = BYTE4(_RAX) + 1;
  __asm
  {
    rcr     cl, 0Eh
    rcl     dl, 8
  }
  return result;
}
// 407736: positive sp value 34 has been found
// 40755C: control flows out of bounds to 40755D
// 4075DF: control flows out of bounds to 4075E0
// 407651: control flows out of bounds to 407653
// 407783: control flows out of bounds to 407789
// 4079D4: control flows out of bounds to 4079DA
// 4075A5: control flows out of bounds to 4078B9
// 40783B: control flows out of bounds to 407708
// 40778A: could not find valid save-restore pair for ebp
// 4077CF: variable '_RAX' is possibly undefined
// 407667: variable 'v54' is possibly undefined
// 407735: variable 'v58' is possibly undefined
// 407736: variable 'v59' is possibly undefined
// 4078BF: variable 'v45' is possibly undefined
// 4078BF: variable 'v10' is possibly undefined

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
