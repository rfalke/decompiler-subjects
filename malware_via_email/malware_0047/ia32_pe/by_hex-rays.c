/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

HANDLE start();
SIZE_T __stdcall sub_4012FA(LPCVOID lpAddress);
void __noreturn sub_40134C(); // weak

//-------------------------------------------------------------------------
// Data declarations

// extern SIZE_T (__stdcall *VirtualQuery)(LPCVOID lpAddress, PMEMORY_BASIC_INFORMATION lpBuffer, SIZE_T dwLength);
// extern LPVOID (__stdcall *MapViewOfFile)(HANDLE hFileMappingObject, DWORD dwDesiredAccess, DWORD dwFileOffsetHigh, DWORD dwFileOffsetLow, SIZE_T dwNumberOfBytesToMap);
// extern HANDLE (__stdcall *CreateFileMappingA)(HANDLE hFile, LPSECURITY_ATTRIBUTES lpFileMappingAttributes, DWORD flProtect, DWORD dwMaximumSizeHigh, DWORD dwMaximumSizeLow, LPCSTR lpName);
// extern LPVOID (__stdcall *VirtualAlloc)(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// extern DWORD (__stdcall *GetCurrentProcessId)();
int dword_4011D4[53] =
{
  2118395904,
  689456327,
  531603,
  187382784,
  295494952,
  8,
  1253632516,
  225088001,
  224,
  -264860052,
  1344705510,
  2094143,
  67108868,
  -2112734964,
  14684796,
  -472252416,
  10535826,
  -1017053184,
  2111992180,
  -1923220385,
  1446515764,
  1360552450,
  233561651,
  64658528,
  2055940946,
  -335866760,
  79232816,
  1582896896,
  -722741957,
  -117239433,
  -1070393993,
  472142729,
  -373173269,
  -1961167856,
  2005602127,
  -336391136,
  1505956919,
  -336053153,
  1929330907,
  -336552836,
  48682515,
  52191235,
  -437536013,
  -856979873,
  99345451,
  -347152501,
  544685257,
  1996749265,
  1958156324,
  -638850765,
  -346637678,
  369059714,
  4196112
}; // weak


//----- (004012AA) --------------------------------------------------------
HANDLE start()
{
  HANDLE result; // eax
  HANDLE v1; // [esp-4h] [ebp-4h]

  result = CreateFileMappingA((HANDLE)0xFFFFFFFF, 0, 4u, 0, 0x4000u, 0);
  if ( result )
  {
    v1 = result;
    GetCurrentProcessId();
    result = MapViewOfFile(v1, 6u, 0, 0, 0);
    if ( result )
      return (HANDLE)sub_4012FA(result);
  }
  return result;
}

//----- (004012FA) --------------------------------------------------------
SIZE_T __stdcall sub_4012FA(LPCVOID lpAddress)
{
  SIZE_T result; // eax
  struct _MEMORY_BASIC_INFORMATION v2; // [esp+0h] [ebp-1Ch] BYREF

  VirtualQuery(lpAddress, &v2, 0x1Cu);
  result = v2.RegionSize >> 12;
  *(PVOID *)((char *)&v2.BaseAddress + (v2.RegionSize >> 12)) = *(char **)((char *)&v2.BaseAddress
                                                                         + (v2.RegionSize >> 12))
                                                              + (v2.RegionSize >> 12);
  return result;
}

//----- (0040134C) --------------------------------------------------------
void __noreturn sub_40134C()
{
  int *v0; // esi
  int *v1; // edi
  int v2; // ecx
  int v3; // eax

  v0 = dword_4011D4 + 70;
  v1 = (int *)VirtualAlloc(0, 0x8A0u, 0x3000u, 0x40u);
  v2 = 553;
  do
  {
    v3 = *v0++;
    *v1++ = v3 ^ 0x17000000;
    --v2;
  }
  while ( v2 );
  JUMPOUT(0xFFFFFFC0);
}
// 401397: control flows out of bounds to FFFFFFC0
// 4011D4: using guessed type int dword_4011D4[53];
// 40134C: using guessed type void __noreturn sub_40134C();

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
