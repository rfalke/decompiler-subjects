// subject_data.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

Eq_2 g_t404000 = // 00404000
	{
		&g_t4050
	};
Eq_2 g_t404004 = // 00404004
	{
		&g_t5400
	};
Eq_852 g_a404008[] = // 00404008
	{
	};
Eq_2 g_t4080D4 = // 004080D4
	{
		null
	};
word32 g_dw4080D8 = 0x00; // 004080D8
word32 g_dw4080DC = 0x00; // 004080DC
ptr32 g_ptr4080E0 = 0x00; // 004080E0
word32 g_dw4080E4 = 0x00; // 004080E4
Eq_2 g_t4080E8 = // 004080E8
	{
		null
	};
struct Eq_299 * g_ptr4080EC = null; // 004080EC
<anonymous> * g_ptr4080F0 = null; // 004080F0
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__RegOpenKeyA = &g_t1B52; // 00401000
<anonymous> * __imp__COMCTL32.dll_17 = &g_t80000011; // 00401008
<anonymous> * __imp__GetProcessHeap = &g_t1A80; // 00401010
<anonymous> * __imp__VirtualAlloc = &g_t1A92; // 00401014
<anonymous> * __imp__GetProcAddress = &g_t1AA2; // 00401018
<anonymous> * __imp__VirtualFree = &g_t1AB4; // 0040101C
<anonymous> * __imp__HeapAlloc = &g_t1A74; // 00401020
<anonymous> * __imp__MapViewOfFileEx = &g_t1AD4; // 00401024
<anonymous> * __imp__LoadLibraryA = &g_t1AE6; // 00401028
<anonymous> * __imp__CreateFileMappingA = &g_t1AF6; // 0040102C
<anonymous> * __imp__GetCommandLineA = &g_t1A62; // 00401030
<anonymous> * __imp__GetModuleHandleA = &g_t1A4E; // 00401034
<anonymous> * __imp__UnmapViewOfFile = &g_t1AC2; // 00401038
<anonymous> * __imp__CreateFileA = &g_t1A40; // 0040103C
<anonymous> * __imp__DialogBoxParamA = &g_t1B26; // 00401044
<anonymous> * __imp__LoadIconA = &g_t1B1A; // 00401048
<anonymous> * __imp__LoadCursorA = &g_t1B38; // 0040104C
// 00401060: void fn00401060(Stack Eq_2 dwArg04, Stack Eq_2 dwArg08, Stack Eq_2 dwArg0C)
// Called from:
//      fn00401480
//      fn004015F0
void fn00401060(Eq_2 dwArg04, Eq_2 dwArg08, Eq_2 dwArg0C)
{
	Eq_2 dwLoc08_33;
	for (dwLoc08_33 = 0x00; dwLoc08_33 < dwArg0C; ++dwLoc08_33)
		Mem26[dwArg04 + dwLoc08_33:byte] = Mem13[dwArg08 + dwLoc08_33:byte];
}

// 004010A0: void fn004010A0(Stack Eq_14 dwArg04, Stack Eq_2 dwArg08, Stack Eq_2 dwArg0C)
// Called from:
//      Win32CrtStartup
void fn004010A0(Eq_14 dwArg04, Eq_2 dwArg08, Eq_2 dwArg0C)
{
	Eq_17 tLoc24;
	Eq_14 tLoc20;
	Eq_19 tLoc10;
	if (RegOpenKeyA(0x80000002, 0x0040807C, &tLoc20) != 0x00)
	{
		Eq_9 dl_23 = *dwArg04;
		Eq_2 dwLoc0C_153 = 0x01;
		int32 dwLoc18_154 = 0x00;
		do
		{
			byte cl_31 = Mem28[dwArg04 + dwLoc0C_153:byte];
			++dwLoc0C_153;
			if ((word32) cl_31 == (word32) dl_23)
			{
				if ((word32) *((word32) dwArg04 + ((word32) dwLoc0C_153 + 1)) == 0x00)
				{
					dwArg08.u5[dwLoc18_154] = (char) dl_23;
					++dwLoc18_154;
					dwLoc0C_153 += 0x02;
				}
				else
				{
					int32 eax_74 = fn004011D0(&tLoc10, dwArg04.u0 + ((word32) dwLoc0C_153 + 1) / 4) + ((word32) dwLoc0C_153 + 1);
					dwLoc0C_153 = fn004011D0(&tLoc24, dwArg04.u0 + eax_74 / 4) + eax_74;
					up32 dwLoc1C_172;
					for (dwLoc1C_172 = 0x00; dwLoc1C_172 < tLoc10; ++dwLoc1C_172)
					{
						dwArg08.u5[dwLoc18_154] = dwArg08.u5[dwLoc18_154 - tLoc24];
						++dwLoc18_154;
					}
				}
			}
			else
			{
				dwArg08.u5[dwLoc18_154] = cl_31;
				++dwLoc18_154;
			}
		} while (dwLoc0C_153 < dwArg0C);
	}
}

// 004011D0: Register word32 fn004011D0(Stack (ptr32 ui32) dwArg04, Stack (ptr32 byte) dwArg08)
// Called from:
//      fn004010A0
word32 fn004011D0(ui32 * dwArg04, byte * dwArg08)
{
	LoadIconA(0x00, 0x7F00);
	ui32 dwLoc08_53 = 0x00;
	word32 dwLoc10_54 = 0x00;
	do
	{
		ui32 ecx_22 = (word32) *dwArg08;
		ui32 eax_31 = dwLoc08_53 << 0x07 | ecx_22 & 0x7F;
		++dwArg08;
		dwLoc08_53 = eax_31;
		++dwLoc10_54;
	} while ((ecx_22 & 0x80) != 0x00);
	*dwArg04 = eax_31;
	return dwLoc10_54;
}

// 00401300: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	ptr32 fp;
	word32 ebx;
	word32 esi;
	word32 edi;
	struct Eq_139 * fs;
	Eq_14 tLoc28;
	COMCTL32.dll!Ordinal_17(0x00);
	esp_20->tFFFFFFFC.u0 = 0x7F00;
	esp_20->tFFFFFFF8.u0 = 0x00;
	LoadCursorA(esp_20->tFFFFFFF8.u1, esp_20->tFFFFFFFC.u1);
	GetCommandLineA();
	esp_20->tFFFFFFFC.u0 = 0x00;
	Eq_2 eax_35 = GetModuleHandleA(esp_20->tFFFFFFFC.u1);
	esp_20->tFFFFFFFC.u0 = (DLGPROC) &tLoc28;
	esp_20->tFFFFFFF8.u0 = 0x004080BC;
	esp_20->tFFFFFFF4.u0 = 0x80000002;
	if (RegOpenKeyA(esp_20->tFFFFFFF4.u0, esp_20->tFFFFFFF8.u1, esp_20->tFFFFFFFC.u1) == 0x00)
	{
		Eq_2 eax_54 = g_t404000.u0;
		Eq_2 edx_57 = g_t404004.u0;
		Eq_2 dwLoc08_198 = 0x00;
		eax_158 = eax_54;
		while (true)
		{
			Eq_2 eax_158;
			if (dwLoc08_198 >= eax_54)
				break;
			dwLoc08_198.u4[0x00080801] = (struct Eq_873) (dwLoc08_198.u4[0x00080801] ^ 0x00891100);
			eax_158 = dwLoc08_198 + 0x08;
			dwLoc08_198 += 0x08;
		}
		esp_20->tFFFFFFFC.u0 = (DLGPROC) edx_57;
		fn00401960(esp_20->tFFFFFFFC.u0);
		g_t4080E8.u0 = (DLGPROC) eax_158;
		esp_20->tFFFFFFFC.u0 = (DLGPROC) eax_54;
		esp_20->tFFFFFFF8.u0 = g_t4080E8.u0;
		esp_20->tFFFFFFF4.u0 = 0x00404008;
		fn004010A0(esp_20->tFFFFFFF4.u0, esp_20->tFFFFFFF8.u0, esp_20->tFFFFFFFC.u0);
		g_ptr4080EC = fs->ptr0018;
		g_dw4080DC = edi;
		g_dw4080D8 = esi;
		g_dw4080E4 = ebx;
		g_ptr4080E0 = fp - 4;
		esp_20->tFFFFFFFC.u0 = (DLGPROC) eax_35;
		esp_20->tFFFFFFF8.u0 = (DLGPROC) (4199477 - eax_35);
		struct Eq_320 * ebp_115 = fn00401480(esp_20->tFFFFFFF8.u0, esp_20->tFFFFFFFC.u0);
		esp_20->tFFFFFFFC.u0 = g_t4080E8.u0;
		fn004015F0(esp_20->tFFFFFFFC.u0);
		ebp_115->dwFFFFFFC8 = 0x00;
		Eq_2 eax_144;
		g_ptr4080F0();
		return eax_144;
	}
	else
	{
		esp_20->tFFFFFFFC.u0 = 0x00;
		esp_20->tFFFFFFF8.u0 = 4199040;
		esp_20->tFFFFFFF4.u0 = 0x00;
		esp_20->tFFFFFFF0.u0 = 1000;
		esp_20->tFFFFFFEC.u0 = (DLGPROC) eax_35;
		DialogBoxParamA(esp_20->tFFFFFFEC.u1, esp_20->tFFFFFFF0.u1, esp_20->tFFFFFFF4.u0, esp_20->tFFFFFFF8.u0, esp_20->tFFFFFFFC.u0);
		return 0x00;
	}
}

// 00401480: Register ptr32 fn00401480(Stack Eq_2 dwArg04, Stack Eq_2 dwArg08)
// Called from:
//      Win32CrtStartup
ptr32 fn00401480(Eq_2 dwArg04, Eq_2 dwArg08)
{
	ptr32 fp;
	ptr32 ebp;
	word32 edx_16 = dwArg08 + Mem13[dwArg08 + 60:word32];
	g_t4080D4.u0 = (DLGPROC) VirtualAlloc(0x00, edx_16->t0050.u0, 0x3000, 0x40);
	if (g_t4080D4.u0 == 0x00)
		return ebp;
	fn00401060(g_t4080D4.u0, dwArg08, edx_16->t0050.u0);
	int32 eax_50 = g_t4080D4.u0 - dwArg08;
	if (edx_16->dw00A4 != 0x00)
	{
		word32 dwLoc0C_159 = dwArg08 + Mem51[edx_16 + 0xA0:word32];
		while (dwLoc0C_159->t0004.u0 != 0x00)
		{
			uint32 eax_85 = dwLoc0C_159->t0004.u0 - 0x08 >> 0x01;
			word16 dwLoc1C_168[] = (char *) &dwLoc0C_159->t0004 + 4;
			uint32 dwLoc08_169;
			for (dwLoc08_169 = 0x00; dwLoc08_169 < eax_85; ++dwLoc08_169)
			{
				if ((word32) dwLoc1C_168[dwLoc08_169] >> 0x0C == 0x03)
					Mem125[Mem93[0x004080D4<p32>:word32] + Mem93[dwLoc0C_159 + 0x00:word32] + (CONVERT(dwLoc1C_168[dwLoc08_169 * 0x02], word16, word32) & 0x0FFF):word32] = Mem93[Mem93[0x004080D4<p32>:word32] + Mem93[dwLoc0C_159 + 0x00:word32] + (CONVERT(dwLoc1C_168[dwLoc08_169 * 0x02], word16, word32) & 0x0FFF):word32] + eax_50;
			}
			dwLoc0C_159 += dwLoc0C_159->t0004.u0 / 8;
		}
	}
	word32 eax_68 = dwArg04 + Mem66[0x004080D4<p32>:word32];
	eax_68();
	return fp - 4;
}

// 004015D0: Register Eq_471 fn004015D0(Stack Eq_2 dwArg04, Stack Eq_2 dwArg08)
// Called from:
//      fn004015F0
Eq_471 fn004015D0(Eq_2 dwArg04, Eq_2 dwArg08)
{
	Eq_471 eax_14 = GetProcAddress(dwArg04, dwArg08);
	return eax_14;
}

// 004015F0: void fn004015F0(Stack Eq_2 dwArg04)
// Called from:
//      Win32CrtStartup
void fn004015F0(Eq_2 dwArg04)
{
	word32 edx_13 = dwArg04 + Mem10[dwArg04 + 60:word32];
	struct Eq_485 * dwLoc20_410 = &edx_13->w0014 + 2 + (word32) edx_13->w0014 / 84;
	Eq_2 eax_30 = VirtualAlloc(0x00, edx_13->t0050.u0, 0x3000, 0x40);
	if (eax_30 == 0x00)
		return;
	fn00401060(eax_30, dwArg04, (word32) dwArg04.u10.u1[3].dw003C + 252 + (word32) edx_13->w0006 *s 0x28);
	up32 dwLoc0C_419;
	for (dwLoc0C_419 = 0x00; dwLoc0C_419 < (word32) edx_13->w0006; ++dwLoc0C_419)
	{
		if (dwLoc20_410->dw0014 != 0x00 && dwLoc20_410->dw0010 != 0x00)
			fn00401060(eax_30 + Mem369[dwLoc20_410 + 0x0C:word32], dwArg04 + Mem364[dwLoc20_410 + 20:word32], CONVERT(CONVERT(Mem59[dwLoc20_410 + 16:word32] - 1 + Mem59[edx_13 + 60:word32], word32, uint64) /u Mem59[edx_13 + 60:word32], word32, uint32) *s Mem59[edx_13 + 60:word32]);
		++dwLoc20_410;
	}
	word32 ecx_68 = eax_30 + Mem65[eax_30 + 60:word32];
	Eq_535 eax_85 = CreateFileMappingA((void *) ~0x00, null, 0x04, 0x00, ecx_68.u0->t0050.u0, 0x00);
	if (eax_85 == null)
		return;
	word32 dwLoc40_432 = eax_30 + Mem87[ecx_68 + 0x80:word32];
	while (dwLoc40_432.u0[4] != 0x00)
	{
		Eq_621 dwLoc2C_469;
		Eq_622 dwLoc1C_468;
		word32 eax_234 = LoadLibraryA(eax_30 + Mem96[dwLoc40_432 + 0x0C:word32]);
		if (dwLoc40_432.u0->dw0000 != 0x00)
		{
			dwLoc1C_468 = eax_30 + Mem236[dwLoc40_432 + 0x00:word32];
			dwLoc2C_469 = eax_30 + Mem252[dwLoc40_432 + 16:word32];
		}
		else
		{
			dwLoc1C_468 = eax_30 + Mem236[dwLoc40_432 + 16:word32];
			dwLoc2C_469 = eax_30 + Mem243[dwLoc40_432 + 0x00:word32];
		}
		word32 dwLoc10_472 = 0x00;
		if (dwLoc40_432.u0[4] != 0x00 && (dwLoc40_432.u0)->dw0000 != 0x00)
			dwLoc10_472 = 0x01;
		while (dwLoc1C_468.u0->dw0000 != 0x00)
		{
			if ((dwLoc1C_468.u0->dw0000 & 0x80000000) != 0x00)
				dwLoc1C_468.u0->dw0000 = fn004015D0(eax_234, dwLoc1C_468.u0->dw0000 & 0x7FFFFFFF);
			else
				Mem298[dwLoc1C_468 + 0x00:word32] = fn004015D0(eax_234, Mem268[dwLoc1C_468 + 0x00:word32] + 2 + eax_30);
			if (dwLoc1C_468.u0->dw0000 == 0x00)
				return;
			if (dwLoc10_472 != 0x00)
				dwLoc2C_469.u0->dw0000 = dwLoc1C_468.u0->dw0000;
			dwLoc1C_468 += 0x04;
			dwLoc2C_469 += 0x04;
		}
		dwLoc40_432 += 0x14;
	}
	g_t4080D4.u0 = (DLGPROC) MapViewOfFileEx(eax_85, 0x22, 0x00, 0x00, 0x00, ecx_68.u0->t0034.u0);
	if (g_t4080D4.u0 == 0x00)
	{
		if (UnmapViewOfFile(ecx_68.u0->t0034.u0) == 0x00 && VirtualFree(((ecx_68.u0)->t0034).u0, 0x00, 0x8000) == 0x00)
			return;
		g_t4080D4.u0 = (DLGPROC) MapViewOfFileEx(eax_85, 0x22, 0x00, 0x00, 0x00, ecx_68.u0->t0034.u0);
		if (g_t4080D4.u0 == 0x00)
		{
			g_t4080D4.u0 = (DLGPROC) VirtualAlloc(ecx_68.u0->t0034.u0, ecx_68.u0->t0050.u0, 0x3000, 0x40);
			if (g_t4080D4.u0 == 0x00)
				return;
		}
	}
	fn00401060(g_t4080D4.u0, eax_30, ecx_68.u0->t0050.u0);
	fn00401930(g_t4080D4.u0);
	Mem216[0x004080F0<p32>:word32] = Mem207[0x004080D4<p32>:word32] + Mem207[ecx_68 + 40:word32];
	ecx_68.u0->ptr0028 = g_ptr4080F0;
}

// 00401930: void fn00401930(Stack Eq_2 dwArg04)
// Called from:
//      fn004015F0
void fn00401930(Eq_2 dwArg04)
{
	g_ptr4080EC->ptr0030->t0008.u0 = (DLGPROC) dwArg04;
}

// 00401960: void fn00401960(Stack Eq_2 dwArg04)
// Called from:
//      Win32CrtStartup
void fn00401960(Eq_2 dwArg04)
{
	HeapAlloc(GetProcessHeap(), 0x00, dwArg04);
}

word32 g_dw4019EC = 6994; // 004019EC
word32 g_dw4019F4 = 0x80000011; // 004019F4
word32 g_dw4019FC = 0x1A80; // 004019FC
word32 g_dw401A00 = 0x1A92; // 00401A00
word32 g_dw401A04 = 0x1AA2; // 00401A04
word32 g_dw401A08 = 6836; // 00401A08
word32 g_dw401A0C = 6772; // 00401A0C
word32 g_dw401A10 = 6868; // 00401A10
word32 g_dw401A14 = 6886; // 00401A14
word32 g_dw401A18 = 0x1AF6; // 00401A18
word32 g_dw401A1C = 0x1A62; // 00401A1C
word32 g_dw401A20 = 0x1A4E; // 00401A20
word32 g_dw401A24 = 0x1AC2; // 00401A24
word32 g_dw401A28 = 0x1A40; // 00401A28
word32 g_dw401A30 = 0x1B26; // 00401A30
word32 g_dw401A34 = 0x1B1A; // 00401A34
word32 g_dw401A38 = 6968; // 00401A38
