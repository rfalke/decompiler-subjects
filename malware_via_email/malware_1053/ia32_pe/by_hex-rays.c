/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// char __usercall start@<al>(bool@<cf>, unsigned int _EAX@<eax>, int _EDX@<edx>, int _ECX@<ecx>, int _EBX@<ebx>, _DWORD *_EDI@<edi>, int _ESI@<esi>, __int128 _XMM0@<xmm0>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_407BF2; // weak


//----- (004066F2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
char __usercall start@<al>(
        bool a1@<cf>,
        unsigned int _EAX@<eax>,
        int _EDX@<edx>,
        int _ECX@<ecx>,
        int _EBX@<ebx>,
        _DWORD *_EDI@<edi>,
        int _ESI@<esi>,
        __int128 _XMM0@<xmm0>)
{
  int v11; // ebx
  unsigned int v12; // ecx
  char *v13; // edx
  int v16; // eax
  int v17; // edi
  int v18; // esi
  _BYTE *v19; // edi
  unsigned int v20; // ett
  unsigned int v22; // edx
  unsigned int v27; // ecx
  __int16 v28; // cx
  unsigned int v29; // edx
  char v31; // dh
  int v32; // esi
  int v34; // edx
  int v35; // esi
  int v36; // ebx
  int v37; // edi
  int v38; // ecx
  int v39; // esi
  int v41; // esi
  unsigned int v42; // ecx
  char v46; // al
  int v52; // ecx
  char v55; // bl
  bool v56; // cf
  bool v60; // cf
  __int16 v61; // dx
  int v66; // esi
  BOOL v68; // ett
  int v70; // edi
  int v71; // ecx
  unsigned __int16 v74; // dx
  int v75; // edi
  bool v76; // tt
  unsigned __int16 v78; // tt
  int v80; // eax
  bool v81; // tt
  unsigned int v83; // esi
  unsigned int v91; // edi
  __int16 v92; // si
  int v93; // eax
  unsigned int v94; // eax
  unsigned int v95; // esi
  unsigned __int8 v96; // dh
  char v97; // cf
  char v98; // tt
  char v99; // cl
  int v101; // edx
  int v103; // ebx
  unsigned int v104; // ecx
  bool v105; // tt
  unsigned int v107; // [esp-2Ch] [ebp-2Ch]
  char *v108; // [esp-28h] [ebp-28h]
  char v109; // [esp-24h] [ebp-24h] BYREF
  _BYTE v110[31]; // [esp-23h] [ebp-23h] BYREF
  int v111; // [esp-4h] [ebp-4h] BYREF

start:
  LOBYTE(_ECX) = 4
               * (_ECX
                - ((BYTE1(_EDX) < (unsigned __int8)((__CFADD__(a1, BYTE1(_EAX)) | __CFADD__(a1 + BYTE1(_EAX), 61))
                                                  + BYTE1(_EBX)))
                 - 43));
  LOWORD(_EDX) = (_WORD)_EDI;
  __asm { rcr     ecx, 7 }
  BYTE1(_EAX) = 0;
  __asm { rcr     edi, 9 }
  while ( 1 )
  {
    LOWORD(_EDI) = (_WORD)_EDI << _ECX;
    BYTE1(_ECX) -= 22;
    BYTE1(_EDX) &= BYTE1(_EBX);
    v81 = __CFSHL__(_ECX, _ECX);
    _ECX = __ROL4__(_ECX, _ECX);
    __asm { rcr     cl, 1Dh }
    LOBYTE(_EAX) = _EBX ^ _EAX;
    v83 = _ESI | 0xD191E180;
    BYTE1(_EAX) = v81 + BYTE1(_EAX) - 33 + 1;
    if ( _EAX == -633089357 )
      break;
    BYTE1(_EDX) = (BYTE1(_EDX) | 0xA9) - 45;
    _ESI = __ROR4__(__ROL4__(v83, _ECX), 8);
    BYTE1(_EAX) ^= BYTE1(_EDX);
LABEL_34:
    HIWORD(_ECX) = -156;
    LOBYTE(_EAX) = _EAX - 45;
    v31 = BYTE1(_EDX) & 0x7F;
    v32 = _ESI >> 23;
    LOWORD(v32) = __ROR2__(v32, 119);
    LOWORD(_ECX) = _EBX;
    v94 = _EAX - v32;
    LOBYTE(v94) = BYTE1(_EBX) + v94;
    v95 = _EDI & v32 | 0xB5DC041E;
    v96 = BYTE1(_EBX) | ((v31 & 0x6D) - 1);
    if ( v94 == -91681589 )
    {
      __asm { icebp }
      JUMPOUT(0x4069EE);
    }
    LOBYTE(v61) = 0;
    __asm { rcl     ecx, 1Eh }
    BYTE1(_ECX) >>= _ECX;
    a1 = __CFSHL__(v94, _ECX);
    LOBYTE(v94) = (_BYTE)v94 << _ECX;
    v80 = _EBX + a1 + v94;
    _ESI = v95 + 1;
    LOBYTE(v80) = v80 ^ 0x6C;
    LOWORD(_EDI) = ~(_ESI ^ _EDI);
    v60 = __CFSHR__(v96, _ECX);
    HIBYTE(v61) = v96 >> _ECX;
    v74 = _ECX + v60 + v61;
    v75 = _ECX ^ _EDI;
    v76 = __CFSHR__(BYTE1(_ECX), _ECX);
    BYTE1(_ECX) = __ROR1__(BYTE1(_ECX), _ECX);
    v78 = v76 + (_WORD)_ECX;
    a1 = v74 < v78;
    _DX = v74 - v78;
    LOBYTE(v78) = a1 + BYTE1(v80);
    a1 = HIBYTE(_DX) < (unsigned __int8)(a1 + BYTE1(v80));
    HIBYTE(_DX) -= v78;
    BYTE1(_ECX) -= a1 + _EBX;
    __asm { rcl     dh, cl }
    a1 = __CFSHL__(_DX, _ECX);
    LOWORD(_EDX) = _DX << _ECX;
    BYTE1(v80) += BYTE1(_EDX) + a1;
    LOBYTE(_EDX) = (_BYTE)_EDX << 6;
    if ( _ECX != -1837783241 )
    {
      v91 = ~v75;
      SBYTE1(_ECX) >>= 6;
      BYTE1(v80) = __ROL1__(BYTE1(v80), _ECX);
      v92 = _ESI - _ECX;
      v93 = v80 << 27;
      BYTE1(v93) = __ROL1__(BYTE1(v93), _ECX);
      if ( _EBX == -830370476 )
      {
        *(_DWORD *)(v93 + 1666105592) = (__PAIR64__(*(_DWORD *)(v93 + 1666105592), -830370476)
                                       - __PAIR64__(v91, -830370476)) >> 32;
        JUMPOUT(0x4069C2);
      }
      SBYTE1(_ECX) >>= 7;
      _ECX = _ECX ^ 0x871DA408;
      LOWORD(_ESI) = v92 - _ECX;
      __asm { rcr     ch, cl }
      _ECX = _ECX >> _ECX;
      v46 = __ROL4__(v93, _ECX);
      _DH = BYTE1(_EDX) << _ECX;
      __asm { rcr     dh, cl }
      if ( v91 != -1294004685 )
      {
        _CL = ((char)(BYTE1(_EBX) + (v91 < 0xB2DF0E33)) >> 5) & 0x5B;
        _AX = __ROL2__(-(__int16)(_ESI >> 13), _CL);
        __asm
        {
          rcl     ah, 8
          rcr     cl, cl
        }
        JUMPOUT(0x406A42);
      }
      MEMORY[0xB9E31F96] = v46;
      LOBYTE(v28) = 1;
LABEL_41:
      _CL = v28 - (__CFSHR__(BYTE1(_EBX), 10) + _EBX);
      __asm
      {
        rcl     cl, cl
        rcr     bl, 0Ch
      }
      JUMPOUT(0x406515);
    }
    *(_DWORD *)(_EBX - 125) = _EDX;
    __asm
    {
      into
      rcl     esi, cl
    }
    LOBYTE(_EBX) = ~(_BYTE)_EBX;
    _EDI = __ROR4__(v75, 20);
    if ( _EDX >> 23 != -1986128301 )
    {
      BYTE1(_EBX) = -40;
      _CL = BYTE1(_ECX) + 56;
      _EBX = _EBX >> 17;
      __asm { rcl     bh, cl }
      JUMPOUT(0x406332);
    }
    _EAX = MEMORY[0xFCD27790]();
  }
  __asm { vcvtsi2sd xmm1, xmm0, dword ptr [ebx+794C5D88h] }
  while ( 1 )
  {
    a1 = __CFSHL__(_ECX, _ECX);
    _ECX = _ECX << _ECX;
    HIBYTE(_BX) = BYTE1(_EBX) - (a1 + _EAX);
    _BL = 28;
    __asm { rcr     ecx, 0Fh }
    LOBYTE(_ECX) = _ECX + 28;
    _ESI = _EAX;
    __asm
    {
      rcl     bl, cl
      rcr     esi, 1Dh
    }
    LOWORD(_ESI) = _BX ^ _ESI;
    v41 = _ESI ^ 0x2243DEA2;
    LOBYTE(_EBX) = BYTE1(_EAX) & (HIBYTE(_BX) ^ 0x7C);
    BYTE1(_EBX) = ~HIBYTE(_BX);
    BYTE1(_ECX) = __ROR1__(__ROR1__(BYTE1(_ECX) + 76, 5), _ECX);
    v42 = _ECX | 0xFD777ED2;
    BYTE1(_EBX) = ((unsigned __int8)v42 | BYTE1(_EBX)) << v42;
    v34 = _EDX + 1;
    LOBYTE(v42) = v42 + 1;
    a1 = __CFADD__(BYTE1(v42) < 0xF3u, (_BYTE)v42);
    LOBYTE(v42) = (BYTE1(v42) < 0xF3u) + v42;
    a1 |= __CFADD__((_BYTE)v42, 68);
    LOBYTE(v42) = v42 + 68;
    v35 = a1 + v41 - 286492864;
    v36 = _EBX + 291277133;
    BYTE1(v42) = (BYTE1(v42) + 13) ^ 0x77;
    BYTE1(v36) += 77;
    if ( _EDI == -1251061202 )
    {
      __asm { rep retf }
      JUMPOUT(0x406423);
    }
    LOBYTE(v36) = v36 & 0xCD;
    a1 = __CFSHR__(v42, v42);
    LOBYTE(v42) = (unsigned __int8)v42 >> v42;
    v52 = v42 - (a1 - 285230533) + 1;
    BYTE1(v52) = v52 + __CFSHL__(-BYTE1(v52), v52) + (-BYTE1(v52) << v52);
    v38 = __CFSHL__(v36, 8) + v52 + 1184875821;
    HIWORD(v37) = 0;
    LOBYTE(v38) = ~(_BYTE)v38;
    v39 = v34 | v35;
    LOBYTE(v36) = __ROL1__(v36, 8) + 40;
    LOWORD(v36) = (_WORD)v36 << v38;
    v11 = v36 << 10;
    v12 = v38 | 0xB85ACCA7;
    LOWORD(v37) = _EAX;
    LOBYTE(v11) = 0;
    _EDI = v34 & v37;
    _EBX = v11 + 1;
    LOWORD(v39) = v39 - _EBX;
    BYTE1(_EBX) -= 16;
    LOBYTE(_EBX) = v12 + (_EBX & 0x45);
    if ( v39 != 349245420 )
      JUMPOUT(0x4061C7);
    v13 = v108;
    v108 = &v109;
    *(_BYTE *)(_EBX - 44) = BYTE1(_EBX);
    LOBYTE(_EAX) = -25 - v12;
    _ECX = v12 << 8;
    v16 = __ROL4__(_EAX, 27);
    __asm { rcr     ch, cl }
    _ESI = 349245420 << _ECX;
    a1 = __CFSHR__(v16, 4);
    LOBYTE(v16) = (char)v16 >> 4;
    _EDX = a1 + __ROR4__(v13 + 349245420, 18) - 196803397;
    if ( _ECX != -1983702374 )
    {
      _EAX = (__ROR4__(v16, 11) ^ 0x8404598E) - 1;
      LOBYTE(_ECX) = ~(_BYTE)_ECX;
      _EDX >>= 4;
      BYTE1(_EDX) = 0;
      LOBYTE(_EAX) = __ROL1__(BYTE1(_EBX) & _EAX, _ECX);
      __asm { rcl     dl, 1Dh }
      if ( _EAX != 500652579 )
      {
        __asm { rcr     edi, 15h }
        BYTE1(_EDX) = -1;
        if ( _EDX == -1333218728 )
        {
          *(_BYTE *)(_ECX + 101) |= 0x55u;
          JUMPOUT(0x406AAB);
        }
        JUMPOUT(0x406223);
      }
      goto LABEL_34;
    }
    __asm { outsd }
    _EAX = *(_DWORD *)_ESI;
    v18 = _ESI + 5;
    v17 = _EDI + 1;
    *(_DWORD *)(_EBX + 484425884) -= _EDX;
    if ( _EDX == 30068879 )
    {
      LOWORD(_EDX) = 0;
      BYTE1(_ECX) = -27;
      _ESI = v18 << 25;
      LOBYTE(_EAX) = 31 - _EAX;
      if ( _EBX != 1632901000 )
        return _EAX;
      ++_EDX;
      v109 = _EAX;
      v19 = v110;
      goto LABEL_24;
    }
    LOWORD(v18) = v18 & 0x1A9A;
    LOBYTE(_EBX) = _EBX - 98;
    v71 = _EDX + __ROL4__(-1983702374, 6);
    v70 = (v17 - 1509861283) ^ 0x14A57A99;
    BYTE1(v71) = (BYTE1(_EDX) + BYTE1(v71)) << v71;
    _ESI = v18 << 9;
    BYTE1(_EBX) = ~__ROR1__(BYTE1(_EBX), v71);
    __asm { rcl     esi, 19h }
    v19 = (_BYTE *)(_EAX & v70);
    v98 = _EAX & 1;
    _EAX = __ROR4__(_EAX, 1);
    v97 = v98;
    if ( !v98 )
    {
      v99 = v97 + v71 + 49;
      if ( _EAX == -145550276 )
      {
        MEMORY[0xD612C8C7] = 60;
        v101 = __ROR4__(_EDX, 11);
        LOBYTE(v71) = 0;
        _ECX = v71 << 25;
        __asm { rcl     al, cl }
        SBYTE1(v101) >>= 7;
        if ( _ECX == 2049666266 )
        {
          v107 = (unsigned __int16)__DS__;
          __outbyte(v101, _AL);
          _ECX = 2049638616;
          __writeeflags(v107);
          __asm { int     2Eh; DOS 2+ internal - EXECUTE COMMAND }
          v103 = _EBX << 24;
          LOBYTE(v103) = (char)v103 >> 7;
          __asm { rcl     ch, 0Bh }
          _EBX = __ROL4__(v103, 21);
          __asm { rcl     ecx, cl }
          LOWORD(_EBX) = _EBX - 1;
          __asm { rcl     ebx, cl }
          JUMPOUT(0x4062B7);
        }
        v29 = v101 | 0xEA9F1C10;
        BYTE1(_ECX) = (BYTE1(_ECX) - 11) | 0x41;
        a1 = __CFSHL__(v29, 26);
        v22 = v29 << 26;
        __asm { rcl     cx, cl }
        LOBYTE(_CX) = BYTE1(v22) ^ _CX;
        BYTE1(v22) -= 110 - a1;
        if ( v22 << _CX == 1427892895 )
          __halt();
        JUMPOUT(0x4064F9);
      }
      LOBYTE(v71) = v99 - (__CFSHR__(_EAX & ((_EAX < 0xF753143C) + _EBX - 113), 29) + _EAX);
      if ( _EDX == 1225110450 )
      {
        __asm { aam     62h ; 'b' }
        __readeflags();
        JUMPOUT(0x4066CC);
      }
      BYTE1(v71) <<= v71;
      _CX = (unsigned __int16)-(__int16)v71 >> -(char)v71;
      __asm { rcr     ch, 6 }
      _EBX = -674825858;
      if ( _EAX == 1498112662 )
      {
        __asm { aas }
        JUMPOUT(0x406162);
      }
      __asm
      {
        rcl     ebx, 5
        rcl     bl, 12h
      }
      ((void (*)(void))loc_407BF2)();
      *(_DWORD *)&v110[27] = &v111;
      __asm { into }
      JUMPOUT(0x406AEC);
    }
    LOBYTE(v71) = (_BYTE)v71 << v71;
    if ( _ESI == 864380819 )
      return _EAX;
    v27 = ~v71;
    LOBYTE(_EBX) = _EBX + 1;
    LOWORD(_ESI) = __ROL2__(_ESI, v27);
    _EBX -= 1000547979;
    SBYTE1(v27) >>= v27;
    _ECX = v27 >> 19;
    if ( v19 == (_BYTE *)1911545444 )
    {
      __asm { fld     dword ptr [ebx-0CE580B0h] }
      LOBYTE(_ECX) = BYTE1(_EBX) + _ECX;
      LOBYTE(_EBX) = __ROR1__(_EBX, 27);
      _EBX = -_EBX;
      v28 = (__int16)_ECX >> _ECX;
      LOBYTE(_EBX) = _EBX - 58;
      goto LABEL_41;
    }
LABEL_24:
    LOBYTE(_EBX) = _EBX + 29;
    a1 = __CFADD__(__PAIR64__(_EDX, -1216463921), __PAIR64__((unsigned int)v19, _ECX));
    _EDI = (_DWORD *)((__PAIR64__(_EDX, -1216463921) + __PAIR64__((unsigned int)v19, _ECX)) >> 32);
    BYTE1(_EBX) = ~BYTE1(_EBX);
    v20 = a1 + _EBX;
    LOWORD(_ESI) = (_WORD)_EDI + (_ECX - 1216463921 < v20) + (_WORD)_ESI;
    _EBX = 1724933539;
    _ECX = __ROL4__(_ECX - 1216463921 - v20, 7);
    if ( _ESI == 1789699887 )
    {
      BYTE1(_EAX) |= *(_BYTE *)_EAX;
      *_EDI = _EAX;
      JUMPOUT(0xCE0FABF6);
    }
    __asm { rcr     bl, 0Ah }
    LOWORD(_ESI) = -(__int16)_ESI;
    BYTE1(_EBX) = BYTE1(_ECX) + 101;
    LOBYTE(_EBX) = _BL | 0xD9;
    BYTE1(_ECX) &= 0xB8u;
    if ( _EDI == (_DWORD *)-1808373081 )
    {
      BYTE1(_ECX) |= _EAX;
      __writeeflags((unsigned int)&v109);
      __asm
      {
        outsd
        fmul    qword ptr [ecx+7Dh]
      }
      goto start;
    }
    LOBYTE(_ECX) = (_BYTE)_ECX << _ECX;
    a1 = __CFSHR__(_ESI, 14);
    v66 = _ESI >> 14;
    v68 = a1;
    a1 = __CFADD__(a1, _EDI);
    _EDI = (char *)_EDI + v68;
    a1 |= __CFADD__(_EDI, 2111329992);
    _EDI += 2111329992;
    __asm
    {
      rcr     edi, 19h
      rcr     edi, cl
    }
    LOBYTE(_ECX) = _EDX;
    _ECX = a1 + _ECX + 569286189;
    _BH = SBYTE1(_EBX) >> _ECX;
    __asm { rcr     edi, cl }
    a1 = __CFSHL__(_ECX, 13);
    LOBYTE(_ECX) = 0;
    _EAX = __GS__;
    __asm { rcr     bl, cl }
    v55 = _BL - 1;
    __asm { rcr     di, cl }
    LOBYTE(v68) = a1;
    v56 = __CFADD__(__GS__, a1);
    LOBYTE(_ECX) = __GS__ + v68;
    __asm { rcl     bh, 0Fh }
    LOBYTE(_ECX) = v56 + _ECX - 101;
    v104 = _ECX >> 15;
    v105 = __CFSHR__(v55, v104);
    LOBYTE(_EBX) = __ROR1__(v55, v104);
    LOBYTE(v104) = v104 - (v105 + __GS^1__);
    _ECX = v104 - 1946507355;
    LOBYTE(_ECX) = __ROR1__(_ECX, 18);
    if ( v66 == 1552105037 )
    {
      _enable();
      BYTE1(_EBX) -= *(_BYTE *)_EDX;
      __asm
      {
        fdiv    st, st(6)
        fdiv    dword ptr [ebx]
      }
      JUMPOUT(0x406AB0);
    }
  }
}
// 406AE8: positive sp value 28 has been found
// 406160: control flows out of bounds to 406162
// 4062B4: control flows out of bounds to 4062B7
// 4062C0: inconsistent fpu stack
// 406440: control flows out of bounds to 406442
// 4064F7: control flows out of bounds to 4064F9
// 4066CB: control flows out of bounds to 4066CC
// 4069BC: control flows out of bounds to 4069C2
// 4069ED: control flows out of bounds to 4069EE
// 406AAE: control flows out of bounds to 406AB0
// 406AEB: control flows out of bounds to 406AEC
// 4062EC: control flows out of bounds to 4062ED
// 406421: control flows out of bounds to 406423
// 406222: control flows out of bounds to CE0FABF6
// 4065C3: control flows out of bounds to 406515
// 4068D5: control flows out of bounds to 406AAB
// 406919: control flows out of bounds to 406A42
// 406937: control flows out of bounds to 406332
// 406971: control flows out of bounds to 49BDCA96
// 4067FB: control flows out of bounds to 406223
// 406189: control flows out of bounds to 4061C7
// 4062EA: control flows out of bounds to 4062BE
// 40643A: control flows out of bounds to 406193
// 4066F2: variable 'a1' is possibly undefined
// 406844: variable '_EDX' is possibly undefined
// 40686D: variable '_ECX' is possibly undefined
// 40618B: variable 'v108' is possibly undefined

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
