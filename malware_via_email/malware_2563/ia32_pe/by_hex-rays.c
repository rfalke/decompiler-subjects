/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

void sub_401000();
// int __userpurge sub_4010C3@<eax>(__int16 a1@<ax>, unsigned int a2@<edx>, unsigned int a3@<ecx>, int a4, int a5, int a6);
void sub_402419();
void sub_402684();
// void __usercall start(int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4@<esi>);
void sub_4033B9();
void sub_4034E2();
void sub_403CFF();
int __stdcall sub_403D2E(int a1);
int __fastcall sub_403DE1(int a1, int a2, int a3, int a4, int a5);
// int __userpurge sub_40431D@<eax>(int a1@<eax>, int a2, int a3, int a4, int a5);
void sub_40447A();
void sub_404894();
void sub_4048A7();
void sub_4048EC();
void __fastcall sub_405249(__int16 a1);
void __cdecl sub_405597(_BYTE *a1, int a2, int a3);
// void __usercall sub_406047(int a1@<eax>, int a2@<ebx>, int a3@<esi>);
// void __usercall sub_4062C7(unsigned int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4@<esi>, int a5, int a6, int a7);
void __thiscall sub_4063BC(void *this);
// __int64 __usercall sub_4065BC@<edx:eax>(unsigned int a1@<ecx>, void *a2@<edi>, const void *a3@<esi>);
_DWORD sub_406899(); // weak
// void __usercall sub_406A47(unsigned int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4@<esi>, int a5, int a6, int a7, int a8);
void sub_406B6C();
void __cdecl sub_406DF2(int a1, int a2, int a3);
void __cdecl sub_406E0C(int a1, int a2);
// int __usercall sub_406EDA@<eax>(char a1@<cl>, int a2@<ebx>);
void __fastcall sub_407574(int a1, int a2);
void sub_40F25A();
// BOOL __stdcall DisableThreadLibraryCalls(HMODULE hLibModule);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_40E470; // weak
_UNKNOWN unk_42059F; // weak
_UNKNOWN unk_42069F; // weak
int dword_439008 = 0; // weak
int dword_439010 = 0; // weak
int dword_439014 = 0; // weak
int dword_439018 = 0; // weak
int dword_439024 = 0; // weak
int dword_43902C = 0; // weak
int dword_439030 = 0; // weak
int dword_439034 = 0; // weak
int dword_439038 = 0; // weak
int dword_43903C = 0; // weak
int dword_439044 = 0; // weak
int dword_439048 = 0; // weak
int dword_439184 = 0; // weak
char byte_43928C = '\0'; // weak
int dword_439654 = 0; // weak
int dword_4399C8 = -1762917117; // weak
int dword_439A1C = -373227520; // weak
int dword_439B94 = -211526; // weak
int dword_439BBC = 408128256; // weak
char byte_439CFC = 'D'; // weak
int dword_439DE4 = 38857210; // weak
char byte_439FC8 = '³'; // weak
int dword_43A0C8 = 1342194580; // weak
int dword_43A194 = 585745079; // weak
int dword_43A950 = -973078400; // weak
int dword_43A9A4 = 989855752; // weak
int dword_43AB65 = 0; // weak
_UNKNOWN unk_43AB69; // weak
_UNKNOWN unk_43ACA8; // weak
_UNKNOWN unk_43ACC8; // weak
__int64 (__fastcall *dword_43ACE8)(_DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
_UNKNOWN unk_43ACF0; // weak
int (__fastcall *dword_43ACF2)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
int (__thiscall *dword_43ACF6)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD) = NULL; // weak
_UNKNOWN unk_43ACFE; // weak
_DWORD dword_43AD1E = 0; // idb
int dword_43AD22 = 0; // weak
int dword_43AD26 = 880815431; // weak


//----- (00401000) --------------------------------------------------------
void sub_401000()
{
  int v0; // edx
  int v1; // ecx
  unsigned __int8 v2; // [esp+264h] [ebp-A8h]

  sub_403D2E(30);
  if ( (v1 & 0x12C4) == 0 )
  {
    if ( ((__CFADD__(v2, 8715) + v2 + 8715 + 8347) & v1) == 0 && !v0 )
      JUMPOUT(0x401285);
    JUMPOUT(0x4029FB);
  }
  JUMPOUT(0x404FFD);
}
// 402FE6: control flows out of bounds to 401285
// 404D91: control flows out of bounds to 4029FB
// 405021: control flows out of bounds to 404FFD
// 404F50: variable 'v2' is possibly undefined
// 402FBF: variable 'v1' is possibly undefined
// 402FCE: variable 'v0' is possibly undefined

//----- (004010C3) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __userpurge sub_4010C3@<eax>(__int16 a1@<ax>, unsigned int a2@<edx>, unsigned int a3@<ecx>, int a4, int a5, int a6)
{
  __int16 v6; // ax
  __int16 v7; // ax
  int v8; // eax
  int v9; // eax
  __int16 v10; // ax
  int v11; // eax
  bool v12; // cf
  int v14; // eax
  int v15; // [esp+16Ch] [ebp-22Ch]
  unsigned __int8 v16; // [esp+1B0h] [ebp-1E8h]
  int v17; // [esp+1DCh] [ebp-1BCh]
  unsigned __int16 v18; // [esp+1F0h] [ebp-1A8h]
  int v19; // [esp+218h] [ebp-180h]
  char v20; // [esp+21Ch] [ebp-17Ch]
  unsigned int v21; // [esp+248h] [ebp-150h]
  unsigned int v22; // [esp+280h] [ebp-118h]
  __int16 v23; // [esp+2F0h] [ebp-A8h]

  v6 = a1 & 0x1DC8;
  if ( a3 < v22 )
    goto LABEL_2;
  v7 = 13233 - (a3 < v22);
  if ( (v7 & 0x2281) == 0 )
  {
    v6 = (v7 - 1808) & 0x18C;
LABEL_2:
    v7 = (v6 + 5515) & 0x1C0;
  }
  v10 = (v7 | 0x34DC) - 7628;
  if ( a2 > v21 )
    goto LABEL_3;
  v8 = (v10 - 4866 + 12472) & 0x4B3;
  if ( (int)a3 < v8 )
    goto LABEL_15;
  v11 = v8 - v15;
  v12 = a2 < a3;
  if ( a2 != a3 )
  {
LABEL_8:
    v9 = (((__CFADD__(v12, v19) | __CFADD__(v11, v12 + v19)) + v11 + 15928) ^ 0x4C2) - 3875;
    goto LABEL_13;
  }
  v14 = ((((__CFADD__(v11, 6774) + (_WORD)v11 + 6774 + 9080) & 0x160E) - 9938) ^ 0x8D7) - 17346;
  v9 = v14 | 0x9E8;
  if ( (v9 & v17) == 0 )
  {
    v10 = ((v23 | v16) - 13473) ^ 0x3E62;
LABEL_3:
    v8 = ((v18 ^ v10 & 0x3695) + 9589) & 0x2ACC;
LABEL_15:
    v11 = v8 ^ 0x2FF2;
    v12 = 0;
    goto LABEL_8;
  }
LABEL_13:
  if ( (a2 & v9) == 0 )
    JUMPOUT(0x40405B);
  return (v20 & 0x67 ^ 0x353F) + 9654;
}
// 4015F5: positive sp value 25C has been found
// 40342F: control flows out of bounds to 40405B
// 4010D7: variable 'v22' is possibly undefined
// 4015C4: variable 'v18' is possibly undefined
// 40299B: variable 'v17' is possibly undefined
// 4029AE: variable 'v23' is possibly undefined
// 4029A7: variable 'v16' is possibly undefined
// 402A85: variable 'v19' is possibly undefined
// 402C30: variable 'v21' is possibly undefined
// 4031CE: variable 'v15' is possibly undefined
// 40449E: variable 'v20' is possibly undefined

//----- (00402419) --------------------------------------------------------
void sub_402419()
{
  JUMPOUT(0x403F46);
}
// 404A25: control flows out of bounds to 403F46

//----- (00402684) --------------------------------------------------------
void sub_402684()
{
  JUMPOUT(0x404206);
}
// 40482A: control flows out of bounds to 404206

//----- (00402C40) --------------------------------------------------------
void __usercall start(int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4@<esi>)
{
  int v4; // ecx
  int v5; // eax
  unsigned int v6; // edx
  unsigned int v7; // ecx
  int v8; // edx
  char v9[656]; // [esp+34h] [ebp-290h] BYREF
  int savedregs; // [esp+2C4h] [ebp+0h] BYREF

  v5 = sub_40431D(a1, a1, 438973428, (int)v9, 0);
  sub_4010C3(v5, v6, v7, v7, v5, 0);
  unk_43ACFE = v8;
  dword_439010 = v8;
  dword_43AD1E = a4;
  dword_439044 += (int)&dword_43AD1E;
  unk_43ACA8 = a2;
  dword_439024 = 7833;
  dword_43AD22 = a3;
  dword_43AB65 = v4;
  dword_439034 = (int)&dword_43AD1E + dword_43A950;
  unk_43ACC8 = &savedregs;
  JUMPOUT(0x403FBC);
}
// 401CE1: control flows out of bounds to 403FBC
// 402C62: variable 'v6' is possibly undefined
// 402C62: variable 'v7' is possibly undefined
// 402C6D: variable 'v8' is possibly undefined
// 401CB8: variable 'v4' is possibly undefined
// 439010: using guessed type int dword_439010;
// 439024: using guessed type int dword_439024;
// 439034: using guessed type int dword_439034;
// 439044: using guessed type int dword_439044;
// 43A950: using guessed type int dword_43A950;
// 43AB65: using guessed type int dword_43AB65;
// 43AD22: using guessed type int dword_43AD22;

//----- (004033B9) --------------------------------------------------------
void sub_4033B9()
{
  JUMPOUT(0x4018F2);
}
// 4033C6: control flows out of bounds to 4018F2

//----- (004034E2) --------------------------------------------------------
void sub_4034E2()
{
  __int16 v0; // ax
  unsigned int v1; // edx
  unsigned int v2; // ecx
  int v3; // [esp+5Ch] [ebp-120h]

  v0 = sub_403D2E(31);
  sub_4010C3(v0, v1, v2, v3, v2, 0);
  sub_403D2E(14);
  JUMPOUT(0x401530);
}
// 403517: control flows out of bounds to 401530
// 4034FB: variable 'v1' is possibly undefined
// 4034FB: variable 'v2' is possibly undefined
// 4034FB: variable 'v3' is possibly undefined

//----- (00403CFF) --------------------------------------------------------
void sub_403CFF()
{
  sub_4048EC();
  sub_402419();
  JUMPOUT(0x401688);
}
// 401DE5: control flows out of bounds to 401688

//----- (00403D2E) --------------------------------------------------------
int __stdcall sub_403D2E(int a1)
{
  int result; // eax
  int v2; // [esp+14h] [ebp-14Ch]
  unsigned __int8 v3; // [esp+18h] [ebp-148h]
  int v4; // [esp+38h] [ebp-128h]
  unsigned __int16 v5; // [esp+130h] [ebp-30h]

  if ( v4 != (v3 ^ 0x253F) || (result = 0, !v2) )
    result = v5 ^ 0x3278 | 0x3622;
  return result;
}
// 404AD9: variable 'v2' is possibly undefined
// 404B99: variable 'v4' is possibly undefined
// 403D37: variable 'v3' is possibly undefined
// 4051F1: variable 'v5' is possibly undefined

//----- (00403DE1) --------------------------------------------------------
int __fastcall sub_403DE1(int a1, int a2, int a3, int a4, int a5)
{
  int v6[51]; // [esp+1D4h] [ebp-1A8h] BYREF
  unsigned __int16 v7; // [esp+350h] [ebp-2Ch]

  if ( a1 >= 0 )
    JUMPOUT(0x40162F);
  return sub_40431D((((v7 + 93) | 0x14CB) ^ 0x30CD) + 9165, (((v7 + 93) | 0x14CB) ^ 0x30CD) + 9165, v6[50], (int)v6, 0);
}
// 403E17: control flows out of bounds to 40162F

//----- (0040431D) --------------------------------------------------------
int __userpurge sub_40431D@<eax>(int a1@<eax>, int a2, int a3, int a4, int a5)
{
  return a1 + 11844;
}

//----- (0040447A) --------------------------------------------------------
void sub_40447A()
{
  int v0; // eax
  char v1[8]; // [esp+54h] [ebp-1D0h] BYREF
  int v2; // [esp+1FCh] [ebp-28h]

  sub_402419();
  sub_402419();
  v0 = sub_40431D((int)v1, 1485190739, 0, (int)v1, 0);
  v2 &= v0;
  JUMPOUT(0x404188);
}
// 402A68: control flows out of bounds to 404188

//----- (00404894) --------------------------------------------------------
void sub_404894()
{
  JUMPOUT(0x4015F8);
}
// 4048A2: control flows out of bounds to 4015F8

//----- (004048A7) --------------------------------------------------------
void sub_4048A7()
{
  JUMPOUT(0x403EF2);
}
// 40321F: control flows out of bounds to 403EF2

//----- (004048EC) --------------------------------------------------------
void sub_4048EC()
{
  JUMPOUT(0x404024);
}
// 4048EF: control flows out of bounds to 404024

//----- (00405249) --------------------------------------------------------
void __fastcall sub_405249(__int16 a1)
{
  if ( (a1 & 0x33A8) == 0 )
    JUMPOUT(0x40151E);
  JUMPOUT(0x403BED);
}
// 4024CA: control flows out of bounds to 40151E
// 4024BE: control flows out of bounds to 403BED

//----- (00405597) --------------------------------------------------------
void __cdecl sub_405597(_BYTE *a1, int a2, int a3)
{
  unsigned int v3; // eax

  v3 = 0;
  while ( *a1 )
    v3 = (char)*a1++ ^ ((v3 >> 25) | (v3 << 7));
  JUMPOUT(0x407699);
}
// 4055CD: control flows out of bounds to 407699

//----- (00406047) --------------------------------------------------------
void __usercall sub_406047(int a1@<eax>, int a2@<ebx>, int a3@<esi>)
{
  int v3; // ecx
  _BYTE *v4; // edi
  int v5; // ebx
  int v6; // esi
  int v7; // ecx
  int v8; // ebx
  int v9; // edx
  bool v10; // cf
  char v11; // al
  int v12; // edx
  __int64 v13; // rax
  int v14; // ecx
  int v15; // [esp-4h] [ebp-4h]

  v3 = 0x2000;
  v4 = &unk_42069F;
  v5 = __CFADD__(dword_439654, a2) + dword_439654 + a2 + 19582;
  v6 = a1 + dword_43A9A4 + a3;
  do
  {
    LOBYTE(dword_439034) = dword_439034 - 51;
    v15 = v3;
    v8 = dword_439184 + v5;
    sub_4063BC((void *)v3);
    v10 = __CFADD__(dword_439B94, v9);
    BYTE1(v8) = 88;
    *v4++ = v11;
    v12 = dword_439030 - dword_439BBC;
    v5 = v8 - 14796;
    v6 += v10 + 25915;
    v3 = v15 - 1;
  }
  while ( v15 != 1 );
  LOBYTE(dword_439008) = -36;
  BYTE1(v12) += 101;
  v13 = dword_43ACE8(-29740, v12 - 14438, 255, &unk_42059F);
  dword_439008 = (int)&DisableThreadLibraryCalls;
  BYTE4(v13) += byte_43928C;
  dword_43ACF2(dword_4399C8 + v6 + dword_439A1C + v14 + 1, HIDWORD(v13), &unk_42059F, &unk_43ACF0, 0, &unk_43AB69);
  dword_439008 = 12140;
  dword_43903C -= v7;
  dword_439018 -= 15860;
  dword_43ACF6(v7 + 22729 - dword_43A194, &unk_43AB69, -1073741824, 1, 0, 2, 32, 0);
  JUMPOUT(0x405752);
}
// 40626E: control flows out of bounds to 405752
// 40801F: variable 'v9' is possibly undefined
// 408027: variable 'v11' is possibly undefined
// 408099: variable 'v14' is possibly undefined
// 406FF2: variable 'v7' is possibly undefined
// 439008: using guessed type int dword_439008;
// 439018: using guessed type int dword_439018;
// 439030: using guessed type int dword_439030;
// 439034: using guessed type int dword_439034;
// 43903C: using guessed type int dword_43903C;
// 439184: using guessed type int dword_439184;
// 43928C: using guessed type char byte_43928C;
// 439654: using guessed type int dword_439654;
// 4399C8: using guessed type int dword_4399C8;
// 439A1C: using guessed type int dword_439A1C;
// 439B94: using guessed type int dword_439B94;
// 439BBC: using guessed type int dword_439BBC;
// 43A194: using guessed type int dword_43A194;
// 43A9A4: using guessed type int dword_43A9A4;
// 43ACE8: using guessed type __int64 (__fastcall *dword_43ACE8)(_DWORD, _DWORD, _DWORD, _DWORD);
// 43ACF2: using guessed type int (__fastcall *dword_43ACF2)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 43ACF6: using guessed type int (__thiscall *dword_43ACF6)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (004062C7) --------------------------------------------------------
void __usercall sub_4062C7(unsigned int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4@<esi>, int a5, int a6, int a7)
{
  int v7; // [esp+0h] [ebp-24h]
  int v8; // [esp+4h] [ebp-20h]
  int v9; // [esp+8h] [ebp-1Ch]
  int v10; // [esp+Ch] [ebp-18h]

  sub_406A47(a1, a2, a3, a4, v7, v8, v9, v10);
  if ( !HIWORD(a5) )
    JUMPOUT(0x4055D2);
  JUMPOUT(0x406A7C);
}
// 4068D8: control flows out of bounds to 4055D2
// 407EEB: control flows out of bounds to 406A7C
// 40637C: variable 'v7' is possibly undefined
// 40637C: variable 'v8' is possibly undefined
// 40637C: variable 'v9' is possibly undefined
// 40637C: variable 'v10' is possibly undefined

//----- (004063BC) --------------------------------------------------------
void __thiscall sub_4063BC(void *this)
{
  dword_43902C = (int)this;
  JUMPOUT(0x40792B);
}
// 4063DD: control flows out of bounds to 40792B
// 43902C: using guessed type int dword_43902C;

//----- (004065BC) --------------------------------------------------------
__int64 __usercall sub_4065BC@<edx:eax>(unsigned int a1@<ecx>, void *a2@<edi>, const void *a3@<esi>)
{
  __int64 result; // rax

  HIDWORD(result) = 5924;
  qmemcpy(a2, a3, a1);
  BYTE4(result) = byte_439CFC + 36;
  return result;
}
// 439CFC: using guessed type char byte_439CFC;

//----- (00406899) --------------------------------------------------------
#error "4059F2: call analysis failed (funcsize=11)"

//----- (00406A47) --------------------------------------------------------
void __usercall sub_406A47(unsigned int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4@<esi>, int a5, int a6, int a7, int a8)
{
  char *v8; // esi
  int v9; // ebx
  int v10; // ebx
  bool v11; // cf
  unsigned int v12; // eax
  _DWORD *v13; // edx

  BYTE1(a2) ^= 9u;
  dword_439018 = a2;
  v11 = a1 < dword_439DE4;
  v12 = a1 - dword_439DE4;
  v13 = NtCurrentPeb()->ImageBaseAddress;
  dword_439048 = a4 + 19720;
  LOBYTE(a2) = (__CFADD__(v11, a3) | __CFADD__(v11 + a3, 12090)) + a2 + 15;
  v8 = *(char **)(v13[5] + 40);
  BYTE1(a2) += byte_439FC8;
  dword_43903C += a2;
  dword_439030 += 348;
  v10 = v12 + 15152;
  BYTE1(v10) = BYTE1(v12);
  dword_439014 = v10;
  v9 = dword_43A0C8;
  dword_439034 -= 23985;
  BYTE1(v9) = dword_439038 + BYTE1(dword_43A0C8);
  if ( *v8 >= 97 )
    v9 = 24;
  dword_43902C += v9;
  JUMPOUT(0x407C38);
}
// 40670E: control flows out of bounds to 407C38
// 439014: using guessed type int dword_439014;
// 439018: using guessed type int dword_439018;
// 43902C: using guessed type int dword_43902C;
// 439030: using guessed type int dword_439030;
// 439034: using guessed type int dword_439034;
// 439038: using guessed type int dword_439038;
// 43903C: using guessed type int dword_43903C;
// 439048: using guessed type int dword_439048;
// 439DE4: using guessed type int dword_439DE4;
// 439FC8: using guessed type char byte_439FC8;
// 43A0C8: using guessed type int dword_43A0C8;

//----- (00406B6C) --------------------------------------------------------
void sub_406B6C()
{
  JUMPOUT(0x40559F);
}
// 406B75: control flows out of bounds to 40559F

//----- (00406DF2) --------------------------------------------------------
void __cdecl sub_406DF2(int a1, int a2, int a3)
{
  if ( a2 )
    JUMPOUT(0x406638);
  JUMPOUT(0x40687F);
}
// 40554C: control flows out of bounds to 406638
// 405546: control flows out of bounds to 40687F

//----- (00406E0C) --------------------------------------------------------
void __cdecl sub_406E0C(int a1, int a2)
{
  JUMPOUT(0x407653);
}
// 4080DC: control flows out of bounds to 407653

//----- (00406EDA) --------------------------------------------------------
int __usercall sub_406EDA@<eax>(char a1@<cl>, int a2@<ebx>)
{
  *(_BYTE *)(a2 - 16611309) += a1;
  return ((int (*)(void))loc_40E470)();
}

//----- (00407574) --------------------------------------------------------
void __fastcall sub_407574(int a1, int a2)
{
  dword_43AD26 ^= a2 + 1879;
  JUMPOUT(0x406ACE);
}
// 407D9E: control flows out of bounds to 406ACE
// 43AD26: using guessed type int dword_43AD26;

//----- (0040F25A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40F25A()
{
  __asm { iret }
}
// 40F25B: positive sp value 4 has been found
// 40F25B: control flows out of bounds to 40F25C

// nfuncs=29 queued=29 decompiled=29 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 29 function(s)"
