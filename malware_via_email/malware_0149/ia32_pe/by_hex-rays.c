/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// DWORD __userpurge sub_401000@<eax>(int a1@<edx>, int a2@<esi>, int a3, int a4);
// UINT __userpurge sub_401028@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4, int a5);
// HANDLE __userpurge sub_401050@<eax>(int a1@<ebx>, int a2@<edi>, int a3@<esi>, int a4, int a5, int a6, int a7);
// LPSTR __userpurge sub_401078@<eax>(int a1@<ebx>, int a2, int a3);
// HANDLE __userpurge sub_4010A4@<eax>(int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4@<esi>, int a5, int a6, int a7, int a8);
void start();
// int __userpurge sub_4010F0@<eax>(int a1@<edx>, int a2@<edi>, int a3@<esi>, int a4, int a5, int a6, int a7);
// HWND __userpurge sub_40111C@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6, int a7, int a8);
HANDLE __stdcall sub_401144(int a1, int a2, int a3, int a4);
// LPSTR __userpurge sub_4011A8@<eax>(int a1@<eax>, int a2@<edi>, int a3@<esi>, int a4, int a5, int a6, int a7);
// LANGID __userpurge sub_40120C@<ax>(int a1@<eax>, int a2@<ecx>, int a3@<ebx>, int a4@<esi>, int a5, int a6, int a7);
// LPSTR __userpurge sub_401234@<eax>(int a1@<ecx>, int a2@<esi>, int a3, int a4, int a5, int a6);
// void *__userpurge sub_40125C@<eax>(int a1@<edx>, int a2@<edi>, int a3, int a4);
// HWND __userpurge sub_40128C@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>, int a6, int a7, int a8);
// UINT __userpurge sub_4012B8@<eax>(int a1@<eax>, int a2@<edi>, int a3, int a4);
// HWND __userpurge sub_4012DC@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<edi>, int a5, int a6);
// DWORD __userpurge sub_401308@<eax>(int a1@<edi>, int a2@<esi>, int a3, int a4, int a5);
// int __userpurge sub_401334@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>, int a6, int a7, int a8, int a9);
// HANDLE __userpurge sub_401360@<eax>(int a1@<ecx>, int a2@<ebx>, int a3@<edi>, int a4, int a5);
// void *__userpurge sub_401388@<eax>(int a1@<ebx>, int a2@<esi>, int a3, int a4, int a5, int a6);
// void *__userpurge sub_4013B0@<eax>(int a1@<ebx>, int a2@<esi>, int a3, int a4, int a5);
// HANDLE __userpurge sub_4013DC@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<esi>, int a5, int a6, int a7);
// int __userpurge sub_401408@<eax>(int a1@<ebx>, int a2@<esi>, int a3, int a4, int a5);
// int __userpurge sub_401438@<eax>(int a1@<ebx>, int a2, int a3, int a4, int a5);
// UINT __userpurge sub_40146C@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<edi>, int a5@<esi>, int a6, int a7);
// DWORD __userpurge sub_401490@<eax>(int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4, int a5);
// HWND __userpurge sub_4014EC@<eax>(int a1@<edi>, int a2@<esi>, int a3, int a4, int a5, int a6);
// HWND __userpurge sub_401518@<eax>(int a1@<ecx>, int a2@<ebx>, int a3@<edi>, int a4, int a5, int a6);
// LPSTR __userpurge sub_401544@<eax>(int a1@<eax>, int a2@<ebx>, int a3@<esi>, int a4, int a5);
// void __userpurge sub_401568(int a1@<eax>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5, int a6, int a7, int a8);
// LPSTR __userpurge sub_4015BC@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6, int a7, int a8, int a9);
// void *__userpurge sub_4015E8@<eax>(int a1@<ebx>, int a2@<edi>, int a3, int a4, int a5, int a6);
// UINT __userpurge sub_401618@<eax>(int a1@<eax>, int a2@<edx>, int a3@<edi>, int a4@<esi>, int a5, int a6);
// int __userpurge sub_401644@<eax>(int a1@<ebx>, int a2@<edi>, int a3@<esi>, int a4, int a5, int a6, int a7);
// DWORD __userpurge sub_401678@<eax>(int a1@<eax>, int a2@<edx>, int a3, int a4, int a5);
// HANDLE __userpurge sub_4016A0@<eax>(int a1@<ebx>, int a2, int a3, int a4, int a5);
// HANDLE __userpurge sub_4016C8@<eax>(int a1@<ebx>, int a2@<esi>, int a3, int a4, int a5, int a6);
// DWORD __userpurge sub_4016F0@<eax>(int a1@<ebx>, int a2@<edi>, int a3@<esi>, int a4, int a5, int a6);
// DWORD __stdcall GetCurrentThreadId();
// HANDLE __stdcall GetCurrentProcess();
// BOOL __stdcall IsValidCodePage(UINT CodePage);
// void __stdcall Sleep(DWORD dwMilliseconds);
// DWORD __stdcall GetLogicalDrives();
// HANDLE __stdcall GetCurrentThread();
// UINT __stdcall GetACP();
// LPVOID __stdcall VirtualAlloc(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// LPSTR __stdcall GetCommandLineA();
// UINT __stdcall GetDriveTypeA(LPCSTR lpRootPathName);
// LANGID __stdcall GetSystemDefaultLangID();
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// HWND __stdcall GetFocus();
// HWND __stdcall GetActiveWindow();
// HWND __stdcall GetForegroundWindow();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_4011D8; // weak
_UNKNOWN loc_4014B8; // weak
_UNKNOWN unk_403050; // weak
_UNKNOWN unk_403074; // weak
_UNKNOWN unk_403080; // weak
_UNKNOWN unk_40308C; // weak
_UNKNOWN unk_4030D0; // weak
_UNKNOWN unk_4030E0; // weak
_UNKNOWN unk_403158; // weak
_UNKNOWN unk_403164; // weak
_UNKNOWN unk_40319C; // weak
_UNKNOWN unk_4031C4; // weak
_UNKNOWN unk_40320C; // weak
_UNKNOWN unk_403244; // weak
_UNKNOWN unk_403248; // weak
_UNKNOWN unk_403258; // weak
_UNKNOWN unk_40326C; // weak
_UNKNOWN unk_403290; // weak
_UNKNOWN unk_4032A4; // weak
_UNKNOWN unk_4032C0; // weak
_UNKNOWN unk_403310; // weak


//----- (00401000) --------------------------------------------------------
DWORD __userpurge sub_401000@<eax>(int a1@<edx>, int a2@<esi>, int a3, int a4)
{
  ((void (__stdcall *)(int, int, int))loc_4014B8)(a2, a1, a1);
  GetFocus();
  return GetCurrentThreadId();
}
// 401000: could not find valid save-restore pair for edi

//----- (00401028) --------------------------------------------------------
UINT __userpurge sub_401028@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4, int a5)
{
  sub_401144(a1, a3, a3, a2);
  GetCurrentProcess();
  return GetACP();
}
// 401028: could not find valid save-restore pair for esi

//----- (00401050) --------------------------------------------------------
HANDLE __userpurge sub_401050@<eax>(int a1@<ebx>, int a2@<edi>, int a3@<esi>, int a4, int a5, int a6, int a7)
{
  HANDLE v7; // eax

  v7 = GetCurrentThread();
  sub_4012B8((int)v7, a2, a1, a3);
  return GetCurrentThread();
}

//----- (00401078) --------------------------------------------------------
LPSTR __userpurge sub_401078@<eax>(int a1@<ebx>, int a2, int a3)
{
  int v3; // eax
  int v4; // edx

  v3 = GetDriveTypeA(0);
  sub_401490(v3, a1, a1 + 332, v4, a1);
  return GetCommandLineA();
}
// 401078: could not find valid save-restore pair for edi
// 401092: variable 'v4' is possibly undefined

//----- (004010A4) --------------------------------------------------------
HANDLE __userpurge sub_4010A4@<eax>(int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4@<esi>, int a5, int a6, int a7, int a8)
{
  sub_40128C(a1, a4 + 280, a2, a3, a4, a3, a3, a4);
  IsValidCodePage(0x362u);
  return GetCurrentThread();
}

//----- (004010D4) --------------------------------------------------------
void start()
{
  if ( ((unsigned __int8)GetCommandLineA() & 3) == 0 )
    GetLogicalDrives();
  JUMPOUT(0x401A03);
}
// 4010EF: control flows out of bounds to 401A03

//----- (004010F0) --------------------------------------------------------
int __userpurge sub_4010F0@<eax>(int a1@<edx>, int a2@<edi>, int a3@<esi>, int a4, int a5, int a6, int a7)
{
  int v8; // [esp-4h] [ebp-24h]

  v8 = a1 - 420;
  GetCurrentThreadId();
  sub_4014EC(a2, a3, a3, a2, a2, a2);
  GetCurrentThread();
  return v8;
}

//----- (0040111C) --------------------------------------------------------
HWND __userpurge sub_40111C@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6, int a7, int a8)
{
  sub_401334(a2, a3, a4, a5, (int)&unk_403164, a5, a4, a3, a1);
  GetCurrentThreadId();
  return GetFocus();
}
// 40111C: could not find valid save-restore pair for esi

//----- (00401144) --------------------------------------------------------
HANDLE __stdcall sub_401144(int a1, int a2, int a3, int a4)
{
  char *v4; // eax
  char *v5; // esi
  _DWORD *v6; // eax
  int i; // ecx

  v4 = (char *)VirtualAlloc(0, 0x5D0u, 0x1000u, 0x40u);
  *((_DWORD *)&unk_403050 + 86) = v4;
  v5 = v4 + 183;
  v6 = &unk_403310;
  for ( i = 0; i != 1488; i += 4 )
  {
    *(_DWORD *)(v5 - 183) = *v6++;
    v5 += 4;
    *(_DWORD *)(v5 - 187) ^= 0x81932ACC;
  }
  return GetCurrentThread();
}

//----- (004011A8) --------------------------------------------------------
LPSTR __userpurge sub_4011A8@<eax>(int a1@<eax>, int a2@<edi>, int a3@<esi>, int a4, int a5, int a6, int a7)
{
  sub_4010F0((int)&unk_4032C0, a2, a3, a1, a3, a1, a2);
  IsValidCodePage(0x362u);
  return GetCommandLineA();
}

//----- (0040120C) --------------------------------------------------------
LANGID __userpurge sub_40120C@<ax>(int a1@<eax>, int a2@<ecx>, int a3@<ebx>, int a4@<esi>, int a5, int a6, int a7)
{
  sub_4011A8(a1, (int)&unk_40319C, a4, a2, a1, a3, a2);
  GetCommandLineA();
  return GetSystemDefaultLangID();
}
// 40120C: could not find valid save-restore pair for edi

//----- (00401234) --------------------------------------------------------
LPSTR __userpurge sub_401234@<eax>(int a1@<ecx>, int a2@<esi>, int a3, int a4, int a5, int a6)
{
  sub_4013B0((int)&unk_40320C, a2, a2, a1, a2);
  GetCurrentThread();
  return GetCommandLineA();
}
// 401234: could not find valid save-restore pair for ebx

//----- (0040125C) --------------------------------------------------------
void *__userpurge sub_40125C@<eax>(int a1@<edx>, int a2@<edi>, int a3, int a4)
{
  ((void (__stdcall *)(int, int, int))loc_4011D8)(a2, a1, a1);
  GetActiveWindow();
  Sleep(0xDu);
  return &unk_4032A4;
}

//----- (0040128C) --------------------------------------------------------
HWND __userpurge sub_40128C@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>, int a6, int a7, int a8)
{
  sub_40146C(a1, a2, a2 - 516, a4, a5, a1, a3);
  GetCurrentProcess();
  return GetActiveWindow();
}

//----- (004012B8) --------------------------------------------------------
UINT __userpurge sub_4012B8@<eax>(int a1@<eax>, int a2@<edi>, int a3, int a4)
{
  sub_401078((int)&unk_4030E0, a2, a1);
  GetSystemDefaultLangID();
  return GetACP();
}
// 4012B8: could not find valid save-restore pair for ebx

//----- (004012DC) --------------------------------------------------------
HWND __userpurge sub_4012DC@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<edi>, int a5, int a6)
{
  sub_401568(a1, (int)&unk_403244, a3, a4, a4, a2, a3, a3);
  GetCurrentThread();
  return GetActiveWindow();
}

//----- (00401308) --------------------------------------------------------
DWORD __userpurge sub_401308@<eax>(int a1@<edi>, int a2@<esi>, int a3, int a4, int a5)
{
  int v5; // eax
  int v6; // edx

  v5 = GetCurrentThreadId();
  sub_401618(v5, v6, a1, a2, a2, v5);
  return GetLogicalDrives();
}
// 40131E: variable 'v6' is possibly undefined

//----- (00401334) --------------------------------------------------------
int __userpurge sub_401334@<eax>(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>, int a6, int a7, int a8, int a9)
{
  sub_401518(a2, a3, a4, a3, a4, a1);
  GetSystemDefaultLangID();
  GetSystemDefaultLangID();
  return a5 + 152;
}

//----- (00401360) --------------------------------------------------------
HANDLE __userpurge sub_401360@<eax>(int a1@<ecx>, int a2@<ebx>, int a3@<edi>, int a4, int a5)
{
  int v5; // esi
  HWND v6; // eax

  v5 = a1 + 140;
  v6 = GetActiveWindow();
  sub_4010A4((int)v6, a2, a3, v5, (int)v6, a3, (int)v6, (int)v6);
  return GetCurrentProcess();
}
// 401360: could not find valid save-restore pair for esi

//----- (00401388) --------------------------------------------------------
void *__userpurge sub_401388@<eax>(int a1@<ebx>, int a2@<esi>, int a3, int a4, int a5, int a6)
{
  int v6; // edx

  GetLogicalDrives();
  sub_401000(v6, a2, a1, a2);
  GetACP();
  return &unk_4031C4;
}
// 40139D: variable 'v6' is possibly undefined

//----- (004013B0) --------------------------------------------------------
void *__userpurge sub_4013B0@<eax>(int a1@<ebx>, int a2@<esi>, int a3, int a4, int a5)
{
  GetCurrentThreadId();
  sub_401544((int)&unk_40308C, a1, a2, a2, a1);
  Sleep(0xFu);
  return &unk_40308C;
}

//----- (004013DC) --------------------------------------------------------
HANDLE __userpurge sub_4013DC@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<esi>, int a5, int a6, int a7)
{
  sub_401388(a3, a4, a2, a3, a1, a3);
  GetCurrentProcess();
  return GetCurrentThread();
}

//----- (00401408) --------------------------------------------------------
int __userpurge sub_401408@<eax>(int a1@<ebx>, int a2@<esi>, int a3, int a4, int a5)
{
  int v5; // eax
  int v6; // ecx
  int result; // eax

  v5 = GetDriveTypeA(0);
  sub_40111C(v5, (int)&unk_4030D0, v6, a1, 0, 0, a1, a2);
  LOWORD(result) = GetSystemDefaultLangID();
  return result;
}
// 401424: variable 'v6' is possibly undefined

//----- (00401438) --------------------------------------------------------
int __userpurge sub_401438@<eax>(int a1@<ebx>, int a2, int a3, int a4, int a5)
{
  HMODULE v5; // eax
  int v6; // edx

  v5 = (HMODULE)(a1 - 240);
  do
    v5 = GetModuleHandleA((LPCSTR)v5 - 344);
  while ( v5 );
  sub_401028(a1 - 240, v6, a1, a1, a1);
  GetCurrentThreadId();
  return a1 - 240;
}
// 401459: variable 'v6' is possibly undefined

//----- (0040146C) --------------------------------------------------------
UINT __userpurge sub_40146C@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<edi>, int a5@<esi>, int a6, int a7)
{
  sub_4013DC(a1, a2, a3 + 92, a5, a4, a2, a1);
  GetCurrentThread();
  return GetACP();
}
// 40146C: could not find valid save-restore pair for ebx

//----- (00401490) --------------------------------------------------------
DWORD __userpurge sub_401490@<eax>(int a1@<eax>, int a2@<ebx>, int a3@<edi>, int a4, int a5)
{
  sub_401360((int)&unk_403158, a2, a3, a1, a2);
  GetActiveWindow();
  return GetCurrentThreadId();
}

//----- (004014EC) --------------------------------------------------------
HWND __userpurge sub_4014EC@<eax>(int a1@<edi>, int a2@<esi>, int a3, int a4, int a5, int a6)
{
  int v6; // edx

  GetCommandLineA();
  sub_401234((int)&unk_403258, a2, v6, a1, v6, v6);
  return GetFocus();
}
// 401504: variable 'v6' is possibly undefined

//----- (00401518) --------------------------------------------------------
HWND __userpurge sub_401518@<eax>(int a1@<ecx>, int a2@<ebx>, int a3@<edi>, int a4, int a5, int a6)
{
  sub_4016A0(a2, a1, a1, a3, a2);
  GetActiveWindow();
  return GetFocus();
}

//----- (00401544) --------------------------------------------------------
LPSTR __userpurge sub_401544@<eax>(int a1@<eax>, int a2@<ebx>, int a3@<esi>, int a4, int a5)
{
  int v5; // edi
  HANDLE v6; // eax
  int v7; // edx
  int v8; // ecx

  v5 = a1 + 108;
  v6 = GetCurrentProcess();
  sub_4015E8(a2, v5, (int)v6, v7, v8, a3);
  return GetCommandLineA();
}
// 401544: could not find valid save-restore pair for edi
// 401557: variable 'v7' is possibly undefined
// 401557: variable 'v8' is possibly undefined

//----- (00401568) --------------------------------------------------------
void __userpurge sub_401568(int a1@<eax>, int a2@<ecx>, int a3@<ebx>, int a4@<edi>, int a5, int a6, int a7, int a8)
{
  sub_4016F0(a3, a4, (int)&unk_403080, a2, a4, a1);
  GetLogicalDrives();
  Sleep(0x12u);
}
// 401568: could not find valid save-restore pair for esi

//----- (004015BC) --------------------------------------------------------
LPSTR __userpurge sub_4015BC@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6, int a7, int a8, int a9)
{
  sub_401678(a1, a2, a4, a5, a3);
  GetDriveTypeA(0);
  return GetCommandLineA();
}
// 4015BC: could not find valid save-restore pair for esi

//----- (004015E8) --------------------------------------------------------
void *__userpurge sub_4015E8@<eax>(int a1@<ebx>, int a2@<edi>, int a3, int a4, int a5, int a6)
{
  int v6; // ecx

  GetDriveTypeA(0);
  sub_401308(a2, 0, a1, a1, v6);
  GetForegroundWindow();
  return &unk_40326C;
}
// 401605: variable 'v6' is possibly undefined

//----- (00401618) --------------------------------------------------------
UINT __userpurge sub_401618@<eax>(int a1@<eax>, int a2@<edx>, int a3@<edi>, int a4@<esi>, int a5, int a6)
{
  sub_401438((int)&unk_403248, a4, a2, a1, a3);
  GetSystemDefaultLangID();
  return GetDriveTypeA(0);
}
// 401618: could not find valid save-restore pair for ebx

//----- (00401644) --------------------------------------------------------
int __userpurge sub_401644@<eax>(int a1@<ebx>, int a2@<edi>, int a3@<esi>, int a4, int a5, int a6, int a7)
{
  int result; // eax

  Sleep(0x10u);
  sub_4016C8(a1, a3, a2, a1, a2, a3);
  Sleep(0xAu);
  return result;
}

//----- (00401678) --------------------------------------------------------
DWORD __userpurge sub_401678@<eax>(int a1@<eax>, int a2@<edx>, int a3, int a4, int a5)
{
  sub_40125C(a2, (int)&unk_403074, a1, a2);
  GetForegroundWindow();
  return GetCurrentThreadId();
}

//----- (004016A0) --------------------------------------------------------
HANDLE __userpurge sub_4016A0@<eax>(int a1@<ebx>, int a2, int a3, int a4, int a5)
{
  HWND v5; // eax
  int v6; // edx
  int v7; // ecx

  v5 = GetFocus();
  sub_40120C((int)v5, v7, a1, (int)&unk_403290, (int)v5, v6, v6);
  return GetCurrentProcess();
}
// 4016A0: could not find valid save-restore pair for esi
// 4016B4: variable 'v7' is possibly undefined
// 4016B4: variable 'v6' is possibly undefined

//----- (004016C8) --------------------------------------------------------
HANDLE __userpurge sub_4016C8@<eax>(int a1@<ebx>, int a2@<esi>, int a3, int a4, int a5, int a6)
{
  HWND v6; // eax
  int v7; // ecx

  v6 = GetForegroundWindow();
  sub_401408(a1, a2, a1, (int)v6, v7);
  return GetCurrentProcess();
}
// 4016C8: could not find valid save-restore pair for edi
// 4016DD: variable 'v7' is possibly undefined

//----- (004016F0) --------------------------------------------------------
DWORD __userpurge sub_4016F0@<eax>(int a1@<ebx>, int a2@<edi>, int a3@<esi>, int a4, int a5, int a6)
{
  HANDLE v6; // eax
  int v7; // edx

  v6 = GetCurrentThread();
  sub_4015BC((int)v6, v7, a3 + 580, a1, a2, a2, a1, (int)v6, (int)v6);
  return GetLogicalDrives();
}
// 401708: variable 'v7' is possibly undefined

// nfuncs=53 queued=38 decompiled=38 lumina nreq=0 worse=0 better=0
// ALL OK, 38 function(s) have been successfully decompiled
