// subject_code.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

word32 g_dw41603C = 0x000160A2; // 0041603C
word32 g_dw416044 = 90228; // 00416044
word32 g_dw416048 = 0x00016085; // 00416048
word32 g_dw41604C = 90260; // 0041604C
ptr32 g_ptr416054 = 0x00400000; // 00416054
// 004160C6: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	word32 edx;
	Eq_2 dwArg00;
	word32 ecx_13;
	for (ecx_13 = ~0x0001869F; ecx_13 != 0x00; --ecx_13)
		;
	ptr32 ebx_52 = g_ptr416054;
	word32 * esi_139 = ebx_52 + 77286;
	while (true)
	{
		int32 eax_57 = *esi_139;
		int32 * esi_58 = esi_139 + 1;
		if (eax_57 == 0x00)
			break;
		byte * edi_107 = ebx_52 + *esi_58;
		fn00416290(eax_57, esi_58 + 1, esi_58 + 1);
		fn00416186(4284476, esi_58 + 1, edi_107);
		esi_139 = esi_58 + 1 + eax_57;
	}
	(*((word32) ebx_52 + 52712))();
	return dwArg00;
}

// 00416186: void fn00416186(Register Eq_37 ebp, Register (ptr32 byte) esi, Register (ptr32 byte) edi)
// Called from:
//      Win32CrtStartup
void fn00416186(Eq_37 ebp, byte * esi, byte * edi)
{
	Eq_52 dl_107 = 0x80;
	word24 ebx_24_8_221 = 0x00;
	while (true)
	{
		*edi = *esi;
		byte * esi_108 = esi + 1;
		++edi;
		word32 ebx_224 = SEQ(ebx_24_8_221, 0x02);
		while (true)
		{
			ebx_24_8_221 = SLICE(ebx_224, word24, 8);
			if (fn00416200(dl_107, esi_108, out dl_107, out esi))
				break;
			Eq_70 ecx_141;
			Eq_37 eax_160;
			Eq_37 eax_117;
			Eq_52 dl_53;
			byte * esi_54;
			if (!fn00416200(dl_107, esi, out dl_53, out esi_54))
			{
				if (!fn00416200(dl_53, esi_54, out dl_107, out esi_108))
				{
					ecx_141.u0 = 0x01;
					uint8 al_165 = 0x10;
					ebx_224 = SEQ(ebx_24_8_221, 0x02);
					do
					{
						al_165 = al_165 * 0x02 + (byte) fn00416200(dl_107, esi_108, out dl_107, out esi_108);
						eax_160.u0 = (uint32) al_165;
					} while (al_165 >= 0x00);
					if (al_165 == 0x00)
					{
						*edi = al_165;
						++edi;
						continue;
					}
					goto l004161F6;
				}
				uint32 eax_116 = (uint32) *esi_108;
				++esi_108;
				eax_117 = eax_116 >> 0x01;
				bool C_140 = SLICE(cond(eax_116 >> 0x01), bool, 1);
				if (eax_116 >> 0x01 == 0x00)
					return;
				ecx_141 = (word32) C_140;
				goto l004161EF;
			}
			Eq_52 dl_59;
			byte * esi_61;
			up32 ecx_67 = fn0041620C(0x00, dl_53, esi_54, out dl_59, out esi_61) - ebx_224;
			if (ecx_67 == 0x00)
			{
				ecx_141 = fn0041620A(dl_59, esi_61, out dl_107, out esi_108);
				goto l004161F2;
			}
			byte al_78 = *esi_61;
			ecx_141 = fn0041620A(dl_59, esi_61 + 1, out dl_107, out esi_108);
			eax_117 = SEQ(ecx_67 - 0x01, al_78);
			if (eax_117 < 0x7D00)
			{
				if (ecx_67 >= 0x06)
					goto l004161F0;
				if (eax_117 <= 0x7F)
					goto l004161EF;
			}
			else
			{
l004161EF:
				ecx_141 = (word32) ecx_141 + 1;
l004161F0:
				ecx_141 = (word32) ecx_141 + 1;
			}
			ebp = eax_117;
l004161F2:
			eax_160 = ebp;
			ebx_224 = SEQ(ebx_24_8_221, 0x01);
l004161F6:
			memcpy(edi, edi - eax_160, ecx_141);
			edi += ecx_141;
		}
	}
}

// 00416200: FlagGroup bool fn00416200(Register Eq_52 dl, Register (ptr32 byte) esi, Register out Eq_79 dlOut, Register out (ptr32 byte) esiOut)
// Called from:
//      fn00416186
//      fn0041620C
bool fn00416200(Eq_52 dl, byte * esi, union Eq_79 & dlOut, byte & esiOut)
{
	Eq_79 dl_13 = dl *8 0x02;
	bool C_12 = SLICE(cond(dl *8 0x02), bool, 1);
	if (dl *8 0x02 == 0x00)
	{
		dl_13 = *esi * 0x02 + (byte) (dl *8 0x02 < 0x00);
		++esi;
		C_12 = SLICE(cond(dl_13), bool, 1);
	}
	dlOut = dl_13;
	esiOut = esi;
	return C_12;
}

// 0041620A: Register word32 fn0041620A(Register Eq_52 dl, Register (ptr32 byte) esi, Register out Eq_168 dlOut, Register out (ptr32 byte) esiOut)
// Called from:
//      fn00416186
word32 fn0041620A(Eq_52 dl, byte * esi, union Eq_168 & dlOut, byte & esiOut)
{
	Eq_168 dl_10;
	byte * esi_12;
	word32 ecx_11 = fn0041620C(0x00, dl, esi, out dl_10, out esi_12);
	dlOut = dl_10;
	esiOut = esi_12;
	return ecx_11;
}

// 0041620C: Register ui32 fn0041620C(Register ui32 ecx, Register Eq_52 dl, Register (ptr32 byte) esi, Register out Eq_52 dlOut, Register out (ptr32 byte) esiOut)
// Called from:
//      fn00416186
//      fn0041620A
ui32 fn0041620C(ui32 ecx, Eq_52 dl, byte * esi, union Eq_52 & dlOut, byte & esiOut)
{
	ui32 ecx_15 = ecx + 0x01;
	do
	{
		Eq_52 dl_9;
		byte * esi_10;
		ecx_15 = ecx_15 * 0x02 + (word32) fn00416200(dl, esi, out dl_9, out esi_10);
	} while (fn00416200(dl_9, esi_10, out dl, out esi));
	dlOut = dl;
	esiOut = esi;
	return ecx_15;
}

// 00416290: void fn00416290(Register int32 ecx, Register (ptr32 byte) esi, Register (ptr32 byte) edi)
// Called from:
//      Win32CrtStartup
void fn00416290(int32 ecx, byte * esi, byte * edi)
{
	do
	{
		byte al_6 = *esi;
		byte * esi_7 = esi + 1;
		ui8 al_15 = al_6 ^ 0x6C ^ 0xA8;
		ui8 al_34 = al_15 ^ 0x4B ^ 0xE0 ^ 0x06 ^ 0x11;
		esi = esi_7;
		ui8 al_46 = al_34 ^ 0x23 ^ ~0x28;
		ui8 al_62 = al_46 ^ 0xA0 ^ 0x9A ^ 0x07 ^ ~0x41 ^ 0x2E ^ 0x5D;
		ui8 al_69 = al_62 ^ 0x7D ^ 0x5F;
		ui8 al_77 = al_69 ^ 66 ^ 222;
		*edi = al_77 ^ ~0x50;
		++edi;
		--ecx;
	} while (ecx != 0x00);
}

