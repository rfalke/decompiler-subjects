/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void start();
// void __usercall __spoils<ecx> sub_416186(int a1@<ebp>, _BYTE *a2@<edi>, _BYTE *a3@<esi>);
// __int64 __usercall sub_416200@<edx:eax>(char a1@<dl>, _BYTE *a2@<esi>);
int __fastcall sub_41620A(_DWORD, _DWORD); // weak
// __int64 __usercall sub_41620C@<edx:eax>(__int64 result@<edx:eax>, _BYTE *a2@<esi>);
void sub_416264();
void sub_416272();
// char __usercall sub_416290@<al>(int a1@<ecx>, _BYTE *a2@<edi>, char *a3@<esi>);

//-------------------------------------------------------------------------
// Data declarations

void *off_416054 = (void *)0x400000; // weak


//----- (004160C6) --------------------------------------------------------
void start()
{
  int v0; // ecx
  char *v1; // ebx
  int *i; // esi
  int v3; // eax
  int *v4; // esi
  char *v5; // [esp-2Ch] [ebp-2Ch]
  int v6; // [esp-24h] [ebp-24h]

  v0 = -100000;
  do
    --v0;
  while ( v0 );
  v1 = (char *)off_416054;
  for ( i = (int *)((char *)off_416054 + 77286); ; i = (int *)((char *)v4 + v6 + 4) )
  {
    v3 = *i;
    v4 = i + 1;
    if ( !v3 )
      break;
    v6 = v3;
    v5 = &v1[*v4];
    sub_416290(v3, (_BYTE *)v4 + 4, (char *)v4 + 4);
    sub_416186(4284476, v5, (_BYTE *)v4 + 4);
  }
  ((void (*)(void))(v1 + 52712))();
  JUMPOUT(0x401272);
}
// 416185: control flows out of bounds to 401272
// 416054: using guessed type void *;

//----- (00416186) --------------------------------------------------------
void __usercall __spoils<ecx> sub_416186(int a1@<ebp>, _BYTE *a2@<edi>, _BYTE *a3@<esi>)
{
  __int64 v3; // rax
  int v4; // ebx
  __int64 v5; // rax
  int v6; // ecx
  unsigned int v7; // ecx
  char v8; // tt
  __int64 v9; // rax
  int v10; // ecx
  char v11; // cf

  BYTE4(v3) = 0x80;
  v4 = 0;
LABEL_2:
  *a2++ = *a3++;
  LOBYTE(v4) = 2;
  while ( 1 )
  {
    v3 = sub_416200(SBYTE4(v3), a3);
    if ( !v11 )
      goto LABEL_2;
    v5 = sub_416200(SBYTE4(v3), a3);
    if ( !v11 )
    {
      v9 = sub_41620C(v5, a3);
      if ( v10 == v4 )
      {
        sub_41620A(0, HIDWORD(v9));
LABEL_20:
        LODWORD(v3) = a1;
        LOBYTE(v4) = 1;
        goto LABEL_21;
      }
      ++a3;
      LODWORD(v3) = sub_41620A(v9, HIDWORD(v9));
      if ( (unsigned int)v3 < 0x7D00 )
      {
        if ( BYTE1(v3) >= 5u )
        {
LABEL_18:
          ++v7;
          goto LABEL_19;
        }
        if ( (unsigned int)v3 > 0x7F )
        {
LABEL_19:
          a1 = v3;
          goto LABEL_20;
        }
      }
LABEL_17:
      ++v7;
      goto LABEL_18;
    }
    v3 = sub_416200(SBYTE4(v5), a3);
    if ( !v11 )
      break;
    LOBYTE(v4) = 2;
    do
    {
      v3 = sub_416200(SBYTE4(v3), a3);
      v8 = v11 + v3;
      v11 = __CFADD__(v11, (_BYTE)v3) | __CFADD__((_BYTE)v3, v11 + v3);
      LOBYTE(v3) = v3 + v8;
    }
    while ( !v11 );
    if ( (_BYTE)v3 )
    {
LABEL_21:
      qmemcpy(a2, &a2[-v3], v7);
      a2 += v7;
    }
    else
    {
      *a2++ = 0;
    }
  }
  LOBYTE(v3) = *a3++;
  v11 = v3 & 1;
  LODWORD(v3) = (unsigned int)v3 >> 1;
  if ( (_DWORD)v3 )
  {
    v7 = v6 + v11 + v6;
    goto LABEL_17;
  }
}
// 416186: could not find valid save-restore pair for esi
// 41618E: variable 'v3' is possibly undefined
// 416193: variable 'v11' is possibly undefined
// 4161BF: variable 'v10' is possibly undefined
// 4161CF: variable 'v6' is possibly undefined
// 4161EF: variable 'v7' is possibly undefined
// 41620A: using guessed type int __fastcall sub_41620A(_DWORD, _DWORD);

//----- (00416200) --------------------------------------------------------
__int64 __usercall sub_416200@<edx:eax>(char a1@<dl>, _BYTE *a2@<esi>)
{
  bool v2; // cf
  __int64 result; // rax

  v2 = __CFADD__(a1, a1);
  BYTE4(result) = 2 * a1;
  if ( !BYTE4(result) )
    BYTE4(result) = *a2 + v2 + *a2;
  return result;
}

//----- (0041620C) --------------------------------------------------------
__int64 __usercall sub_41620C@<edx:eax>(__int64 result@<edx:eax>, _BYTE *a2@<esi>)
{
  __int64 v2; // rax
  char v3; // cf

  do
  {
    v2 = sub_416200(SBYTE4(result), a2);
    result = sub_416200(SBYTE4(v2), a2);
  }
  while ( v3 );
  return result;
}
// 416219: variable 'v3' is possibly undefined

//----- (00416264) --------------------------------------------------------
void sub_416264()
{
  ;
}

//----- (00416272) --------------------------------------------------------
void sub_416272()
{
  char v0; // cf

  do
  {
    sub_416264();
    sub_416264();
  }
  while ( v0 );
}
// 416281: variable 'v0' is possibly undefined

//----- (00416290) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
char __usercall sub_416290@<al>(int a1@<ecx>, _BYTE *a2@<edi>, char *a3@<esi>)
{
  char v3; // al
  char result; // al

  do
  {
    v3 = *a3++;
    result = v3 ^ 0x6D;
    *a2++ = result;
    --a1;
  }
  while ( a1 );
  return result;
}
// 41628D: positive sp value C has been found

// nfuncs=8 queued=7 decompiled=7 lumina nreq=0 worse=0 better=0
// ALL OK, 7 function(s) have been successfully decompiled
