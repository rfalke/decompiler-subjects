/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

// int __thiscall SetLastConsoleEventActive(_DWORD); weak
// void __stdcall GetSystemInfo(LPSYSTEM_INFO lpSystemInfo);
int start();
void __cdecl sub_401186(int a1, int a2);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401298; // weak
_UNKNOWN loc_401407; // weak
__int16 word_40190B = 0; // weak
char byte_40296D[3]; // weak
__int16 word_402E9E; // weak
int (*off_404C34)(void) = &sub_401186; // weak
int dword_405E7D; // weak
int dword_40FC33; // weak
int dword_40FD9F; // weak
int dword_40FF84; // weak


//----- (0040113C) --------------------------------------------------------
int start()
{
  int v0; // ecx

  dword_40FD9F = (int)&loc_401407;
  off_404C34();
  ++dword_40FC33;
  return SetLastConsoleEventActive(v0);
}
// 40113C: could not find valid save-restore pair for edi
// 40117C: variable 'v0' is possibly undefined
// 401018: using guessed type int __thiscall SetLastConsoleEventActive(_DWORD);
// 404C34: using guessed type int (*off_404C34)(void);
// 40FC33: using guessed type int dword_40FC33;
// 40FD9F: using guessed type int dword_40FD9F;

//----- (00401186) --------------------------------------------------------
void __cdecl sub_401186(int a1, int a2)
{
  unsigned int v2; // ebx
  int v3; // edx
  int v4; // edx
  int v5; // ecx
  LPSYSTEM_INFO v6; // edx
  int v7; // edx
  __int32 v8; // ecx
  void *retaddr; // [esp+14h] [ebp+0h] BYREF

  v2 = (unsigned int)&word_40190B | ((unsigned int)retaddr + 4198796);
  SetLastConsoleEventActive(a2);
  v4 = dword_405E7D + v3;
  if ( v5 - (_DWORD)"8;DC15K;<6" == v4 )
  {
    v4 -= a1;
    v2 = (unsigned int)&word_40190B | ((unsigned int)retaddr + 4198796);
  }
  ((void (__fastcall *)(int, char *, unsigned int, int, int, unsigned int, int))loc_401298)(
    a2,
    &byte_40296D[v4],
    v2 - (_DWORD)&word_402E9E,
    a2,
    1227948095,
    (unsigned int)&word_40190B | ((unsigned int)retaddr + 4198796),
    a2);
  GetSystemInfo(v6);
  dword_40FF84 = v7;
  _InterlockedExchange((volatile __int32 *)&retaddr, v8);
}
// 4011C3: variable 'v3' is possibly undefined
// 4011D3: variable 'v5' is possibly undefined
// 4011FF: variable 'v6' is possibly undefined
// 401205: variable 'v7' is possibly undefined
// 40120B: variable 'v8' is possibly undefined
// 401018: using guessed type int __thiscall SetLastConsoleEventActive(_DWORD);
// 40190B: using guessed type __int16 word_40190B;
// 402E9E: using guessed type __int16 word_402E9E;
// 405E7D: using guessed type int dword_405E7D;
// 40FF84: using guessed type int dword_40FF84;

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
