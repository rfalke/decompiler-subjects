// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401026: void fn00401026(Register byte al, Register (ptr Eq_3) ecx, Register byte dl, Register byte bl, Register (ptr ui8) esi, Register (ptr Eq_7) edi)
void fn00401026(byte al, Eq_3 * ecx, byte dl, byte bl, ui8 * esi, Eq_7 * edi)
{
	byte bl_5 = bl + *(edi - 77);
	*esi = *esi ^ ~0x06;
	__lock();
	struct Eq_26 * ebx_7 = DPB(ebx, bl_5, 0);
	__arpl(ebx_7->w74F93680, DPB(bx, bl_5, 0), &ebx_7->w74F93680);
	uint32 v18_30 = ebx_7 + ecx->dw0062 / 1962489474;
	ecx->dw0062 = v18_30;
	int32 v19_34 = (byte) (v18_30 < 0x00) + (ebx_7->dw0000 + 543567075);
	ebx_7->dw0000 = v19_34;
	edi->b0000 = al + ~0x60;
	word16 dx_22 = DPB(dx, 0x3B, 8);
	word32 eax_26 = DPB(eax, al + ~0x60, 0);
	if (v19_34 >= 0x00)
		(word32 *) 513561048 = eax_26;
	edi->b0001 = __in(dx_22);
	__hlt();
}

// 004110A8: Register Eq_91 Win32CrtStartup()
Eq_91 Win32CrtStartup()
{
	GetACP();
	GetProcessHeap();
	Eq_97 eax_12 = GetModuleHandleA(&globals->t436605);
	GetFileType(eax_12);
	GetCurrentProcessId();
	GetACP();
	GetCommandLineA();
	ptr32 esp_22 = fp - 0x30;
	Eq_120 eax_27 = GetProcAddress(eax_12, &globals->t4365DA);
	do
	{
		LPDWORD * esp_30 = esp_22 - 0x04;
		*esp_30 = (LPDWORD *) null;
		*(esp_30 - 0x04) = (union Eq_97 *) eax_12;
		GetFileSize(*(esp_30 - 0x04), *esp_30);
		*(esp_30 - 0x08) = 0x00;
		GetCurrentThreadId();
		*(esp_30 - 0x0C) = 0x00;
		*(esp_30 - 0x10) = 0x00;
		*(esp_30 - 0x14) = 0x00;
		*(esp_30 - 0x18) = 0x03;
		*(esp_30 - 0x1C) = 0x00;
		*(esp_30 - 0x20) = 0x02;
		*(esp_30 - 0x24) = 0x80000000;
		*(esp_30 - 0x28) = 4417008;
		esp_22 = esp_30 - 0x28;
		Eq_97 eax_55 = CreateFileA(*(esp_30 - 0x28), *(esp_30 - 0x24), *(esp_30 - 0x20), *(esp_30 - 0x1C), *(esp_30 - 0x18), *(esp_30 - 0x14), *(esp_30 - 0x10));
	} while (eax_55 != ~0x00);
	Eq_256 eax_63 = eax_27();
	*(esp_30 - 44) = 0x00;
	*(esp_30 - 0x30) = (union Eq_97 *) eax_55;
	GetFileSize(*(esp_30 - 0x30), *(esp_30 - 44));
	<anonymous> * eax_82 = (eax_63 ^ 0xC0000005) + 0x00411174;
	ptr32 esp_84;
	word32 ebp_85;
	byte SCZO_86;
	word32 eax_87;
	byte Z_88;
	byte SZO_89;
	byte C_90;
	byte al_91;
	word32 ecx_92;
	byte dl_93;
	byte bl_94;
	word32 esi_95;
	word32 edi_96;
	eax_82();
	GetOEMCP();
	*(esp_84 - 0x04) = fp - 0x14;
	*(esp_84 - 0x08) = (union Eq_97 *) eax_55;
	CloseHandle(*(esp_84 - 0x08));
	*(esp_84 - 0x0C) = 0x40;
	GetCurrentProcessId();
	*(esp_84 - 0x10) = 64898;
	*(esp_84 - 0x14) = (union Eq_97 *) eax_55;
	CloseHandle(*(esp_84 - 0x14));
	*(esp_84 - 0x18) = 0x00401000;
	*(esp_84 - 0x1C) = (union Eq_97 *) eax_12;
	*(esp_84 - 0x20) = 0x00;
	SizeofResource(*(esp_84 - 0x20), *(esp_84 - 0x1C));
	VirtualProtect(*(esp_84 - 0x20), *(esp_84 - 0x1C), *(esp_84 - 0x18), *(esp_84 - 0x14));
	GetCurrentThreadId();
	GetProcessHeap();
	*(esp_84 - 0x24) = (union Eq_256 *) eax_63;
	*(esp_84 - 0x28) = (union Eq_97 *) eax_12;
	GetFileType(*(esp_84 - 0x28));
	GetProcessHeap();
	*(esp_84 - 44) = 64898;
	GetCommandLineA();
	*(esp_84 - 0x30) = 0x00401000;
	GetACP();
	word32 esp_144;
	word32 ebp_145;
	byte SCZO_146;
	word32 eax_147;
	byte Z_148;
	byte SZO_149;
	byte C_150;
	byte al_151;
	struct Eq_3 * ecx_152;
	byte dl_153;
	byte bl_154;
	ui8 * esi_155;
	struct Eq_7 * edi_156;
	(eax_63 - ~0x4041104C)();
	Eq_91 eax_157 = GetCommandLineW();
	fn00401026((byte) eax_157, ecx_152, dl_153, bl_154, esi_155, edi_156);
	return eax_157;
}

