/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int a1, int a2, int a3);
// int __usercall sub_4010EA@<eax>(int result@<eax>);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// LPSTR __stdcall GetCommandLineA();
// void __usercall sub_40509E(int a1@<eax>, int a2@<ecx>, unsigned int a3@<ebx>, int _EDI@<edi>);

//-------------------------------------------------------------------------
// Data declarations

int dword_401000 = 625935; // weak
_UNKNOWN loc_405162; // weak


//----- (00401086) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // eax

  LoadLibraryA(0);
  GetProcAddress(0, 0);
  GetCommandLineA();
  GetCommandLineA();
  GetCommandLineA();
  GetCommandLineA();
  GetCommandLineA();
  sub_4010EA(86016);
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 10;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (004010EA) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4010EA@<eax>(int result@<eax>)
{
  int v1; // [esp-8h] [ebp-8h] BYREF

  __writefsdword(0, (unsigned int)&v1);
  dword_401000 = 625935 - result;
  return result;
}
// 4010FB: positive sp value 4 has been found
// 4010F2: write access to const memory at 401000 has been detected
// 401000: using guessed type int dword_401000;

//----- (0040509E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40509E(int a1@<eax>, int a2@<ecx>, unsigned int a3@<ebx>, int _EDI@<edi>)
{
  int v6; // edx
  bool v7; // cf
  int v9; // [esp-4h] [ebp-4h]
  int savedregs; // [esp+0h] [ebp+0h] BYREF
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  __asm
  {
    repne pop ebp
    fcomp   st(5)
    fcomp   st(6)
    fsubr   st, st
    fsubr   st(2), st
    rep not edi
  }
  v6 = savedregs;
  savedregs = v9;
  __asm
  {
    fcomp   st(6)
    fcom    st(4)
    fcom    st(7)
  }
  ((void (__cdecl *)(int, int, int, int, unsigned int, void **, int *, int))loc_405162)(
    v6,
    2024815558,
    v6,
    a2,
    a3,
    &retaddr,
    &savedregs,
    a1);
  LOWORD(a3) = 2 * a3;
  v7 = __CFADD__((_WORD)a3, (_WORD)a3);
  LOWORD(a3) = 2 * a3;
  _EBX = (__PAIR64__(a3 - (v7 + 852334416), a3) - (((unsigned int)v7 + 852334416) | 0x3267FF1C00000000i64)) >> 32;
  __asm
  {
    rcr     ebx, 0E8h
    rcr     ebx, 0B4h
  }
  JUMPOUT(0x405162);
}
// 4050DB: positive sp value 8 has been found
// 4050A5: inconsistent fpu stack
// 405161: control flows out of bounds to 405162
// 4050DB: variable 'v9' is possibly undefined

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
