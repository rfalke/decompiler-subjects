/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __stdcall start(int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int);
// int __userpurge sub_4040D9@<eax>(char@<bl>, int, int, int, int, int, int, int);

//-------------------------------------------------------------------------
// Data declarations

// extern UINT (__stdcall *GetPrivateProfileIntA)(LPCSTR lpAppName, LPCSTR lpKeyName, INT nDefault, LPCSTR lpFileName);
// extern LPVOID (__stdcall *VirtualAlloc)(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// extern BOOL (__stdcall *IsWindow)(HWND hWnd);


//----- (0040409D) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __stdcall start(
        int a1,
        int a2,
        int a3,
        int a4,
        int a5,
        int a6,
        int a7,
        int a8,
        int a9,
        int a10,
        int a11,
        int a12,
        int a13,
        int a14,
        int a15,
        int a16)
{
  int result; // eax
  char PrivateProfileIntA; // bl
  int v18[2]; // [esp-10h] [ebp-18h] BYREF
  HWND v19; // [esp-8h] [ebp-10h]
  int v20; // [esp-4h] [ebp-Ch]
  int v21; // [esp+0h] [ebp-8h]
  int v22; // [esp+4h] [ebp-4h]

  result = IsWindow(v19);
  v18[0] = result;
  if ( !result )
  {
    v18[0] = 0;
    PrivateProfileIntA = GetPrivateProfileIntA((LPCSTR)v18, (LPCSTR)v18, 243, (LPCSTR)v18);
    return sub_4040D9(PrivateProfileIntA, 0, v18[0], v18[1], (int)v19, v20, v21, v22);
  }
  return result;
}
// 4040D6: positive sp value 14 has been found
// 40409D: could not find valid save-restore pair for ebp

//----- (004040D9) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __userpurge sub_4040D9@<eax>(char a1@<bl>, int a2, int a3, int a4, int a5, int a6, int a7, int a8)
{
  int (__fastcall *v8)(_DWORD, int); // eax
  int v9; // ecx
  _BYTE *v10; // edi
  _DWORD *v11; // esi
  int v12; // edx
  int v13; // ebp
  int v15; // [esp-Ch] [ebp-10h] BYREF
  unsigned int v16; // [esp-8h] [ebp-Ch]
  int (__fastcall *v17)(_DWORD, int); // [esp-4h] [ebp-8h]
  int v18; // [esp+0h] [ebp-4h]

  v8 = (int (__fastcall *)(_DWORD, int))VirtualAlloc(0, 0x1491Cu, 0x3000u, 0x40u);
  v9 = 483;
  v17 = v8;
  v10 = v8;
  v11 = (_DWORD *)(v18 + 168);
  v12 = 1162664988;
  LOBYTE(v12) = a1 + 28;
  v13 = 0;
  do
  {
    v16 = v12;
    v15 = v9;
    *v10 += *v11 + *(&v15 + 1);
    v11 = (_DWORD *)((char *)v11 + 1);
    ++v10;
    ++v13;
    v12 = v16 >> 8;
    if ( v13 == 4 )
    {
      v12 = 1162664988;
      v13 = 0;
    }
    LOBYTE(v12) = a1 + v12;
    v9 = v15 - 286273 + 286272;
  }
  while ( v15 != 1 );
  return v17(0, v12);
}
// 4040EE: positive sp value 4 has been found

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
