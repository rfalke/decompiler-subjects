/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall start@<eax>(int@<esi>);
int sub_41D6F5();
// char __usercall sub_41D787@<al>(_BYTE *@<ebx>, int@<edi>);

//-------------------------------------------------------------------------
// Data declarations

__int16 word_401006; // weak
_UNKNOWN loc_41D606; // weak
_UNKNOWN unk_41D659; // weak
void *off_41DA0F = &unk_41D000; // weak


//----- (0041D600) --------------------------------------------------------
int __usercall start@<eax>(int a1@<esi>)
{
  _WORD *v1; // ebp
  int v2; // esi
  char *v3; // esi
  __int16 v5; // [esp-Ah] [ebp-Eh] BYREF
  int v6; // [esp-8h] [ebp-Ch]
  int (*v7)(void); // [esp-4h] [ebp-8h]

  v7 = (int (*)(void))&loc_41D606;
  v7 = *(int (**)(void))((char *)&off_41DA0F + 4314630 - (_DWORD)&word_401006 - 116224);
  __sidt(&v5);
  v1 = (_WORD *)(v6 + 32);
  _disable();
  LOWORD(a1) = v1[3];
  v2 = a1 << 16;
  LOWORD(v2) = *v1;
  v6 = v2;
  v3 = (char *)&unk_41D659 + 4314630 - (_DWORD)&word_401006 - 116224;
  *v1 = (_WORD)v3;
  v1[3] = HIWORD(v3);
  __asm { into }
  HIWORD(v3) = HIWORD(v6);
  *v1 = v6;
  v1[3] = HIWORD(v3);
  _enable();
  return v7();
}
// 401006: using guessed type __int16 word_401006;
// 41DA0F: using guessed type void *off_41DA0F;

//----- (0041D6F5) --------------------------------------------------------
// attributes: thunk
int sub_41D6F5()
{
  return MEMORY[0xC0038B1C]();
}
// C0038B1C: using guessed type int (*)();

//----- (0041D787) --------------------------------------------------------
char __usercall sub_41D787@<al>(_BYTE *a1@<ebx>, int a2@<edi>)
{
  _BYTE *v2; // edi
  char result; // al
  int v4; // ecx
  bool v5; // zf
  int v6; // ecx
  char v7; // cf
  unsigned int v8; // [esp-10h] [ebp-10h]

  v2 = a1;
  result = 0;
  v4 = 256;
  do
  {
    if ( !v4 )
      break;
    v5 = *v2++ == 0;
    --v4;
  }
  while ( !v5 );
  v6 = 256 - v4 - 1;
  if ( *(_WORD *)&a1[v6 - 4] == 17710 && *(_WORD *)&a1[v6 - 2] == 17752 )
  {
    result = sub_41D6F5();
    if ( !v7 )
    {
      result = sub_41D6F5();
      if ( !v7 )
      {
        sub_41D6F5();
        sub_41D6F5();
        if ( *(_WORD *)(a2 + 1312) == 17744 && *(_WORD *)(a2 + 1388) != 8224 )
        {
          *(_DWORD *)(a2 + 1308) = *(_DWORD *)(a2 + 1304)
                                 + *(unsigned __int16 *)(a2 + 1332)
                                 + 24
                                 + 40 * (*(unsigned __int16 *)(a2 + 1318) - 1);
          sub_41D6F5();
          *(_BYTE *)(a2 + 1043) = 0;
          *(_WORD *)(a2 + 1044) = 0;
          *(_DWORD *)(a2 + 1039) = *(_DWORD *)(a2 + 1364) + *(_DWORD *)(a2 + 1352);
          sub_41D6F5();
          if ( !v7 )
          {
            *(_WORD *)(a2 + 1388) = 8224;
            *(_DWORD *)(a2 + 1352) = *(_DWORD *)(a2 + 1416) + *(_DWORD *)(a2 + 1412);
            v8 = *(_DWORD *)(a2 + 1416) + 1445;
            *(_DWORD *)(a2 + 1416) = *(_DWORD *)(a2 + 1372) * (v8 / *(_DWORD *)(a2 + 1372) + 1);
            *(_DWORD *)(a2 + 1408) = *(_DWORD *)(a2 + 1368) * (v8 / *(_DWORD *)(a2 + 1368) + 1);
            *(_DWORD *)(a2 + 1392) = *(_DWORD *)(a2 + 1408) + *(_DWORD *)(a2 + 1412);
            *(_DWORD *)(a2 + 1436) = -1073741760;
            sub_41D6F5();
            sub_41D6F5();
          }
        }
        return sub_41D6F5();
      }
    }
  }
  return result;
}
// 41D787: could not find valid save-restore pair for edi
// 41D7C6: variable 'v7' is possibly undefined

// nfuncs=3 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
