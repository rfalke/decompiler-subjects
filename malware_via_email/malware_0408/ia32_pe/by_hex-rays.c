/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int a1, int a2, int a3);
// int __usercall sub_4010B9@<eax>(int result@<eax>);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// LPSTR __stdcall GetCommandLineA();
void sub_4050E7();
void sub_4051A1();

//-------------------------------------------------------------------------
// Data declarations

int dword_401000 = -482617565; // weak


//----- (0040107B) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // eax

  LoadLibraryA(0);
  GetCommandLineA();
  sub_4010B9(86016);
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 10;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (004010B9) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
int __usercall sub_4010B9@<eax>(int result@<eax>)
{
  int v1; // [esp-8h] [ebp-8h] BYREF

  __writefsdword(0, (unsigned int)&v1);
  dword_401000 = -482617565 - result;
  return result;
}
// 4010CA: positive sp value 4 has been found
// 4010C1: write access to const memory at 401000 has been detected
// 401000: using guessed type int dword_401000;

//----- (004050E7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4050E7()
{
  _DWORD *v0; // ebx
  char v2; // sf
  int v3; // esi
  char v4; // al
  int v8; // [esp-4h] [ebp-4h]

  v0 = (_DWORD *)(v8 + 549);
  __asm { fsub    st(5), st }
  _EDX = 390878087;
  __asm
  {
    rcl     edx, 9Dh
    rcl     edx, 69h
    fsub    st(3), st
    fsub    st(5), st
    fadd    st, st
  }
  v3 = 20;
  if ( v2 )
  {
    v4 = __ROL4__(__ROL4__(2049936927, 119), 67);
    __asm
    {
      fsubr   st(2), st
      fsubr   st(3), st
    }
    do
    {
      __asm { fsubr   st(6), st }
      _ESI = ~v3;
      __asm
      {
        fcom    st
        fcom    st(2)
        fcom    st(3)
        fcom    st(5)
        repne not esi
      }
      *v0 = __ROR4__(*v0, 5);
      ++v0;
      __asm
      {
        fmul    st, st
        fmul    st(2), st
        fmul    st(3), st
        fmul    st(5), st
      }
      v4 -= 2;
      _EDX = -1774473447;
      __asm
      {
        rcl     edx, 35h
        rcl     edx, 1
      }
      v3 = -1486572384;
    }
    while ( (int)v0 < v8 + 1515 );
    __asm
    {
      fcomp   st(6)
      fcom    st(7)
      int     0Eh;  - IRQ6 - DISKETTE INTERRUPT
    }
    JUMPOUT(0x4052F8);
  }
  sub_4051A1();
  sub_4051A1();
}
// 40510C: positive sp value 4 has been found
// 40513D: inconsistent fpu stack
// 4052F6: control flows out of bounds to 4052F8
// 405137: variable 'v8' is possibly undefined
// 405196: variable 'v2' is possibly undefined

//----- (004051A1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4051A1()
{
  __asm
  {
    repne pop ebp
    rep not edi
  }
  JUMPOUT(0x4051BD);
}
// 4051A8: positive sp value 4 has been found
// 4051B7: control flows out of bounds to 4051BD

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
