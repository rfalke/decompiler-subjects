/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// BOOL __usercall start@<eax>(int a1@<ebx>, int a2@<edi>, int a3@<esi>);
int sub_4032E1();
// HANDLE __stdcall GetProcessHeap();
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// LPVOID __stdcall VirtualAlloc(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// BOOL __stdcall CloseHandle(HANDLE hObject);
// BOOL __stdcall SetEvent(HANDLE hEvent);
// HWND __stdcall GetDlgItem(HWND hDlg, int nIDDlgItem);
// HDC __stdcall GetDC(HWND hWnd);
// int __stdcall LoadStringW(HINSTANCE hInstance, UINT uID, LPWSTR lpBuffer, int cchBufferMax);
// BOOL __stdcall MoveWindow(HWND hWnd, int X, int Y, int nWidth, int nHeight, BOOL bRepaint);
// BOOL __stdcall EnableWindow(HWND hWnd, BOOL bEnable);
// HWND __stdcall CreateWindowExW(DWORD dwExStyle, LPCWSTR lpClassName, LPCWSTR lpWindowName, DWORD dwStyle, int X, int Y, int nWidth, int nHeight, HWND hWndParent, HMENU hMenu, HINSTANCE hInstance, LPVOID lpParam);
// HICON __stdcall LoadIconW(HINSTANCE hInstance, LPCWSTR lpIconName);


//----- (004010C4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
BOOL __usercall start@<eax>(int a1@<ebx>, int a2@<edi>, int a3@<esi>)
{
  int v3; // edi
  int v4; // ecx
  HWND v5; // ecx
  int v6; // esi
  char *v7; // esi
  BOOL result; // eax
  unsigned int v9; // edx
  HWND v10; // ebx
  unsigned int v11; // esi
  int v12; // ebx
  int v13; // esi
  int v14; // ecx
  char v15; // bh
  int v16; // eax
  char v17; // cf
  const CHAR *v18; // [esp-104h] [ebp-104h]

  v3 = a2 - 51396;
  GetProcessHeap();
  EnableWindow((HWND)0xE16E4CEF, v3);
  v5 = (HWND)(v4 - v3);
  LOBYTE(v5) = (unsigned __int8)v5 | 0xC6;
  v6 = a3 + 1;
  v15 = (unsigned __int8)CreateWindowExW(
                           0xC4C9C4D2,
                           0,
                           0,
                           v3 | a1,
                           -875442987,
                           v6,
                           12831426,
                           194,
                           v5,
                           (HMENU)0xD6D0,
                           (HINSTANCE)0xF90DAD4F,
                           (LPVOID)(v3 & 0xC2)) | ((unsigned __int16)(v3 | a1) >> 8);
  v16 = CloseHandle((HANDLE)0xCD8CF77B);
  LOBYTE(v16) = v15 ^ (v16 - (v17 + BYTE1(v16)));
  LoadStringW((HINSTANCE)0xCAC2, v16 ^ 0xCA, 0, -859776057);
  v7 = (char *)LoadIconW(0, (LPCWSTR)0x7BF) + v6;
  CloseHandle((HANDLE)0xDCB3A920);
  SetEvent((HANDLE)0xB75E52F2);
  GetDC((HWND)0xC8E9A5F5);
  v10 = GetDlgItem((HWND)0xCD8427DB, -808264495);
  GetDlgItem((HWND)0xD3AB3524, (int)v10);
  GetModuleHandleA(0);
  result = MoveWindow((HWND)0xBD39E66B, 14600149, 198, 14467799, 13747406, -909781798);
  if ( !result )
  {
    v11 = (unsigned int)(v7 + 57034);
    v12 = 198 - ((v9 < (v11 | 0xC600000000ui64)) + 54743);
    v13 = v11 - ((((unsigned __int16)v9 ^ 0xC6D4) - (_WORD)v11 + 10300) & 0xDEC7);
    GetDC((HWND)0xAC5D98DB);
    v18 = 0;
    do
    {
      v12 |= 0xDCu;
      v13 = -(v14 + v13) - 209;
    }
    while ( LoadLibraryA(v18) );
    sub_4032E1();
    JUMPOUT(0x40166D);
  }
  return result;
}
// 401661: positive sp value 100 has been found
// 40166B: control flows out of bounds to 40166D
// 4010EF: variable 'v4' is possibly undefined
// 401512: variable 'v17' is possibly undefined
// 401484: variable 'v9' is possibly undefined
// 401047: variable 'v14' is possibly undefined
// 401074: variable 'v18' is possibly undefined

//----- (004032E1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int sub_4032E1()
{
  int v0; // edi
  __int16 v1; // bx
  _BYTE *v2; // esi
  _BYTE *v3; // eax
  _BYTE *v5; // [esp+8h] [ebp-4h]

  v3 = VirtualAlloc(0, 0x9332u, 0x3000u, 0x40u);
  v2 = v5;
  v0 = 5136;
  do
  {
    HIBYTE(v1) = -12;
    LOBYTE(v1) = -__ROR1__(__ROL1__(-(char)((*v2 ^ 0xA9) + 85) - 20, 25), 5);
    *v3 = v1;
    ++v2;
    ++v3;
    --v0;
  }
  while ( v0 );
  return 2
       * (((unsigned __int16)((__PAIR64__((unsigned int)v3, 1923912270) - 0x72AC924E72AC924Ei64) >> 32) - v1 + 1) & 0xDEDB ^ 0xD4DC);
}
// 403355: positive sp value 4 has been found
// 403563: variable 'v5' is possibly undefined

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
