/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall sub_401063@<eax>(int@<ecx>, int@<ebx>, int _EBP@<ebp>, int@<edi>);
int __fastcall sub_40107C(int, int);
// void __usercall sub_40115A(int@<edi>, __int32@<esi>);
void sub_401235();
void sub_401245();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401006; // weak
_UNKNOWN loc_40102C; // weak
_UNKNOWN loc_4012F7; // weak


//----- (00401063) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_401063@<eax>(int a1@<ecx>, int a2@<ebx>, int _EBP@<ebp>, int a4@<edi>)
{
  int v4; // edx
  char v6; // sf
  void *v8; // [esp+Ch] [ebp-4h]
  void *retaddr; // [esp+10h] [ebp+0h]

  *(&retaddr - 5) = v8;
  ((void (__fastcall *)(int, int))((char *)&loc_4012F7 + 1))(a1 - a4 - 1, a2);
  __asm { rcr     dword ptr [ebp+6Bh], cl }
  if ( v6 )
    JUMPOUT(0x4010CC);
  return sub_40107C(_ECX, v4);
}
// 401067: positive sp value 4 has been found
// 40107A: control flows out of bounds to 4010CC
// 40107A: variable 'v6' is possibly undefined
// 40107B: variable '_ECX' is possibly undefined
// 40107B: variable 'v4' is possibly undefined

//----- (0040107C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __fastcall sub_40107C(int a1, int a2)
{
  void *retaddr[2]; // [esp+0h] [ebp+0h]

  ((void (__fastcall *)(int, int))loc_40102C)(a1, (a1 | a2) - 2);
  return MK_FP(retaddr[0], retaddr[0])();
}
// 401080: positive sp value 4 has been found

//----- (0040109A) --------------------------------------------------------
#error "40109A: function frame is wrong (funcsize=0)"

//----- (0040115A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40115A(int a1@<edi>, __int32 a2@<esi>)
{
  int v2; // eax
  char v3; // zf
  char v4; // sf
  char v5; // of
  int v7; // edi
  char v8; // pf
  __int32 v9; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v9, a2);
  __asm { repne pop esi }
  v7 = a1 + 1;
  sub_401245();
  if ( !v8 )
  {
    v9 = _ESI + 1;
    __readeflags();
    *(_BYTE *)(v7 + 1) = *(_BYTE *)(_ESI + 1);
    JUMPOUT(0x401177);
  }
  v2 = ((int (*)(void))loc_401006)();
  if ( v4 ^ v5 | v3 )
  {
    *(_DWORD *)v7 = v2;
    JUMPOUT(0x401337);
  }
  JUMPOUT(0x401190);
}
// 40110A: positive sp value 4 has been found
// 401176: control flows out of bounds to 401177
// 40118E: control flows out of bounds to 401190
// 401125: control flows out of bounds to 401337
// 401171: variable 'v8' is possibly undefined
// 401112: variable 'v4' is possibly undefined
// 401112: variable 'v5' is possibly undefined
// 401112: variable 'v3' is possibly undefined

//----- (00401218) --------------------------------------------------------
#error "401218: stack frame is too big (funcsize=0)"

//----- (00401235) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401235()
{
  void *v0; // [esp+4h] [ebp-4h]
  void *retaddr[2]; // [esp+8h] [ebp+0h]

  retaddr[-3] = v0;
  JUMPOUT(0x4011E8);
}
// 401239: positive sp value 4 has been found
// 40123F: control flows out of bounds to 4011E8

//----- (00401245) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_401245()
{
  JUMPOUT(0x4011B4);
}
// 401249: positive sp value 4 has been found
// 40126C: control flows out of bounds to 401271
// 40125C: control flows out of bounds to 4011B4
// 401264: conditional instruction was optimized away because edi.4!=0

// nfuncs=7 queued=7 decompiled=7 lumina nreq=0 worse=0 better=0
#error "There were 2 decompilation failure(s) on 7 function(s)"
