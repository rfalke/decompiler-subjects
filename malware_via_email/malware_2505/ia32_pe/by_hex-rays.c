/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void start();

//-------------------------------------------------------------------------
// Data declarations

int (**off_40A09C)[7168] = &off_40A080; // weak


//----- (00400154) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void start()
{
  int v0; // edx
  unsigned int v1; // ecx
  int v2; // ebx
  int v3; // ebp
  _BYTE *v4; // edi
  _BYTE *v5; // esi
  unsigned int v6; // eax
  int v7; // ecx
  int v8; // eax
  char v9; // tt
  int v10; // eax
  char v11; // dh
  int v12; // ecx
  char v13; // cf
  unsigned int v14; // eax
  _DWORD *v15; // esi
  _DWORD *v16; // eax
  int *v17; // esi
  _DWORD *v18; // edi
  int v19; // eax
  int v20; // ebp
  _DWORD v21[5]; // [esp-20h] [ebp-20h] BYREF
  _BYTE *v22; // [esp-Ch] [ebp-Ch]
  _BYTE *v23; // [esp-8h] [ebp-8h]
  _BYTE *v24; // [esp-4h] [ebp-4h]

  _InterlockedExchange((volatile __int32 *)&off_40A09C, (__int32)v21);
  v0 = v21[1];
  v1 = v21[2];
  v2 = v21[3];
  v3 = (int)v22;
  v4 = v23;
  v5 = v24;
  v24 = v22;
LABEL_2:
  *v4++ = *v5++;
  BYTE1(v0) = 0x80;
  while ( 1 )
  {
    (*(void (__fastcall **)(unsigned int, int, _BYTE *))v2)(v1, v0, v24);
    if ( !v13 )
      goto LABEL_2;
    (*(void (__thiscall **)(_DWORD))v2)(0);
    if ( !v13 )
      break;
    v6 = (*(int (**)(void))v2)();
    if ( !v13 )
    {
      LOBYTE(v6) = *v5++;
      v13 = v6 & 1;
      v14 = v6 >> 1;
      if ( !v14 )
      {
        v15 = v24;
        while ( 1 )
        {
          v16 = (_DWORD *)*v15;
          v17 = v15 + 1;
          v18 = v16;
          v19 = *v17;
          v15 = v17 + 1;
          v20 = (*(int (__cdecl **)(int))(v2 + 16))(v19);
          while ( *v18 + 1 >= 0 )
          {
            if ( *v18 == -1 )
              __asm { jmp     dword ptr [ebx+0Ch] }
            *v18 = (*(int (__cdecl **)(int, int))(v2 + 20))(v20, *v18 + 1);
            ++v18;
          }
        }
      }
      v1 = v7 + v13 + v7;
LABEL_17:
      ++v1;
LABEL_18:
      ++v1;
      goto LABEL_19;
    }
    v1 = v7 + 1;
    do
    {
      v8 = (*(int (__thiscall **)(unsigned int))v2)(v1);
      v9 = v13 + v8;
      v13 = __CFADD__(v13, (_BYTE)v8) | __CFADD__((_BYTE)v8, v13 + v8);
      LOBYTE(v8) = v8 + v9;
    }
    while ( !v13 );
    if ( (_BYTE)v8 )
    {
LABEL_21:
      v23 = v5;
      qmemcpy(v4, &v4[-v8], v1);
      v4 += v1;
      v1 = 0;
      v5 = v23;
    }
    else
    {
      *v4++ = 0;
    }
  }
  v10 = (*(int (**)(void))(v2 + 8))();
  if ( v12 == __CFADD__(v11, v11) + 1 )
  {
    (*(void (**)(void))(v2 + 4))();
  }
  else
  {
    ++v5;
    v14 = (*(int (__thiscall **)(int))(v2 + 4))(v10);
    if ( v14 >= *(_DWORD *)(v2 - 8) )
      goto LABEL_17;
    if ( BYTE1(v14) >= 5u )
      goto LABEL_18;
    if ( v14 <= 0x7F )
      goto LABEL_17;
LABEL_19:
    v3 = v14;
  }
  v8 = v3;
  BYTE1(v0) = 0;
  goto LABEL_21;
}
// 40015B: positive sp value 20 has been found
// 400160: variable 'v1' is possibly undefined
// 400160: variable 'v0' is possibly undefined
// 400162: variable 'v13' is possibly undefined
// 400172: variable 'v7' is possibly undefined
// 400185: variable 'v12' is possibly undefined
// 400183: variable 'v11' is possibly undefined
// 40A09C: using guessed type int (**off_40A09C)[7168];

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
