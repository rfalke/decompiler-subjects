/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int a1, int a2, int a3);
// int __usercall sub_401097@<eax>(int result@<eax>);
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// void __usercall sub_4041A2(int a1@<edx>, int a2@<ebx>, _DWORD *a3@<edi>, double a4@<st5>, double a5@<st4>, double a6@<st3>, double a7@<st2>, double a8@<st1>, double a9@<st0>);
void __noreturn sub_404245(); // weak


//----- (00401042) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  sub_401097(0x10000);
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 3;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (00401097) --------------------------------------------------------
int __usercall sub_401097@<eax>(int result@<eax>)
{
  int v1; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v1);
  MEMORY[0] &= result;
  return result;
}

//----- (004041A2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4041A2(int a1@<edx>, int a2@<ebx>, _DWORD *a3@<edi>, double a4@<st5>, double a5@<st4>, double a6@<st3>, double a7@<st2>, double a8@<st1>, double a9@<st0>)
{
  int v9; // edx
  int v10; // ecx
  int v11; // esi
  int v12; // eax
  int v13; // et0
  bool v14; // cf
  char v15; // of
  char v16; // cc
  int v17; // ecx
  unsigned __int8 v18; // ah
  int v19; // [esp-4h] [ebp-4h] BYREF
  int savedregs; // [esp+0h] [ebp+0h]
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  while ( 1 )
  {
    v9 = __ROR4__(a1, 164);
    v10 = 1305715185;
    v11 = __ROR4__(&v19, 80);
    v16 = ((int)(a3 + 1) < 0) ^ __OFADD__(4, a3) | (a3 + 1 == 0);
    ++a3;
    if ( v16 )
      v9 = (int)&retaddr;
    v13 = __ROL4__(v11, 230);
    LOWORD(v11) = savedregs;
    v12 = v13;
    if ( !__SETP__(a3, savedregs) )
    {
      if ( (v12 & 0x93A139B5) == 0 )
        v10 = a2;
      v11 = ~__ROL4__(savedregs - 1585430876, 151);
    }
    v14 = __CFSHL__(v10, 12);
    v17 = v10 << 12;
    v16 = (v17 < 0) ^ v15;
    v18 = -101;
    if ( v14 )
    {
      v16 = ((__int16)(v17 + v14 + (_WORD)v11) < 0) ^ (__OFADD__(v14, (_WORD)v11) | __OFADD__(
                                                                                      (_WORD)v17,
                                                                                      v14 + (_WORD)v11));
      v18 = -105;
      v17 = (char)v9;
      v9 = -1316525840;
    }
    if ( !v16 )
      v17 = a2;
    if ( (int)a3 >= a2 )
      ((void (__usercall *)(int@<ecx>, int@<edx>, double@<st0>, double@<st1>, double@<st2>, double@<st3>, double@<st4>, double@<st5>))sub_404245)(
        v17,
        v9,
        a9,
        a8,
        a7,
        a6,
        a5,
        a4);
    if ( BYTE1(v9) < v18 )
      JUMPOUT(0x40414E);
    a6 = a6 + a4;
    a9 = a9 + a4;
    *a3 -= 849923212;
    sub_4041A2();
  }
}
// 40413D: positive sp value 4 has been found
// 404141: control flows out of bounds to 40414E
// 4041B5: variable 'a1' is possibly undefined
// 4041F9: variable 'v15' is possibly undefined
// 404245: using guessed type void __noreturn sub_404245();

//----- (00404245) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn sub_404245()
{
  JUMPOUT(0x8C63B5F4);
}
// 404274: positive sp value 4 has been found
// 404285: control flows out of bounds to 8C63B5F4
// 404245: using guessed type void __noreturn sub_404245();

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
