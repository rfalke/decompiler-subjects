/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int, int, int);
// int __usercall sub_401097@<eax>(int result@<eax>);
// void __usercall sub_4041A2(int@<edx>, int@<ebx>, _DWORD *@<edi>, double@<st5>, double@<st4>, double@<st3>, double@<st2>, double@<st1>, double@<st0>);
void __noreturn sub_404245(); // weak

//-------------------------------------------------------------------------
// Data declarations

// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);


//----- (00401042) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  sub_401097(0x10000);
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 3;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (00401097) --------------------------------------------------------
int __usercall sub_401097@<eax>(int result@<eax>)
{
  int v1; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v1);
  MEMORY[0] &= result;
  return result;
}

//----- (004041A2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4041A2(
        int a1@<edx>,
        int a2@<ebx>,
        _DWORD *a3@<edi>,
        double a4@<st5>,
        double a5@<st4>,
        double a6@<st3>,
        double a7@<st2>,
        double a8@<st1>,
        double a9@<st0>)
{
  int v9; // ecx
  int v10; // ecx
  int v11; // ecx
  int v12; // edx
  int v13; // ecx
  int v14; // esi
  int v15; // eax
  int v16; // esi
  int v17; // et0
  bool v18; // cf
  bool v19; // of
  char v20; // cc
  int v21; // ecx
  unsigned __int8 v22; // ah
  __int16 v23; // si
  int v24; // [esp-4h] [ebp-4h] BYREF
  int savedregs; // [esp+0h] [ebp+0h]
  void *retaddr; // [esp+4h] [ebp+4h] BYREF

  while ( 1 )
  {
    v12 = __ROR4__(a1, 164);
    v13 = 1305715185;
    v14 = __ROR4__(&v24, 80);
    v20 = ((int)(a3 + 1) < 0) ^ __OFADD__(4, a3) | (a3 + 1 == 0);
    ++a3;
    if ( v20 )
      v12 = (int)&retaddr;
    v17 = __ROL4__(v14, 230);
    v16 = savedregs;
    v15 = v17;
    if ( !__SETP__(a3, savedregs) )
    {
      if ( (v15 & 0x93A139B5) == 0 )
        v13 = a2;
      v16 = ~__ROL4__(savedregs - 1585430876, 151);
    }
    __asm { fcomp   st(6) }
    v18 = __CFSHL__(v13, 12);
    v21 = v13 << 12;
    v20 = (v21 < 0) ^ v19;
    v22 = -101;
    if ( v18 )
    {
      v19 = __OFADD__(v18, (_WORD)v16);
      v23 = v18 + (_WORD)v16;
      v19 |= __OFADD__((_WORD)v21, v23);
      LOWORD(v16) = v21 + v23;
      v20 = ((v16 & 0x8000u) != 0) ^ v19;
      v22 = -105;
      v21 = (char)v12;
      v12 = -1316525840;
    }
    if ( !v20 )
      v21 = a2;
    if ( (int)a3 >= a2 )
      ((void (__fastcall __noreturn *)(int, int))sub_404245)(v21, v12);
    v9 = v16 & v21;
    if ( BYTE1(v12) < v22 )
      JUMPOUT(0x40414E);
    v10 = ~(v9 & ~(1 << v16));
    __asm { fadd    st(2), st }
    LOWORD(v16) = -18202;
    __asm { fadd    st(5), st }
    v11 = v16 + ((v10 & 0x14586E2D) != 0) + v12;
    if ( !v11 )
      v11 = 1;
    *a3 -= 849923212;
    sub_4041A2(v11, a2, a3, a4, a5, a6, a7, a8, a9);
  }
}
// 40413D: positive sp value 4 has been found
// 4041F5: inconsistent fpu stack
// 404141: control flows out of bounds to 40414E
// 4041B5: variable 'a1' is possibly undefined
// 4041F9: variable 'v19' is possibly undefined
// 404245: using guessed type void __noreturn sub_404245();

//----- (00404245) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn sub_404245()
{
  JUMPOUT(0x8C63B5F4);
}
// 404274: positive sp value 4 has been found
// 404285: control flows out of bounds to 8C63B5F4
// 404245: using guessed type void __noreturn sub_404245();

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
