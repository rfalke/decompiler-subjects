/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall sub_401007(char@<ch>, unsigned int@<ebx>, int@<ebp>, __int16@<di>);
// void __usercall sub_40101E(char@<ch>, unsigned int@<ebx>, int@<ebp>, int@<eax>, __int16@<dx>, __int16@<di>);
// void __usercall sub_40103A(int@<eax>, __int32@<edx>, int@<ecx>, int@<edi>, int@<esi>);
// void __usercall sub_401050(int@<eax>, int@<ecx>, int@<edi>, int@<esi>);
// void __usercall sub_4010F7(int@<edx>, int@<ecx>, int@<ebx>, __int32@<edi>, int@<esi>, __int32@<eax>);
// void __usercall sub_401116(__int32@<edi>);
// void __usercall sub_401130(int@<edx>, int@<edi>);
void sub_40117F();
// int __usercall sub_40118E@<eax>(__int32@<edi>);
// void __usercall sub_4011AC(int@<ebp>, int@<ebx>, __int16@<si>);
// void __usercall sub_4011C2(int@<ebp>, int@<eax>, __int16@<dx>, int@<ebx>, __int16@<di>, __int16@<si>);
// void __usercall sub_4011FC(int@<eax>, char@<dh>, int@<ebx>, int@<ebp>, __int16@<di>);
// void __usercall sub_401233(__int32@<edi>);
// int __usercall start@<eax>(int@<esi>, int@<eax>, int@<edi>);
// int __usercall sub_401287@<eax>(int result@<eax>, int@<edx>, int@<edi>);
void __fastcall sub_4012A2(int, int);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_401146; // weak
_UNKNOWN loc_4011DA; // weak
_UNKNOWN loc_401218; // weak
_UNKNOWN loc_4012BB; // weak


//----- (00401007) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401007(char a1@<ch>, unsigned int a2@<ebx>, int a3@<ebp>, __int16 a4@<di>)
{
  int v4; // eax
  __int16 v5; // dx
  char v6; // ch
  void *v7; // [esp+18h] [ebp-4h]
  void *retaddr; // [esp+1Ch] [ebp+0h]

  *(&retaddr - 8) = v7;
  LOBYTE(a2) = a1 + a2;
  v4 = ((int (*)(void))((char *)&loc_4012BB + 5))();
  sub_40101E(v6, a2, a3, v4 ^ 0x3E189FF2, v5, a4);
}
// 40100B: positive sp value 4 has been found
// 40101A: variable 'v6' is possibly undefined
// 40101A: variable 'v5' is possibly undefined

//----- (0040101E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40101E(
        char a1@<ch>,
        unsigned int a2@<ebx>,
        int a3@<ebp>,
        int a4@<eax>,
        __int16 a5@<dx>,
        __int16 a6@<di>)
{
  unsigned int v7; // esi
  __int16 v8; // dx
  unsigned int v9; // edx
  bool v10; // cf
  int v12; // eax
  int v13; // ecx

  __asm { repne pop esi }
  v7 = a2 | _ESI;
  v8 = a6 + a5;
  HIBYTE(v8) += a2;
  BYTE1(a2) ^= a1;
  sub_4011C2(a3, a4, v8, a2, a6, v7);
  v10 = v9 < a2;
  _EDX = v9 - a2;
  __asm { insd }
  LOBYTE(v12) = v10;
  sub_40103A(v12, _EDX, v13, a6, v7);
}
// 401023: positive sp value 4 has been found
// 401034: variable 'v9' is possibly undefined
// 401039: variable 'v12' is possibly undefined
// 401039: variable 'v13' is possibly undefined

//----- (0040103A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40103A(int a1@<eax>, __int32 a2@<edx>, int a3@<ecx>, int a4@<edi>, int a5@<esi>)
{
  int v6; // esi
  int v7; // edi
  int v8; // eax
  int v9; // ecx
  char v10; // cf
  _BYTE *v11; // edx
  bool v12; // pf
  __int32 v13; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v13, a2);
  __asm { rep pop edx }
  v6 = a1 | a5;
  v7 = a4 + 1;
  v8 = ((int (__fastcall *)(int, int))((char *)&loc_4011DA + 2))(a1 | a3, _EDX);
  v12 = __SETP__(BYTE1(v11) + v10 + *v11, 0);
  *v11 += BYTE1(v11) + v10;
  if ( !v12 )
    JUMPOUT(0x40104C);
  sub_401050(v8, v9, v7, v6);
}
// 40103F: positive sp value 4 has been found
// 40104E: control flows out of bounds to 40104C
// 40104B: variable 'v11' is possibly undefined
// 40104B: variable 'v10' is possibly undefined
// 40104F: variable 'v9' is possibly undefined

//----- (00401050) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401050(int a1@<eax>, int a2@<ecx>, int a3@<edi>, int a4@<esi>)
{
  int v4; // ecx
  int v5; // edi
  void *v6; // [esp+28h] [ebp-4h]
  void *retaddr; // [esp+2Ch] [ebp+0h]

  *(&retaddr - 12) = v6;
  v4 = a2 - 1;
  v5 = a3 - v4 - 2;
  sub_40103A(a1, a1, v4 - a1, v5, a4);
  *(_DWORD *)(v5 - 105) &= a4;
  JUMPOUT(0x40106E);
}
// 401054: positive sp value 4 has been found
// 401069: control flows out of bounds to 40106E

//----- (004010F7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4010F7(int a1@<edx>, int a2@<ecx>, int a3@<ebx>, __int32 a4@<edi>, int a5@<esi>, __int32 a6@<eax>)
{
  char v8; // pf
  char v9; // cf
  char v10; // zf
  __int32 v11; // [esp+28h] [ebp-4h] BYREF

  _InterlockedExchange(&v11, a4);
  __asm { smsw    eax }
  sub_4012A2((a5 ^ a2) + 1, v11 | a1);
  if ( v9 | v10 )
    JUMPOUT(0x401099);
  if ( !v8 )
  {
    *(_WORD *)(a3 - 53) = __FS__;
    JUMPOUT(0x4010DF);
  }
  sub_401116(a6);
}
// 4010DC: positive sp value 4 has been found
// 4010DC: control flows out of bounds to 4010DF
// 401110: control flows out of bounds to 401099
// 401110: variable 'v9' is possibly undefined
// 401110: variable 'v10' is possibly undefined
// 401113: variable 'v8' is possibly undefined

//----- (00401116) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401116(__int32 a1@<edi>)
{
  int v1; // edx

  sub_40118E(a1);
  __asm { into }
  __inbyte(v1);
  sub_401130(v1 + 1, a1);
}
// 40112B: positive sp value 8 has been found
// 40112E: variable 'v1' is possibly undefined

//----- (00401130) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401130(int a1@<edx>, int a2@<edi>)
{
  _BYTE *v2; // edi
  char v3; // al
  char v4; // zf
  char v5; // sf
  char v6; // of

  v2 = (_BYTE *)(a1 + a2);
  sub_401116((__int32)v2);
  *v2 = v3;
  if ( v5 ^ v6 | v4 )
    JUMPOUT(0x401146);
  JUMPOUT(0x4011B9);
}
// 401143: positive sp value 8 has been found
// 401144: control flows out of bounds to 401146
// 401144: control flows out of bounds to 4011B9
// 401143: variable 'v3' is possibly undefined
// 401144: variable 'v5' is possibly undefined
// 401144: variable 'v6' is possibly undefined
// 401144: variable 'v4' is possibly undefined

//----- (0040117F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40117F()
{
  void *v0; // [esp+1Ch] [ebp-4h]
  void *retaddr; // [esp+20h] [ebp+0h]

  *(&retaddr - 9) = v0;
  JUMPOUT(0x4012DB);
}
// 401183: positive sp value 4 has been found
// 401189: control flows out of bounds to 4012DB

//----- (0040118E) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_40118E@<eax>(__int32 a1@<edi>)
{
  void *v2; // [esp+1Ch] [ebp-4h]
  void *retaddr[2]; // [esp+20h] [ebp+0h]

  retaddr[-9] = v2;
  sub_401233(a1);
  return MK_FP(retaddr[0], retaddr[0])();
}
// 401192: positive sp value 4 has been found

//----- (004011AC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4011AC(int a1@<ebp>, int a2@<ebx>, __int16 a3@<si>)
{
  int v3; // eax
  int v4; // ecx
  __int16 v5; // dx

  v3 = ((int (*)(void))((char *)&loc_401218 + 2))();
  *(_BYTE *)(v4 + 22) = -*(_BYTE *)(v4 + 22);
  __readeflags();
  sub_4011C2(a1, v3, v5, a2 + 1, a3 - 1, 0);
}
// 4011B0: positive sp value 4 has been found
// 4011BE: variable 'v4' is possibly undefined
// 4011C1: variable 'v5' is possibly undefined

//----- (004011C2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4011C2(int a1@<ebp>, int a2@<eax>, __int16 a3@<dx>, int a4@<ebx>, __int16 a5@<di>, __int16 a6@<si>)
{
  int v6; // ebx
  char v7; // cf
  int v8; // ecx

  HIBYTE(a3) = -HIBYTE(a3);
  BYTE1(a4) = a3;
  v6 = a4 + 1;
  BYTE1(v6) = BYTE1(a2);
  sub_4011FC(a2, (unsigned __int16)(a3 - a6) >> 8, v6, a1, a5);
  *(_BYTE *)(a1 + 4 * v8 + 855909476) = v7 + *(_BYTE *)(a1 + 4 * v8 + 855909476) - 54;
  JUMPOUT(0x4011E2);
}
// 4011C6: positive sp value 4 has been found
// 4011DA: control flows out of bounds to 4011E2
// 4011DA: variable 'v7' is possibly undefined
// 4011DA: variable 'v8' is possibly undefined

//----- (004011FC) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4011FC(int a1@<eax>, char a2@<dh>, int a3@<ebx>, int a4@<ebp>, __int16 a5@<di>)
{
  sub_401007(a2 | HIBYTE(a5), a1 ^ (a3 + 1), a4, a5);
  JUMPOUT(0x40121D);
}
// 401218: positive sp value 8 has been found
// 401218: control flows out of bounds to 40121D

//----- (00401233) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_401233(__int32 a1@<edi>)
{
  unsigned __int16 v2; // dx
  __int32 v4; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v4, a1);
  sub_40117F();
  __outbyte(v2, _EAX);
  _EAX ^= 0x8F841FFu;
  __asm { aad     89h ; '‰' }
  JUMPOUT(0x401254);
}
// 40123A: positive sp value 4 has been found
// 401252: control flows out of bounds to 401254
// 40124C: variable 'v2' is possibly undefined
// 40124C: variable '_EAX' is possibly undefined

//----- (0040126C) --------------------------------------------------------
int __usercall start@<eax>(int a1@<esi>, int a2@<eax>, int a3@<edi>)
{
  int v3; // edi
  int v4; // edx
  int savedregs; // [esp+0h] [ebp+0h] BYREF

  v3 = a2 | a3;
  sub_4011AC((int)&savedregs, a1, a1);
  return sub_401287(a1, v4, v3);
}
// 401282: variable 'v4' is possibly undefined

//----- (00401287) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_401287@<eax>(int result@<eax>, int a2@<edx>, int a3@<edi>)
{
  int v3; // edi
  int v4; // [esp+14h] [ebp-8h]
  int v5; // [esp+18h] [ebp-4h]

  *(&v5 - 8) = v4;
  v3 = a2 ^ a3;
  if ( (result & 8) == 0 )
  {
    sub_401130(a2, result + v3);
    v5 = (unsigned __int16)__SS__;
    JUMPOUT(0x4010D8);
  }
  return result;
}
// 4010CC: positive sp value 8 has been found
// 4010D7: control flows out of bounds to 4010D8

//----- (004012A2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_4012A2(int a1, int a2)
{
  void *v2; // [esp+20h] [ebp-4h]
  void *retaddr; // [esp+24h] [ebp+0h]

  *(&retaddr - 10) = v2;
  ((void (__thiscall *)(int))loc_401146)(a2 | a1);
  JUMPOUT(0x4012C1);
}
// 4012A6: positive sp value 4 has been found
// 4012BB: control flows out of bounds to 4012C1

// nfuncs=16 queued=16 decompiled=16 lumina nreq=0 worse=0 better=0
// ALL OK, 16 function(s) have been successfully decompiled
