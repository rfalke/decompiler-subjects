/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall sub_40104F@<eax>(float a1@<eax>, int a2@<ebx>, _DWORD *a3@<edi>, __m128i a4@<xmm0>, __m128i a5@<xmm1>);
// int __usercall sub_4017A1@<eax>(float a1@<eax>, int a2@<ebx>, int a3@<edi>, __m128i a4@<xmm0>, __m128i a5@<xmm1>);
// int __usercall sub_401816@<eax>(__m128i a1@<xmm0>, __m128i a2@<xmm1>);
int __stdcall sub_401AAC(int a1);
// int __stdcall byte_402096(_DWORD); weak

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN unk_4022D8; // weak


//----- (00401000) --------------------------------------------------------
#error "401000: stack frame is too big (funcsize=0)"

//----- (0040104F) --------------------------------------------------------
int __usercall sub_40104F@<eax>(float a1@<eax>, int a2@<ebx>, _DWORD *a3@<edi>, __m128i a4@<xmm0>, __m128i a5@<xmm1>)
{
  int v5; // eax
  int v6; // edx
  int result; // eax

  v5 = sub_4017A1(a1, a2, (int)a3, a4, a5);
  result = v5 - v6;
  *a3 = result;
  return result;
}
// 40108E: variable 'v6' is possibly undefined

//----- (004017A1) --------------------------------------------------------
int __usercall sub_4017A1@<eax>(float a1@<eax>, int a2@<ebx>, int a3@<edi>, __m128i a4@<xmm0>, __m128i a5@<xmm1>)
{
  int v5; // edx
  int v6; // ecx
  int v7; // eax
  unsigned int v8; // eax
  int v10; // [esp-18h] [ebp-3Ch]
  int v11; // [esp-14h] [ebp-38h]
  int v12; // [esp-10h] [ebp-34h]
  int v13; // [esp-Ch] [ebp-30h]
  int v14; // [esp-8h] [ebp-2Ch]
  int v15; // [esp-8h] [ebp-2Ch]
  int v16; // [esp-4h] [ebp-28h]
  int v17; // [esp-4h] [ebp-28h]
  int v19; // [esp+20h] [ebp-4h] BYREF

  v19 = 0;
  v5 = 0;
  v6 = 8653;
  do
  {
    *(float *)a5.m128i_i32 = *(float *)a5.m128i_i32 * a1;
    a4 = _mm_min_epi16(a4, a5);
    v16 = v6;
    v14 = v5;
    v7 = (*(int (**)(void))(a2 + 8306))();
    v6 = v7 + v16;
    v5 = v14 + 1;
  }
  while ( v14 + 1 <= 3464 );
  v8 = (*(int (__cdecl **)(int, int, int, int, int *, int))(v6 + a2 - 3465))(-1, a3, 2, 4, &v19, v7 + v16);
  (*(void (__stdcall **)(int, int, int, unsigned int, int *, int, int, int, int, int))(v10 + a2 - 3465))(
    -1,
    a3,
    2,
    (unsigned int)_mm_cvtsi128_si32(_mm_shuffle_epi32(_mm_shufflelo_epi16(_mm_cvtsi32_si128(v8), 64), 68)) >> 16 << 6,
    &v19,
    v11,
    v12,
    v13,
    v15,
    v17);
  return LODWORD(a1);
}
// 40180C: variable 'v10' is possibly undefined
// 40180C: variable 'v11' is possibly undefined
// 40180C: variable 'v12' is possibly undefined
// 40180C: variable 'v13' is possibly undefined
// 40180C: variable 'v15' is possibly undefined
// 40180C: variable 'v17' is possibly undefined

//----- (00401816) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __usercall sub_401816@<eax>(__m128i a1@<xmm0>, __m128i a2@<xmm1>)
{
  _BYTE *v2; // edx
  int v3; // ebx
  int *v4; // esi
  _DWORD *v5; // edi
  int result; // eax
  int v7; // ecx
  int v8; // eax
  __int16 v9; // [esp-2h] [ebp-2h]

  HIWORD(v2) = v9;
  LOWORD(v2) = 0;
  while ( *v2 != 77 || v2[1] != 90 )
    v2 -= 4096;
  v3 = (int)v2;
  v4 = (int *)(v2 + 21504);
  v5 = v2 + 21504;
  do
  {
    v8 = *v4++;
    result = sub_40104F(COERCE_FLOAT(v8 - 36719934), v3, v5, a1, a2);
  }
  while ( v7 != 1 );
  return result;
}
// 401819: positive sp value 4 has been found
// 401818: variable 'v9' is possibly undefined
// 40186D: variable 'v7' is possibly undefined

//----- (00401AAC) --------------------------------------------------------
int __stdcall sub_401AAC(int a1)
{
  int result; // eax
  _DWORD *v2; // eax
  int v3; // ecx
  unsigned int v4; // [esp+8h] [ebp-Ch]
  unsigned int v5; // [esp+10h] [ebp-4h]

  ((void (__stdcall *)(int))((char *)&byte_402096 + 62))(a1);
  if ( !a1 )
    return 0;
  v2 = (_DWORD *)((int (__stdcall *)(int))((char *)&byte_402096 + 86))(a1);
  if ( !v2 )
    return 0;
  v5 = 0;
  v3 = a1 + v2[9];
  v4 = v2[6];
  if ( v4 )
  {
    do
    {
      if ( !memcmp(&unk_4022D8, (const void *)(a1 + *(_DWORD *)(a1 + v2[8] + 4 * v5)), 0x16u) )
        break;
      ++v5;
    }
    while ( v5 < v4 );
    v3 = a1 + v2[9];
  }
  if ( v5 >= v4 )
    result = 0;
  else
    result = a1 + *(_DWORD *)(a1 + v2[7] + 4 * *(unsigned __int16 *)(v3 + 2 * v5));
  return result;
}
// 402096: using guessed type int __stdcall byte_402096(_DWORD);

// nfuncs=6 queued=5 decompiled=5 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 5 function(s)"
