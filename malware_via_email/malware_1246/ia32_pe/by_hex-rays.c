/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

// void __usercall start(unsigned int a1@<eax>, char a2@<cl>, int a3@<ebp>, _BYTE *a4, _BYTE *a5);
int __thiscall nullsub_1(_DWORD); // weak
void __stdcall sub_401076(_BYTE *a1, _BYTE *a2);
void __stdcall sub_4010B5(_BYTE *a1);


//----- (00401000) --------------------------------------------------------
void __usercall start(unsigned int a1@<eax>, char a2@<cl>, int a3@<ebp>, _BYTE *a4, _BYTE *a5)
{
  int v5; // ebx
  int (__cdecl *v6)(_DWORD, int, int); // eax
  int v7; // ecx
  int v8; // edx
  void (__cdecl *v9)(int, _DWORD, int, int **); // eax
  int v10; // [esp+4h] [ebp-2Ch]
  void (__cdecl *v11)(int); // [esp+8h] [ebp-28h]
  int *v12; // [esp+10h] [ebp-20h] BYREF
  int v13; // [esp+14h] [ebp-1Ch] BYREF
  int v14; // [esp+1Ch] [ebp-14h]

  nullsub_1(a3 + (a1 >> (-a2 - 2)));
  HIWORD(v5) = HIWORD(v14);
  LOWORD(v5) = 0;
  v14 = v5 + *(_DWORD *)(*(_DWORD *)(v5 + 60) + v5 + *(unsigned __int16 *)(*(_DWORD *)(v5 + 60) + v5 + 20) + 76) + 2375;
  sub_4010B5((_BYTE *)0xCEF2EDA8);
  if ( v6(0, v5 + 1, v14) )
  {
    nullsub_1(v7);
  }
  else
  {
    sub_4010B5((_BYTE *)0x10066F2F);
    v12 = &v13;
    v9(v5 + *(_DWORD *)(v8 + 52), *(_DWORD *)(v8 + 48), 64, &v12);
    v11(v10);
    sub_401076(a4, a5);
  }
}
// 40104D: variable 'v6' is possibly undefined
// 40106A: variable 'v9' is possibly undefined
// 401064: variable 'v8' is possibly undefined
// 401074: variable 'v11' is possibly undefined
// 401074: variable 'v10' is possibly undefined
// 401051: variable 'v7' is possibly undefined
// 401018: using guessed type int __thiscall nullsub_1(_DWORD);

//----- (00401076) --------------------------------------------------------
void __stdcall sub_401076(_BYTE *a1, _BYTE *a2)
{
  _BYTE *v2; // edx
  _BYTE *v3; // ecx
  _BYTE *v4; // edi
  unsigned int v6; // eax
  char v7; // bl
  char v8; // cf

  v2 = a1;
  v3 = a2;
  if ( !a2 )
  {
    v4 = a1;
    while ( *v4++ != 0 )
      ;
    v3 = (_BYTE *)(v4 - 1 - a1);
  }
  v6 = -1;
  do
  {
    LOBYTE(v6) = *v2++ ^ v6;
    v7 = 8;
    do
    {
      v8 = v6 & 1;
      v6 >>= 1;
      if ( v8 )
        v6 ^= 0xEDB88320;
      --v7;
    }
    while ( v7 );
    --v3;
  }
  while ( v3 );
}
// 401076: could not find valid save-restore pair for esi

//----- (004010B5) --------------------------------------------------------
void __stdcall sub_4010B5(_BYTE *a1)
{
  struct _LIST_ENTRY *Flink; // edx
  char *v2; // edi
  struct _LIST_ENTRY *v3; // esi
  int v4; // ecx
  __int16 v5; // ax
  int v6; // ecx
  char *v7; // esi
  char *v8; // edi
  char v9; // al
  int v10; // eax
  struct _LIST_ENTRY *v11; // ebx
  int *v12; // esi
  int *v13; // edi
  int v14; // ecx
  int v15; // eax
  int *v16; // esi
  int v17; // eax
  _BYTE *v18; // eax
  char v19[13]; // [esp+Bh] [ebp-19h] BYREF
  int v20[2]; // [esp+18h] [ebp-Ch] BYREF

  Flink = NtCurrentPeb()->Ldr->InLoadOrderModuleList.Flink;
  do
  {
    v2 = v19;
    v3 = Flink->Flink[6].Flink;
    v4 = 13;
    do
    {
      v5 = (__int16)v3->Flink;
      v3 = (struct _LIST_ENTRY *)((char *)v3 + 2);
      *v2++ = v5;
      if ( !v5 )
        break;
      --v4;
    }
    while ( v4 );
    v6 = 13;
    v7 = v19;
    v8 = v19;
    do
    {
      v9 = *v7++;
      if ( (unsigned __int8)v9 <= 0x5Au && (unsigned __int8)v9 >= 0x41u )
        v9 += 32;
      *v8++ = v9;
      --v6;
    }
    while ( v6 );
    sub_401076(v19, 0);
  }
  while ( v10 != 0x6AE69F02 );
  v11 = Flink[3].Flink;
  v12 = (int *)((char *)&v11[3].Blink + *(unsigned int *)((char *)&v11[7].Blink[15].Flink + (unsigned int)v11));
  v13 = v20;
  v14 = 3;
  do
  {
    v15 = *v12++;
    *v13++ = (int)v11 + v15;
    --v14;
  }
  while ( v14 );
  v16 = (int *)v20[1];
  do
  {
    v17 = *v16++;
    sub_401076((_BYTE *)v11 + v17, 0);
  }
  while ( a1 != v18 );
}
// 4010B5: could not find valid save-restore pair for esi
// 4010C9: variable 'Flink' is possibly undefined
// 401104: variable 'v10' is possibly undefined
// 401140: variable 'v18' is possibly undefined

// nfuncs=4 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
