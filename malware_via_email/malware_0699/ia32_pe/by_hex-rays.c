/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __cdecl start(int a1, int a2, int a3);
// int __usercall sub_4010FE@<eax>(int result@<eax>);
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// void __usercall sub_4041B4(int a1@<eax>, char a2@<bl>, double a3@<st7>, double a4@<st6>, double a5@<st5>, double a6@<st4>, double a7@<st3>, double a8@<st2>, double a9@<st1>, double a10@<st0>);
// void __usercall sub_40430B(int a1@<eax>, double a2@<st7>, double a3@<st6>, double a4@<st5>, double a5@<st4>, double a6@<st3>, double a7@<st2>, double a8@<st1>, double a9@<st0>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_40437A; // weak


//----- (004010A9) --------------------------------------------------------
int __cdecl start(int a1, int a2, int a3)
{
  int v3; // edx

  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  GetModuleHandleA(0);
  sub_4010FE(0x10000);
  v3 = *(_DWORD *)(a3 + 176) - 1;
  if ( *(_DWORD *)(a3 + 176) == 1 )
    *(_DWORD *)(a3 + 184) += 3;
  *(_DWORD *)(a3 + 176) = v3;
  return 0;
}

//----- (004010FE) --------------------------------------------------------
int __usercall sub_4010FE@<eax>(int result@<eax>)
{
  int v1; // [esp-4h] [ebp-4h] BYREF

  __writefsdword(0, (unsigned int)&v1);
  MEMORY[0] &= result;
  return result;
}

//----- (004041B4) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4041B4(int a1@<eax>, char a2@<bl>, double a3@<st7>, double a4@<st6>, double a5@<st5>, double a6@<st4>, double a7@<st3>, double a8@<st2>, double a9@<st1>, double a10@<st0>)
{
  unsigned int v10; // esi
  char v11; // of
  unsigned int v12; // eax
  int v13; // eax
  int v14; // ebx
  int v15; // ecx
  bool v17; // sf
  bool v18; // cc
  int v20; // esi
  bool v21; // cf
  __int16 v22; // si
  char v23; // zf
  char v24; // sf
  char v25; // of
  char v26; // pf
  int v27; // eax
  int v28; // eax
  int v29; // [esp-4h] [ebp-4h]

  __asm
  {
    fcomp   st(2)
    fadd    st(4), st
  }
  v10 = a2;
  v12 = a1 << 24;
  if ( v11 )
    v10 = v12;
  v13 = v10;
  __asm { fcom    st(5) }
  _BitScanReverse((unsigned int *)&v14, v10);
  v15 = v10 + 2;
  _ESI = -v10;
  v17 = (BYTE1(v15) & BYTE1(v13) & 0x80u) != 0;
  v18 = v17;
  if ( !__SETP__(BYTE1(v15) & BYTE1(v13), 0) )
  {
    v15 = -1294788509;
    v17 = 0;
    v18 = __OFADD__(496919325, 1304334471);
    v14 = 496919325;
    _ESI = v13;
  }
  if ( !v18 )
  {
    v13 = v15;
    if ( v18 )
      _ESI = v29 + 513;
    __asm
    {
      rcr     esi, 8Bh
      fsubr   st(7), st
    }
    v17 = -_ESI < 0;
  }
  v20 = -1074775258;
  if ( !v17 )
    v20 = v13;
  LOWORD(v13) = v20 + v13;
  if ( (unsigned int)(v29 + 513) >= 0xFFFFFC3C || v29 == -1477 )
    v20 = v13;
  v21 = __CFADD__(v14, v13);
  HIWORD(v13) = HIWORD(v14);
  LOWORD(v13) = v14 + v13 + v21 + (_WORD)v14;
  v22 = __ROL4__(v20, 243);
  v27 = v13 ^ (1 << v22);
  if ( v26 )
    v22 = v27;
  v28 = -123728873;
  if ( v24 ^ v25 | v23 )
    v28 = v22 + 1;
  *(_DWORD *)(v29 + 513) -= 1478492742;
  sub_40430B(v28, a3, a4, a5, a6, a7, a8, a9, a10);
  sub_40430B(63, a3, a4, a5, a6, a7, a8, a9, a10);
}
// 4041CB: positive sp value 4 has been found
// 4041B4: inconsistent fpu stack
// 4041DA: variable 'v11' is possibly undefined
// 404269: variable 'v29' is possibly undefined
// 4042B0: variable 'v26' is possibly undefined
// 4042BB: variable 'v24' is possibly undefined
// 4042BB: variable 'v25' is possibly undefined
// 4042A7: variable 'v23' is possibly undefined

//----- (0040430B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40430B(int a1@<eax>, double a2@<st7>, double a3@<st6>, double a4@<st5>, double a5@<st4>, double a6@<st3>, double a7@<st2>, double a8@<st1>, double a9@<st0>)
{
  int savedregs; // [esp+0h] [ebp+0h]

  ((void (__usercall *)(int@<ecx>, double@<st0>, double@<st1>, double@<st2>, double@<st3>, double@<st4>, double@<st5>, double@<st6>, double@<st7>))loc_40437A)(
    -(a1 + 1),
    a9 + a2,
    a8,
    a7,
    a6,
    a5,
    a4,
    a3,
    a2);
  savedregs = (unsigned __int16)__CS__;
  __asm { rcr     byte ptr [ecx+0Fh], 1 }
  JUMPOUT(0x40437A);
}
// 40432F: positive sp value 4 has been found
// 404370: control flows out of bounds to 40437A

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
