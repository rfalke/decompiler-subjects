// subject_data.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

Eq_2 g_t402333 = // 00402333
	{
		&g_a4278
	};
Eq_2 g_t402337 = // 00402337
	{
		&g_a5600
	};
Eq_990 g_a40233B[] = // 0040233B
	{
	};
Eq_2 g_t406700 = // 00406700
	{
		null
	};
word32 g_dw406704 = 0x00; // 00406704
Eq_2 g_t406708 = // 00406708
	{
		null
	};
word32 g_dw40670C = 0x00; // 0040670C
ptr32 g_ptr406710 = 0x00; // 00406710
word32 g_dw406714 = 0x00; // 00406714
Eq_2 g_t406718 = // 00406718
	{
		null
	};
struct Eq_151 * g_ptr40671C = null; // 0040671C
<anonymous> * g_ptr406720 = null; // 00406720
// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__CreateFileA = &g_t1AF4; // 00401000
<anonymous> * __imp__lstrcatA = &g_t1B02; // 00401004
<anonymous> * __imp__GetWindowsDirectoryA = &g_t1B0E; // 00401008
<anonymous> * __imp__GetModuleHandleA = &g_t1B26; // 0040100C
<anonymous> * __imp__GetProcAddress = &g_t1B3A; // 00401010
<anonymous> * __imp__CloseHandle = &g_t1B4C; // 00401014
<anonymous> * __imp__VirtualAlloc = &g_t1B5A; // 00401018
<anonymous> * __imp__MapViewOfFileEx = &g_t1B6A; // 0040101C
<anonymous> * __imp__VirtualFree = &g_t1B7C; // 00401020
<anonymous> * __imp__UnmapViewOfFile = &g_t1B8A; // 00401024
<anonymous> * __imp__lstrcpyA = &g_t1B9C; // 00401028
<anonymous> * __imp__LoadIconA = &g_t1BB6; // 00401030
// 00401040: void fn00401040(Stack Eq_2 dwArg04, Stack Eq_2 dwArg08, Stack Eq_2 dwArg0C)
// Called from:
//      fn004012F0
//      fn00401760
void fn00401040(Eq_2 dwArg04, Eq_2 dwArg08, Eq_2 dwArg0C)
{
	g_t406708.u0 = 0x00;
	while (g_t406708.u0 < dwArg0C)
	{
		Mem23[dwArg04 + Mem9[0x00406708<p32>:word32]:byte] = Mem9[dwArg08 + Mem9[0x00406708<p32>:word32]:byte];
		g_t406708.u0 = (DWORD) &(g_t406708.u0 + 1)->a0000->b0000;
	}
}

// 004010E0: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	ptr32 fp;
	word32 ebx;
	word32 esi;
	word32 edi;
	struct Eq_25 * fs;
	Eq_26 tLoc014C;
	byte bLoc014B;
	Eq_2 eax_20 = GetModuleHandleA(0x00);
	LoadIconA(null, 0x7F00);
	GetWindowsDirectoryA(&tLoc014C, 300);
	if ((word32) bLoc014B != 0x3A)
		int3();
	lstrcatA(&tLoc014C, 4220340);
	if (CreateFileA(&tLoc014C, 0x01, 0x03, null, 0x03, 0x80, 0x00) == ~0x00)
		return 0x00;
	GetWindowsDirectoryA(&tLoc014C, 300);
	if ((word32) bLoc014B != 0x3A)
		int3();
	lstrcatA(&tLoc014C, 4220348);
	if (CreateFileA(&tLoc014C, 0x01, 0x03, null, 0x03, 0x80, 0x00) != ~0x00)
		return 0x00;
	Eq_2 eax_109 = g_t402333.u0;
	Eq_2 edx_112 = g_t402337.u0;
	Eq_2 dwLoc08_287 = 0x00;
	eax_125 = eax_109;
	while (true)
	{
		Eq_2 eax_125;
		if (dwLoc08_287 >= eax_109)
			break;
		GetModuleHandleA(0x00);
		&((word32) dwLoc08_287 + 4203323)->u0->a0000->b0000 = *((word32) dwLoc08_287 + 4203323) ^ 22;
		&eax_125.u0->a0000->b0000 = (word32) dwLoc08_287 + 8;
		&dwLoc08_287.u0->a0000->b0000 = (word32) dwLoc08_287 + 8;
	}
	fn00401730(edx_112);
	g_t406718.u0 = (DWORD) eax_125;
	fn004018F0(g_a40233B, g_t406718.u0, eax_109);
	g_dw40670C = edi;
	g_dw406704 = esi;
	g_dw406714 = ebx;
	g_ptr40671C = fs->ptr0018;
	g_ptr406710 = fp - 4;
	fn00401760(4199055 - eax_20, eax_20);
	fn004012F0(g_t406718.u0);
	Eq_2 eax_198;
	g_ptr406720();
	return eax_198;
}

// 004012D0: void fn004012D0(Stack Eq_2 dwArg04, Stack Eq_31 dwArg08)
// Called from:
//      fn004012F0
void fn004012D0(Eq_2 dwArg04, Eq_31 dwArg08)
{
	GetProcAddress(dwArg04, dwArg08);
}

// 004012F0: void fn004012F0(Stack Eq_2 dwArg04)
// Called from:
//      Win32CrtStartup
void fn004012F0(Eq_2 dwArg04)
{
	ptr32 fp;
	Eq_26 tLocBC;
	Eq_2 eax_11 = GetModuleHandleA(4220372);
	lstrcpyA(&tLocBC, 0x004065E4);
	Eq_195 eax_26 = GetProcAddress(eax_11, 4220408);
	lstrcpyA(&tLocBC, 4220424);
	GetProcAddress(eax_11, 4220444);
	lstrcpyA(&tLocBC, 4220460);
	Eq_195 eax_56 = GetProcAddress(eax_11, 0x00406634);
	lstrcpyA(&tLocBC, 0x00406648);
	Eq_195 eax_71 = GetProcAddress(eax_11, 0x0040665C);
	lstrcpyA(&tLocBC, 0x0040666C);
	Eq_195 eax_86 = GetProcAddress(eax_11, 4220540);
	lstrcpyA(&tLocBC, 0x0040668C);
	GetProcAddress(eax_11, 0x004066A4);
	word32 edx_108 = dwArg04 + Mem105[dwArg04 + 60:word32];
	struct Eq_291 * dwLoc30_542 = &edx_108->w0014 + 2 + (word32) edx_108->w0014 / 64;
	Eq_2 eax_127 = eax_71();
	fn00401040(eax_127, dwArg04, (word32) *((word32) dwArg04 + 60) + 312 + (word32) edx_108->w0006 *s 0x28);
	up32 dwLoc10_548;
	for (dwLoc10_548 = 0x00; dwLoc10_548 < (word32) edx_108->w0006; ++dwLoc10_548)
	{
		if (dwLoc30_542->dw0014 != 0x00 && dwLoc30_542->dw0010 != 0x00)
			fn00401040(&(eax_127.u0 + dwLoc30_542->dw000C)->a0000->b0000, &(dwArg04.u0 + dwLoc30_542->dw0014)->a0000->b0000, (uint32) ((uint64) (dwLoc30_542->dw0010 - 1 + (edx_108->t003C).u0) /u (edx_108->t003C).u0) *s (edx_108->t003C).u0);
		++dwLoc30_542;
	}
	word32 ecx_166 = eax_127 + Mem163[eax_127 + 60:word32];
	Eq_2 eax_186 = eax_56();
	struct Eq_330 * esp_185 = fp - 244;
	struct Eq_333 * dwLocCC_556 = &(eax_127.u0 + ecx_166->dw0080)->a0000->b0000;
	while (dwLocCC_556->dw0010 != 0x00)
	{
		word32 * dwLoc3C_575;
		ui32 * dwLoc2C_574;
		struct Eq_330 * esp_344 = esp_185 - 4;
		esp_344->ptr0000 = &(eax_127.u0 + dwLocCC_556->dw000C)->a0000->b0000;
		Eq_2 eax_347 = eax_86();
		if (dwLocCC_556->dw0000 != 0x00)
		{
			dwLoc2C_574 = (ui32 *) &(eax_127.u0 + dwLocCC_556->dw0000)->a0000->b0000;
			dwLoc3C_575 = (word32 *) &(eax_127.u0 + dwLocCC_556->dw0010)->a0000->b0000;
		}
		else
		{
			dwLoc2C_574 = (ui32 *) &(eax_127.u0 + dwLocCC_556->dw0010)->a0000->b0000;
			dwLoc3C_575 = (word32 *) &(eax_127.u0 + dwLocCC_556->dw0000)->a0000->b0000;
		}
		word32 dwLoc1C_578 = 0x00;
		if (dwLocCC_556->dw0010 != 0x00 && dwLocCC_556->dw0000 != 0x00)
			dwLoc1C_578 = 0x01;
		while (true)
		{
			esp_185 = esp_344;
			if (*dwLoc2C_574 == 0x00)
				break;
			if ((*dwLoc2C_574 & 0x80000000) != 0x00)
			{
				ui32 eax_415 = *dwLoc2C_574;
				esp_344->tFFFFFFFC.u0 = (CHAR *) (eax_415 & 0x7FFFFFFF);
				esp_344->tFFFFFFF8.u0 = (DWORD) eax_347;
				fn004012D0(esp_344->tFFFFFFF8.u0, esp_344->tFFFFFFFC.u0);
				*dwLoc2C_574 = eax_415 & 0x7FFFFFFF;
			}
			else
			{
				Eq_31 eax_402 = &(eax_127.u0 + (*dwLoc2C_574 + 2))->a0000->b0000;
				esp_344->tFFFFFFFC.u0 = (CHAR *) eax_402;
				esp_344->tFFFFFFF8.u0 = (DWORD) eax_347;
				fn004012D0(esp_344->tFFFFFFF8.u0, esp_344->tFFFFFFFC.u0);
				*dwLoc2C_574 = (ui32) eax_402;
			}
			if (dwLoc1C_578 != 0x00)
				*dwLoc3C_575 = *dwLoc2C_574;
			++dwLoc2C_574;
			++dwLoc3C_575;
		}
		++dwLocCC_556;
	}
	struct Eq_379 * esp_205 = esp_185 - 4;
	esp_205->t0000.u0 = ecx_166->t0034.u0;
	esp_205->dwFFFFFFFC = 0x00;
	esp_205->dwFFFFFFF8 = 0x00;
	esp_205->dwFFFFFFF4 = 0x00;
	esp_205->dwFFFFFFF0 = 0x22;
	esp_205->tFFFFFFEC.u0 = (DWORD) eax_186;
	g_t406700.u0 = (DWORD) eax_26();
	if (g_t406700.u0 == 0x00)
	{
		esp_205->tFFFFFFE8.u0 = ecx_166->t0034.u0;
		if (UnmapViewOfFile(esp_205->tFFFFFFE8) == 0x00)
		{
			esp_205->tFFFFFFE8.u0 = 0x8000;
			esp_205->tFFFFFFE4.u0 = 0x00;
			esp_205->tFFFFFFE0.u0 = ecx_166->t0034.u0;
			if (VirtualFree(esp_205->tFFFFFFE0, esp_205->tFFFFFFE4.u0, esp_205->tFFFFFFE8.u0) == 0x00)
				return;
		}
		esp_205->tFFFFFFE8.u0 = ecx_166->t0034.u0;
		esp_205->tFFFFFFE4.u0 = 0x00;
		esp_205->tFFFFFFE0.u0 = 0x00;
		esp_205->tFFFFFFDC.u0 = 0x00;
		esp_205->tFFFFFFD8.u0 = 0x22;
		esp_205->tFFFFFFD4.u0 = (DWORD) eax_186;
		g_t406700.u0 = (DWORD) MapViewOfFileEx(esp_205->tFFFFFFD4, esp_205->tFFFFFFD8.u0, esp_205->tFFFFFFDC.u0, esp_205->tFFFFFFE0.u0, esp_205->tFFFFFFE4.u0, esp_205->tFFFFFFE8);
		if (g_t406700.u0 == 0x00)
		{
			esp_205->tFFFFFFE8.u0 = 0x40;
			esp_205->tFFFFFFE4.u0 = 0x3000;
			esp_205->tFFFFFFE0.u0 = ecx_166->t0050.u0;
			esp_205->tFFFFFFDC.u0 = ecx_166->t0034.u0;
			g_t406700.u0 = (DWORD) VirtualAlloc(esp_205->tFFFFFFDC, esp_205->tFFFFFFE0.u0, esp_205->tFFFFFFE4.u0, esp_205->tFFFFFFE8.u0);
		}
	}
	esp_205->tFFFFFFE8.u0 = (DWORD) eax_186;
	CloseHandle(esp_205->tFFFFFFE8);
	esp_205->tFFFFFFE8.u0 = ecx_166->t0050.u0;
	esp_205->tFFFFFFE4.u0 = (DWORD) eax_127;
	esp_205->tFFFFFFE0.u0 = g_t406700.u0;
	fn00401040(esp_205->tFFFFFFE0.u0, esp_205->tFFFFFFE4.u0, esp_205->tFFFFFFE8.u0);
	esp_205->tFFFFFFE8.u0 = g_t406700.u0;
	fn004018C0(esp_205->tFFFFFFE8.u0);
	Mem326[0x00406720<p32>:word32] = Mem317[0x00406700<p32>:word32] + Mem317[ecx_166 + 40:word32];
	ecx_166->ptr0028 = g_ptr406720;
}

// 00401730: void fn00401730(Stack Eq_2 dwArg04)
// Called from:
//      Win32CrtStartup
void fn00401730(Eq_2 dwArg04)
{
	VirtualAlloc(0x00, dwArg04, 0x3000, 0x04);
}

// 00401760: void fn00401760(Stack word32 dwArg04, Stack Eq_2 dwArg08)
// Called from:
//      Win32CrtStartup
void fn00401760(word32 dwArg04, Eq_2 dwArg08)
{
	word32 edx_16 = dwArg08 + Mem13[dwArg08 + 60:word32];
	g_t406700.u0 = (DWORD) GetProcAddress(GetModuleHandleA(0x004066C0), 0x004066B0)();
	if (g_t406700.u0 == 0x00)
		return;
	fn00401040(g_t406700.u0, dwArg08, edx_16->t0050.u0);
	int32 eax_66 = g_t406700.u0 - dwArg08;
	if (edx_16->dw00A4 != 0x00)
	{
		struct Eq_788 * dwLoc0C_174 = &(dwArg08.u0 + edx_16->dw00A0)->a0000->b0000;
		while (dwLoc0C_174->t0004.u0 != 0x00)
		{
			uint32 eax_102 = dwLoc0C_174->t0004.u0 - 0x08 >> 0x01;
			word16 dwLoc20_180[] = (char *) &dwLoc0C_174->t0004 + 4;
			uint32 dwLoc08_181;
			for (dwLoc08_181 = 0x00; dwLoc08_181 < eax_102; ++dwLoc08_181)
			{
				if ((word32) dwLoc20_180[dwLoc08_181] >> 0x0C == 0x03)
					(&(g_t406700.u0 + dwLoc0C_174->dw0000)->a0000->b0000)[(word32) dwLoc20_180[dwLoc08_181] & 0x0FFF] = (byte) ((&(g_t406700.u0 + dwLoc0C_174->dw0000)->a0000->b0000)[(word32) dwLoc20_180[dwLoc08_181] & 0x0FFF] + eax_66);
			}
			dwLoc0C_174 += dwLoc0C_174->t0004.u0 / 8;
		}
	}
	<anonymous> * edx_85 = &(g_t406700.u0 + dwArg04)->a0000->b0000;
	edx_85();
}

// 004018C0: void fn004018C0(Stack Eq_2 dwArg04)
// Called from:
//      fn004012F0
void fn004018C0(Eq_2 dwArg04)
{
	g_ptr40671C->ptr0030->t0008.u0 = (DWORD) dwArg04;
}

// 004018F0: void fn004018F0(Stack (ptr32 Eq_12) dwArg04, Stack Eq_2 dwArg08, Stack Eq_2 dwArg0C)
// Called from:
//      Win32CrtStartup
void fn004018F0(struct Eq_12 * dwArg04, Eq_2 dwArg08, Eq_2 dwArg0C)
{
	Eq_26 tLoc94;
	Eq_861 tLoc20;
	Eq_862 tLoc10;
	Eq_12 cl_12 = dwArg04->b0000;
	lstrcpyA(&tLoc94, 0x004066DC);
	Eq_2 dwLoc0C_137 = 0x01;
	int32 dwLoc18_142 = 0x00;
	do
	{
		byte cl_26 = Mem23[dwArg04 + dwLoc0C_137:byte];
		&dwLoc0C_137.u0->a0000->b0000 = (word32) dwLoc0C_137 + 1;
		if ((word32) cl_26 == (word32) cl_12)
		{
			if ((word32) dwArg04[((word32) dwLoc0C_137 + 1) / 4] == 0x00)
			{
				&((word32) dwArg08 + dwLoc18_142)->u0->a0000->b0000 = cl_12;
				++dwLoc18_142;
				&dwLoc0C_137.u0->a0000->b0000 = (word32) dwLoc0C_137 + 2;
			}
			else
			{
				int32 eax_67 = fn00401A10(&tLoc10, dwArg04 + ((word32) dwLoc0C_137 + 1) / 4) + ((word32) dwLoc0C_137 + 1);
				dwLoc0C_137 = fn00401A10(&tLoc20, dwArg04 + eax_67 / 4) + eax_67;
				up32 dwLoc1C_157;
				for (dwLoc1C_157 = 0x00; dwLoc1C_157 < tLoc10; ++dwLoc1C_157)
				{
					*((word32) dwArg08 + dwLoc18_142) = *((word32) dwArg08 + (dwLoc18_142 - tLoc20));
					++dwLoc18_142;
				}
			}
		}
		else
		{
			&((word32) dwArg08 + dwLoc18_142)->u0->a0000->b0000 = cl_26;
			++dwLoc18_142;
		}
	} while (dwLoc0C_137 < dwArg0C);
}

// 00401A10: Register word32 fn00401A10(Stack (ptr32 ui32) dwArg04, Stack (ptr32 byte) dwArg08)
// Called from:
//      fn004018F0
word32 fn00401A10(ui32 * dwArg04, byte * dwArg08)
{
	Eq_26 tLoc84;
	lstrcpyA(&tLoc84, 0x004066D0);
	ui32 dwLoc08_52 = 0x00;
	word32 dwLoc10_53 = 0x00;
	do
	{
		ui32 edx_22 = (word32) *dwArg08;
		ui32 edx_32 = edx_22 & 0x7F | dwLoc08_52 << 0x07;
		++dwArg08;
		dwLoc08_52 = edx_32;
		++dwLoc10_53;
	} while ((edx_22 & 0x80) != 0x00);
	*dwArg04 = edx_32;
	return dwLoc10_53;
}

word32 g_dw401ABC = 6900; // 00401ABC
word32 g_dw401AC0 = 0x1B02; // 00401AC0
word32 g_dw401AC4 = 6926; // 00401AC4
word32 g_dw401AC8 = 0x1B26; // 00401AC8
word32 g_dw401ACC = 0x1B3A; // 00401ACC
word32 g_dw401AD0 = 6988; // 00401AD0
word32 g_dw401AD4 = 7002; // 00401AD4
word32 g_dw401AD8 = 0x1B6A; // 00401AD8
word32 g_dw401ADC = 0x1B7C; // 00401ADC
word32 g_dw401AE0 = 7050; // 00401AE0
word32 g_dw401AE4 = 0x1B9C; // 00401AE4
word32 g_dw401AEC = 0x1BB6; // 00401AEC
