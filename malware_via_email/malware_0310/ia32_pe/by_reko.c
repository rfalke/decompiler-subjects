// subject_text.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

<anonymous> * __imp__RegCreateKeyW = &g_t1408; // 00401000
<anonymous> * __imp__ExtTextOutW = &g_t13F0; // 00401008
<anonymous> * __imp__CreateEventW = &g_t13B2; // 00401010
<anonymous> * __imp__DsGetDcOpenW = &g_t1394; // 00401018
<anonymous> * __imp__ShellAboutW = &g_t1426; // 00401020
<anonymous> * __imp__MapVirtualKeyExW = &g_t13D0; // 00401028
<anonymous> * __imp__WS2_32.dll_18 = &g_t80000012; // 00401030
// 00401040: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	struct Eq_3 * fp;
	Eq_4 dwLoc20;
	word32 dwLoc14;
	ptr32 edi_19;
	ui32 edx_20 = fn00401160(out edi_19);
	(fp->aFFFD1D0E + 94553 - edx_20)->dw0040 = edx_20;
	struct Eq_19 * eax_35 = (edx_20 << 0x08) + ~0x02A2C1BF & 0x02E1D200 - (edx_20 << 0x08);
	Mem44[fp + ~0x0002E2E5 + dwLoc20:word32] = (eax_35 + 0xF474D84C)[edx_20 * 0x0400] - 0x28;
	ptr32 eax_48 = (char *) &((eax_35 + (&(eax_35->aF474D84C)->dw0000 + (edx_20 << 0x0A))[-1])->aF474D84C + 0x0002E382)->dw0000 + 686 - dwLoc20;
	fn00401280();
	fn004011B0(Mem71[fp + ~0x0002E2F1 + dwLoc20:word32], edi_19);
	struct Eq_63 * esp_97;
	(*((word32) dwLoc20 + 0x003D2E2E))();
	esp_97->dwFFFFFFFC = 0x00;
	<anonymous> * v18_107 = eax_48 + 0x0002E302 - dwLoc20;
	esp_97->dwFFFFFFF8 = (char *) v18_107 + 0x0BCA;
	struct Eq_79 * esp_116;
	v18_107();
	int3();
	int3();
	int3();
	int3();
	int3();
	int3();
	int3();
	esp_116->ptrFFFFFFFC = fp - 4;
	int32 edx_127 = esp_116->dw000C;
	int32 ecx_129 = ((char *) (esp_116->aFFF474BC + 141854) + 2)[edx_127];
	ui32 * ebx_132 = esp_116->aFFF474BC[edx_127];
	esp_116->dwFFFFFFF0 = 458636274;
	esp_116->dwFFFFFFF4 = esp_116->dwFFFFFFF0;
	ui32 edx_136 = (edx_127 << 0x02) + (edx_127 << 0x02) * 0x02;
	esp_116->dwFFFFFFF4 -= edx_136;
	esp_116->dwFFFFFFF8 = 0x01;
	DWORD eax_137 = edx_136 + 315293526;
	while (true)
	{
		*ebx_132 = *ebx_132 ^ eax_137;
		ecx_129 -= 0x04;
		if (ecx_129 <= 0x00)
			break;
		eax_137 = (word32) eax_137 + esp_116->dwFFFFFFF4 + esp_116->dwFFFFFFF8;
		ebx_132 = (char *) ebx_132 + 0x0002E2D6 - esp_116->dw000C;
		esp_116->dwFFFFFFF8 = -esp_116->dwFFFFFFF8;
	}
	return eax_137;
}

// 00401160: Register word32 fn00401160(Register out ptr32 ediOut)
// Called from:
//      Win32CrtStartup
word32 fn00401160(ptr32 & ediOut)
{
	struct Eq_179 * edi_9;
	word32 eax_8 = fn00401260(&Eq_281::t0017, out edi_9);
	<anonymous> * eax_22 = eax_8 + 0x02 + CreateEventW;
	eax_22();
	ui32 edx_38 = edi_9->dw0BF4;
	ediOut = edi_9 - (edx_38 - 3221036422);
	return edx_38 - 3221036422;
}

// 004011B0: void fn004011B0(Register int32 ecx, Register ptr32 edi)
// Called from:
//      Win32CrtStartup
void fn004011B0(int32 ecx, ptr32 edi)
{
	<anonymous> * eax_7 = fn004011E0(fn004011C0(ecx, edi), ecx);
	eax_7();
}

// 004011C0: Register word32 fn004011C0(Register int32 ecx, Register ptr32 edi)
// Called from:
//      fn004011B0
word32 fn004011C0(int32 ecx, ptr32 edi)
{
	return *((word32) **((word32) *((word32) *((word32) (edi + 48) + ecx) + 0x0C) + 28) + 8);
}

// 004011E0: Register Eq_209 fn004011E0(Register Eq_209 eax, Register int32 ecx)
// Called from:
//      fn004011B0
Eq_209 fn004011E0(Eq_209 eax, int32 ecx)
{
	ptr32 fp;
	word32 dwLoc08;
	struct Eq_236 * esi_22 = (word32) eax + *((word32) ((word32) eax + *(((word32) eax + ((ecx << 0x01) + ~0x0002E295)) - ecx)) + 0x0078);
	int32 esi_25[] = (word32) eax + esi_22->dw0020;
	ptr32 edi_28 = (word32) eax + esi_22->dw001C;
	*(fp + 0x0002E2CA - ecx) = 0x56035735 - ecx;
	int32 dwLoc0C_65 = 0x00;
	while (dwLoc08 != (((word32) eax + esi_25[dwLoc0C_65 / 4]) + ~0x0002E2C5)[ecx / 4])
		dwLoc0C_65 += 0x04;
	return (word32) eax + *((word32) edi_28 + dwLoc0C_65);
}

// 00401260: Register word32 fn00401260(Stack (memptr (ptr16 Eq_281) Eq_183) dwArg04, Register out ptr32 ediOut)
// Called from:
//      fn00401160
word32 fn00401260(struct Eq_183 Eq_281::* dwArg04, ptr32 & ediOut)
{
	struct Eq_281 * fs;
	ediOut = (fs->*dwArg04).ptr0001;
	return ~0x01;
}

// 00401280: void fn00401280()
// Called from:
//      Win32CrtStartup
void fn00401280()
{
}

word32 g_dw401350 = 0x1408; // 00401350
word32 g_dw401358 = 0x13F0; // 00401358
word32 g_dw401360 = 0x13B2; // 00401360
word32 g_dw401368 = 0x1394; // 00401368
word32 g_dw401370 = 5158; // 00401370
word32 g_dw401378 = 0x13D0; // 00401378
word32 g_dw401380 = 0x80000012; // 00401380
