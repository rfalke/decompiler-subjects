/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall sub_403AA1(unsigned int@<eax>, signed int _EDX@<edx>, __int16@<bx>, _DWORD *@<edi>);


//----- (00403AA1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_403AA1(unsigned int a1@<eax>, signed int _EDX@<edx>, __int16 a3@<bx>, _DWORD *a4@<edi>)
{
  int v4; // ecx
  _DWORD *v12; // edi
  int savedregs; // [esp+0h] [ebp+0h]

  LOBYTE(v4) = savedregs;
  *a4 ^= 0x348B9732u;
  _CF = 0;
  if ( ((unsigned __int8)savedregs & HIBYTE(a3)) == 0 )
  {
    a3 = 11842;
    if ( __SETP__(savedregs, 0) )
    {
      v4 = __ROL4__(savedregs, 240);
      _CF = v4 != 0;
      a3 = -11843;
      LOBYTE(v4) = v4 + 1;
      a1 += 2;
    }
  }
  v4 = (char)v4;
  _OF = __OFADD__(_CF, (char)v4);
  LOWORD(_ECX) = _CF + (char)v4;
  _OF |= __OFADD__(a3, (_WORD)_ECX);
  LOWORD(_ECX) = a3 + _ECX;
  if ( ((_ECX & 0x8000u) != 0) ^ _OF | ((_WORD)_ECX == 0) )
    _ECX = _EDX;
  if ( is_mul_ok(_ECX, a1) )
    __asm { repne dec ecx }
  if ( !_PF )
    __asm { fmul    st(4), st }
  v12 = a4 + 1;
  __asm
  {
    fadd    st(7), st
    fmul    st(1), st
  }
  if ( (int)v12 >= _EDX )
  {
    __asm
    {
      repne fsubr st(1), st
      insb
    }
    --MEMORY[0x6D941333];
    JUMPOUT(0xE35E934B);
  }
  sub_403AA1(0x37B1AFA8u, _EDX, 57631, v12);
  MEMORY[0xF2016B13]();
  JUMPOUT(0x403A86);
}
// 403A7C: positive sp value 4 has been found
// 403B03: inconsistent fpu stack
// 403A81: control flows out of bounds to 403A86
// 403BA2: control flows out of bounds to E35E934B
// 403AA9: variable 'savedregs' is possibly undefined
// 403B01: variable '_PF' is possibly undefined

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
