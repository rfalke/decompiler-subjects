/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// char __usercall start@<al>(int@<eax>, int@<edx>, int@<ebx>, int@<edi>, int@<esi>);
// char __usercall sub_401E32@<al>(int@<eax>, char@<ch>, char@<bh>);


//----- (00401095) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
char __usercall start@<al>(int a1@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<edi>, int a5@<esi>)
{
  unsigned int v5; // edi
  int v6; // edi
  int v7; // esi
  __int16 v8; // ax
  int v9; // edi
  int v10; // ebx
  unsigned int v11; // edi
  int v12; // esi
  int v13; // edi
  unsigned int v14; // edx
  int v15; // ebx
  int v16; // edi
  unsigned int v17; // ebx
  int v18; // ebx
  int v19; // ecx
  int v20; // ecx
  int v23; // ecx
  unsigned int v24; // ecx
  int v25; // edi
  int v26; // edi
  int v27; // esi
  unsigned int v28; // ecx
  int v29; // esi
  int v30; // ebx
  int v31; // edi
  int v34; // esi
  int v39; // esi
  int v42; // ebx
  bool v43; // cf
  _BYTE *v47; // esi
  int v50; // eax
  int v51; // et2
  int v52; // ecx
  _DWORD v60[8]; // [esp-28h] [ebp-2Ch] BYREF
  char v61; // [esp-6h] [ebp-Ah]
  int savedregs; // [esp+4h] [ebp+0h] BYREF
  void *retaddr; // [esp+8h] [ebp+4h]

  v14 = a4 + a2;
  v15 = a4 + a3;
  v16 = a1 ^ a4;
  v28 = v14;
  v29 = v16 + a5 - a1;
  v30 = a1 + v15;
  v31 = a1 + (v14 ^ (v16 - 1)) - 1;
  HIWORD(v14) = HIWORD(a1);
  v9 = a1 ^ ((v30 ^ (v31 - 1)) - 1);
  v28 += 2;
  v10 = (a1 + v29 - 2) ^ v30;
  LOBYTE(v10) = BYTE1(a1) | v10;
  BYTE1(v28) = -54;
  --v10;
  ++v28;
  BYTE1(v10) = ~(v10 + BYTE1(v10) + 1);
  v12 = v10;
  v13 = v28 | v9;
  BYTE1(v28) = a1;
  --BYTE1(v10);
  v17 = v28 + v10;
  LOBYTE(v17) = -(char)v17;
  LOBYTE(v28) = v17 ^ v28;
  BYTE1(v17) = (BYTE1(v17) < BYTE1(a1)) + BYTE1(v17) - BYTE1(a1) - 117;
  LOBYTE(v17) = ~((BYTE1(a1) | 0xCA) - 1 + 43) ^ v17;
  v18 = v13 ^ v17;
  LOBYTE(v28) = ~(_BYTE)v28;
  BYTE1(v14) = v28 - 1;
  BYTE1(v28) = 61 - a1;
  LOBYTE(v14) = -19;
  LOBYTE(v28) = BYTE1(v18) | v28;
  ++v18;
  __asm { fnclex }
  BYTE1(v18) = 54;
  LOBYTE(v18) = v18 - (BYTE1(v14) - 1);
  ++v28;
  BYTE1(v28) -= 54;
  v24 = v28 - v18;
  BYTE1(v14) = 103;
  LOBYTE(v18) = 54;
  LOBYTE(v24) = BYTE1(v24) + v24;
  v6 = (v14 | (v13 - a1)) - 1;
  v7 = v24 ^ v12;
  LOBYTE(v24) = v24 + 97;
  BYTE1(v24) = BYTE1(a1);
  HIWORD(v60[0]) = HIWORD(a1);
  v8 = v14;
  BYTE1(v14) = BYTE1(v24) ^ 0x67;
  __asm { smsw    [esp+4+var_4] }
  v5 = (v24 | v6) - 2;
  LOBYTE(v24) = ((unsigned __int16)(v8 + 1) >> 8) - 52;
  LOBYTE(v14) = -124;
  --v14;
  _EBX = (_WORD *)(v7 + 1 + v18);
  v43 = v5 < v14;
  v11 = v5 - v14;
  _EAX = ~v60[0];
  BYTE1(v24) = 34 - ((__CFADD__(v43, BYTE1(_EBX)) | __CFADD__(v43 + BYTE1(_EBX), -71)) - 86) + 1;
  LOBYTE(_EBX) = (_BYTE)_EBX - 1;
  v23 = v14 | v24;
  if ( (~LOBYTE(v60[0]) & 8) != 0 )
  {
    v19 = v23 - 1;
    BYTE1(_EBX) = v19;
    BYTE1(v19) |= (unsigned __int8)_EBX;
    v20 = v19 + v60[0] + 1;
    v25 = _EAX + v11 - 1;
    BYTE1(_EAX) -= 97;
    v26 = _EAX + v25;
    LOBYTE(_EBX) = ~(BYTE1(_EAX) ^ (unsigned __int8)_EBX);
    BYTE1(_EAX) = -BYTE1(_EAX);
    v27 = v26 ^ v20;
    LOBYTE(_EAX) = -LOBYTE(v60[0]) - 94;
    LOBYTE(_EAX) = sub_401E32(_EAX, (unsigned __int16)(v26 ^ v20) >> 8, SBYTE1(_EBX));
    v34 = v27 + 1;
    LOBYTE(_DX) = _DX - *(_BYTE *)(2 * _ECX + 0x62);
    __asm { arpl    [ebx+1Ah], sp }
    _EBX[13] = _T0;
    __asm { aas }
    if ( _ECX )
    {
      v60[0] = v34;
      v39 = v34 + 1;
      _EAX = __indword(_DX);
      __asm { aas }
      v42 = v60[0];
      __asm { arpl    ss:[ecx], dx }
      v43 = *(_BYTE *)(v42 - 1083926007) < HIBYTE(_DX);
      if ( *(_BYTE *)(v42 - 1083926007) < HIBYTE(_DX) )
      {
        __asm { arpl    [ebx+56h], sp }
        *(_WORD *)(v42 + 86) = _T0;
        v60[0] = v39;
        if ( !v43 && v39 != -1 )
          JUMPOUT(0x4011D5);
        JUMPOUT(0x120D);
      }
LABEL_9:
      JUMPOUT(0x401212);
    }
    __asm { arpl    bx, ax }
    _enable();
    v47 = (_BYTE *)(v34 - 1);
    __asm { arpl    [ebx-41h], sp }
    *(_WORD *)((char *)_EBX - 65) = _T0;
    MEMORY[0x6363463A] = *v47;
    __asm { arpl    [ebx+26h], sp }
    _EBX[19] = _T0;
    v60[0] = v47 + 1;
    __asm { bound   esp, [ebx+65h] }
    BYTE2(retaddr) -= _ECX;
    v51 = _EAX;
    v50 = (unsigned __int8)_ECX;
    v61 -= v51;
    BYTE1(_EBX) = 62;
    v52 = v51 - 1;
    if ( v47[1344969596] != (_BYTE)v51 || !v52 )
    {
      __asm { arpl    [ebx-17h], sp }
      *(_WORD *)((char *)_EBX - 23) = _T0;
      __indword(_DX);
      goto LABEL_9;
    }
    v60[0] = v52;
    MEMORY[0x93513025] = v50;
    _EAX = *(_DWORD *)(v52 + 8 * (_DWORD)&savedregs - 27);
    __DS__ = *(_WORD *)(v52 + 8 * (_DWORD)&savedregs - 27 + 4);
    __outdword(_DX, _EAX);
    __asm { bound   esp, [ebx+63h] }
    __DS__ = MEMORY[0x2688E115];
    __asm
    {
      xlat
      arpl    [ebx+63h], sp
    }
    *(_WORD *)((char *)_EBX + 99) = _T0;
    __asm { arpl    [ebx+65h], sp }
    *(_WORD *)((char *)_EBX + 101) = _T0;
    LOBYTE(_EBX) = (_BYTE)_EBX - *(_BYTE *)(_EAX + 10);
    __asm { arpl    [ebx-66h], sp }
    *(_EBX - 51) = _T0;
  }
  return _EAX;
}
// 4012A1: positive sp value 28 has been found
// 4011D2: control flows out of bounds to 4011D5
// 40120D: control flows out of bounds to 401212
// 4011D2: control flows out of bounds to 120D
// 40125E: conditional instruction was optimized away because ecx.4!=0
// 401188: variable '_DX' is possibly undefined
// 401188: variable '_ECX' is possibly undefined

//----- (00401E32) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
char __usercall sub_401E32@<al>(int a1@<eax>, char a2@<ch>, char a3@<bh>)
{
  unsigned int v4; // ecx
  int v5; // eax
  unsigned int v6; // ecx
  int v7; // eax
  bool v8; // cf
  unsigned int v9; // ecx
  int v10; // ebx
  int v11; // ecx
  int v12; // ebx
  int v13; // ecx
  unsigned int v14; // ebx
  int v15; // eax
  int v16; // ecx
  unsigned int v17; // ebx
  int v18; // eax
  unsigned int v19; // esi
  int v20; // ebx
  int v21; // ecx
  char v22; // al
  unsigned int v23; // ecx
  unsigned int v24; // ecx
  unsigned int v25; // edx
  unsigned int v26; // [esp-4h] [ebp-4h]
  unsigned int v27; // [esp-4h] [ebp-4h]

  ++BYTE1(a1);
  v18 = a1 - 1;
  BYTE1(v18) += v18;
  LOBYTE(v18) = (__CFADD__((unsigned __int8)-a3 < BYTE1(v27), a2) | __CFADD__(
                                                                      ((unsigned __int8)-a3 < BYTE1(v27)) + a2,
                                                                      -12))
              + v18
              + 87;
  v15 = v27 | v18;
  v16 = v15;
  LOBYTE(v15) = v15 - ((v27 < 0xFFFFFC1C) - 48);
  v12 = v15;
  BYTE1(v16) = 40;
  BYTE1(v12) = -2;
  v26 = v27 + 996;
  v13 = v12 | v16;
  v14 = v26;
  v25 = v26 - 996;
  BYTE1(v13) = __CFADD__(v26, -996) + 22 - BYTE1(v13);
  BYTE1(v14) = ((unsigned __int16)(v26 - 996) >> 8) | BYTE1(v26);
  v17 = v14 - v13;
  v21 = (v26 - 996) ^ v13;
  BYTE1(v17) = -BYTE1(v17) - 112;
  v19 = 2984;
  v20 = v21 ^ v17;
  LOBYTE(v21) = v21 + 86;
  v22 = v26 + 29;
  v10 = v20 - 2984;
  do
  {
    v11 = v21 - v25;
    BYTE1(v11) = -(char)(BYTE1(v11) - (v22 - v10 + BYTE1(v10)) - ((v22 != (char)v10) + 12) + 1);
    v4 = v11 - v25;
    BYTE1(v10) = *(_BYTE *)v25 - 99;
    --BYTE1(v4);
    LOBYTE(v4) = -(char)v4;
    v5 = v10 | v4;
    BYTE1(v10) = __ROL1__(BYTE1(v10), 6);
    v6 = v5;
    LOBYTE(v6) = v5 - 1;
    v7 = v10 ^ v5;
    ++BYTE1(v6);
    v8 = v6 < v19;
    v9 = v6 - v19;
    BYTE1(v10) = -BYTE1(v10);
    LOBYTE(v7) = 42 - v10;
    BYTE1(v7) = v8 + BYTE1(v7) + 92 - v25;
    ++v7;
    LOBYTE(v9) = v25 + v9 - (__CFADD__((_BYTE)v25, (_BYTE)v9) - 66);
    --v9;
    --BYTE1(v9);
    v23 = v7 + v9;
    *(_BYTE *)v25 = BYTE1(v10);
    LOBYTE(v7) = v7 - v25 + 1;
    BYTE1(v23) = -17;
    LOBYTE(v23) = v23 - (((unsigned __int8)(__CFADD__((_BYTE)v7, 57) - 25) > 0xC4u) - 80);
    ++v25;
    v24 = v23 - v10;
    --v19;
    LOBYTE(v7) = __CFADD__((_BYTE)v7, 57) - 25 + 60 - BYTE1(v24);
    BYTE1(v24) += BYTE1(v10);
    LOBYTE(v24) = v7 - 1 - v10 - 25;
    v21 = v25 ^ v24;
    BYTE1(v21) = -68;
    v22 = BYTE1(v25) - 125;
    LOBYTE(v21) = BYTE1(v10) + v21 - 81;
  }
  while ( v19 );
  return __CFADD__(v21, v25 + 874731329) + v22 - 23;
}
// 401DB9: positive sp value 4 has been found
// 401DDA: variable 'v27' is possibly undefined

// nfuncs=2 queued=2 decompiled=2 lumina nreq=0 worse=0 better=0
// ALL OK, 2 function(s) have been successfully decompiled
