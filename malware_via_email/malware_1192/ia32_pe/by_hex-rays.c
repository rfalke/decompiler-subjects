/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

HFILE start();

//-------------------------------------------------------------------------
// Data declarations

__int16 word_40102E = 4; // weak
char byte_401093 = 'ê'; // weak
// extern HFILE (__stdcall *OpenFile_1)(LPCSTR lpFileName, LPOFSTRUCT lpReOpenBuff, UINT uStyle);


//----- (004011D3) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
HFILE start()
{
  __int16 v1; // sp
  _DWORD **v2; // edx
  _DWORD *v3; // esi
  LPOFSTRUCT v4; // ecx
  __int16 *v5; // eax
  int v6; // edi
  _DWORD v7[2]; // [esp-10h] [ebp-10h] BYREF
  LPOFSTRUCT v8; // [esp-8h] [ebp-8h]
  UINT v9; // [esp-4h] [ebp-4h]

  if ( *(WORD *)((char *)&v8->Reserved2 + 1) == 0x9090 )
  {
    HIWORD(v2) = 18;
    LOWORD(v2) = v1;
    v3 = *v2;
    do
    {
      v3 = (_DWORD *)((char *)v3 + 1);
      LOWORD(v2) = (_WORD)v2 - 13597;
    }
    while ( *v3 != *(_DWORD *)(&byte_401093 + 83) );
    v4 = v8;
    v5 = &word_40102E;
    do
    {
      v6 = *(_DWORD *)&v4->cBytes;
      v4 = (LPOFSTRUCT)((char *)v4 + 1);
      v5 = (__int16 *)((char *)v5 - 1);
    }
    while ( *((_DWORD *)&word_40102E + 2) != v6 );
    v7[1] = *((unsigned __int16 *)v3 - 1) + 4177183;
    v7[0] = NtCurrentTeb()->NtTib.ExceptionList;
    __writefsdword(0, (unsigned int)v7);
    __asm { retn }
  }
  return OpenFile_1((LPCSTR)0xAB65A304, v8, v9);
}
// 401206: positive sp value 8 has been found
// 40130A: unbalanced stack, ignored a potential tail call
// 401232: variable 'v1' is possibly undefined
// 40102E: using guessed type __int16 word_40102E;
// 401093: using guessed type char byte_401093;

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
