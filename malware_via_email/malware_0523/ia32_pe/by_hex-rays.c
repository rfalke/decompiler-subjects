/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

int sub_4010D9(void); // weak
// void __usercall start(int a1@<eax>, int a2@<edx>, _DWORD *a3@<ecx>, int a4@<ebx>);
void __fastcall sub_401F36(int a1, __int32 a2);
// void __userpurge sub_401FB1(int a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
// double __userpurge sub_401FDD@<st0>(__int16 *a1@<ebx>, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
// void __usercall sub_402029(int a1@<esi>);
_DWORD __far sub_402162(); // weak
// void __usercall sub_40217F(int (__fastcall *a1)(__int32, int)@<eax>, __int16 a2@<dx>, char a3@<bh>, int a4@<ebp>, __int16 a5@<di>, __int32 a6@<esi>);
// unsigned int __userpurge sub_40238B@<eax>(int a1@<edx>, int a2@<ecx>, char a3@<bl>, int a4@<edi>, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
void sub_402411();
// __int64 __usercall sub_4024A0@<edx:eax>(char a1@<dl>, char a2@<bl>, __int32 a3@<esi>);
void __thiscall __noreturn sub_4024CD(void *this);
// void __usercall sub_402563(__int32 a1@<esi>);
void sub_4026E1();
// void __usercall __noreturn sub_4027CB(int a1@<eax>);
// int __userpurge sub_4027ED@<eax>(int a1@<edx>, _DWORD *a2@<ebx>, int a3@<edi>, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
_DWORD __far sub_4028E3(); // weak
void sub_402A2A();
// void __userpurge sub_402A86(int a1@<eax>, int a2@<edi>, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63);
// void __usercall sub_402B9C(int (__fastcall *a1)(__int32, int)@<eax>, int a2@<edx>, __int16 a3@<di>, __int32 a4@<esi>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_40117F; // weak
_UNKNOWN loc_401EC4; // weak
_UNKNOWN sub_4020E0; // weak
_UNKNOWN sub_402607; // weak
_UNKNOWN loc_40276E; // weak
_UNKNOWN sub_40280D; // weak
char byte_402A6D[3] = { '\x8D', 'd', '$' }; // weak
_UNKNOWN loc_402D80; // weak


//----- (004010D9) --------------------------------------------------------
#error "4010DC: cannot convert to microcode (funcsize=2)"

//----- (0040112E) --------------------------------------------------------
void __usercall start(int a1@<eax>, int a2@<edx>, _DWORD *a3@<ecx>, int a4@<ebx>)
{
  int v4; // edx
  int v5; // ebx
  int v6; // esi
  _DWORD *v7; // edx
  _DWORD *v8; // edi
  _DWORD *v9; // esi
  int v10; // ebx
  int v11; // esi
  int v12; // edx
  int v13; // ebx
  _DWORD *i; // esi

  v12 = a2 - a1 - a4;
  v13 = v12 ^ a4;
  for ( i = a3; ; i = v9 + 1 )
  {
    v10 = v12 | (v13 + 1);
    v11 = (v12 | a1 | ((unsigned int)i + 1)) - 1;
    v4 = v11 | (v12 + 1);
    v5 = v4 + a1 + v10;
    v6 = v11 - 1 - (_DWORD)a3;
    v7 = (_DWORD *)(1 - (a1 ^ (v4 | a1)) - v6);
    v8 = v7;
    LOBYTE(v5) = BYTE1(a3) | v5;
    v9 = (_DWORD *)(v6 - (_DWORD)a3);
    v13 = v5 - 1;
    BYTE1(v7) = (_BYTE)a3;
    a1 = ((int (__fastcall *)(_DWORD *, _DWORD *))((char *)&loc_40117F + 4))(a3, v7);
    LOBYTE(v13) = BYTE1(v12) ^ v13;
    __asm { icebp }
    *v8 = *v9;
  }
}
// 4010B9: variable 'v12' is possibly undefined
// 40109D: variable 'a3' is possibly undefined
// 4010D9: using guessed type int sub_4010D9(void);

//----- (00401F36) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall sub_401F36(int a1, __int32 a2)
{
  unsigned int v2; // eax
  __int32 v3; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v3, a2);
  v2 = ((int (__fastcall *)(int, __int32))loc_40276E)(a1, v3);
  LOBYTE(v2) = v2 ^ 0x73;
  __outdword(0xE9u, v2);
  JUMPOUT(0x401F4F);
}
// 401F3C: positive sp value 4 has been found
// 401F4D: control flows out of bounds to 401F4F

//----- (00401FB1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __userpurge sub_401FB1(int a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  JUMPOUT(0x402B0B);
}
// 401FB5: positive sp value 4 has been found
// 401FC7: control flows out of bounds to 402B0B
// 401FB1: too many input arguments, some ignored

//----- (00401FDD) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
double __userpurge sub_401FDD@<st0>(__int16 *a1@<ebx>, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  double v64; // st7
  char v65; // sf
  char v66; // of

  v64 = ((double (*)(void))sub_402607)();
  if ( v65 != v66 )
    JUMPOUT(0x401FAB);
  return (double)*a1 - v64;
}
// 401FF1: positive sp value DDFA has been found
// 401FF1: control flows out of bounds to 401FAB
// 401FEC: bad sp value at call
// 401FF1: variable 'v65' is possibly undefined
// 401FF1: variable 'v66' is possibly undefined
// 401FDD: too many input arguments, some ignored

//----- (00402029) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402029(int a1@<esi>)
{
  unsigned __int8 v1; // al
  unsigned __int16 v2; // dx

  v1 = (*(int (**)(void))byte_402A6D)();
  _ESI = a1 + 4;
  __outbyte(v2, v1);
  __asm { outsb }
  JUMPOUT(0x402046);
}
// 40202D: positive sp value 4 has been found
// 402045: control flows out of bounds to 402046
// 402041: variable 'v2' is possibly undefined

//----- (004020E0) --------------------------------------------------------
#error "402115: cannot convert to microcode (funcsize=21)"

//----- (00402162) --------------------------------------------------------
#error "402162: function frame is wrong (funcsize=0)"

//----- (0040217F) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_40217F(int (__fastcall *a1)(__int32, int)@<eax>, __int16 a2@<dx>, char a3@<bh>, int a4@<ebp>, __int16 a5@<di>, __int32 a6@<esi>)
{
  int v6; // esi
  char v8; // dh
  __int16 v9; // dx
  unsigned __int8 v10; // al
  __int32 v11; // [esp-8h] [ebp-8h] BYREF
  char v12; // [esp-4h] [ebp-4h]
  char v13; // [esp-3h] [ebp-3h]

  _InterlockedExchange(&v11, a6);
  HIBYTE(a2) = BYTE1(a1);
  v6 = v11 + 1;
  sub_402B9C(a1, a2, a5, v11 + 1);
  _ESI = (a4 ^ v6) + 1;
  __asm { outsb }
  HIBYTE(v9) = v12 | v8;
  LOBYTE(v9) = -(HIBYTE(a5) | a3);
  if ( !__OFADD__((unsigned __int16)(v9 - 1) >> 8, v13) && __OFADD__((unsigned __int16)(v9 - 1) >> 8, v13) )
  {
    v10 = __inbyte(a5);
    JUMPOUT(0x402469);
  }
  JUMPOUT(0x4024E5);
}
// 40219E: positive sp value 8 has been found
// 40240C: control flows out of bounds to 40240E
// 402468: control flows out of bounds to 402469
// 4026A9: control flows out of bounds to 4026AD
// 402C50: control flows out of bounds to 402C51
// 40245E: control flows out of bounds to 4024E5
// 4021A6: variable 'v8' is possibly undefined

//----- (0040238B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
unsigned int __userpurge sub_40238B@<eax>(int a1@<edx>, int a2@<ecx>, char a3@<bl>, int a4@<edi>, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  int v64; // edx
  unsigned int result; // eax
  unsigned __int16 v66; // dx
  void *v67; // [esp+Ch] [ebp-4h]
  void *retaddr; // [esp+10h] [ebp+0h]

  *(&retaddr - 5) = v67;
  BYTE1(a1) ^= a3;
  v64 = a4 | a1;
  BYTE1(v64) += 24;
  --v64;
  LOBYTE(v64) = BYTE1(a4) | v64;
  result = ((int (__fastcall *)(int, int))loc_402D80)(a2, v64);
  __outdword(v66, result);
  return result;
}
// 40238F: positive sp value 4 has been found
// 4023A1: variable 'v66' is possibly undefined
// 40238B: too many input arguments, some ignored

//----- (00402411) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402411()
{
  unsigned __int8 v0; // al
  int v2; // [esp+24h] [ebp-8h]
  int v3; // [esp+28h] [ebp-4h]

  *(&v3 - 12) = v2;
  sub_402A2A();
  v0 = __inbyte(0x46u);
  __asm { lock mov bl, 51h ; 'Q' }
  JUMPOUT(0x4021C7);
}
// 401F62: positive sp value 8 has been found
// 401F89: control flows out of bounds to 401F8E
// 4022F4: control flows out of bounds to 4022F7
// 40231F: control flows out of bounds to 402321
// 402447: control flows out of bounds to 402448
// 402954: control flows out of bounds to 4021C7
// 4022E3: control flows out of bounds to 4020EB
// 401F81: conditional instruction was optimized away because of 'bh.1!=0'

//----- (004024A0) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
__int64 __usercall sub_4024A0@<edx:eax>(char a1@<dl>, char a2@<bl>, __int32 a3@<esi>)
{
  __int64 result; // rax
  __int32 v4; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v4, a3);
  BYTE4(result) = a2 | a1;
  return result;
}
// 4024AA: positive sp value 4 has been found

//----- (004024CD) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __thiscall __noreturn sub_4024CD(void *this)
{
  sub_4027CB((int)this);
}
// 4024FB: positive sp value D8F6 has been found

//----- (00402563) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402563(__int32 a1@<esi>)
{
  __int32 v2; // [esp-4h] [ebp-4h] BYREF

  _InterlockedExchange(&v2, a1);
  __asm { rep pop esi }
  JUMPOUT(0x40268F);
}
// 402569: positive sp value 4 has been found
// 402576: control flows out of bounds to 40268F

//----- (00402607) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __userpurge sub_402607(int a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  __asm { repne pop ecx }
  JUMPOUT(0x402AD0);
}
// 40260E: positive sp value 4 has been found
// 40261B: control flows out of bounds to 402AD0
// 402607: too many input arguments, some ignored

//----- (004026E1) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4026E1()
{
  void *v0; // [esp+1Ch] [ebp-4h]
  void *retaddr; // [esp+20h] [ebp+0h]

  *(&retaddr - 9) = v0;
  sub_402411();
  JUMPOUT(0x402704);
}
// 4026E5: positive sp value 4 has been found
// 402703: control flows out of bounds to 402704

//----- (004027CB) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall __noreturn sub_4027CB(int a1@<eax>)
{
  void *v1; // [esp+1Ch] [ebp-4h]
  void *retaddr; // [esp+20h] [ebp+0h]

  *(&retaddr - 9) = v1;
  sub_402029(*(_DWORD *)(a1 + 60) + a1);
  __halt();
}
// 4027CF: positive sp value 4 has been found

//----- (004027ED) --------------------------------------------------------
// bad sp value at call has been detected, the output may be wrong!
// positive sp value has been detected, the output may be wrong!
int __userpurge sub_4027ED@<eax>(int a1@<edx>, _DWORD *a2@<ebx>, int a3@<edi>, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  int v64; // edi
  char v65; // dl
  int v67; // [esp-126Ch] [ebp-1290h]
  int v68; // [esp-1268h] [ebp-128Ch]

  *(&v68 - 10) = v67;
  v64 = a3 - 1 - a1;
  ((void (__thiscall *)(int))sub_4020E0)(a1);
  *(_BYTE *)(v64 + 814025255) &= v65;
  *a2 += a2;
  return ((int (*)(void))sub_40280D)();
}
// 402805: positive sp value 1290 has been found
// 402800: bad sp value at call
// 40280C: bad sp value at call
// 402805: variable 'v65' is possibly undefined
// 4027ED: too many input arguments, some ignored

//----- (0040280D) --------------------------------------------------------
#error "402545: cannot convert to microcode (funcsize=60)"

//----- (004028E3) --------------------------------------------------------
#error "402921: cannot convert to microcode (funcsize=26)"

//----- (00402A2A) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_402A2A()
{
  JUMPOUT(0x402291);
}
// 402A2E: positive sp value 4 has been found
// 402D20: control flows out of bounds to 402291

//----- (00402A86) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __userpurge sub_402A86(int a1@<eax>, int a2@<edi>, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28, int a29, int a30, int a31, int a32, int a33, int a34, int a35, int a36, int a37, int a38, int a39, int a40, int a41, int a42, int a43, int a44, int a45, int a46, int a47, int a48, int a49, int a50, int a51, int a52, int a53, int a54, int a55, int a56, int a57, int a58, int a59, int a60, int a61, int a62, int a63)
{
  int v64; // edi
  int v67; // ebx
  int v70; // [esp-8h] [ebp-8h]

  _DX = (unsigned __int8)a1;
  v67 = a2 - 1;
  BYTE1(v67) = a1;
  LOBYTE(v67) = -127;
  if ( v67 + 1 < 0 == __OFADD__(1, v67) && v67 + 1 < 0 != __OFADD__(1, v67) )
  {
    __debugbreak();
    JUMPOUT(0x401FF7);
  }
  v64 = (a1 | a2) - a1 - 1 - BYTE1(a1);
  if ( BYTE1(a1) + v64 < 0 == __OFADD__(BYTE1(a1), v64) )
  {
    __asm { repne mov dx, dx }
    if ( BYTE1(a1) + v64 < 0 != __OFADD__(BYTE1(a1), v64) )
      __halt();
  }
  ((void (__stdcall *)(int))((char *)&loc_401EC4 + 3))(v70);
  __asm { aaa }
  JUMPOUT(0x402B3D);
}
// 402AE1: positive sp value C has been found
// 402B3C: control flows out of bounds to 402B3D
// 402AE1: control flows out of bounds to 402AE3
// 402B1B: control flows out of bounds to 401FF7
// 402B34: variable 'v70' is possibly undefined
// 402A86: too many input arguments, some ignored
// 402162: using guessed type _DWORD __far sub_402162();

//----- (00402B9C) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_402B9C(int (__fastcall *a1)(__int32, int)@<eax>, int a2@<edx>, __int16 a3@<di>, __int32 a4@<esi>)
{
  __int32 v4; // ecx
  void *v5; // eax
  __int16 v6; // dx
  char v7; // dl
  __int16 v8; // di
  __int32 v9; // [esp+0h] [ebp-4h] BYREF
  void *retaddr; // [esp+4h] [ebp+0h]

  _InterlockedExchange(&v9, a4);
  v8 = a2 | (a3 - 1);
  v4 = v9;
  LOBYTE(a2) = BYTE1(a2) + a2;
  BYTE1(v4) = -BYTE1(v9);
  v5 = (void *)a1(v4, a2);
  v7 = (v8 ^ v6) - ((unsigned __int16)(v8 ^ v6) >> 8);
  *(&retaddr - 2) = v5;
  if ( !__CFADD__((v7 - 1) | 0x5E, v7 - 1) && __CFADD__((v7 - 1) | 0x5E, v7 - 1) )
  {
    __asm { into }
    JUMPOUT(0x401E7C);
  }
  JUMPOUT(0x402487);
}
// 401E4F: positive sp value 4 has been found
// 401E7B: control flows out of bounds to 401E7C
// 402220: control flows out of bounds to 402226
// 401E62: control flows out of bounds to 402487
// 402220: conditional instruction was optimized away because of 'esi.4!=0'
// 402210: variable 'v6' is possibly undefined

// nfuncs=23 queued=23 decompiled=23 lumina nreq=0 worse=0 better=0
#error "There were 5 decompilation failure(s) on 23 function(s)"
