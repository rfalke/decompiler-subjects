/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// void __usercall start(int _EAX@<eax>, int@<edx>, int@<ecx>, int@<ebx>, int@<edi>, int@<esi>);
// void __usercall sub_4011CF(int@<eax>, double@<st0>);
void sub_40132B();
// void __usercall sub_4013D7(char@<cf>, int@<eax>, int@<edx>, int@<ecx>, int@<edi>);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_4010B4; // weak
_UNKNOWN loc_40110B; // weak


//----- (00401020) --------------------------------------------------------
void __usercall start(int _EAX@<eax>, int a2@<edx>, int a3@<ecx>, int a4@<ebx>, int a5@<edi>, int a6@<esi>)
{
  int v6; // esi
  int v7; // edx
  int v8; // edi
  int v9; // ebx
  int v10; // ecx
  int v11; // ecx
  int v12; // edi
  int v13; // ebx
  int v14; // ecx
  int v15; // ebx
  int v16; // edi
  int v17; // esi
  int v18; // edx
  __int16 v19; // t2
  int v20; // edx
  char v21; // tt
  char v22; // al
  int v23; // eax
  int v24; // edx
  int v25; // edi
  int v26; // esi
  char v27; // cf
  char v28; // cc
  int savedregs; // [esp+0h] [ebp+0h]

  v8 = a5 - 1;
  v9 = a4 - _EAX - a6;
  v10 = ((_EAX | a2) ^ (a3 - 1)) - 1;
  v26 = (a6 - v10) ^ v10;
  v27 = __CFADD__(v9, _EAX);
  v28 = (v9 + _EAX < 0) ^ __OFADD__(v9, _EAX) | (v9 + _EAX == 0);
  if ( !__OFADD__(v9, _EAX) && __OFADD__(v9, _EAX) )
  {
    __asm { aas }
    if ( v28 )
    {
      __indword(v9);
      *(_DWORD *)(v9 + 66204508) += v8 + v27;
      JUMPOUT(0x401439);
    }
    JUMPOUT(0x4013D9);
  }
  v11 = v8 + v9 - 1;
  v12 = v26 | v8;
  v13 = v9 + 1 - v12;
  v7 = v11 - v13;
  v6 = v12;
  ++v13;
  LOBYTE(v7) = BYTE1(v13) ^ v7;
  v14 = v13 + (v7 ^ v11) + 1;
  BYTE1(v14) = BYTE1(v13) + BYTE1(v14) - 1;
  LOBYTE(v13) = v13 - BYTE1(v13);
  LOBYTE(v14) = v13 + v14;
  v15 = v13 - v14;
  BYTE1(v15) |= v14;
  v16 = _EAX ^ (v12 - 1);
  v17 = v6 + 1;
  while ( 1 )
  {
    LOBYTE(v7) = BYTE1(v15);
    v20 = v7 - v15;
    v27 = __CFADD__((_BYTE)v14, (_BYTE)v20);
    LOBYTE(v20) = v14 + v20;
    v21 = v27;
    v27 = __CFADD__(v27, (_BYTE)v20);
    LOBYTE(v20) = v21 + v20;
    v27 |= __CFADD__((_BYTE)v20, 80);
    LOBYTE(v20) = ~(v20 + 80);
    sub_4013D7(v27, _EAX, v20, v15, v16);
    LOBYTE(v23) = v22 - (v27 + 36);
    v17 += 2;
    v25 = v23 - v24;
    v23 &= 0xEEEEEEEE;
    v18 = v23 | (v17 + v24);
    v15 = v18 | savedregs;
    v16 = v25 - (v18 | savedregs) - (v17 | v18);
    _EAX = ((int (__thiscall *)(int))loc_40110B)(v23 | v17);
    v19 = (unsigned __int16)_EAX % *(unsigned __int8 *)(v17 + 1139788445);
    LOBYTE(_EAX) = (unsigned __int16)_EAX / *(unsigned __int8 *)(v17 + 1139788445);
    BYTE1(_EAX) = v19;
  }
}
// 401433: control flows out of bounds to 401439
// 401430: control flows out of bounds to 4013D9
// 40122E: variable 'v7' is possibly undefined
// 401231: variable 'v14' is possibly undefined
// 401244: variable 'v22' is possibly undefined
// 401244: variable 'v27' is possibly undefined
// 40124E: variable 'v23' is possibly undefined
// 40124E: variable 'v24' is possibly undefined
// 401217: variable 'savedregs' is possibly undefined

//----- (004011CF) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4011CF(int a1@<eax>, double a2@<st0>)
{
  if ( !((a1 + 1 < 0) ^ __OFADD__(1, a1) | (a1 == -1)) && (a1 + 1 < 0) ^ __OFADD__(1, a1) | (a1 == -1) )
  {
    *(double *)(a1 + 24) = a2;
    JUMPOUT(0x401145);
  }
  JUMPOUT(0x40129F);
}
// 40130D: positive sp value C has been found
// 4010E9: control flows out of bounds to 4010EB
// 4014B5: control flows out of bounds to 4014B7
// 401320: control flows out of bounds to 401145
// 401481: control flows out of bounds to 40129F

//----- (0040132B) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_40132B()
{
  __asm { repne pop edx }
  JUMPOUT(0x4013C2);
}
// 401330: positive sp value 4 has been found
// 401338: control flows out of bounds to 4013C2

//----- (004013D7) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __usercall sub_4013D7(char a1@<cf>, int a2@<eax>, int a3@<edx>, int a4@<ecx>, int a5@<edi>)
{
  int v5; // edx
  void *v7; // [esp+2Ch] [ebp-4h]
  void *retaddr; // [esp+30h] [ebp+0h]

  *(&retaddr - 13) = v7;
  v5 = a3 + 1;
  BYTE1(a4) = a1 + BYTE1(a4) - 83;
  LOBYTE(v5) = ~(_BYTE)v5;
  ((void (__fastcall *)(int, int))loc_4010B4)(a4, v5);
  *(_DWORD *)(a5 - 735820657) ^= a2;
  JUMPOUT(0x4013F2);
}
// 4013DB: positive sp value 4 has been found
// 4013EC: control flows out of bounds to 4013F2

// nfuncs=4 queued=4 decompiled=4 lumina nreq=0 worse=0 better=0
// ALL OK, 4 function(s) have been successfully decompiled
