/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __usercall start@<eax>(void *@<ebx>, void *@<edi>, void *@<esi>);

//-------------------------------------------------------------------------
// Data declarations

CHAR LibFileName[] = "ACTXPRXY.DLL"; // idb
CHAR ProcName[] = "DllGetClassObject"; // idb
char a28ac6ktepdk9qc[17] = "28AC6ktEpDK9qcb9"; // weak
// extern BOOL (__stdcall *ResetEvent)(HANDLE hEvent);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
// extern LPVOID (__stdcall *TlsGetValue)(DWORD dwTlsIndex);
// extern BOOL (__stdcall *SetEvent)(HANDLE hEvent);
// extern HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);


//----- (004010D7) --------------------------------------------------------
int __usercall start@<eax>(void *a1@<ebx>, void *a2@<edi>, void *a3@<esi>)
{
  LPVOID v3; // eax
  int v5; // [esp+4h] [ebp-38h] BYREF
  int (*v6)(void); // [esp+8h] [ebp-34h]
  int v7; // [esp+Ch] [ebp-30h]
  int v8; // [esp+10h] [ebp-2Ch]
  int v9; // [esp+14h] [ebp-28h]
  int v10; // [esp+18h] [ebp-24h]
  HMODULE hModule; // [esp+1Ch] [ebp-20h]
  int v12; // [esp+20h] [ebp-1Ch]
  int v13; // [esp+24h] [ebp-18h]
  LPVOID Value; // [esp+28h] [ebp-14h]
  int v15; // [esp+2Ch] [ebp-10h]
  char *v16; // [esp+30h] [ebp-Ch]
  int v17; // [esp+34h] [ebp-8h]
  HRESULT (__stdcall *DllGetClassObject)(const IID *const, const IID *const, LPVOID *); // [esp+38h] [ebp-4h]
  int savedregs; // [esp+3Ch] [ebp+0h]

  TlsGetValue(0xB50BA2F1);
  ResetEvent((HANDLE)0xC52C1088);
  ResetEvent((HANDLE)0x97090603);
  SetEvent(a2);
  ResetEvent(a2);
  ResetEvent(a2);
  TlsGetValue(0xAF7944A8);
  TlsGetValue(0x33u);
  TlsGetValue(0x354E7995u);
  SetEvent(a2);
  SetEvent((HANDLE)0x64);
  TlsGetValue(0x9FA88CB2);
  TlsGetValue(0x66u);
  TlsGetValue(0xFFFFFFEC);
  ResetEvent((HANDLE)0x45150120);
  SetEvent(a3);
  SetEvent(a1);
  SetEvent(a1);
  Value = TlsGetValue(0x6Eu);
  hModule = LoadLibraryA(LibFileName);
  TlsGetValue(0x51u);
  TlsGetValue(0xFFFFFF89);
  SetEvent((HANDLE)0xFFFFFFA4);
  DllGetClassObject = (HRESULT (__stdcall *)(const IID *const, const IID *const, LPVOID *))GetProcAddress(
                                                                                             hModule,
                                                                                             ProcName);
  v16 = (char *)TlsGetValue(0x2Cu);
  TlsGetValue(0xFFFFFFE3);
  v16 = &v16[(_DWORD)TlsGetValue(0x64u)];
  SetEvent(a1);
  SetEvent((HANDLE)0xFFFFFFA7);
  ResetEvent(a1);
  ResetEvent((HANDLE)0x9540290A);
  v3 = TlsGetValue(0x5Cu);
  v9 = ((int (__stdcall *)(char *, _DWORD, int *, LPVOID, int, int (*)(void), int, int, int, int, HMODULE, int, int, LPVOID, int, char *, int, HRESULT (__stdcall *)(const IID *const, const IID *const, LPVOID *), int))DllGetClassObject)(
         a28ac6ktepdk9qc,
         0,
         &v5,
         v3,
         v5,
         v6,
         v7,
         v8,
         v9,
         v10,
         hModule,
         v12,
         v13,
         Value,
         v15,
         v16,
         v17,
         DllGetClassObject,
         savedregs);
  TlsGetValue(0x6Fu);
  v6 = (int (*)(void))(v9 + 1947395641);
  SetEvent((HANDLE)0x15236001);
  ResetEvent(a1);
  v6 = (int (*)(void))((char *)v6 + 204024685);
  SetEvent(a1);
  return v6();
}

// nfuncs=1 queued=1 decompiled=1 lumina nreq=0 worse=0 better=0
// ALL OK, 1 function(s) have been successfully decompiled
